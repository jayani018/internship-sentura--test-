"use strict";function _get5(){if(typeof Reflect!=="undefined"&&Reflect.get){_get5=Reflect.get.bind()}else{_get5=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(arguments.length<3?target:receiver)}return desc.value}}return _get5.apply(this,arguments)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _classStaticPrivateMethodGet(receiver,classConstructor,method){_classCheckPrivateStaticAccess(receiver,classConstructor);return method}function _classPrivateMethodInitSpec(obj,privateSet){_checkPrivateRedeclaration(obj,privateSet);privateSet.add(obj)}function _classPrivateMethodGet(receiver,privateSet,fn){if(!privateSet.has(receiver)){throw new TypeError("attempted to get private field on non-instance")}return fn}function _classStaticPrivateFieldSpecSet(receiver,classConstructor,descriptor,value){_classCheckPrivateStaticAccess(receiver,classConstructor);_classCheckPrivateStaticFieldDescriptor(descriptor,"set");_classApplyDescriptorSet(receiver,descriptor,value);return value}function _classStaticPrivateFieldSpecGet(receiver,classConstructor,descriptor){_classCheckPrivateStaticAccess(receiver,classConstructor);_classCheckPrivateStaticFieldDescriptor(descriptor,"get");return _classApplyDescriptorGet(receiver,descriptor)}function _classCheckPrivateStaticFieldDescriptor(descriptor,action){if(descriptor===undefined){throw new TypeError("attempted to "+action+" private static field before its declaration")}}function _classCheckPrivateStaticAccess(receiver,classConstructor){if(receiver!==classConstructor){throw new TypeError("Private static access of wrong provenance")}}function _classPrivateFieldInitSpec(obj,privateMap,value){_checkPrivateRedeclaration(obj,privateMap);privateMap.set(obj,value)}function _checkPrivateRedeclaration(obj,privateCollection){if(privateCollection.has(obj)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateFieldGet(receiver,privateMap){var descriptor=_classExtractFieldDescriptor(receiver,privateMap,"get");return _classApplyDescriptorGet(receiver,descriptor)}function _classApplyDescriptorGet(receiver,descriptor){if(descriptor.get){return descriptor.get.call(receiver)}return descriptor.value}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=_classExtractFieldDescriptor(receiver,privateMap,"set");_classApplyDescriptorSet(receiver,descriptor,value);return value}function _classExtractFieldDescriptor(receiver,privateMap,action){if(!privateMap.has(receiver)){throw new TypeError("attempted to "+action+" private field on non-instance")}return privateMap.get(receiver)}function _classApplyDescriptorSet(receiver,descriptor,value){if(descriptor.set){descriptor.set.call(receiver,value)}else{if(!descriptor.writable){throw new TypeError("attempted to set read only private field")}descriptor.value=value}}function _toConsumableArray2(arr){return _arrayWithoutHoles2(arr)||_iterableToArray2(arr)||_unsupportedIterableToArray2(arr)||_nonIterableSpread2()}function _nonIterableSpread2(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray2(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles2(arr){if(Array.isArray(arr))return _arrayLikeToArray2(arr)}function _slicedToArray2(arr,i){return _arrayWithHoles2(arr)||_iterableToArrayLimit2(arr,i)||_unsupportedIterableToArray2(arr,i)||_nonIterableRest2()}function _nonIterableRest2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit2(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t["return"]&&(u=t["return"](),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles2(arr){if(Array.isArray(arr))return arr}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray2(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e4){throw _e4},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e5){didErr=true;err=_e5},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray2(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray2(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray2(o,minLen)}function _arrayLikeToArray2(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof2(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof2(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},"catch":function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _typeof2(o){"@babel/helpers - typeof";return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof2(o)}function _ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?_ownKeys(Object(t),!0).forEach(function(r){_defineProperty2(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty2(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass2(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof2(i)?i:String(i)}function _toPrimitive(t,r){if("object"!=_typeof2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof2(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _classCallCheck2(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits2(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf2(subClass,superClass)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn2(this,result)}}function _possibleConstructorReturn2(self,call){if(call&&(_typeof2(call)==="object"||typeof call==="function")){return call}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map:undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf2(Wrapper,Class)};return _wrapNativeSuper(Class)}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct.bind()}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_setPrototypeOf2(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _isNativeFunction(fn){try{return Function.toString.call(fn).indexOf("[native code]")!==-1}catch(e){return typeof fn==="function"}}function _setPrototypeOf2(o,p){_setPrototypeOf2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf2(o,p)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var React=require("react");var ReactDOM=require("react-dom");var jsxRuntime=require("react/jsx-runtime");function _interopNamespaceDefault(e){var n=Object.create(null);if(e){Object.keys(e).forEach(function(k){if(k!=="default"){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:true,get:function get(){return e[k]}})}})}n["default"]=e;return Object.freeze(n)}var React__namespace=_interopNamespaceDefault(React);var ReactDOM__namespace=_interopNamespaceDefault(ReactDOM);var HttpError=function(_Error){_inherits2(HttpError,_Error);var _super=_createSuper(HttpError);function HttpError(errorMessage,statusCode){var _this9;_classCallCheck2(this,HttpError);var trueProto=(this instanceof HttpError?this.constructor:void 0).prototype;_this9=_super.call(this,"".concat(errorMessage,": Status code '").concat(statusCode,"'"));_this9.statusCode=statusCode;_this9.__proto__=trueProto;return _this9}return _createClass2(HttpError)}(_wrapNativeSuper(Error));var TimeoutError=function(_Error2){_inherits2(TimeoutError,_Error2);var _super2=_createSuper(TimeoutError);function TimeoutError(){var _this10;var errorMessage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"A timeout occurred.";_classCallCheck2(this,TimeoutError);var trueProto=(this instanceof TimeoutError?this.constructor:void 0).prototype;_this10=_super2.call(this,errorMessage);_this10.__proto__=trueProto;return _this10}return _createClass2(TimeoutError)}(_wrapNativeSuper(Error));var AbortError=function(_Error3){_inherits2(AbortError,_Error3);var _super3=_createSuper(AbortError);function AbortError(){var _this11;var errorMessage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"An abort occurred.";_classCallCheck2(this,AbortError);var trueProto=(this instanceof AbortError?this.constructor:void 0).prototype;_this11=_super3.call(this,errorMessage);_this11.__proto__=trueProto;return _this11}return _createClass2(AbortError)}(_wrapNativeSuper(Error));var UnsupportedTransportError=function(_Error4){_inherits2(UnsupportedTransportError,_Error4);var _super4=_createSuper(UnsupportedTransportError);function UnsupportedTransportError(message,transport){var _this12;_classCallCheck2(this,UnsupportedTransportError);var trueProto=(this instanceof UnsupportedTransportError?this.constructor:void 0).prototype;_this12=_super4.call(this,message);_this12.transport=transport;_this12.errorType="UnsupportedTransportError";_this12.__proto__=trueProto;return _this12}return _createClass2(UnsupportedTransportError)}(_wrapNativeSuper(Error));var DisabledTransportError=function(_Error5){_inherits2(DisabledTransportError,_Error5);var _super5=_createSuper(DisabledTransportError);function DisabledTransportError(message,transport){var _this13;_classCallCheck2(this,DisabledTransportError);var trueProto=(this instanceof DisabledTransportError?this.constructor:void 0).prototype;_this13=_super5.call(this,message);_this13.transport=transport;_this13.errorType="DisabledTransportError";_this13.__proto__=trueProto;return _this13}return _createClass2(DisabledTransportError)}(_wrapNativeSuper(Error));var FailedToStartTransportError=function(_Error6){_inherits2(FailedToStartTransportError,_Error6);var _super6=_createSuper(FailedToStartTransportError);function FailedToStartTransportError(message,transport){var _this14;_classCallCheck2(this,FailedToStartTransportError);var trueProto=(this instanceof FailedToStartTransportError?this.constructor:void 0).prototype;_this14=_super6.call(this,message);_this14.transport=transport;_this14.errorType="FailedToStartTransportError";_this14.__proto__=trueProto;return _this14}return _createClass2(FailedToStartTransportError)}(_wrapNativeSuper(Error));var FailedToNegotiateWithServerError=function(_Error7){_inherits2(FailedToNegotiateWithServerError,_Error7);var _super7=_createSuper(FailedToNegotiateWithServerError);function FailedToNegotiateWithServerError(message){var _this15;_classCallCheck2(this,FailedToNegotiateWithServerError);var trueProto=(this instanceof FailedToNegotiateWithServerError?this.constructor:void 0).prototype;_this15=_super7.call(this,message);_this15.errorType="FailedToNegotiateWithServerError";_this15.__proto__=trueProto;return _this15}return _createClass2(FailedToNegotiateWithServerError)}(_wrapNativeSuper(Error));var AggregateErrors=function(_Error8){_inherits2(AggregateErrors,_Error8);var _super8=_createSuper(AggregateErrors);function AggregateErrors(message,innerErrors){var _this16;_classCallCheck2(this,AggregateErrors);var trueProto=(this instanceof AggregateErrors?this.constructor:void 0).prototype;_this16=_super8.call(this,message);_this16.innerErrors=innerErrors;_this16.__proto__=trueProto;return _this16}return _createClass2(AggregateErrors)}(_wrapNativeSuper(Error));var HttpResponse=_createClass2(function HttpResponse(statusCode,statusText,content){_classCallCheck2(this,HttpResponse);this.statusCode=statusCode;this.statusText=statusText;this.content=content});var HttpClient=function(){function HttpClient(){_classCallCheck2(this,HttpClient)}_createClass2(HttpClient,[{key:"get",value:function get(url,options){return this.send(_objectSpread2(_objectSpread2({},options),{},{method:"GET",url:url}))}},{key:"post",value:function post(url,options){return this.send(_objectSpread2(_objectSpread2({},options),{},{method:"POST",url:url}))}},{key:"delete",value:function _delete(url,options){return this.send(_objectSpread2(_objectSpread2({},options),{},{method:"DELETE",url:url}))}},{key:"getCookieString",value:function getCookieString(url){return""}}]);return HttpClient}();var LogLevel;(function(LogLevel){LogLevel[LogLevel["Trace"]=0]="Trace";LogLevel[LogLevel["Debug"]=1]="Debug";LogLevel[LogLevel["Information"]=2]="Information";LogLevel[LogLevel["Warning"]=3]="Warning";LogLevel[LogLevel["Error"]=4]="Error";LogLevel[LogLevel["Critical"]=5]="Critical";LogLevel[LogLevel["None"]=6]="None"})(LogLevel||(LogLevel={}));var NullLogger=function(){function NullLogger(){_classCallCheck2(this,NullLogger)}_createClass2(NullLogger,[{key:"log",value:function log(_logLevel,_message){}}]);return NullLogger}();NullLogger.instance=new NullLogger;var VERSION="7.0.14";var Arg=function(){function Arg(){_classCallCheck2(this,Arg)}_createClass2(Arg,null,[{key:"isRequired",value:function isRequired(val,name){if(val===null||val===undefined){throw new Error("The '".concat(name,"' argument is required."))}}},{key:"isNotEmpty",value:function isNotEmpty(val,name){if(!val||val.match(/^\s*$/)){throw new Error("The '".concat(name,"' argument should not be empty."))}}},{key:"isIn",value:function isIn(val,values,name){if(!(val in values)){throw new Error("Unknown ".concat(name," value: ").concat(val,"."))}}}]);return Arg}();var Platform=function(){function Platform(){_classCallCheck2(this,Platform)}_createClass2(Platform,null,[{key:"isBrowser",get:function get(){return(typeof window==="undefined"?"undefined":_typeof2(window))==="object"&&_typeof2(window.document)==="object"}},{key:"isWebWorker",get:function get(){return(typeof self==="undefined"?"undefined":_typeof2(self))==="object"&&"importScripts"in self}},{key:"isReactNative",get:function get(){return(typeof window==="undefined"?"undefined":_typeof2(window))==="object"&&typeof window.document==="undefined"}},{key:"isNode",get:function get(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}}]);return Platform}();function getDataDetail(data,includeContent){var detail="";if(isArrayBuffer(data)){detail="Binary data of length ".concat(data.byteLength);if(includeContent){detail+=". Content: '".concat(formatArrayBuffer(data),"'")}}else if(typeof data==="string"){detail="String data of length ".concat(data.length);if(includeContent){detail+=". Content: '".concat(data,"'")}}return detail}function formatArrayBuffer(data){var view=new Uint8Array(data);var str="";view.forEach(function(num){var pad=num<16?"0":"";str+="0x".concat(pad).concat(num.toString(16)," ")});return str.substr(0,str.length-1)}function isArrayBuffer(val){return val&&typeof ArrayBuffer!=="undefined"&&(val instanceof ArrayBuffer||val.constructor&&val.constructor.name==="ArrayBuffer")}function sendMessage(_x2,_x3,_x4,_x5,_x6,_x7){return _sendMessage.apply(this,arguments)}function _sendMessage(){_sendMessage=_asyncToGenerator(_regeneratorRuntime().mark(function _callee214(logger,transportName,httpClient,url,content,options){var headers,_getUserAgentHeader11,_getUserAgentHeader12,name,value,responseType,response;return _regeneratorRuntime().wrap(function _callee214$(_context217){while(1)switch(_context217.prev=_context217.next){case 0:headers={};_getUserAgentHeader11=getUserAgentHeader(),_getUserAgentHeader12=_slicedToArray2(_getUserAgentHeader11,2),name=_getUserAgentHeader12[0],value=_getUserAgentHeader12[1];headers[name]=value;logger.log(LogLevel.Trace,"(".concat(transportName," transport) sending data. ").concat(getDataDetail(content,options.logMessageContent),"."));responseType=isArrayBuffer(content)?"arraybuffer":"text";_context217.next=7;return httpClient.post(url,{content:content,headers:_objectSpread2(_objectSpread2({},headers),options.headers),responseType:responseType,timeout:options.timeout,withCredentials:options.withCredentials});case 7:response=_context217.sent;logger.log(LogLevel.Trace,"(".concat(transportName," transport) request complete. Response status: ").concat(response.statusCode,"."));case 9:case"end":return _context217.stop()}},_callee214)}));return _sendMessage.apply(this,arguments)}function createLogger(logger){if(logger===undefined){return new ConsoleLogger(LogLevel.Information)}if(logger===null){return NullLogger.instance}if(logger.log!==undefined){return logger}return new ConsoleLogger(logger)}var SubjectSubscription=function(){function SubjectSubscription(subject,observer){_classCallCheck2(this,SubjectSubscription);this._subject=subject;this._observer=observer}_createClass2(SubjectSubscription,[{key:"dispose",value:function dispose(){var index=this._subject.observers.indexOf(this._observer);if(index>-1){this._subject.observers.splice(index,1)}if(this._subject.observers.length===0&&this._subject.cancelCallback){this._subject.cancelCallback()["catch"](function(_){})}}}]);return SubjectSubscription}();var ConsoleLogger=function(){function ConsoleLogger(minimumLogLevel){_classCallCheck2(this,ConsoleLogger);this._minLevel=minimumLogLevel;this.out=console}_createClass2(ConsoleLogger,[{key:"log",value:function log(logLevel,message){if(logLevel>=this._minLevel){var msg="[".concat(new Date().toISOString(),"] ").concat(LogLevel[logLevel],": ").concat(message);switch(logLevel){case LogLevel.Critical:case LogLevel.Error:this.out.error(msg);break;case LogLevel.Warning:this.out.warn(msg);break;case LogLevel.Information:this.out.info(msg);break;default:this.out.log(msg);break}}}}]);return ConsoleLogger}();function getUserAgentHeader(){var userAgentHeaderName="X-SignalR-User-Agent";if(Platform.isNode){userAgentHeaderName="User-Agent"}return[userAgentHeaderName,constructUserAgent(VERSION,getOsName(),getRuntime(),getRuntimeVersion())]}function constructUserAgent(version,os,runtime,runtimeVersion){var userAgent="Microsoft SignalR/";var majorAndMinor=version.split(".");userAgent+="".concat(majorAndMinor[0],".").concat(majorAndMinor[1]);userAgent+=" (".concat(version,"; ");if(os&&os!==""){userAgent+="".concat(os,"; ")}else{userAgent+="Unknown OS; "}userAgent+="".concat(runtime);if(runtimeVersion){userAgent+="; ".concat(runtimeVersion)}else{userAgent+="; Unknown Runtime Version"}userAgent+=")";return userAgent}function getOsName(){if(Platform.isNode){switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}else{return""}}function getRuntimeVersion(){if(Platform.isNode){return process.versions.node}return undefined}function getRuntime(){if(Platform.isNode){return"NodeJS"}else{return"Browser"}}function getErrorString(e){if(e.stack){return e.stack}else if(e.message){return e.message}return"".concat(e)}function getGlobalThis(){if(typeof globalThis!=="undefined"){return globalThis}if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("could not find global")}var FetchHttpClient=function(_HttpClient){_inherits2(FetchHttpClient,_HttpClient);var _super9=_createSuper(FetchHttpClient);function FetchHttpClient(logger){var _this17;_classCallCheck2(this,FetchHttpClient);_this17=_super9.call(this);_this17._logger=logger;if(typeof fetch==="undefined"){var requireFunc=typeof __webpack_require__==="function"?__non_webpack_require__:require;_this17._jar=new(requireFunc("tough-cookie").CookieJar);_this17._fetchType=requireFunc("node-fetch");_this17._fetchType=requireFunc("fetch-cookie")(_this17._fetchType,_this17._jar)}else{_this17._fetchType=fetch.bind(getGlobalThis())}if(typeof AbortController==="undefined"){var _requireFunc=typeof __webpack_require__==="function"?__non_webpack_require__:require;_this17._abortControllerType=_requireFunc("abort-controller")}else{_this17._abortControllerType=AbortController}return _this17}_createClass2(FetchHttpClient,[{key:"send",value:(function(){var _send=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(request){var _this18=this;var abortController,error,timeoutId,msTimeout,response,errorMessage,content,payload;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(request.abortSignal&&request.abortSignal.aborted)){_context.next=2;break}throw new AbortError;case 2:if(request.method){_context.next=4;break}throw new Error("No method defined.");case 4:if(request.url){_context.next=6;break}throw new Error("No url defined.");case 6:abortController=new this._abortControllerType;if(request.abortSignal){request.abortSignal.onabort=function(){abortController.abort();error=new AbortError}}timeoutId=null;if(request.timeout){msTimeout=request.timeout;timeoutId=setTimeout(function(){abortController.abort();_this18._logger.log(LogLevel.Warning,"Timeout from HTTP request.");error=new TimeoutError},msTimeout)}if(request.content===""){request.content=undefined}if(request.content){request.headers=request.headers||{};if(isArrayBuffer(request.content)){request.headers["Content-Type"]="application/octet-stream"}else{request.headers["Content-Type"]="text/plain;charset=UTF-8"}}_context.prev=12;_context.next=15;return this._fetchType(request.url,{body:request.content,cache:"no-cache",credentials:request.withCredentials===true?"include":"same-origin",headers:_objectSpread2({"X-Requested-With":"XMLHttpRequest"},request.headers),method:request.method,mode:"cors",redirect:"follow",signal:abortController.signal});case 15:response=_context.sent;_context.next=24;break;case 18:_context.prev=18;_context.t0=_context["catch"](12);if(!error){_context.next=22;break}throw error;case 22:this._logger.log(LogLevel.Warning,"Error from HTTP request. ".concat(_context.t0,"."));throw _context.t0;case 24:_context.prev=24;if(timeoutId){clearTimeout(timeoutId)}if(request.abortSignal){request.abortSignal.onabort=null}return _context.finish(24);case 28:if(response.ok){_context.next=33;break}_context.next=31;return deserializeContent(response,"text");case 31:errorMessage=_context.sent;throw new HttpError(errorMessage||response.statusText,response.status);case 33:content=deserializeContent(response,request.responseType);_context.next=36;return content;case 36:payload=_context.sent;return _context.abrupt("return",new HttpResponse(response.status,response.statusText,payload));case 38:case"end":return _context.stop()}},_callee,this,[[12,18,24,28]])}));function send(_x8){return _send.apply(this,arguments)}return send}())},{key:"getCookieString",value:function getCookieString(url){var cookies="";if(Platform.isNode&&this._jar){this._jar.getCookies(url,function(e,c){return cookies=c.join("; ")})}return cookies}}]);return FetchHttpClient}(HttpClient);function deserializeContent(response,responseType){var content;switch(responseType){case"arraybuffer":content=response.arrayBuffer();break;case"text":content=response.text();break;case"blob":case"document":case"json":throw new Error("".concat(responseType," is not supported."));default:content=response.text();break}return content}var XhrHttpClient=function(_HttpClient2){_inherits2(XhrHttpClient,_HttpClient2);var _super10=_createSuper(XhrHttpClient);function XhrHttpClient(logger){var _this19;_classCallCheck2(this,XhrHttpClient);_this19=_super10.call(this);_this19._logger=logger;return _this19}_createClass2(XhrHttpClient,[{key:"send",value:function send(request){var _this20=this;if(request.abortSignal&&request.abortSignal.aborted){return Promise.reject(new AbortError)}if(!request.method){return Promise.reject(new Error("No method defined."))}if(!request.url){return Promise.reject(new Error("No url defined."))}return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open(request.method,request.url,true);xhr.withCredentials=request.withCredentials===undefined?true:request.withCredentials;xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");if(request.content===""){request.content=undefined}if(request.content){if(isArrayBuffer(request.content)){xhr.setRequestHeader("Content-Type","application/octet-stream")}else{xhr.setRequestHeader("Content-Type","text/plain;charset=UTF-8")}}var headers=request.headers;if(headers){Object.keys(headers).forEach(function(header){xhr.setRequestHeader(header,headers[header])})}if(request.responseType){xhr.responseType=request.responseType}if(request.abortSignal){request.abortSignal.onabort=function(){xhr.abort();reject(new AbortError)}}if(request.timeout){xhr.timeout=request.timeout}xhr.onload=function(){if(request.abortSignal){request.abortSignal.onabort=null}if(xhr.status>=200&&xhr.status<300){resolve(new HttpResponse(xhr.status,xhr.statusText,xhr.response||xhr.responseText))}else{reject(new HttpError(xhr.response||xhr.responseText||xhr.statusText,xhr.status))}};xhr.onerror=function(){_this20._logger.log(LogLevel.Warning,"Error from HTTP request. ".concat(xhr.status,": ").concat(xhr.statusText,"."));reject(new HttpError(xhr.statusText,xhr.status))};xhr.ontimeout=function(){_this20._logger.log(LogLevel.Warning,"Timeout from HTTP request.");reject(new TimeoutError)};xhr.send(request.content)})}}]);return XhrHttpClient}(HttpClient);var DefaultHttpClient=function(_HttpClient3){_inherits2(DefaultHttpClient,_HttpClient3);var _super11=_createSuper(DefaultHttpClient);function DefaultHttpClient(logger){var _this21;_classCallCheck2(this,DefaultHttpClient);_this21=_super11.call(this);if(typeof fetch!=="undefined"||Platform.isNode){_this21._httpClient=new FetchHttpClient(logger)}else if(typeof XMLHttpRequest!=="undefined"){_this21._httpClient=new XhrHttpClient(logger)}else{throw new Error("No usable HttpClient found.")}return _this21}_createClass2(DefaultHttpClient,[{key:"send",value:function send(request){if(request.abortSignal&&request.abortSignal.aborted){return Promise.reject(new AbortError)}if(!request.method){return Promise.reject(new Error("No method defined."))}if(!request.url){return Promise.reject(new Error("No url defined."))}return this._httpClient.send(request)}},{key:"getCookieString",value:function getCookieString(url){return this._httpClient.getCookieString(url)}}]);return DefaultHttpClient}(HttpClient);var TextMessageFormat=function(){function TextMessageFormat(){_classCallCheck2(this,TextMessageFormat)}_createClass2(TextMessageFormat,null,[{key:"write",value:function write(output){return"".concat(output).concat(TextMessageFormat.RecordSeparator)}},{key:"parse",value:function parse(input){if(input[input.length-1]!==TextMessageFormat.RecordSeparator){throw new Error("Message is incomplete.")}var messages=input.split(TextMessageFormat.RecordSeparator);messages.pop();return messages}}]);return TextMessageFormat}();TextMessageFormat.RecordSeparatorCode=30;TextMessageFormat.RecordSeparator=String.fromCharCode(TextMessageFormat.RecordSeparatorCode);var HandshakeProtocol=function(){function HandshakeProtocol(){_classCallCheck2(this,HandshakeProtocol)}_createClass2(HandshakeProtocol,[{key:"writeHandshakeRequest",value:function writeHandshakeRequest(handshakeRequest){return TextMessageFormat.write(JSON.stringify(handshakeRequest))}},{key:"parseHandshakeResponse",value:function parseHandshakeResponse(data){var messageData;var remainingData;if(isArrayBuffer(data)){var binaryData=new Uint8Array(data);var separatorIndex=binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);if(separatorIndex===-1){throw new Error("Message is incomplete.")}var responseLength=separatorIndex+1;messageData=String.fromCharCode.apply(null,Array.prototype.slice.call(binaryData.slice(0,responseLength)));remainingData=binaryData.byteLength>responseLength?binaryData.slice(responseLength).buffer:null}else{var textData=data;var _separatorIndex=textData.indexOf(TextMessageFormat.RecordSeparator);if(_separatorIndex===-1){throw new Error("Message is incomplete.")}var _responseLength=_separatorIndex+1;messageData=textData.substring(0,_responseLength);remainingData=textData.length>_responseLength?textData.substring(_responseLength):null}var messages=TextMessageFormat.parse(messageData);var response=JSON.parse(messages[0]);if(response.type){throw new Error("Expected a handshake response from the server.")}var responseMessage=response;return[remainingData,responseMessage]}}]);return HandshakeProtocol}();var MessageType;(function(MessageType){MessageType[MessageType["Invocation"]=1]="Invocation";MessageType[MessageType["StreamItem"]=2]="StreamItem";MessageType[MessageType["Completion"]=3]="Completion";MessageType[MessageType["StreamInvocation"]=4]="StreamInvocation";MessageType[MessageType["CancelInvocation"]=5]="CancelInvocation";MessageType[MessageType["Ping"]=6]="Ping";MessageType[MessageType["Close"]=7]="Close"})(MessageType||(MessageType={}));var Subject=function(){function Subject(){_classCallCheck2(this,Subject);this.observers=[]}_createClass2(Subject,[{key:"next",value:function next(item){var _iterator3=_createForOfIteratorHelper(this.observers),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var observer=_step3.value;observer.next(item)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}},{key:"error",value:function error(err){var _iterator4=_createForOfIteratorHelper(this.observers),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var observer=_step4.value;if(observer.error){observer.error(err)}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}},{key:"complete",value:function complete(){var _iterator5=_createForOfIteratorHelper(this.observers),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var observer=_step5.value;if(observer.complete){observer.complete()}}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}},{key:"subscribe",value:function subscribe(observer){this.observers.push(observer);return new SubjectSubscription(this,observer)}}]);return Subject}();var DEFAULT_TIMEOUT_IN_MS=30*1000;var DEFAULT_PING_INTERVAL_IN_MS=15*1000;var HubConnectionState;(function(HubConnectionState){HubConnectionState["Disconnected"]="Disconnected";HubConnectionState["Connecting"]="Connecting";HubConnectionState["Connected"]="Connected";HubConnectionState["Disconnecting"]="Disconnecting";HubConnectionState["Reconnecting"]="Reconnecting"})(HubConnectionState||(HubConnectionState={}));var HubConnection=function(){function HubConnection(connection,logger,protocol,reconnectPolicy){var _this22=this;_classCallCheck2(this,HubConnection);this._nextKeepAlive=0;this._freezeEventListener=function(){_this22._logger.log(LogLevel.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")};Arg.isRequired(connection,"connection");Arg.isRequired(logger,"logger");Arg.isRequired(protocol,"protocol");this.serverTimeoutInMilliseconds=DEFAULT_TIMEOUT_IN_MS;this.keepAliveIntervalInMilliseconds=DEFAULT_PING_INTERVAL_IN_MS;this._logger=logger;this._protocol=protocol;this.connection=connection;this._reconnectPolicy=reconnectPolicy;this._handshakeProtocol=new HandshakeProtocol;this.connection.onreceive=function(data){return _this22._processIncomingData(data)};this.connection.onclose=function(error){return _this22._connectionClosed(error)};this._callbacks={};this._methods={};this._closedCallbacks=[];this._reconnectingCallbacks=[];this._reconnectedCallbacks=[];this._invocationId=0;this._receivedHandshakeResponse=false;this._connectionState=HubConnectionState.Disconnected;this._connectionStarted=false;this._cachedPingMessage=this._protocol.writeMessage({type:MessageType.Ping})}_createClass2(HubConnection,[{key:"state",get:function get(){return this._connectionState}},{key:"connectionId",get:function get(){return this.connection?this.connection.connectionId||null:null}},{key:"baseUrl",get:function get(){return this.connection.baseUrl||""},set:function set(url){if(this._connectionState!==HubConnectionState.Disconnected&&this._connectionState!==HubConnectionState.Reconnecting){throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.")}if(!url){throw new Error("The HubConnection url must be a valid url.")}this.connection.baseUrl=url}},{key:"start",value:function start(){this._startPromise=this._startWithStateTransitions();return this._startPromise}},{key:"_startWithStateTransitions",value:function(){var _startWithStateTransitions2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!(this._connectionState!==HubConnectionState.Disconnected)){_context2.next=2;break}return _context2.abrupt("return",Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state.")));case 2:this._connectionState=HubConnectionState.Connecting;this._logger.log(LogLevel.Debug,"Starting HubConnection.");_context2.prev=4;_context2.next=7;return this._startInternal();case 7:if(Platform.isBrowser){window.document.addEventListener("freeze",this._freezeEventListener)}this._connectionState=HubConnectionState.Connected;this._connectionStarted=true;this._logger.log(LogLevel.Debug,"HubConnection connected successfully.");_context2.next=18;break;case 13:_context2.prev=13;_context2.t0=_context2["catch"](4);this._connectionState=HubConnectionState.Disconnected;this._logger.log(LogLevel.Debug,"HubConnection failed to start successfully because of error '".concat(_context2.t0,"'."));return _context2.abrupt("return",Promise.reject(_context2.t0));case 18:case"end":return _context2.stop()}},_callee2,this,[[4,13]])}));function _startWithStateTransitions(){return _startWithStateTransitions2.apply(this,arguments)}return _startWithStateTransitions}()},{key:"_startInternal",value:function(){var _startInternal2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(){var _this23=this;var handshakePromise,handshakeRequest;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:this._stopDuringStartError=undefined;this._receivedHandshakeResponse=false;handshakePromise=new Promise(function(resolve,reject){_this23._handshakeResolver=resolve;_this23._handshakeRejecter=reject});_context3.next=5;return this.connection.start(this._protocol.transferFormat);case 5:_context3.prev=5;handshakeRequest={protocol:this._protocol.name,version:this._protocol.version};this._logger.log(LogLevel.Debug,"Sending handshake request.");_context3.next=10;return this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(handshakeRequest));case 10:this._logger.log(LogLevel.Information,"Using HubProtocol '".concat(this._protocol.name,"'."));this._cleanupTimeout();this._resetTimeoutPeriod();this._resetKeepAliveInterval();_context3.next=16;return handshakePromise;case 16:if(!this._stopDuringStartError){_context3.next=18;break}throw this._stopDuringStartError;case 18:if(this.connection.features.inherentKeepAlive){_context3.next=21;break}_context3.next=21;return this._sendMessage(this._cachedPingMessage);case 21:_context3.next=31;break;case 23:_context3.prev=23;_context3.t0=_context3["catch"](5);this._logger.log(LogLevel.Debug,"Hub handshake failed with error '".concat(_context3.t0,"' during start(). Stopping HubConnection."));this._cleanupTimeout();this._cleanupPingTimer();_context3.next=30;return this.connection.stop(_context3.t0);case 30:throw _context3.t0;case 31:case"end":return _context3.stop()}},_callee3,this,[[5,23]])}));function _startInternal(){return _startInternal2.apply(this,arguments)}return _startInternal}()},{key:"stop",value:(function(){var _stop=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(){var startPromise;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:startPromise=this._startPromise;this._stopPromise=this._stopInternal();_context4.next=4;return this._stopPromise;case 4:_context4.prev=4;_context4.next=7;return startPromise;case 7:_context4.next=11;break;case 9:_context4.prev=9;_context4.t0=_context4["catch"](4);case 11:case"end":return _context4.stop()}},_callee4,this,[[4,9]])}));function stop(){return _stop.apply(this,arguments)}return stop}())},{key:"_stopInternal",value:function _stopInternal(error){if(this._connectionState===HubConnectionState.Disconnected){this._logger.log(LogLevel.Debug,"Call to HubConnection.stop(".concat(error,") ignored because it is already in the disconnected state."));return Promise.resolve()}if(this._connectionState===HubConnectionState.Disconnecting){this._logger.log(LogLevel.Debug,"Call to HttpConnection.stop(".concat(error,") ignored because the connection is already in the disconnecting state."));return this._stopPromise}this._connectionState=HubConnectionState.Disconnecting;this._logger.log(LogLevel.Debug,"Stopping HubConnection.");if(this._reconnectDelayHandle){this._logger.log(LogLevel.Debug,"Connection stopped during reconnect delay. Done reconnecting.");clearTimeout(this._reconnectDelayHandle);this._reconnectDelayHandle=undefined;this._completeClose();return Promise.resolve()}this._cleanupTimeout();this._cleanupPingTimer();this._stopDuringStartError=error||new AbortError("The connection was stopped before the hub handshake could complete.");return this.connection.stop(error)}},{key:"stream",value:function stream(methodName){var _this24=this;for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){args[_key3-1]=arguments[_key3]}var _this$_replaceStreami=this._replaceStreamingParams(args),_this$_replaceStreami2=_slicedToArray2(_this$_replaceStreami,2),streams=_this$_replaceStreami2[0],streamIds=_this$_replaceStreami2[1];var invocationDescriptor=this._createStreamInvocation(methodName,args,streamIds);var promiseQueue;var subject=new Subject;subject.cancelCallback=function(){var cancelInvocation=_this24._createCancelInvocation(invocationDescriptor.invocationId);delete _this24._callbacks[invocationDescriptor.invocationId];return promiseQueue.then(function(){return _this24._sendWithProtocol(cancelInvocation)})};this._callbacks[invocationDescriptor.invocationId]=function(invocationEvent,error){if(error){subject.error(error);return}else if(invocationEvent){if(invocationEvent.type===MessageType.Completion){if(invocationEvent.error){subject.error(new Error(invocationEvent.error))}else{subject.complete()}}else{subject.next(invocationEvent.item)}}};promiseQueue=this._sendWithProtocol(invocationDescriptor)["catch"](function(e){subject.error(e);delete _this24._callbacks[invocationDescriptor.invocationId]});this._launchStreams(streams,promiseQueue);return subject}},{key:"_sendMessage",value:function _sendMessage(message){this._resetKeepAliveInterval();return this.connection.send(message)}},{key:"_sendWithProtocol",value:function _sendWithProtocol(message){return this._sendMessage(this._protocol.writeMessage(message))}},{key:"send",value:function send(methodName){for(var _len4=arguments.length,args=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){args[_key4-1]=arguments[_key4]}var _this$_replaceStreami3=this._replaceStreamingParams(args),_this$_replaceStreami4=_slicedToArray2(_this$_replaceStreami3,2),streams=_this$_replaceStreami4[0],streamIds=_this$_replaceStreami4[1];var sendPromise=this._sendWithProtocol(this._createInvocation(methodName,args,true,streamIds));this._launchStreams(streams,sendPromise);return sendPromise}},{key:"invoke",value:function invoke(methodName){var _this25=this;for(var _len5=arguments.length,args=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){args[_key5-1]=arguments[_key5]}var _this$_replaceStreami5=this._replaceStreamingParams(args),_this$_replaceStreami6=_slicedToArray2(_this$_replaceStreami5,2),streams=_this$_replaceStreami6[0],streamIds=_this$_replaceStreami6[1];var invocationDescriptor=this._createInvocation(methodName,args,false,streamIds);var p=new Promise(function(resolve,reject){_this25._callbacks[invocationDescriptor.invocationId]=function(invocationEvent,error){if(error){reject(error);return}else if(invocationEvent){if(invocationEvent.type===MessageType.Completion){if(invocationEvent.error){reject(new Error(invocationEvent.error))}else{resolve(invocationEvent.result)}}else{reject(new Error("Unexpected message type: ".concat(invocationEvent.type)))}}};var promiseQueue=_this25._sendWithProtocol(invocationDescriptor)["catch"](function(e){reject(e);delete _this25._callbacks[invocationDescriptor.invocationId]});_this25._launchStreams(streams,promiseQueue)});return p}},{key:"on",value:function on(methodName,newMethod){if(!methodName||!newMethod){return}methodName=methodName.toLowerCase();if(!this._methods[methodName]){this._methods[methodName]=[]}if(this._methods[methodName].indexOf(newMethod)!==-1){return}this._methods[methodName].push(newMethod)}},{key:"off",value:function off(methodName,method){if(!methodName){return}methodName=methodName.toLowerCase();var handlers=this._methods[methodName];if(!handlers){return}if(method){var removeIdx=handlers.indexOf(method);if(removeIdx!==-1){handlers.splice(removeIdx,1);if(handlers.length===0){delete this._methods[methodName]}}}else{delete this._methods[methodName]}}},{key:"onclose",value:function onclose(callback){if(callback){this._closedCallbacks.push(callback)}}},{key:"onreconnecting",value:function onreconnecting(callback){if(callback){this._reconnectingCallbacks.push(callback)}}},{key:"onreconnected",value:function onreconnected(callback){if(callback){this._reconnectedCallbacks.push(callback)}}},{key:"_processIncomingData",value:function _processIncomingData(data){this._cleanupTimeout();if(!this._receivedHandshakeResponse){data=this._processHandshakeResponse(data);this._receivedHandshakeResponse=true}if(data){var messages=this._protocol.parseMessages(data,this._logger);var _iterator6=_createForOfIteratorHelper(messages),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var message=_step6.value;switch(message.type){case MessageType.Invocation:this._invokeClientMethod(message);break;case MessageType.StreamItem:case MessageType.Completion:{var callback=this._callbacks[message.invocationId];if(callback){if(message.type===MessageType.Completion){delete this._callbacks[message.invocationId]}try{callback(message)}catch(e){this._logger.log(LogLevel.Error,"Stream callback threw error: ".concat(getErrorString(e)))}}break}case MessageType.Ping:break;case MessageType.Close:{this._logger.log(LogLevel.Information,"Close message received from server.");var error=message.error?new Error("Server returned an error on close: "+message.error):undefined;if(message.allowReconnect===true){this.connection.stop(error)}else{this._stopPromise=this._stopInternal(error)}break}default:this._logger.log(LogLevel.Warning,"Invalid message type: ".concat(message.type,"."));break}}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}}this._resetTimeoutPeriod()}},{key:"_processHandshakeResponse",value:function _processHandshakeResponse(data){var responseMessage;var remainingData;try{var _this$_handshakeProto=this._handshakeProtocol.parseHandshakeResponse(data);var _this$_handshakeProto2=_slicedToArray2(_this$_handshakeProto,2);remainingData=_this$_handshakeProto2[0];responseMessage=_this$_handshakeProto2[1]}catch(e){var message="Error parsing handshake response: "+e;this._logger.log(LogLevel.Error,message);var error=new Error(message);this._handshakeRejecter(error);throw error}if(responseMessage.error){var _message2="Server returned handshake error: "+responseMessage.error;this._logger.log(LogLevel.Error,_message2);var _error=new Error(_message2);this._handshakeRejecter(_error);throw _error}else{this._logger.log(LogLevel.Debug,"Server handshake complete.")}this._handshakeResolver();return remainingData}},{key:"_resetKeepAliveInterval",value:function _resetKeepAliveInterval(){if(this.connection.features.inherentKeepAlive){return}this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds;this._cleanupPingTimer()}},{key:"_resetTimeoutPeriod",value:function _resetTimeoutPeriod(){var _this26=this;if(!this.connection.features||!this.connection.features.inherentKeepAlive){this._timeoutHandle=setTimeout(function(){return _this26.serverTimeout()},this.serverTimeoutInMilliseconds);if(this._pingServerHandle===undefined){var nextPing=this._nextKeepAlive-new Date().getTime();if(nextPing<0){nextPing=0}this._pingServerHandle=setTimeout(_asyncToGenerator(_regeneratorRuntime().mark(function _callee5(){return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(!(_this26._connectionState===HubConnectionState.Connected)){_context5.next=9;break}_context5.prev=1;_context5.next=4;return _this26._sendMessage(_this26._cachedPingMessage);case 4:_context5.next=9;break;case 6:_context5.prev=6;_context5.t0=_context5["catch"](1);_this26._cleanupPingTimer();case 9:case"end":return _context5.stop()}},_callee5,null,[[1,6]])})),nextPing)}}}},{key:"serverTimeout",value:function serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}},{key:"_invokeClientMethod",value:function(){var _invokeClientMethod2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee6(invocationMessage){var methodName,methods,methodsCopy,expectsResponse,res,exception,completionMessage,_iterator7,_step7,m,prevRes;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:methodName=invocationMessage.target.toLowerCase();methods=this._methods[methodName];if(methods){_context6.next=9;break}this._logger.log(LogLevel.Warning,"No client method with the name '".concat(methodName,"' found."));if(!invocationMessage.invocationId){_context6.next=8;break}this._logger.log(LogLevel.Warning,"No result given for '".concat(methodName,"' method and invocation ID '").concat(invocationMessage.invocationId,"'."));_context6.next=8;return this._sendWithProtocol(this._createCompletionMessage(invocationMessage.invocationId,"Client didn't provide a result.",null));case 8:return _context6.abrupt("return");case 9:methodsCopy=methods.slice();expectsResponse=invocationMessage.invocationId?true:false;_iterator7=_createForOfIteratorHelper(methodsCopy);_context6.prev=12;_iterator7.s();case 14:if((_step7=_iterator7.n()).done){_context6.next=31;break}m=_step7.value;_context6.prev=16;prevRes=res;_context6.next=20;return m.apply(this,invocationMessage.arguments);case 20:res=_context6.sent;if(expectsResponse&&res&&prevRes){this._logger.log(LogLevel.Error,"Multiple results provided for '".concat(methodName,"'. Sending error to server."));completionMessage=this._createCompletionMessage(invocationMessage.invocationId,"Client provided multiple results.",null)}exception=undefined;_context6.next=29;break;case 25:_context6.prev=25;_context6.t0=_context6["catch"](16);exception=_context6.t0;this._logger.log(LogLevel.Error,"A callback for the method '".concat(methodName,"' threw error '").concat(_context6.t0,"'."));case 29:_context6.next=14;break;case 31:_context6.next=36;break;case 33:_context6.prev=33;_context6.t1=_context6["catch"](12);_iterator7.e(_context6.t1);case 36:_context6.prev=36;_iterator7.f();return _context6.finish(36);case 39:if(!completionMessage){_context6.next=44;break}_context6.next=42;return this._sendWithProtocol(completionMessage);case 42:_context6.next=51;break;case 44:if(!expectsResponse){_context6.next=50;break}if(exception){completionMessage=this._createCompletionMessage(invocationMessage.invocationId,"".concat(exception),null)}else if(res!==undefined){completionMessage=this._createCompletionMessage(invocationMessage.invocationId,null,res)}else{this._logger.log(LogLevel.Warning,"No result given for '".concat(methodName,"' method and invocation ID '").concat(invocationMessage.invocationId,"'."));completionMessage=this._createCompletionMessage(invocationMessage.invocationId,"Client didn't provide a result.",null)}_context6.next=48;return this._sendWithProtocol(completionMessage);case 48:_context6.next=51;break;case 50:if(res){this._logger.log(LogLevel.Error,"Result given for '".concat(methodName,"' method but server is not expecting a result."))}case 51:case"end":return _context6.stop()}},_callee6,this,[[12,33,36,39],[16,25]])}));function _invokeClientMethod(_x9){return _invokeClientMethod2.apply(this,arguments)}return _invokeClientMethod}()},{key:"_connectionClosed",value:function _connectionClosed(error){this._logger.log(LogLevel.Debug,"HubConnection.connectionClosed(".concat(error,") called while in state ").concat(this._connectionState,"."));this._stopDuringStartError=this._stopDuringStartError||error||new AbortError("The underlying connection was closed before the hub handshake could complete.");if(this._handshakeResolver){this._handshakeResolver()}this._cancelCallbacksWithError(error||new Error("Invocation canceled due to the underlying connection being closed."));this._cleanupTimeout();this._cleanupPingTimer();if(this._connectionState===HubConnectionState.Disconnecting){this._completeClose(error)}else if(this._connectionState===HubConnectionState.Connected&&this._reconnectPolicy){this._reconnect(error)}else if(this._connectionState===HubConnectionState.Connected){this._completeClose(error)}}},{key:"_completeClose",value:function _completeClose(error){var _this27=this;if(this._connectionStarted){this._connectionState=HubConnectionState.Disconnected;this._connectionStarted=false;if(Platform.isBrowser){window.document.removeEventListener("freeze",this._freezeEventListener)}try{this._closedCallbacks.forEach(function(c){return c.apply(_this27,[error])})}catch(e){this._logger.log(LogLevel.Error,"An onclose callback called with error '".concat(error,"' threw error '").concat(e,"'."))}}}},{key:"_reconnect",value:function(){var _reconnect2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee7(error){var _this28=this;var reconnectStartTime,previousReconnectAttempts,retryError,nextRetryDelay;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:reconnectStartTime=Date.now();previousReconnectAttempts=0;retryError=error!==undefined?error:new Error("Attempting to reconnect due to a unknown error.");nextRetryDelay=this._getNextRetryDelay(previousReconnectAttempts++,0,retryError);if(!(nextRetryDelay===null)){_context7.next=8;break}this._logger.log(LogLevel.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.");this._completeClose(error);return _context7.abrupt("return");case 8:this._connectionState=HubConnectionState.Reconnecting;if(error){this._logger.log(LogLevel.Information,"Connection reconnecting because of error '".concat(error,"'."))}else{this._logger.log(LogLevel.Information,"Connection reconnecting.")}if(!(this._reconnectingCallbacks.length!==0)){_context7.next=15;break}try{this._reconnectingCallbacks.forEach(function(c){return c.apply(_this28,[error])})}catch(e){this._logger.log(LogLevel.Error,"An onreconnecting callback called with error '".concat(error,"' threw error '").concat(e,"'."))}if(!(this._connectionState!==HubConnectionState.Reconnecting)){_context7.next=15;break}this._logger.log(LogLevel.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return _context7.abrupt("return");case 15:if(!(nextRetryDelay!==null)){_context7.next=43;break}this._logger.log(LogLevel.Information,"Reconnect attempt number ".concat(previousReconnectAttempts," will start in ").concat(nextRetryDelay," ms."));_context7.next=19;return new Promise(function(resolve){_this28._reconnectDelayHandle=setTimeout(resolve,nextRetryDelay)});case 19:this._reconnectDelayHandle=undefined;if(!(this._connectionState!==HubConnectionState.Reconnecting)){_context7.next=23;break}this._logger.log(LogLevel.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return _context7.abrupt("return");case 23:_context7.prev=23;_context7.next=26;return this._startInternal();case 26:this._connectionState=HubConnectionState.Connected;this._logger.log(LogLevel.Information,"HubConnection reconnected successfully.");if(this._reconnectedCallbacks.length!==0){try{this._reconnectedCallbacks.forEach(function(c){return c.apply(_this28,[_this28.connection.connectionId])})}catch(e){this._logger.log(LogLevel.Error,"An onreconnected callback called with connectionId '".concat(this.connection.connectionId,"; threw error '").concat(e,"'."))}}return _context7.abrupt("return");case 32:_context7.prev=32;_context7.t0=_context7["catch"](23);this._logger.log(LogLevel.Information,"Reconnect attempt failed because of error '".concat(_context7.t0,"'."));if(!(this._connectionState!==HubConnectionState.Reconnecting)){_context7.next=39;break}this._logger.log(LogLevel.Debug,"Connection moved to the '".concat(this._connectionState,"' from the reconnecting state during reconnect attempt. Done reconnecting."));if(this._connectionState===HubConnectionState.Disconnecting){this._completeClose()}return _context7.abrupt("return");case 39:retryError=_context7.t0 instanceof Error?_context7.t0:new Error(_context7.t0.toString());nextRetryDelay=this._getNextRetryDelay(previousReconnectAttempts++,Date.now()-reconnectStartTime,retryError);case 41:_context7.next=15;break;case 43:this._logger.log(LogLevel.Information,"Reconnect retries have been exhausted after ".concat(Date.now()-reconnectStartTime," ms and ").concat(previousReconnectAttempts," failed attempts. Connection disconnecting."));this._completeClose();case 45:case"end":return _context7.stop()}},_callee7,this,[[23,32]])}));function _reconnect(_x10){return _reconnect2.apply(this,arguments)}return _reconnect}()},{key:"_getNextRetryDelay",value:function _getNextRetryDelay(previousRetryCount,elapsedMilliseconds,retryReason){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:elapsedMilliseconds,previousRetryCount:previousRetryCount,retryReason:retryReason})}catch(e){this._logger.log(LogLevel.Error,"IRetryPolicy.nextRetryDelayInMilliseconds(".concat(previousRetryCount,", ").concat(elapsedMilliseconds,") threw error '").concat(e,"'."));return null}}},{key:"_cancelCallbacksWithError",value:function _cancelCallbacksWithError(error){var _this29=this;var callbacks=this._callbacks;this._callbacks={};Object.keys(callbacks).forEach(function(key){var callback=callbacks[key];try{callback(null,error)}catch(e){_this29._logger.log(LogLevel.Error,"Stream 'error' callback called with '".concat(error,"' threw error: ").concat(getErrorString(e)))}})}},{key:"_cleanupPingTimer",value:function _cleanupPingTimer(){if(this._pingServerHandle){clearTimeout(this._pingServerHandle);this._pingServerHandle=undefined}}},{key:"_cleanupTimeout",value:function _cleanupTimeout(){if(this._timeoutHandle){clearTimeout(this._timeoutHandle)}}},{key:"_createInvocation",value:function _createInvocation(methodName,args,nonblocking,streamIds){if(nonblocking){if(streamIds.length!==0){return{arguments:args,streamIds:streamIds,target:methodName,type:MessageType.Invocation}}else{return{arguments:args,target:methodName,type:MessageType.Invocation}}}else{var invocationId=this._invocationId;this._invocationId++;if(streamIds.length!==0){return{arguments:args,invocationId:invocationId.toString(),streamIds:streamIds,target:methodName,type:MessageType.Invocation}}else{return{arguments:args,invocationId:invocationId.toString(),target:methodName,type:MessageType.Invocation}}}}},{key:"_launchStreams",value:function _launchStreams(streams,promiseQueue){var _this30=this;if(streams.length===0){return}if(!promiseQueue){promiseQueue=Promise.resolve()}var _loop2=function _loop2(streamId){streams[streamId].subscribe({complete:function complete(){promiseQueue=promiseQueue.then(function(){return _this30._sendWithProtocol(_this30._createCompletionMessage(streamId))})},error:function error(err){var message;if(err instanceof Error){message=err.message}else if(err&&err.toString){message=err.toString()}else{message="Unknown error"}promiseQueue=promiseQueue.then(function(){return _this30._sendWithProtocol(_this30._createCompletionMessage(streamId,message))})},next:function next(item){promiseQueue=promiseQueue.then(function(){return _this30._sendWithProtocol(_this30._createStreamItemMessage(streamId,item))})}})};for(var streamId in streams){_loop2(streamId)}}},{key:"_replaceStreamingParams",value:function _replaceStreamingParams(args){var streams=[];var streamIds=[];for(var _i3=0;_i3<args.length;_i3++){var argument=args[_i3];if(this._isObservable(argument)){var streamId=this._invocationId;this._invocationId++;streams[streamId]=argument;streamIds.push(streamId.toString());args.splice(_i3,1)}}return[streams,streamIds]}},{key:"_isObservable",value:function _isObservable(arg){return arg&&arg.subscribe&&typeof arg.subscribe==="function"}},{key:"_createStreamInvocation",value:function _createStreamInvocation(methodName,args,streamIds){var invocationId=this._invocationId;this._invocationId++;if(streamIds.length!==0){return{arguments:args,invocationId:invocationId.toString(),streamIds:streamIds,target:methodName,type:MessageType.StreamInvocation}}else{return{arguments:args,invocationId:invocationId.toString(),target:methodName,type:MessageType.StreamInvocation}}}},{key:"_createCancelInvocation",value:function _createCancelInvocation(id){return{invocationId:id,type:MessageType.CancelInvocation}}},{key:"_createStreamItemMessage",value:function _createStreamItemMessage(id,item){return{invocationId:id,item:item,type:MessageType.StreamItem}}},{key:"_createCompletionMessage",value:function _createCompletionMessage(id,error,result){if(error){return{error:error,invocationId:id,type:MessageType.Completion}}return{invocationId:id,result:result,type:MessageType.Completion}}}],[{key:"create",value:function create(connection,logger,protocol,reconnectPolicy){return new HubConnection(connection,logger,protocol,reconnectPolicy)}}]);return HubConnection}();var DEFAULT_RETRY_DELAYS_IN_MILLISECONDS=[0,2000,10000,30000,null];var DefaultReconnectPolicy=function(){function DefaultReconnectPolicy(retryDelays){_classCallCheck2(this,DefaultReconnectPolicy);this._retryDelays=retryDelays!==undefined?[].concat(_toConsumableArray2(retryDelays),[null]):DEFAULT_RETRY_DELAYS_IN_MILLISECONDS}_createClass2(DefaultReconnectPolicy,[{key:"nextRetryDelayInMilliseconds",value:function nextRetryDelayInMilliseconds(retryContext){return this._retryDelays[retryContext.previousRetryCount]}}]);return DefaultReconnectPolicy}();var HeaderNames=_createClass2(function HeaderNames(){_classCallCheck2(this,HeaderNames)});HeaderNames.Authorization="Authorization";HeaderNames.Cookie="Cookie";var AccessTokenHttpClient=function(_HttpClient4){_inherits2(AccessTokenHttpClient,_HttpClient4);var _super12=_createSuper(AccessTokenHttpClient);function AccessTokenHttpClient(innerClient,accessTokenFactory){var _this31;_classCallCheck2(this,AccessTokenHttpClient);_this31=_super12.call(this);_this31._innerClient=innerClient;_this31._accessTokenFactory=accessTokenFactory;return _this31}_createClass2(AccessTokenHttpClient,[{key:"send",value:function(){var _send2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee8(request){var allowRetry,response;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:allowRetry=true;if(!(this._accessTokenFactory&&(!this._accessToken||request.url&&request.url.indexOf("/negotiate?")>0))){_context8.next=6;break}allowRetry=false;_context8.next=5;return this._accessTokenFactory();case 5:this._accessToken=_context8.sent;case 6:this._setAuthorizationHeader(request);_context8.next=9;return this._innerClient.send(request);case 9:response=_context8.sent;if(!(allowRetry&&response.statusCode===401&&this._accessTokenFactory)){_context8.next=18;break}_context8.next=13;return this._accessTokenFactory();case 13:this._accessToken=_context8.sent;this._setAuthorizationHeader(request);_context8.next=17;return this._innerClient.send(request);case 17:return _context8.abrupt("return",_context8.sent);case 18:return _context8.abrupt("return",response);case 19:case"end":return _context8.stop()}},_callee8,this)}));function send(_x11){return _send2.apply(this,arguments)}return send}()},{key:"_setAuthorizationHeader",value:function _setAuthorizationHeader(request){if(!request.headers){request.headers={}}if(this._accessToken){request.headers[HeaderNames.Authorization]="Bearer ".concat(this._accessToken)}else if(this._accessTokenFactory){if(request.headers[HeaderNames.Authorization]){delete request.headers[HeaderNames.Authorization]}}}},{key:"getCookieString",value:function getCookieString(url){return this._innerClient.getCookieString(url)}}]);return AccessTokenHttpClient}(HttpClient);var HttpTransportType;(function(HttpTransportType){HttpTransportType[HttpTransportType["None"]=0]="None";HttpTransportType[HttpTransportType["WebSockets"]=1]="WebSockets";HttpTransportType[HttpTransportType["ServerSentEvents"]=2]="ServerSentEvents";HttpTransportType[HttpTransportType["LongPolling"]=4]="LongPolling"})(HttpTransportType||(HttpTransportType={}));var TransferFormat;(function(TransferFormat){TransferFormat[TransferFormat["Text"]=1]="Text";TransferFormat[TransferFormat["Binary"]=2]="Binary"})(TransferFormat||(TransferFormat={}));var AbortController$1=function(){function AbortController(){_classCallCheck2(this,AbortController);this._isAborted=false;this.onabort=null}_createClass2(AbortController,[{key:"abort",value:function abort(){if(!this._isAborted){this._isAborted=true;if(this.onabort){this.onabort()}}}},{key:"signal",get:function get(){return this}},{key:"aborted",get:function get(){return this._isAborted}}]);return AbortController}();var LongPollingTransport=function(){function LongPollingTransport(httpClient,logger,options){_classCallCheck2(this,LongPollingTransport);this._httpClient=httpClient;this._logger=logger;this._pollAbort=new AbortController$1;this._options=options;this._running=false;this.onreceive=null;this.onclose=null}_createClass2(LongPollingTransport,[{key:"pollAborted",get:function get(){return this._pollAbort.aborted}},{key:"connect",value:function(){var _connect=_asyncToGenerator(_regeneratorRuntime().mark(function _callee9(url,transferFormat){var _getUserAgentHeader,_getUserAgentHeader2,name,value,headers,pollOptions,pollUrl,response;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:Arg.isRequired(url,"url");Arg.isRequired(transferFormat,"transferFormat");Arg.isIn(transferFormat,TransferFormat,"transferFormat");this._url=url;this._logger.log(LogLevel.Trace,"(LongPolling transport) Connecting.");if(!(transferFormat===TransferFormat.Binary&&typeof XMLHttpRequest!=="undefined"&&typeof new XMLHttpRequest().responseType!=="string")){_context9.next=7;break}throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");case 7:_getUserAgentHeader=getUserAgentHeader(),_getUserAgentHeader2=_slicedToArray2(_getUserAgentHeader,2),name=_getUserAgentHeader2[0],value=_getUserAgentHeader2[1];headers=_objectSpread2(_defineProperty2({},name,value),this._options.headers);pollOptions={abortSignal:this._pollAbort.signal,headers:headers,timeout:100000,withCredentials:this._options.withCredentials};if(transferFormat===TransferFormat.Binary){pollOptions.responseType="arraybuffer"}pollUrl="".concat(url,"&_=").concat(Date.now());this._logger.log(LogLevel.Trace,"(LongPolling transport) polling: ".concat(pollUrl,"."));_context9.next=15;return this._httpClient.get(pollUrl,pollOptions);case 15:response=_context9.sent;if(response.statusCode!==200){this._logger.log(LogLevel.Error,"(LongPolling transport) Unexpected response code: ".concat(response.statusCode,"."));this._closeError=new HttpError(response.statusText||"",response.statusCode);this._running=false}else{this._running=true}this._receiving=this._poll(this._url,pollOptions);case 18:case"end":return _context9.stop()}},_callee9,this)}));function connect(_x12,_x13){return _connect.apply(this,arguments)}return connect}()},{key:"_poll",value:function(){var _poll2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee10(url,pollOptions){var pollUrl,response;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:_context10.prev=0;case 1:if(!this._running){_context10.next=16;break}_context10.prev=2;pollUrl="".concat(url,"&_=").concat(Date.now());this._logger.log(LogLevel.Trace,"(LongPolling transport) polling: ".concat(pollUrl,"."));_context10.next=7;return this._httpClient.get(pollUrl,pollOptions);case 7:response=_context10.sent;if(response.statusCode===204){this._logger.log(LogLevel.Information,"(LongPolling transport) Poll terminated by server.");this._running=false}else if(response.statusCode!==200){this._logger.log(LogLevel.Error,"(LongPolling transport) Unexpected response code: ".concat(response.statusCode,"."));this._closeError=new HttpError(response.statusText||"",response.statusCode);this._running=false}else{if(response.content){this._logger.log(LogLevel.Trace,"(LongPolling transport) data received. ".concat(getDataDetail(response.content,this._options.logMessageContent),"."));if(this.onreceive){this.onreceive(response.content)}}else{this._logger.log(LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing.")}}_context10.next=14;break;case 11:_context10.prev=11;_context10.t0=_context10["catch"](2);if(!this._running){this._logger.log(LogLevel.Trace,"(LongPolling transport) Poll errored after shutdown: ".concat(_context10.t0.message))}else{if(_context10.t0 instanceof TimeoutError){this._logger.log(LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing.")}else{this._closeError=_context10.t0;this._running=false}}case 14:_context10.next=1;break;case 16:_context10.prev=16;this._logger.log(LogLevel.Trace,"(LongPolling transport) Polling complete.");if(!this.pollAborted){this._raiseOnClose()}return _context10.finish(16);case 20:case"end":return _context10.stop()}},_callee10,this,[[0,,16,20],[2,11]])}));function _poll(_x14,_x15){return _poll2.apply(this,arguments)}return _poll}()},{key:"send",value:function(){var _send3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee11(data){return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:if(this._running){_context11.next=2;break}return _context11.abrupt("return",Promise.reject(new Error("Cannot send until the transport is connected")));case 2:return _context11.abrupt("return",sendMessage(this._logger,"LongPolling",this._httpClient,this._url,data,this._options));case 3:case"end":return _context11.stop()}},_callee11,this)}));function send(_x16){return _send3.apply(this,arguments)}return send}()},{key:"stop",value:function(){var _stop2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee12(){var headers,_getUserAgentHeader3,_getUserAgentHeader4,_name,value,deleteOptions;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:this._logger.log(LogLevel.Trace,"(LongPolling transport) Stopping polling.");this._running=false;this._pollAbort.abort();_context12.prev=3;_context12.next=6;return this._receiving;case 6:this._logger.log(LogLevel.Trace,"(LongPolling transport) sending DELETE request to ".concat(this._url,"."));headers={};_getUserAgentHeader3=getUserAgentHeader(),_getUserAgentHeader4=_slicedToArray2(_getUserAgentHeader3,2),_name=_getUserAgentHeader4[0],value=_getUserAgentHeader4[1];headers[_name]=value;deleteOptions={headers:_objectSpread2(_objectSpread2({},headers),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials};_context12.next=13;return this._httpClient["delete"](this._url,deleteOptions);case 13:this._logger.log(LogLevel.Trace,"(LongPolling transport) DELETE request sent.");case 14:_context12.prev=14;this._logger.log(LogLevel.Trace,"(LongPolling transport) Stop finished.");this._raiseOnClose();return _context12.finish(14);case 18:case"end":return _context12.stop()}},_callee12,this,[[3,,14,18]])}));function stop(){return _stop2.apply(this,arguments)}return stop}()},{key:"_raiseOnClose",value:function _raiseOnClose(){if(this.onclose){var logMessage="(LongPolling transport) Firing onclose event.";if(this._closeError){logMessage+=" Error: "+this._closeError}this._logger.log(LogLevel.Trace,logMessage);this.onclose(this._closeError)}}}]);return LongPollingTransport}();var ServerSentEventsTransport=function(){function ServerSentEventsTransport(httpClient,accessToken,logger,options){_classCallCheck2(this,ServerSentEventsTransport);this._httpClient=httpClient;this._accessToken=accessToken;this._logger=logger;this._options=options;this.onreceive=null;this.onclose=null}_createClass2(ServerSentEventsTransport,[{key:"connect",value:function(){var _connect2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee13(url,transferFormat){var _this32=this;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:Arg.isRequired(url,"url");Arg.isRequired(transferFormat,"transferFormat");Arg.isIn(transferFormat,TransferFormat,"transferFormat");this._logger.log(LogLevel.Trace,"(SSE transport) Connecting.");this._url=url;if(this._accessToken){url+=(url.indexOf("?")<0?"?":"&")+"access_token=".concat(encodeURIComponent(this._accessToken))}return _context13.abrupt("return",new Promise(function(resolve,reject){var opened=false;if(transferFormat!==TransferFormat.Text){reject(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}var eventSource;if(Platform.isBrowser||Platform.isWebWorker){eventSource=new _this32._options.EventSource(url,{withCredentials:_this32._options.withCredentials})}else{var cookies=_this32._httpClient.getCookieString(url);var headers={};headers.Cookie=cookies;var _getUserAgentHeader5=getUserAgentHeader(),_getUserAgentHeader6=_slicedToArray2(_getUserAgentHeader5,2),_name2=_getUserAgentHeader6[0],value=_getUserAgentHeader6[1];headers[_name2]=value;eventSource=new _this32._options.EventSource(url,{withCredentials:_this32._options.withCredentials,headers:_objectSpread2(_objectSpread2({},headers),_this32._options.headers)})}try{eventSource.onmessage=function(e){if(_this32.onreceive){try{_this32._logger.log(LogLevel.Trace,"(SSE transport) data received. ".concat(getDataDetail(e.data,_this32._options.logMessageContent),"."));_this32.onreceive(e.data)}catch(error){_this32._close(error);return}}};eventSource.onerror=function(e){if(opened){_this32._close()}else{reject(new Error("EventSource failed to connect. The connection could not be found on the server,"+" either the connection ID is not present on the server, or a proxy is refusing/buffering the connection."+" If you have multiple servers check that sticky sessions are enabled."))}};eventSource.onopen=function(){_this32._logger.log(LogLevel.Information,"SSE connected to ".concat(_this32._url));_this32._eventSource=eventSource;opened=true;resolve()}}catch(e){reject(e);return}}));case 7:case"end":return _context13.stop()}},_callee13,this)}));function connect(_x17,_x18){return _connect2.apply(this,arguments)}return connect}()},{key:"send",value:function(){var _send4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee14(data){return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:if(this._eventSource){_context14.next=2;break}return _context14.abrupt("return",Promise.reject(new Error("Cannot send until the transport is connected")));case 2:return _context14.abrupt("return",sendMessage(this._logger,"SSE",this._httpClient,this._url,data,this._options));case 3:case"end":return _context14.stop()}},_callee14,this)}));function send(_x19){return _send4.apply(this,arguments)}return send}()},{key:"stop",value:function stop(){this._close();return Promise.resolve()}},{key:"_close",value:function _close(e){if(this._eventSource){this._eventSource.close();this._eventSource=undefined;if(this.onclose){this.onclose(e)}}}}]);return ServerSentEventsTransport}();var WebSocketTransport=function(){function WebSocketTransport(httpClient,accessTokenFactory,logger,logMessageContent,webSocketConstructor,headers){_classCallCheck2(this,WebSocketTransport);this._logger=logger;this._accessTokenFactory=accessTokenFactory;this._logMessageContent=logMessageContent;this._webSocketConstructor=webSocketConstructor;this._httpClient=httpClient;this.onreceive=null;this.onclose=null;this._headers=headers}_createClass2(WebSocketTransport,[{key:"connect",value:function(){var _connect3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee15(url,transferFormat){var _this33=this;var token;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:Arg.isRequired(url,"url");Arg.isRequired(transferFormat,"transferFormat");Arg.isIn(transferFormat,TransferFormat,"transferFormat");this._logger.log(LogLevel.Trace,"(WebSockets transport) Connecting.");if(!this._accessTokenFactory){_context15.next=8;break}_context15.next=7;return this._accessTokenFactory();case 7:token=_context15.sent;case 8:return _context15.abrupt("return",new Promise(function(resolve,reject){url=url.replace(/^http/,"ws");var webSocket;var cookies=_this33._httpClient.getCookieString(url);var opened=false;if(Platform.isNode||Platform.isReactNative){var headers={};var _getUserAgentHeader7=getUserAgentHeader(),_getUserAgentHeader8=_slicedToArray2(_getUserAgentHeader7,2),_name3=_getUserAgentHeader8[0],value=_getUserAgentHeader8[1];headers[_name3]=value;if(token){headers[HeaderNames.Authorization]="Bearer ".concat(token)}if(cookies){headers[HeaderNames.Cookie]=cookies}webSocket=new _this33._webSocketConstructor(url,undefined,{headers:_objectSpread2(_objectSpread2({},headers),_this33._headers)})}else{if(token){url+=(url.indexOf("?")<0?"?":"&")+"access_token=".concat(encodeURIComponent(token))}}if(!webSocket){webSocket=new _this33._webSocketConstructor(url)}if(transferFormat===TransferFormat.Binary){webSocket.binaryType="arraybuffer"}webSocket.onopen=function(_event){_this33._logger.log(LogLevel.Information,"WebSocket connected to ".concat(url,"."));_this33._webSocket=webSocket;opened=true;resolve()};webSocket.onerror=function(event){var error=null;if(typeof ErrorEvent!=="undefined"&&event instanceof ErrorEvent){error=event.error}else{error="There was an error with the transport"}_this33._logger.log(LogLevel.Information,"(WebSockets transport) ".concat(error,"."))};webSocket.onmessage=function(message){_this33._logger.log(LogLevel.Trace,"(WebSockets transport) data received. ".concat(getDataDetail(message.data,_this33._logMessageContent),"."));if(_this33.onreceive){try{_this33.onreceive(message.data)}catch(error){_this33._close(error);return}}};webSocket.onclose=function(event){if(opened){_this33._close(event)}else{var error=null;if(typeof ErrorEvent!=="undefined"&&event instanceof ErrorEvent){error=event.error}else{error="WebSocket failed to connect. The connection could not be found on the server,"+" either the endpoint may not be a SignalR endpoint,"+" the connection ID is not present on the server, or there is a proxy blocking WebSockets."+" If you have multiple servers check that sticky sessions are enabled."}reject(new Error(error))}}}));case 9:case"end":return _context15.stop()}},_callee15,this)}));function connect(_x20,_x21){return _connect3.apply(this,arguments)}return connect}()},{key:"send",value:function send(data){if(this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN){this._logger.log(LogLevel.Trace,"(WebSockets transport) sending data. ".concat(getDataDetail(data,this._logMessageContent),"."));this._webSocket.send(data);return Promise.resolve()}return Promise.reject("WebSocket is not in the OPEN state")}},{key:"stop",value:function stop(){if(this._webSocket){this._close(undefined)}return Promise.resolve()}},{key:"_close",value:function _close(event){if(this._webSocket){this._webSocket.onclose=function(){};this._webSocket.onmessage=function(){};this._webSocket.onerror=function(){};this._webSocket.close();this._webSocket=undefined}this._logger.log(LogLevel.Trace,"(WebSockets transport) socket closed.");if(this.onclose){if(this._isCloseEvent(event)&&(event.wasClean===false||event.code!==1000)){this.onclose(new Error("WebSocket closed with status code: ".concat(event.code," (").concat(event.reason||"no reason given",").")))}else if(event instanceof Error){this.onclose(event)}else{this.onclose()}}}},{key:"_isCloseEvent",value:function _isCloseEvent(event){return event&&typeof event.wasClean==="boolean"&&typeof event.code==="number"}}]);return WebSocketTransport}();var MAX_REDIRECTS=100;var HttpConnection=function(){function HttpConnection(url){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck2(this,HttpConnection);this._stopPromiseResolver=function(){};this.features={};this._negotiateVersion=1;Arg.isRequired(url,"url");this._logger=createLogger(options.logger);this.baseUrl=this._resolveUrl(url);options=options||{};options.logMessageContent=options.logMessageContent===undefined?false:options.logMessageContent;if(typeof options.withCredentials==="boolean"||options.withCredentials===undefined){options.withCredentials=options.withCredentials===undefined?true:options.withCredentials}else{throw new Error("withCredentials option was not a 'boolean' or 'undefined' value")}options.timeout=options.timeout===undefined?100*1000:options.timeout;var webSocketModule=null;var eventSourceModule=null;if(Platform.isNode&&typeof require!=="undefined"){var requireFunc=typeof __webpack_require__==="function"?__non_webpack_require__:require;webSocketModule=requireFunc("ws");eventSourceModule=requireFunc("eventsource")}if(!Platform.isNode&&typeof WebSocket!=="undefined"&&!options.WebSocket){options.WebSocket=WebSocket}else if(Platform.isNode&&!options.WebSocket){if(webSocketModule){options.WebSocket=webSocketModule}}if(!Platform.isNode&&typeof EventSource!=="undefined"&&!options.EventSource){options.EventSource=EventSource}else if(Platform.isNode&&!options.EventSource){if(typeof eventSourceModule!=="undefined"){options.EventSource=eventSourceModule}}this._httpClient=new AccessTokenHttpClient(options.httpClient||new DefaultHttpClient(this._logger),options.accessTokenFactory);this._connectionState="Disconnected";this._connectionStarted=false;this._options=options;this.onreceive=null;this.onclose=null}_createClass2(HttpConnection,[{key:"start",value:function(){var _start2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee16(transferFormat){var message,_message3;return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:transferFormat=transferFormat||TransferFormat.Binary;Arg.isIn(transferFormat,TransferFormat,"transferFormat");this._logger.log(LogLevel.Debug,"Starting connection with transfer format '".concat(TransferFormat[transferFormat],"'."));if(!(this._connectionState!=="Disconnected")){_context16.next=5;break}return _context16.abrupt("return",Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state.")));case 5:this._connectionState="Connecting";this._startInternalPromise=this._startInternal(transferFormat);_context16.next=9;return this._startInternalPromise;case 9:if(!(this._connectionState==="Disconnecting")){_context16.next=17;break}message="Failed to start the HttpConnection before stop() was called.";this._logger.log(LogLevel.Error,message);_context16.next=14;return this._stopPromise;case 14:return _context16.abrupt("return",Promise.reject(new AbortError(message)));case 17:if(!(this._connectionState!=="Connected")){_context16.next=21;break}_message3="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";this._logger.log(LogLevel.Error,_message3);return _context16.abrupt("return",Promise.reject(new AbortError(_message3)));case 21:this._connectionStarted=true;case 22:case"end":return _context16.stop()}},_callee16,this)}));function start(_x22){return _start2.apply(this,arguments)}return start}()},{key:"send",value:function send(data){if(this._connectionState!=="Connected"){return Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State."))}if(!this._sendQueue){this._sendQueue=new TransportSendQueue(this.transport)}return this._sendQueue.send(data)}},{key:"stop",value:function(){var _stop3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee17(error){var _this34=this;return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:if(!(this._connectionState==="Disconnected")){_context17.next=3;break}this._logger.log(LogLevel.Debug,"Call to HttpConnection.stop(".concat(error,") ignored because the connection is already in the disconnected state."));return _context17.abrupt("return",Promise.resolve());case 3:if(!(this._connectionState==="Disconnecting")){_context17.next=6;break}this._logger.log(LogLevel.Debug,"Call to HttpConnection.stop(".concat(error,") ignored because the connection is already in the disconnecting state."));return _context17.abrupt("return",this._stopPromise);case 6:this._connectionState="Disconnecting";this._stopPromise=new Promise(function(resolve){_this34._stopPromiseResolver=resolve});_context17.next=10;return this._stopInternal(error);case 10:_context17.next=12;return this._stopPromise;case 12:case"end":return _context17.stop()}},_callee17,this)}));function stop(_x23){return _stop3.apply(this,arguments)}return stop}()},{key:"_stopInternal",value:function(){var _stopInternal2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee18(error){return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1)switch(_context18.prev=_context18.next){case 0:this._stopError=error;_context18.prev=1;_context18.next=4;return this._startInternalPromise;case 4:_context18.next=8;break;case 6:_context18.prev=6;_context18.t0=_context18["catch"](1);case 8:if(!this.transport){_context18.next=21;break}_context18.prev=9;_context18.next=12;return this.transport.stop();case 12:_context18.next=18;break;case 14:_context18.prev=14;_context18.t1=_context18["catch"](9);this._logger.log(LogLevel.Error,"HttpConnection.transport.stop() threw error '".concat(_context18.t1,"'."));this._stopConnection();case 18:this.transport=undefined;_context18.next=22;break;case 21:this._logger.log(LogLevel.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.");case 22:case"end":return _context18.stop()}},_callee18,this,[[1,6],[9,14]])}));function _stopInternal(_x24){return _stopInternal2.apply(this,arguments)}return _stopInternal}()},{key:"_startInternal",value:function(){var _startInternal3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee19(transferFormat){var _this35=this;var url,negotiateResponse,redirects,_loop3;return _regeneratorRuntime().wrap(function _callee19$(_context20){while(1)switch(_context20.prev=_context20.next){case 0:url=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory;this._httpClient._accessTokenFactory=this._accessTokenFactory;_context20.prev=3;if(!this._options.skipNegotiation){_context20.next=14;break}if(!(this._options.transport===HttpTransportType.WebSockets)){_context20.next=11;break}this.transport=this._constructTransport(HttpTransportType.WebSockets);_context20.next=9;return this._startTransport(url,transferFormat);case 9:_context20.next=12;break;case 11:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 12:_context20.next=23;break;case 14:negotiateResponse=null;redirects=0;_loop3=_regeneratorRuntime().mark(function _loop3(){var accessToken;return _regeneratorRuntime().wrap(function _loop3$(_context19){while(1)switch(_context19.prev=_context19.next){case 0:_context19.next=2;return _this35._getNegotiationResponse(url);case 2:negotiateResponse=_context19.sent;if(!(_this35._connectionState==="Disconnecting"||_this35._connectionState==="Disconnected")){_context19.next=5;break}throw new AbortError("The connection was stopped during negotiation.");case 5:if(!negotiateResponse.error){_context19.next=7;break}throw new Error(negotiateResponse.error);case 7:if(!negotiateResponse.ProtocolVersion){_context19.next=9;break}throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");case 9:if(negotiateResponse.url){url=negotiateResponse.url}if(negotiateResponse.accessToken){accessToken=negotiateResponse.accessToken;_this35._accessTokenFactory=function(){return accessToken};_this35._httpClient._accessToken=accessToken;_this35._httpClient._accessTokenFactory=undefined}redirects++;case 12:case"end":return _context19.stop()}},_loop3)});case 17:return _context20.delegateYield(_loop3(),"t0",18);case 18:if(negotiateResponse.url&&redirects<MAX_REDIRECTS){_context20.next=17;break}case 19:if(!(redirects===MAX_REDIRECTS&&negotiateResponse.url)){_context20.next=21;break}throw new Error("Negotiate redirection limit exceeded.");case 21:_context20.next=23;return this._createTransport(url,this._options.transport,negotiateResponse,transferFormat);case 23:if(this.transport instanceof LongPollingTransport){this.features.inherentKeepAlive=true}if(this._connectionState==="Connecting"){this._logger.log(LogLevel.Debug,"The HttpConnection connected successfully.");this._connectionState="Connected"}_context20.next=34;break;case 27:_context20.prev=27;_context20.t1=_context20["catch"](3);this._logger.log(LogLevel.Error,"Failed to start the connection: "+_context20.t1);this._connectionState="Disconnected";this.transport=undefined;this._stopPromiseResolver();return _context20.abrupt("return",Promise.reject(_context20.t1));case 34:case"end":return _context20.stop()}},_callee19,this,[[3,27]])}));function _startInternal(_x25){return _startInternal3.apply(this,arguments)}return _startInternal}()},{key:"_getNegotiationResponse",value:function(){var _getNegotiationResponse2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee20(url){var headers,_getUserAgentHeader9,_getUserAgentHeader10,name,value,negotiateUrl,response,negotiateResponse,errorMessage;return _regeneratorRuntime().wrap(function _callee20$(_context21){while(1)switch(_context21.prev=_context21.next){case 0:headers={};_getUserAgentHeader9=getUserAgentHeader(),_getUserAgentHeader10=_slicedToArray2(_getUserAgentHeader9,2),name=_getUserAgentHeader10[0],value=_getUserAgentHeader10[1];headers[name]=value;negotiateUrl=this._resolveNegotiateUrl(url);this._logger.log(LogLevel.Debug,"Sending negotiation request: ".concat(negotiateUrl,"."));_context21.prev=5;_context21.next=8;return this._httpClient.post(negotiateUrl,{content:"",headers:_objectSpread2(_objectSpread2({},headers),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials});case 8:response=_context21.sent;if(!(response.statusCode!==200)){_context21.next=11;break}return _context21.abrupt("return",Promise.reject(new Error("Unexpected status code returned from negotiate '".concat(response.statusCode,"'"))));case 11:negotiateResponse=JSON.parse(response.content);if(!negotiateResponse.negotiateVersion||negotiateResponse.negotiateVersion<1){negotiateResponse.connectionToken=negotiateResponse.connectionId}return _context21.abrupt("return",negotiateResponse);case 16:_context21.prev=16;_context21.t0=_context21["catch"](5);errorMessage="Failed to complete negotiation with the server: "+_context21.t0;if(_context21.t0 instanceof HttpError){if(_context21.t0.statusCode===404){errorMessage=errorMessage+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."}}this._logger.log(LogLevel.Error,errorMessage);return _context21.abrupt("return",Promise.reject(new FailedToNegotiateWithServerError(errorMessage)));case 22:case"end":return _context21.stop()}},_callee20,this,[[5,16]])}));function _getNegotiationResponse(_x26){return _getNegotiationResponse2.apply(this,arguments)}return _getNegotiationResponse}()},{key:"_createConnectUrl",value:function _createConnectUrl(url,connectionToken){if(!connectionToken){return url}return url+(url.indexOf("?")===-1?"?":"&")+"id=".concat(connectionToken)}},{key:"_createTransport",value:function(){var _createTransport2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee21(url,requestedTransport,negotiateResponse,requestedTransferFormat){var connectUrl,transportExceptions,transports,negotiate,_iterator8,_step8,endpoint,transportOrError,message;return _regeneratorRuntime().wrap(function _callee21$(_context22){while(1)switch(_context22.prev=_context22.next){case 0:connectUrl=this._createConnectUrl(url,negotiateResponse.connectionToken);if(!this._isITransport(requestedTransport)){_context22.next=8;break}this._logger.log(LogLevel.Debug,"Connection was provided an instance of ITransport, using that directly.");this.transport=requestedTransport;_context22.next=6;return this._startTransport(connectUrl,requestedTransferFormat);case 6:this.connectionId=negotiateResponse.connectionId;return _context22.abrupt("return");case 8:transportExceptions=[];transports=negotiateResponse.availableTransports||[];negotiate=negotiateResponse;_iterator8=_createForOfIteratorHelper(transports);_context22.prev=12;_iterator8.s();case 14:if((_step8=_iterator8.n()).done){_context22.next=53;break}endpoint=_step8.value;transportOrError=this._resolveTransportOrError(endpoint,requestedTransport,requestedTransferFormat);if(!(transportOrError instanceof Error)){_context22.next=22;break}transportExceptions.push("".concat(endpoint.transport," failed:"));transportExceptions.push(transportOrError);_context22.next=51;break;case 22:if(!this._isITransport(transportOrError)){_context22.next=51;break}this.transport=transportOrError;if(negotiate){_context22.next=35;break}_context22.prev=25;_context22.next=28;return this._getNegotiationResponse(url);case 28:negotiate=_context22.sent;_context22.next=34;break;case 31:_context22.prev=31;_context22.t0=_context22["catch"](25);return _context22.abrupt("return",Promise.reject(_context22.t0));case 34:connectUrl=this._createConnectUrl(url,negotiate.connectionToken);case 35:_context22.prev=35;_context22.next=38;return this._startTransport(connectUrl,requestedTransferFormat);case 38:this.connectionId=negotiate.connectionId;return _context22.abrupt("return");case 42:_context22.prev=42;_context22.t1=_context22["catch"](35);this._logger.log(LogLevel.Error,"Failed to start the transport '".concat(endpoint.transport,"': ").concat(_context22.t1));negotiate=undefined;transportExceptions.push(new FailedToStartTransportError("".concat(endpoint.transport," failed: ").concat(_context22.t1),HttpTransportType[endpoint.transport]));if(!(this._connectionState!=="Connecting")){_context22.next=51;break}message="Failed to select transport before stop() was called.";this._logger.log(LogLevel.Debug,message);return _context22.abrupt("return",Promise.reject(new AbortError(message)));case 51:_context22.next=14;break;case 53:_context22.next=58;break;case 55:_context22.prev=55;_context22.t2=_context22["catch"](12);_iterator8.e(_context22.t2);case 58:_context22.prev=58;_iterator8.f();return _context22.finish(58);case 61:if(!(transportExceptions.length>0)){_context22.next=63;break}return _context22.abrupt("return",Promise.reject(new AggregateErrors("Unable to connect to the server with any of the available transports. ".concat(transportExceptions.join(" ")),transportExceptions)));case 63:return _context22.abrupt("return",Promise.reject(new Error("None of the transports supported by the client are supported by the server.")));case 64:case"end":return _context22.stop()}},_callee21,this,[[12,55,58,61],[25,31],[35,42]])}));function _createTransport(_x27,_x28,_x29,_x30){return _createTransport2.apply(this,arguments)}return _createTransport}()},{key:"_constructTransport",value:function _constructTransport(transport){switch(transport){case HttpTransportType.WebSockets:if(!this._options.WebSocket){throw new Error("'WebSocket' is not supported in your environment.")}return new WebSocketTransport(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case HttpTransportType.ServerSentEvents:if(!this._options.EventSource){throw new Error("'EventSource' is not supported in your environment.")}return new ServerSentEventsTransport(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case HttpTransportType.LongPolling:return new LongPollingTransport(this._httpClient,this._logger,this._options);default:throw new Error("Unknown transport: ".concat(transport,"."))}}},{key:"_startTransport",value:function _startTransport(url,transferFormat){var _this36=this;this.transport.onreceive=this.onreceive;this.transport.onclose=function(e){return _this36._stopConnection(e)};return this.transport.connect(url,transferFormat)}},{key:"_resolveTransportOrError",value:function _resolveTransportOrError(endpoint,requestedTransport,requestedTransferFormat){var transport=HttpTransportType[endpoint.transport];if(transport===null||transport===undefined){this._logger.log(LogLevel.Debug,"Skipping transport '".concat(endpoint.transport,"' because it is not supported by this client."));return new Error("Skipping transport '".concat(endpoint.transport,"' because it is not supported by this client."))}else{if(transportMatches(requestedTransport,transport)){var transferFormats=endpoint.transferFormats.map(function(s){return TransferFormat[s]});if(transferFormats.indexOf(requestedTransferFormat)>=0){if(transport===HttpTransportType.WebSockets&&!this._options.WebSocket||transport===HttpTransportType.ServerSentEvents&&!this._options.EventSource){this._logger.log(LogLevel.Debug,"Skipping transport '".concat(HttpTransportType[transport],"' because it is not supported in your environment.'"));return new UnsupportedTransportError("'".concat(HttpTransportType[transport],"' is not supported in your environment."),transport)}else{this._logger.log(LogLevel.Debug,"Selecting transport '".concat(HttpTransportType[transport],"'."));try{return this._constructTransport(transport)}catch(ex){return ex}}}else{this._logger.log(LogLevel.Debug,"Skipping transport '".concat(HttpTransportType[transport],"' because it does not support the requested transfer format '").concat(TransferFormat[requestedTransferFormat],"'."));return new Error("'".concat(HttpTransportType[transport],"' does not support ").concat(TransferFormat[requestedTransferFormat],"."))}}else{this._logger.log(LogLevel.Debug,"Skipping transport '".concat(HttpTransportType[transport],"' because it was disabled by the client."));return new DisabledTransportError("'".concat(HttpTransportType[transport],"' is disabled by the client."),transport)}}}},{key:"_isITransport",value:function _isITransport(transport){return transport&&_typeof2(transport)==="object"&&"connect"in transport}},{key:"_stopConnection",value:function _stopConnection(error){var _this37=this;this._logger.log(LogLevel.Debug,"HttpConnection.stopConnection(".concat(error,") called while in state ").concat(this._connectionState,"."));this.transport=undefined;error=this._stopError||error;this._stopError=undefined;if(this._connectionState==="Disconnected"){this._logger.log(LogLevel.Debug,"Call to HttpConnection.stopConnection(".concat(error,") was ignored because the connection is already in the disconnected state."));return}if(this._connectionState==="Connecting"){this._logger.log(LogLevel.Warning,"Call to HttpConnection.stopConnection(".concat(error,") was ignored because the connection is still in the connecting state."));throw new Error("HttpConnection.stopConnection(".concat(error,") was called while the connection is still in the connecting state."))}if(this._connectionState==="Disconnecting"){this._stopPromiseResolver()}if(error){this._logger.log(LogLevel.Error,"Connection disconnected with error '".concat(error,"'."))}else{this._logger.log(LogLevel.Information,"Connection disconnected.")}if(this._sendQueue){this._sendQueue.stop()["catch"](function(e){_this37._logger.log(LogLevel.Error,"TransportSendQueue.stop() threw error '".concat(e,"'."))});this._sendQueue=undefined}this.connectionId=undefined;this._connectionState="Disconnected";if(this._connectionStarted){this._connectionStarted=false;try{if(this.onclose){this.onclose(error)}}catch(e){this._logger.log(LogLevel.Error,"HttpConnection.onclose(".concat(error,") threw error '").concat(e,"'."))}}}},{key:"_resolveUrl",value:function _resolveUrl(url){if(url.lastIndexOf("https://",0)===0||url.lastIndexOf("http://",0)===0){return url}if(!Platform.isBrowser){throw new Error("Cannot resolve '".concat(url,"'."))}var aTag=window.document.createElement("a");aTag.href=url;this._logger.log(LogLevel.Information,"Normalizing '".concat(url,"' to '").concat(aTag.href,"'."));return aTag.href}},{key:"_resolveNegotiateUrl",value:function _resolveNegotiateUrl(url){var index=url.indexOf("?");var negotiateUrl=url.substring(0,index===-1?url.length:index);if(negotiateUrl[negotiateUrl.length-1]!=="/"){negotiateUrl+="/"}negotiateUrl+="negotiate";negotiateUrl+=index===-1?"":url.substring(index);if(negotiateUrl.indexOf("negotiateVersion")===-1){negotiateUrl+=index===-1?"?":"&";negotiateUrl+="negotiateVersion="+this._negotiateVersion}return negotiateUrl}}]);return HttpConnection}();function transportMatches(requestedTransport,actualTransport){return!requestedTransport||(actualTransport&requestedTransport)!==0}var TransportSendQueue=function(){function TransportSendQueue(_transport){_classCallCheck2(this,TransportSendQueue);this._transport=_transport;this._buffer=[];this._executing=true;this._sendBufferedData=new PromiseSource;this._transportResult=new PromiseSource;this._sendLoopPromise=this._sendLoop()}_createClass2(TransportSendQueue,[{key:"send",value:function send(data){this._bufferData(data);if(!this._transportResult){this._transportResult=new PromiseSource}return this._transportResult.promise}},{key:"stop",value:function stop(){this._executing=false;this._sendBufferedData.resolve();return this._sendLoopPromise}},{key:"_bufferData",value:function _bufferData(data){if(this._buffer.length&&_typeof2(this._buffer[0])!==_typeof2(data)){throw new Error("Expected data to be of type ".concat(_typeof2(this._buffer)," but was of type ").concat(_typeof2(data)))}this._buffer.push(data);this._sendBufferedData.resolve()}},{key:"_sendLoop",value:function(){var _sendLoop2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee22(){var transportResult,_data;return _regeneratorRuntime().wrap(function _callee22$(_context23){while(1)switch(_context23.prev=_context23.next){case 0:if(!true){_context23.next=22;break}_context23.next=3;return this._sendBufferedData.promise;case 3:if(this._executing){_context23.next=6;break}if(this._transportResult){this._transportResult.reject("Connection stopped.")}return _context23.abrupt("break",22);case 6:this._sendBufferedData=new PromiseSource;transportResult=this._transportResult;this._transportResult=undefined;_data=typeof this._buffer[0]==="string"?this._buffer.join(""):TransportSendQueue._concatBuffers(this._buffer);this._buffer.length=0;_context23.prev=11;_context23.next=14;return this._transport.send(_data);case 14:transportResult.resolve();_context23.next=20;break;case 17:_context23.prev=17;_context23.t0=_context23["catch"](11);transportResult.reject(_context23.t0);case 20:_context23.next=0;break;case 22:case"end":return _context23.stop()}},_callee22,this,[[11,17]])}));function _sendLoop(){return _sendLoop2.apply(this,arguments)}return _sendLoop}()}],[{key:"_concatBuffers",value:function _concatBuffers(arrayBuffers){var totalLength=arrayBuffers.map(function(b){return b.byteLength}).reduce(function(a,b){return a+b});var result=new Uint8Array(totalLength);var offset=0;var _iterator9=_createForOfIteratorHelper(arrayBuffers),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var item=_step9.value;result.set(new Uint8Array(item),offset);offset+=item.byteLength}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}return result.buffer}}]);return TransportSendQueue}();var PromiseSource=function(){function PromiseSource(){var _this38=this;_classCallCheck2(this,PromiseSource);this.promise=new Promise(function(resolve,reject){var _ref9;return _ref9=[resolve,reject],_this38._resolver=_ref9[0],_this38._rejecter=_ref9[1],_ref9})}_createClass2(PromiseSource,[{key:"resolve",value:function resolve(){this._resolver()}},{key:"reject",value:function reject(reason){this._rejecter(reason)}}]);return PromiseSource}();var JSON_HUB_PROTOCOL_NAME="json";var JsonHubProtocol=function(){function JsonHubProtocol(){_classCallCheck2(this,JsonHubProtocol);this.name=JSON_HUB_PROTOCOL_NAME;this.version=1;this.transferFormat=TransferFormat.Text}_createClass2(JsonHubProtocol,[{key:"parseMessages",value:function parseMessages(input,logger){if(typeof input!=="string"){throw new Error("Invalid input for JSON hub protocol. Expected a string.")}if(!input){return[]}if(logger===null){logger=NullLogger.instance}var messages=TextMessageFormat.parse(input);var hubMessages=[];var _iterator10=_createForOfIteratorHelper(messages),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var message=_step10.value;var parsedMessage=JSON.parse(message);if(typeof parsedMessage.type!=="number"){throw new Error("Invalid payload.")}switch(parsedMessage.type){case MessageType.Invocation:this._isInvocationMessage(parsedMessage);break;case MessageType.StreamItem:this._isStreamItemMessage(parsedMessage);break;case MessageType.Completion:this._isCompletionMessage(parsedMessage);break;case MessageType.Ping:break;case MessageType.Close:break;default:logger.log(LogLevel.Information,"Unknown message type '"+parsedMessage.type+"' ignored.");continue}hubMessages.push(parsedMessage)}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}return hubMessages}},{key:"writeMessage",value:function writeMessage(message){return TextMessageFormat.write(JSON.stringify(message))}},{key:"_isInvocationMessage",value:function _isInvocationMessage(message){this._assertNotEmptyString(message.target,"Invalid payload for Invocation message.");if(message.invocationId!==undefined){this._assertNotEmptyString(message.invocationId,"Invalid payload for Invocation message.")}}},{key:"_isStreamItemMessage",value:function _isStreamItemMessage(message){this._assertNotEmptyString(message.invocationId,"Invalid payload for StreamItem message.");if(message.item===undefined){throw new Error("Invalid payload for StreamItem message.")}}},{key:"_isCompletionMessage",value:function _isCompletionMessage(message){if(message.result&&message.error){throw new Error("Invalid payload for Completion message.")}if(!message.result&&message.error){this._assertNotEmptyString(message.error,"Invalid payload for Completion message.")}this._assertNotEmptyString(message.invocationId,"Invalid payload for Completion message.")}},{key:"_assertNotEmptyString",value:function _assertNotEmptyString(value,errorMessage){if(typeof value!=="string"||value===""){throw new Error(errorMessage)}}}]);return JsonHubProtocol}();var LogLevelNameMapping={trace:LogLevel.Trace,debug:LogLevel.Debug,info:LogLevel.Information,information:LogLevel.Information,warn:LogLevel.Warning,warning:LogLevel.Warning,error:LogLevel.Error,critical:LogLevel.Critical,none:LogLevel.None};function parseLogLevel(name){var mapping=LogLevelNameMapping[name.toLowerCase()];if(typeof mapping!=="undefined"){return mapping}else{throw new Error("Unknown log level: ".concat(name))}}var HubConnectionBuilder=function(){function HubConnectionBuilder(){_classCallCheck2(this,HubConnectionBuilder)}_createClass2(HubConnectionBuilder,[{key:"configureLogging",value:function configureLogging(logging){Arg.isRequired(logging,"logging");if(isLogger(logging)){this.logger=logging}else if(typeof logging==="string"){var logLevel=parseLogLevel(logging);this.logger=new ConsoleLogger(logLevel)}else{this.logger=new ConsoleLogger(logging)}return this}},{key:"withUrl",value:function withUrl(url,transportTypeOrOptions){Arg.isRequired(url,"url");Arg.isNotEmpty(url,"url");this.url=url;if(_typeof2(transportTypeOrOptions)==="object"){this.httpConnectionOptions=_objectSpread2(_objectSpread2({},this.httpConnectionOptions),transportTypeOrOptions)}else{this.httpConnectionOptions=_objectSpread2(_objectSpread2({},this.httpConnectionOptions),{},{transport:transportTypeOrOptions})}return this}},{key:"withHubProtocol",value:function withHubProtocol(protocol){Arg.isRequired(protocol,"protocol");this.protocol=protocol;return this}},{key:"withAutomaticReconnect",value:function withAutomaticReconnect(retryDelaysOrReconnectPolicy){if(this.reconnectPolicy){throw new Error("A reconnectPolicy has already been set.")}if(!retryDelaysOrReconnectPolicy){this.reconnectPolicy=new DefaultReconnectPolicy}else if(Array.isArray(retryDelaysOrReconnectPolicy)){this.reconnectPolicy=new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy)}else{this.reconnectPolicy=retryDelaysOrReconnectPolicy}return this}},{key:"build",value:function build(){var httpConnectionOptions=this.httpConnectionOptions||{};if(httpConnectionOptions.logger===undefined){httpConnectionOptions.logger=this.logger}if(!this.url){throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.")}var connection=new HttpConnection(this.url,httpConnectionOptions);return HubConnection.create(connection,this.logger||NullLogger.instance,this.protocol||new JsonHubProtocol,this.reconnectPolicy)}}]);return HubConnectionBuilder}();function isLogger(logger){return logger.log!==undefined}var WeavyClient=function(){function WeavyClient(options){var _this39=this;_classCallCheck2(this,WeavyClient);this.groups=[];this.connectionEvents=[];this.signalRAccessTokenRefresh=false;this.token="";this.EVENT_NAMESPACE=".connection";this.EVENT_CLOSE="close";this.EVENT_RECONNECTING="reconnecting";this.EVENT_RECONNECTED="reconnected";this.url=options.url;this.tokenFactory=options.tokenFactory;this.tokenPromise=null;this.connection=new HubConnectionBuilder().configureLogging(LogLevel.None).withUrl(this.url+"/hubs/rtm",{accessTokenFactory:function(){var _accessTokenFactory=_asyncToGenerator(_regeneratorRuntime().mark(function _callee23(){var token,_token;return _regeneratorRuntime().wrap(function _callee23$(_context24){while(1)switch(_context24.prev=_context24.next){case 0:if(!_this39.signalRAccessTokenRefresh){_context24.next=9;break}console.error("SignalR retrying with refreshed token.");_context24.next=4;return _this39.tokenFactoryInternal(true);case 4:token=_context24.sent;_this39.signalRAccessTokenRefresh=false;return _context24.abrupt("return",token);case 9:_context24.next=11;return _this39.tokenFactoryInternal();case 11:_token=_context24.sent;return _context24.abrupt("return",_token);case 13:case"end":return _context24.stop()}},_callee23)}));function accessTokenFactory(){return _accessTokenFactory.apply(this,arguments)}return accessTokenFactory}()}).withAutomaticReconnect().build();this.connect();this.connection.onclose(function(error){return _this39.triggerHandler(_this39.EVENT_CLOSE,error)});this.connection.onreconnecting(function(error){return _this39.triggerHandler(_this39.EVENT_RECONNECTING,error)});this.connection.onreconnected(function(connectionId){return _this39.triggerHandler(_this39.EVENT_RECONNECTED,connectionId)})}_createClass2(WeavyClient,[{key:"connect",value:function(){var _connect4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee24(){return _regeneratorRuntime().wrap(function _callee24$(_context25){while(1)switch(_context25.prev=_context25.next){case 0:_context25.prev=0;this.isConnectionStarted=this.connection.start();_context25.next=4;return this.isConnectionStarted;case 4:_context25.next=14;break;case 6:_context25.prev=6;_context25.t0=_context25["catch"](0);console.log("Could not start SignalR.");if(this.signalRAccessTokenRefresh){_context25.next=14;break}this.signalRAccessTokenRefresh=true;this.isConnectionStarted=this.connection.start();_context25.next=14;return this.isConnectionStarted;case 14:this.signalRAccessTokenRefresh=false;console.log("SignalR connected.");case 16:case"end":return _context25.stop()}},_callee24,this,[[0,6]])}));function connect(){return _connect4.apply(this,arguments)}return connect}()},{key:"get",value:function(){var _get=_asyncToGenerator(_regeneratorRuntime().mark(function _callee25(url){var retry,response,_args26=arguments;return _regeneratorRuntime().wrap(function _callee25$(_context26){while(1)switch(_context26.prev=_context26.next){case 0:retry=_args26.length>1&&_args26[1]!==undefined?_args26[1]:true;_context26.t0=fetch;_context26.t1=this.url+url;_context26.next=5;return this.tokenFactoryInternal();case 5:_context26.t2=_context26.sent;_context26.t3="Bearer "+_context26.t2;_context26.t4={"content-type":"application/json",Authorization:_context26.t3};_context26.t5={headers:_context26.t4};_context26.next=11;return(0,_context26.t0)(_context26.t1,_context26.t5);case 11:response=_context26.sent;if(response.ok){_context26.next=20;break}if(!((response.status===401||response.status===403)&&retry)){_context26.next=19;break}_context26.next=16;return this.tokenFactoryInternal(true);case 16:_context26.next=18;return this.get(url,false);case 18:return _context26.abrupt("return",_context26.sent);case 19:console.error("Error calling endpoint ".concat(url),response);case 20:return _context26.abrupt("return",response);case 21:case"end":return _context26.stop()}},_callee25,this)}));function get(_x31){return _get.apply(this,arguments)}return get}()},{key:"post",value:function(){var _post=_asyncToGenerator(_regeneratorRuntime().mark(function _callee26(url,method,body){var contentType,retry,headers,response,_args27=arguments;return _regeneratorRuntime().wrap(function _callee26$(_context27){while(1)switch(_context27.prev=_context27.next){case 0:contentType=_args27.length>3&&_args27[3]!==undefined?_args27[3]:"application/json";retry=_args27.length>4&&_args27[4]!==undefined?_args27[4]:true;_context27.next=4;return this.tokenFactoryInternal();case 4:_context27.t0=_context27.sent;_context27.t1="Bearer "+_context27.t0;headers={Authorization:_context27.t1};if(contentType!==""){headers["content-type"]=contentType}_context27.next=10;return fetch(this.url+url,{method:method,body:body,headers:headers});case 10:response=_context27.sent;if(response.ok){_context27.next=18;break}if(!((response.status===401||response.status===403)&&retry)){_context27.next=18;break}_context27.next=15;return this.tokenFactoryInternal(true);case 15:_context27.next=17;return this.post(url,method,body,contentType,false);case 17:return _context27.abrupt("return",_context27.sent);case 18:return _context27.abrupt("return",response);case 19:case"end":return _context27.stop()}},_callee26,this)}));function post(_x32,_x33,_x34){return _post.apply(this,arguments)}return post}()},{key:"upload",value:function(){var _upload=_asyncToGenerator(_regeneratorRuntime().mark(function _callee27(url,method,body){var contentType,onProgress,retry,client,token,_args28=arguments;return _regeneratorRuntime().wrap(function _callee27$(_context28){while(1)switch(_context28.prev=_context28.next){case 0:contentType=_args28.length>3&&_args28[3]!==undefined?_args28[3]:"application/json";onProgress=_args28.length>4?_args28[4]:undefined;retry=_args28.length>5&&_args28[5]!==undefined?_args28[5]:true;client=this;_context28.next=6;return client.tokenFactoryInternal();case 6:token=_context28.sent;_context28.next=9;return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open(method,client.url+url,true);xhr.setRequestHeader("Authorization","Bearer "+token);if(contentType!==""){xhr.setRequestHeader("content-type",contentType)}if(onProgress){xhr.upload.addEventListener("progress",function(e){onProgress(e.loaded/e.total*100||100)})}xhr.onload=function(evt){if(retry&&(xhr.status===401||xhr.status===401)){client.tokenFactoryInternal(true).then(function(){return client.upload(url,method,body,contentType,onProgress,false)}).then(resolve)["catch"](reject)}else{resolve(new Response(xhr.response,{status:xhr.status,statusText:xhr.statusText}))}};xhr.onerror=reject;xhr.send(body)});case 9:return _context28.abrupt("return",_context28.sent);case 10:case"end":return _context28.stop()}},_callee27,this)}));function upload(_x35,_x36,_x37){return _upload.apply(this,arguments)}return upload}()},{key:"getToken",value:function(){var _getToken=_asyncToGenerator(_regeneratorRuntime().mark(function _callee28(refresh){return _regeneratorRuntime().wrap(function _callee28$(_context29){while(1)switch(_context29.prev=_context29.next){case 0:if(!(!this.token||refresh)){_context29.next=4;break}_context29.next=3;return this.tokenFactory(true);case 3:this.token=_context29.sent;case 4:return _context29.abrupt("return",this.token);case 5:case"end":return _context29.stop()}},_callee28,this)}));function getToken(_x38){return _getToken.apply(this,arguments)}return getToken}()},{key:"tokenFactoryInternal",value:function(){var _tokenFactoryInternal=_asyncToGenerator(_regeneratorRuntime().mark(function _callee29(){var refresh,token,_args30=arguments;return _regeneratorRuntime().wrap(function _callee29$(_context30){while(1)switch(_context30.prev=_context30.next){case 0:refresh=_args30.length>0&&_args30[0]!==undefined?_args30[0]:false;if(!(this.token&&!refresh)){_context30.next=3;break}return _context30.abrupt("return",this.token);case 3:if(this.tokenPromise){_context30.next=13;break}this.tokenPromise=this.tokenFactory(refresh);_context30.next=7;return this.tokenPromise;case 7:token=_context30.sent;this.tokenPromise=null;this.token=token;return _context30.abrupt("return",this.token);case 13:return _context30.abrupt("return",this.tokenPromise);case 14:case"end":return _context30.stop()}},_callee29,this)}));function tokenFactoryInternal(){return _tokenFactoryInternal.apply(this,arguments)}return tokenFactoryInternal}()},{key:"subscribe",value:function(){var _subscribe=_asyncToGenerator(_regeneratorRuntime().mark(function _callee30(group,event,callback){var name;return _regeneratorRuntime().wrap(function _callee30$(_context31){while(1)switch(_context31.prev=_context31.next){case 0:_context31.next=2;return this.isConnectionStarted;case 2:_context31.prev=2;name=group?group+":"+event:event;_context31.next=6;return this.connection.invoke("Subscribe",name);case 6:this.groups.push(name);this.connection.on(name,callback);_context31.next=13;break;case 10:_context31.prev=10;_context31.t0=_context31["catch"](2);console.warn("Error in Subscribe:",_context31.t0);case 13:case"end":return _context31.stop()}},_callee30,this,[[2,10]])}));function subscribe(_x39,_x40,_x41){return _subscribe.apply(this,arguments)}return subscribe}()},{key:"unsubscribe",value:function(){var _unsubscribe=_asyncToGenerator(_regeneratorRuntime().mark(function _callee31(group,event,callback){var name,index;return _regeneratorRuntime().wrap(function _callee31$(_context32){while(1)switch(_context32.prev=_context32.next){case 0:_context32.next=2;return this.isConnectionStarted;case 2:name=group?group+":"+event:event;index=this.groups.findIndex(function(e){return e===name});if(!(index!==-1)){_context32.next=15;break}this.groups=this.groups.splice(index,1);_context32.prev=6;if(this.groups.find(function(e){return e===name})){_context32.next=10;break}_context32.next=10;return this.connection.invoke("Unsubscribe",name);case 10:_context32.next=15;break;case 12:_context32.prev=12;_context32.t0=_context32["catch"](6);console.warn("Error in Unsubscribe:",_context32.t0);case 15:this.connection.off(name,callback);case 16:case"end":return _context32.stop()}},_callee31,this,[[6,12]])}));function unsubscribe(_x42,_x43,_x44){return _unsubscribe.apply(this,arguments)}return unsubscribe}()},{key:"destroy",value:function destroy(){this.connection.stop()}},{key:"triggerHandler",value:function triggerHandler(name){for(var _len6=arguments.length,data=new Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++){data[_key6-1]=arguments[_key6]}name=name.endsWith(this.EVENT_NAMESPACE)?name:name+this.EVENT_NAMESPACE;var event=new CustomEvent(name,{cancelable:false});console.debug("triggerHandler",name);this.connectionEvents.forEach(function(eventHandler){if(eventHandler.name===name){eventHandler.handler.apply(eventHandler,[event].concat(data))}});if(name===this.EVENT_RECONNECTED+this.EVENT_NAMESPACE){for(var i=0;i<this.groups.length;i++){this.connection.invoke("Subscribe",this.groups[i])}}}}]);return WeavyClient}();function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass)}var Subscribable=function(){function Subscribable(){this.listeners=[]}var _proto=Subscribable.prototype;_proto.subscribe=function subscribe(listener){var _this=this;var callback=listener||function(){return undefined};this.listeners.push(callback);this.onSubscribe();return function(){_this.listeners=_this.listeners.filter(function(x){return x!==callback});_this.onUnsubscribe()}};_proto.hasListeners=function hasListeners(){return this.listeners.length>0};_proto.onSubscribe=function onSubscribe(){};_proto.onUnsubscribe=function onUnsubscribe(){};return Subscribable}();function _extends$1(){_extends$1=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends$1.apply(this,arguments)}var isServer=typeof window==="undefined";function noop$1(){return undefined}function functionalUpdate(updater,input){return typeof updater==="function"?updater(input):updater}function isValidTimeout(value){return typeof value==="number"&&value>=0&&value!==Infinity}function ensureQueryKeyArray(value){return Array.isArray(value)?value:[value]}function timeUntilStale(updatedAt,staleTime){return Math.max(updatedAt+(staleTime||0)-Date.now(),0)}function parseQueryArgs(arg1,arg2,arg3){if(!isQueryKey(arg1)){return arg1}if(typeof arg2==="function"){return _extends$1({},arg3,{queryKey:arg1,queryFn:arg2})}return _extends$1({},arg2,{queryKey:arg1})}function parseMutationArgs(arg1,arg2,arg3){if(isQueryKey(arg1)){if(typeof arg2==="function"){return _extends$1({},arg3,{mutationKey:arg1,mutationFn:arg2})}return _extends$1({},arg2,{mutationKey:arg1})}if(typeof arg1==="function"){return _extends$1({},arg2,{mutationFn:arg1})}return _extends$1({},arg1)}function parseFilterArgs(arg1,arg2,arg3){return isQueryKey(arg1)?[_extends$1({},arg2,{queryKey:arg1}),arg3]:[arg1||{},arg2]}function mapQueryStatusFilter(active,inactive){if(active===true&&inactive===true||active==null&&inactive==null){return"all"}else if(active===false&&inactive===false){return"none"}else{var isActive=active!=null?active:!inactive;return isActive?"active":"inactive"}}function matchQuery(filters,query){var active=filters.active,exact=filters.exact,fetching=filters.fetching,inactive=filters.inactive,predicate=filters.predicate,queryKey=filters.queryKey,stale=filters.stale;if(isQueryKey(queryKey)){if(exact){if(query.queryHash!==hashQueryKeyByOptions(queryKey,query.options)){return false}}else if(!partialMatchKey(query.queryKey,queryKey)){return false}}var queryStatusFilter=mapQueryStatusFilter(active,inactive);if(queryStatusFilter==="none"){return false}else if(queryStatusFilter!=="all"){var isActive=query.isActive();if(queryStatusFilter==="active"&&!isActive){return false}if(queryStatusFilter==="inactive"&&isActive){return false}}if(typeof stale==="boolean"&&query.isStale()!==stale){return false}if(typeof fetching==="boolean"&&query.isFetching()!==fetching){return false}if(predicate&&!predicate(query)){return false}return true}function matchMutation(filters,mutation){var exact=filters.exact,fetching=filters.fetching,predicate=filters.predicate,mutationKey=filters.mutationKey;if(isQueryKey(mutationKey)){if(!mutation.options.mutationKey){return false}if(exact){if(hashQueryKey(mutation.options.mutationKey)!==hashQueryKey(mutationKey)){return false}}else if(!partialMatchKey(mutation.options.mutationKey,mutationKey)){return false}}if(typeof fetching==="boolean"&&mutation.state.status==="loading"!==fetching){return false}if(predicate&&!predicate(mutation)){return false}return true}function hashQueryKeyByOptions(queryKey,options){var hashFn=(options==null?void 0:options.queryKeyHashFn)||hashQueryKey;return hashFn(queryKey)}function hashQueryKey(queryKey){var asArray=ensureQueryKeyArray(queryKey);return stableValueHash(asArray)}function stableValueHash(value){return JSON.stringify(value,function(_,val){return isPlainObject$1(val)?Object.keys(val).sort().reduce(function(result,key){result[key]=val[key];return result},{}):val})}function partialMatchKey(a,b){return partialDeepEqual(ensureQueryKeyArray(a),ensureQueryKeyArray(b))}function partialDeepEqual(a,b){if(a===b){return true}if(_typeof2(a)!==_typeof2(b)){return false}if(a&&b&&_typeof2(a)==="object"&&_typeof2(b)==="object"){return!Object.keys(b).some(function(key){return!partialDeepEqual(a[key],b[key])})}return false}function replaceEqualDeep(a,b){if(a===b){return a}var array=Array.isArray(a)&&Array.isArray(b);if(array||isPlainObject$1(a)&&isPlainObject$1(b)){var aSize=array?a.length:Object.keys(a).length;var bItems=array?b:Object.keys(b);var bSize=bItems.length;var copy=array?[]:{};var equalItems=0;for(var i=0;i<bSize;i++){var key=array?i:bItems[i];copy[key]=replaceEqualDeep(a[key],b[key]);if(copy[key]===a[key]){equalItems++}}return aSize===bSize&&equalItems===aSize?a:copy}return b}function shallowEqualObjects(a,b){if(a&&!b||b&&!a){return false}for(var key in a){if(a[key]!==b[key]){return false}}return true}function isPlainObject$1(o){if(!hasObjectPrototype(o)){return false}var ctor=o.constructor;if(typeof ctor==="undefined"){return true}var prot=ctor.prototype;if(!hasObjectPrototype(prot)){return false}if(!prot.hasOwnProperty("isPrototypeOf")){return false}return true}function hasObjectPrototype(o){return Object.prototype.toString.call(o)==="[object Object]"}function isQueryKey(value){return typeof value==="string"||Array.isArray(value)}function sleep(timeout){return new Promise(function(resolve){setTimeout(resolve,timeout)})}function scheduleMicrotask(callback){Promise.resolve().then(callback)["catch"](function(error){return setTimeout(function(){throw error})})}function getAbortController(){if(typeof AbortController==="function"){return new AbortController}}var FocusManager=function(_Subscribable){_inheritsLoose(FocusManager,_Subscribable);function FocusManager(){var _this;_this=_Subscribable.call(this)||this;_this.setup=function(onFocus){var _window;if(!isServer&&((_window=window)==null?void 0:_window.addEventListener)){var listener=function listener(){return onFocus()};window.addEventListener("visibilitychange",listener,false);window.addEventListener("focus",listener,false);return function(){window.removeEventListener("visibilitychange",listener);window.removeEventListener("focus",listener)}}};return _this}var _proto=FocusManager.prototype;_proto.onSubscribe=function onSubscribe(){if(!this.cleanup){this.setEventListener(this.setup)}};_proto.onUnsubscribe=function onUnsubscribe(){if(!this.hasListeners()){var _this$cleanup;(_this$cleanup=this.cleanup)==null?void 0:_this$cleanup.call(this);this.cleanup=undefined}};_proto.setEventListener=function setEventListener(setup){var _this$cleanup2,_this2=this;this.setup=setup;(_this$cleanup2=this.cleanup)==null?void 0:_this$cleanup2.call(this);this.cleanup=setup(function(focused){if(typeof focused==="boolean"){_this2.setFocused(focused)}else{_this2.onFocus()}})};_proto.setFocused=function setFocused(focused){this.focused=focused;if(focused){this.onFocus()}};_proto.onFocus=function onFocus(){this.listeners.forEach(function(listener){listener()})};_proto.isFocused=function isFocused(){if(typeof this.focused==="boolean"){return this.focused}if(typeof document==="undefined"){return true}return[undefined,"visible","prerender"].includes(document.visibilityState)};return FocusManager}(Subscribable);var focusManager$1=new FocusManager;var OnlineManager=function(_Subscribable){_inheritsLoose(OnlineManager,_Subscribable);function OnlineManager(){var _this;_this=_Subscribable.call(this)||this;_this.setup=function(onOnline){var _window;if(!isServer&&((_window=window)==null?void 0:_window.addEventListener)){var listener=function listener(){return onOnline()};window.addEventListener("online",listener,false);window.addEventListener("offline",listener,false);return function(){window.removeEventListener("online",listener);window.removeEventListener("offline",listener)}}};return _this}var _proto=OnlineManager.prototype;_proto.onSubscribe=function onSubscribe(){if(!this.cleanup){this.setEventListener(this.setup)}};_proto.onUnsubscribe=function onUnsubscribe(){if(!this.hasListeners()){var _this$cleanup;(_this$cleanup=this.cleanup)==null?void 0:_this$cleanup.call(this);this.cleanup=undefined}};_proto.setEventListener=function setEventListener(setup){var _this$cleanup2,_this2=this;this.setup=setup;(_this$cleanup2=this.cleanup)==null?void 0:_this$cleanup2.call(this);this.cleanup=setup(function(online){if(typeof online==="boolean"){_this2.setOnline(online)}else{_this2.onOnline()}})};_proto.setOnline=function setOnline(online){this.online=online;if(online){this.onOnline()}};_proto.onOnline=function onOnline(){this.listeners.forEach(function(listener){listener()})};_proto.isOnline=function isOnline(){if(typeof this.online==="boolean"){return this.online}if(typeof navigator==="undefined"||typeof navigator.onLine==="undefined"){return true}return navigator.onLine};return OnlineManager}(Subscribable);var onlineManager=new OnlineManager;function defaultRetryDelay(failureCount){return Math.min(1000*Math.pow(2,failureCount),30000)}function isCancelable(value){return typeof(value==null?void 0:value.cancel)==="function"}var CancelledError=function CancelledError(options){this.revert=options==null?void 0:options.revert;this.silent=options==null?void 0:options.silent};function isCancelledError(value){return value instanceof CancelledError}var Retryer=function Retryer(config){var _this=this;var cancelRetry=false;var cancelFn;var continueFn;var promiseResolve;var promiseReject;this.abort=config.abort;this.cancel=function(cancelOptions){return cancelFn==null?void 0:cancelFn(cancelOptions)};this.cancelRetry=function(){cancelRetry=true};this.continueRetry=function(){cancelRetry=false};this["continue"]=function(){return continueFn==null?void 0:continueFn()};this.failureCount=0;this.isPaused=false;this.isResolved=false;this.isTransportCancelable=false;this.promise=new Promise(function(outerResolve,outerReject){promiseResolve=outerResolve;promiseReject=outerReject});var resolve=function resolve(value){if(!_this.isResolved){_this.isResolved=true;config.onSuccess==null?void 0:config.onSuccess(value);continueFn==null?void 0:continueFn();promiseResolve(value)}};var reject=function reject(value){if(!_this.isResolved){_this.isResolved=true;config.onError==null?void 0:config.onError(value);continueFn==null?void 0:continueFn();promiseReject(value)}};var pause=function pause(){return new Promise(function(continueResolve){continueFn=continueResolve;_this.isPaused=true;config.onPause==null?void 0:config.onPause()}).then(function(){continueFn=undefined;_this.isPaused=false;config.onContinue==null?void 0:config.onContinue()})};var run=function run(){if(_this.isResolved){return}var promiseOrValue;try{promiseOrValue=config.fn()}catch(error){promiseOrValue=Promise.reject(error)}cancelFn=function cancelFn(cancelOptions){if(!_this.isResolved){reject(new CancelledError(cancelOptions));_this.abort==null?void 0:_this.abort();if(isCancelable(promiseOrValue)){try{promiseOrValue.cancel()}catch(_unused){}}}};_this.isTransportCancelable=isCancelable(promiseOrValue);Promise.resolve(promiseOrValue).then(resolve)["catch"](function(error){var _config$retry,_config$retryDelay;if(_this.isResolved){return}var retry=(_config$retry=config.retry)!=null?_config$retry:3;var retryDelay=(_config$retryDelay=config.retryDelay)!=null?_config$retryDelay:defaultRetryDelay;var delay=typeof retryDelay==="function"?retryDelay(_this.failureCount,error):retryDelay;var shouldRetry=retry===true||typeof retry==="number"&&_this.failureCount<retry||typeof retry==="function"&&retry(_this.failureCount,error);if(cancelRetry||!shouldRetry){reject(error);return}_this.failureCount++;config.onFail==null?void 0:config.onFail(_this.failureCount,error);sleep(delay).then(function(){if(!focusManager$1.isFocused()||!onlineManager.isOnline()){return pause()}}).then(function(){if(cancelRetry){reject(error)}else{run()}})})};run()};var NotifyManager=function(){function NotifyManager(){this.queue=[];this.transactions=0;this.notifyFn=function(callback){callback()};this.batchNotifyFn=function(callback){callback()}}var _proto=NotifyManager.prototype;_proto.batch=function batch(callback){var result;this.transactions++;try{result=callback()}finally{this.transactions--;if(!this.transactions){this.flush()}}return result};_proto.schedule=function schedule(callback){var _this=this;if(this.transactions){this.queue.push(callback)}else{scheduleMicrotask(function(){_this.notifyFn(callback)})}};_proto.batchCalls=function batchCalls(callback){var _this2=this;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this2.schedule(function(){callback.apply(void 0,args)})}};_proto.flush=function flush(){var _this3=this;var queue=this.queue;this.queue=[];if(queue.length){scheduleMicrotask(function(){_this3.batchNotifyFn(function(){queue.forEach(function(callback){_this3.notifyFn(callback)})})})}};_proto.setNotifyFunction=function setNotifyFunction(fn){this.notifyFn=fn};_proto.setBatchNotifyFunction=function setBatchNotifyFunction(fn){this.batchNotifyFn=fn};return NotifyManager}();var notifyManager=new NotifyManager;var logger$1=console;function getLogger(){return logger$1}function setLogger(newLogger){logger$1=newLogger}var Query=function(){function Query(config){this.abortSignalConsumed=false;this.hadObservers=false;this.defaultOptions=config.defaultOptions;this.setOptions(config.options);this.observers=[];this.cache=config.cache;this.queryKey=config.queryKey;this.queryHash=config.queryHash;this.initialState=config.state||this.getDefaultState(this.options);this.state=this.initialState;this.meta=config.meta;this.scheduleGc()}var _proto=Query.prototype;_proto.setOptions=function setOptions(options){var _this$options$cacheTi;this.options=_extends$1({},this.defaultOptions,options);this.meta=options==null?void 0:options.meta;this.cacheTime=Math.max(this.cacheTime||0,(_this$options$cacheTi=this.options.cacheTime)!=null?_this$options$cacheTi:5*60*1000)};_proto.setDefaultOptions=function setDefaultOptions(options){this.defaultOptions=options};_proto.scheduleGc=function scheduleGc(){var _this=this;this.clearGcTimeout();if(isValidTimeout(this.cacheTime)){this.gcTimeout=setTimeout(function(){_this.optionalRemove()},this.cacheTime)}};_proto.clearGcTimeout=function clearGcTimeout(){if(this.gcTimeout){clearTimeout(this.gcTimeout);this.gcTimeout=undefined}};_proto.optionalRemove=function optionalRemove(){if(!this.observers.length){if(this.state.isFetching){if(this.hadObservers){this.scheduleGc()}}else{this.cache.remove(this)}}};_proto.setData=function setData(updater,options){var _this$options$isDataE,_this$options;var prevData=this.state.data;var data=functionalUpdate(updater,prevData);if((_this$options$isDataE=(_this$options=this.options).isDataEqual)==null?void 0:_this$options$isDataE.call(_this$options,prevData,data)){data=prevData}else if(this.options.structuralSharing!==false){data=replaceEqualDeep(prevData,data)}this.dispatch({data:data,type:"success",dataUpdatedAt:options==null?void 0:options.updatedAt});return data};_proto.setState=function setState(state,setStateOptions){this.dispatch({type:"setState",state:state,setStateOptions:setStateOptions})};_proto.cancel=function cancel(options){var _this$retryer;var promise=this.promise;(_this$retryer=this.retryer)==null?void 0:_this$retryer.cancel(options);return promise?promise.then(noop$1)["catch"](noop$1):Promise.resolve()};_proto.destroy=function destroy(){this.clearGcTimeout();this.cancel({silent:true})};_proto.reset=function reset(){this.destroy();this.setState(this.initialState)};_proto.isActive=function isActive(){return this.observers.some(function(observer){return observer.options.enabled!==false})};_proto.isFetching=function isFetching(){return this.state.isFetching};_proto.isStale=function isStale(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(function(observer){return observer.getCurrentResult().isStale})};_proto.isStaleByTime=function isStaleByTime(staleTime){if(staleTime===void 0){staleTime=0}return this.state.isInvalidated||!this.state.dataUpdatedAt||!timeUntilStale(this.state.dataUpdatedAt,staleTime)};_proto.onFocus=function onFocus(){var _this$retryer2;var observer=this.observers.find(function(x){return x.shouldFetchOnWindowFocus()});if(observer){observer.refetch()}(_this$retryer2=this.retryer)==null?void 0:_this$retryer2["continue"]()};_proto.onOnline=function onOnline(){var _this$retryer3;var observer=this.observers.find(function(x){return x.shouldFetchOnReconnect()});if(observer){observer.refetch()}(_this$retryer3=this.retryer)==null?void 0:_this$retryer3["continue"]()};_proto.addObserver=function addObserver(observer){if(this.observers.indexOf(observer)===-1){this.observers.push(observer);this.hadObservers=true;this.clearGcTimeout();this.cache.notify({type:"observerAdded",query:this,observer:observer})}};_proto.removeObserver=function removeObserver(observer){if(this.observers.indexOf(observer)!==-1){this.observers=this.observers.filter(function(x){return x!==observer});if(!this.observers.length){if(this.retryer){if(this.retryer.isTransportCancelable||this.abortSignalConsumed){this.retryer.cancel({revert:true})}else{this.retryer.cancelRetry()}}if(this.cacheTime){this.scheduleGc()}else{this.cache.remove(this)}}this.cache.notify({type:"observerRemoved",query:this,observer:observer})}};_proto.getObserversCount=function getObserversCount(){return this.observers.length};_proto.invalidate=function invalidate(){if(!this.state.isInvalidated){this.dispatch({type:"invalidate"})}};_proto.fetch=function fetch(options,fetchOptions){var _this2=this,_this$options$behavio,_context$fetchOptions,_abortController$abor;if(this.state.isFetching){if(this.state.dataUpdatedAt&&(fetchOptions==null?void 0:fetchOptions.cancelRefetch)){this.cancel({silent:true})}else if(this.promise){var _this$retryer4;(_this$retryer4=this.retryer)==null?void 0:_this$retryer4.continueRetry();return this.promise}}if(options){this.setOptions(options)}if(!this.options.queryFn){var observer=this.observers.find(function(x){return x.options.queryFn});if(observer){this.setOptions(observer.options)}}var queryKey=ensureQueryKeyArray(this.queryKey);var abortController=getAbortController();var queryFnContext={queryKey:queryKey,pageParam:undefined,meta:this.meta};Object.defineProperty(queryFnContext,"signal",{enumerable:true,get:function get(){if(abortController){_this2.abortSignalConsumed=true;return abortController.signal}return undefined}});var fetchFn=function fetchFn(){if(!_this2.options.queryFn){return Promise.reject("Missing queryFn")}_this2.abortSignalConsumed=false;return _this2.options.queryFn(queryFnContext)};var context={fetchOptions:fetchOptions,options:this.options,queryKey:queryKey,state:this.state,fetchFn:fetchFn,meta:this.meta};if((_this$options$behavio=this.options.behavior)==null?void 0:_this$options$behavio.onFetch){var _this$options$behavio2;(_this$options$behavio2=this.options.behavior)==null?void 0:_this$options$behavio2.onFetch(context)}this.revertState=this.state;if(!this.state.isFetching||this.state.fetchMeta!==((_context$fetchOptions=context.fetchOptions)==null?void 0:_context$fetchOptions.meta)){var _context$fetchOptions2;this.dispatch({type:"fetch",meta:(_context$fetchOptions2=context.fetchOptions)==null?void 0:_context$fetchOptions2.meta})}this.retryer=new Retryer({fn:context.fetchFn,abort:abortController==null?void 0:(_abortController$abor=abortController.abort)==null?void 0:_abortController$abor.bind(abortController),onSuccess:function onSuccess(data){_this2.setData(data);_this2.cache.config.onSuccess==null?void 0:_this2.cache.config.onSuccess(data,_this2);if(_this2.cacheTime===0){_this2.optionalRemove()}},onError:function onError(error){if(!(isCancelledError(error)&&error.silent)){_this2.dispatch({type:"error",error:error})}if(!isCancelledError(error)){_this2.cache.config.onError==null?void 0:_this2.cache.config.onError(error,_this2);getLogger().error(error)}if(_this2.cacheTime===0){_this2.optionalRemove()}},onFail:function onFail(){_this2.dispatch({type:"failed"})},onPause:function onPause(){_this2.dispatch({type:"pause"})},onContinue:function onContinue(){_this2.dispatch({type:"continue"})},retry:context.options.retry,retryDelay:context.options.retryDelay});this.promise=this.retryer.promise;return this.promise};_proto.dispatch=function dispatch(action){var _this3=this;this.state=this.reducer(this.state,action);notifyManager.batch(function(){_this3.observers.forEach(function(observer){observer.onQueryUpdate(action)});_this3.cache.notify({query:_this3,type:"queryUpdated",action:action})})};_proto.getDefaultState=function getDefaultState(options){var data=typeof options.initialData==="function"?options.initialData():options.initialData;var hasInitialData=typeof options.initialData!=="undefined";var initialDataUpdatedAt=hasInitialData?typeof options.initialDataUpdatedAt==="function"?options.initialDataUpdatedAt():options.initialDataUpdatedAt:0;var hasData=typeof data!=="undefined";return{data:data,dataUpdateCount:0,dataUpdatedAt:hasData?initialDataUpdatedAt!=null?initialDataUpdatedAt:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchMeta:null,isFetching:false,isInvalidated:false,isPaused:false,status:hasData?"success":"idle"}};_proto.reducer=function reducer(state,action){var _action$meta,_action$dataUpdatedAt;switch(action.type){case"failed":return _extends$1({},state,{fetchFailureCount:state.fetchFailureCount+1});case"pause":return _extends$1({},state,{isPaused:true});case"continue":return _extends$1({},state,{isPaused:false});case"fetch":return _extends$1({},state,{fetchFailureCount:0,fetchMeta:(_action$meta=action.meta)!=null?_action$meta:null,isFetching:true,isPaused:false},!state.dataUpdatedAt&&{error:null,status:"loading"});case"success":return _extends$1({},state,{data:action.data,dataUpdateCount:state.dataUpdateCount+1,dataUpdatedAt:(_action$dataUpdatedAt=action.dataUpdatedAt)!=null?_action$dataUpdatedAt:Date.now(),error:null,fetchFailureCount:0,isFetching:false,isInvalidated:false,isPaused:false,status:"success"});case"error":var error=action.error;if(isCancelledError(error)&&error.revert&&this.revertState){return _extends$1({},this.revertState)}return _extends$1({},state,{error:error,errorUpdateCount:state.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:state.fetchFailureCount+1,isFetching:false,isPaused:false,status:"error"});case"invalidate":return _extends$1({},state,{isInvalidated:true});case"setState":return _extends$1({},state,action.state);default:return state}};return Query}();var QueryCache=function(_Subscribable){_inheritsLoose(QueryCache,_Subscribable);function QueryCache(config){var _this;_this=_Subscribable.call(this)||this;_this.config=config||{};_this.queries=[];_this.queriesMap={};return _this}var _proto=QueryCache.prototype;_proto.build=function build(client,options,state){var _options$queryHash;var queryKey=options.queryKey;var queryHash=(_options$queryHash=options.queryHash)!=null?_options$queryHash:hashQueryKeyByOptions(queryKey,options);var query=this.get(queryHash);if(!query){query=new Query({cache:this,queryKey:queryKey,queryHash:queryHash,options:client.defaultQueryOptions(options),state:state,defaultOptions:client.getQueryDefaults(queryKey),meta:options.meta});this.add(query)}return query};_proto.add=function add(query){if(!this.queriesMap[query.queryHash]){this.queriesMap[query.queryHash]=query;this.queries.push(query);this.notify({type:"queryAdded",query:query})}};_proto.remove=function remove(query){var queryInMap=this.queriesMap[query.queryHash];if(queryInMap){query.destroy();this.queries=this.queries.filter(function(x){return x!==query});if(queryInMap===query){delete this.queriesMap[query.queryHash]}this.notify({type:"queryRemoved",query:query})}};_proto.clear=function clear(){var _this2=this;notifyManager.batch(function(){_this2.queries.forEach(function(query){_this2.remove(query)})})};_proto.get=function get(queryHash){return this.queriesMap[queryHash]};_proto.getAll=function getAll(){return this.queries};_proto.find=function find(arg1,arg2){var _parseFilterArgs=parseFilterArgs(arg1,arg2),filters=_parseFilterArgs[0];if(typeof filters.exact==="undefined"){filters.exact=true}return this.queries.find(function(query){return matchQuery(filters,query)})};_proto.findAll=function findAll(arg1,arg2){var _parseFilterArgs2=parseFilterArgs(arg1,arg2),filters=_parseFilterArgs2[0];return Object.keys(filters).length>0?this.queries.filter(function(query){return matchQuery(filters,query)}):this.queries};_proto.notify=function notify(event){var _this3=this;notifyManager.batch(function(){_this3.listeners.forEach(function(listener){listener(event)})})};_proto.onFocus=function onFocus(){var _this4=this;notifyManager.batch(function(){_this4.queries.forEach(function(query){query.onFocus()})})};_proto.onOnline=function onOnline(){var _this5=this;notifyManager.batch(function(){_this5.queries.forEach(function(query){query.onOnline()})})};return QueryCache}(Subscribable);var Mutation=function(){function Mutation(config){this.options=_extends$1({},config.defaultOptions,config.options);this.mutationId=config.mutationId;this.mutationCache=config.mutationCache;this.observers=[];this.state=config.state||getDefaultState();this.meta=config.meta}var _proto=Mutation.prototype;_proto.setState=function setState(state){this.dispatch({type:"setState",state:state})};_proto.addObserver=function addObserver(observer){if(this.observers.indexOf(observer)===-1){this.observers.push(observer)}};_proto.removeObserver=function removeObserver(observer){this.observers=this.observers.filter(function(x){return x!==observer})};_proto.cancel=function cancel(){if(this.retryer){this.retryer.cancel();return this.retryer.promise.then(noop$1)["catch"](noop$1)}return Promise.resolve()};_proto["continue"]=function _continue(){if(this.retryer){this.retryer["continue"]();return this.retryer.promise}return this.execute()};_proto.execute=function execute(){var _this=this;var data;var restored=this.state.status==="loading";var promise=Promise.resolve();if(!restored){this.dispatch({type:"loading",variables:this.options.variables});promise=promise.then(function(){_this.mutationCache.config.onMutate==null?void 0:_this.mutationCache.config.onMutate(_this.state.variables,_this)}).then(function(){return _this.options.onMutate==null?void 0:_this.options.onMutate(_this.state.variables)}).then(function(context){if(context!==_this.state.context){_this.dispatch({type:"loading",context:context,variables:_this.state.variables})}})}return promise.then(function(){return _this.executeMutation()}).then(function(result){data=result;_this.mutationCache.config.onSuccess==null?void 0:_this.mutationCache.config.onSuccess(data,_this.state.variables,_this.state.context,_this)}).then(function(){return _this.options.onSuccess==null?void 0:_this.options.onSuccess(data,_this.state.variables,_this.state.context)}).then(function(){return _this.options.onSettled==null?void 0:_this.options.onSettled(data,null,_this.state.variables,_this.state.context)}).then(function(){_this.dispatch({type:"success",data:data});return data})["catch"](function(error){_this.mutationCache.config.onError==null?void 0:_this.mutationCache.config.onError(error,_this.state.variables,_this.state.context,_this);getLogger().error(error);return Promise.resolve().then(function(){return _this.options.onError==null?void 0:_this.options.onError(error,_this.state.variables,_this.state.context)}).then(function(){return _this.options.onSettled==null?void 0:_this.options.onSettled(undefined,error,_this.state.variables,_this.state.context)}).then(function(){_this.dispatch({type:"error",error:error});throw error})})};_proto.executeMutation=function executeMutation(){var _this2=this,_this$options$retry;this.retryer=new Retryer({fn:function fn(){if(!_this2.options.mutationFn){return Promise.reject("No mutationFn found")}return _this2.options.mutationFn(_this2.state.variables)},onFail:function onFail(){_this2.dispatch({type:"failed"})},onPause:function onPause(){_this2.dispatch({type:"pause"})},onContinue:function onContinue(){_this2.dispatch({type:"continue"})},retry:(_this$options$retry=this.options.retry)!=null?_this$options$retry:0,retryDelay:this.options.retryDelay});return this.retryer.promise};_proto.dispatch=function dispatch(action){var _this3=this;this.state=reducer$1(this.state,action);notifyManager.batch(function(){_this3.observers.forEach(function(observer){observer.onMutationUpdate(action)});_this3.mutationCache.notify(_this3)})};return Mutation}();function getDefaultState(){return{context:undefined,data:undefined,error:null,failureCount:0,isPaused:false,status:"idle",variables:undefined}}function reducer$1(state,action){switch(action.type){case"failed":return _extends$1({},state,{failureCount:state.failureCount+1});case"pause":return _extends$1({},state,{isPaused:true});case"continue":return _extends$1({},state,{isPaused:false});case"loading":return _extends$1({},state,{context:action.context,data:undefined,error:null,isPaused:false,status:"loading",variables:action.variables});case"success":return _extends$1({},state,{data:action.data,error:null,status:"success",isPaused:false});case"error":return _extends$1({},state,{data:undefined,error:action.error,failureCount:state.failureCount+1,isPaused:false,status:"error"});case"setState":return _extends$1({},state,action.state);default:return state}}var MutationCache=function(_Subscribable){_inheritsLoose(MutationCache,_Subscribable);function MutationCache(config){var _this;_this=_Subscribable.call(this)||this;_this.config=config||{};_this.mutations=[];_this.mutationId=0;return _this}var _proto=MutationCache.prototype;_proto.build=function build(client,options,state){var mutation=new Mutation({mutationCache:this,mutationId:++this.mutationId,options:client.defaultMutationOptions(options),state:state,defaultOptions:options.mutationKey?client.getMutationDefaults(options.mutationKey):undefined,meta:options.meta});this.add(mutation);return mutation};_proto.add=function add(mutation){this.mutations.push(mutation);this.notify(mutation)};_proto.remove=function remove(mutation){this.mutations=this.mutations.filter(function(x){return x!==mutation});mutation.cancel();this.notify(mutation)};_proto.clear=function clear(){var _this2=this;notifyManager.batch(function(){_this2.mutations.forEach(function(mutation){_this2.remove(mutation)})})};_proto.getAll=function getAll(){return this.mutations};_proto.find=function find(filters){if(typeof filters.exact==="undefined"){filters.exact=true}return this.mutations.find(function(mutation){return matchMutation(filters,mutation)})};_proto.findAll=function findAll(filters){return this.mutations.filter(function(mutation){return matchMutation(filters,mutation)})};_proto.notify=function notify(mutation){var _this3=this;notifyManager.batch(function(){_this3.listeners.forEach(function(listener){listener(mutation)})})};_proto.onFocus=function onFocus(){this.resumePausedMutations()};_proto.onOnline=function onOnline(){this.resumePausedMutations()};_proto.resumePausedMutations=function resumePausedMutations(){var pausedMutations=this.mutations.filter(function(x){return x.state.isPaused});return notifyManager.batch(function(){return pausedMutations.reduce(function(promise,mutation){return promise.then(function(){return mutation["continue"]()["catch"](noop$1)})},Promise.resolve())})};return MutationCache}(Subscribable);function infiniteQueryBehavior(){return{onFetch:function onFetch(context){context.fetchFn=function(){var _context$fetchOptions,_context$fetchOptions2,_context$fetchOptions3,_context$fetchOptions4,_context$state$data,_context$state$data2;var refetchPage=(_context$fetchOptions=context.fetchOptions)==null?void 0:(_context$fetchOptions2=_context$fetchOptions.meta)==null?void 0:_context$fetchOptions2.refetchPage;var fetchMore=(_context$fetchOptions3=context.fetchOptions)==null?void 0:(_context$fetchOptions4=_context$fetchOptions3.meta)==null?void 0:_context$fetchOptions4.fetchMore;var pageParam=fetchMore==null?void 0:fetchMore.pageParam;var isFetchingNextPage=(fetchMore==null?void 0:fetchMore.direction)==="forward";var isFetchingPreviousPage=(fetchMore==null?void 0:fetchMore.direction)==="backward";var oldPages=((_context$state$data=context.state.data)==null?void 0:_context$state$data.pages)||[];var oldPageParams=((_context$state$data2=context.state.data)==null?void 0:_context$state$data2.pageParams)||[];var abortController=getAbortController();var abortSignal=abortController==null?void 0:abortController.signal;var newPageParams=oldPageParams;var cancelled=false;var queryFn=context.options.queryFn||function(){return Promise.reject("Missing queryFn")};var buildNewPages=function buildNewPages(pages,param,page,previous){newPageParams=previous?[param].concat(newPageParams):[].concat(newPageParams,[param]);return previous?[page].concat(pages):[].concat(pages,[page])};var fetchPage=function fetchPage(pages,manual,param,previous){if(cancelled){return Promise.reject("Cancelled")}if(typeof param==="undefined"&&!manual&&pages.length){return Promise.resolve(pages)}var queryFnContext={queryKey:context.queryKey,signal:abortSignal,pageParam:param,meta:context.meta};var queryFnResult=queryFn(queryFnContext);var promise=Promise.resolve(queryFnResult).then(function(page){return buildNewPages(pages,param,page,previous)});if(isCancelable(queryFnResult)){var promiseAsAny=promise;promiseAsAny.cancel=queryFnResult.cancel}return promise};var promise;if(!oldPages.length){promise=fetchPage([])}else if(isFetchingNextPage){var manual=typeof pageParam!=="undefined";var param=manual?pageParam:getNextPageParam(context.options,oldPages);promise=fetchPage(oldPages,manual,param)}else if(isFetchingPreviousPage){var _manual=typeof pageParam!=="undefined";var _param=_manual?pageParam:getPreviousPageParam(context.options,oldPages);promise=fetchPage(oldPages,_manual,_param,true)}else{(function(){newPageParams=[];var manual=typeof context.options.getNextPageParam==="undefined";var shouldFetchFirstPage=refetchPage&&oldPages[0]?refetchPage(oldPages[0],0,oldPages):true;promise=shouldFetchFirstPage?fetchPage([],manual,oldPageParams[0]):Promise.resolve(buildNewPages([],oldPageParams[0],oldPages[0]));var _loop=function _loop(i){promise=promise.then(function(pages){var shouldFetchNextPage=refetchPage&&oldPages[i]?refetchPage(oldPages[i],i,oldPages):true;if(shouldFetchNextPage){var _param2=manual?oldPageParams[i]:getNextPageParam(context.options,pages);return fetchPage(pages,manual,_param2)}return Promise.resolve(buildNewPages(pages,oldPageParams[i],oldPages[i]))})};for(var i=1;i<oldPages.length;i++){_loop(i)}})()}var finalPromise=promise.then(function(pages){return{pages:pages,pageParams:newPageParams}});var finalPromiseAsAny=finalPromise;finalPromiseAsAny.cancel=function(){cancelled=true;abortController==null?void 0:abortController.abort();if(isCancelable(promise)){promise.cancel()}};return finalPromise}}}}function getNextPageParam(options,pages){return options.getNextPageParam==null?void 0:options.getNextPageParam(pages[pages.length-1],pages)}function getPreviousPageParam(options,pages){return options.getPreviousPageParam==null?void 0:options.getPreviousPageParam(pages[0],pages)}function hasNextPage(options,pages){if(options.getNextPageParam&&Array.isArray(pages)){var nextPageParam=getNextPageParam(options,pages);return typeof nextPageParam!=="undefined"&&nextPageParam!==null&&nextPageParam!==false}}function hasPreviousPage(options,pages){if(options.getPreviousPageParam&&Array.isArray(pages)){var previousPageParam=getPreviousPageParam(options,pages);return typeof previousPageParam!=="undefined"&&previousPageParam!==null&&previousPageParam!==false}}var QueryClient=function(){function QueryClient(config){if(config===void 0){config={}}this.queryCache=config.queryCache||new QueryCache;this.mutationCache=config.mutationCache||new MutationCache;this.defaultOptions=config.defaultOptions||{};this.queryDefaults=[];this.mutationDefaults=[]}var _proto=QueryClient.prototype;_proto.mount=function mount(){var _this=this;this.unsubscribeFocus=focusManager$1.subscribe(function(){if(focusManager$1.isFocused()&&onlineManager.isOnline()){_this.mutationCache.onFocus();_this.queryCache.onFocus()}});this.unsubscribeOnline=onlineManager.subscribe(function(){if(focusManager$1.isFocused()&&onlineManager.isOnline()){_this.mutationCache.onOnline();_this.queryCache.onOnline()}})};_proto.unmount=function unmount(){var _this$unsubscribeFocu,_this$unsubscribeOnli;(_this$unsubscribeFocu=this.unsubscribeFocus)==null?void 0:_this$unsubscribeFocu.call(this);(_this$unsubscribeOnli=this.unsubscribeOnline)==null?void 0:_this$unsubscribeOnli.call(this)};_proto.isFetching=function isFetching(arg1,arg2){var _parseFilterArgs=parseFilterArgs(arg1,arg2),filters=_parseFilterArgs[0];filters.fetching=true;return this.queryCache.findAll(filters).length};_proto.isMutating=function isMutating(filters){return this.mutationCache.findAll(_extends$1({},filters,{fetching:true})).length};_proto.getQueryData=function getQueryData(queryKey,filters){var _this$queryCache$find;return(_this$queryCache$find=this.queryCache.find(queryKey,filters))==null?void 0:_this$queryCache$find.state.data};_proto.getQueriesData=function getQueriesData(queryKeyOrFilters){return this.getQueryCache().findAll(queryKeyOrFilters).map(function(_ref){var queryKey=_ref.queryKey,state=_ref.state;var data=state.data;return[queryKey,data]})};_proto.setQueryData=function setQueryData(queryKey,updater,options){var parsedOptions=parseQueryArgs(queryKey);var defaultedOptions=this.defaultQueryOptions(parsedOptions);return this.queryCache.build(this,defaultedOptions).setData(updater,options)};_proto.setQueriesData=function setQueriesData(queryKeyOrFilters,updater,options){var _this2=this;return notifyManager.batch(function(){return _this2.getQueryCache().findAll(queryKeyOrFilters).map(function(_ref2){var queryKey=_ref2.queryKey;return[queryKey,_this2.setQueryData(queryKey,updater,options)]})})};_proto.getQueryState=function getQueryState(queryKey,filters){var _this$queryCache$find2;return(_this$queryCache$find2=this.queryCache.find(queryKey,filters))==null?void 0:_this$queryCache$find2.state};_proto.removeQueries=function removeQueries(arg1,arg2){var _parseFilterArgs2=parseFilterArgs(arg1,arg2),filters=_parseFilterArgs2[0];var queryCache=this.queryCache;notifyManager.batch(function(){queryCache.findAll(filters).forEach(function(query){queryCache.remove(query)})})};_proto.resetQueries=function resetQueries(arg1,arg2,arg3){var _this3=this;var _parseFilterArgs3=parseFilterArgs(arg1,arg2,arg3),filters=_parseFilterArgs3[0],options=_parseFilterArgs3[1];var queryCache=this.queryCache;var refetchFilters=_extends$1({},filters,{active:true});return notifyManager.batch(function(){queryCache.findAll(filters).forEach(function(query){query.reset()});return _this3.refetchQueries(refetchFilters,options)})};_proto.cancelQueries=function cancelQueries(arg1,arg2,arg3){var _this4=this;var _parseFilterArgs4=parseFilterArgs(arg1,arg2,arg3),filters=_parseFilterArgs4[0],_parseFilterArgs4$=_parseFilterArgs4[1],cancelOptions=_parseFilterArgs4$===void 0?{}:_parseFilterArgs4$;if(typeof cancelOptions.revert==="undefined"){cancelOptions.revert=true}var promises=notifyManager.batch(function(){return _this4.queryCache.findAll(filters).map(function(query){return query.cancel(cancelOptions)})});return Promise.all(promises).then(noop$1)["catch"](noop$1)};_proto.invalidateQueries=function invalidateQueries(arg1,arg2,arg3){var _ref3,_filters$refetchActiv,_filters$refetchInact,_this5=this;var _parseFilterArgs5=parseFilterArgs(arg1,arg2,arg3),filters=_parseFilterArgs5[0],options=_parseFilterArgs5[1];var refetchFilters=_extends$1({},filters,{active:(_ref3=(_filters$refetchActiv=filters.refetchActive)!=null?_filters$refetchActiv:filters.active)!=null?_ref3:true,inactive:(_filters$refetchInact=filters.refetchInactive)!=null?_filters$refetchInact:false});return notifyManager.batch(function(){_this5.queryCache.findAll(filters).forEach(function(query){query.invalidate()});return _this5.refetchQueries(refetchFilters,options)})};_proto.refetchQueries=function refetchQueries(arg1,arg2,arg3){var _this6=this;var _parseFilterArgs6=parseFilterArgs(arg1,arg2,arg3),filters=_parseFilterArgs6[0],options=_parseFilterArgs6[1];var promises=notifyManager.batch(function(){return _this6.queryCache.findAll(filters).map(function(query){return query.fetch(undefined,_extends$1({},options,{meta:{refetchPage:filters==null?void 0:filters.refetchPage}}))})});var promise=Promise.all(promises).then(noop$1);if(!(options==null?void 0:options.throwOnError)){promise=promise["catch"](noop$1)}return promise};_proto.fetchQuery=function fetchQuery(arg1,arg2,arg3){var parsedOptions=parseQueryArgs(arg1,arg2,arg3);var defaultedOptions=this.defaultQueryOptions(parsedOptions);if(typeof defaultedOptions.retry==="undefined"){defaultedOptions.retry=false}var query=this.queryCache.build(this,defaultedOptions);return query.isStaleByTime(defaultedOptions.staleTime)?query.fetch(defaultedOptions):Promise.resolve(query.state.data)};_proto.prefetchQuery=function prefetchQuery(arg1,arg2,arg3){return this.fetchQuery(arg1,arg2,arg3).then(noop$1)["catch"](noop$1)};_proto.fetchInfiniteQuery=function fetchInfiniteQuery(arg1,arg2,arg3){var parsedOptions=parseQueryArgs(arg1,arg2,arg3);parsedOptions.behavior=infiniteQueryBehavior();return this.fetchQuery(parsedOptions)};_proto.prefetchInfiniteQuery=function prefetchInfiniteQuery(arg1,arg2,arg3){return this.fetchInfiniteQuery(arg1,arg2,arg3).then(noop$1)["catch"](noop$1)};_proto.cancelMutations=function cancelMutations(){var _this7=this;var promises=notifyManager.batch(function(){return _this7.mutationCache.getAll().map(function(mutation){return mutation.cancel()})});return Promise.all(promises).then(noop$1)["catch"](noop$1)};_proto.resumePausedMutations=function resumePausedMutations(){return this.getMutationCache().resumePausedMutations()};_proto.executeMutation=function executeMutation(options){return this.mutationCache.build(this,options).execute()};_proto.getQueryCache=function getQueryCache(){return this.queryCache};_proto.getMutationCache=function getMutationCache(){return this.mutationCache};_proto.getDefaultOptions=function getDefaultOptions(){return this.defaultOptions};_proto.setDefaultOptions=function setDefaultOptions(options){this.defaultOptions=options};_proto.setQueryDefaults=function setQueryDefaults(queryKey,options){var result=this.queryDefaults.find(function(x){return hashQueryKey(queryKey)===hashQueryKey(x.queryKey)});if(result){result.defaultOptions=options}else{this.queryDefaults.push({queryKey:queryKey,defaultOptions:options})}};_proto.getQueryDefaults=function getQueryDefaults(queryKey){var _this$queryDefaults$f;return queryKey?(_this$queryDefaults$f=this.queryDefaults.find(function(x){return partialMatchKey(queryKey,x.queryKey)}))==null?void 0:_this$queryDefaults$f.defaultOptions:undefined};_proto.setMutationDefaults=function setMutationDefaults(mutationKey,options){var result=this.mutationDefaults.find(function(x){return hashQueryKey(mutationKey)===hashQueryKey(x.mutationKey)});if(result){result.defaultOptions=options}else{this.mutationDefaults.push({mutationKey:mutationKey,defaultOptions:options})}};_proto.getMutationDefaults=function getMutationDefaults(mutationKey){var _this$mutationDefault;return mutationKey?(_this$mutationDefault=this.mutationDefaults.find(function(x){return partialMatchKey(mutationKey,x.mutationKey)}))==null?void 0:_this$mutationDefault.defaultOptions:undefined};_proto.defaultQueryOptions=function defaultQueryOptions(options){if(options==null?void 0:options._defaulted){return options}var defaultedOptions=_extends$1({},this.defaultOptions.queries,this.getQueryDefaults(options==null?void 0:options.queryKey),options,{_defaulted:true});if(!defaultedOptions.queryHash&&defaultedOptions.queryKey){defaultedOptions.queryHash=hashQueryKeyByOptions(defaultedOptions.queryKey,defaultedOptions)}return defaultedOptions};_proto.defaultQueryObserverOptions=function defaultQueryObserverOptions(options){return this.defaultQueryOptions(options)};_proto.defaultMutationOptions=function defaultMutationOptions(options){if(options==null?void 0:options._defaulted){return options}return _extends$1({},this.defaultOptions.mutations,this.getMutationDefaults(options==null?void 0:options.mutationKey),options,{_defaulted:true})};_proto.clear=function clear(){this.queryCache.clear();this.mutationCache.clear()};return QueryClient}();var QueryObserver=function(_Subscribable){_inheritsLoose(QueryObserver,_Subscribable);function QueryObserver(client,options){var _this;_this=_Subscribable.call(this)||this;_this.client=client;_this.options=options;_this.trackedProps=[];_this.selectError=null;_this.bindMethods();_this.setOptions(options);return _this}var _proto=QueryObserver.prototype;_proto.bindMethods=function bindMethods(){this.remove=this.remove.bind(this);this.refetch=this.refetch.bind(this)};_proto.onSubscribe=function onSubscribe(){if(this.listeners.length===1){this.currentQuery.addObserver(this);if(shouldFetchOnMount(this.currentQuery,this.options)){this.executeFetch()}this.updateTimers()}};_proto.onUnsubscribe=function onUnsubscribe(){if(!this.listeners.length){this.destroy()}};_proto.shouldFetchOnReconnect=function shouldFetchOnReconnect(){return shouldFetchOn(this.currentQuery,this.options,this.options.refetchOnReconnect)};_proto.shouldFetchOnWindowFocus=function shouldFetchOnWindowFocus(){return shouldFetchOn(this.currentQuery,this.options,this.options.refetchOnWindowFocus)};_proto.destroy=function destroy(){this.listeners=[];this.clearTimers();this.currentQuery.removeObserver(this)};_proto.setOptions=function setOptions(options,notifyOptions){var prevOptions=this.options;var prevQuery=this.currentQuery;this.options=this.client.defaultQueryObserverOptions(options);if(typeof this.options.enabled!=="undefined"&&typeof this.options.enabled!=="boolean"){throw new Error("Expected enabled to be a boolean")}if(!this.options.queryKey){this.options.queryKey=prevOptions.queryKey}this.updateQuery();var mounted=this.hasListeners();if(mounted&&shouldFetchOptionally(this.currentQuery,prevQuery,this.options,prevOptions)){this.executeFetch()}this.updateResult(notifyOptions);if(mounted&&(this.currentQuery!==prevQuery||this.options.enabled!==prevOptions.enabled||this.options.staleTime!==prevOptions.staleTime)){this.updateStaleTimeout()}var nextRefetchInterval=this.computeRefetchInterval();if(mounted&&(this.currentQuery!==prevQuery||this.options.enabled!==prevOptions.enabled||nextRefetchInterval!==this.currentRefetchInterval)){this.updateRefetchInterval(nextRefetchInterval)}};_proto.getOptimisticResult=function getOptimisticResult(options){var defaultedOptions=this.client.defaultQueryObserverOptions(options);var query=this.client.getQueryCache().build(this.client,defaultedOptions);return this.createResult(query,defaultedOptions)};_proto.getCurrentResult=function getCurrentResult(){return this.currentResult};_proto.trackResult=function trackResult(result,defaultedOptions){var _this2=this;var trackedResult={};var trackProp=function trackProp(key){if(!_this2.trackedProps.includes(key)){_this2.trackedProps.push(key)}};Object.keys(result).forEach(function(key){Object.defineProperty(trackedResult,key,{configurable:false,enumerable:true,get:function get(){trackProp(key);return result[key]}})});if(defaultedOptions.useErrorBoundary||defaultedOptions.suspense){trackProp("error")}return trackedResult};_proto.getNextResult=function getNextResult(options){var _this3=this;return new Promise(function(resolve,reject){var unsubscribe=_this3.subscribe(function(result){if(!result.isFetching){unsubscribe();if(result.isError&&(options==null?void 0:options.throwOnError)){reject(result.error)}else{resolve(result)}}})})};_proto.getCurrentQuery=function getCurrentQuery(){return this.currentQuery};_proto.remove=function remove(){this.client.getQueryCache().remove(this.currentQuery)};_proto.refetch=function refetch(options){return this.fetch(_extends$1({},options,{meta:{refetchPage:options==null?void 0:options.refetchPage}}))};_proto.fetchOptimistic=function fetchOptimistic(options){var _this4=this;var defaultedOptions=this.client.defaultQueryObserverOptions(options);var query=this.client.getQueryCache().build(this.client,defaultedOptions);return query.fetch().then(function(){return _this4.createResult(query,defaultedOptions)})};_proto.fetch=function fetch(fetchOptions){var _this5=this;return this.executeFetch(fetchOptions).then(function(){_this5.updateResult();return _this5.currentResult})};_proto.executeFetch=function executeFetch(fetchOptions){this.updateQuery();var promise=this.currentQuery.fetch(this.options,fetchOptions);if(!(fetchOptions==null?void 0:fetchOptions.throwOnError)){promise=promise["catch"](noop$1)}return promise};_proto.updateStaleTimeout=function updateStaleTimeout(){var _this6=this;this.clearStaleTimeout();if(isServer||this.currentResult.isStale||!isValidTimeout(this.options.staleTime)){return}var time=timeUntilStale(this.currentResult.dataUpdatedAt,this.options.staleTime);var timeout=time+1;this.staleTimeoutId=setTimeout(function(){if(!_this6.currentResult.isStale){_this6.updateResult()}},timeout)};_proto.computeRefetchInterval=function computeRefetchInterval(){var _this$options$refetch;return typeof this.options.refetchInterval==="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(_this$options$refetch=this.options.refetchInterval)!=null?_this$options$refetch:false};_proto.updateRefetchInterval=function updateRefetchInterval(nextInterval){var _this7=this;this.clearRefetchInterval();this.currentRefetchInterval=nextInterval;if(isServer||this.options.enabled===false||!isValidTimeout(this.currentRefetchInterval)||this.currentRefetchInterval===0){return}this.refetchIntervalId=setInterval(function(){if(_this7.options.refetchIntervalInBackground||focusManager$1.isFocused()){_this7.executeFetch()}},this.currentRefetchInterval)};_proto.updateTimers=function updateTimers(){this.updateStaleTimeout();this.updateRefetchInterval(this.computeRefetchInterval())};_proto.clearTimers=function clearTimers(){this.clearStaleTimeout();this.clearRefetchInterval()};_proto.clearStaleTimeout=function clearStaleTimeout(){if(this.staleTimeoutId){clearTimeout(this.staleTimeoutId);this.staleTimeoutId=undefined}};_proto.clearRefetchInterval=function clearRefetchInterval(){if(this.refetchIntervalId){clearInterval(this.refetchIntervalId);this.refetchIntervalId=undefined}};_proto.createResult=function createResult(query,options){var prevQuery=this.currentQuery;var prevOptions=this.options;var prevResult=this.currentResult;var prevResultState=this.currentResultState;var prevResultOptions=this.currentResultOptions;var queryChange=query!==prevQuery;var queryInitialState=queryChange?query.state:this.currentQueryInitialState;var prevQueryResult=queryChange?this.currentResult:this.previousQueryResult;var state=query.state;var dataUpdatedAt=state.dataUpdatedAt,error=state.error,errorUpdatedAt=state.errorUpdatedAt,isFetching=state.isFetching,status=state.status;var isPreviousData=false;var isPlaceholderData=false;var data;if(options.optimisticResults){var mounted=this.hasListeners();var fetchOnMount=!mounted&&shouldFetchOnMount(query,options);var fetchOptionally=mounted&&shouldFetchOptionally(query,prevQuery,options,prevOptions);if(fetchOnMount||fetchOptionally){isFetching=true;if(!dataUpdatedAt){status="loading"}}}if(options.keepPreviousData&&!state.dataUpdateCount&&(prevQueryResult==null?void 0:prevQueryResult.isSuccess)&&status!=="error"){data=prevQueryResult.data;dataUpdatedAt=prevQueryResult.dataUpdatedAt;status=prevQueryResult.status;isPreviousData=true}else if(options.select&&typeof state.data!=="undefined"){if(prevResult&&state.data===(prevResultState==null?void 0:prevResultState.data)&&options.select===this.selectFn){data=this.selectResult}else{try{this.selectFn=options.select;data=options.select(state.data);if(options.structuralSharing!==false){data=replaceEqualDeep(prevResult==null?void 0:prevResult.data,data)}this.selectResult=data;this.selectError=null}catch(selectError){getLogger().error(selectError);this.selectError=selectError}}}else{data=state.data}if(typeof options.placeholderData!=="undefined"&&typeof data==="undefined"&&(status==="loading"||status==="idle")){var placeholderData;if((prevResult==null?void 0:prevResult.isPlaceholderData)&&options.placeholderData===(prevResultOptions==null?void 0:prevResultOptions.placeholderData)){placeholderData=prevResult.data}else{placeholderData=typeof options.placeholderData==="function"?options.placeholderData():options.placeholderData;if(options.select&&typeof placeholderData!=="undefined"){try{placeholderData=options.select(placeholderData);if(options.structuralSharing!==false){placeholderData=replaceEqualDeep(prevResult==null?void 0:prevResult.data,placeholderData)}this.selectError=null}catch(selectError){getLogger().error(selectError);this.selectError=selectError}}}if(typeof placeholderData!=="undefined"){status="success";data=placeholderData;isPlaceholderData=true}}if(this.selectError){error=this.selectError;data=this.selectResult;errorUpdatedAt=Date.now();status="error"}var result={status:status,isLoading:status==="loading",isSuccess:status==="success",isError:status==="error",isIdle:status==="idle",data:data,dataUpdatedAt:dataUpdatedAt,error:error,errorUpdatedAt:errorUpdatedAt,failureCount:state.fetchFailureCount,errorUpdateCount:state.errorUpdateCount,isFetched:state.dataUpdateCount>0||state.errorUpdateCount>0,isFetchedAfterMount:state.dataUpdateCount>queryInitialState.dataUpdateCount||state.errorUpdateCount>queryInitialState.errorUpdateCount,isFetching:isFetching,isRefetching:isFetching&&status!=="loading",isLoadingError:status==="error"&&state.dataUpdatedAt===0,isPlaceholderData:isPlaceholderData,isPreviousData:isPreviousData,isRefetchError:status==="error"&&state.dataUpdatedAt!==0,isStale:isStale(query,options),refetch:this.refetch,remove:this.remove};return result};_proto.shouldNotifyListeners=function shouldNotifyListeners(result,prevResult){if(!prevResult){return true}var _this$options=this.options,notifyOnChangeProps=_this$options.notifyOnChangeProps,notifyOnChangePropsExclusions=_this$options.notifyOnChangePropsExclusions;if(!notifyOnChangeProps&&!notifyOnChangePropsExclusions){return true}if(notifyOnChangeProps==="tracked"&&!this.trackedProps.length){return true}var includedProps=notifyOnChangeProps==="tracked"?this.trackedProps:notifyOnChangeProps;return Object.keys(result).some(function(key){var typedKey=key;var changed=result[typedKey]!==prevResult[typedKey];var isIncluded=includedProps==null?void 0:includedProps.some(function(x){return x===key});var isExcluded=notifyOnChangePropsExclusions==null?void 0:notifyOnChangePropsExclusions.some(function(x){return x===key});return changed&&!isExcluded&&(!includedProps||isIncluded)})};_proto.updateResult=function updateResult(notifyOptions){var prevResult=this.currentResult;this.currentResult=this.createResult(this.currentQuery,this.options);this.currentResultState=this.currentQuery.state;this.currentResultOptions=this.options;if(shallowEqualObjects(this.currentResult,prevResult)){return}var defaultNotifyOptions={cache:true};if((notifyOptions==null?void 0:notifyOptions.listeners)!==false&&this.shouldNotifyListeners(this.currentResult,prevResult)){defaultNotifyOptions.listeners=true}this.notify(_extends$1({},defaultNotifyOptions,notifyOptions))};_proto.updateQuery=function updateQuery(){var query=this.client.getQueryCache().build(this.client,this.options);if(query===this.currentQuery){return}var prevQuery=this.currentQuery;this.currentQuery=query;this.currentQueryInitialState=query.state;this.previousQueryResult=this.currentResult;if(this.hasListeners()){prevQuery==null?void 0:prevQuery.removeObserver(this);query.addObserver(this)}};_proto.onQueryUpdate=function onQueryUpdate(action){var notifyOptions={};if(action.type==="success"){notifyOptions.onSuccess=true}else if(action.type==="error"&&!isCancelledError(action.error)){notifyOptions.onError=true}this.updateResult(notifyOptions);if(this.hasListeners()){this.updateTimers()}};_proto.notify=function notify(notifyOptions){var _this8=this;notifyManager.batch(function(){if(notifyOptions.onSuccess){_this8.options.onSuccess==null?void 0:_this8.options.onSuccess(_this8.currentResult.data);_this8.options.onSettled==null?void 0:_this8.options.onSettled(_this8.currentResult.data,null)}else if(notifyOptions.onError){_this8.options.onError==null?void 0:_this8.options.onError(_this8.currentResult.error);_this8.options.onSettled==null?void 0:_this8.options.onSettled(undefined,_this8.currentResult.error)}if(notifyOptions.listeners){_this8.listeners.forEach(function(listener){listener(_this8.currentResult)})}if(notifyOptions.cache){_this8.client.getQueryCache().notify({query:_this8.currentQuery,type:"observerResultsUpdated"})}})};return QueryObserver}(Subscribable);function shouldLoadOnMount(query,options){return options.enabled!==false&&!query.state.dataUpdatedAt&&!(query.state.status==="error"&&options.retryOnMount===false)}function shouldFetchOnMount(query,options){return shouldLoadOnMount(query,options)||query.state.dataUpdatedAt>0&&shouldFetchOn(query,options,options.refetchOnMount)}function shouldFetchOn(query,options,field){if(options.enabled!==false){var value=typeof field==="function"?field(query):field;return value==="always"||value!==false&&isStale(query,options)}return false}function shouldFetchOptionally(query,prevQuery,options,prevOptions){return options.enabled!==false&&(query!==prevQuery||prevOptions.enabled===false)&&(!options.suspense||query.state.status!=="error")&&isStale(query,options)}function isStale(query,options){return query.isStaleByTime(options.staleTime)}var InfiniteQueryObserver=function(_QueryObserver){_inheritsLoose(InfiniteQueryObserver,_QueryObserver);function InfiniteQueryObserver(client,options){return _QueryObserver.call(this,client,options)||this}var _proto=InfiniteQueryObserver.prototype;_proto.bindMethods=function bindMethods(){_QueryObserver.prototype.bindMethods.call(this);this.fetchNextPage=this.fetchNextPage.bind(this);this.fetchPreviousPage=this.fetchPreviousPage.bind(this)};_proto.setOptions=function setOptions(options,notifyOptions){_QueryObserver.prototype.setOptions.call(this,_extends$1({},options,{behavior:infiniteQueryBehavior()}),notifyOptions)};_proto.getOptimisticResult=function getOptimisticResult(options){options.behavior=infiniteQueryBehavior();return _QueryObserver.prototype.getOptimisticResult.call(this,options)};_proto.fetchNextPage=function fetchNextPage(options){var _options$cancelRefetc;return this.fetch({cancelRefetch:(_options$cancelRefetc=options==null?void 0:options.cancelRefetch)!=null?_options$cancelRefetc:true,throwOnError:options==null?void 0:options.throwOnError,meta:{fetchMore:{direction:"forward",pageParam:options==null?void 0:options.pageParam}}})};_proto.fetchPreviousPage=function fetchPreviousPage(options){var _options$cancelRefetc2;return this.fetch({cancelRefetch:(_options$cancelRefetc2=options==null?void 0:options.cancelRefetch)!=null?_options$cancelRefetc2:true,throwOnError:options==null?void 0:options.throwOnError,meta:{fetchMore:{direction:"backward",pageParam:options==null?void 0:options.pageParam}}})};_proto.createResult=function createResult(query,options){var _state$data,_state$data2,_state$fetchMeta,_state$fetchMeta$fetc,_state$fetchMeta2,_state$fetchMeta2$fet;var state=query.state;var result=_QueryObserver.prototype.createResult.call(this,query,options);return _extends$1({},result,{fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:hasNextPage(options,(_state$data=state.data)==null?void 0:_state$data.pages),hasPreviousPage:hasPreviousPage(options,(_state$data2=state.data)==null?void 0:_state$data2.pages),isFetchingNextPage:state.isFetching&&((_state$fetchMeta=state.fetchMeta)==null?void 0:(_state$fetchMeta$fetc=_state$fetchMeta.fetchMore)==null?void 0:_state$fetchMeta$fetc.direction)==="forward",isFetchingPreviousPage:state.isFetching&&((_state$fetchMeta2=state.fetchMeta)==null?void 0:(_state$fetchMeta2$fet=_state$fetchMeta2.fetchMore)==null?void 0:_state$fetchMeta2$fet.direction)==="backward"})};return InfiniteQueryObserver}(QueryObserver);var MutationObserver$1=function(_Subscribable){_inheritsLoose(MutationObserver,_Subscribable);function MutationObserver(client,options){var _this;_this=_Subscribable.call(this)||this;_this.client=client;_this.setOptions(options);_this.bindMethods();_this.updateResult();return _this}var _proto=MutationObserver.prototype;_proto.bindMethods=function bindMethods(){this.mutate=this.mutate.bind(this);this.reset=this.reset.bind(this)};_proto.setOptions=function setOptions(options){this.options=this.client.defaultMutationOptions(options)};_proto.onUnsubscribe=function onUnsubscribe(){if(!this.listeners.length){var _this$currentMutation;(_this$currentMutation=this.currentMutation)==null?void 0:_this$currentMutation.removeObserver(this)}};_proto.onMutationUpdate=function onMutationUpdate(action){this.updateResult();var notifyOptions={listeners:true};if(action.type==="success"){notifyOptions.onSuccess=true}else if(action.type==="error"){notifyOptions.onError=true}this.notify(notifyOptions)};_proto.getCurrentResult=function getCurrentResult(){return this.currentResult};_proto.reset=function reset(){this.currentMutation=undefined;this.updateResult();this.notify({listeners:true})};_proto.mutate=function mutate(variables,options){this.mutateOptions=options;if(this.currentMutation){this.currentMutation.removeObserver(this)}this.currentMutation=this.client.getMutationCache().build(this.client,_extends$1({},this.options,{variables:typeof variables!=="undefined"?variables:this.options.variables}));this.currentMutation.addObserver(this);return this.currentMutation.execute()};_proto.updateResult=function updateResult(){var state=this.currentMutation?this.currentMutation.state:getDefaultState();var result=_extends$1({},state,{isLoading:state.status==="loading",isSuccess:state.status==="success",isError:state.status==="error",isIdle:state.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=result};_proto.notify=function notify(options){var _this2=this;notifyManager.batch(function(){if(_this2.mutateOptions){if(options.onSuccess){_this2.mutateOptions.onSuccess==null?void 0:_this2.mutateOptions.onSuccess(_this2.currentResult.data,_this2.currentResult.variables,_this2.currentResult.context);_this2.mutateOptions.onSettled==null?void 0:_this2.mutateOptions.onSettled(_this2.currentResult.data,null,_this2.currentResult.variables,_this2.currentResult.context)}else if(options.onError){_this2.mutateOptions.onError==null?void 0:_this2.mutateOptions.onError(_this2.currentResult.error,_this2.currentResult.variables,_this2.currentResult.context);_this2.mutateOptions.onSettled==null?void 0:_this2.mutateOptions.onSettled(undefined,_this2.currentResult.error,_this2.currentResult.variables,_this2.currentResult.context)}}if(options.listeners){_this2.listeners.forEach(function(listener){listener(_this2.currentResult)})}})};return MutationObserver}(Subscribable);var unstable_batchedUpdates=ReactDOM.unstable_batchedUpdates;notifyManager.setBatchNotifyFunction(unstable_batchedUpdates);var logger=console;setLogger(logger);var defaultContext=React.createContext(undefined);var QueryClientSharingContext=React.createContext(false);function getQueryClientContext(contextSharing){if(contextSharing&&typeof window!=="undefined"){if(!window.ReactQueryClientContext){window.ReactQueryClientContext=defaultContext}return window.ReactQueryClientContext}return defaultContext}var useQueryClient=function useQueryClient(){var queryClient=React.useContext(getQueryClientContext(React.useContext(QueryClientSharingContext)));if(!queryClient){throw new Error("No QueryClient set, use QueryClientProvider to set one")}return queryClient};var QueryClientProvider=function QueryClientProvider(_ref){var client=_ref.client,_ref$contextSharing=_ref.contextSharing,contextSharing=_ref$contextSharing===void 0?false:_ref$contextSharing,children=_ref.children;React.useEffect(function(){client.mount();return function(){client.unmount()}},[client]);var Context=getQueryClientContext(contextSharing);return React.createElement(QueryClientSharingContext.Provider,{value:contextSharing},React.createElement(Context.Provider,{value:client},children))};function createValue(){var _isReset=false;return{clearReset:function clearReset(){_isReset=false},reset:function reset(){_isReset=true},isReset:function isReset(){return _isReset}}}var QueryErrorResetBoundaryContext=React.createContext(createValue());var useQueryErrorResetBoundary=function useQueryErrorResetBoundary(){return React.useContext(QueryErrorResetBoundaryContext)};function shouldThrowError(suspense,_useErrorBoundary,params){if(typeof _useErrorBoundary==="function"){return _useErrorBoundary.apply(void 0,params)}if(typeof _useErrorBoundary==="boolean")return _useErrorBoundary;return!!suspense}function useMutation(arg1,arg2,arg3){var mountedRef=React.useRef(false);var _React$useState=React.useState(0),forceUpdate=_React$useState[1];var options=parseMutationArgs(arg1,arg2,arg3);var queryClient=useQueryClient();var obsRef=React.useRef();if(!obsRef.current){obsRef.current=new MutationObserver$1(queryClient,options)}else{obsRef.current.setOptions(options)}var currentResult=obsRef.current.getCurrentResult();React.useEffect(function(){mountedRef.current=true;var unsubscribe=obsRef.current.subscribe(notifyManager.batchCalls(function(){if(mountedRef.current){forceUpdate(function(x){return x+1})}}));return function(){mountedRef.current=false;unsubscribe()}},[]);var mutate=React.useCallback(function(variables,mutateOptions){obsRef.current.mutate(variables,mutateOptions)["catch"](noop$1)},[]);if(currentResult.error&&shouldThrowError(undefined,obsRef.current.options.useErrorBoundary,[currentResult.error])){throw currentResult.error}return _extends$1({},currentResult,{mutate:mutate,mutateAsync:currentResult.mutate})}function useBaseQuery(options,Observer){var mountedRef=React.useRef(false);var _React$useState=React.useState(0),forceUpdate=_React$useState[1];var queryClient=useQueryClient();var errorResetBoundary=useQueryErrorResetBoundary();var defaultedOptions=queryClient.defaultQueryObserverOptions(options);defaultedOptions.optimisticResults=true;if(defaultedOptions.onError){defaultedOptions.onError=notifyManager.batchCalls(defaultedOptions.onError)}if(defaultedOptions.onSuccess){defaultedOptions.onSuccess=notifyManager.batchCalls(defaultedOptions.onSuccess)}if(defaultedOptions.onSettled){defaultedOptions.onSettled=notifyManager.batchCalls(defaultedOptions.onSettled)}if(defaultedOptions.suspense){if(typeof defaultedOptions.staleTime!=="number"){defaultedOptions.staleTime=1000}if(defaultedOptions.cacheTime===0){defaultedOptions.cacheTime=1}}if(defaultedOptions.suspense||defaultedOptions.useErrorBoundary){if(!errorResetBoundary.isReset()){defaultedOptions.retryOnMount=false}}var _React$useState2=React.useState(function(){return new Observer(queryClient,defaultedOptions)}),observer=_React$useState2[0];var result=observer.getOptimisticResult(defaultedOptions);React.useEffect(function(){mountedRef.current=true;errorResetBoundary.clearReset();var unsubscribe=observer.subscribe(notifyManager.batchCalls(function(){if(mountedRef.current){forceUpdate(function(x){return x+1})}}));observer.updateResult();return function(){mountedRef.current=false;unsubscribe()}},[errorResetBoundary,observer]);React.useEffect(function(){observer.setOptions(defaultedOptions,{listeners:false})},[defaultedOptions,observer]);if(defaultedOptions.suspense&&result.isLoading){throw observer.fetchOptimistic(defaultedOptions).then(function(_ref){var data=_ref.data;defaultedOptions.onSuccess==null?void 0:defaultedOptions.onSuccess(data);defaultedOptions.onSettled==null?void 0:defaultedOptions.onSettled(data,null)})["catch"](function(error){errorResetBoundary.clearReset();defaultedOptions.onError==null?void 0:defaultedOptions.onError(error);defaultedOptions.onSettled==null?void 0:defaultedOptions.onSettled(undefined,error)})}if(result.isError&&!errorResetBoundary.isReset()&&!result.isFetching&&shouldThrowError(defaultedOptions.suspense,defaultedOptions.useErrorBoundary,[result.error,observer.getCurrentQuery()])){throw result.error}if(defaultedOptions.notifyOnChangeProps==="tracked"){result=observer.trackResult(result,defaultedOptions)}return result}function useQuery(arg1,arg2,arg3){var parsedOptions=parseQueryArgs(arg1,arg2,arg3);return useBaseQuery(parsedOptions,QueryObserver)}function useInfiniteQuery(arg1,arg2,arg3){var options=parseQueryArgs(arg1,arg2,arg3);return useBaseQuery(options,InfiniteQueryObserver)}function useUser(client){if(!client){throw new Error("useUser must be used within an WeavyProvider")}var getUser=function(){var _ref10=_asyncToGenerator(_regeneratorRuntime().mark(function _callee32(){var response;return _regeneratorRuntime().wrap(function _callee32$(_context33){while(1)switch(_context33.prev=_context33.next){case 0:_context33.prev=0;_context33.next=3;return client.get("/api/user");case 3:response=_context33.sent;if(!response.ok){_context33.next=8;break}_context33.next=7;return response.json();case 7:return _context33.abrupt("return",_context33.sent);case 8:console.error("Could not load Weavy user data...");return _context33.abrupt("return",null);case 12:_context33.prev=12;_context33.t0=_context33["catch"](0);console.error("Could not connect to the Weavy backend. Please make sure ".concat(client.url," is up and running!"));case 15:case"end":return _context33.stop()}},_callee32,null,[[0,12]])}));return function getUser(){return _ref10.apply(this,arguments)}}();return useQuery("user",getUser)}var UserContext=React.createContext({user:{id:-1,uid:"",username:"anonymous",name:"Anonymous",email:"",display_name:"",presence:"",avatar_url:""}});var UserProvider=function UserProvider(_ref11){var children=_ref11.children,client=_ref11.client;var _useUser=useUser(client),isLoading=_useUser.isLoading,data=_useUser.data;return React.createElement(React.Fragment,null,!isLoading&&data&&React.createElement(UserContext.Provider,{value:{user:data}},children))};var commonjsGlobal=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x["default"]:x}function getAugmentedNamespace(n){if(n.__esModule)return n;var f=n["default"];if(typeof f=="function"){var a=function a(){if(this instanceof a){return Reflect.construct(f,arguments,this.constructor)}return f.apply(this,arguments)};a.prototype=f.prototype}else a={};Object.defineProperty(a,"__esModule",{value:true});Object.keys(n).forEach(function(k){var d=Object.getOwnPropertyDescriptor(n,k);Object.defineProperty(a,k,d.get?d:{enumerable:true,get:function get(){return n[k]}})});return a}var dayjs_min={exports:{}};(function(module,exports){!function(t,e){module.exports=e()}(commonjsGlobal,function(){var t=1e3,e=6e4,n=36e5,r="millisecond",i="second",s="minute",u="hour",a="day",o="week",c="month",f="quarter",h="year",d="date",l="Invalid Date",$=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function ordinal(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},m=function m(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},v={s:m,z:function z(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+m(r,2,"0")+":"+m(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,c),s=n-i<0,u=e.clone().add(r+(s?-1:1),c);return+(-(r+(n-i)/(s?i-u:u-i))||0)},a:function a(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function p(t){return{M:c,y:h,w:o,d:a,D:d,h:u,m:s,s:i,ms:r,Q:f}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function u(t){return void 0===t}},g="en",D={};D[g]=M;var p="$isDayjsObject",S=function S(t){return t instanceof _||!(!t||!t[p])},w=function t(e,n,r){var i;if(!e)return g;if("string"==typeof e){var s=e.toLowerCase();D[s]&&(i=s),n&&(D[s]=n,i=s);var u=e.split("-");if(!i&&u.length>1)return t(u[0])}else{var a=e.name;D[a]=e,i=a}return!r&&i&&(g=i),i||!r&&g},O=function O(t,e){if(S(t))return t.clone();var n="object"==_typeof2(e)?e:{};return n.date=t,n.args=arguments,new _(n)},b=v;b.l=w,b.i=S,b.w=function(t,e){return O(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var _=function(){function M(t){this.$L=w(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[p]=!0}var m=M.prototype;return m.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(b.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match($);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.init()},m.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},m.$utils=function(){return b},m.isValid=function(){return!(this.$d.toString()===l)},m.isSame=function(t,e){var n=O(t);return this.startOf(e)<=n&&n<=this.endOf(e)},m.isAfter=function(t,e){return O(t)<this.startOf(e)},m.isBefore=function(t,e){return this.endOf(e)<O(t)},m.$g=function(t,e,n){return b.u(t)?this[e]:this.set(n,t)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(t,e){var n=this,r=!!b.u(e)||e,f=b.p(t),l=function l(t,e){var i=b.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(a)},$=function $(t,e){return b.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},y=this.$W,M=this.$M,m=this.$D,v="set"+(this.$u?"UTC":"");switch(f){case h:return r?l(1,0):l(31,11);case c:return r?l(1,M):l(0,M+1);case o:var g=this.$locale().weekStart||0,D=(y<g?y+7:y)-g;return l(r?m-D:m+(6-D),M);case a:case d:return $(v+"Hours",0);case u:return $(v+"Minutes",1);case s:return $(v+"Seconds",2);case i:return $(v+"Milliseconds",3);default:return this.clone()}},m.endOf=function(t){return this.startOf(t,!1)},m.$set=function(t,e){var n,o=b.p(t),f="set"+(this.$u?"UTC":""),l=(n={},n[a]=f+"Date",n[d]=f+"Date",n[c]=f+"Month",n[h]=f+"FullYear",n[u]=f+"Hours",n[s]=f+"Minutes",n[i]=f+"Seconds",n[r]=f+"Milliseconds",n)[o],$=o===a?this.$D+(e-this.$W):e;if(o===c||o===h){var y=this.clone().set(d,1);y.$d[l]($),y.init(),this.$d=y.set(d,Math.min(this.$D,y.daysInMonth())).$d}else l&&this.$d[l]($);return this.init(),this},m.set=function(t,e){return this.clone().$set(t,e)},m.get=function(t){return this[b.p(t)]()},m.add=function(r,f){var d,l=this;r=Number(r);var $=b.p(f),y=function y(t){var e=O(l);return b.w(e.date(e.date()+Math.round(t*r)),l)};if($===c)return this.set(c,this.$M+r);if($===h)return this.set(h,this.$y+r);if($===a)return y(1);if($===o)return y(7);var M=(d={},d[s]=e,d[u]=n,d[i]=t,d)[$]||1,m=this.$d.getTime()+r*M;return b.w(m,this)},m.subtract=function(t,e){return this.add(-1*t,e)},m.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||l;var r=t||"YYYY-MM-DDTHH:mm:ssZ",i=b.z(this),s=this.$H,u=this.$m,a=this.$M,o=n.weekdays,c=n.months,f=n.meridiem,h=function h(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].slice(0,s)},d=function d(t){return b.s(s%12||12,t,"0")},$=f||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(y,function(t,r){return r||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return b.s(e.$y,4,"0");case"M":return a+1;case"MM":return b.s(a+1,2,"0");case"MMM":return h(n.monthsShort,a,c,3);case"MMMM":return h(c,a);case"D":return e.$D;case"DD":return b.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return h(n.weekdaysMin,e.$W,o,2);case"ddd":return h(n.weekdaysShort,e.$W,o,3);case"dddd":return o[e.$W];case"H":return String(s);case"HH":return b.s(s,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return $(s,u,!0);case"A":return $(s,u,!1);case"m":return String(u);case"mm":return b.s(u,2,"0");case"s":return String(e.$s);case"ss":return b.s(e.$s,2,"0");case"SSS":return b.s(e.$ms,3,"0");case"Z":return i}return null}(t)||i.replace(":","")})},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(r,d,l){var $,y=this,M=b.p(d),m=O(r),v=(m.utcOffset()-this.utcOffset())*e,g=this-m,D=function D(){return b.m(y,m)};switch(M){case h:$=D()/12;break;case c:$=D();break;case f:$=D()/3;break;case o:$=(g-v)/6048e5;break;case a:$=(g-v)/864e5;break;case u:$=g/n;break;case s:$=g/e;break;case i:$=g/t;break;default:$=g}return l?$:b.a($)},m.daysInMonth=function(){return this.endOf(c).$D},m.$locale=function(){return D[this.$L]},m.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=w(t,e,!0);return r&&(n.$L=r),n},m.clone=function(){return b.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},M}(),k=_.prototype;return O.prototype=k,[["$ms",r],["$s",i],["$m",s],["$H",u],["$W",a],["$M",c],["$y",h],["$D",d]].forEach(function(t){k[t[1]]=function(e){return this.$g(e,t[0],t[1])}}),O.extend=function(t,e){return t.$i||(t(e,_,O),t.$i=!0),O},O.locale=w,O.isDayjs=S,O.unix=function(t){return O(1e3*t)},O.en=D[g],O.Ls=D,O.p={},O})})(dayjs_min);var dayjs_minExports=dayjs_min.exports;var dayjs=getDefaultExportFromCjs(dayjs_minExports);var relativeTime$1={exports:{}};(function(module,exports){!function(r,e){module.exports=e()}(commonjsGlobal,function(){return function(r,e,t){r=r||{};var n=e.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function i(r,e,t,o){return n.fromToBase(r,e,t,o)}t.en.relativeTime=o,n.fromToBase=function(e,n,i,d,u){for(var f,a,s,l=i.$locale().relativeTime||o,h=r.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],m=h.length,c=0;c<m;c+=1){var y=h[c];y.d&&(f=d?t(e).diff(i,y.d,!0):i.diff(e,y.d,!0));var p=(r.rounding||Math.round)(Math.abs(f));if(s=f>0,p<=y.r||!y.r){p<=1&&c>0&&(y=h[c-1]);var v=l[y.l];u&&(p=u(""+p)),a="string"==typeof v?v.replace("%d",p):v(p,n,y.l,s);break}}if(n)return a;var M=s?l.future:l.past;return"function"==typeof M?M(a):M.replace("%s",a)},n.to=function(r,e){return i(r,e,this,!0)},n.from=function(r,e){return i(r,e,this)};var d=function d(r){return r.$u?t.utc():t()};n.toNow=function(r){return this.to(d(this),r)},n.fromNow=function(r){return this.from(d(this),r)}}})})(relativeTime$1);var relativeTimeExports=relativeTime$1.exports;var relativeTime=getDefaultExportFromCjs(relativeTimeExports);var utc$1={exports:{}};(function(module,exports){!function(t,i){module.exports=i()}(commonjsGlobal,function(){var t="minute",i=/[+-]\d\d(?::?\d\d)?/g,e=/([+-]|\d\d)/g;return function(s,f,n){var u=f.prototype;n.utc=function(t){var i={date:t,utc:!0,args:arguments};return new f(i)},u.utc=function(i){var e=n(this.toDate(),{locale:this.$L,utc:!0});return i?e.add(this.utcOffset(),t):e},u.local=function(){return n(this.toDate(),{locale:this.$L,utc:!1})};var o=u.parse;u.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),o.call(this,t)};var r=u.init;u.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else r.call(this)};var a=u.utcOffset;u.utcOffset=function(s,f){var n=this.$utils().u;if(n(s))return this.$u?0:n(this.$offset)?a.call(this):this.$offset;if("string"==typeof s&&(s=function(t){void 0===t&&(t="");var s=t.match(i);if(!s)return null;var f=(""+s[0]).match(e)||["-",0,0],n=f[0],u=60*+f[1]+ +f[2];return 0===u?0:"+"===n?u:-u}(s),null===s))return this;var u=Math.abs(s)<=16?60*s:s,o=this;if(f)return o.$offset=u,o.$u=0===s,o;if(0!==s){var r=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(o=this.local().add(u+r,t)).$offset=u,o.$x.$localOffset=r}else o=this.utc();return o};var h=u.format;u.format=function(t){var i=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,i)},u.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},u.isUTC=function(){return!!this.$u},u.toISOString=function(){return this.toDate().toISOString()},u.toString=function(){return this.toDate().toUTCString()};var l=u.toDate;u.toDate=function(t){return"s"===t&&this.$offset?n(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():l.call(this)};var c=u.diff;u.diff=function(t,i,e){if(t&&this.$u===t.$u)return c.call(this,t,i,e);var s=this.local(),f=n(t).local();return c.call(s,f,i,e)}}})})(utc$1);var utcExports=utc$1.exports;var utc=getDefaultExportFromCjs(utcExports);var timezone$1={exports:{}};(function(module,exports){!function(t,e){module.exports=e()}(commonjsGlobal,function(){var t={year:0,month:1,day:2,hour:3,minute:4,second:5},e={};return function(n,i,o){var r,a=function a(t,n,i){void 0===i&&(i={});var o=new Date(t),r=function(t,n){void 0===n&&(n={});var i=n.timeZoneName||"short",o=t+"|"+i,r=e[o];return r||(r=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:i}),e[o]=r),r}(n,i);return r.formatToParts(o)},u=function u(e,n){for(var i=a(e,n),r=[],u=0;u<i.length;u+=1){var f=i[u],s=f.type,m=f.value,c=t[s];c>=0&&(r[c]=parseInt(m,10))}var d=r[3],l=24===d?0:d,h=r[0]+"-"+r[1]+"-"+r[2]+" "+l+":"+r[4]+":"+r[5]+":000",v=+e;return(o.utc(h).valueOf()-(v-=v%1e3))/6e4},f=i.prototype;f.tz=function(t,e){void 0===t&&(t=r);var n=this.utcOffset(),i=this.toDate(),a=i.toLocaleString("en-US",{timeZone:t}),u=Math.round((i-new Date(a))/1e3/60),f=o(a,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(15*-Math.round(i.getTimezoneOffset()/15)-u,!0);if(e){var s=f.utcOffset();f=f.add(n-s,"minute")}return f.$x.$timezone=t,f},f.offsetName=function(t){var e=this.$x.$timezone||o.tz.guess(),n=a(this.valueOf(),e,{timeZoneName:t}).find(function(t){return"timezonename"===t.type.toLowerCase()});return n&&n.value};var s=f.startOf;f.startOf=function(t,e){if(!this.$x||!this.$x.$timezone)return s.call(this,t,e);var n=o(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return s.call(n,t,e).tz(this.$x.$timezone,!0)},o.tz=function(t,e,n){var i=n&&e,a=n||e||r,f=u(+o(),a);if("string"!=typeof t)return o(t).tz(a);var s=function(t,e,n){var i=t-60*e*1e3,o=u(i,n);if(e===o)return[i,e];var r=u(i-=60*(o-e)*1e3,n);return o===r?[i,o]:[t-60*Math.min(o,r)*1e3,Math.max(o,r)]}(o.utc(t,i).valueOf(),f,a),m=s[0],c=s[1],d=o(m).utcOffset(c);return d.$x.$timezone=a,d},o.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},o.tz.setDefault=function(t){r=t}}})})(timezone$1);var timezoneExports=timezone$1.exports;var timezone=getDefaultExportFromCjs(timezoneExports);var localizedFormat$1={exports:{}};(function(module,exports){!function(e,t){module.exports=t()}(commonjsGlobal,function(){var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(t,o,n){var r=o.prototype,i=r.format;n.en.formats=e,r.format=function(t){void 0===t&&(t="YYYY-MM-DDTHH:mm:ssZ");var o=this.$locale().formats,n=function(t,o){return t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(t,n,r){var i=r&&r.toUpperCase();return n||o[r]||e[r]||o[i].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,o){return t||o.slice(1)})})}(t,void 0===o?{}:o);return i.call(this,n)}}})})(localizedFormat$1);var localizedFormatExports=localizedFormat$1.exports;var localizedFormat=getDefaultExportFromCjs(localizedFormatExports);var lib={exports:{}};var Modal$2={};var propTypes={exports:{}};var reactIs={exports:{}};var reactIs_production_min={};var hasRequiredReactIs_production_min;function requireReactIs_production_min(){if(hasRequiredReactIs_production_min)return reactIs_production_min;hasRequiredReactIs_production_min=1;var b="function"===typeof Symbol&&Symbol["for"],c=b?Symbol["for"]("react.element"):60103,d=b?Symbol["for"]("react.portal"):60106,e=b?Symbol["for"]("react.fragment"):60107,f=b?Symbol["for"]("react.strict_mode"):60108,g=b?Symbol["for"]("react.profiler"):60114,h=b?Symbol["for"]("react.provider"):60109,k=b?Symbol["for"]("react.context"):60110,l=b?Symbol["for"]("react.async_mode"):60111,m=b?Symbol["for"]("react.concurrent_mode"):60111,n=b?Symbol["for"]("react.forward_ref"):60112,p=b?Symbol["for"]("react.suspense"):60113,q=b?Symbol["for"]("react.suspense_list"):60120,r=b?Symbol["for"]("react.memo"):60115,t=b?Symbol["for"]("react.lazy"):60116,v=b?Symbol["for"]("react.block"):60121,w=b?Symbol["for"]("react.fundamental"):60117,x=b?Symbol["for"]("react.responder"):60118,y=b?Symbol["for"]("react.scope"):60119;function z(a){if("object"===_typeof2(a)&&null!==a){var u=a.$$typeof;switch(u){case c:switch(a=a.type,a){case l:case m:case e:case g:case f:case p:return a;default:switch(a=a&&a.$$typeof,a){case k:case n:case t:case r:case h:return a;default:return u}}case d:return u}}}function A(a){return z(a)===m}reactIs_production_min.AsyncMode=l;reactIs_production_min.ConcurrentMode=m;reactIs_production_min.ContextConsumer=k;reactIs_production_min.ContextProvider=h;reactIs_production_min.Element=c;reactIs_production_min.ForwardRef=n;reactIs_production_min.Fragment=e;reactIs_production_min.Lazy=t;reactIs_production_min.Memo=r;reactIs_production_min.Portal=d;reactIs_production_min.Profiler=g;reactIs_production_min.StrictMode=f;reactIs_production_min.Suspense=p;reactIs_production_min.isAsyncMode=function(a){return A(a)||z(a)===l};reactIs_production_min.isConcurrentMode=A;reactIs_production_min.isContextConsumer=function(a){return z(a)===k};reactIs_production_min.isContextProvider=function(a){return z(a)===h};reactIs_production_min.isElement=function(a){return"object"===_typeof2(a)&&null!==a&&a.$$typeof===c};reactIs_production_min.isForwardRef=function(a){return z(a)===n};reactIs_production_min.isFragment=function(a){return z(a)===e};reactIs_production_min.isLazy=function(a){return z(a)===t};reactIs_production_min.isMemo=function(a){return z(a)===r};reactIs_production_min.isPortal=function(a){return z(a)===d};reactIs_production_min.isProfiler=function(a){return z(a)===g};reactIs_production_min.isStrictMode=function(a){return z(a)===f};reactIs_production_min.isSuspense=function(a){return z(a)===p};reactIs_production_min.isValidElementType=function(a){return"string"===typeof a||"function"===typeof a||a===e||a===m||a===g||a===f||a===p||a===q||"object"===_typeof2(a)&&null!==a&&(a.$$typeof===t||a.$$typeof===r||a.$$typeof===h||a.$$typeof===k||a.$$typeof===n||a.$$typeof===w||a.$$typeof===x||a.$$typeof===y||a.$$typeof===v)};reactIs_production_min.typeOf=z;return reactIs_production_min}var reactIs_development={};var hasRequiredReactIs_development;function requireReactIs_development(){if(hasRequiredReactIs_development)return reactIs_development;hasRequiredReactIs_development=1;if(process.env.NODE_ENV!=="production"){(function(){var hasSymbol=typeof Symbol==="function"&&Symbol["for"];var REACT_ELEMENT_TYPE=hasSymbol?Symbol["for"]("react.element"):60103;var REACT_PORTAL_TYPE=hasSymbol?Symbol["for"]("react.portal"):60106;var REACT_FRAGMENT_TYPE=hasSymbol?Symbol["for"]("react.fragment"):60107;var REACT_STRICT_MODE_TYPE=hasSymbol?Symbol["for"]("react.strict_mode"):60108;var REACT_PROFILER_TYPE=hasSymbol?Symbol["for"]("react.profiler"):60114;var REACT_PROVIDER_TYPE=hasSymbol?Symbol["for"]("react.provider"):60109;var REACT_CONTEXT_TYPE=hasSymbol?Symbol["for"]("react.context"):60110;var REACT_ASYNC_MODE_TYPE=hasSymbol?Symbol["for"]("react.async_mode"):60111;var REACT_CONCURRENT_MODE_TYPE=hasSymbol?Symbol["for"]("react.concurrent_mode"):60111;var REACT_FORWARD_REF_TYPE=hasSymbol?Symbol["for"]("react.forward_ref"):60112;var REACT_SUSPENSE_TYPE=hasSymbol?Symbol["for"]("react.suspense"):60113;var REACT_SUSPENSE_LIST_TYPE=hasSymbol?Symbol["for"]("react.suspense_list"):60120;var REACT_MEMO_TYPE=hasSymbol?Symbol["for"]("react.memo"):60115;var REACT_LAZY_TYPE=hasSymbol?Symbol["for"]("react.lazy"):60116;var REACT_BLOCK_TYPE=hasSymbol?Symbol["for"]("react.block"):60121;var REACT_FUNDAMENTAL_TYPE=hasSymbol?Symbol["for"]("react.fundamental"):60117;var REACT_RESPONDER_TYPE=hasSymbol?Symbol["for"]("react.responder"):60118;var REACT_SCOPE_TYPE=hasSymbol?Symbol["for"]("react.scope"):60119;function isValidElementType(type){return typeof type==="string"||typeof type==="function"||type===REACT_FRAGMENT_TYPE||type===REACT_CONCURRENT_MODE_TYPE||type===REACT_PROFILER_TYPE||type===REACT_STRICT_MODE_TYPE||type===REACT_SUSPENSE_TYPE||type===REACT_SUSPENSE_LIST_TYPE||_typeof2(type)==="object"&&type!==null&&(type.$$typeof===REACT_LAZY_TYPE||type.$$typeof===REACT_MEMO_TYPE||type.$$typeof===REACT_PROVIDER_TYPE||type.$$typeof===REACT_CONTEXT_TYPE||type.$$typeof===REACT_FORWARD_REF_TYPE||type.$$typeof===REACT_FUNDAMENTAL_TYPE||type.$$typeof===REACT_RESPONDER_TYPE||type.$$typeof===REACT_SCOPE_TYPE||type.$$typeof===REACT_BLOCK_TYPE)}function typeOf(object){if(_typeof2(object)==="object"&&object!==null){var $$typeof=object.$$typeof;switch($$typeof){case REACT_ELEMENT_TYPE:var type=object.type;switch(type){case REACT_ASYNC_MODE_TYPE:case REACT_CONCURRENT_MODE_TYPE:case REACT_FRAGMENT_TYPE:case REACT_PROFILER_TYPE:case REACT_STRICT_MODE_TYPE:case REACT_SUSPENSE_TYPE:return type;default:var $$typeofType=type&&type.$$typeof;switch($$typeofType){case REACT_CONTEXT_TYPE:case REACT_FORWARD_REF_TYPE:case REACT_LAZY_TYPE:case REACT_MEMO_TYPE:case REACT_PROVIDER_TYPE:return $$typeofType;default:return $$typeof}}case REACT_PORTAL_TYPE:return $$typeof}}return undefined}var AsyncMode=REACT_ASYNC_MODE_TYPE;var ConcurrentMode=REACT_CONCURRENT_MODE_TYPE;var ContextConsumer=REACT_CONTEXT_TYPE;var ContextProvider=REACT_PROVIDER_TYPE;var Element=REACT_ELEMENT_TYPE;var ForwardRef=REACT_FORWARD_REF_TYPE;var Fragment=REACT_FRAGMENT_TYPE;var Lazy=REACT_LAZY_TYPE;var Memo=REACT_MEMO_TYPE;var Portal=REACT_PORTAL_TYPE;var Profiler=REACT_PROFILER_TYPE;var StrictMode=REACT_STRICT_MODE_TYPE;var Suspense=REACT_SUSPENSE_TYPE;var hasWarnedAboutDeprecatedIsAsyncMode=false;function isAsyncMode(object){{if(!hasWarnedAboutDeprecatedIsAsyncMode){hasWarnedAboutDeprecatedIsAsyncMode=true;console["warn"]("The ReactIs.isAsyncMode() alias has been deprecated, "+"and will be removed in React 17+. Update your code to use "+"ReactIs.isConcurrentMode() instead. It has the exact same API.")}}return isConcurrentMode(object)||typeOf(object)===REACT_ASYNC_MODE_TYPE}function isConcurrentMode(object){return typeOf(object)===REACT_CONCURRENT_MODE_TYPE}function isContextConsumer(object){return typeOf(object)===REACT_CONTEXT_TYPE}function isContextProvider(object){return typeOf(object)===REACT_PROVIDER_TYPE}function isElement(object){return _typeof2(object)==="object"&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE}function isForwardRef(object){return typeOf(object)===REACT_FORWARD_REF_TYPE}function isFragment(object){return typeOf(object)===REACT_FRAGMENT_TYPE}function isLazy(object){return typeOf(object)===REACT_LAZY_TYPE}function isMemo(object){return typeOf(object)===REACT_MEMO_TYPE}function isPortal(object){return typeOf(object)===REACT_PORTAL_TYPE}function isProfiler(object){return typeOf(object)===REACT_PROFILER_TYPE}function isStrictMode(object){return typeOf(object)===REACT_STRICT_MODE_TYPE}function isSuspense(object){return typeOf(object)===REACT_SUSPENSE_TYPE}reactIs_development.AsyncMode=AsyncMode;reactIs_development.ConcurrentMode=ConcurrentMode;reactIs_development.ContextConsumer=ContextConsumer;reactIs_development.ContextProvider=ContextProvider;reactIs_development.Element=Element;reactIs_development.ForwardRef=ForwardRef;reactIs_development.Fragment=Fragment;reactIs_development.Lazy=Lazy;reactIs_development.Memo=Memo;reactIs_development.Portal=Portal;reactIs_development.Profiler=Profiler;reactIs_development.StrictMode=StrictMode;reactIs_development.Suspense=Suspense;reactIs_development.isAsyncMode=isAsyncMode;reactIs_development.isConcurrentMode=isConcurrentMode;reactIs_development.isContextConsumer=isContextConsumer;reactIs_development.isContextProvider=isContextProvider;reactIs_development.isElement=isElement;reactIs_development.isForwardRef=isForwardRef;reactIs_development.isFragment=isFragment;reactIs_development.isLazy=isLazy;reactIs_development.isMemo=isMemo;reactIs_development.isPortal=isPortal;reactIs_development.isProfiler=isProfiler;reactIs_development.isStrictMode=isStrictMode;reactIs_development.isSuspense=isSuspense;reactIs_development.isValidElementType=isValidElementType;reactIs_development.typeOf=typeOf})()}return reactIs_development}var hasRequiredReactIs;function requireReactIs(){if(hasRequiredReactIs)return reactIs.exports;hasRequiredReactIs=1;if(process.env.NODE_ENV==="production"){reactIs.exports=requireReactIs_production_min()}else{reactIs.exports=requireReactIs_development()}return reactIs.exports}var objectAssign;var hasRequiredObjectAssign;function requireObjectAssign(){if(hasRequiredObjectAssign)return objectAssign;hasRequiredObjectAssign=1;var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}objectAssign=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to};return objectAssign}var ReactPropTypesSecret_1;var hasRequiredReactPropTypesSecret;function requireReactPropTypesSecret(){if(hasRequiredReactPropTypesSecret)return ReactPropTypesSecret_1;hasRequiredReactPropTypesSecret=1;var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";ReactPropTypesSecret_1=ReactPropTypesSecret;return ReactPropTypesSecret_1}var has;var hasRequiredHas;function requireHas(){if(hasRequiredHas)return has;hasRequiredHas=1;has=Function.call.bind(Object.prototype.hasOwnProperty);return has}var checkPropTypes_1;var hasRequiredCheckPropTypes;function requireCheckPropTypes(){if(hasRequiredCheckPropTypes)return checkPropTypes_1;hasRequiredCheckPropTypes=1;var printWarning=function printWarning(){};if(process.env.NODE_ENV!=="production"){var ReactPropTypesSecret=requireReactPropTypesSecret();var loggedTypeFailures={};var has=requireHas();printWarning=function printWarning(text){var message="Warning: "+text;if(typeof console!=="undefined"){console.error(message)}try{throw new Error(message)}catch(x){}}}function checkPropTypes(typeSpecs,values,location,componentName,getStack){if(process.env.NODE_ENV!=="production"){for(var typeSpecName in typeSpecs){if(has(typeSpecs,typeSpecName)){var error;try{if(typeof typeSpecs[typeSpecName]!=="function"){var err=Error((componentName||"React class")+": "+location+" type `"+typeSpecName+"` is invalid; "+"it must be a function, usually from the `prop-types` package, but received `"+_typeof2(typeSpecs[typeSpecName])+"`."+"This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");err.name="Invariant Violation";throw err}error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}if(error&&!(error instanceof Error)){printWarning((componentName||"React class")+": type specification of "+location+" `"+typeSpecName+"` is invalid; the type checker "+"function must return `null` or an `Error` but returned a "+_typeof2(error)+". "+"You may have forgotten to pass an argument to the type checker "+"creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and "+"shape all require an argument).")}if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var stack=getStack?getStack():"";printWarning("Failed "+location+" type: "+error.message+(stack!=null?stack:""))}}}}}checkPropTypes.resetWarningCache=function(){if(process.env.NODE_ENV!=="production"){loggedTypeFailures={}}};checkPropTypes_1=checkPropTypes;return checkPropTypes_1}var factoryWithTypeCheckers;var hasRequiredFactoryWithTypeCheckers;function requireFactoryWithTypeCheckers(){if(hasRequiredFactoryWithTypeCheckers)return factoryWithTypeCheckers;hasRequiredFactoryWithTypeCheckers=1;var ReactIs=requireReactIs();var assign=requireObjectAssign();var ReactPropTypesSecret=requireReactPropTypesSecret();var has=requireHas();var checkPropTypes=requireCheckPropTypes();var printWarning=function printWarning(){};if(process.env.NODE_ENV!=="production"){printWarning=function printWarning(text){var message="Warning: "+text;if(typeof console!=="undefined"){console.error(message)}try{throw new Error(message)}catch(x){}}}function emptyFunctionThatReturnsNull(){return null}factoryWithTypeCheckers=function factoryWithTypeCheckers(isValidElement,throwOnDirectAccess){var ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}var ANONYMOUS="<<anonymous>>";var ReactPropTypes={array:createPrimitiveTypeChecker("array"),bigint:createPrimitiveTypeChecker("bigint"),bool:createPrimitiveTypeChecker("boolean"),func:createPrimitiveTypeChecker("function"),number:createPrimitiveTypeChecker("number"),object:createPrimitiveTypeChecker("object"),string:createPrimitiveTypeChecker("string"),symbol:createPrimitiveTypeChecker("symbol"),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),elementType:createElementTypeTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker,exact:createStrictShapeTypeChecker};function is(x,y){if(x===y){return x!==0||1/x===1/y}else{return x!==x&&y!==y}}function PropTypeError(message,data){this.message=message;this.data=data&&_typeof2(data)==="object"?data:{};this.stack=""}PropTypeError.prototype=Error.prototype;function createChainableTypeChecker(validate){if(process.env.NODE_ENV!=="production"){var manualPropTypeCallCache={};var manualPropTypeWarningCount=0}function checkType(isRequired,props,propName,componentName,location,propFullName,secret){componentName=componentName||ANONYMOUS;propFullName=propFullName||propName;if(secret!==ReactPropTypesSecret){if(throwOnDirectAccess){var err=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use `PropTypes.checkPropTypes()` to call them. "+"Read more at http://fb.me/use-check-prop-types");err.name="Invariant Violation";throw err}else if(process.env.NODE_ENV!=="production"&&typeof console!=="undefined"){var cacheKey=componentName+":"+propName;if(!manualPropTypeCallCache[cacheKey]&&manualPropTypeWarningCount<3){printWarning("You are manually calling a React.PropTypes validation "+"function for the `"+propFullName+"` prop on `"+componentName+"`. This is deprecated "+"and will throw in the standalone `prop-types` package. "+"You may be seeing this warning due to a third-party PropTypes "+"library. See https://fb.me/react-warning-dont-call-proptypes "+"for details.");manualPropTypeCallCache[cacheKey]=true;manualPropTypeWarningCount++}}}if(props[propName]==null){if(isRequired){if(props[propName]===null){return new PropTypeError("The "+location+" `"+propFullName+"` is marked as required "+("in `"+componentName+"`, but its value is `null`."))}return new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in "+("`"+componentName+"`, but its value is `undefined`."))}return null}else{return validate(props,propName,componentName,location,propFullName)}}var chainedCheckType=checkType.bind(null,false);chainedCheckType.isRequired=checkType.bind(null,true);return chainedCheckType}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName];var propType=getPropType(propValue);if(propType!==expectedType){var preciseType=getPreciseType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+preciseType+"` supplied to `"+componentName+"`, expected ")+("`"+expectedType+"`."),{expectedType:expectedType})}return null}return createChainableTypeChecker(validate)}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunctionThatReturnsNull)}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=="function"){return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside arrayOf.")}var propValue=props[propName];if(!Array.isArray(propValue)){var propType=getPropType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected an array."))}for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+"["+i+"]",ReactPropTypesSecret);if(error instanceof Error){return error}}return null}return createChainableTypeChecker(validate)}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];if(!isValidElement(propValue)){var propType=getPropType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected a single ReactElement."))}return null}return createChainableTypeChecker(validate)}function createElementTypeTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];if(!ReactIs.isValidElementType(propValue)){var propType=getPropType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected a single ReactElement type."))}return null}return createChainableTypeChecker(validate)}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var expectedClassName=expectedClass.name||ANONYMOUS;var actualClassName=getClassName(props[propName]);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+actualClassName+"` supplied to `"+componentName+"`, expected ")+("instance of `"+expectedClassName+"`."))}return null}return createChainableTypeChecker(validate)}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues)){if(process.env.NODE_ENV!=="production"){if(arguments.length>1){printWarning("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. "+"A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).")}else{printWarning("Invalid argument supplied to oneOf, expected an array.")}}return emptyFunctionThatReturnsNull}function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];for(var i=0;i<expectedValues.length;i++){if(is(propValue,expectedValues[i])){return null}}var valuesString=JSON.stringify(expectedValues,function replacer(key,value){var type=getPreciseType(value);if(type==="symbol"){return String(value)}return value});return new PropTypeError("Invalid "+location+" `"+propFullName+"` of value `"+String(propValue)+"` "+("supplied to `"+componentName+"`, expected one of "+valuesString+"."))}return createChainableTypeChecker(validate)}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=="function"){return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside objectOf.")}var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected an object."))}for(var key in propValue){if(has(propValue,key)){var error=typeChecker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error instanceof Error){return error}}}return null}return createChainableTypeChecker(validate)}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers)){process.env.NODE_ENV!=="production"?printWarning("Invalid argument supplied to oneOfType, expected an instance of array."):void 0;return emptyFunctionThatReturnsNull}for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(typeof checker!=="function"){printWarning("Invalid argument supplied to oneOfType. Expected an array of check functions, but "+"received "+getPostfixForTypeWarning(checker)+" at index "+i+".");return emptyFunctionThatReturnsNull}}function validate(props,propName,componentName,location,propFullName){var expectedTypes=[];for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];var checkerResult=checker(props,propName,componentName,location,propFullName,ReactPropTypesSecret);if(checkerResult==null){return null}if(checkerResult.data&&has(checkerResult.data,"expectedType")){expectedTypes.push(checkerResult.data.expectedType)}}var expectedTypesMessage=expectedTypes.length>0?", expected one of type ["+expectedTypes.join(", ")+"]":"";return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to "+("`"+componentName+"`"+expectedTypesMessage+"."))}return createChainableTypeChecker(validate)}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){if(!isNode(props[propName])){return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to "+("`"+componentName+"`, expected a ReactNode."))}return null}return createChainableTypeChecker(validate)}function invalidValidatorError(componentName,location,propFullName,key,type){return new PropTypeError((componentName||"React class")+": "+location+" type `"+propFullName+"."+key+"` is invalid; "+"it must be a function, usually from the `prop-types` package, but received `"+type+"`.")}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` "+("supplied to `"+componentName+"`, expected `object`."))}for(var key in shapeTypes){var checker=shapeTypes[key];if(typeof checker!=="function"){return invalidValidatorError(componentName,location,propFullName,key,getPreciseType(checker))}var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error){return error}}return null}return createChainableTypeChecker(validate)}function createStrictShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` "+("supplied to `"+componentName+"`, expected `object`."))}var allKeys=assign({},props[propName],shapeTypes);for(var key in allKeys){var checker=shapeTypes[key];if(has(shapeTypes,key)&&typeof checker!=="function"){return invalidValidatorError(componentName,location,propFullName,key,getPreciseType(checker))}if(!checker){return new PropTypeError("Invalid "+location+" `"+propFullName+"` key `"+key+"` supplied to `"+componentName+"`."+"\nBad object: "+JSON.stringify(props[propName],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(shapeTypes),null,"  "))}var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error){return error}}return null}return createChainableTypeChecker(validate)}function isNode(propValue){switch(_typeof2(propValue)){case"number":case"string":case"undefined":return true;case"boolean":return!propValue;case"object":if(Array.isArray(propValue)){return propValue.every(isNode)}if(propValue===null||isValidElement(propValue)){return true}var iteratorFn=getIteratorFn(propValue);if(iteratorFn){var iterator=iteratorFn.call(propValue);var step;if(iteratorFn!==propValue.entries){while(!(step=iterator.next()).done){if(!isNode(step.value)){return false}}}else{while(!(step=iterator.next()).done){var entry=step.value;if(entry){if(!isNode(entry[1])){return false}}}}}else{return false}return true;default:return false}}function isSymbol(propType,propValue){if(propType==="symbol"){return true}if(!propValue){return false}if(propValue["@@toStringTag"]==="Symbol"){return true}if(typeof Symbol==="function"&&propValue instanceof Symbol){return true}return false}function getPropType(propValue){var propType=_typeof2(propValue);if(Array.isArray(propValue)){return"array"}if(propValue instanceof RegExp){return"object"}if(isSymbol(propType,propValue)){return"symbol"}return propType}function getPreciseType(propValue){if(typeof propValue==="undefined"||propValue===null){return""+propValue}var propType=getPropType(propValue);if(propType==="object"){if(propValue instanceof Date){return"date"}else if(propValue instanceof RegExp){return"regexp"}}return propType}function getPostfixForTypeWarning(value){var type=getPreciseType(value);switch(type){case"array":case"object":return"an "+type;case"boolean":case"date":case"regexp":return"a "+type;default:return type}}function getClassName(propValue){if(!propValue.constructor||!propValue.constructor.name){return ANONYMOUS}return propValue.constructor.name}ReactPropTypes.checkPropTypes=checkPropTypes;ReactPropTypes.resetWarningCache=checkPropTypes.resetWarningCache;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes};return factoryWithTypeCheckers}var factoryWithThrowingShims;var hasRequiredFactoryWithThrowingShims;function requireFactoryWithThrowingShims(){if(hasRequiredFactoryWithThrowingShims)return factoryWithThrowingShims;hasRequiredFactoryWithThrowingShims=1;var ReactPropTypesSecret=requireReactPropTypesSecret();function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;factoryWithThrowingShims=function factoryWithThrowingShims(){function shim(props,propName,componentName,location,propFullName,secret){if(secret===ReactPropTypesSecret){return}var err=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use PropTypes.checkPropTypes() to call them. "+"Read more at http://fb.me/use-check-prop-types");err.name="Invariant Violation";throw err}shim.isRequired=shim;function getShim(){return shim}var ReactPropTypes={array:shim,bigint:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,elementType:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes};return factoryWithThrowingShims}var hasRequiredPropTypes;function requirePropTypes(){if(hasRequiredPropTypes)return propTypes.exports;hasRequiredPropTypes=1;if(process.env.NODE_ENV!=="production"){var ReactIs=requireReactIs();var throwOnDirectAccess=true;propTypes.exports=requireFactoryWithTypeCheckers()(ReactIs.isElement,throwOnDirectAccess)}else{propTypes.exports=requireFactoryWithThrowingShims()()}return propTypes.exports}var ModalPortal={exports:{}};var focusManager={};var tabbable={exports:{}};(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=findTabbableDescendants;var DISPLAY_NONE="none";var DISPLAY_CONTENTS="contents";var tabbableNode=/input|select|textarea|button|object|iframe/;function isNotOverflowing(element,style){return style.getPropertyValue("overflow")!=="visible"||element.scrollWidth<=0&&element.scrollHeight<=0}function hidesContents(element){var zeroSize=element.offsetWidth<=0&&element.offsetHeight<=0;if(zeroSize&&!element.innerHTML)return true;try{var style=window.getComputedStyle(element);var displayValue=style.getPropertyValue("display");return zeroSize?displayValue!==DISPLAY_CONTENTS&&isNotOverflowing(element,style):displayValue===DISPLAY_NONE}catch(exception){console.warn("Failed to inspect element style");return false}}function visible(element){var parentElement=element;var rootNode=element.getRootNode&&element.getRootNode();while(parentElement){if(parentElement===document.body)break;if(rootNode&&parentElement===rootNode)parentElement=rootNode.host.parentNode;if(hidesContents(parentElement))return false;parentElement=parentElement.parentNode}return true}function focusable(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();var res=tabbableNode.test(nodeName)&&!element.disabled||(nodeName==="a"?element.href||isTabIndexNotNaN:isTabIndexNotNaN);return res&&visible(element)}function tabbable(element){var tabIndex=element.getAttribute("tabindex");if(tabIndex===null)tabIndex=undefined;var isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}function findTabbableDescendants(element){var descendants=[].slice.call(element.querySelectorAll("*"),0).reduce(function(finished,el){return finished.concat(!el.shadowRoot?[el]:findTabbableDescendants(el.shadowRoot))},[]);return descendants.filter(tabbable)}module.exports=exports["default"]})(tabbable,tabbable.exports);var tabbableExports=tabbable.exports;Object.defineProperty(focusManager,"__esModule",{value:true});focusManager.resetState=resetState$4;focusManager.log=log$4;focusManager.handleBlur=handleBlur;focusManager.handleFocus=handleFocus;focusManager.markForFocusLater=markForFocusLater;focusManager.returnFocus=returnFocus;focusManager.popWithoutFocus=popWithoutFocus;focusManager.setupScopedFocus=setupScopedFocus;focusManager.teardownScopedFocus=teardownScopedFocus;var _tabbable=tabbableExports;var _tabbable2=_interopRequireDefault$4(_tabbable);function _interopRequireDefault$4(obj){return obj&&obj.__esModule?obj:{"default":obj}}var focusLaterElements=[];var modalElement=null;var needToFocus=false;function resetState$4(){focusLaterElements=[]}function log$4(){if(process.env.NODE_ENV!=="production"){console.log("focusManager ----------");focusLaterElements.forEach(function(f){var check=f||{};console.log(check.nodeName,check.className,check.id)});console.log("end focusManager ----------")}}function handleBlur(){needToFocus=true}function handleFocus(){if(needToFocus){needToFocus=false;if(!modalElement){return}setTimeout(function(){if(modalElement.contains(document.activeElement)){return}var el=(0,_tabbable2["default"])(modalElement)[0]||modalElement;el.focus()},0)}}function markForFocusLater(){focusLaterElements.push(document.activeElement)}function returnFocus(){var preventScroll=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var toFocus=null;try{if(focusLaterElements.length!==0){toFocus=focusLaterElements.pop();toFocus.focus({preventScroll:preventScroll})}return}catch(e){console.warn(["You tried to return focus to",toFocus,"but it is not in the DOM anymore"].join(" "))}}function popWithoutFocus(){focusLaterElements.length>0&&focusLaterElements.pop()}function setupScopedFocus(element){modalElement=element;if(window.addEventListener){window.addEventListener("blur",handleBlur,false);document.addEventListener("focus",handleFocus,true)}else{window.attachEvent("onBlur",handleBlur);document.attachEvent("onFocus",handleFocus)}}function teardownScopedFocus(){modalElement=null;if(window.addEventListener){window.removeEventListener("blur",handleBlur);document.removeEventListener("focus",handleFocus)}else{window.detachEvent("onBlur",handleBlur);document.detachEvent("onFocus",handleFocus)}}var scopeTab={exports:{}};(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=scopeTab;var _tabbable=tabbableExports;var _tabbable2=_interopRequireDefault(_tabbable);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function getActiveElement(){var el=arguments.length>0&&arguments[0]!==undefined?arguments[0]:document;return el.activeElement.shadowRoot?getActiveElement(el.activeElement.shadowRoot):el.activeElement}function scopeTab(node,event){var tabbable=(0,_tabbable2["default"])(node);if(!tabbable.length){event.preventDefault();return}var target=void 0;var shiftKey=event.shiftKey;var head=tabbable[0];var tail=tabbable[tabbable.length-1];var activeElement=getActiveElement();if(node===activeElement){if(!shiftKey)return;target=tail}if(tail===activeElement&&!shiftKey){target=head}if(head===activeElement&&shiftKey){target=tail}if(target){event.preventDefault();target.focus();return}var checkSafari=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent);var isSafariDesktop=checkSafari!=null&&checkSafari[1]!="Chrome"&&/\biPod\b|\biPad\b/g.exec(navigator.userAgent)==null;if(!isSafariDesktop)return;var x=tabbable.indexOf(activeElement);if(x>-1){x+=shiftKey?-1:1}target=tabbable[x];if(typeof target==="undefined"){event.preventDefault();target=shiftKey?tail:head;target.focus();return}event.preventDefault();target.focus()}module.exports=exports["default"]})(scopeTab,scopeTab.exports);var scopeTabExports=scopeTab.exports;var ariaAppHider$1={};var __DEV__=process.env.NODE_ENV!=="production";var warning=function warning(){};if(__DEV__){var printWarning=function printWarning(format,args){var len=arguments.length;args=new Array(len>1?len-1:0);for(var key=1;key<len;key++){args[key-1]=arguments[key]}var argIndex=0;var message="Warning: "+format.replace(/%s/g,function(){return args[argIndex++]});if(typeof console!=="undefined"){console.error(message)}try{throw new Error(message)}catch(x){}};warning=function warning(condition,format,args){var len=arguments.length;args=new Array(len>2?len-2:0);for(var key=2;key<len;key++){args[key-2]=arguments[key]}if(format===undefined){throw new Error("`warning(condition, format, ...args)` requires a warning "+"message argument")}if(!condition){printWarning.apply(null,[format].concat(args))}}}var warning_1=warning;var safeHTMLElement={};var exenv={exports:{}};(function(module){(function(){var canUseDOM=!!(typeof window!=="undefined"&&window.document&&window.document.createElement);var ExecutionEnvironment={canUseDOM:canUseDOM,canUseWorkers:typeof Worker!=="undefined",canUseEventListeners:canUseDOM&&!!(window.addEventListener||window.attachEvent),canUseViewport:canUseDOM&&!!window.screen};if(module.exports){module.exports=ExecutionEnvironment}else{window.ExecutionEnvironment=ExecutionEnvironment}})()})(exenv);var exenvExports=exenv.exports;Object.defineProperty(safeHTMLElement,"__esModule",{value:true});safeHTMLElement.canUseDOM=safeHTMLElement.SafeNodeList=safeHTMLElement.SafeHTMLCollection=undefined;var _exenv=exenvExports;var _exenv2=_interopRequireDefault$3(_exenv);function _interopRequireDefault$3(obj){return obj&&obj.__esModule?obj:{"default":obj}}var EE=_exenv2["default"];var SafeHTMLElement=EE.canUseDOM?window.HTMLElement:{};safeHTMLElement.SafeHTMLCollection=EE.canUseDOM?window.HTMLCollection:{};safeHTMLElement.SafeNodeList=EE.canUseDOM?window.NodeList:{};safeHTMLElement.canUseDOM=EE.canUseDOM;safeHTMLElement["default"]=SafeHTMLElement;Object.defineProperty(ariaAppHider$1,"__esModule",{value:true});ariaAppHider$1.resetState=resetState$3;ariaAppHider$1.log=log$3;ariaAppHider$1.assertNodeList=assertNodeList;ariaAppHider$1.setElement=setElement;ariaAppHider$1.validateElement=validateElement;ariaAppHider$1.hide=hide$2;ariaAppHider$1.show=show;ariaAppHider$1.documentNotReadyOrSSRTesting=documentNotReadyOrSSRTesting;var _warning=warning_1;var _warning2=_interopRequireDefault$2(_warning);var _safeHTMLElement$1=safeHTMLElement;function _interopRequireDefault$2(obj){return obj&&obj.__esModule?obj:{"default":obj}}var globalElement=null;function resetState$3(){if(globalElement){if(globalElement.removeAttribute){globalElement.removeAttribute("aria-hidden")}else if(globalElement.length!=null){globalElement.forEach(function(element){return element.removeAttribute("aria-hidden")})}else{document.querySelectorAll(globalElement).forEach(function(element){return element.removeAttribute("aria-hidden")})}}globalElement=null}function log$3(){if(process.env.NODE_ENV!=="production"){var check=globalElement||{};console.log("ariaAppHider ----------");console.log(check.nodeName,check.className,check.id);console.log("end ariaAppHider ----------")}}function assertNodeList(nodeList,selector){if(!nodeList||!nodeList.length){throw new Error("react-modal: No elements were found for selector "+selector+".")}}function setElement(element){var useElement=element;if(typeof useElement==="string"&&_safeHTMLElement$1.canUseDOM){var el=document.querySelectorAll(useElement);assertNodeList(el,useElement);useElement=el}globalElement=useElement||globalElement;return globalElement}function validateElement(appElement){var el=appElement||globalElement;if(el){return Array.isArray(el)||el instanceof HTMLCollection||el instanceof NodeList?el:[el]}else{(0,_warning2["default"])(false,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" "));return[]}}function hide$2(appElement){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=validateElement(appElement)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var el=_step.value;el.setAttribute("aria-hidden","true")}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}function show(appElement){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=validateElement(appElement)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var el=_step2.value;el.removeAttribute("aria-hidden")}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}function documentNotReadyOrSSRTesting(){globalElement=null}var classList={};Object.defineProperty(classList,"__esModule",{value:true});classList.resetState=resetState$2;classList.log=log$2;var htmlClassList={};var docBodyClassList={};function removeClass(at,cls){at.classList.remove(cls)}function resetState$2(){var htmlElement=document.getElementsByTagName("html")[0];for(var cls in htmlClassList){removeClass(htmlElement,htmlClassList[cls])}var body=document.body;for(var _cls in docBodyClassList){removeClass(body,docBodyClassList[_cls])}htmlClassList={};docBodyClassList={}}function log$2(){if(process.env.NODE_ENV!=="production"){var classes=document.getElementsByTagName("html")[0].className;var buffer="Show tracked classes:\n\n";buffer+="<html /> ("+classes+"):\n  ";for(var x in htmlClassList){buffer+="  "+x+" "+htmlClassList[x]+"\n  "}classes=document.body.className;buffer+="\n\ndoc.body ("+classes+"):\n  ";for(var _x in docBodyClassList){buffer+="  "+_x+" "+docBodyClassList[_x]+"\n  "}buffer+="\n";console.log(buffer)}}var incrementReference=function incrementReference(poll,className){if(!poll[className]){poll[className]=0}poll[className]+=1;return className};var decrementReference=function decrementReference(poll,className){if(poll[className]){poll[className]-=1}return className};var trackClass=function trackClass(classListRef,poll,classes){classes.forEach(function(className){incrementReference(poll,className);classListRef.add(className)})};var untrackClass=function untrackClass(classListRef,poll,classes){classes.forEach(function(className){decrementReference(poll,className);poll[className]===0&&classListRef.remove(className)})};classList.add=function add(element,classString){return trackClass(element.classList,element.nodeName.toLowerCase()=="html"?htmlClassList:docBodyClassList,classString.split(" "))};classList.remove=function remove(element,classString){return untrackClass(element.classList,element.nodeName.toLowerCase()=="html"?htmlClassList:docBodyClassList,classString.split(" "))};var portalOpenInstances$1={};Object.defineProperty(portalOpenInstances$1,"__esModule",{value:true});portalOpenInstances$1.log=log$1;portalOpenInstances$1.resetState=resetState$1;function _classCallCheck$1(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var PortalOpenInstances=function PortalOpenInstances(){var _this=this;_classCallCheck$1(this,PortalOpenInstances);this.register=function(openInstance){if(_this.openInstances.indexOf(openInstance)!==-1){if(process.env.NODE_ENV!=="production"){console.warn("React-Modal: Cannot register modal instance that's already open")}return}_this.openInstances.push(openInstance);_this.emit("register")};this.deregister=function(openInstance){var index=_this.openInstances.indexOf(openInstance);if(index===-1){if(process.env.NODE_ENV!=="production"){console.warn("React-Modal: Unable to deregister "+openInstance+" as "+"it was never registered")}return}_this.openInstances.splice(index,1);_this.emit("deregister")};this.subscribe=function(callback){_this.subscribers.push(callback)};this.emit=function(eventType){_this.subscribers.forEach(function(subscriber){return subscriber(eventType,_this.openInstances.slice())})};this.openInstances=[];this.subscribers=[]};var portalOpenInstances=new PortalOpenInstances;function log$1(){console.log("portalOpenInstances ----------");console.log(portalOpenInstances.openInstances.length);portalOpenInstances.openInstances.forEach(function(p){return console.log(p)});console.log("end portalOpenInstances ----------")}function resetState$1(){portalOpenInstances=new PortalOpenInstances}portalOpenInstances$1["default"]=portalOpenInstances;var bodyTrap$1={};Object.defineProperty(bodyTrap$1,"__esModule",{value:true});bodyTrap$1.resetState=resetState;bodyTrap$1.log=log;var _portalOpenInstances=portalOpenInstances$1;var _portalOpenInstances2=_interopRequireDefault$1(_portalOpenInstances);function _interopRequireDefault$1(obj){return obj&&obj.__esModule?obj:{"default":obj}}var before=void 0,after=void 0,instances=[];function resetState(){var _arr=[before,after];for(var _i=0;_i<_arr.length;_i++){var item=_arr[_i];if(!item)continue;item.parentNode&&item.parentNode.removeChild(item)}before=after=null;instances=[]}function log(){console.log("bodyTrap ----------");console.log(instances.length);var _arr2=[before,after];for(var _i2=0;_i2<_arr2.length;_i2++){var item=_arr2[_i2];var check=item||{};console.log(check.nodeName,check.className,check.id)}console.log("edn bodyTrap ----------")}function focusContent(){if(instances.length===0){if(process.env.NODE_ENV!=="production"){console.warn("React-Modal: Open instances > 0 expected")}return}instances[instances.length-1].focusContent()}function bodyTrap(eventType,openInstances){if(!before&&!after){before=document.createElement("div");before.setAttribute("data-react-modal-body-trap","");before.style.position="absolute";before.style.opacity="0";before.setAttribute("tabindex","0");before.addEventListener("focus",focusContent);after=before.cloneNode();after.addEventListener("focus",focusContent)}instances=openInstances;if(instances.length>0){if(document.body.firstChild!==before){document.body.insertBefore(before,document.body.firstChild)}if(document.body.lastChild!==after){document.body.appendChild(after)}}else{if(before.parentElement){before.parentElement.removeChild(before)}if(after.parentElement){after.parentElement.removeChild(after)}}}_portalOpenInstances2["default"].subscribe(bodyTrap);(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _typeof=typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"?function(obj){return _typeof2(obj)}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=React;var _propTypes=requirePropTypes();var _propTypes2=_interopRequireDefault(_propTypes);var _focusManager=focusManager;var focusManager$1=_interopRequireWildcard(_focusManager);var _scopeTab=scopeTabExports;var _scopeTab2=_interopRequireDefault(_scopeTab);var _ariaAppHider=ariaAppHider$1;var ariaAppHider=_interopRequireWildcard(_ariaAppHider);var _classList=classList;var classList$1=_interopRequireWildcard(_classList);var _safeHTMLElement=safeHTMLElement;var _safeHTMLElement2=_interopRequireDefault(_safeHTMLElement);var _portalOpenInstances=portalOpenInstances$1;var _portalOpenInstances2=_interopRequireDefault(_portalOpenInstances);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(_typeof2(call)==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+_typeof2(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CLASS_NAMES={overlay:"ReactModal__Overlay",content:"ReactModal__Content"};var isTabKey=function isTabKey(event){return event.code==="Tab"||event.keyCode===9};var isEscKey=function isEscKey(event){return event.code==="Escape"||event.keyCode===27};var ariaHiddenInstances=0;var ModalPortal=function(_Component){_inherits(ModalPortal,_Component);function ModalPortal(props){_classCallCheck(this,ModalPortal);var _this=_possibleConstructorReturn(this,(ModalPortal.__proto__||Object.getPrototypeOf(ModalPortal)).call(this,props));_this.setOverlayRef=function(overlay){_this.overlay=overlay;_this.props.overlayRef&&_this.props.overlayRef(overlay)};_this.setContentRef=function(content){_this.content=content;_this.props.contentRef&&_this.props.contentRef(content)};_this.afterClose=function(){var _this$props=_this.props,appElement=_this$props.appElement,ariaHideApp=_this$props.ariaHideApp,htmlOpenClassName=_this$props.htmlOpenClassName,bodyOpenClassName=_this$props.bodyOpenClassName,parentSelector=_this$props.parentSelector;var parentDocument=parentSelector&&parentSelector().ownerDocument||document;bodyOpenClassName&&classList$1.remove(parentDocument.body,bodyOpenClassName);htmlOpenClassName&&classList$1.remove(parentDocument.getElementsByTagName("html")[0],htmlOpenClassName);if(ariaHideApp&&ariaHiddenInstances>0){ariaHiddenInstances-=1;if(ariaHiddenInstances===0){ariaAppHider.show(appElement)}}if(_this.props.shouldFocusAfterRender){if(_this.props.shouldReturnFocusAfterClose){focusManager$1.returnFocus(_this.props.preventScroll);focusManager$1.teardownScopedFocus()}else{focusManager$1.popWithoutFocus()}}if(_this.props.onAfterClose){_this.props.onAfterClose()}_portalOpenInstances2["default"].deregister(_this)};_this.open=function(){_this.beforeOpen();if(_this.state.afterOpen&&_this.state.beforeClose){clearTimeout(_this.closeTimer);_this.setState({beforeClose:false})}else{if(_this.props.shouldFocusAfterRender){focusManager$1.setupScopedFocus(_this.node);focusManager$1.markForFocusLater()}_this.setState({isOpen:true},function(){_this.openAnimationFrame=requestAnimationFrame(function(){_this.setState({afterOpen:true});if(_this.props.isOpen&&_this.props.onAfterOpen){_this.props.onAfterOpen({overlayEl:_this.overlay,contentEl:_this.content})}})})}};_this.close=function(){if(_this.props.closeTimeoutMS>0){_this.closeWithTimeout()}else{_this.closeWithoutTimeout()}};_this.focusContent=function(){return _this.content&&!_this.contentHasFocus()&&_this.content.focus({preventScroll:true})};_this.closeWithTimeout=function(){var closesAt=Date.now()+_this.props.closeTimeoutMS;_this.setState({beforeClose:true,closesAt:closesAt},function(){_this.closeTimer=setTimeout(_this.closeWithoutTimeout,_this.state.closesAt-Date.now())})};_this.closeWithoutTimeout=function(){_this.setState({beforeClose:false,isOpen:false,afterOpen:false,closesAt:null},_this.afterClose)};_this.handleKeyDown=function(event){if(isTabKey(event)){(0,_scopeTab2["default"])(_this.content,event)}if(_this.props.shouldCloseOnEsc&&isEscKey(event)){event.stopPropagation();_this.requestClose(event)}};_this.handleOverlayOnClick=function(event){if(_this.shouldClose===null){_this.shouldClose=true}if(_this.shouldClose&&_this.props.shouldCloseOnOverlayClick){if(_this.ownerHandlesClose()){_this.requestClose(event)}else{_this.focusContent()}}_this.shouldClose=null};_this.handleContentOnMouseUp=function(){_this.shouldClose=false};_this.handleOverlayOnMouseDown=function(event){if(!_this.props.shouldCloseOnOverlayClick&&event.target==_this.overlay){event.preventDefault()}};_this.handleContentOnClick=function(){_this.shouldClose=false};_this.handleContentOnMouseDown=function(){_this.shouldClose=false};_this.requestClose=function(event){return _this.ownerHandlesClose()&&_this.props.onRequestClose(event)};_this.ownerHandlesClose=function(){return _this.props.onRequestClose};_this.shouldBeClosed=function(){return!_this.state.isOpen&&!_this.state.beforeClose};_this.contentHasFocus=function(){return document.activeElement===_this.content||_this.content.contains(document.activeElement)};_this.buildClassName=function(which,additional){var classNames=(typeof additional==="undefined"?"undefined":_typeof(additional))==="object"?additional:{base:CLASS_NAMES[which],afterOpen:CLASS_NAMES[which]+"--after-open",beforeClose:CLASS_NAMES[which]+"--before-close"};var className=classNames.base;if(_this.state.afterOpen){className=className+" "+classNames.afterOpen}if(_this.state.beforeClose){className=className+" "+classNames.beforeClose}return typeof additional==="string"&&additional?className+" "+additional:className};_this.attributesFromObject=function(prefix,items){return Object.keys(items).reduce(function(acc,name){acc[prefix+"-"+name]=items[name];return acc},{})};_this.state={afterOpen:false,beforeClose:false};_this.shouldClose=null;_this.moveFromContentToOverlay=null;return _this}_createClass(ModalPortal,[{key:"componentDidMount",value:function componentDidMount(){if(this.props.isOpen){this.open()}}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(process.env.NODE_ENV!=="production"){if(prevProps.bodyOpenClassName!==this.props.bodyOpenClassName){console.warn("React-Modal: \"bodyOpenClassName\" prop has been modified. "+"This may cause unexpected behavior when multiple modals are open.")}if(prevProps.htmlOpenClassName!==this.props.htmlOpenClassName){console.warn("React-Modal: \"htmlOpenClassName\" prop has been modified. "+"This may cause unexpected behavior when multiple modals are open.")}}if(this.props.isOpen&&!prevProps.isOpen){this.open()}else if(!this.props.isOpen&&prevProps.isOpen){this.close()}if(this.props.shouldFocusAfterRender&&this.state.isOpen&&!prevState.isOpen){this.focusContent()}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.state.isOpen){this.afterClose()}clearTimeout(this.closeTimer);cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function beforeOpen(){var _props=this.props,appElement=_props.appElement,ariaHideApp=_props.ariaHideApp,htmlOpenClassName=_props.htmlOpenClassName,bodyOpenClassName=_props.bodyOpenClassName,parentSelector=_props.parentSelector;var parentDocument=parentSelector&&parentSelector().ownerDocument||document;bodyOpenClassName&&classList$1.add(parentDocument.body,bodyOpenClassName);htmlOpenClassName&&classList$1.add(parentDocument.getElementsByTagName("html")[0],htmlOpenClassName);if(ariaHideApp){ariaHiddenInstances+=1;ariaAppHider.hide(appElement)}_portalOpenInstances2["default"].register(this)}},{key:"render",value:function render(){var _props2=this.props,id=_props2.id,className=_props2.className,overlayClassName=_props2.overlayClassName,defaultStyles=_props2.defaultStyles,children=_props2.children;var contentStyles=className?{}:defaultStyles.content;var overlayStyles=overlayClassName?{}:defaultStyles.overlay;if(this.shouldBeClosed()){return null}var overlayProps={ref:this.setOverlayRef,className:this.buildClassName("overlay",overlayClassName),style:_extends({},overlayStyles,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown};var contentProps=_extends({id:id,ref:this.setContentRef,style:_extends({},contentStyles,this.props.style.content),className:this.buildClassName("content",className),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",_extends({modal:true},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId});var contentElement=this.props.contentElement(contentProps,children);return this.props.overlayElement(overlayProps,contentElement)}}]);return ModalPortal}(_react.Component);ModalPortal.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}};ModalPortal.propTypes={isOpen:_propTypes2["default"].bool.isRequired,defaultStyles:_propTypes2["default"].shape({content:_propTypes2["default"].object,overlay:_propTypes2["default"].object}),style:_propTypes2["default"].shape({content:_propTypes2["default"].object,overlay:_propTypes2["default"].object}),className:_propTypes2["default"].oneOfType([_propTypes2["default"].string,_propTypes2["default"].object]),overlayClassName:_propTypes2["default"].oneOfType([_propTypes2["default"].string,_propTypes2["default"].object]),parentSelector:_propTypes2["default"].func,bodyOpenClassName:_propTypes2["default"].string,htmlOpenClassName:_propTypes2["default"].string,ariaHideApp:_propTypes2["default"].bool,appElement:_propTypes2["default"].oneOfType([_propTypes2["default"].instanceOf(_safeHTMLElement2["default"]),_propTypes2["default"].instanceOf(_safeHTMLElement.SafeHTMLCollection),_propTypes2["default"].instanceOf(_safeHTMLElement.SafeNodeList),_propTypes2["default"].arrayOf(_propTypes2["default"].instanceOf(_safeHTMLElement2["default"]))]),onAfterOpen:_propTypes2["default"].func,onAfterClose:_propTypes2["default"].func,onRequestClose:_propTypes2["default"].func,closeTimeoutMS:_propTypes2["default"].number,shouldFocusAfterRender:_propTypes2["default"].bool,shouldCloseOnOverlayClick:_propTypes2["default"].bool,shouldReturnFocusAfterClose:_propTypes2["default"].bool,preventScroll:_propTypes2["default"].bool,role:_propTypes2["default"].string,contentLabel:_propTypes2["default"].string,aria:_propTypes2["default"].object,data:_propTypes2["default"].object,children:_propTypes2["default"].node,shouldCloseOnEsc:_propTypes2["default"].bool,overlayRef:_propTypes2["default"].func,contentRef:_propTypes2["default"].func,id:_propTypes2["default"].string,overlayElement:_propTypes2["default"].func,contentElement:_propTypes2["default"].func,testId:_propTypes2["default"].string};exports["default"]=ModalPortal;module.exports=exports["default"]})(ModalPortal,ModalPortal.exports);var ModalPortalExports=ModalPortal.exports;function componentWillMount(){var state=this.constructor.getDerivedStateFromProps(this.props,this.state);if(state!==null&&state!==undefined){this.setState(state)}}function componentWillReceiveProps(nextProps){function updater(prevState){var state=this.constructor.getDerivedStateFromProps(nextProps,prevState);return state!==null&&state!==undefined?state:null}this.setState(updater.bind(this))}function componentWillUpdate(nextProps,nextState){try{var prevProps=this.props;var prevState=this.state;this.props=nextProps;this.state=nextState;this.__reactInternalSnapshotFlag=true;this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(prevProps,prevState)}finally{this.props=prevProps;this.state=prevState}}componentWillMount.__suppressDeprecationWarning=true;componentWillReceiveProps.__suppressDeprecationWarning=true;componentWillUpdate.__suppressDeprecationWarning=true;function polyfill(Component){var prototype=Component.prototype;if(!prototype||!prototype.isReactComponent){throw new Error("Can only polyfill class components")}if(typeof Component.getDerivedStateFromProps!=="function"&&typeof prototype.getSnapshotBeforeUpdate!=="function"){return Component}var foundWillMountName=null;var foundWillReceivePropsName=null;var foundWillUpdateName=null;if(typeof prototype.componentWillMount==="function"){foundWillMountName="componentWillMount"}else if(typeof prototype.UNSAFE_componentWillMount==="function"){foundWillMountName="UNSAFE_componentWillMount"}if(typeof prototype.componentWillReceiveProps==="function"){foundWillReceivePropsName="componentWillReceiveProps"}else if(typeof prototype.UNSAFE_componentWillReceiveProps==="function"){foundWillReceivePropsName="UNSAFE_componentWillReceiveProps"}if(typeof prototype.componentWillUpdate==="function"){foundWillUpdateName="componentWillUpdate"}else if(typeof prototype.UNSAFE_componentWillUpdate==="function"){foundWillUpdateName="UNSAFE_componentWillUpdate"}if(foundWillMountName!==null||foundWillReceivePropsName!==null||foundWillUpdateName!==null){var componentName=Component.displayName||Component.name;var newApiName=typeof Component.getDerivedStateFromProps==="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+componentName+" uses "+newApiName+" but also contains the following legacy lifecycles:"+(foundWillMountName!==null?"\n  "+foundWillMountName:"")+(foundWillReceivePropsName!==null?"\n  "+foundWillReceivePropsName:"")+(foundWillUpdateName!==null?"\n  "+foundWillUpdateName:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\n"+"https://fb.me/react-async-component-lifecycle-hooks")}if(typeof Component.getDerivedStateFromProps==="function"){prototype.componentWillMount=componentWillMount;prototype.componentWillReceiveProps=componentWillReceiveProps}if(typeof prototype.getSnapshotBeforeUpdate==="function"){if(typeof prototype.componentDidUpdate!=="function"){throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype")}prototype.componentWillUpdate=componentWillUpdate;var componentDidUpdate=prototype.componentDidUpdate;prototype.componentDidUpdate=function componentDidUpdatePolyfill(prevProps,prevState,maybeSnapshot){var snapshot=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:maybeSnapshot;componentDidUpdate.call(this,prevProps,prevState,snapshot)}}return Component}var reactLifecyclesCompat_es=Object.freeze({__proto__:null,polyfill:polyfill});var require$$6=getAugmentedNamespace(reactLifecyclesCompat_es);Object.defineProperty(Modal$2,"__esModule",{value:true});Modal$2.bodyOpenClassName=Modal$2.portalClassName=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=React;var _react2=_interopRequireDefault(_react);var _reactDom=ReactDOM;var _reactDom2=_interopRequireDefault(_reactDom);var _propTypes=requirePropTypes();var _propTypes2=_interopRequireDefault(_propTypes);var _ModalPortal=ModalPortalExports;var _ModalPortal2=_interopRequireDefault(_ModalPortal);var _ariaAppHider=ariaAppHider$1;var ariaAppHider=_interopRequireWildcard(_ariaAppHider);var _safeHTMLElement=safeHTMLElement;var _safeHTMLElement2=_interopRequireDefault(_safeHTMLElement);var _reactLifecyclesCompat=require$$6;function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(_typeof2(call)==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+_typeof2(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var portalClassName=Modal$2.portalClassName="ReactModalPortal";var bodyOpenClassName=Modal$2.bodyOpenClassName="ReactModal__Body--open";var isReact16=_safeHTMLElement.canUseDOM&&_reactDom2["default"].createPortal!==undefined;var createHTMLElement=function createHTMLElement(name){return document.createElement(name)};var getCreatePortal=function getCreatePortal(){return isReact16?_reactDom2["default"].createPortal:_reactDom2["default"].unstable_renderSubtreeIntoContainer};function getParentElement(parentSelector){return parentSelector()}var Modal$1=function(_Component){_inherits(Modal,_Component);function Modal(){var _ref;var _temp,_this,_ret;_classCallCheck(this,Modal);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=Modal.__proto__||Object.getPrototypeOf(Modal)).call.apply(_ref,[this].concat(args))),_this),_this.removePortal=function(){!isReact16&&_reactDom2["default"].unmountComponentAtNode(_this.node);var parent=getParentElement(_this.props.parentSelector);if(parent&&parent.contains(_this.node)){parent.removeChild(_this.node)}else{console.warn("React-Modal: \"parentSelector\" prop did not returned any DOM "+"element. Make sure that the parent element is unmounted to "+"avoid any memory leaks.")}},_this.portalRef=function(ref){_this.portal=ref},_this.renderPortal=function(props){var createPortal=getCreatePortal();var portal=createPortal(_this,_react2["default"].createElement(_ModalPortal2["default"],_extends({defaultStyles:Modal.defaultStyles},props)),_this.node);_this.portalRef(portal)},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(Modal,[{key:"componentDidMount",value:function componentDidMount(){if(!_safeHTMLElement.canUseDOM)return;if(!isReact16){this.node=createHTMLElement("div")}this.node.className=this.props.portalClassName;var parent=getParentElement(this.props.parentSelector);parent.appendChild(this.node);!isReact16&&this.renderPortal(this.props)}},{key:"getSnapshotBeforeUpdate",value:function getSnapshotBeforeUpdate(prevProps){var prevParent=getParentElement(prevProps.parentSelector);var nextParent=getParentElement(this.props.parentSelector);return{prevParent:prevParent,nextParent:nextParent}}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,_,snapshot){if(!_safeHTMLElement.canUseDOM)return;var _props=this.props,isOpen=_props.isOpen,portalClassName=_props.portalClassName;if(prevProps.portalClassName!==portalClassName){this.node.className=portalClassName}var prevParent=snapshot.prevParent,nextParent=snapshot.nextParent;if(nextParent!==prevParent){prevParent.removeChild(this.node);nextParent.appendChild(this.node)}if(!prevProps.isOpen&&!isOpen)return;!isReact16&&this.renderPortal(this.props)}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(!_safeHTMLElement.canUseDOM||!this.node||!this.portal)return;var state=this.portal.state;var now=Date.now();var closesAt=state.isOpen&&this.props.closeTimeoutMS&&(state.closesAt||now+this.props.closeTimeoutMS);if(closesAt){if(!state.beforeClose){this.portal.closeWithTimeout()}setTimeout(this.removePortal,closesAt-now)}else{this.removePortal()}}},{key:"render",value:function render(){if(!_safeHTMLElement.canUseDOM||!isReact16){return null}if(!this.node&&isReact16){this.node=createHTMLElement("div")}var createPortal=getCreatePortal();return createPortal(_react2["default"].createElement(_ModalPortal2["default"],_extends({ref:this.portalRef,defaultStyles:Modal.defaultStyles},this.props)),this.node)}}],[{key:"setAppElement",value:function setAppElement(element){ariaAppHider.setElement(element)}}]);return Modal}(_react.Component);Modal$1.propTypes={isOpen:_propTypes2["default"].bool.isRequired,style:_propTypes2["default"].shape({content:_propTypes2["default"].object,overlay:_propTypes2["default"].object}),portalClassName:_propTypes2["default"].string,bodyOpenClassName:_propTypes2["default"].string,htmlOpenClassName:_propTypes2["default"].string,className:_propTypes2["default"].oneOfType([_propTypes2["default"].string,_propTypes2["default"].shape({base:_propTypes2["default"].string.isRequired,afterOpen:_propTypes2["default"].string.isRequired,beforeClose:_propTypes2["default"].string.isRequired})]),overlayClassName:_propTypes2["default"].oneOfType([_propTypes2["default"].string,_propTypes2["default"].shape({base:_propTypes2["default"].string.isRequired,afterOpen:_propTypes2["default"].string.isRequired,beforeClose:_propTypes2["default"].string.isRequired})]),appElement:_propTypes2["default"].oneOfType([_propTypes2["default"].instanceOf(_safeHTMLElement2["default"]),_propTypes2["default"].instanceOf(_safeHTMLElement.SafeHTMLCollection),_propTypes2["default"].instanceOf(_safeHTMLElement.SafeNodeList),_propTypes2["default"].arrayOf(_propTypes2["default"].instanceOf(_safeHTMLElement2["default"]))]),onAfterOpen:_propTypes2["default"].func,onRequestClose:_propTypes2["default"].func,closeTimeoutMS:_propTypes2["default"].number,ariaHideApp:_propTypes2["default"].bool,shouldFocusAfterRender:_propTypes2["default"].bool,shouldCloseOnOverlayClick:_propTypes2["default"].bool,shouldReturnFocusAfterClose:_propTypes2["default"].bool,preventScroll:_propTypes2["default"].bool,parentSelector:_propTypes2["default"].func,aria:_propTypes2["default"].object,data:_propTypes2["default"].object,role:_propTypes2["default"].string,contentLabel:_propTypes2["default"].string,shouldCloseOnEsc:_propTypes2["default"].bool,overlayRef:_propTypes2["default"].func,contentRef:_propTypes2["default"].func,id:_propTypes2["default"].string,overlayElement:_propTypes2["default"].func,contentElement:_propTypes2["default"].func};Modal$1.defaultProps={isOpen:false,portalClassName:portalClassName,bodyOpenClassName:bodyOpenClassName,role:"dialog",ariaHideApp:true,closeTimeoutMS:0,shouldFocusAfterRender:true,shouldCloseOnEsc:true,shouldCloseOnOverlayClick:true,shouldReturnFocusAfterClose:true,preventScroll:false,parentSelector:function parentSelector(){return document.body},overlayElement:function overlayElement(props,contentEl){return _react2["default"].createElement("div",props,contentEl)},contentElement:function contentElement(props,children){return _react2["default"].createElement("div",props,children)}};Modal$1.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}};(0,_reactLifecyclesCompat.polyfill)(Modal$1);if(process.env.NODE_ENV!=="production"){Modal$1.setCreateHTMLElement=function(fn){return createHTMLElement=fn}}Modal$2["default"]=Modal$1;(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _Modal=Modal$2;var _Modal2=_interopRequireDefault(_Modal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}exports["default"]=_Modal2["default"];module.exports=exports["default"]})(lib,lib.exports);var libExports=lib.exports;var Modal=getDefaultExportFromCjs(libExports);var classnames={exports:{}};(function(module){(function(){var hasOwn={}.hasOwnProperty;function classNames(){var classes="";for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){classes=appendClass(classes,parseValue(arg))}}return classes}function parseValue(arg){if(typeof arg==="string"||typeof arg==="number"){return arg}if(_typeof2(arg)!=="object"){return""}if(Array.isArray(arg)){return classNames.apply(null,arg)}if(arg.toString!==Object.prototype.toString&&!arg.toString.toString().includes("[native code]")){return arg.toString()}var classes="";for(var key in arg){if(hasOwn.call(arg,key)&&arg[key]){classes=appendClass(classes,key)}}return classes}function appendClass(value,newClass){if(!newClass){return value}if(value){return value+" "+newClass}return value+newClass}if(module.exports){classNames["default"]=classNames;module.exports=classNames}else{window.classNames=classNames}})()})(classnames);var classnamesExports=classnames.exports;var classNames=getDefaultExportFromCjs(classnamesExports);var OverlayImpl=function OverlayImpl(_ref12){var children=_ref12.children,_ref12$className=_ref12.className,className=_ref12$className===void 0?"":_ref12$className,isOpen=_ref12.isOpen,style=_ref12.style,closeOnEsc=_ref12.closeOnEsc,onClose=_ref12.onClose;var _React$useState3=React.useState(false),_React$useState4=_slicedToArray2(_React$useState3,2),modalShowing=_React$useState4[0],setModalShowing=_React$useState4[1];return React.createElement(Modal,{isOpen:isOpen,ariaHideApp:false,onAfterOpen:function onAfterOpen(){setModalShowing(true)},onRequestClose:function onRequestClose(){setModalShowing(false)},onAfterClose:function onAfterClose(){return onClose&&onClose()},className:classNames("wy-panel wy-overlay wy-transition",className,{"wy-open":modalShowing}),overlayClassName:"wy-overlays wy-viewport",contentLabel:"Example Modal",style:style,shouldCloseOnEsc:closeOnEsc},children)};var UIOverlay={UI:OverlayImpl};function __rest(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]]}return t}function __awaiter(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var _={label:0,sent:function sent(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(g&&(g=0,op[0]&&(_=0)),_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}function __read(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-->0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar}function __spreadArray(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))}typeof SuppressedError==="function"?SuppressedError:function(error,suppressed,message){var e=new Error(message);return e.name="SuppressedError",e.error=error,e.suppressed=suppressed,e};var mdiAccountMinus="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M1,10V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z";var mdiAccountPlus="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z";var mdiAlert="M13 14H11V9H13M13 18H11V16H13M1 21H23L12 2L1 21Z";var mdiAlertCircle="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z";var mdiAlertOctagon="M13 13H11V7H13M11 15H13V17H11M15.73 3H8.27L3 8.27V15.73L8.27 21H15.73L21 15.73V8.27L15.73 3Z";var mdiArrowLeft="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z";var mdiArrowRight="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z";var mdiAttachment="M7.5,18A5.5,5.5 0 0,1 2,12.5A5.5,5.5 0 0,1 7.5,7H18A4,4 0 0,1 22,11A4,4 0 0,1 18,15H9.5A2.5,2.5 0 0,1 7,12.5A2.5,2.5 0 0,1 9.5,10H17V11.5H9.5A1,1 0 0,0 8.5,12.5A1,1 0 0,0 9.5,13.5H18A2.5,2.5 0 0,0 20.5,11A2.5,2.5 0 0,0 18,8.5H7.5A4,4 0 0,0 3.5,12.5A4,4 0 0,0 7.5,16.5H17V18H7.5Z";var mdiBackupRestore="M12,3A9,9 0 0,0 3,12H0L4,16L8,12H5A7,7 0 0,1 12,5A7,7 0 0,1 19,12A7,7 0 0,1 12,19C10.5,19 9.09,18.5 7.94,17.7L6.5,19.14C8.04,20.3 9.94,21 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3M14,12A2,2 0 0,0 12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12Z";var mdiBell="M21,19V20H3V19L5,17V11C5,7.9 7.03,5.17 10,4.29C10,4.19 10,4.1 10,4A2,2 0 0,1 12,2A2,2 0 0,1 14,4C14,4.1 14,4.19 14,4.29C16.97,5.17 19,7.9 19,11V17L21,19M14,21A2,2 0 0,1 12,23A2,2 0 0,1 10,21";var mdiBellOff="M20.84,22.73L18.11,20H3V19L5,17V11C5,9.86 5.29,8.73 5.83,7.72L1.11,3L2.39,1.73L22.11,21.46L20.84,22.73M19,15.8V11C19,7.9 16.97,5.17 14,4.29C14,4.19 14,4.1 14,4A2,2 0 0,0 12,2A2,2 0 0,0 10,4C10,4.1 10,4.19 10,4.29C9.39,4.47 8.8,4.74 8.26,5.09L19,15.8M12,23A2,2 0 0,0 14,21H10A2,2 0 0,0 12,23Z";var mdiBox="M15.39,14.04V14.04C15.39,12.62 14.24,11.47 12.82,11.47C11.41,11.47 10.26,12.62 10.26,14.04V14.04C10.26,15.45 11.41,16.6 12.82,16.6C14.24,16.6 15.39,15.45 15.39,14.04M17.1,14.04C17.1,16.4 15.18,18.31 12.82,18.31C11.19,18.31 9.77,17.39 9.05,16.04C8.33,17.39 6.91,18.31 5.28,18.31C2.94,18.31 1.04,16.43 1,14.11V14.11H1V7H1V7C1,6.56 1.39,6.18 1.86,6.18C2.33,6.18 2.7,6.56 2.71,7V7H2.71V10.62C3.43,10.08 4.32,9.76 5.28,9.76C6.91,9.76 8.33,10.68 9.05,12.03C9.77,10.68 11.19,9.76 12.82,9.76C15.18,9.76 17.1,11.68 17.1,14.04V14.04M7.84,14.04V14.04C7.84,12.62 6.69,11.47 5.28,11.47C3.86,11.47 2.71,12.62 2.71,14.04V14.04C2.71,15.45 3.86,16.6 5.28,16.6C6.69,16.6 7.84,15.45 7.84,14.04M22.84,16.96V16.96C22.95,17.12 23,17.3 23,17.47C23,17.73 22.88,18 22.66,18.15C22.5,18.26 22.33,18.32 22.15,18.32C21.9,18.32 21.65,18.21 21.5,18L19.59,15.47L17.7,18V18C17.53,18.21 17.28,18.32 17.03,18.32C16.85,18.32 16.67,18.26 16.5,18.15C16.29,18 16.17,17.72 16.17,17.46C16.17,17.29 16.23,17.11 16.33,16.96V16.96H16.33V16.96L18.5,14.04L16.33,11.11V11.11H16.33V11.11C16.22,10.96 16.17,10.79 16.17,10.61C16.17,10.35 16.29,10.1 16.5,9.93C16.89,9.65 17.41,9.72 17.7,10.09V10.09L19.59,12.61L21.5,10.09C21.76,9.72 22.29,9.65 22.66,9.93C22.89,10.1 23,10.36 23,10.63C23,10.8 22.95,10.97 22.84,11.11V11.11H22.84V11.11L20.66,14.04L22.84,16.96V16.96H22.84Z";var mdiChartBox="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M9 17H7V10H9V17M13 17H11V7H13V17M17 17H15V13H17V17Z";var mdiCheck="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z";var mdiCheckCircle="M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z";var mdiCheckboxBlankOutline="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V19H5V5H19Z";var mdiCheckboxMarkedOutline="M19,19H5V5H15V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V11H19M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z";var mdiCircleOutline="M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z";var mdiClose="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z";var mdiCloseCircle="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z";var mdiCloud="M6.5 20Q4.22 20 2.61 18.43 1 16.85 1 14.58 1 12.63 2.17 11.1 3.35 9.57 5.25 9.15 5.88 6.85 7.75 5.43 9.63 4 12 4 14.93 4 16.96 6.04 19 8.07 19 11 20.73 11.2 21.86 12.5 23 13.78 23 15.5 23 17.38 21.69 18.69 20.38 20 18.5 20Z";var mdiComment="M9,22A1,1 0 0,1 8,21V18H4A2,2 0 0,1 2,16V4C2,2.89 2.9,2 4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H13.9L10.2,21.71C10,21.9 9.75,22 9.5,22V22H9Z";var mdiCommentOutline="M9,22A1,1 0 0,1 8,21V18H4A2,2 0 0,1 2,16V4C2,2.89 2.9,2 4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H13.9L10.2,21.71C10,21.9 9.75,22 9.5,22V22H9M10,16V19.08L13.08,16H20V4H4V16H10Z";var mdiContentSave="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z";var mdiDelete="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z";var mdiDeleteForever="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8.46,11.88L9.87,10.47L12,12.59L14.12,10.47L15.53,11.88L13.41,14L15.53,16.12L14.12,17.53L12,15.41L9.88,17.53L8.47,16.12L10.59,14L8.46,11.88M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z";var mdiDeleteRestore="M14,14H16L12,10L8,14H10V18H14V14M6,7H18V19C18,19.5 17.8,20 17.39,20.39C17,20.8 16.5,21 16,21H8C7.5,21 7,20.8 6.61,20.39C6.2,20 6,19.5 6,19V7M19,4V6H5V4H8.5L9.5,3H14.5L15.5,4H19Z";var mdiDotsVertical="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z";var mdiDownload="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z";var mdiDropbox="M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z";var mdiEmail="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z";var mdiFile="M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z";var mdiFileCode="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M6.12,15.5L9.86,19.24L11.28,17.83L8.95,15.5L11.28,13.17L9.86,11.76L6.12,15.5M17.28,15.5L13.54,11.76L12.12,13.17L14.45,15.5L12.12,17.83L13.54,19.24L17.28,15.5Z";var mdiFileDocument="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z";var mdiFileExcel="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.8,20H14L12,16.6L10,20H8.2L11.1,15.5L8.2,11H10L12,14.4L14,11H15.8L12.9,15.5L15.8,20M13,9V3.5L18.5,9H13Z";var mdiFileImage="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M6,20H15L18,20V12L14,16L12,14L6,20M8,9A2,2 0 0,0 6,11A2,2 0 0,0 8,13A2,2 0 0,0 10,11A2,2 0 0,0 8,9Z";var mdiFileMusic="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13,13H11V18A2,2 0 0,1 9,20A2,2 0 0,1 7,18A2,2 0 0,1 9,16C9.4,16 9.7,16.1 10,16.3V11H13V13M13,9V3.5L18.5,9H13Z";var mdiFilePowerpoint="M12.6,12.3H10.6V15.5H12.7C13.3,15.5 13.6,15.3 13.9,15C14.2,14.7 14.3,14.4 14.3,13.9C14.3,13.4 14.2,13.1 13.9,12.8C13.6,12.5 13.2,12.3 12.6,12.3M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.2,16C14.6,16.5 14.1,16.7 12.8,16.7H10.6V20H9V11H12.8C14.1,11 14.7,11.3 15.2,11.8C15.8,12.4 16,13 16,13.9C16,14.8 15.8,15.5 15.2,16M13,9V3.5L18.5,9H13Z";var mdiFileVideo="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M17,19V13L14,15.2V13H7V19H14V16.8L17,19Z";var mdiFileWord="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.2,20H13.8L12,13.2L10.2,20H8.8L6.6,11H8.1L9.5,17.8L11.3,11H12.6L14.4,17.8L15.8,11H17.3L15.2,20M13,9V3.5L18.5,9H13Z";var mdiFitToPage="M20,2H4C2.89,2 2,2.89 2,4V20C2,21.11 2.89,22 4,22H20C21.11,22 22,21.11 22,20V4C22,2.89 21.11,2 20,2M12,4L15,7H13V9H11V7H9M7,15L4,12L7,9V11H9V13H7M12,20L9,17H11V15H13V17H15M17,15V13H15V11H17V9L20,12";var mdiFitToScreen="M17 4H20C21.1 4 22 4.9 22 6V8H20V6H17V4M4 8V6H7V4H4C2.9 4 2 4.9 2 6V8H4M20 16V18H17V20H20C21.1 20 22 19.1 22 18V16H20M7 18H4V16H2V18C2 19.1 2.9 20 4 20H7V18M18 8H6V16H18V8Z";var mdiFolderZip="M20 6H12L10 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V8C22 6.9 21.1 6 20 6M18 12H16V14H18V16H16V18H14V16H16V14H14V12H16V10H14V8H16V10H18V12Z";var mdiFormTextbox="M17,7H22V17H17V19A1,1 0 0,0 18,20H20V22H17.5C16.95,22 16,21.55 16,21C16,21.55 15.05,22 14.5,22H12V20H14A1,1 0 0,0 15,19V5A1,1 0 0,0 14,4H12V2H14.5C15.05,2 16,2.45 16,3C16,2.45 16.95,2 17.5,2H20V4H18A1,1 0 0,0 17,5V7M2,7H13V9H4V15H13V17H2V7M20,15V9H17V15H20Z";var mdiGoogleDrive="M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z";var mdiHelpCircle="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z";var mdiInformationOutline="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z";var mdiMagnify="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z";var mdiMenuDown="M7,10L12,15L17,10H7Z";var mdiMenuUp="M7,15L12,10L17,15H7Z";var mdiMessageBadge="M22 7V16C22 17.1 21.1 18 20 18H6L2 22V4C2 2.9 2.9 2 4 2H14.1C14 2.3 14 2.7 14 3C14 5.8 16.2 8 19 8C20.1 8 21.2 7.6 22 7M16 3C16 4.7 17.3 6 19 6S22 4.7 22 3 20.7 0 19 0 16 1.3 16 3Z";var mdiMicrosoftOnedrive="M18.21 10.29Q19 10.34 19.7 10.68 20.39 11 20.9 11.57 21.41 12.12 21.71 12.83 22 13.54 22 14.34 22 15.18 21.68 15.92 21.36 16.66 20.8 17.21 20.25 17.76 19.5 18.08 18.78 18.41 17.94 18.41H7Q5.97 18.41 5.06 18 4.15 17.61 3.47 16.94 2.79 16.26 2.4 15.35 2 14.44 2 13.41 2 12.59 2.26 11.83 2.5 11.08 3 10.45 3.44 9.82 4.08 9.35 4.72 8.88 5.5 8.63 5.87 8.5 6.21 8.5 6.56 8.43 6.93 8.41H6.94Q7.37 7.75 7.95 7.23 8.5 6.71 9.2 6.34 9.87 6 10.62 5.78 11.37 5.59 12.16 5.59 13.22 5.59 14.2 5.94 15.18 6.29 16 6.91 16.8 7.53 17.37 8.39 17.95 9.26 18.21 10.29M12.16 6.84Q11.05 6.84 10.06 7.3 9.06 7.75 8.36 8.6 8.73 8.7 9.07 8.85 9.4 9 9.73 9.2L13.71 11.58L16 10.62Q16.21 10.53 16.44 10.45 16.67 10.38 16.92 10.33 16.68 9.55 16.21 8.91 15.74 8.27 15.11 7.81 14.5 7.35 13.73 7.1 13 6.84 12.16 6.84M4 15.66L12.27 12.18L9.08 10.26Q8.59 9.97 8.06 9.81 7.5 9.66 6.95 9.66 6.19 9.66 5.5 9.96 4.84 10.26 4.34 10.77 3.84 11.29 3.54 11.97 3.25 12.65 3.25 13.41 3.25 14 3.45 14.59 3.64 15.19 4 15.66M17.94 17.16Q18.41 17.16 18.84 17 19.27 16.86 19.64 16.58L13.61 13L5.03 16.59Q5.47 16.86 5.97 17 6.47 17.16 7 17.16M20.45 15.61Q20.75 15 20.75 14.34 20.75 13.7 20.5 13.17 20.26 12.65 19.85 12.28 19.43 11.91 18.88 11.71 18.32 11.5 17.7 11.5 17.35 11.5 17 11.6 16.66 11.68 16.33 11.81 16 11.93 15.67 12.08 15.35 12.23 15.04 12.37Z";var mdiMinus="M19,13H5V11H19V13Z";var mdiOpenInNew="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z";var mdiPencil="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z";var mdiPin="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z";var mdiPinOff="M2,5.27L3.28,4L20,20.72L18.73,22L12.8,16.07V22H11.2V16H6V14L8,12V11.27L2,5.27M16,12L18,14V16H17.82L8,6.18V4H7V2H17V4H16V12Z";var mdiPlus="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z";var mdiPlusCircleOutline="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z";var mdiRestore="M13,3A9,9 0 0,0 4,12H1L4.89,15.89L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3Z";var mdiSend="M2,21L23,12L2,3V10L17,12L2,14V21Z";var mdiSort="M18 21L14 17H17V7H14L18 3L22 7H19V17H22M2 19V17H12V19M2 13V11H9V13M2 7V5H6V7H2Z";var mdiStar="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z";var mdiStarOff="M20.8 22.7L17.9 19.8L18.2 21L12 17.3L5.8 21L7.4 14L2 9.2L6.9 8.8L1.1 3L2.4 1.7L22.1 21.4L20.8 22.7M22 9.2L14.8 8.6L12 2L10 6.8L16.9 13.7L22 9.2Z";var mdiSwapHorizontal="M21,9L17,5V8H10V10H17V13M7,11L3,15L7,19V16H14V14H7V11Z";var mdiThumbUp="M23,10C23,8.89 22.1,8 21,8H14.68L15.64,3.43C15.66,3.33 15.67,3.22 15.67,3.11C15.67,2.7 15.5,2.32 15.23,2.05L14.17,1L7.59,7.58C7.22,7.95 7,8.45 7,9V19A2,2 0 0,0 9,21H18C18.83,21 19.54,20.5 19.84,19.78L22.86,12.73C22.95,12.5 23,12.26 23,12V10M1,21H5V9H1V21Z";var mdiThumbUpOutline="M5,9V21H1V9H5M9,21A2,2 0 0,1 7,19V9C7,8.45 7.22,7.95 7.59,7.59L14.17,1L15.23,2.06C15.5,2.33 15.67,2.7 15.67,3.11L15.64,3.43L14.69,8H21C22.11,8 23,8.9 23,10V12C23,12.26 22.95,12.5 22.86,12.73L19.84,19.78C19.54,20.5 18.83,21 18,21H9M9,19H18.03L21,12V10H12.21L13.34,4.68L9,9.03V19Z";var mdiTrashCan="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M9,8H11V17H9V8M13,8H15V17H13V8Z";var mdiVideo="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z";var mdiViewListOutline="M3 5V19H20V5H3M7 7V9H5V7H7M5 13V11H7V13H5M5 15H7V17H5V15M18 17H9V15H18V17M18 13H9V11H18V13M18 9H9V7H18V9Z";var mdiViewModuleOutline="M4 5V18H21V5H4M14 7V10.5H11V7H14M6 7H9V10.5H6V7M6 16V12.5H9V16H6M11 16V12.5H14V16H11M19 16H16V12.5H19V16M16 10.5V7H19V10.5H16Z";var Icon$1=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof2(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t){e.exports=requirePropTypes()},function(e,t){e.exports=React},function(e,t,r){r.r(t);var n=r(1),o=r(0),_l=function l(){return(_l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=function i(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r},a=0,s=n.forwardRef(function(e,t){var r=e.title,o=void 0===r?null:r,s=e.description,c=void 0===s?null:s,u=e.size,p=void 0===u?null:u,f=e.color,d=void 0===f?"currentColor":f,y=e.horizontal,v=void 0===y?null:y,b=e.vertical,m=void 0===b?null:b,h=e.rotate,g=void 0===h?null:h,O=e.spin,w=void 0===O?null:O,j=e.style,z=void 0===j?{}:j,E=e.children,P=i(e,["title","description","size","color","horizontal","vertical","rotate","spin","style","children"]);a++;var S,x=null!==w&&w,_=n.Children.map(E,function(e){var t=e;!0!==x&&(x=!0===(null===w?t.props.spin:w));var r=t.props.size;"number"==typeof p&&"number"==typeof t.props.size&&(r=t.props.size/p);var o={size:r,color:null===d?t.props.color:d,horizontal:null===v?t.props.horizontal:v,vertical:null===m?t.props.vertical:m,rotate:null===g?t.props.rotate:g,spin:null===w?t.props.spin:w,inStack:!0};return n.cloneElement(t,o)});null!==p&&(z.width="string"==typeof p?p:1.5*p+"rem");var k,T="stack_labelledby_"+a,q="stack_describedby_"+a;if(o)S=c?T+" "+q:T;else if(k="presentation",c)throw new Error("title attribute required when description is set");return n.createElement("svg",_l({ref:t,viewBox:"0 0 24 24",style:z,role:k,"aria-labelledby":S},P),o&&n.createElement("title",{id:T},o),c&&n.createElement("desc",{id:q},c),x&&n.createElement("style",null,"@keyframes spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }","@keyframes spin-inverse { from { transform: rotate(0deg) } to { transform: rotate(-360deg) } }"),_)});s.displayName="Stack",s.propTypes={size:o.oneOfType([o.number,o.string]),color:o.string,horizontal:o.bool,vertical:o.bool,rotate:o.number,spin:o.oneOfType([o.bool,o.number]),children:o.oneOfType([o.arrayOf(o.node),o.node]).isRequired,className:o.string,style:o.object},s.defaultProps={size:null,color:null,horizontal:null,vertical:null,rotate:null,spin:null};var c=s;r.d(t,"Icon",function(){return d}),r.d(t,"Stack",function(){return c});var _u=function u(){return(_u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},p=function p(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r},f=0,d=n.forwardRef(function(e,t){var r=e.path,o=e.id,l=void 0===o?++f:o,i=e.title,a=void 0===i?null:i,s=e.description,c=void 0===s?null:s,d=e.size,y=void 0===d?null:d,v=e.color,b=void 0===v?"currentColor":v,m=e.horizontal,h=void 0!==m&&m,g=e.vertical,O=void 0!==g&&g,w=e.rotate,j=void 0===w?0:w,z=e.spin,E=void 0!==z&&z,P=e.style,S=void 0===P?{}:P,x=e.inStack,_=void 0!==x&&x,k=p(e,["path","id","title","description","size","color","horizontal","vertical","rotate","spin","style","inStack"]),T={},q=[];null!==y&&(_?q.push("scale("+y+")"):(S.width="string"==typeof y?y:1.5*y+"rem",S.height=S.width)),h&&q.push("scaleX(-1)"),O&&q.push("scaleY(-1)"),0!==j&&q.push("rotate("+j+"deg)"),null!==b&&(T.fill=b);var M=n.createElement("path",_u({d:r,style:T},_?k:{})),C=M;q.length>0&&(S.transform=q.join(" "),S.transformOrigin="center",_&&(C=n.createElement("g",{style:S},M,n.createElement("rect",{width:"24",height:"24",fill:"transparent"}))));var I,N=C,R=!0===E||"number"!=typeof E?2:E,B=!_&&(h||O);if(R<0&&(B=!B),E&&(N=n.createElement("g",{style:{animation:"spin"+(B?"-inverse":"")+" linear "+Math.abs(R)+"s infinite",transformOrigin:"center"}},C,!(h||O||0!==j)&&n.createElement("rect",{width:"24",height:"24",fill:"transparent"}))),_)return N;var X,Y="icon_labelledby_"+l,A="icon_describedby_"+l;if(a)I=c?Y+" "+A:Y;else if(X="presentation",c)throw new Error("title attribute required when description is set");return n.createElement("svg",_u({ref:t,viewBox:"0 0 24 24",style:S,role:X,"aria-labelledby":I},k),a&&n.createElement("title",{id:Y},a),c&&n.createElement("desc",{id:A},c),!_&&E&&(B?n.createElement("style",null,"@keyframes spin-inverse { from { transform: rotate(0deg) } to { transform: rotate(-360deg) } }"):n.createElement("style",null,"@keyframes spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }")),N)});d.displayName="Icon",d.propTypes={path:o.string.isRequired,size:o.oneOfType([o.number,o.string]),color:o.string,horizontal:o.bool,vertical:o.bool,rotate:o.number,spin:o.oneOfType([o.bool,o.number]),style:o.object,inStack:o.bool,className:o.string},d.defaultProps={size:null,color:"currentColor",horizontal:!1,vertical:!1,rotate:0,spin:!1};t["default"]=d}]);var MdiIcon=getDefaultExportFromCjs(Icon$1);var iconMapping={"account-minus":mdiAccountMinus,"account-plus":mdiAccountPlus,"alert":mdiAlert,"alert-circle":mdiAlertCircle,"alert-octagon":mdiAlertOctagon,"attachment":mdiAttachment,"back":mdiArrowLeft,"backup-restore":mdiBackupRestore,"bell":mdiBell,"bell-off":mdiBellOff,"check":mdiCheck,"checkbox-blank":mdiCheckboxBlankOutline,"checkbox-marked":mdiCheckboxMarkedOutline,"circle-outline":mdiCircleOutline,"check-circle":mdiCheckCircle,"close":mdiClose,"close-circle":mdiCloseCircle,"comment":mdiComment,"comment-outline":mdiCommentOutline,"content-save":mdiContentSave,"delete":mdiDelete,"delete-restore":mdiDeleteRestore,"delete-forever":mdiDeleteForever,"dots-vertical":mdiDotsVertical,"download":mdiDownload,"emoticon-plus":"M 19 0 L 19 3 L 16 3 L 16 5 L 19 5 L 19 8 L 21 8 L 21 5 L 24 5 L 24 3 L 21 3 L 21 0 L 19 0 z M 12 2 C 6.5 2 2 6.5 2 12 C 2 17.5 6.5 22 12 22 C 17.5 22 22 17.5 22 12 L 20 12 C 20 16.4 16.4 20 12 20 C 7.6 20 4 16.4 4 12 C 4 7.6 7.6 4 12 4 L 12 2 z M 8.5 8 C 7.7 8 7 8.7 7 9.5 C 7 10.3 7.7 11 8.5 11 C 9.3 11 10 10.3 10 9.5 C 10 8.7 9.3 8 8.5 8 z M 15.5 8 C 14.7 8 14 8.7 14 9.5 C 14 10.3 14.7 11 15.5 11 C 16.3 11 17 10.3 17 9.5 C 17 8.7 16.3 8 15.5 8 z M 6.9 14 C 7.7 16 9.7 17.5 12 17.5 C 14.3 17.5 16.3 16 17.1 14 L 6.9 14 z","fit-screen":mdiFitToScreen,"fit-width":mdiFitToPage,"help-circle":mdiHelpCircle,"information":mdiInformationOutline,"magnify":mdiMagnify,"menu-down":mdiMenuDown,"menu-up":mdiMenuUp,"minus":mdiMinus,"next":mdiArrowRight,"open-in-new":mdiOpenInNew,"pencil":mdiPencil,"pin":mdiPin,"unpin":mdiPinOff,"plus":mdiPlus,"plus-circle-outline":mdiPlusCircleOutline,"poll":mdiChartBox,"previous":mdiArrowLeft,"read":mdiMessageBadge,"restore":mdiRestore,"unread":mdiCheck,"send":mdiSend,"sort":mdiSort,"star":mdiStar,"unstar":mdiStarOff,"swap-horizontal":mdiSwapHorizontal,"textbox":mdiFormTextbox,"thumb-up":mdiThumbUp,"thumb-up-outline":mdiThumbUpOutline,"trashcan":mdiTrashCan,"video":mdiVideo,"view-list-outline":mdiViewListOutline,"view-module-outline":mdiViewModuleOutline,"email":mdiEmail,"file":mdiFile,"file-music":mdiFileMusic,"file-image":mdiFileImage,"file-video":mdiFileVideo,"file-code":mdiFileCode,"file-xml":mdiFileCode,"file-document":mdiFileDocument,"file-word":mdiFileWord,"file-excel":mdiFileExcel,"file-pdf":mdiFileDocument,"file-powerpoint":mdiFilePowerpoint,"file-compressed":mdiFolderZip,"dropbox":mdiDropbox,"onedrive":mdiMicrosoftOnedrive,"box":mdiBox,"google-drive":mdiGoogleDrive,"zoom":"m12 2c-5.6 0-10 4.5-10 10 0 5.6 4.5 10 10 10 5.5 0 9.9-4.5 9.9-10 .1-5.6-4.4-10-9.9-10zm2.6 13.1c0 .2-.1.3-.3.3h-6.9c-1.1 0-1.9-.8-1.9-1.9v-4.6c0-.2.1-.3.3-.3h6.9c1 0 1.9.8 1.9 1.9zm3.8.1c0 .4-.2.4-.5.2l-2.8-2.1v-2.6l2.8-2.1c.2-.2.5-.1.5.2z","cloud":mdiCloud};var nativeColors={"dropbox":"#0061fe","onedrive":"#0078d4","box":"#0161d5","google-drive":"#1a73e8","zoom":"#4a8cff"};function getIconName(name){return name.split("+")}function getIconMapping(name){return name in iconMapping?iconMapping[name]:""}var Icon=function Icon(_a){var name=_a.name,_a$color=_a.color,color=_a$color===void 0?"":_a$color,size=_a.size,className=_a.className,_a$title=_a.title,title=_a$title===void 0?"":_a$title,props=__rest(_a,["name","color","size","className","title"]);var _getIconName=getIconName(name),_getIconName2=_slicedToArray2(_getIconName,2),iconName=_getIconName2[0],overlayName=_getIconName2[1];var iconPath=getIconMapping(iconName);var overlayPath=getIconMapping(overlayName);var nativeIconColor=color==="native"&&nativeColors[iconName]||"";var nativeOverlayColor=overlayName&&nativeColors[overlayName]||"";title!==null&&title!==void 0?title:title=name.split("+").join(" ");var remSize=size?size/16:undefined;var mdiSize=remSize?remSize/1.5:undefined;if(iconPath){if(overlayPath){return React.createElement("span",{className:"wy-icon-stack",style:{width:remSize&&remSize+"rem",height:remSize&&remSize+"rem"},title:title},React.createElement(MdiIcon,Object.assign({className:classNames("wy-icon",color?"wy-icon-"+color:"",className),color:nativeIconColor,path:iconPath,size:mdiSize||"","data-icon":iconName},props)),React.createElement(MdiIcon,{color:nativeOverlayColor,path:overlayPath,className:classNames("wy-icon","wy-icon-overlay","wy-icon-".concat(overlayName)),size:(mdiSize||1)/2,"data-icon":overlayName}))}else{return React.createElement(MdiIcon,Object.assign({className:classNames("wy-icon",color?"wy-icon-"+color:"",className),color:nativeIconColor,path:iconPath,size:mdiSize||"",title:title,"data-icon":iconName},props))}}else{return React.createElement(React.Fragment,null,name)}};var IconActiveStack=function IconActiveStack(_ref13){var className=_ref13.className,children=_ref13.children;return React.createElement("div",{className:classNames("wy-icon-active-stack",className)},children)};var UIIcon={UI:Icon,ActiveStack:IconActiveStack};var SpinnerImpl=function SpinnerImpl(_ref14){var _ref14$spin=_ref14.spin,spin=_ref14$spin===void 0?true:_ref14$spin,_ref14$size=_ref14.size,size=_ref14$size===void 0?24:_ref14$size,_ref14$overlay=_ref14.overlay,overlay=_ref14$overlay===void 0?false:_ref14$overlay,progress=_ref14.progress;var strokeDashoffset=!spin&&progress&&100-progress||undefined;return strokeDashoffset!==undefined?React.createElement("svg",{viewBox:"0 0 24 24",width:size,height:size,transform:"rotate(-90)","data-icon":"progress",className:"wy-icon wy-icon-primary"},React.createElement("circle",{cx:"12",cy:"12",r:"10",strokeLinecap:"butt",strokeWidth:"2",fill:"none",stroke:"#eee"}),React.createElement("circle",{cx:"12",cy:"12",r:"10",strokeDasharray:"100",strokeDashoffset:strokeDashoffset,strokeLinecap:"butt",strokeWidth:"2",fill:"none",stroke:"currentColor",pathLength:"100"})):React.createElement("svg",{className:classNames("wy-spinner",{"wy-spin":spin,"wy-spinner-overlay":overlay}),width:size,height:size,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},React.createElement("circle",{fill:"none",cx:"12",cy:"12",r:"11",strokeLinecap:"butt",strokeWidth:"2"}))};var UISpinner={UI:SpinnerImpl};var Button=React.forwardRef(function(_a,ref){var _a$active=_a.active,active=_a$active===void 0?false:_a$active,_a$type=_a.type,type=_a$type===void 0?"button":_a$type,onClick=_a.onClick,_a$className=_a.className,className=_a$className===void 0?"":_a$className,children=_a.children,props=__rest(_a,["active","type","onClick","className","children"]);var singleChild=React.Children.count(children)===1&&React.Children.toArray(children).pop();var buttonClassNames=classNames("wy-button",className,{"wy-active":active,"wy-button-icon":(singleChild===null||singleChild===void 0?void 0:singleChild.type)===UIIcon.UI||(singleChild===null||singleChild===void 0?void 0:singleChild.type)===UIIcon.ActiveStack||(singleChild===null||singleChild===void 0?void 0:singleChild.type)===UISpinner.UI});return React.createElement("button",Object.assign({ref:ref,type:type,className:buttonClassNames,onClick:onClick},props),children)});var UIButton={UI:Button};function commonjsRequire(path){throw new Error("Could not dynamically require \""+path+"\". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.")}var pdf={exports:{}};var _nodeResolve_empty={};var _nodeResolve_empty$1=Object.freeze({__proto__:null,"default":_nodeResolve_empty});var require$$5=getAugmentedNamespace(_nodeResolve_empty$1);(function(module,exports){(function webpackUniversalModuleDefinition(root,factory){module.exports=root.pdfjsLib=factory()})(globalThis,function(){return function(){var __webpack_modules__=[,(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.VerbosityLevel=exports.Util=exports.UnknownErrorException=exports.UnexpectedResponseException=exports.TextRenderingMode=exports.RenderingIntentFlag=exports.PromiseCapability=exports.PermissionFlag=exports.PasswordResponses=exports.PasswordException=exports.PageActionEventType=exports.OPS=exports.MissingPDFException=exports.MAX_IMAGE_SIZE_TO_CACHE=exports.LINE_FACTOR=exports.LINE_DESCENT_FACTOR=exports.InvalidPDFException=exports.ImageKind=exports.IDENTITY_MATRIX=exports.FormatError=exports.FeatureTest=exports.FONT_IDENTITY_MATRIX=exports.DocumentActionEventType=exports.CMapCompressionType=exports.BaseException=exports.BASELINE_FACTOR=exports.AnnotationType=exports.AnnotationReplyType=exports.AnnotationPrefix=exports.AnnotationMode=exports.AnnotationFlag=exports.AnnotationFieldFlag=exports.AnnotationEditorType=exports.AnnotationEditorPrefix=exports.AnnotationEditorParamsType=exports.AnnotationBorderStyleType=exports.AnnotationActionEventType=exports.AbortException=void 0;exports.assert=assert;exports.bytesToString=bytesToString;exports.createValidAbsoluteUrl=createValidAbsoluteUrl;exports.getModificationDate=getModificationDate;exports.getUuid=getUuid;exports.getVerbosityLevel=getVerbosityLevel;exports.info=info;exports.isArrayBuffer=isArrayBuffer;exports.isArrayEqual=isArrayEqual;exports.isNodeJS=void 0;exports.normalizeUnicode=normalizeUnicode;exports.objectFromMap=objectFromMap;exports.objectSize=objectSize;exports.setVerbosityLevel=setVerbosityLevel;exports.shadow=shadow;exports.string32=string32;exports.stringToBytes=stringToBytes;exports.stringToPDFString=stringToPDFString;exports.stringToUTF8String=stringToUTF8String;exports.unreachable=unreachable;exports.utf8StringToString=utf8StringToString;exports.warn=warn;var isNodeJS=(typeof process==="undefined"?"undefined":_typeof2(process))==="object"&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");exports.isNodeJS=isNodeJS;var IDENTITY_MATRIX=[1,0,0,1,0,0];exports.IDENTITY_MATRIX=IDENTITY_MATRIX;var FONT_IDENTITY_MATRIX=[0.001,0,0,0.001,0,0];exports.FONT_IDENTITY_MATRIX=FONT_IDENTITY_MATRIX;var MAX_IMAGE_SIZE_TO_CACHE=10e6;exports.MAX_IMAGE_SIZE_TO_CACHE=MAX_IMAGE_SIZE_TO_CACHE;var LINE_FACTOR=1.35;exports.LINE_FACTOR=LINE_FACTOR;var LINE_DESCENT_FACTOR=0.35;exports.LINE_DESCENT_FACTOR=LINE_DESCENT_FACTOR;var BASELINE_FACTOR=LINE_DESCENT_FACTOR/LINE_FACTOR;exports.BASELINE_FACTOR=BASELINE_FACTOR;var RenderingIntentFlag={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};exports.RenderingIntentFlag=RenderingIntentFlag;var AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};exports.AnnotationMode=AnnotationMode;var AnnotationEditorPrefix="pdfjs_internal_editor_";exports.AnnotationEditorPrefix=AnnotationEditorPrefix;var AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};exports.AnnotationEditorType=AnnotationEditorType;var AnnotationEditorParamsType={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};exports.AnnotationEditorParamsType=AnnotationEditorParamsType;var PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};exports.PermissionFlag=PermissionFlag;var TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};exports.TextRenderingMode=TextRenderingMode;var ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};exports.ImageKind=ImageKind;var AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};exports.AnnotationType=AnnotationType;var AnnotationReplyType={GROUP:"Group",REPLY:"R"};exports.AnnotationReplyType=AnnotationReplyType;var AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};exports.AnnotationFlag=AnnotationFlag;var AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};exports.AnnotationFieldFlag=AnnotationFieldFlag;var AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};exports.AnnotationBorderStyleType=AnnotationBorderStyleType;var AnnotationActionEventType={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};exports.AnnotationActionEventType=AnnotationActionEventType;var DocumentActionEventType={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};exports.DocumentActionEventType=DocumentActionEventType;var PageActionEventType={O:"PageOpen",C:"PageClose"};exports.PageActionEventType=PageActionEventType;var VerbosityLevel={ERRORS:0,WARNINGS:1,INFOS:5};exports.VerbosityLevel=VerbosityLevel;var CMapCompressionType={NONE:0,BINARY:1};exports.CMapCompressionType=CMapCompressionType;var OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};exports.OPS=OPS;var PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};exports.PasswordResponses=PasswordResponses;var verbosity=VerbosityLevel.WARNINGS;function setVerbosityLevel(level){if(Number.isInteger(level)){verbosity=level}}function getVerbosityLevel(){return verbosity}function info(msg){if(verbosity>=VerbosityLevel.INFOS){console.log("Info: ".concat(msg))}}function warn(msg){if(verbosity>=VerbosityLevel.WARNINGS){console.log("Warning: ".concat(msg))}}function unreachable(msg){throw new Error(msg)}function assert(cond,msg){if(!cond){unreachable(msg)}}function _isValidProtocol(url){switch(url===null||url===void 0?void 0:url.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return true;default:return false}}function createValidAbsoluteUrl(url){var baseUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!url){return null}try{if(options&&typeof url==="string"){if(options.addDefaultProtocol&&url.startsWith("www.")){var dots=url.match(/\./g);if((dots===null||dots===void 0?void 0:dots.length)>=2){url="http://".concat(url)}}if(options.tryConvertEncoding){try{url=stringToUTF8String(url)}catch(_unused3){}}}var absoluteUrl=baseUrl?new URL(url,baseUrl):new URL(url);if(_isValidProtocol(absoluteUrl)){return absoluteUrl}}catch(_unused4){}return null}function shadow(obj,prop,value){var nonSerializable=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;Object.defineProperty(obj,prop,{value:value,enumerable:!nonSerializable,configurable:true,writable:false});return value}var BaseException=function BaseExceptionClosure(){function BaseException(message,name){if(this.constructor===BaseException){unreachable("Cannot initialize BaseException.")}this.message=message;this.name=name}BaseException.prototype=new Error;BaseException.constructor=BaseException;return BaseException}();exports.BaseException=BaseException;var PasswordException=function(_BaseException){_inherits2(PasswordException,_BaseException);var _super13=_createSuper(PasswordException);function PasswordException(msg,code){var _this40;_classCallCheck2(this,PasswordException);_this40=_super13.call(this,msg,"PasswordException");_this40.code=code;return _this40}return _createClass2(PasswordException)}(BaseException);exports.PasswordException=PasswordException;var UnknownErrorException=function(_BaseException2){_inherits2(UnknownErrorException,_BaseException2);var _super14=_createSuper(UnknownErrorException);function UnknownErrorException(msg,details){var _this41;_classCallCheck2(this,UnknownErrorException);_this41=_super14.call(this,msg,"UnknownErrorException");_this41.details=details;return _this41}return _createClass2(UnknownErrorException)}(BaseException);exports.UnknownErrorException=UnknownErrorException;var InvalidPDFException=function(_BaseException3){_inherits2(InvalidPDFException,_BaseException3);var _super15=_createSuper(InvalidPDFException);function InvalidPDFException(msg){_classCallCheck2(this,InvalidPDFException);return _super15.call(this,msg,"InvalidPDFException")}return _createClass2(InvalidPDFException)}(BaseException);exports.InvalidPDFException=InvalidPDFException;var MissingPDFException=function(_BaseException4){_inherits2(MissingPDFException,_BaseException4);var _super16=_createSuper(MissingPDFException);function MissingPDFException(msg){_classCallCheck2(this,MissingPDFException);return _super16.call(this,msg,"MissingPDFException")}return _createClass2(MissingPDFException)}(BaseException);exports.MissingPDFException=MissingPDFException;var UnexpectedResponseException=function(_BaseException5){_inherits2(UnexpectedResponseException,_BaseException5);var _super17=_createSuper(UnexpectedResponseException);function UnexpectedResponseException(msg,status){var _this42;_classCallCheck2(this,UnexpectedResponseException);_this42=_super17.call(this,msg,"UnexpectedResponseException");_this42.status=status;return _this42}return _createClass2(UnexpectedResponseException)}(BaseException);exports.UnexpectedResponseException=UnexpectedResponseException;var FormatError=function(_BaseException6){_inherits2(FormatError,_BaseException6);var _super18=_createSuper(FormatError);function FormatError(msg){_classCallCheck2(this,FormatError);return _super18.call(this,msg,"FormatError")}return _createClass2(FormatError)}(BaseException);exports.FormatError=FormatError;var AbortException=function(_BaseException7){_inherits2(AbortException,_BaseException7);var _super19=_createSuper(AbortException);function AbortException(msg){_classCallCheck2(this,AbortException);return _super19.call(this,msg,"AbortException")}return _createClass2(AbortException)}(BaseException);exports.AbortException=AbortException;function bytesToString(bytes){if(_typeof2(bytes)!=="object"||(bytes===null||bytes===void 0?void 0:bytes.length)===undefined){unreachable("Invalid argument for bytesToString")}var length=bytes.length;var MAX_ARGUMENT_COUNT=8192;if(length<MAX_ARGUMENT_COUNT){return String.fromCharCode.apply(null,bytes)}var strBuf=[];for(var _i4=0;_i4<length;_i4+=MAX_ARGUMENT_COUNT){var chunkEnd=Math.min(_i4+MAX_ARGUMENT_COUNT,length);var chunk=bytes.subarray(_i4,chunkEnd);strBuf.push(String.fromCharCode.apply(null,chunk))}return strBuf.join("")}function stringToBytes(str){if(typeof str!=="string"){unreachable("Invalid argument for stringToBytes")}var length=str.length;var bytes=new Uint8Array(length);for(var _i5=0;_i5<length;++_i5){bytes[_i5]=str.charCodeAt(_i5)&255}return bytes}function string32(value){return String.fromCharCode(value>>24&255,value>>16&255,value>>8&255,value&255)}function objectSize(obj){return Object.keys(obj).length}function objectFromMap(map){var obj=Object.create(null);var _iterator11=_createForOfIteratorHelper(map),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var _step11$value=_slicedToArray2(_step11.value,2),key=_step11$value[0],value=_step11$value[1];obj[key]=value}}catch(err){_iterator11.e(err)}finally{_iterator11.f()}return obj}function isLittleEndian(){var buffer8=new Uint8Array(4);buffer8[0]=1;var view32=new Uint32Array(buffer8.buffer,0,1);return view32[0]===1}function isEvalSupported(){try{new Function("");return true}catch(_unused5){return false}}var FeatureTest=function(){function FeatureTest(){_classCallCheck2(this,FeatureTest)}_createClass2(FeatureTest,null,[{key:"isLittleEndian",get:function get(){return shadow(this,"isLittleEndian",isLittleEndian())}},{key:"isEvalSupported",get:function get(){return shadow(this,"isEvalSupported",isEvalSupported())}},{key:"isOffscreenCanvasSupported",get:function get(){return shadow(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!=="undefined")}},{key:"platform",get:function get(){if(typeof navigator==="undefined"){return shadow(this,"platform",{isWin:false,isMac:false})}return shadow(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}},{key:"isCSSRoundSupported",get:function get(){var _globalThis$CSS,_globalThis$CSS$suppo;return shadow(this,"isCSSRoundSupported",(_globalThis$CSS=globalThis.CSS)===null||_globalThis$CSS===void 0||(_globalThis$CSS$suppo=_globalThis$CSS.supports)===null||_globalThis$CSS$suppo===void 0?void 0:_globalThis$CSS$suppo.call(_globalThis$CSS,"width: round(1.5px, 1px)"))}}]);return FeatureTest}();exports.FeatureTest=FeatureTest;var hexNumbers=_toConsumableArray2(Array(256).keys()).map(function(n){return n.toString(16).padStart(2,"0")});var Util=function(){function Util(){_classCallCheck2(this,Util)}_createClass2(Util,null,[{key:"makeHexColor",value:function makeHexColor(r,g,b){return"#".concat(hexNumbers[r]).concat(hexNumbers[g]).concat(hexNumbers[b])}},{key:"scaleMinMax",value:function scaleMinMax(transform,minMax){var temp;if(transform[0]){if(transform[0]<0){temp=minMax[0];minMax[0]=minMax[1];minMax[1]=temp}minMax[0]*=transform[0];minMax[1]*=transform[0];if(transform[3]<0){temp=minMax[2];minMax[2]=minMax[3];minMax[3]=temp}minMax[2]*=transform[3];minMax[3]*=transform[3]}else{temp=minMax[0];minMax[0]=minMax[2];minMax[2]=temp;temp=minMax[1];minMax[1]=minMax[3];minMax[3]=temp;if(transform[1]<0){temp=minMax[2];minMax[2]=minMax[3];minMax[3]=temp}minMax[2]*=transform[1];minMax[3]*=transform[1];if(transform[2]<0){temp=minMax[0];minMax[0]=minMax[1];minMax[1]=temp}minMax[0]*=transform[2];minMax[1]*=transform[2]}minMax[0]+=transform[4];minMax[1]+=transform[4];minMax[2]+=transform[5];minMax[3]+=transform[5]}},{key:"transform",value:function transform(m1,m2){return[m1[0]*m2[0]+m1[2]*m2[1],m1[1]*m2[0]+m1[3]*m2[1],m1[0]*m2[2]+m1[2]*m2[3],m1[1]*m2[2]+m1[3]*m2[3],m1[0]*m2[4]+m1[2]*m2[5]+m1[4],m1[1]*m2[4]+m1[3]*m2[5]+m1[5]]}},{key:"applyTransform",value:function applyTransform(p,m){var xt=p[0]*m[0]+p[1]*m[2]+m[4];var yt=p[0]*m[1]+p[1]*m[3]+m[5];return[xt,yt]}},{key:"applyInverseTransform",value:function applyInverseTransform(p,m){var d=m[0]*m[3]-m[1]*m[2];var xt=(p[0]*m[3]-p[1]*m[2]+m[2]*m[5]-m[4]*m[3])/d;var yt=(-p[0]*m[1]+p[1]*m[0]+m[4]*m[1]-m[5]*m[0])/d;return[xt,yt]}},{key:"getAxialAlignedBoundingBox",value:function getAxialAlignedBoundingBox(r,m){var p1=this.applyTransform(r,m);var p2=this.applyTransform(r.slice(2,4),m);var p3=this.applyTransform([r[0],r[3]],m);var p4=this.applyTransform([r[2],r[1]],m);return[Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1])]}},{key:"inverseTransform",value:function inverseTransform(m){var d=m[0]*m[3]-m[1]*m[2];return[m[3]/d,-m[1]/d,-m[2]/d,m[0]/d,(m[2]*m[5]-m[4]*m[3])/d,(m[4]*m[1]-m[5]*m[0])/d]}},{key:"singularValueDecompose2dScale",value:function singularValueDecompose2dScale(m){var transpose=[m[0],m[2],m[1],m[3]];var a=m[0]*transpose[0]+m[1]*transpose[2];var b=m[0]*transpose[1]+m[1]*transpose[3];var c=m[2]*transpose[0]+m[3]*transpose[2];var d=m[2]*transpose[1]+m[3]*transpose[3];var first=(a+d)/2;var second=Math.sqrt(Math.pow(a+d,2)-4*(a*d-c*b))/2;var sx=first+second||1;var sy=first-second||1;return[Math.sqrt(sx),Math.sqrt(sy)]}},{key:"normalizeRect",value:function normalizeRect(rect){var r=rect.slice(0);if(rect[0]>rect[2]){r[0]=rect[2];r[2]=rect[0]}if(rect[1]>rect[3]){r[1]=rect[3];r[3]=rect[1]}return r}},{key:"intersect",value:function intersect(rect1,rect2){var xLow=Math.max(Math.min(rect1[0],rect1[2]),Math.min(rect2[0],rect2[2]));var xHigh=Math.min(Math.max(rect1[0],rect1[2]),Math.max(rect2[0],rect2[2]));if(xLow>xHigh){return null}var yLow=Math.max(Math.min(rect1[1],rect1[3]),Math.min(rect2[1],rect2[3]));var yHigh=Math.min(Math.max(rect1[1],rect1[3]),Math.max(rect2[1],rect2[3]));if(yLow>yHigh){return null}return[xLow,yLow,xHigh,yHigh]}},{key:"bezierBoundingBox",value:function bezierBoundingBox(x0,y0,x1,y1,x2,y2,x3,y3){var tvalues=[],bounds=[[],[]];var a,b,c,t,t1,t2,b2ac,sqrtb2ac;for(var _i6=0;_i6<2;++_i6){if(_i6===0){b=6*x0-12*x1+6*x2;a=-3*x0+9*x1-9*x2+3*x3;c=3*x1-3*x0}else{b=6*y0-12*y1+6*y2;a=-3*y0+9*y1-9*y2+3*y3;c=3*y1-3*y0}if(Math.abs(a)<1e-12){if(Math.abs(b)<1e-12){continue}t=-c/b;if(0<t&&t<1){tvalues.push(t)}continue}b2ac=b*b-4*c*a;sqrtb2ac=Math.sqrt(b2ac);if(b2ac<0){continue}t1=(-b+sqrtb2ac)/(2*a);if(0<t1&&t1<1){tvalues.push(t1)}t2=(-b-sqrtb2ac)/(2*a);if(0<t2&&t2<1){tvalues.push(t2)}}var j=tvalues.length,mt;var jlen=j;while(j--){t=tvalues[j];mt=1-t;bounds[0][j]=mt*mt*mt*x0+3*mt*mt*t*x1+3*mt*t*t*x2+t*t*t*x3;bounds[1][j]=mt*mt*mt*y0+3*mt*mt*t*y1+3*mt*t*t*y2+t*t*t*y3}bounds[0][jlen]=x0;bounds[1][jlen]=y0;bounds[0][jlen+1]=x3;bounds[1][jlen+1]=y3;bounds[0].length=bounds[1].length=jlen+2;return[Math.min.apply(Math,_toConsumableArray2(bounds[0])),Math.min.apply(Math,_toConsumableArray2(bounds[1])),Math.max.apply(Math,_toConsumableArray2(bounds[0])),Math.max.apply(Math,_toConsumableArray2(bounds[1]))]}}]);return Util}();exports.Util=Util;var PDFStringTranslateTable=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function stringToPDFString(str){if(str[0]>="\xEF"){var encoding;if(str[0]==="\xFE"&&str[1]==="\xFF"){encoding="utf-16be"}else if(str[0]==="\xFF"&&str[1]==="\xFE"){encoding="utf-16le"}else if(str[0]==="\xEF"&&str[1]==="\xBB"&&str[2]==="\xBF"){encoding="utf-8"}if(encoding){try{var decoder=new TextDecoder(encoding,{fatal:true});var buffer=stringToBytes(str);return decoder.decode(buffer)}catch(ex){warn("stringToPDFString: \"".concat(ex,"\"."))}}}var strBuf=[];for(var _i7=0,ii=str.length;_i7<ii;_i7++){var _code=PDFStringTranslateTable[str.charCodeAt(_i7)];strBuf.push(_code?String.fromCharCode(_code):str.charAt(_i7))}return strBuf.join("")}function stringToUTF8String(str){return decodeURIComponent(escape(str))}function utf8StringToString(str){return unescape(encodeURIComponent(str))}function isArrayBuffer(v){return _typeof2(v)==="object"&&(v===null||v===void 0?void 0:v.byteLength)!==undefined}function isArrayEqual(arr1,arr2){if(arr1.length!==arr2.length){return false}for(var _i8=0,ii=arr1.length;_i8<ii;_i8++){if(arr1[_i8]!==arr2[_i8]){return false}}return true}function getModificationDate(){var date=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Date;var buffer=[date.getUTCFullYear().toString(),(date.getUTCMonth()+1).toString().padStart(2,"0"),date.getUTCDate().toString().padStart(2,"0"),date.getUTCHours().toString().padStart(2,"0"),date.getUTCMinutes().toString().padStart(2,"0"),date.getUTCSeconds().toString().padStart(2,"0")];return buffer.join("")}var _settled=new WeakMap;var PromiseCapability=function(){function PromiseCapability(){var _this43=this;_classCallCheck2(this,PromiseCapability);_classPrivateFieldInitSpec(this,_settled,{writable:true,value:false});this.promise=new Promise(function(resolve,reject){_this43.resolve=function(data){_classPrivateFieldSet(_this43,_settled,true);resolve(data)};_this43.reject=function(reason){_classPrivateFieldSet(_this43,_settled,true);reject(reason)}})}_createClass2(PromiseCapability,[{key:"settled",get:function get(){return _classPrivateFieldGet(this,_settled)}}]);return PromiseCapability}();exports.PromiseCapability=PromiseCapability;var NormalizeRegex=null;var NormalizationMap=null;function normalizeUnicode(str){if(!NormalizeRegex){NormalizeRegex=/([\xA0\xB5\u037E\u0EB3\u2000-\u200A\u202F\u2126\uFB00-\uFB04\uFB06\uFB20-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBA1\uFBA4-\uFBA9\uFBAE-\uFBB1\uFBD3-\uFBDC\uFBDE-\uFBE7\uFBEA-\uFBF8\uFBFC\uFBFD\uFC00-\uFC5D\uFC64-\uFCF1\uFCF5-\uFD3D\uFD88\uFDF4\uFDFA\uFDFB\uFE71\uFE77\uFE79\uFE7B\uFE7D]+)|(\uFB05+)/g;NormalizationMap=new Map([["\uFB05","\u017Ft"]])}return str.replaceAll(NormalizeRegex,function(_,p1,p2){return p1?p1.normalize("NFKC"):NormalizationMap.get(p2)})}function getUuid(){var _crypto,_crypto2;if(typeof crypto!=="undefined"&&typeof((_crypto=crypto)===null||_crypto===void 0?void 0:_crypto.randomUUID)==="function"){return crypto.randomUUID()}var buf=new Uint8Array(32);if(typeof crypto!=="undefined"&&typeof((_crypto2=crypto)===null||_crypto2===void 0?void 0:_crypto2.getRandomValues)==="function"){crypto.getRandomValues(buf)}else{for(var _i9=0;_i9<32;_i9++){buf[_i9]=Math.floor(Math.random()*255)}}return bytesToString(buf)}var AnnotationPrefix="pdfjs_internal_id_";exports.AnnotationPrefix=AnnotationPrefix}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0;Object.defineProperty(exports,"SVGGraphics",{enumerable:true,get:function get(){return _displaySvg.SVGGraphics}});exports.build=void 0;exports.getDocument=getDocument;exports.version=void 0;var _util=__w_pdfjs_require__(1);var _annotation_storage=__w_pdfjs_require__(3);var _display_utils=__w_pdfjs_require__(6);var _font_loader=__w_pdfjs_require__(9);var _displayNode_utils=__w_pdfjs_require__(10);var _canvas=__w_pdfjs_require__(11);var _worker_options=__w_pdfjs_require__(14);var _message_handler=__w_pdfjs_require__(15);var _metadata=__w_pdfjs_require__(16);var _optional_content_config=__w_pdfjs_require__(17);var _transport_stream=__w_pdfjs_require__(18);var _displayFetch_stream=__w_pdfjs_require__(19);var _displayNetwork=__w_pdfjs_require__(22);var _displayNode_stream=__w_pdfjs_require__(23);var _displaySvg=__w_pdfjs_require__(24);var _xfa_text=__w_pdfjs_require__(25);var DEFAULT_RANGE_CHUNK_SIZE=65536;var RENDERING_CANCELLED_TIMEOUT=100;var DELAYED_CLEANUP_TIMEOUT=5000;var DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;var DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;var DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;var DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(src){var _src$password,_src$length;if(typeof src==="string"||src instanceof URL){src={url:src}}else if((0,_util.isArrayBuffer)(src)){src={data:src}}if(_typeof2(src)!=="object"){throw new Error("Invalid parameter in getDocument, need parameter object.")}if(!src.url&&!src.data&&!src.range){throw new Error("Invalid parameter object: need either .data, .range or .url")}var task=new PDFDocumentLoadingTask;var docId=task.docId;var url=src.url?getUrlProp(src.url):null;var data=src.data?getDataProp(src.data):null;var httpHeaders=src.httpHeaders||null;var withCredentials=src.withCredentials===true;var password=(_src$password=src.password)!==null&&_src$password!==void 0?_src$password:null;var rangeTransport=src.range instanceof PDFDataRangeTransport?src.range:null;var rangeChunkSize=Number.isInteger(src.rangeChunkSize)&&src.rangeChunkSize>0?src.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;var worker=src.worker instanceof PDFWorker?src.worker:null;var verbosity=src.verbosity;var docBaseUrl=typeof src.docBaseUrl==="string"&&!(0,_display_utils.isDataScheme)(src.docBaseUrl)?src.docBaseUrl:null;var cMapUrl=typeof src.cMapUrl==="string"?src.cMapUrl:null;var cMapPacked=src.cMapPacked!==false;var CMapReaderFactory=src.CMapReaderFactory||DefaultCMapReaderFactory;var standardFontDataUrl=typeof src.standardFontDataUrl==="string"?src.standardFontDataUrl:null;var StandardFontDataFactory=src.StandardFontDataFactory||DefaultStandardFontDataFactory;var ignoreErrors=src.stopAtErrors!==true;var maxImageSize=Number.isInteger(src.maxImageSize)&&src.maxImageSize>-1?src.maxImageSize:-1;var isEvalSupported=src.isEvalSupported!==false;var isOffscreenCanvasSupported=typeof src.isOffscreenCanvasSupported==="boolean"?src.isOffscreenCanvasSupported:!_util.isNodeJS;var canvasMaxAreaInBytes=Number.isInteger(src.canvasMaxAreaInBytes)?src.canvasMaxAreaInBytes:-1;var disableFontFace=typeof src.disableFontFace==="boolean"?src.disableFontFace:_util.isNodeJS;var fontExtraProperties=src.fontExtraProperties===true;var enableXfa=src.enableXfa===true;var ownerDocument=src.ownerDocument||globalThis.document;var disableRange=src.disableRange===true;var disableStream=src.disableStream===true;var disableAutoFetch=src.disableAutoFetch===true;var pdfBug=src.pdfBug===true;var length=rangeTransport?rangeTransport.length:(_src$length=src.length)!==null&&_src$length!==void 0?_src$length:NaN;var useSystemFonts=typeof src.useSystemFonts==="boolean"?src.useSystemFonts:!_util.isNodeJS&&!disableFontFace;var useWorkerFetch=typeof src.useWorkerFetch==="boolean"?src.useWorkerFetch:CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory&&cMapUrl&&standardFontDataUrl&&(0,_display_utils.isValidFetchUrl)(cMapUrl,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(standardFontDataUrl,document.baseURI);var canvasFactory=src.canvasFactory||new DefaultCanvasFactory({ownerDocument:ownerDocument});var filterFactory=src.filterFactory||new DefaultFilterFactory({docId:docId,ownerDocument:ownerDocument});var styleElement=null;(0,_util.setVerbosityLevel)(verbosity);var transportFactory={canvasFactory:canvasFactory,filterFactory:filterFactory};if(!useWorkerFetch){transportFactory.cMapReaderFactory=new CMapReaderFactory({baseUrl:cMapUrl,isCompressed:cMapPacked});transportFactory.standardFontDataFactory=new StandardFontDataFactory({baseUrl:standardFontDataUrl})}if(!worker){var workerParams={verbosity:verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};worker=workerParams.port?PDFWorker.fromPort(workerParams):new PDFWorker(workerParams);task._worker=worker}var fetchDocParams={docId:docId,apiVersion:"3.11.174",data:data,password:password,disableAutoFetch:disableAutoFetch,rangeChunkSize:rangeChunkSize,length:length,docBaseUrl:docBaseUrl,enableXfa:enableXfa,evaluatorOptions:{maxImageSize:maxImageSize,disableFontFace:disableFontFace,ignoreErrors:ignoreErrors,isEvalSupported:isEvalSupported,isOffscreenCanvasSupported:isOffscreenCanvasSupported,canvasMaxAreaInBytes:canvasMaxAreaInBytes,fontExtraProperties:fontExtraProperties,useSystemFonts:useSystemFonts,cMapUrl:useWorkerFetch?cMapUrl:null,standardFontDataUrl:useWorkerFetch?standardFontDataUrl:null}};var transportParams={ignoreErrors:ignoreErrors,isEvalSupported:isEvalSupported,disableFontFace:disableFontFace,fontExtraProperties:fontExtraProperties,enableXfa:enableXfa,ownerDocument:ownerDocument,disableAutoFetch:disableAutoFetch,pdfBug:pdfBug,styleElement:styleElement};worker.promise.then(function(){if(task.destroyed){throw new Error("Loading aborted")}var workerIdPromise=_fetchDocument(worker,fetchDocParams);var networkStreamPromise=new Promise(function(resolve){var networkStream;if(rangeTransport){networkStream=new _transport_stream.PDFDataTransportStream({length:length,initialData:rangeTransport.initialData,progressiveDone:rangeTransport.progressiveDone,contentDispositionFilename:rangeTransport.contentDispositionFilename,disableRange:disableRange,disableStream:disableStream},rangeTransport)}else if(!data){var createPDFNetworkStream=function createPDFNetworkStream(params){if(_util.isNodeJS){return new _displayNode_stream.PDFNodeStream(params)}return(0,_display_utils.isValidFetchUrl)(params.url)?new _displayFetch_stream.PDFFetchStream(params):new _displayNetwork.PDFNetworkStream(params)};networkStream=createPDFNetworkStream({url:url,length:length,httpHeaders:httpHeaders,withCredentials:withCredentials,rangeChunkSize:rangeChunkSize,disableRange:disableRange,disableStream:disableStream})}resolve(networkStream)});return Promise.all([workerIdPromise,networkStreamPromise]).then(function(_ref15){var _ref16=_slicedToArray2(_ref15,2),workerId=_ref16[0],networkStream=_ref16[1];if(task.destroyed){throw new Error("Loading aborted")}var messageHandler=new _message_handler.MessageHandler(docId,workerId,worker.port);var transport=new WorkerTransport(messageHandler,task,networkStream,transportParams,transportFactory);task._transport=transport;messageHandler.send("Ready",null)})})["catch"](task._capability.reject);return task}function _fetchDocument(_x45,_x46){return _fetchDocument2.apply(this,arguments)}function _fetchDocument2(){_fetchDocument2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee38(worker,source){var workerId;return _regeneratorRuntime().wrap(function _callee38$(_context39){while(1)switch(_context39.prev=_context39.next){case 0:if(!worker.destroyed){_context39.next=2;break}throw new Error("Worker was destroyed");case 2:_context39.next=4;return worker.messageHandler.sendWithPromise("GetDocRequest",source,source.data?[source.data.buffer]:null);case 4:workerId=_context39.sent;if(!worker.destroyed){_context39.next=7;break}throw new Error("Worker was destroyed");case 7:return _context39.abrupt("return",workerId);case 8:case"end":return _context39.stop()}},_callee38)}));return _fetchDocument2.apply(this,arguments)}function getUrlProp(val){if(val instanceof URL){return val.href}try{return new URL(val,window.location).href}catch(_unused6){if(_util.isNodeJS&&typeof val==="string"){return val}}throw new Error("Invalid PDF url data: "+"either string or URL-object is expected in the url property.")}function getDataProp(val){if(_util.isNodeJS&&typeof Buffer!=="undefined"&&val instanceof Buffer){throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.")}if(val instanceof Uint8Array&&val.byteLength===val.buffer.byteLength){return val}if(typeof val==="string"){return(0,_util.stringToBytes)(val)}if(_typeof2(val)==="object"&&!isNaN(val===null||val===void 0?void 0:val.length)||(0,_util.isArrayBuffer)(val)){return new Uint8Array(val)}throw new Error("Invalid PDF binary data: either TypedArray, "+"string, or array-like object is expected in the data property.")}var PDFDocumentLoadingTask=function(){function PDFDocumentLoadingTask(){var _PDFDocumentLoadingTa,_PDFDocumentLoadingTa2;_classCallCheck2(this,PDFDocumentLoadingTask);this._capability=new _util.PromiseCapability;this._transport=null;this._worker=null;this.docId="d".concat((_classStaticPrivateFieldSpecSet(PDFDocumentLoadingTask,PDFDocumentLoadingTask,_docId,(_PDFDocumentLoadingTa=_classStaticPrivateFieldSpecGet(PDFDocumentLoadingTask,PDFDocumentLoadingTask,_docId),_PDFDocumentLoadingTa2=_PDFDocumentLoadingTa++,_PDFDocumentLoadingTa)),_PDFDocumentLoadingTa2));this.destroyed=false;this.onPassword=null;this.onProgress=null}_createClass2(PDFDocumentLoadingTask,[{key:"promise",get:function get(){return this._capability.promise}},{key:"destroy",value:function(){var _destroy=_asyncToGenerator(_regeneratorRuntime().mark(function _callee33(){var _this$_worker,_this$_transport,_this$_worker2;return _regeneratorRuntime().wrap(function _callee33$(_context34){while(1)switch(_context34.prev=_context34.next){case 0:this.destroyed=true;_context34.prev=1;if((_this$_worker=this._worker)!==null&&_this$_worker!==void 0&&_this$_worker.port){this._worker._pendingDestroy=true}_context34.next=5;return(_this$_transport=this._transport)===null||_this$_transport===void 0?void 0:_this$_transport.destroy();case 5:_context34.next=11;break;case 7:_context34.prev=7;_context34.t0=_context34["catch"](1);if((_this$_worker2=this._worker)!==null&&_this$_worker2!==void 0&&_this$_worker2.port){delete this._worker._pendingDestroy}throw _context34.t0;case 11:this._transport=null;if(this._worker){this._worker.destroy();this._worker=null}case 13:case"end":return _context34.stop()}},_callee33,this,[[1,7]])}));function destroy(){return _destroy.apply(this,arguments)}return destroy}()}]);return PDFDocumentLoadingTask}();var _docId={writable:true,value:0};exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;var PDFDataRangeTransport=function(){function PDFDataRangeTransport(length,initialData){var progressiveDone=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var contentDispositionFilename=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_classCallCheck2(this,PDFDataRangeTransport);this.length=length;this.initialData=initialData;this.progressiveDone=progressiveDone;this.contentDispositionFilename=contentDispositionFilename;this._rangeListeners=[];this._progressListeners=[];this._progressiveReadListeners=[];this._progressiveDoneListeners=[];this._readyCapability=new _util.PromiseCapability}_createClass2(PDFDataRangeTransport,[{key:"addRangeListener",value:function addRangeListener(listener){this._rangeListeners.push(listener)}},{key:"addProgressListener",value:function addProgressListener(listener){this._progressListeners.push(listener)}},{key:"addProgressiveReadListener",value:function addProgressiveReadListener(listener){this._progressiveReadListeners.push(listener)}},{key:"addProgressiveDoneListener",value:function addProgressiveDoneListener(listener){this._progressiveDoneListeners.push(listener)}},{key:"onDataRange",value:function onDataRange(begin,chunk){var _iterator12=_createForOfIteratorHelper(this._rangeListeners),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var listener=_step12.value;listener(begin,chunk)}}catch(err){_iterator12.e(err)}finally{_iterator12.f()}}},{key:"onDataProgress",value:function onDataProgress(loaded,total){var _this44=this;this._readyCapability.promise.then(function(){var _iterator13=_createForOfIteratorHelper(_this44._progressListeners),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var listener=_step13.value;listener(loaded,total)}}catch(err){_iterator13.e(err)}finally{_iterator13.f()}})}},{key:"onDataProgressiveRead",value:function onDataProgressiveRead(chunk){var _this45=this;this._readyCapability.promise.then(function(){var _iterator14=_createForOfIteratorHelper(_this45._progressiveReadListeners),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var listener=_step14.value;listener(chunk)}}catch(err){_iterator14.e(err)}finally{_iterator14.f()}})}},{key:"onDataProgressiveDone",value:function onDataProgressiveDone(){var _this46=this;this._readyCapability.promise.then(function(){var _iterator15=_createForOfIteratorHelper(_this46._progressiveDoneListeners),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var listener=_step15.value;listener()}}catch(err){_iterator15.e(err)}finally{_iterator15.f()}})}},{key:"transportReady",value:function transportReady(){this._readyCapability.resolve()}},{key:"requestDataRange",value:function requestDataRange(begin,end){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}},{key:"abort",value:function abort(){}}]);return PDFDataRangeTransport}();exports.PDFDataRangeTransport=PDFDataRangeTransport;var PDFDocumentProxy=function(){function PDFDocumentProxy(pdfInfo,transport){var _this47=this;_classCallCheck2(this,PDFDocumentProxy);this._pdfInfo=pdfInfo;this._transport=transport;Object.defineProperty(this,"getJavaScript",{value:function value(){(0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, "+"please use `PDFDocumentProxy.getJSActions` instead.");return _this47.getJSActions().then(function(js){if(!js){return js}var jsArr=[];for(var _name4 in js){jsArr.push.apply(jsArr,_toConsumableArray2(js[_name4]))}return jsArr})}})}_createClass2(PDFDocumentProxy,[{key:"annotationStorage",get:function get(){return this._transport.annotationStorage}},{key:"filterFactory",get:function get(){return this._transport.filterFactory}},{key:"numPages",get:function get(){return this._pdfInfo.numPages}},{key:"fingerprints",get:function get(){return this._pdfInfo.fingerprints}},{key:"isPureXfa",get:function get(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"allXfaHtml",get:function get(){return this._transport._htmlForXfa}},{key:"getPage",value:function getPage(pageNumber){return this._transport.getPage(pageNumber)}},{key:"getPageIndex",value:function getPageIndex(ref){return this._transport.getPageIndex(ref)}},{key:"getDestinations",value:function getDestinations(){return this._transport.getDestinations()}},{key:"getDestination",value:function getDestination(id){return this._transport.getDestination(id)}},{key:"getPageLabels",value:function getPageLabels(){return this._transport.getPageLabels()}},{key:"getPageLayout",value:function getPageLayout(){return this._transport.getPageLayout()}},{key:"getPageMode",value:function getPageMode(){return this._transport.getPageMode()}},{key:"getViewerPreferences",value:function getViewerPreferences(){return this._transport.getViewerPreferences()}},{key:"getOpenAction",value:function getOpenAction(){return this._transport.getOpenAction()}},{key:"getAttachments",value:function getAttachments(){return this._transport.getAttachments()}},{key:"getJSActions",value:function getJSActions(){return this._transport.getDocJSActions()}},{key:"getOutline",value:function getOutline(){return this._transport.getOutline()}},{key:"getOptionalContentConfig",value:function getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}},{key:"getPermissions",value:function getPermissions(){return this._transport.getPermissions()}},{key:"getMetadata",value:function getMetadata(){return this._transport.getMetadata()}},{key:"getMarkInfo",value:function getMarkInfo(){return this._transport.getMarkInfo()}},{key:"getData",value:function getData(){return this._transport.getData()}},{key:"saveDocument",value:function saveDocument(){return this._transport.saveDocument()}},{key:"getDownloadInfo",value:function getDownloadInfo(){return this._transport.downloadInfoCapability.promise}},{key:"cleanup",value:function cleanup(){var keepLoadedFonts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return this._transport.startCleanup(keepLoadedFonts||this.isPureXfa)}},{key:"destroy",value:function destroy(){return this.loadingTask.destroy()}},{key:"loadingParams",get:function get(){return this._transport.loadingParams}},{key:"loadingTask",get:function get(){return this._transport.loadingTask}},{key:"getFieldObjects",value:function getFieldObjects(){return this._transport.getFieldObjects()}},{key:"hasJSActions",value:function hasJSActions(){return this._transport.hasJSActions()}},{key:"getCalculationOrderIds",value:function getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}]);return PDFDocumentProxy}();exports.PDFDocumentProxy=PDFDocumentProxy;var _delayedCleanupTimeout=new WeakMap;var _pendingCleanup=new WeakMap;var _tryCleanup=new WeakSet;var _abortDelayedCleanup=new WeakSet;var PDFPageProxy=function(){function PDFPageProxy(pageIndex,pageInfo,transport){var pdfBug=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck2(this,PDFPageProxy);_classPrivateMethodInitSpec(this,_abortDelayedCleanup);_classPrivateMethodInitSpec(this,_tryCleanup);_classPrivateFieldInitSpec(this,_delayedCleanupTimeout,{writable:true,value:null});_classPrivateFieldInitSpec(this,_pendingCleanup,{writable:true,value:false});this._pageIndex=pageIndex;this._pageInfo=pageInfo;this._transport=transport;this._stats=pdfBug?new _display_utils.StatTimer:null;this._pdfBug=pdfBug;this.commonObjs=transport.commonObjs;this.objs=new PDFObjects;this._maybeCleanupAfterRender=false;this._intentStates=new Map;this.destroyed=false}_createClass2(PDFPageProxy,[{key:"pageNumber",get:function get(){return this._pageIndex+1}},{key:"rotate",get:function get(){return this._pageInfo.rotate}},{key:"ref",get:function get(){return this._pageInfo.ref}},{key:"userUnit",get:function get(){return this._pageInfo.userUnit}},{key:"view",get:function get(){return this._pageInfo.view}},{key:"getViewport",value:function getViewport(){var _ref17=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},scale=_ref17.scale,_ref17$rotation=_ref17.rotation,rotation=_ref17$rotation===void 0?this.rotate:_ref17$rotation,_ref17$offsetX=_ref17.offsetX,offsetX=_ref17$offsetX===void 0?0:_ref17$offsetX,_ref17$offsetY=_ref17.offsetY,offsetY=_ref17$offsetY===void 0?0:_ref17$offsetY,_ref17$dontFlip=_ref17.dontFlip,dontFlip=_ref17$dontFlip===void 0?false:_ref17$dontFlip;return new _display_utils.PageViewport({viewBox:this.view,scale:scale,rotation:rotation,offsetX:offsetX,offsetY:offsetY,dontFlip:dontFlip})}},{key:"getAnnotations",value:function getAnnotations(){var _ref18=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref18$intent=_ref18.intent,intent=_ref18$intent===void 0?"display":_ref18$intent;var intentArgs=this._transport.getRenderingIntent(intent);return this._transport.getAnnotations(this._pageIndex,intentArgs.renderingIntent)}},{key:"getJSActions",value:function getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}},{key:"filterFactory",get:function get(){return this._transport.filterFactory}},{key:"isPureXfa",get:function get(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"getXfa",value:function(){var _getXfa=_asyncToGenerator(_regeneratorRuntime().mark(function _callee34(){var _this$_transport$_htm;return _regeneratorRuntime().wrap(function _callee34$(_context35){while(1)switch(_context35.prev=_context35.next){case 0:return _context35.abrupt("return",((_this$_transport$_htm=this._transport._htmlForXfa)===null||_this$_transport$_htm===void 0?void 0:_this$_transport$_htm.children[this._pageIndex])||null);case 1:case"end":return _context35.stop()}},_callee34,this)}));function getXfa(){return _getXfa.apply(this,arguments)}return getXfa}()},{key:"render",value:function render(_ref19){var _this$_stats,_this48=this,_intentState;var canvasContext=_ref19.canvasContext,viewport=_ref19.viewport,_ref19$intent=_ref19.intent,intent=_ref19$intent===void 0?"display":_ref19$intent,_ref19$annotationMode=_ref19.annotationMode,annotationMode=_ref19$annotationMode===void 0?_util.AnnotationMode.ENABLE:_ref19$annotationMode,_ref19$transform=_ref19.transform,transform=_ref19$transform===void 0?null:_ref19$transform,_ref19$background=_ref19.background,background=_ref19$background===void 0?null:_ref19$background,_ref19$optionalConten=_ref19.optionalContentConfigPromise,optionalContentConfigPromise=_ref19$optionalConten===void 0?null:_ref19$optionalConten,_ref19$annotationCanv=_ref19.annotationCanvasMap,annotationCanvasMap=_ref19$annotationCanv===void 0?null:_ref19$annotationCanv,_ref19$pageColors=_ref19.pageColors,pageColors=_ref19$pageColors===void 0?null:_ref19$pageColors,_ref19$printAnnotatio=_ref19.printAnnotationStorage,printAnnotationStorage=_ref19$printAnnotatio===void 0?null:_ref19$printAnnotatio;(_this$_stats=this._stats)===null||_this$_stats===void 0||_this$_stats.time("Overall");var intentArgs=this._transport.getRenderingIntent(intent,annotationMode,printAnnotationStorage);_classPrivateFieldSet(this,_pendingCleanup,false);_classPrivateMethodGet(this,_abortDelayedCleanup,_abortDelayedCleanup2).call(this);if(!optionalContentConfigPromise){optionalContentConfigPromise=this._transport.getOptionalContentConfig()}var intentState=this._intentStates.get(intentArgs.cacheKey);if(!intentState){intentState=Object.create(null);this._intentStates.set(intentArgs.cacheKey,intentState)}if(intentState.streamReaderCancelTimeout){clearTimeout(intentState.streamReaderCancelTimeout);intentState.streamReaderCancelTimeout=null}var intentPrint=!!(intentArgs.renderingIntent&_util.RenderingIntentFlag.PRINT);if(!intentState.displayReadyCapability){var _this$_stats2;intentState.displayReadyCapability=new _util.PromiseCapability;intentState.operatorList={fnArray:[],argsArray:[],lastChunk:false,separateAnnots:null};(_this$_stats2=this._stats)===null||_this$_stats2===void 0||_this$_stats2.time("Page Request");this._pumpOperatorList(intentArgs)}var complete=function complete(error){var _this48$_stats,_this48$_stats2;intentState.renderTasks["delete"](internalRenderTask);if(_this48._maybeCleanupAfterRender||intentPrint){_classPrivateFieldSet(_this48,_pendingCleanup,true)}_classPrivateMethodGet(_this48,_tryCleanup,_tryCleanup2).call(_this48,!intentPrint);if(error){internalRenderTask.capability.reject(error);_this48._abortOperatorList({intentState:intentState,reason:error instanceof Error?error:new Error(error)})}else{internalRenderTask.capability.resolve()}(_this48$_stats=_this48._stats)===null||_this48$_stats===void 0||_this48$_stats.timeEnd("Rendering");(_this48$_stats2=_this48._stats)===null||_this48$_stats2===void 0||_this48$_stats2.timeEnd("Overall")};var internalRenderTask=new InternalRenderTask({callback:complete,params:{canvasContext:canvasContext,viewport:viewport,transform:transform,background:background},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:annotationCanvasMap,operatorList:intentState.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!intentPrint,pdfBug:this._pdfBug,pageColors:pageColors});((_intentState=intentState).renderTasks||(_intentState.renderTasks=new Set)).add(internalRenderTask);var renderTask=internalRenderTask.task;Promise.all([intentState.displayReadyCapability.promise,optionalContentConfigPromise]).then(function(_ref20){var _this48$_stats3;var _ref21=_slicedToArray2(_ref20,2),transparency=_ref21[0],optionalContentConfig=_ref21[1];if(_this48.destroyed){complete();return}(_this48$_stats3=_this48._stats)===null||_this48$_stats3===void 0||_this48$_stats3.time("Rendering");internalRenderTask.initializeGraphics({transparency:transparency,optionalContentConfig:optionalContentConfig});internalRenderTask.operatorListChanged()})["catch"](complete);return renderTask}},{key:"getOperatorList",value:function getOperatorList(){var _ref22=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref22$intent=_ref22.intent,intent=_ref22$intent===void 0?"display":_ref22$intent,_ref22$annotationMode=_ref22.annotationMode,annotationMode=_ref22$annotationMode===void 0?_util.AnnotationMode.ENABLE:_ref22$annotationMode,_ref22$printAnnotatio=_ref22.printAnnotationStorage,printAnnotationStorage=_ref22$printAnnotatio===void 0?null:_ref22$printAnnotatio;function operatorListChanged(){if(intentState.operatorList.lastChunk){intentState.opListReadCapability.resolve(intentState.operatorList);intentState.renderTasks["delete"](opListTask)}}var intentArgs=this._transport.getRenderingIntent(intent,annotationMode,printAnnotationStorage,true);var intentState=this._intentStates.get(intentArgs.cacheKey);if(!intentState){intentState=Object.create(null);this._intentStates.set(intentArgs.cacheKey,intentState)}var opListTask;if(!intentState.opListReadCapability){var _intentState2,_this$_stats3;opListTask=Object.create(null);opListTask.operatorListChanged=operatorListChanged;intentState.opListReadCapability=new _util.PromiseCapability;((_intentState2=intentState).renderTasks||(_intentState2.renderTasks=new Set)).add(opListTask);intentState.operatorList={fnArray:[],argsArray:[],lastChunk:false,separateAnnots:null};(_this$_stats3=this._stats)===null||_this$_stats3===void 0||_this$_stats3.time("Page Request");this._pumpOperatorList(intentArgs)}return intentState.opListReadCapability.promise}},{key:"streamTextContent",value:function streamTextContent(){var _ref23=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref23$includeMarkedC=_ref23.includeMarkedContent,includeMarkedContent=_ref23$includeMarkedC===void 0?false:_ref23$includeMarkedC,_ref23$disableNormali=_ref23.disableNormalization,disableNormalization=_ref23$disableNormali===void 0?false:_ref23$disableNormali;var TEXT_CONTENT_CHUNK_SIZE=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:includeMarkedContent===true,disableNormalization:disableNormalization===true},{highWaterMark:TEXT_CONTENT_CHUNK_SIZE,size:function size(textContent){return textContent.items.length}})}},{key:"getTextContent",value:function getTextContent(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this._transport._htmlForXfa){return this.getXfa().then(function(xfa){return _xfa_text.XfaText.textContent(xfa)})}var readableStream=this.streamTextContent(params);return new Promise(function(resolve,reject){function pump(){reader.read().then(function(_ref24){var _textContent$items;var value=_ref24.value,done=_ref24.done;if(done){resolve(textContent);return}Object.assign(textContent.styles,value.styles);(_textContent$items=textContent.items).push.apply(_textContent$items,_toConsumableArray2(value.items));pump()},reject)}var reader=readableStream.getReader();var textContent={items:[],styles:Object.create(null)};pump()})}},{key:"getStructTree",value:function getStructTree(){return this._transport.getStructTree(this._pageIndex)}},{key:"_destroy",value:function _destroy(){this.destroyed=true;var waitOn=[];var _iterator16=_createForOfIteratorHelper(this._intentStates.values()),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var intentState=_step16.value;this._abortOperatorList({intentState:intentState,reason:new Error("Page was destroyed."),force:true});if(intentState.opListReadCapability){continue}var _iterator17=_createForOfIteratorHelper(intentState.renderTasks),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var internalRenderTask=_step17.value;waitOn.push(internalRenderTask.completed);internalRenderTask.cancel()}}catch(err){_iterator17.e(err)}finally{_iterator17.f()}}}catch(err){_iterator16.e(err)}finally{_iterator16.f()}this.objs.clear();_classPrivateFieldSet(this,_pendingCleanup,false);_classPrivateMethodGet(this,_abortDelayedCleanup,_abortDelayedCleanup2).call(this);return Promise.all(waitOn)}},{key:"cleanup",value:function cleanup(){var resetStats=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classPrivateFieldSet(this,_pendingCleanup,true);var success=_classPrivateMethodGet(this,_tryCleanup,_tryCleanup2).call(this,false);if(resetStats&&success){this._stats&&(this._stats=new _display_utils.StatTimer)}return success}},{key:"_startRenderPage",value:function _startRenderPage(transparency,cacheKey){var _this$_stats4,_intentState$displayR;var intentState=this._intentStates.get(cacheKey);if(!intentState){return}(_this$_stats4=this._stats)===null||_this$_stats4===void 0||_this$_stats4.timeEnd("Page Request");(_intentState$displayR=intentState.displayReadyCapability)===null||_intentState$displayR===void 0||_intentState$displayR.resolve(transparency)}},{key:"_renderPageChunk",value:function _renderPageChunk(operatorListChunk,intentState){for(var _i10=0,ii=operatorListChunk.length;_i10<ii;_i10++){intentState.operatorList.fnArray.push(operatorListChunk.fnArray[_i10]);intentState.operatorList.argsArray.push(operatorListChunk.argsArray[_i10])}intentState.operatorList.lastChunk=operatorListChunk.lastChunk;intentState.operatorList.separateAnnots=operatorListChunk.separateAnnots;var _iterator18=_createForOfIteratorHelper(intentState.renderTasks),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var internalRenderTask=_step18.value;internalRenderTask.operatorListChanged()}}catch(err){_iterator18.e(err)}finally{_iterator18.f()}if(operatorListChunk.lastChunk){_classPrivateMethodGet(this,_tryCleanup,_tryCleanup2).call(this,true)}}},{key:"_pumpOperatorList",value:function _pumpOperatorList(_ref25){var _this49=this;var renderingIntent=_ref25.renderingIntent,cacheKey=_ref25.cacheKey,annotationStorageSerializable=_ref25.annotationStorageSerializable;var map=annotationStorageSerializable.map,transfers=annotationStorageSerializable.transfers;var readableStream=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:renderingIntent,cacheKey:cacheKey,annotationStorage:map},transfers);var reader=readableStream.getReader();var intentState=this._intentStates.get(cacheKey);intentState.streamReader=reader;var pump=function pump(){reader.read().then(function(_ref26){var value=_ref26.value,done=_ref26.done;if(done){intentState.streamReader=null;return}if(_this49._transport.destroyed){return}_this49._renderPageChunk(value,intentState);pump()},function(reason){intentState.streamReader=null;if(_this49._transport.destroyed){return}if(intentState.operatorList){intentState.operatorList.lastChunk=true;var _iterator19=_createForOfIteratorHelper(intentState.renderTasks),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var internalRenderTask=_step19.value;internalRenderTask.operatorListChanged()}}catch(err){_iterator19.e(err)}finally{_iterator19.f()}_classPrivateMethodGet(_this49,_tryCleanup,_tryCleanup2).call(_this49,true)}if(intentState.displayReadyCapability){intentState.displayReadyCapability.reject(reason)}else if(intentState.opListReadCapability){intentState.opListReadCapability.reject(reason)}else{throw reason}})};pump()}},{key:"_abortOperatorList",value:function _abortOperatorList(_ref27){var _this50=this;var intentState=_ref27.intentState,reason=_ref27.reason,_ref27$force=_ref27.force,force=_ref27$force===void 0?false:_ref27$force;if(!intentState.streamReader){return}if(intentState.streamReaderCancelTimeout){clearTimeout(intentState.streamReaderCancelTimeout);intentState.streamReaderCancelTimeout=null}if(!force){if(intentState.renderTasks.size>0){return}if(reason instanceof _display_utils.RenderingCancelledException){var delay=RENDERING_CANCELLED_TIMEOUT;if(reason.extraDelay>0&&reason.extraDelay<1000){delay+=reason.extraDelay}intentState.streamReaderCancelTimeout=setTimeout(function(){intentState.streamReaderCancelTimeout=null;_this50._abortOperatorList({intentState:intentState,reason:reason,force:true})},delay);return}}intentState.streamReader.cancel(new _util.AbortException(reason.message))["catch"](function(){});intentState.streamReader=null;if(this._transport.destroyed){return}var _iterator20=_createForOfIteratorHelper(this._intentStates),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var _step20$value=_slicedToArray2(_step20.value,2),curCacheKey=_step20$value[0],curIntentState=_step20$value[1];if(curIntentState===intentState){this._intentStates["delete"](curCacheKey);break}}}catch(err){_iterator20.e(err)}finally{_iterator20.f()}this.cleanup()}},{key:"stats",get:function get(){return this._stats}}]);return PDFPageProxy}();function _tryCleanup2(){var _this61=this;var delayed=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classPrivateMethodGet(this,_abortDelayedCleanup,_abortDelayedCleanup2).call(this);if(!_classPrivateFieldGet(this,_pendingCleanup)||this.destroyed){return false}if(delayed){_classPrivateFieldSet(this,_delayedCleanupTimeout,setTimeout(function(){_classPrivateFieldSet(_this61,_delayedCleanupTimeout,null);_classPrivateMethodGet(_this61,_tryCleanup,_tryCleanup2).call(_this61,false)},DELAYED_CLEANUP_TIMEOUT));return false}var _iterator24=_createForOfIteratorHelper(this._intentStates.values()),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var _step24$value=_step24.value,renderTasks=_step24$value.renderTasks,operatorList=_step24$value.operatorList;if(renderTasks.size>0||!operatorList.lastChunk){return false}}}catch(err){_iterator24.e(err)}finally{_iterator24.f()}this._intentStates.clear();this.objs.clear();_classPrivateFieldSet(this,_pendingCleanup,false);return true}function _abortDelayedCleanup2(){if(_classPrivateFieldGet(this,_delayedCleanupTimeout)){clearTimeout(_classPrivateFieldGet(this,_delayedCleanupTimeout));_classPrivateFieldSet(this,_delayedCleanupTimeout,null)}}exports.PDFPageProxy=PDFPageProxy;var _listeners=new WeakMap;var _deferred=new WeakMap;var LoopbackPort=function(){function LoopbackPort(){_classCallCheck2(this,LoopbackPort);_classPrivateFieldInitSpec(this,_listeners,{writable:true,value:new Set});_classPrivateFieldInitSpec(this,_deferred,{writable:true,value:Promise.resolve()})}_createClass2(LoopbackPort,[{key:"postMessage",value:function postMessage(obj,transfer){var _this51=this;var event={data:structuredClone(obj,transfer?{transfer:transfer}:null)};_classPrivateFieldGet(this,_deferred).then(function(){var _iterator21=_createForOfIteratorHelper(_classPrivateFieldGet(_this51,_listeners)),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var listener=_step21.value;listener.call(_this51,event)}}catch(err){_iterator21.e(err)}finally{_iterator21.f()}})}},{key:"addEventListener",value:function addEventListener(name,listener){_classPrivateFieldGet(this,_listeners).add(listener)}},{key:"removeEventListener",value:function removeEventListener(name,listener){_classPrivateFieldGet(this,_listeners)["delete"](listener)}},{key:"terminate",value:function terminate(){_classPrivateFieldGet(this,_listeners).clear()}}]);return LoopbackPort}();exports.LoopbackPort=LoopbackPort;var PDFWorkerUtil={isWorkerDisabled:false,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire==="function"){PDFWorkerUtil.isWorkerDisabled=true;PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js"}else if((typeof document==="undefined"?"undefined":_typeof2(document))==="object"){var _document;var pdfjsFilePath=(_document=document)===null||_document===void 0||(_document=_document.currentScript)===null||_document===void 0?void 0:_document.src;if(pdfjsFilePath){PDFWorkerUtil.fallbackWorkerSrc=pdfjsFilePath.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2")}}PDFWorkerUtil.isSameOrigin=function(baseUrl,otherUrl){var base;try{base=new URL(baseUrl);if(!base.origin||base.origin==="null"){return false}}catch(_unused7){return false}var other=new URL(otherUrl,base);return base.origin===other.origin};PDFWorkerUtil.createCDNWrapper=function(url){var wrapper="importScripts(\"".concat(url,"\");");return URL.createObjectURL(new Blob([wrapper]))}}var PDFWorker=function(){function PDFWorker(){var _ref28=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref28$name=_ref28.name,name=_ref28$name===void 0?null:_ref28$name,_ref28$port=_ref28.port,port=_ref28$port===void 0?null:_ref28$port,_ref28$verbosity=_ref28.verbosity,verbosity=_ref28$verbosity===void 0?(0,_util.getVerbosityLevel)():_ref28$verbosity;_classCallCheck2(this,PDFWorker);this.name=name;this.destroyed=false;this.verbosity=verbosity;this._readyCapability=new _util.PromiseCapability;this._port=null;this._webWorker=null;this._messageHandler=null;if(port){var _classStaticPrivateFi;if((_classStaticPrivateFi=_classStaticPrivateFieldSpecGet(PDFWorker,PDFWorker,_workerPorts))!==null&&_classStaticPrivateFi!==void 0&&_classStaticPrivateFi.has(port)){throw new Error("Cannot use more than one PDFWorker per port.")}(_classStaticPrivateFieldSpecGet(PDFWorker,PDFWorker,_workerPorts)||_classStaticPrivateFieldSpecSet(PDFWorker,PDFWorker,_workerPorts,new WeakMap)).set(port,this);this._initializeFromPort(port);return}this._initialize()}_createClass2(PDFWorker,[{key:"promise",get:function get(){return this._readyCapability.promise}},{key:"port",get:function get(){return this._port}},{key:"messageHandler",get:function get(){return this._messageHandler}},{key:"_initializeFromPort",value:function _initializeFromPort(port){this._port=port;this._messageHandler=new _message_handler.MessageHandler("main","worker",port);this._messageHandler.on("ready",function(){});this._readyCapability.resolve();this._messageHandler.send("configure",{verbosity:this.verbosity})}},{key:"_initialize",value:function _initialize(){var _this52=this;if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){var workerSrc=PDFWorker.workerSrc;try{if(!PDFWorkerUtil.isSameOrigin(window.location.href,workerSrc)){workerSrc=PDFWorkerUtil.createCDNWrapper(new URL(workerSrc,window.location).href)}var worker=new Worker(workerSrc);var messageHandler=new _message_handler.MessageHandler("main","worker",worker);var terminateEarly=function terminateEarly(){worker.removeEventListener("error",onWorkerError);messageHandler.destroy();worker.terminate();if(_this52.destroyed){_this52._readyCapability.reject(new Error("Worker was destroyed"))}else{_this52._setupFakeWorker()}};var onWorkerError=function onWorkerError(){if(!_this52._webWorker){terminateEarly()}};worker.addEventListener("error",onWorkerError);messageHandler.on("test",function(data){worker.removeEventListener("error",onWorkerError);if(_this52.destroyed){terminateEarly();return}if(data){_this52._messageHandler=messageHandler;_this52._port=worker;_this52._webWorker=worker;_this52._readyCapability.resolve();messageHandler.send("configure",{verbosity:_this52.verbosity})}else{_this52._setupFakeWorker();messageHandler.destroy();worker.terminate()}});messageHandler.on("ready",function(data){worker.removeEventListener("error",onWorkerError);if(_this52.destroyed){terminateEarly();return}try{sendTest()}catch(_unused8){_this52._setupFakeWorker()}});var sendTest=function sendTest(){var testObj=new Uint8Array;messageHandler.send("test",testObj,[testObj.buffer])};sendTest();return}catch(_unused9){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}},{key:"_setupFakeWorker",value:function _setupFakeWorker(){var _this53=this;if(!PDFWorkerUtil.isWorkerDisabled){(0,_util.warn)("Setting up fake worker.");PDFWorkerUtil.isWorkerDisabled=true}PDFWorker._setupFakeWorkerGlobal.then(function(WorkerMessageHandler){if(_this53.destroyed){_this53._readyCapability.reject(new Error("Worker was destroyed"));return}var port=new LoopbackPort;_this53._port=port;var id="fake".concat(PDFWorkerUtil.fakeWorkerId++);var workerHandler=new _message_handler.MessageHandler(id+"_worker",id,port);WorkerMessageHandler.setup(workerHandler,port);var messageHandler=new _message_handler.MessageHandler(id,id+"_worker",port);_this53._messageHandler=messageHandler;_this53._readyCapability.resolve();messageHandler.send("configure",{verbosity:_this53.verbosity})})["catch"](function(reason){_this53._readyCapability.reject(new Error("Setting up fake worker failed: \"".concat(reason.message,"\".")))})}},{key:"destroy",value:function destroy(){var _classStaticPrivateFi2;this.destroyed=true;if(this._webWorker){this._webWorker.terminate();this._webWorker=null}(_classStaticPrivateFi2=_classStaticPrivateFieldSpecGet(PDFWorker,PDFWorker,_workerPorts))===null||_classStaticPrivateFi2===void 0||_classStaticPrivateFi2["delete"](this._port);this._port=null;if(this._messageHandler){this._messageHandler.destroy();this._messageHandler=null}}}],[{key:"fromPort",value:function fromPort(params){var _classStaticPrivateFi3;if(!(params!==null&&params!==void 0&&params.port)){throw new Error("PDFWorker.fromPort - invalid method signature.")}var cachedPort=(_classStaticPrivateFi3=_classStaticPrivateFieldSpecGet(this,PDFWorker,_workerPorts))===null||_classStaticPrivateFi3===void 0?void 0:_classStaticPrivateFi3.get(params.port);if(cachedPort){if(cachedPort._pendingDestroy){throw new Error("PDFWorker.fromPort - the worker is being destroyed.\n"+"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.")}return cachedPort}return new PDFWorker(params)}},{key:"workerSrc",get:function get(){if(_worker_options.GlobalWorkerOptions.workerSrc){return _worker_options.GlobalWorkerOptions.workerSrc}if(PDFWorkerUtil.fallbackWorkerSrc!==null){if(!_util.isNodeJS){(0,_display_utils.deprecated)("No \"GlobalWorkerOptions.workerSrc\" specified.")}return PDFWorkerUtil.fallbackWorkerSrc}throw new Error("No \"GlobalWorkerOptions.workerSrc\" specified.")}},{key:"_mainThreadWorkerMessageHandler",get:function get(){try{var _globalThis$pdfjsWork;return((_globalThis$pdfjsWork=globalThis.pdfjsWorker)===null||_globalThis$pdfjsWork===void 0?void 0:_globalThis$pdfjsWork.WorkerMessageHandler)||null}catch(_unused10){return null}}},{key:"_setupFakeWorkerGlobal",get:function get(){var _this54=this;var loader=function(){var _ref29=_asyncToGenerator(_regeneratorRuntime().mark(function _callee35(){var mainWorkerMessageHandler,worker;return _regeneratorRuntime().wrap(function _callee35$(_context36){while(1)switch(_context36.prev=_context36.next){case 0:mainWorkerMessageHandler=_this54._mainThreadWorkerMessageHandler;if(!mainWorkerMessageHandler){_context36.next=3;break}return _context36.abrupt("return",mainWorkerMessageHandler);case 3:if(!(_util.isNodeJS&&typeof commonjsRequire==="function")){_context36.next=6;break}worker=eval("require")(_this54.workerSrc);return _context36.abrupt("return",worker.WorkerMessageHandler);case 6:_context36.next=8;return(0,_display_utils.loadScript)(_this54.workerSrc);case 8:return _context36.abrupt("return",window.pdfjsWorker.WorkerMessageHandler);case 9:case"end":return _context36.stop()}},_callee35)}));return function loader(){return _ref29.apply(this,arguments)}}();return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}]);return PDFWorker}();var _workerPorts={writable:true,value:void 0};exports.PDFWorker=PDFWorker;var _methodPromises=new WeakMap;var _pageCache=new WeakMap;var _pagePromises=new WeakMap;var _passwordCapability=new WeakMap;var _cacheSimpleMethod=new WeakSet;var WorkerTransport=function(){function WorkerTransport(messageHandler,loadingTask,networkStream,params,factory){_classCallCheck2(this,WorkerTransport);_classPrivateMethodInitSpec(this,_cacheSimpleMethod);_classPrivateFieldInitSpec(this,_methodPromises,{writable:true,value:new Map});_classPrivateFieldInitSpec(this,_pageCache,{writable:true,value:new Map});_classPrivateFieldInitSpec(this,_pagePromises,{writable:true,value:new Map});_classPrivateFieldInitSpec(this,_passwordCapability,{writable:true,value:null});this.messageHandler=messageHandler;this.loadingTask=loadingTask;this.commonObjs=new PDFObjects;this.fontLoader=new _font_loader.FontLoader({ownerDocument:params.ownerDocument,styleElement:params.styleElement});this._params=params;this.canvasFactory=factory.canvasFactory;this.filterFactory=factory.filterFactory;this.cMapReaderFactory=factory.cMapReaderFactory;this.standardFontDataFactory=factory.standardFontDataFactory;this.destroyed=false;this.destroyCapability=null;this._networkStream=networkStream;this._fullReader=null;this._lastProgress=null;this.downloadInfoCapability=new _util.PromiseCapability;this.setupMessageHandler()}_createClass2(WorkerTransport,[{key:"annotationStorage",get:function get(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}},{key:"getRenderingIntent",value:function getRenderingIntent(intent){var annotationMode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_util.AnnotationMode.ENABLE;var printAnnotationStorage=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var isOpList=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var renderingIntent=_util.RenderingIntentFlag.DISPLAY;var annotationStorageSerializable=_annotation_storage.SerializableEmpty;switch(intent){case"any":renderingIntent=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":renderingIntent=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)("getRenderingIntent - invalid intent: ".concat(intent))}switch(annotationMode){case _util.AnnotationMode.DISABLE:renderingIntent+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:renderingIntent+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:renderingIntent+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE;var annotationStorage=renderingIntent&_util.RenderingIntentFlag.PRINT&&printAnnotationStorage instanceof _annotation_storage.PrintAnnotationStorage?printAnnotationStorage:this.annotationStorage;annotationStorageSerializable=annotationStorage.serializable;break;default:(0,_util.warn)("getRenderingIntent - invalid annotationMode: ".concat(annotationMode))}if(isOpList){renderingIntent+=_util.RenderingIntentFlag.OPLIST}return{renderingIntent:renderingIntent,cacheKey:"".concat(renderingIntent,"_").concat(annotationStorageSerializable.hash),annotationStorageSerializable:annotationStorageSerializable}}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet2,_this55=this;if(this.destroyCapability){return this.destroyCapability.promise}this.destroyed=true;this.destroyCapability=new _util.PromiseCapability;(_classPrivateFieldGet2=_classPrivateFieldGet(this,_passwordCapability))===null||_classPrivateFieldGet2===void 0||_classPrivateFieldGet2.reject(new Error("Worker was destroyed during onPassword callback"));var waitOn=[];var _iterator22=_createForOfIteratorHelper(_classPrivateFieldGet(this,_pageCache).values()),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var page=_step22.value;waitOn.push(page._destroy())}}catch(err){_iterator22.e(err)}finally{_iterator22.f()}_classPrivateFieldGet(this,_pageCache).clear();_classPrivateFieldGet(this,_pagePromises).clear();if(this.hasOwnProperty("annotationStorage")){this.annotationStorage.resetModified()}var terminated=this.messageHandler.sendWithPromise("Terminate",null);waitOn.push(terminated);Promise.all(waitOn).then(function(){var _this55$_networkStrea;_this55.commonObjs.clear();_this55.fontLoader.clear();_classPrivateFieldGet(_this55,_methodPromises).clear();_this55.filterFactory.destroy();(_this55$_networkStrea=_this55._networkStream)===null||_this55$_networkStrea===void 0||_this55$_networkStrea.cancelAllRequests(new _util.AbortException("Worker was terminated."));if(_this55.messageHandler){_this55.messageHandler.destroy();_this55.messageHandler=null}_this55.destroyCapability.resolve()},this.destroyCapability.reject);return this.destroyCapability.promise}},{key:"setupMessageHandler",value:function setupMessageHandler(){var _this56=this;var messageHandler=this.messageHandler,loadingTask=this.loadingTask;messageHandler.on("GetReader",function(data,sink){(0,_util.assert)(_this56._networkStream,"GetReader - no `IPDFStream` instance available.");_this56._fullReader=_this56._networkStream.getFullReader();_this56._fullReader.onProgress=function(evt){_this56._lastProgress={loaded:evt.loaded,total:evt.total}};sink.onPull=function(){_this56._fullReader.read().then(function(_ref30){var value=_ref30.value,done=_ref30.done;if(done){sink.close();return}(0,_util.assert)(value instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer.");sink.enqueue(new Uint8Array(value),1,[value])})["catch"](function(reason){sink.error(reason)})};sink.onCancel=function(reason){_this56._fullReader.cancel(reason);sink.ready["catch"](function(readyReason){if(_this56.destroyed){return}throw readyReason})}});messageHandler.on("ReaderHeadersReady",function(data){var headersCapability=new _util.PromiseCapability;var fullReader=_this56._fullReader;fullReader.headersReady.then(function(){if(!fullReader.isStreamingSupported||!fullReader.isRangeSupported){if(_this56._lastProgress){var _loadingTask$onProgre;(_loadingTask$onProgre=loadingTask.onProgress)===null||_loadingTask$onProgre===void 0||_loadingTask$onProgre.call(loadingTask,_this56._lastProgress)}fullReader.onProgress=function(evt){var _loadingTask$onProgre2;(_loadingTask$onProgre2=loadingTask.onProgress)===null||_loadingTask$onProgre2===void 0||_loadingTask$onProgre2.call(loadingTask,{loaded:evt.loaded,total:evt.total})}}headersCapability.resolve({isStreamingSupported:fullReader.isStreamingSupported,isRangeSupported:fullReader.isRangeSupported,contentLength:fullReader.contentLength})},headersCapability.reject);return headersCapability.promise});messageHandler.on("GetRangeReader",function(data,sink){(0,_util.assert)(_this56._networkStream,"GetRangeReader - no `IPDFStream` instance available.");var rangeReader=_this56._networkStream.getRangeReader(data.begin,data.end);if(!rangeReader){sink.close();return}sink.onPull=function(){rangeReader.read().then(function(_ref31){var value=_ref31.value,done=_ref31.done;if(done){sink.close();return}(0,_util.assert)(value instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer.");sink.enqueue(new Uint8Array(value),1,[value])})["catch"](function(reason){sink.error(reason)})};sink.onCancel=function(reason){rangeReader.cancel(reason);sink.ready["catch"](function(readyReason){if(_this56.destroyed){return}throw readyReason})}});messageHandler.on("GetDoc",function(_ref32){var pdfInfo=_ref32.pdfInfo;_this56._numPages=pdfInfo.numPages;_this56._htmlForXfa=pdfInfo.htmlForXfa;delete pdfInfo.htmlForXfa;loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo,_this56))});messageHandler.on("DocException",function(ex){var reason;switch(ex.name){case"PasswordException":reason=new _util.PasswordException(ex.message,ex.code);break;case"InvalidPDFException":reason=new _util.InvalidPDFException(ex.message);break;case"MissingPDFException":reason=new _util.MissingPDFException(ex.message);break;case"UnexpectedResponseException":reason=new _util.UnexpectedResponseException(ex.message,ex.status);break;case"UnknownErrorException":reason=new _util.UnknownErrorException(ex.message,ex.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}loadingTask._capability.reject(reason)});messageHandler.on("PasswordRequest",function(exception){_classPrivateFieldSet(_this56,_passwordCapability,new _util.PromiseCapability);if(loadingTask.onPassword){var updatePassword=function updatePassword(password){if(password instanceof Error){_classPrivateFieldGet(_this56,_passwordCapability).reject(password)}else{_classPrivateFieldGet(_this56,_passwordCapability).resolve({password:password})}};try{loadingTask.onPassword(updatePassword,exception.code)}catch(ex){_classPrivateFieldGet(_this56,_passwordCapability).reject(ex)}}else{_classPrivateFieldGet(_this56,_passwordCapability).reject(new _util.PasswordException(exception.message,exception.code))}return _classPrivateFieldGet(_this56,_passwordCapability).promise});messageHandler.on("DataLoaded",function(data){var _loadingTask$onProgre3;(_loadingTask$onProgre3=loadingTask.onProgress)===null||_loadingTask$onProgre3===void 0||_loadingTask$onProgre3.call(loadingTask,{loaded:data.length,total:data.length});_this56.downloadInfoCapability.resolve(data)});messageHandler.on("StartRenderPage",function(data){if(_this56.destroyed){return}var page=_classPrivateFieldGet(_this56,_pageCache).get(data.pageIndex);page._startRenderPage(data.transparency,data.cacheKey)});messageHandler.on("commonobj",function(_ref33){var _globalThis$FontInspe;var _ref34=_slicedToArray2(_ref33,3),id=_ref34[0],type=_ref34[1],exportedData=_ref34[2];if(_this56.destroyed){return}if(_this56.commonObjs.has(id)){return}switch(type){case"Font":var params=_this56._params;if("error"in exportedData){var exportedError=exportedData.error;(0,_util.warn)("Error during font loading: ".concat(exportedError));_this56.commonObjs.resolve(id,exportedError);break}var inspectFont=params.pdfBug&&(_globalThis$FontInspe=globalThis.FontInspector)!==null&&_globalThis$FontInspe!==void 0&&_globalThis$FontInspe.enabled?function(font,url){return globalThis.FontInspector.fontAdded(font,url)}:null;var font=new _font_loader.FontFaceObject(exportedData,{isEvalSupported:params.isEvalSupported,disableFontFace:params.disableFontFace,ignoreErrors:params.ignoreErrors,inspectFont:inspectFont});_this56.fontLoader.bind(font)["catch"](function(reason){return messageHandler.sendWithPromise("FontFallback",{id:id})})["finally"](function(){if(!params.fontExtraProperties&&font.data){font.data=null}_this56.commonObjs.resolve(id,font)});break;case"FontPath":case"Image":case"Pattern":_this56.commonObjs.resolve(id,exportedData);break;default:throw new Error("Got unknown common object type ".concat(type))}});messageHandler.on("obj",function(_ref35){var _ref36=_slicedToArray2(_ref35,4),id=_ref36[0],pageIndex=_ref36[1],type=_ref36[2],imageData=_ref36[3];if(_this56.destroyed){return}var pageProxy=_classPrivateFieldGet(_this56,_pageCache).get(pageIndex);if(pageProxy.objs.has(id)){return}switch(type){case"Image":pageProxy.objs.resolve(id,imageData);if(imageData){var length;if(imageData.bitmap){var width=imageData.width,height=imageData.height;length=width*height*4}else{var _imageData$data;length=((_imageData$data=imageData.data)===null||_imageData$data===void 0?void 0:_imageData$data.length)||0}if(length>_util.MAX_IMAGE_SIZE_TO_CACHE){pageProxy._maybeCleanupAfterRender=true}}break;case"Pattern":pageProxy.objs.resolve(id,imageData);break;default:throw new Error("Got unknown object type ".concat(type))}});messageHandler.on("DocProgress",function(data){var _loadingTask$onProgre4;if(_this56.destroyed){return}(_loadingTask$onProgre4=loadingTask.onProgress)===null||_loadingTask$onProgre4===void 0||_loadingTask$onProgre4.call(loadingTask,{loaded:data.loaded,total:data.total})});messageHandler.on("FetchBuiltInCMap",function(data){if(_this56.destroyed){return Promise.reject(new Error("Worker was destroyed."))}if(!_this56.cMapReaderFactory){return Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))}return _this56.cMapReaderFactory.fetch(data)});messageHandler.on("FetchStandardFontData",function(data){if(_this56.destroyed){return Promise.reject(new Error("Worker was destroyed."))}if(!_this56.standardFontDataFactory){return Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))}return _this56.standardFontDataFactory.fetch(data)})}},{key:"getData",value:function getData(){return this.messageHandler.sendWithPromise("GetData",null)}},{key:"saveDocument",value:function saveDocument(){var _this$_fullReader$fil,_this$_fullReader,_this57=this;if(this.annotationStorage.size<=0){(0,_util.warn)("saveDocument called while `annotationStorage` is empty, "+"please use the getData-method instead.")}var _this$annotationStora=this.annotationStorage.serializable,map=_this$annotationStora.map,transfers=_this$annotationStora.transfers;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:map,filename:(_this$_fullReader$fil=(_this$_fullReader=this._fullReader)===null||_this$_fullReader===void 0?void 0:_this$_fullReader.filename)!==null&&_this$_fullReader$fil!==void 0?_this$_fullReader$fil:null},transfers)["finally"](function(){_this57.annotationStorage.resetModified()})}},{key:"getPage",value:function getPage(pageNumber){var _this58=this;if(!Number.isInteger(pageNumber)||pageNumber<=0||pageNumber>this._numPages){return Promise.reject(new Error("Invalid page request."))}var pageIndex=pageNumber-1,cachedPromise=_classPrivateFieldGet(this,_pagePromises).get(pageIndex);if(cachedPromise){return cachedPromise}var promise=this.messageHandler.sendWithPromise("GetPage",{pageIndex:pageIndex}).then(function(pageInfo){if(_this58.destroyed){throw new Error("Transport destroyed")}var page=new PDFPageProxy(pageIndex,pageInfo,_this58,_this58._params.pdfBug);_classPrivateFieldGet(_this58,_pageCache).set(pageIndex,page);return page});_classPrivateFieldGet(this,_pagePromises).set(pageIndex,promise);return promise}},{key:"getPageIndex",value:function getPageIndex(ref){if(_typeof2(ref)!=="object"||ref===null||!Number.isInteger(ref.num)||ref.num<0||!Number.isInteger(ref.gen)||ref.gen<0){return Promise.reject(new Error("Invalid pageIndex request."))}return this.messageHandler.sendWithPromise("GetPageIndex",{num:ref.num,gen:ref.gen})}},{key:"getAnnotations",value:function getAnnotations(pageIndex,intent){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:pageIndex,intent:intent})}},{key:"getFieldObjects",value:function getFieldObjects(){return _classPrivateMethodGet(this,_cacheSimpleMethod,_cacheSimpleMethod2).call(this,"GetFieldObjects")}},{key:"hasJSActions",value:function hasJSActions(){return _classPrivateMethodGet(this,_cacheSimpleMethod,_cacheSimpleMethod2).call(this,"HasJSActions")}},{key:"getCalculationOrderIds",value:function getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}},{key:"getDestinations",value:function getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}},{key:"getDestination",value:function getDestination(id){if(typeof id!=="string"){return Promise.reject(new Error("Invalid destination request."))}return this.messageHandler.sendWithPromise("GetDestination",{id:id})}},{key:"getPageLabels",value:function getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}},{key:"getPageLayout",value:function getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}},{key:"getPageMode",value:function getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}},{key:"getViewerPreferences",value:function getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}},{key:"getOpenAction",value:function getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}},{key:"getAttachments",value:function getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}},{key:"getDocJSActions",value:function getDocJSActions(){return _classPrivateMethodGet(this,_cacheSimpleMethod,_cacheSimpleMethod2).call(this,"GetDocJSActions")}},{key:"getPageJSActions",value:function getPageJSActions(pageIndex){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:pageIndex})}},{key:"getStructTree",value:function getStructTree(pageIndex){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:pageIndex})}},{key:"getOutline",value:function getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}},{key:"getOptionalContentConfig",value:function getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(function(results){return new _optional_content_config.OptionalContentConfig(results)})}},{key:"getPermissions",value:function getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}},{key:"getMetadata",value:function getMetadata(){var _this59=this;var name="GetMetadata",cachedPromise=_classPrivateFieldGet(this,_methodPromises).get(name);if(cachedPromise){return cachedPromise}var promise=this.messageHandler.sendWithPromise(name,null).then(function(results){var _this59$_fullReader$f,_this59$_fullReader,_this59$_fullReader$c,_this59$_fullReader2;return{info:results[0],metadata:results[1]?new _metadata.Metadata(results[1]):null,contentDispositionFilename:(_this59$_fullReader$f=(_this59$_fullReader=_this59._fullReader)===null||_this59$_fullReader===void 0?void 0:_this59$_fullReader.filename)!==null&&_this59$_fullReader$f!==void 0?_this59$_fullReader$f:null,contentLength:(_this59$_fullReader$c=(_this59$_fullReader2=_this59._fullReader)===null||_this59$_fullReader2===void 0?void 0:_this59$_fullReader2.contentLength)!==null&&_this59$_fullReader$c!==void 0?_this59$_fullReader$c:null}});_classPrivateFieldGet(this,_methodPromises).set(name,promise);return promise}},{key:"getMarkInfo",value:function getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}},{key:"startCleanup",value:function(){var _startCleanup=_asyncToGenerator(_regeneratorRuntime().mark(function _callee36(){var keepLoadedFonts,_iterator23,_step23,page,cleanupSuccessful,_args37=arguments;return _regeneratorRuntime().wrap(function _callee36$(_context37){while(1)switch(_context37.prev=_context37.next){case 0:keepLoadedFonts=_args37.length>0&&_args37[0]!==undefined?_args37[0]:false;if(!this.destroyed){_context37.next=3;break}return _context37.abrupt("return");case 3:_context37.next=5;return this.messageHandler.sendWithPromise("Cleanup",null);case 5:_iterator23=_createForOfIteratorHelper(_classPrivateFieldGet(this,_pageCache).values());_context37.prev=6;_iterator23.s();case 8:if((_step23=_iterator23.n()).done){_context37.next=15;break}page=_step23.value;cleanupSuccessful=page.cleanup();if(cleanupSuccessful){_context37.next=13;break}throw new Error("startCleanup: Page ".concat(page.pageNumber," is currently rendering."));case 13:_context37.next=8;break;case 15:_context37.next=20;break;case 17:_context37.prev=17;_context37.t0=_context37["catch"](6);_iterator23.e(_context37.t0);case 20:_context37.prev=20;_iterator23.f();return _context37.finish(20);case 23:this.commonObjs.clear();if(!keepLoadedFonts){this.fontLoader.clear()}_classPrivateFieldGet(this,_methodPromises).clear();this.filterFactory.destroy(true);case 27:case"end":return _context37.stop()}},_callee36,this,[[6,17,20,23]])}));function startCleanup(){return _startCleanup.apply(this,arguments)}return startCleanup}()},{key:"loadingParams",get:function get(){var _this$_params=this._params,disableAutoFetch=_this$_params.disableAutoFetch,enableXfa=_this$_params.enableXfa;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:disableAutoFetch,enableXfa:enableXfa})}}]);return WorkerTransport}();function _cacheSimpleMethod2(name){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var cachedPromise=_classPrivateFieldGet(this,_methodPromises).get(name);if(cachedPromise){return cachedPromise}var promise=this.messageHandler.sendWithPromise(name,data);_classPrivateFieldGet(this,_methodPromises).set(name,promise);return promise}var _objs=new WeakMap;var _ensureObj=new WeakSet;var PDFObjects=function(){function PDFObjects(){_classCallCheck2(this,PDFObjects);_classPrivateMethodInitSpec(this,_ensureObj);_classPrivateFieldInitSpec(this,_objs,{writable:true,value:Object.create(null)})}_createClass2(PDFObjects,[{key:"get",value:function get(objId){var callback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(callback){var _obj=_classPrivateMethodGet(this,_ensureObj,_ensureObj2).call(this,objId);_obj.capability.promise.then(function(){return callback(_obj.data)});return null}var obj=_classPrivateFieldGet(this,_objs)[objId];if(!(obj!==null&&obj!==void 0&&obj.capability.settled)){throw new Error("Requesting object that isn't resolved yet ".concat(objId,"."))}return obj.data}},{key:"has",value:function has(objId){var obj=_classPrivateFieldGet(this,_objs)[objId];return(obj===null||obj===void 0?void 0:obj.capability.settled)||false}},{key:"resolve",value:function resolve(objId){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var obj=_classPrivateMethodGet(this,_ensureObj,_ensureObj2).call(this,objId);obj.data=data;obj.capability.resolve()}},{key:"clear",value:function clear(){for(var objId in _classPrivateFieldGet(this,_objs)){var _data2$bitmap;var _data2=_classPrivateFieldGet(this,_objs)[objId].data;_data2===null||_data2===void 0||(_data2$bitmap=_data2.bitmap)===null||_data2$bitmap===void 0||_data2$bitmap.close()}_classPrivateFieldSet(this,_objs,Object.create(null))}}]);return PDFObjects}();function _ensureObj2(objId){var _classPrivateFieldGet4;return(_classPrivateFieldGet4=_classPrivateFieldGet(this,_objs))[objId]||(_classPrivateFieldGet4[objId]={capability:new _util.PromiseCapability,data:null})}var _internalRenderTask=new WeakMap;var RenderTask=function(){function RenderTask(internalRenderTask){_classCallCheck2(this,RenderTask);_classPrivateFieldInitSpec(this,_internalRenderTask,{writable:true,value:null});_classPrivateFieldSet(this,_internalRenderTask,internalRenderTask);this.onContinue=null}_createClass2(RenderTask,[{key:"promise",get:function get(){return _classPrivateFieldGet(this,_internalRenderTask).capability.promise}},{key:"cancel",value:function cancel(){var extraDelay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;_classPrivateFieldGet(this,_internalRenderTask).cancel(null,extraDelay)}},{key:"separateAnnots",get:function get(){var separateAnnots=_classPrivateFieldGet(this,_internalRenderTask).operatorList.separateAnnots;if(!separateAnnots){return false}var _classPrivateFieldGet3=_classPrivateFieldGet(this,_internalRenderTask),annotationCanvasMap=_classPrivateFieldGet3.annotationCanvasMap;return separateAnnots.form||separateAnnots.canvas&&(annotationCanvasMap===null||annotationCanvasMap===void 0?void 0:annotationCanvasMap.size)>0}}]);return RenderTask}();exports.RenderTask=RenderTask;var InternalRenderTask=function(){function InternalRenderTask(_ref37){var callback=_ref37.callback,params=_ref37.params,objs=_ref37.objs,commonObjs=_ref37.commonObjs,annotationCanvasMap=_ref37.annotationCanvasMap,operatorList=_ref37.operatorList,pageIndex=_ref37.pageIndex,canvasFactory=_ref37.canvasFactory,filterFactory=_ref37.filterFactory,_ref37$useRequestAnim=_ref37.useRequestAnimationFrame,useRequestAnimationFrame=_ref37$useRequestAnim===void 0?false:_ref37$useRequestAnim,_ref37$pdfBug=_ref37.pdfBug,pdfBug=_ref37$pdfBug===void 0?false:_ref37$pdfBug,_ref37$pageColors=_ref37.pageColors,pageColors=_ref37$pageColors===void 0?null:_ref37$pageColors;_classCallCheck2(this,InternalRenderTask);this.callback=callback;this.params=params;this.objs=objs;this.commonObjs=commonObjs;this.annotationCanvasMap=annotationCanvasMap;this.operatorListIdx=null;this.operatorList=operatorList;this._pageIndex=pageIndex;this.canvasFactory=canvasFactory;this.filterFactory=filterFactory;this._pdfBug=pdfBug;this.pageColors=pageColors;this.running=false;this.graphicsReadyCallback=null;this.graphicsReady=false;this._useRequestAnimationFrame=useRequestAnimationFrame===true&&typeof window!=="undefined";this.cancelled=false;this.capability=new _util.PromiseCapability;this.task=new RenderTask(this);this._cancelBound=this.cancel.bind(this);this._continueBound=this._continue.bind(this);this._scheduleNextBound=this._scheduleNext.bind(this);this._nextBound=this._next.bind(this);this._canvas=params.canvasContext.canvas}_createClass2(InternalRenderTask,[{key:"completed",get:function get(){return this.capability.promise["catch"](function(){})}},{key:"initializeGraphics",value:function initializeGraphics(_ref38){var _globalThis$StepperMa,_this$graphicsReadyCa;var _ref38$transparency=_ref38.transparency,transparency=_ref38$transparency===void 0?false:_ref38$transparency,optionalContentConfig=_ref38.optionalContentConfig;if(this.cancelled){return}if(this._canvas){if(_classStaticPrivateFieldSpecGet(InternalRenderTask,InternalRenderTask,_canvasInUse).has(this._canvas)){throw new Error("Cannot use the same canvas during multiple render() operations. "+"Use different canvas or ensure previous operations were "+"cancelled or completed.")}_classStaticPrivateFieldSpecGet(InternalRenderTask,InternalRenderTask,_canvasInUse).add(this._canvas)}if(this._pdfBug&&(_globalThis$StepperMa=globalThis.StepperManager)!==null&&_globalThis$StepperMa!==void 0&&_globalThis$StepperMa.enabled){this.stepper=globalThis.StepperManager.create(this._pageIndex);this.stepper.init(this.operatorList);this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint()}var _this$params=this.params,canvasContext=_this$params.canvasContext,viewport=_this$params.viewport,transform=_this$params.transform,background=_this$params.background;this.gfx=new _canvas.CanvasGraphics(canvasContext,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:optionalContentConfig},this.annotationCanvasMap,this.pageColors);this.gfx.beginDrawing({transform:transform,viewport:viewport,transparency:transparency,background:background});this.operatorListIdx=0;this.graphicsReady=true;(_this$graphicsReadyCa=this.graphicsReadyCallback)===null||_this$graphicsReadyCa===void 0||_this$graphicsReadyCa.call(this)}},{key:"cancel",value:function cancel(){var _this$gfx;var error=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var extraDelay=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this.running=false;this.cancelled=true;(_this$gfx=this.gfx)===null||_this$gfx===void 0||_this$gfx.endDrawing();_classStaticPrivateFieldSpecGet(InternalRenderTask,InternalRenderTask,_canvasInUse)["delete"](this._canvas);this.callback(error||new _display_utils.RenderingCancelledException("Rendering cancelled, page ".concat(this._pageIndex+1),extraDelay))}},{key:"operatorListChanged",value:function operatorListChanged(){var _this$stepper;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(_this$stepper=this.stepper)===null||_this$stepper===void 0||_this$stepper.updateOperatorList(this.operatorList);if(this.running){return}this._continue()}},{key:"_continue",value:function _continue(){this.running=true;if(this.cancelled){return}if(this.task.onContinue){this.task.onContinue(this._scheduleNextBound)}else{this._scheduleNext()}}},{key:"_scheduleNext",value:function _scheduleNext(){var _this60=this;if(this._useRequestAnimationFrame){window.requestAnimationFrame(function(){_this60._nextBound()["catch"](_this60._cancelBound)})}else{Promise.resolve().then(this._nextBound)["catch"](this._cancelBound)}}},{key:"_next",value:function(){var _next2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee37(){return _regeneratorRuntime().wrap(function _callee37$(_context38){while(1)switch(_context38.prev=_context38.next){case 0:if(!this.cancelled){_context38.next=2;break}return _context38.abrupt("return");case 2:this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper);if(this.operatorListIdx===this.operatorList.argsArray.length){this.running=false;if(this.operatorList.lastChunk){this.gfx.endDrawing();_classStaticPrivateFieldSpecGet(InternalRenderTask,InternalRenderTask,_canvasInUse)["delete"](this._canvas);this.callback()}}case 4:case"end":return _context38.stop()}},_callee37,this)}));function _next(){return _next2.apply(this,arguments)}return _next}()}]);return InternalRenderTask}();var _canvasInUse={writable:true,value:new WeakSet};var version="3.11.174";exports.version=version;var build="ce8716743";exports.build=build}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.SerializableEmpty=exports.PrintAnnotationStorage=exports.AnnotationStorage=void 0;var _util=__w_pdfjs_require__(1);var _editor=__w_pdfjs_require__(4);var _murmurhash=__w_pdfjs_require__(8);var SerializableEmpty=Object.freeze({map:null,hash:"",transfers:undefined});exports.SerializableEmpty=SerializableEmpty;var _modified=new WeakMap;var _storage=new WeakMap;var _setModified=new WeakSet;var AnnotationStorage=function(){function AnnotationStorage(){_classCallCheck2(this,AnnotationStorage);_classPrivateMethodInitSpec(this,_setModified);_classPrivateFieldInitSpec(this,_modified,{writable:true,value:false});_classPrivateFieldInitSpec(this,_storage,{writable:true,value:new Map});this.onSetModified=null;this.onResetModified=null;this.onAnnotationEditor=null}_createClass2(AnnotationStorage,[{key:"getValue",value:function getValue(key,defaultValue){var value=_classPrivateFieldGet(this,_storage).get(key);if(value===undefined){return defaultValue}return Object.assign(defaultValue,value)}},{key:"getRawValue",value:function getRawValue(key){return _classPrivateFieldGet(this,_storage).get(key)}},{key:"remove",value:function remove(key){_classPrivateFieldGet(this,_storage)["delete"](key);if(_classPrivateFieldGet(this,_storage).size===0){this.resetModified()}if(typeof this.onAnnotationEditor==="function"){var _iterator25=_createForOfIteratorHelper(_classPrivateFieldGet(this,_storage).values()),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var value=_step25.value;if(value instanceof _editor.AnnotationEditor){return}}}catch(err){_iterator25.e(err)}finally{_iterator25.f()}this.onAnnotationEditor(null)}}},{key:"setValue",value:function setValue(key,value){var obj=_classPrivateFieldGet(this,_storage).get(key);var modified=false;if(obj!==undefined){for(var _i11=0,_Object$entries=Object.entries(value);_i11<_Object$entries.length;_i11++){var _Object$entries$_i=_slicedToArray2(_Object$entries[_i11],2),entry=_Object$entries$_i[0],val=_Object$entries$_i[1];if(obj[entry]!==val){modified=true;obj[entry]=val}}}else{modified=true;_classPrivateFieldGet(this,_storage).set(key,value)}if(modified){_classPrivateMethodGet(this,_setModified,_setModified2).call(this)}if(value instanceof _editor.AnnotationEditor&&typeof this.onAnnotationEditor==="function"){this.onAnnotationEditor(value.constructor._type)}}},{key:"has",value:function has(key){return _classPrivateFieldGet(this,_storage).has(key)}},{key:"getAll",value:function getAll(){return _classPrivateFieldGet(this,_storage).size>0?(0,_util.objectFromMap)(_classPrivateFieldGet(this,_storage)):null}},{key:"setAll",value:function setAll(obj){for(var _i12=0,_Object$entries2=Object.entries(obj);_i12<_Object$entries2.length;_i12++){var _Object$entries2$_i=_slicedToArray2(_Object$entries2[_i12],2),key=_Object$entries2$_i[0],val=_Object$entries2$_i[1];this.setValue(key,val)}}},{key:"size",get:function get(){return _classPrivateFieldGet(this,_storage).size}},{key:"resetModified",value:function resetModified(){if(_classPrivateFieldGet(this,_modified)){_classPrivateFieldSet(this,_modified,false);if(typeof this.onResetModified==="function"){this.onResetModified()}}}},{key:"print",get:function get(){return new PrintAnnotationStorage(this)}},{key:"serializable",get:function get(){if(_classPrivateFieldGet(this,_storage).size===0){return SerializableEmpty}var map=new Map,hash=new _murmurhash.MurmurHash3_64,transfers=[];var context=Object.create(null);var hasBitmap=false;var _iterator26=_createForOfIteratorHelper(_classPrivateFieldGet(this,_storage)),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var _step26$value=_slicedToArray2(_step26.value,2),key=_step26$value[0],val=_step26$value[1];var serialized=val instanceof _editor.AnnotationEditor?val.serialize(false,context):val;if(serialized){map.set(key,serialized);hash.update("".concat(key,":").concat(JSON.stringify(serialized)));hasBitmap||(hasBitmap=!!serialized.bitmap)}}}catch(err){_iterator26.e(err)}finally{_iterator26.f()}if(hasBitmap){var _iterator27=_createForOfIteratorHelper(map.values()),_step27;try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var value=_step27.value;if(value.bitmap){transfers.push(value.bitmap)}}}catch(err){_iterator27.e(err)}finally{_iterator27.f()}}return map.size>0?{map:map,hash:hash.hexdigest(),transfers:transfers}:SerializableEmpty}}]);return AnnotationStorage}();function _setModified2(){if(!_classPrivateFieldGet(this,_modified)){_classPrivateFieldSet(this,_modified,true);if(typeof this.onSetModified==="function"){this.onSetModified()}}}exports.AnnotationStorage=AnnotationStorage;var _serializable=new WeakMap;var PrintAnnotationStorage=function(_AnnotationStorage){_inherits2(PrintAnnotationStorage,_AnnotationStorage);var _super20=_createSuper(PrintAnnotationStorage);function PrintAnnotationStorage(parent){var _this62;_classCallCheck2(this,PrintAnnotationStorage);_this62=_super20.call(this);_classPrivateFieldInitSpec(_assertThisInitialized(_this62),_serializable,{writable:true,value:void 0});var _parent$serializable=parent.serializable,map=_parent$serializable.map,hash=_parent$serializable.hash,transfers=_parent$serializable.transfers;var clone=structuredClone(map,transfers?{transfer:transfers}:null);_classPrivateFieldSet(_assertThisInitialized(_this62),_serializable,{map:clone,hash:hash,transfers:transfers});return _this62}_createClass2(PrintAnnotationStorage,[{key:"print",get:function get(){(0,_util.unreachable)("Should not call PrintAnnotationStorage.print")}},{key:"serializable",get:function get(){return _classPrivateFieldGet(this,_serializable)}}]);return PrintAnnotationStorage}(AnnotationStorage);exports.PrintAnnotationStorage=PrintAnnotationStorage}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){var _class12;Object.defineProperty(exports,"__esModule",{value:true});exports.AnnotationEditor=void 0;var _tools=__w_pdfjs_require__(5);var _util=__w_pdfjs_require__(1);var _display_utils=__w_pdfjs_require__(6);var _altText=new WeakMap;var _altTextDecorative=new WeakMap;var _altTextButton=new WeakMap;var _altTextTooltip=new WeakMap;var _altTextTooltipTimeout=new WeakMap;var _keepAspectRatio=new WeakMap;var _resizersDiv=new WeakMap;var _boundFocusin=new WeakMap;var _boundFocusout=new WeakMap;var _hasBeenClicked=new WeakMap;var _isEditing=new WeakMap;var _isInEditMode=new WeakMap;var _isDraggable=new WeakMap;var _zIndex=new WeakMap;var _translate=new WeakSet;var _getBaseTranslation=new WeakSet;var _getRotationMatrix=new WeakSet;var _createResizers=new WeakSet;var _resizerPointerdown=new WeakSet;var _resizerPointermove=new WeakSet;var _setAltTextButtonState=new WeakSet;var _setUpDragSession=new WeakSet;var AnnotationEditor=function(){function AnnotationEditor(parameters){_classCallCheck2(this,AnnotationEditor);_classPrivateMethodInitSpec(this,_setUpDragSession);_classPrivateMethodInitSpec(this,_setAltTextButtonState);_classPrivateMethodInitSpec(this,_resizerPointermove);_classPrivateMethodInitSpec(this,_resizerPointerdown);_classPrivateMethodInitSpec(this,_createResizers);_classPrivateMethodInitSpec(this,_getRotationMatrix);_classPrivateMethodInitSpec(this,_getBaseTranslation);_classPrivateMethodInitSpec(this,_translate);_classPrivateFieldInitSpec(this,_altText,{writable:true,value:""});_classPrivateFieldInitSpec(this,_altTextDecorative,{writable:true,value:false});_classPrivateFieldInitSpec(this,_altTextButton,{writable:true,value:null});_classPrivateFieldInitSpec(this,_altTextTooltip,{writable:true,value:null});_classPrivateFieldInitSpec(this,_altTextTooltipTimeout,{writable:true,value:null});_classPrivateFieldInitSpec(this,_keepAspectRatio,{writable:true,value:false});_classPrivateFieldInitSpec(this,_resizersDiv,{writable:true,value:null});_classPrivateFieldInitSpec(this,_boundFocusin,{writable:true,value:this.focusin.bind(this)});_classPrivateFieldInitSpec(this,_boundFocusout,{writable:true,value:this.focusout.bind(this)});_classPrivateFieldInitSpec(this,_hasBeenClicked,{writable:true,value:false});_classPrivateFieldInitSpec(this,_isEditing,{writable:true,value:false});_classPrivateFieldInitSpec(this,_isInEditMode,{writable:true,value:false});_defineProperty2(this,"_initialOptions",Object.create(null));_defineProperty2(this,"_uiManager",null);_defineProperty2(this,"_focusEventsAllowed",true);_defineProperty2(this,"_l10nPromise",null);_classPrivateFieldInitSpec(this,_isDraggable,{writable:true,value:false});_classPrivateFieldInitSpec(this,_zIndex,{writable:true,value:AnnotationEditor._zIndex++});if(this.constructor===AnnotationEditor){(0,_util.unreachable)("Cannot initialize AnnotationEditor.")}this.parent=parameters.parent;this.id=parameters.id;this.width=this.height=null;this.pageIndex=parameters.parent.pageIndex;this.name=parameters.name;this.div=null;this._uiManager=parameters.uiManager;this.annotationElementId=null;this._willKeepAspectRatio=false;this._initialOptions.isCentered=parameters.isCentered;this._structTreeParentId=null;var _this$parent$viewport=this.parent.viewport,_rotation=_this$parent$viewport.rotation,_this$parent$viewport2=_this$parent$viewport.rawDims,_pageWidth=_this$parent$viewport2.pageWidth,_pageHeight=_this$parent$viewport2.pageHeight,pageX=_this$parent$viewport2.pageX,pageY=_this$parent$viewport2.pageY;this.rotation=_rotation;this.pageRotation=(360+_rotation-this._uiManager.viewParameters.rotation)%360;this.pageDimensions=[_pageWidth,_pageHeight];this.pageTranslation=[pageX,pageY];var _this$parentDimension=_slicedToArray2(this.parentDimensions,2),_width=_this$parentDimension[0],_height2=_this$parentDimension[1];this.x=parameters.x/_width;this.y=parameters.y/_height2;this.isAttachedToDOM=false;this.deleted=false}_createClass2(AnnotationEditor,[{key:"editorType",get:function get(){return Object.getPrototypeOf(this).constructor._type}},{key:"propertiesToUpdate",get:function get(){return[]}},{key:"_isDraggable",get:function get(){return _classPrivateFieldGet(this,_isDraggable)},set:function set(value){var _this$div;_classPrivateFieldSet(this,_isDraggable,value);(_this$div=this.div)===null||_this$div===void 0||_this$div.classList.toggle("draggable",value)}},{key:"center",value:function center(){var _this$pageDimensions=_slicedToArray2(this.pageDimensions,2),pageWidth=_this$pageDimensions[0],pageHeight=_this$pageDimensions[1];switch(this.parentRotation){case 90:this.x-=this.height*pageHeight/(pageWidth*2);this.y+=this.width*pageWidth/(pageHeight*2);break;case 180:this.x+=this.width/2;this.y+=this.height/2;break;case 270:this.x+=this.height*pageHeight/(pageWidth*2);this.y-=this.width*pageWidth/(pageHeight*2);break;default:this.x-=this.width/2;this.y-=this.height/2;break}this.fixAndSetPosition()}},{key:"addCommands",value:function addCommands(params){this._uiManager.addCommands(params)}},{key:"currentLayer",get:function get(){return this._uiManager.currentLayer}},{key:"setInBackground",value:function setInBackground(){this.div.style.zIndex=0}},{key:"setInForeground",value:function setInForeground(){this.div.style.zIndex=_classPrivateFieldGet(this,_zIndex)}},{key:"setParent",value:function setParent(parent){if(parent!==null){this.pageIndex=parent.pageIndex;this.pageDimensions=parent.pageDimensions}this.parent=parent}},{key:"focusin",value:function focusin(event){if(!this._focusEventsAllowed){return}if(!_classPrivateFieldGet(this,_hasBeenClicked)){this.parent.setSelected(this)}else{_classPrivateFieldSet(this,_hasBeenClicked,false)}}},{key:"focusout",value:function focusout(event){var _this$parent;if(!this._focusEventsAllowed){return}if(!this.isAttachedToDOM){return}var target=event.relatedTarget;if(target!==null&&target!==void 0&&target.closest("#".concat(this.id))){return}event.preventDefault();if(!((_this$parent=this.parent)!==null&&_this$parent!==void 0&&_this$parent.isMultipleSelection)){this.commitOrRemove()}}},{key:"commitOrRemove",value:function commitOrRemove(){if(this.isEmpty()){this.remove()}else{this.commit()}}},{key:"commit",value:function commit(){this.addToAnnotationStorage()}},{key:"addToAnnotationStorage",value:function addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}},{key:"setAt",value:function setAt(x,y,tx,ty){var _this$parentDimension2=_slicedToArray2(this.parentDimensions,2),width=_this$parentDimension2[0],height=_this$parentDimension2[1];var _this$screenToPageTra=this.screenToPageTranslation(tx,ty);var _this$screenToPageTra2=_slicedToArray2(_this$screenToPageTra,2);tx=_this$screenToPageTra2[0];ty=_this$screenToPageTra2[1];this.x=(x+tx)/width;this.y=(y+ty)/height;this.fixAndSetPosition()}},{key:"translate",value:function translate(x,y){_classPrivateMethodGet(this,_translate,_translate2).call(this,this.parentDimensions,x,y)}},{key:"translateInPage",value:function translateInPage(x,y){_classPrivateMethodGet(this,_translate,_translate2).call(this,this.pageDimensions,x,y);this.div.scrollIntoView({block:"nearest"})}},{key:"drag",value:function drag(tx,ty){var _this$parentDimension3=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension3[0],parentHeight=_this$parentDimension3[1];this.x+=tx/parentWidth;this.y+=ty/parentHeight;if(this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){var _this$div$getBounding=this.div.getBoundingClientRect(),_x47=_this$div$getBounding.x,_y=_this$div$getBounding.y;if(this.parent.findNewParent(this,_x47,_y)){this.x-=Math.floor(this.x);this.y-=Math.floor(this.y)}}var x=this.x,y=this.y;var _classPrivateMethodGe=_classPrivateMethodGet(this,_getBaseTranslation,_getBaseTranslation2).call(this),_classPrivateMethodGe2=_slicedToArray2(_classPrivateMethodGe,2),bx=_classPrivateMethodGe2[0],by=_classPrivateMethodGe2[1];x+=bx;y+=by;this.div.style.left="".concat((100*x).toFixed(2),"%");this.div.style.top="".concat((100*y).toFixed(2),"%");this.div.scrollIntoView({block:"nearest"})}},{key:"fixAndSetPosition",value:function fixAndSetPosition(){var _this$pageDimensions2=_slicedToArray2(this.pageDimensions,2),pageWidth=_this$pageDimensions2[0],pageHeight=_this$pageDimensions2[1];var x=this.x,y=this.y,width=this.width,height=this.height;width*=pageWidth;height*=pageHeight;x*=pageWidth;y*=pageHeight;switch(this.rotation){case 0:x=Math.max(0,Math.min(pageWidth-width,x));y=Math.max(0,Math.min(pageHeight-height,y));break;case 90:x=Math.max(0,Math.min(pageWidth-height,x));y=Math.min(pageHeight,Math.max(width,y));break;case 180:x=Math.min(pageWidth,Math.max(width,x));y=Math.min(pageHeight,Math.max(height,y));break;case 270:x=Math.min(pageWidth,Math.max(height,x));y=Math.max(0,Math.min(pageHeight-width,y));break}this.x=x/=pageWidth;this.y=y/=pageHeight;var _classPrivateMethodGe3=_classPrivateMethodGet(this,_getBaseTranslation,_getBaseTranslation2).call(this),_classPrivateMethodGe4=_slicedToArray2(_classPrivateMethodGe3,2),bx=_classPrivateMethodGe4[0],by=_classPrivateMethodGe4[1];x+=bx;y+=by;var style=this.div.style;style.left="".concat((100*x).toFixed(2),"%");style.top="".concat((100*y).toFixed(2),"%");this.moveInDOM()}},{key:"screenToPageTranslation",value:function screenToPageTranslation(x,y){return _classStaticPrivateMethodGet(AnnotationEditor,AnnotationEditor,_rotatePoint).call(AnnotationEditor,x,y,this.parentRotation)}},{key:"pageTranslationToScreen",value:function pageTranslationToScreen(x,y){return _classStaticPrivateMethodGet(AnnotationEditor,AnnotationEditor,_rotatePoint).call(AnnotationEditor,x,y,360-this.parentRotation)}},{key:"parentScale",get:function get(){return this._uiManager.viewParameters.realScale}},{key:"parentRotation",get:function get(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}},{key:"parentDimensions",get:function get(){var parentScale=this.parentScale,_this$pageDimensions3=_slicedToArray2(this.pageDimensions,2),pageWidth=_this$pageDimensions3[0],pageHeight=_this$pageDimensions3[1];var scaledWidth=pageWidth*parentScale;var scaledHeight=pageHeight*parentScale;return _util.FeatureTest.isCSSRoundSupported?[Math.round(scaledWidth),Math.round(scaledHeight)]:[scaledWidth,scaledHeight]}},{key:"setDims",value:function setDims(width,height){var _classPrivateFieldGet5;var _this$parentDimension4=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension4[0],parentHeight=_this$parentDimension4[1];this.div.style.width="".concat((100*width/parentWidth).toFixed(2),"%");if(!_classPrivateFieldGet(this,_keepAspectRatio)){this.div.style.height="".concat((100*height/parentHeight).toFixed(2),"%")}(_classPrivateFieldGet5=_classPrivateFieldGet(this,_altTextButton))===null||_classPrivateFieldGet5===void 0||_classPrivateFieldGet5.classList.toggle("small",width<AnnotationEditor.SMALL_EDITOR_SIZE||height<AnnotationEditor.SMALL_EDITOR_SIZE)}},{key:"fixDims",value:function fixDims(){var style=this.div.style;var height=style.height,width=style.width;var widthPercent=width.endsWith("%");var heightPercent=!_classPrivateFieldGet(this,_keepAspectRatio)&&height.endsWith("%");if(widthPercent&&heightPercent){return}var _this$parentDimension5=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension5[0],parentHeight=_this$parentDimension5[1];if(!widthPercent){style.width="".concat((100*parseFloat(width)/parentWidth).toFixed(2),"%")}if(!_classPrivateFieldGet(this,_keepAspectRatio)&&!heightPercent){style.height="".concat((100*parseFloat(height)/parentHeight).toFixed(2),"%")}}},{key:"getInitialTranslation",value:function getInitialTranslation(){return[0,0]}},{key:"addAltTextButton",value:function(){var _addAltTextButton=_asyncToGenerator(_regeneratorRuntime().mark(function _callee39(){var _this63=this;var altText,msg,PERCENT;return _regeneratorRuntime().wrap(function _callee39$(_context40){while(1)switch(_context40.prev=_context40.next){case 0:if(!_classPrivateFieldGet(this,_altTextButton)){_context40.next=2;break}return _context40.abrupt("return");case 2:altText=_classPrivateFieldSet(this,_altTextButton,document.createElement("button"));altText.className="altText";_context40.next=6;return AnnotationEditor._l10nPromise.get("editor_alt_text_button_label");case 6:msg=_context40.sent;altText.textContent=msg;altText.setAttribute("aria-label",msg);altText.tabIndex="0";altText.addEventListener("contextmenu",_display_utils.noContextMenu);altText.addEventListener("pointerdown",function(event){return event.stopPropagation()});altText.addEventListener("click",function(event){event.preventDefault();_this63._uiManager.editAltText(_this63)},{capture:true});altText.addEventListener("keydown",function(event){if(event.target===altText&&event.key==="Enter"){event.preventDefault();_this63._uiManager.editAltText(_this63)}});_classPrivateMethodGet(this,_setAltTextButtonState,_setAltTextButtonState2).call(this);this.div.append(altText);if(!AnnotationEditor.SMALL_EDITOR_SIZE){PERCENT=40;AnnotationEditor.SMALL_EDITOR_SIZE=Math.min(128,Math.round(altText.getBoundingClientRect().width*(1+PERCENT/100)))}case 17:case"end":return _context40.stop()}},_callee39,this)}));function addAltTextButton(){return _addAltTextButton.apply(this,arguments)}return addAltTextButton}()},{key:"getClientDimensions",value:function getClientDimensions(){return this.div.getBoundingClientRect()}},{key:"altTextData",get:function get(){return{altText:_classPrivateFieldGet(this,_altText),decorative:_classPrivateFieldGet(this,_altTextDecorative)}},set:function set(_ref39){var altText=_ref39.altText,decorative=_ref39.decorative;if(_classPrivateFieldGet(this,_altText)===altText&&_classPrivateFieldGet(this,_altTextDecorative)===decorative){return}_classPrivateFieldSet(this,_altText,altText);_classPrivateFieldSet(this,_altTextDecorative,decorative);_classPrivateMethodGet(this,_setAltTextButtonState,_setAltTextButtonState2).call(this)}},{key:"render",value:function render(){this.div=document.createElement("div");this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360);this.div.className=this.name;this.div.setAttribute("id",this.id);this.div.setAttribute("tabIndex",0);this.setInForeground();this.div.addEventListener("focusin",_classPrivateFieldGet(this,_boundFocusin));this.div.addEventListener("focusout",_classPrivateFieldGet(this,_boundFocusout));var _this$parentDimension6=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension6[0],parentHeight=_this$parentDimension6[1];if(this.parentRotation%180!==0){this.div.style.maxWidth="".concat((100*parentHeight/parentWidth).toFixed(2),"%");this.div.style.maxHeight="".concat((100*parentWidth/parentHeight).toFixed(2),"%")}var _this$getInitialTrans=this.getInitialTranslation(),_this$getInitialTrans2=_slicedToArray2(_this$getInitialTrans,2),tx=_this$getInitialTrans2[0],ty=_this$getInitialTrans2[1];this.translate(tx,ty);(0,_tools.bindEvents)(this,this.div,["pointerdown"]);return this.div}},{key:"pointerdown",value:function pointerdown(event){var isMac=_util.FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){event.preventDefault();return}_classPrivateFieldSet(this,_hasBeenClicked,true);_classPrivateMethodGet(this,_setUpDragSession,_setUpDragSession2).call(this,event)}},{key:"moveInDOM",value:function moveInDOM(){var _this$parent2;(_this$parent2=this.parent)===null||_this$parent2===void 0||_this$parent2.moveEditorInDOM(this)}},{key:"_setParentAndPosition",value:function _setParentAndPosition(parent,x,y){parent.changeParent(this);this.x=x;this.y=y;this.fixAndSetPosition()}},{key:"getRect",value:function getRect(tx,ty){var scale=this.parentScale;var _this$pageDimensions4=_slicedToArray2(this.pageDimensions,2),pageWidth=_this$pageDimensions4[0],pageHeight=_this$pageDimensions4[1];var _this$pageTranslation=_slicedToArray2(this.pageTranslation,2),pageX=_this$pageTranslation[0],pageY=_this$pageTranslation[1];var shiftX=tx/scale;var shiftY=ty/scale;var x=this.x*pageWidth;var y=this.y*pageHeight;var width=this.width*pageWidth;var height=this.height*pageHeight;switch(this.rotation){case 0:return[x+shiftX+pageX,pageHeight-y-shiftY-height+pageY,x+shiftX+width+pageX,pageHeight-y-shiftY+pageY];case 90:return[x+shiftY+pageX,pageHeight-y+shiftX+pageY,x+shiftY+height+pageX,pageHeight-y+shiftX+width+pageY];case 180:return[x-shiftX-width+pageX,pageHeight-y+shiftY+pageY,x-shiftX+pageX,pageHeight-y+shiftY+height+pageY];case 270:return[x-shiftY-height+pageX,pageHeight-y-shiftX-width+pageY,x-shiftY+pageX,pageHeight-y-shiftX+pageY];default:throw new Error("Invalid rotation")}}},{key:"getRectInCurrentCoords",value:function getRectInCurrentCoords(rect,pageHeight){var _rect=_slicedToArray2(rect,4),x1=_rect[0],y1=_rect[1],x2=_rect[2],y2=_rect[3];var width=x2-x1;var height=y2-y1;switch(this.rotation){case 0:return[x1,pageHeight-y2,width,height];case 90:return[x1,pageHeight-y1,height,width];case 180:return[x2,pageHeight-y1,width,height];case 270:return[x2,pageHeight-y2,height,width];default:throw new Error("Invalid rotation")}}},{key:"onceAdded",value:function onceAdded(){}},{key:"isEmpty",value:function isEmpty(){return false}},{key:"enableEditMode",value:function enableEditMode(){_classPrivateFieldSet(this,_isInEditMode,true)}},{key:"disableEditMode",value:function disableEditMode(){_classPrivateFieldSet(this,_isInEditMode,false)}},{key:"isInEditMode",value:function isInEditMode(){return _classPrivateFieldGet(this,_isInEditMode)}},{key:"shouldGetKeyboardEvents",value:function shouldGetKeyboardEvents(){return false}},{key:"needsToBeRebuilt",value:function needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}},{key:"rebuild",value:function rebuild(){var _this$div2,_this$div3;(_this$div2=this.div)===null||_this$div2===void 0||_this$div2.addEventListener("focusin",_classPrivateFieldGet(this,_boundFocusin));(_this$div3=this.div)===null||_this$div3===void 0||_this$div3.addEventListener("focusout",_classPrivateFieldGet(this,_boundFocusout))}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;(0,_util.unreachable)("An editor must be serializable")}},{key:"remove",value:function remove(){var _classPrivateFieldGet6;this.div.removeEventListener("focusin",_classPrivateFieldGet(this,_boundFocusin));this.div.removeEventListener("focusout",_classPrivateFieldGet(this,_boundFocusout));if(!this.isEmpty()){this.commit()}if(this.parent){this.parent.remove(this)}else{this._uiManager.removeEditor(this)}(_classPrivateFieldGet6=_classPrivateFieldGet(this,_altTextButton))===null||_classPrivateFieldGet6===void 0||_classPrivateFieldGet6.remove();_classPrivateFieldSet(this,_altTextButton,null);_classPrivateFieldSet(this,_altTextTooltip,null)}},{key:"isResizable",get:function get(){return false}},{key:"makeResizable",value:function makeResizable(){if(this.isResizable){_classPrivateMethodGet(this,_createResizers,_createResizers2).call(this);_classPrivateFieldGet(this,_resizersDiv).classList.remove("hidden")}}},{key:"select",value:function select(){var _this$div4;this.makeResizable();(_this$div4=this.div)===null||_this$div4===void 0||_this$div4.classList.add("selectedEditor")}},{key:"unselect",value:function unselect(){var _classPrivateFieldGet7,_this$div5,_this$div6;(_classPrivateFieldGet7=_classPrivateFieldGet(this,_resizersDiv))===null||_classPrivateFieldGet7===void 0||_classPrivateFieldGet7.classList.add("hidden");(_this$div5=this.div)===null||_this$div5===void 0||_this$div5.classList.remove("selectedEditor");if((_this$div6=this.div)!==null&&_this$div6!==void 0&&_this$div6.contains(document.activeElement)){this._uiManager.currentLayer.div.focus()}}},{key:"updateParams",value:function updateParams(type,value){}},{key:"disableEditing",value:function disableEditing(){if(_classPrivateFieldGet(this,_altTextButton)){_classPrivateFieldGet(this,_altTextButton).hidden=true}}},{key:"enableEditing",value:function enableEditing(){if(_classPrivateFieldGet(this,_altTextButton)){_classPrivateFieldGet(this,_altTextButton).hidden=false}}},{key:"enterInEditMode",value:function enterInEditMode(){}},{key:"contentDiv",get:function get(){return this.div}},{key:"isEditing",get:function get(){return _classPrivateFieldGet(this,_isEditing)},set:function set(value){_classPrivateFieldSet(this,_isEditing,value);if(!this.parent){return}if(value){this.parent.setSelected(this);this.parent.setActiveEditor(this)}else{this.parent.setActiveEditor(null)}}},{key:"setAspectRatio",value:function setAspectRatio(width,height){_classPrivateFieldSet(this,_keepAspectRatio,true);var aspectRatio=width/height;var style=this.div.style;style.aspectRatio=aspectRatio;style.height="auto"}}],[{key:"_defaultLineColor",get:function get(){return(0,_util.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}},{key:"deleteAnnotationElement",value:function deleteAnnotationElement(editor){var fakeEditor=new FakeEditor({id:editor.parent.getNextId(),parent:editor.parent,uiManager:editor._uiManager});fakeEditor.annotationElementId=editor.annotationElementId;fakeEditor.deleted=true;fakeEditor._uiManager.addToAnnotationStorage(fakeEditor)}},{key:"initialize",value:function initialize(l10n){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;AnnotationEditor._l10nPromise||(AnnotationEditor._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(function(str){return[str,l10n.get(str)]})));if(options!==null&&options!==void 0&&options.strings){var _iterator28=_createForOfIteratorHelper(options.strings),_step28;try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var str=_step28.value;AnnotationEditor._l10nPromise.set(str,l10n.get(str))}}catch(err){_iterator28.e(err)}finally{_iterator28.f()}}if(AnnotationEditor._borderLineWidth!==-1){return}var style=getComputedStyle(document.documentElement);AnnotationEditor._borderLineWidth=parseFloat(style.getPropertyValue("--outline-width"))||0}},{key:"updateDefaultParams",value:function updateDefaultParams(_type,_value){}},{key:"defaultPropertiesToUpdate",get:function get(){return[]}},{key:"isHandlingMimeForPasting",value:function isHandlingMimeForPasting(mime){return false}},{key:"paste",value:function paste(item,parent){(0,_util.unreachable)("Not implemented")}},{key:"deserialize",value:function deserialize(data,parent,uiManager){var editor=new this.prototype.constructor({parent:parent,id:parent.getNextId(),uiManager:uiManager});editor.rotation=data.rotation;var _editor$pageDimension=_slicedToArray2(editor.pageDimensions,2),pageWidth=_editor$pageDimension[0],pageHeight=_editor$pageDimension[1];var _editor$getRectInCurr=editor.getRectInCurrentCoords(data.rect,pageHeight),_editor$getRectInCurr2=_slicedToArray2(_editor$getRectInCurr,4),x=_editor$getRectInCurr2[0],y=_editor$getRectInCurr2[1],width=_editor$getRectInCurr2[2],height=_editor$getRectInCurr2[3];editor.x=x/pageWidth;editor.y=y/pageHeight;editor.width=width/pageWidth;editor.height=height/pageHeight;return editor}},{key:"MIN_SIZE",get:function get(){return 16}}]);return AnnotationEditor}();_class12=AnnotationEditor;function _translate2(_ref40,x,y){var _ref41=_slicedToArray2(_ref40,2),width=_ref41[0],height=_ref41[1];var _this$screenToPageTra3=this.screenToPageTranslation(x,y);var _this$screenToPageTra4=_slicedToArray2(_this$screenToPageTra3,2);x=_this$screenToPageTra4[0];y=_this$screenToPageTra4[1];this.x+=x/width;this.y+=y/height;this.fixAndSetPosition()}function _getBaseTranslation2(){var _this$parentDimension7=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension7[0],parentHeight=_this$parentDimension7[1];var _borderLineWidth=_class12._borderLineWidth;var x=_borderLineWidth/parentWidth;var y=_borderLineWidth/parentHeight;switch(this.rotation){case 90:return[-x,y];case 180:return[x,y];case 270:return[x,-y];default:return[-x,-y]}}function _rotatePoint(x,y,angle){switch(angle){case 90:return[y,-x];case 180:return[-x,-y];case 270:return[-y,x];default:return[x,y]}}function _getRotationMatrix2(rotation){switch(rotation){case 90:{var _this$pageDimensions5=_slicedToArray2(this.pageDimensions,2),pageWidth=_this$pageDimensions5[0],pageHeight=_this$pageDimensions5[1];return[0,-pageWidth/pageHeight,pageHeight/pageWidth,0]}case 180:return[-1,0,0,-1];case 270:{var _this$pageDimensions6=_slicedToArray2(this.pageDimensions,2),_pageWidth2=_this$pageDimensions6[0],_pageHeight2=_this$pageDimensions6[1];return[0,_pageWidth2/_pageHeight2,-_pageHeight2/_pageWidth2,0]}default:return[1,0,0,1]}}function _createResizers2(){if(_classPrivateFieldGet(this,_resizersDiv)){return}_classPrivateFieldSet(this,_resizersDiv,document.createElement("div"));_classPrivateFieldGet(this,_resizersDiv).classList.add("resizers");var classes=["topLeft","topRight","bottomRight","bottomLeft"];if(!this._willKeepAspectRatio){classes.push("topMiddle","middleRight","bottomMiddle","middleLeft")}for(var _i13=0,_classes=classes;_i13<_classes.length;_i13++){var _name5=_classes[_i13];var div=document.createElement("div");_classPrivateFieldGet(this,_resizersDiv).append(div);div.classList.add("resizer",_name5);div.addEventListener("pointerdown",_classPrivateMethodGet(this,_resizerPointerdown,_resizerPointerdown2).bind(this,_name5));div.addEventListener("contextmenu",_display_utils.noContextMenu)}this.div.prepend(_classPrivateFieldGet(this,_resizersDiv))}function _resizerPointerdown2(name,event){var _this65=this;event.preventDefault();var isMac=_util.FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){return}var boundResizerPointermove=_classPrivateMethodGet(this,_resizerPointermove,_resizerPointermove2).bind(this,name);var savedDraggable=this._isDraggable;this._isDraggable=false;var pointerMoveOptions={passive:true,capture:true};window.addEventListener("pointermove",boundResizerPointermove,pointerMoveOptions);var savedX=this.x;var savedY=this.y;var savedWidth=this.width;var savedHeight=this.height;var savedParentCursor=this.parent.div.style.cursor;var savedCursor=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(event.target).cursor;var pointerUpCallback=function pointerUpCallback(){_this65._isDraggable=savedDraggable;window.removeEventListener("pointerup",pointerUpCallback);window.removeEventListener("blur",pointerUpCallback);window.removeEventListener("pointermove",boundResizerPointermove,pointerMoveOptions);_this65.parent.div.style.cursor=savedParentCursor;_this65.div.style.cursor=savedCursor;var newX=_this65.x;var newY=_this65.y;var newWidth=_this65.width;var newHeight=_this65.height;if(newX===savedX&&newY===savedY&&newWidth===savedWidth&&newHeight===savedHeight){return}_this65.addCommands({cmd:function cmd(){_this65.width=newWidth;_this65.height=newHeight;_this65.x=newX;_this65.y=newY;var _this65$parentDimensi=_slicedToArray2(_this65.parentDimensions,2),parentWidth=_this65$parentDimensi[0],parentHeight=_this65$parentDimensi[1];_this65.setDims(parentWidth*newWidth,parentHeight*newHeight);_this65.fixAndSetPosition()},undo:function undo(){_this65.width=savedWidth;_this65.height=savedHeight;_this65.x=savedX;_this65.y=savedY;var _this65$parentDimensi2=_slicedToArray2(_this65.parentDimensions,2),parentWidth=_this65$parentDimensi2[0],parentHeight=_this65$parentDimensi2[1];_this65.setDims(parentWidth*savedWidth,parentHeight*savedHeight);_this65.fixAndSetPosition()},mustExec:true})};window.addEventListener("pointerup",pointerUpCallback);window.addEventListener("blur",pointerUpCallback)}function _resizerPointermove2(name,event){var _this$parentDimension8=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension8[0],parentHeight=_this$parentDimension8[1];var savedX=this.x;var savedY=this.y;var savedWidth=this.width;var savedHeight=this.height;var minWidth=_class12.MIN_SIZE/parentWidth;var minHeight=_class12.MIN_SIZE/parentHeight;var round=function round(x){return Math.round(x*10000)/10000};var rotationMatrix=_classPrivateMethodGet(this,_getRotationMatrix,_getRotationMatrix2).call(this,this.rotation);var transf=function transf(x,y){return[rotationMatrix[0]*x+rotationMatrix[2]*y,rotationMatrix[1]*x+rotationMatrix[3]*y]};var invRotationMatrix=_classPrivateMethodGet(this,_getRotationMatrix,_getRotationMatrix2).call(this,360-this.rotation);var invTransf=function invTransf(x,y){return[invRotationMatrix[0]*x+invRotationMatrix[2]*y,invRotationMatrix[1]*x+invRotationMatrix[3]*y]};var getPoint;var getOpposite;var isDiagonal=false;var isHorizontal=false;switch(name){case"topLeft":isDiagonal=true;getPoint=function getPoint(w,h){return[0,0]};getOpposite=function getOpposite(w,h){return[w,h]};break;case"topMiddle":getPoint=function getPoint(w,h){return[w/2,0]};getOpposite=function getOpposite(w,h){return[w/2,h]};break;case"topRight":isDiagonal=true;getPoint=function getPoint(w,h){return[w,0]};getOpposite=function getOpposite(w,h){return[0,h]};break;case"middleRight":isHorizontal=true;getPoint=function getPoint(w,h){return[w,h/2]};getOpposite=function getOpposite(w,h){return[0,h/2]};break;case"bottomRight":isDiagonal=true;getPoint=function getPoint(w,h){return[w,h]};getOpposite=function getOpposite(w,h){return[0,0]};break;case"bottomMiddle":getPoint=function getPoint(w,h){return[w/2,h]};getOpposite=function getOpposite(w,h){return[w/2,0]};break;case"bottomLeft":isDiagonal=true;getPoint=function getPoint(w,h){return[0,h]};getOpposite=function getOpposite(w,h){return[w,0]};break;case"middleLeft":isHorizontal=true;getPoint=function getPoint(w,h){return[0,h/2]};getOpposite=function getOpposite(w,h){return[w,h/2]};break}var point=getPoint(savedWidth,savedHeight);var oppositePoint=getOpposite(savedWidth,savedHeight);var transfOppositePoint=transf.apply(void 0,_toConsumableArray2(oppositePoint));var oppositeX=round(savedX+transfOppositePoint[0]);var oppositeY=round(savedY+transfOppositePoint[1]);var ratioX=1;var ratioY=1;var _this$screenToPageTra5=this.screenToPageTranslation(event.movementX,event.movementY),_this$screenToPageTra6=_slicedToArray2(_this$screenToPageTra5,2),deltaX=_this$screenToPageTra6[0],deltaY=_this$screenToPageTra6[1];var _invTransf=invTransf(deltaX/parentWidth,deltaY/parentHeight);var _invTransf2=_slicedToArray2(_invTransf,2);deltaX=_invTransf2[0];deltaY=_invTransf2[1];if(isDiagonal){var oldDiag=Math.hypot(savedWidth,savedHeight);ratioX=ratioY=Math.max(Math.min(Math.hypot(oppositePoint[0]-point[0]-deltaX,oppositePoint[1]-point[1]-deltaY)/oldDiag,1/savedWidth,1/savedHeight),minWidth/savedWidth,minHeight/savedHeight)}else if(isHorizontal){ratioX=Math.max(minWidth,Math.min(1,Math.abs(oppositePoint[0]-point[0]-deltaX)))/savedWidth}else{ratioY=Math.max(minHeight,Math.min(1,Math.abs(oppositePoint[1]-point[1]-deltaY)))/savedHeight}var newWidth=round(savedWidth*ratioX);var newHeight=round(savedHeight*ratioY);transfOppositePoint=transf.apply(void 0,_toConsumableArray2(getOpposite(newWidth,newHeight)));var newX=oppositeX-transfOppositePoint[0];var newY=oppositeY-transfOppositePoint[1];this.width=newWidth;this.height=newHeight;this.x=newX;this.y=newY;this.setDims(parentWidth*newWidth,parentHeight*newHeight);this.fixAndSetPosition()}function _setAltTextButtonState2(){return _setAltTextButtonState3.apply(this,arguments)}function _setAltTextButtonState3(){_setAltTextButtonState3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee40(){var _this67=this;var button,_classPrivateFieldGet8,tooltip,_id,DELAY_TO_SHOW_TOOLTIP;return _regeneratorRuntime().wrap(function _callee40$(_context41){while(1)switch(_context41.prev=_context41.next){case 0:button=_classPrivateFieldGet(this,_altTextButton);if(button){_context41.next=3;break}return _context41.abrupt("return");case 3:if(!(!_classPrivateFieldGet(this,_altText)&&!_classPrivateFieldGet(this,_altTextDecorative))){_context41.next=7;break}button.classList.remove("done");(_classPrivateFieldGet8=_classPrivateFieldGet(this,_altTextTooltip))===null||_classPrivateFieldGet8===void 0||_classPrivateFieldGet8.remove();return _context41.abrupt("return");case 7:_class12._l10nPromise.get("editor_alt_text_edit_button_label").then(function(msg){button.setAttribute("aria-label",msg)});tooltip=_classPrivateFieldGet(this,_altTextTooltip);if(!tooltip){_classPrivateFieldSet(this,_altTextTooltip,tooltip=document.createElement("span"));tooltip.className="tooltip";tooltip.setAttribute("role","tooltip");_id=tooltip.id="alt-text-tooltip-".concat(this.id);button.setAttribute("aria-describedby",_id);DELAY_TO_SHOW_TOOLTIP=100;button.addEventListener("mouseenter",function(){_classPrivateFieldSet(_this67,_altTextTooltipTimeout,setTimeout(function(){_classPrivateFieldSet(_this67,_altTextTooltipTimeout,null);_classPrivateFieldGet(_this67,_altTextTooltip).classList.add("show");_this67._uiManager._eventBus.dispatch("reporttelemetry",{source:_this67,details:{type:"editing",subtype:_this67.editorType,data:{action:"alt_text_tooltip"}}})},DELAY_TO_SHOW_TOOLTIP))});button.addEventListener("mouseleave",function(){var _classPrivateFieldGet9;clearTimeout(_classPrivateFieldGet(_this67,_altTextTooltipTimeout));_classPrivateFieldSet(_this67,_altTextTooltipTimeout,null);(_classPrivateFieldGet9=_classPrivateFieldGet(_this67,_altTextTooltip))===null||_classPrivateFieldGet9===void 0||_classPrivateFieldGet9.classList.remove("show")})}button.classList.add("done");if(!_classPrivateFieldGet(this,_altTextDecorative)){_context41.next=17;break}_context41.next=14;return _class12._l10nPromise.get("editor_alt_text_decorative_tooltip");case 14:_context41.t0=_context41.sent;_context41.next=18;break;case 17:_context41.t0=_classPrivateFieldGet(this,_altText);case 18:tooltip.innerText=_context41.t0;if(!tooltip.parentNode){button.append(tooltip)}case 20:case"end":return _context41.stop()}},_callee40,this)}));return _setAltTextButtonState3.apply(this,arguments)}function _setUpDragSession2(event){var _this66=this;if(!this._isDraggable){return}var isSelected=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();var pointerMoveOptions,pointerMoveCallback;if(isSelected){pointerMoveOptions={passive:true,capture:true};pointerMoveCallback=function pointerMoveCallback(e){var _this66$screenToPageT=_this66.screenToPageTranslation(e.movementX,e.movementY),_this66$screenToPageT2=_slicedToArray2(_this66$screenToPageT,2),tx=_this66$screenToPageT2[0],ty=_this66$screenToPageT2[1];_this66._uiManager.dragSelectedEditors(tx,ty)};window.addEventListener("pointermove",pointerMoveCallback,pointerMoveOptions)}var pointerUpCallback=function pointerUpCallback(){window.removeEventListener("pointerup",pointerUpCallback);window.removeEventListener("blur",pointerUpCallback);if(isSelected){window.removeEventListener("pointermove",pointerMoveCallback,pointerMoveOptions)}_classPrivateFieldSet(_this66,_hasBeenClicked,false);if(!_this66._uiManager.endDragSession()){var isMac=_util.FeatureTest.platform.isMac;if(event.ctrlKey&&!isMac||event.shiftKey||event.metaKey&&isMac){_this66.parent.toggleSelected(_this66)}else{_this66.parent.setSelected(_this66)}}};window.addEventListener("pointerup",pointerUpCallback);window.addEventListener("blur",pointerUpCallback)}_defineProperty2(AnnotationEditor,"_borderLineWidth",-1);_defineProperty2(AnnotationEditor,"_colorManager",new _tools.ColorManager);_defineProperty2(AnnotationEditor,"_zIndex",1);_defineProperty2(AnnotationEditor,"SMALL_EDITOR_SIZE",0);exports.AnnotationEditor=AnnotationEditor;var FakeEditor=function(_AnnotationEditor){_inherits2(FakeEditor,_AnnotationEditor);var _super21=_createSuper(FakeEditor);function FakeEditor(params){var _this64;_classCallCheck2(this,FakeEditor);_this64=_super21.call(this,params);_this64.annotationElementId=params.annotationElementId;_this64.deleted=true;return _this64}_createClass2(FakeEditor,[{key:"serialize",value:function serialize(){return{id:this.annotationElementId,deleted:true,pageIndex:this.pageIndex}}}]);return FakeEditor}(AnnotationEditor)}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){var _class14;Object.defineProperty(exports,"__esModule",{value:true});exports.KeyboardManager=exports.CommandManager=exports.ColorManager=exports.AnnotationEditorUIManager=void 0;exports.bindEvents=bindEvents;exports.opacityToHex=opacityToHex;var _util=__w_pdfjs_require__(1);var _display_utils=__w_pdfjs_require__(6);function bindEvents(obj,element,names){var _iterator29=_createForOfIteratorHelper(names),_step29;try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var _name6=_step29.value;element.addEventListener(_name6,obj[_name6].bind(obj))}}catch(err){_iterator29.e(err)}finally{_iterator29.f()}}function opacityToHex(opacity){return Math.round(Math.min(255,Math.max(1,255*opacity))).toString(16).padStart(2,"0")}var _id2=new WeakMap;var IdManager=function(){function IdManager(){_classCallCheck2(this,IdManager);_classPrivateFieldInitSpec(this,_id2,{writable:true,value:0})}_createClass2(IdManager,[{key:"getId",value:function getId(){var _this$id,_this$id2;return"".concat(_util.AnnotationEditorPrefix).concat((_classPrivateFieldSet(this,_id2,(_this$id=_classPrivateFieldGet(this,_id2),_this$id2=_this$id++,_this$id)),_this$id2))}}]);return IdManager}();var _baseId=new WeakMap;var _id3=new WeakMap;var _cache2=new WeakMap;var _get2=new WeakSet;var ImageManager=function(){function ImageManager(){_classCallCheck2(this,ImageManager);_classPrivateMethodInitSpec(this,_get2);_classPrivateFieldInitSpec(this,_baseId,{writable:true,value:(0,_util.getUuid)()});_classPrivateFieldInitSpec(this,_id3,{writable:true,value:0});_classPrivateFieldInitSpec(this,_cache2,{writable:true,value:null})}_createClass2(ImageManager,[{key:"getFromFile",value:function(){var _getFromFile=_asyncToGenerator(_regeneratorRuntime().mark(function _callee41(file){var lastModified,name,size,type;return _regeneratorRuntime().wrap(function _callee41$(_context42){while(1)switch(_context42.prev=_context42.next){case 0:lastModified=file.lastModified,name=file.name,size=file.size,type=file.type;return _context42.abrupt("return",_classPrivateMethodGet(this,_get2,_get3).call(this,"".concat(lastModified,"_").concat(name,"_").concat(size,"_").concat(type),file));case 2:case"end":return _context42.stop()}},_callee41,this)}));function getFromFile(_x48){return _getFromFile.apply(this,arguments)}return getFromFile}()},{key:"getFromUrl",value:function(){var _getFromUrl=_asyncToGenerator(_regeneratorRuntime().mark(function _callee42(url){return _regeneratorRuntime().wrap(function _callee42$(_context43){while(1)switch(_context43.prev=_context43.next){case 0:return _context43.abrupt("return",_classPrivateMethodGet(this,_get2,_get3).call(this,url,url));case 1:case"end":return _context43.stop()}},_callee42,this)}));function getFromUrl(_x49){return _getFromUrl.apply(this,arguments)}return getFromUrl}()},{key:"getFromId",value:function(){var _getFromId=_asyncToGenerator(_regeneratorRuntime().mark(function _callee43(id){var data;return _regeneratorRuntime().wrap(function _callee43$(_context44){while(1)switch(_context44.prev=_context44.next){case 0:_classPrivateFieldGet(this,_cache2)||_classPrivateFieldSet(this,_cache2,new Map);data=_classPrivateFieldGet(this,_cache2).get(id);if(data){_context44.next=4;break}return _context44.abrupt("return",null);case 4:if(!data.bitmap){_context44.next=7;break}data.refCounter+=1;return _context44.abrupt("return",data);case 7:if(!data.file){_context44.next=9;break}return _context44.abrupt("return",this.getFromFile(data.file));case 9:return _context44.abrupt("return",this.getFromUrl(data.url));case 10:case"end":return _context44.stop()}},_callee43,this)}));function getFromId(_x50){return _getFromId.apply(this,arguments)}return getFromId}()},{key:"getSvgUrl",value:function getSvgUrl(id){var data=_classPrivateFieldGet(this,_cache2).get(id);if(!(data!==null&&data!==void 0&&data.isSvg)){return null}return data.svgUrl}},{key:"deleteId",value:function deleteId(id){_classPrivateFieldGet(this,_cache2)||_classPrivateFieldSet(this,_cache2,new Map);var data=_classPrivateFieldGet(this,_cache2).get(id);if(!data){return}data.refCounter-=1;if(data.refCounter!==0){return}data.bitmap=null}},{key:"isValidId",value:function isValidId(id){return id.startsWith("image_".concat(_classPrivateFieldGet(this,_baseId),"_"))}}],[{key:"_isSVGFittingCanvas",get:function get(){var svg="data:image/svg+xml;charset=UTF-8,<svg viewBox=\"0 0 1 1\" width=\"1\" height=\"1\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"1\" height=\"1\" style=\"fill:red;\"/></svg>";var canvas=new OffscreenCanvas(1,3);var ctx=canvas.getContext("2d");var image=new Image;image.src=svg;var promise=image.decode().then(function(){ctx.drawImage(image,0,0,1,1,0,0,1,3);return new Uint32Array(ctx.getImageData(0,0,1,1).data.buffer)[0]===0});return(0,_util.shadow)(this,"_isSVGFittingCanvas",promise)}}]);return ImageManager}();_class14=ImageManager;function _get3(_x51,_x52){return _get4.apply(this,arguments)}function _get4(){_get4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee45(key,rawData){var _data3;var data,_this$id3,_this$id4,image,response,mustRemoveAspectRatioPromise,fileReader,imageElement,imagePromise;return _regeneratorRuntime().wrap(function _callee45$(_context46){while(1)switch(_context46.prev=_context46.next){case 0:_classPrivateFieldGet(this,_cache2)||_classPrivateFieldSet(this,_cache2,new Map);data=_classPrivateFieldGet(this,_cache2).get(key);if(!(data===null)){_context46.next=4;break}return _context46.abrupt("return",null);case 4:if(!((_data3=data)!==null&&_data3!==void 0&&_data3.bitmap)){_context46.next=7;break}data.refCounter+=1;return _context46.abrupt("return",data);case 7:_context46.prev=7;data||(data={bitmap:null,id:"image_".concat(_classPrivateFieldGet(this,_baseId),"_").concat((_classPrivateFieldSet(this,_id3,(_this$id3=_classPrivateFieldGet(this,_id3),_this$id4=_this$id3++,_this$id3)),_this$id4)),refCounter:0,isSvg:false});if(!(typeof rawData==="string")){_context46.next=21;break}data.url=rawData;_context46.next=13;return fetch(rawData);case 13:response=_context46.sent;if(response.ok){_context46.next=16;break}throw new Error(response.statusText);case 16:_context46.next=18;return response.blob();case 18:image=_context46.sent;_context46.next=22;break;case 21:image=data.file=rawData;case 22:if(!(image.type==="image/svg+xml")){_context46.next=32;break}mustRemoveAspectRatioPromise=_class14._isSVGFittingCanvas;fileReader=new FileReader;imageElement=new Image;imagePromise=new Promise(function(resolve,reject){imageElement.onload=function(){data.bitmap=imageElement;data.isSvg=true;resolve()};fileReader.onload=_asyncToGenerator(_regeneratorRuntime().mark(function _callee44(){var url;return _regeneratorRuntime().wrap(function _callee44$(_context45){while(1)switch(_context45.prev=_context45.next){case 0:url=data.svgUrl=fileReader.result;_context45.next=3;return mustRemoveAspectRatioPromise;case 3:if(!_context45.sent){_context45.next=7;break}_context45.t0="".concat(url,"#svgView(preserveAspectRatio(none))");_context45.next=8;break;case 7:_context45.t0=url;case 8:imageElement.src=_context45.t0;case 9:case"end":return _context45.stop()}},_callee44)}));imageElement.onerror=fileReader.onerror=reject});fileReader.readAsDataURL(image);_context46.next=30;return imagePromise;case 30:_context46.next=35;break;case 32:_context46.next=34;return createImageBitmap(image);case 34:data.bitmap=_context46.sent;case 35:data.refCounter=1;_context46.next=42;break;case 38:_context46.prev=38;_context46.t0=_context46["catch"](7);console.error(_context46.t0);data=null;case 42:_classPrivateFieldGet(this,_cache2).set(key,data);if(data){_classPrivateFieldGet(this,_cache2).set(data.id,data)}return _context46.abrupt("return",data);case 45:case"end":return _context46.stop()}},_callee45,this,[[7,38]])}));return _get4.apply(this,arguments)}var _commands=new WeakMap;var _locked=new WeakMap;var _maxSize=new WeakMap;var _position=new WeakMap;var CommandManager=function(){function CommandManager(){var maxSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:128;_classCallCheck2(this,CommandManager);_classPrivateFieldInitSpec(this,_commands,{writable:true,value:[]});_classPrivateFieldInitSpec(this,_locked,{writable:true,value:false});_classPrivateFieldInitSpec(this,_maxSize,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_position,{writable:true,value:-1});_classPrivateFieldSet(this,_maxSize,maxSize)}_createClass2(CommandManager,[{key:"add",value:function add(_ref42){var cmd=_ref42.cmd,undo=_ref42.undo,mustExec=_ref42.mustExec,_ref42$type=_ref42.type,type=_ref42$type===void 0?NaN:_ref42$type,_ref42$overwriteIfSam=_ref42.overwriteIfSameType,overwriteIfSameType=_ref42$overwriteIfSam===void 0?false:_ref42$overwriteIfSam,_ref42$keepUndo=_ref42.keepUndo,keepUndo=_ref42$keepUndo===void 0?false:_ref42$keepUndo;if(mustExec){cmd()}if(_classPrivateFieldGet(this,_locked)){return}var save={cmd:cmd,undo:undo,type:type};if(_classPrivateFieldGet(this,_position)===-1){if(_classPrivateFieldGet(this,_commands).length>0){_classPrivateFieldGet(this,_commands).length=0}_classPrivateFieldSet(this,_position,0);_classPrivateFieldGet(this,_commands).push(save);return}if(overwriteIfSameType&&_classPrivateFieldGet(this,_commands)[_classPrivateFieldGet(this,_position)].type===type){if(keepUndo){save.undo=_classPrivateFieldGet(this,_commands)[_classPrivateFieldGet(this,_position)].undo}_classPrivateFieldGet(this,_commands)[_classPrivateFieldGet(this,_position)]=save;return}var next=_classPrivateFieldGet(this,_position)+1;if(next===_classPrivateFieldGet(this,_maxSize)){_classPrivateFieldGet(this,_commands).splice(0,1)}else{_classPrivateFieldSet(this,_position,next);if(next<_classPrivateFieldGet(this,_commands).length){_classPrivateFieldGet(this,_commands).splice(next)}}_classPrivateFieldGet(this,_commands).push(save)}},{key:"undo",value:function undo(){if(_classPrivateFieldGet(this,_position)===-1){return}_classPrivateFieldSet(this,_locked,true);_classPrivateFieldGet(this,_commands)[_classPrivateFieldGet(this,_position)].undo();_classPrivateFieldSet(this,_locked,false);_classPrivateFieldSet(this,_position,_classPrivateFieldGet(this,_position)-1)}},{key:"redo",value:function redo(){if(_classPrivateFieldGet(this,_position)<_classPrivateFieldGet(this,_commands).length-1){_classPrivateFieldSet(this,_position,_classPrivateFieldGet(this,_position)+1);_classPrivateFieldSet(this,_locked,true);_classPrivateFieldGet(this,_commands)[_classPrivateFieldGet(this,_position)].cmd();_classPrivateFieldSet(this,_locked,false)}}},{key:"hasSomethingToUndo",value:function hasSomethingToUndo(){return _classPrivateFieldGet(this,_position)!==-1}},{key:"hasSomethingToRedo",value:function hasSomethingToRedo(){return _classPrivateFieldGet(this,_position)<_classPrivateFieldGet(this,_commands).length-1}},{key:"destroy",value:function destroy(){_classPrivateFieldSet(this,_commands,null)}}]);return CommandManager}();exports.CommandManager=CommandManager;var _serialize=new WeakSet;var KeyboardManager=function(){function KeyboardManager(callbacks){_classCallCheck2(this,KeyboardManager);_classPrivateMethodInitSpec(this,_serialize);this.buffer=[];this.callbacks=new Map;this.allKeys=new Set;var isMac=_util.FeatureTest.platform.isMac;var _iterator30=_createForOfIteratorHelper(callbacks),_step30;try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var _step30$value=_slicedToArray2(_step30.value,3),_keys=_step30$value[0],callback=_step30$value[1],_step30$value$=_step30$value[2],options=_step30$value$===void 0?{}:_step30$value$;var _iterator31=_createForOfIteratorHelper(_keys),_step31;try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var key=_step31.value;var isMacKey=key.startsWith("mac+");if(isMac&&isMacKey){this.callbacks.set(key.slice(4),{callback:callback,options:options});this.allKeys.add(key.split("+").at(-1))}else if(!isMac&&!isMacKey){this.callbacks.set(key,{callback:callback,options:options});this.allKeys.add(key.split("+").at(-1))}}}catch(err){_iterator31.e(err)}finally{_iterator31.f()}}}catch(err){_iterator30.e(err)}finally{_iterator30.f()}}_createClass2(KeyboardManager,[{key:"exec",value:function exec(self,event){if(!this.allKeys.has(event.key)){return}var info=this.callbacks.get(_classPrivateMethodGet(this,_serialize,_serialize2).call(this,event));if(!info){return}var callback=info.callback,_info$options=info.options,_info$options$bubbles=_info$options.bubbles,bubbles=_info$options$bubbles===void 0?false:_info$options$bubbles,_info$options$args=_info$options.args,args=_info$options$args===void 0?[]:_info$options$args,_info$options$checker=_info$options.checker,checker=_info$options$checker===void 0?null:_info$options$checker;if(checker&&!checker(self,event)){return}callback.bind.apply(callback,[self].concat(_toConsumableArray2(args)))();if(!bubbles){event.stopPropagation();event.preventDefault()}}}]);return KeyboardManager}();function _serialize2(event){if(event.altKey){this.buffer.push("alt")}if(event.ctrlKey){this.buffer.push("ctrl")}if(event.metaKey){this.buffer.push("meta")}if(event.shiftKey){this.buffer.push("shift")}this.buffer.push(event.key);var str=this.buffer.join("+");this.buffer.length=0;return str}exports.KeyboardManager=KeyboardManager;var ColorManager=function(){function ColorManager(){_classCallCheck2(this,ColorManager)}_createClass2(ColorManager,[{key:"_colors",get:function get(){var colors=new Map([["CanvasText",null],["Canvas",null]]);(0,_display_utils.getColorValues)(colors);return(0,_util.shadow)(this,"_colors",colors)}},{key:"convert",value:function convert(color){var rgb=(0,_display_utils.getRGB)(color);if(!window.matchMedia("(forced-colors: active)").matches){return rgb}var _iterator32=_createForOfIteratorHelper(this._colors),_step32;try{for(_iterator32.s();!(_step32=_iterator32.n()).done;){var _step32$value=_slicedToArray2(_step32.value,2),_name7=_step32$value[0],RGB=_step32$value[1];if(RGB.every(function(x,i){return x===rgb[i]})){return ColorManager._colorsMapping.get(_name7)}}}catch(err){_iterator32.e(err)}finally{_iterator32.f()}return rgb}},{key:"getHexCode",value:function getHexCode(name){var _util$Util;var rgb=this._colors.get(name);if(!rgb){return name}return(_util$Util=_util.Util).makeHexColor.apply(_util$Util,_toConsumableArray2(rgb))}}]);return ColorManager}();_defineProperty2(ColorManager,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));exports.ColorManager=ColorManager;var _activeEditor=new WeakMap;var _allEditors=new WeakMap;var _allLayers=new WeakMap;var _altTextManager=new WeakMap;var _annotationStorage=new WeakMap;var _commandManager=new WeakMap;var _currentPageIndex=new WeakMap;var _deletedAnnotationsElementIds=new WeakMap;var _draggingEditors=new WeakMap;var _editorTypes=new WeakMap;var _editorsToRescale=new WeakMap;var _filterFactory=new WeakMap;var _idManager=new WeakMap;var _isEnabled=new WeakMap;var _isWaiting=new WeakMap;var _lastActiveElement=new WeakMap;var _mode=new WeakMap;var _selectedEditors=new WeakMap;var _pageColors=new WeakMap;var _boundBlur=new WeakMap;var _boundFocus=new WeakMap;var _boundCopy=new WeakMap;var _boundCut=new WeakMap;var _boundPaste=new WeakMap;var _boundKeydown=new WeakMap;var _boundOnEditingAction=new WeakMap;var _boundOnPageChanging=new WeakMap;var _boundOnScaleChanging=new WeakMap;var _boundOnRotationChanging=new WeakMap;var _previousStates=new WeakMap;var _translation=new WeakMap;var _translationTimeoutId=new WeakMap;var _container=new WeakMap;var _viewer=new WeakMap;var _addFocusManager=new WeakSet;var _removeFocusManager=new WeakSet;var _addKeyboardManager=new WeakSet;var _removeKeyboardManager=new WeakSet;var _addCopyPasteListeners=new WeakSet;var _removeCopyPasteListeners=new WeakSet;var _dispatchUpdateStates=new WeakSet;var _dispatchUpdateUI=new WeakSet;var _enableAll=new WeakSet;var _disableAll=new WeakSet;var _addEditorToLayer=new WeakSet;var _isEmpty=new WeakSet;var _selectEditors=new WeakSet;var AnnotationEditorUIManager=function(){function AnnotationEditorUIManager(container,viewer,altTextManager,eventBus,pdfDocument,pageColors){_classCallCheck2(this,AnnotationEditorUIManager);_classPrivateMethodInitSpec(this,_selectEditors);_classPrivateMethodInitSpec(this,_isEmpty);_classPrivateMethodInitSpec(this,_addEditorToLayer);_classPrivateMethodInitSpec(this,_disableAll);_classPrivateMethodInitSpec(this,_enableAll);_classPrivateMethodInitSpec(this,_dispatchUpdateUI);_classPrivateMethodInitSpec(this,_dispatchUpdateStates);_classPrivateMethodInitSpec(this,_removeCopyPasteListeners);_classPrivateMethodInitSpec(this,_addCopyPasteListeners);_classPrivateMethodInitSpec(this,_removeKeyboardManager);_classPrivateMethodInitSpec(this,_addKeyboardManager);_classPrivateMethodInitSpec(this,_removeFocusManager);_classPrivateMethodInitSpec(this,_addFocusManager);_classPrivateFieldInitSpec(this,_activeEditor,{writable:true,value:null});_classPrivateFieldInitSpec(this,_allEditors,{writable:true,value:new Map});_classPrivateFieldInitSpec(this,_allLayers,{writable:true,value:new Map});_classPrivateFieldInitSpec(this,_altTextManager,{writable:true,value:null});_classPrivateFieldInitSpec(this,_annotationStorage,{writable:true,value:null});_classPrivateFieldInitSpec(this,_commandManager,{writable:true,value:new CommandManager});_classPrivateFieldInitSpec(this,_currentPageIndex,{writable:true,value:0});_classPrivateFieldInitSpec(this,_deletedAnnotationsElementIds,{writable:true,value:new Set});_classPrivateFieldInitSpec(this,_draggingEditors,{writable:true,value:null});_classPrivateFieldInitSpec(this,_editorTypes,{writable:true,value:null});_classPrivateFieldInitSpec(this,_editorsToRescale,{writable:true,value:new Set});_classPrivateFieldInitSpec(this,_filterFactory,{writable:true,value:null});_classPrivateFieldInitSpec(this,_idManager,{writable:true,value:new IdManager});_classPrivateFieldInitSpec(this,_isEnabled,{writable:true,value:false});_classPrivateFieldInitSpec(this,_isWaiting,{writable:true,value:false});_classPrivateFieldInitSpec(this,_lastActiveElement,{writable:true,value:null});_classPrivateFieldInitSpec(this,_mode,{writable:true,value:_util.AnnotationEditorType.NONE});_classPrivateFieldInitSpec(this,_selectedEditors,{writable:true,value:new Set});_classPrivateFieldInitSpec(this,_pageColors,{writable:true,value:null});_classPrivateFieldInitSpec(this,_boundBlur,{writable:true,value:this.blur.bind(this)});_classPrivateFieldInitSpec(this,_boundFocus,{writable:true,value:this.focus.bind(this)});_classPrivateFieldInitSpec(this,_boundCopy,{writable:true,value:this.copy.bind(this)});_classPrivateFieldInitSpec(this,_boundCut,{writable:true,value:this.cut.bind(this)});_classPrivateFieldInitSpec(this,_boundPaste,{writable:true,value:this.paste.bind(this)});_classPrivateFieldInitSpec(this,_boundKeydown,{writable:true,value:this.keydown.bind(this)});_classPrivateFieldInitSpec(this,_boundOnEditingAction,{writable:true,value:this.onEditingAction.bind(this)});_classPrivateFieldInitSpec(this,_boundOnPageChanging,{writable:true,value:this.onPageChanging.bind(this)});_classPrivateFieldInitSpec(this,_boundOnScaleChanging,{writable:true,value:this.onScaleChanging.bind(this)});_classPrivateFieldInitSpec(this,_boundOnRotationChanging,{writable:true,value:this.onRotationChanging.bind(this)});_classPrivateFieldInitSpec(this,_previousStates,{writable:true,value:{isEditing:false,isEmpty:true,hasSomethingToUndo:false,hasSomethingToRedo:false,hasSelectedEditor:false}});_classPrivateFieldInitSpec(this,_translation,{writable:true,value:[0,0]});_classPrivateFieldInitSpec(this,_translationTimeoutId,{writable:true,value:null});_classPrivateFieldInitSpec(this,_container,{writable:true,value:null});_classPrivateFieldInitSpec(this,_viewer,{writable:true,value:null});_classPrivateFieldSet(this,_container,container);_classPrivateFieldSet(this,_viewer,viewer);_classPrivateFieldSet(this,_altTextManager,altTextManager);this._eventBus=eventBus;this._eventBus._on("editingaction",_classPrivateFieldGet(this,_boundOnEditingAction));this._eventBus._on("pagechanging",_classPrivateFieldGet(this,_boundOnPageChanging));this._eventBus._on("scalechanging",_classPrivateFieldGet(this,_boundOnScaleChanging));this._eventBus._on("rotationchanging",_classPrivateFieldGet(this,_boundOnRotationChanging));_classPrivateFieldSet(this,_annotationStorage,pdfDocument.annotationStorage);_classPrivateFieldSet(this,_filterFactory,pdfDocument.filterFactory);_classPrivateFieldSet(this,_pageColors,pageColors);this.viewParameters={realScale:_display_utils.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}_createClass2(AnnotationEditorUIManager,[{key:"destroy",value:function destroy(){_classPrivateMethodGet(this,_removeKeyboardManager,_removeKeyboardManager2).call(this);_classPrivateMethodGet(this,_removeFocusManager,_removeFocusManager2).call(this);this._eventBus._off("editingaction",_classPrivateFieldGet(this,_boundOnEditingAction));this._eventBus._off("pagechanging",_classPrivateFieldGet(this,_boundOnPageChanging));this._eventBus._off("scalechanging",_classPrivateFieldGet(this,_boundOnScaleChanging));this._eventBus._off("rotationchanging",_classPrivateFieldGet(this,_boundOnRotationChanging));var _iterator33=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allLayers).values()),_step33;try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){var _layer=_step33.value;_layer.destroy()}}catch(err){_iterator33.e(err)}finally{_iterator33.f()}_classPrivateFieldGet(this,_allLayers).clear();_classPrivateFieldGet(this,_allEditors).clear();_classPrivateFieldGet(this,_editorsToRescale).clear();_classPrivateFieldSet(this,_activeEditor,null);_classPrivateFieldGet(this,_selectedEditors).clear();_classPrivateFieldGet(this,_commandManager).destroy();_classPrivateFieldGet(this,_altTextManager).destroy()}},{key:"hcmFilter",get:function get(){return(0,_util.shadow)(this,"hcmFilter",_classPrivateFieldGet(this,_pageColors)?_classPrivateFieldGet(this,_filterFactory).addHCMFilter(_classPrivateFieldGet(this,_pageColors).foreground,_classPrivateFieldGet(this,_pageColors).background):"none")}},{key:"direction",get:function get(){return(0,_util.shadow)(this,"direction",getComputedStyle(_classPrivateFieldGet(this,_container)).direction)}},{key:"editAltText",value:function editAltText(editor){var _classPrivateFieldGet10;(_classPrivateFieldGet10=_classPrivateFieldGet(this,_altTextManager))===null||_classPrivateFieldGet10===void 0||_classPrivateFieldGet10.editAltText(this,editor)}},{key:"onPageChanging",value:function onPageChanging(_ref43){var pageNumber=_ref43.pageNumber;_classPrivateFieldSet(this,_currentPageIndex,pageNumber-1)}},{key:"focusMainContainer",value:function focusMainContainer(){_classPrivateFieldGet(this,_container).focus()}},{key:"findParent",value:function findParent(x,y){var _iterator34=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allLayers).values()),_step34;try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){var _layer2=_step34.value;var _layer2$div$getBoundi=_layer2.div.getBoundingClientRect(),layerX=_layer2$div$getBoundi.x,layerY=_layer2$div$getBoundi.y,width=_layer2$div$getBoundi.width,height=_layer2$div$getBoundi.height;if(x>=layerX&&x<=layerX+width&&y>=layerY&&y<=layerY+height){return _layer2}}}catch(err){_iterator34.e(err)}finally{_iterator34.f()}return null}},{key:"disableUserSelect",value:function disableUserSelect(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classPrivateFieldGet(this,_viewer).classList.toggle("noUserSelect",value)}},{key:"addShouldRescale",value:function addShouldRescale(editor){_classPrivateFieldGet(this,_editorsToRescale).add(editor)}},{key:"removeShouldRescale",value:function removeShouldRescale(editor){_classPrivateFieldGet(this,_editorsToRescale)["delete"](editor)}},{key:"onScaleChanging",value:function onScaleChanging(_ref44){var scale=_ref44.scale;this.commitOrRemove();this.viewParameters.realScale=scale*_display_utils.PixelsPerInch.PDF_TO_CSS_UNITS;var _iterator35=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editorsToRescale)),_step35;try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var editor=_step35.value;editor.onScaleChanging()}}catch(err){_iterator35.e(err)}finally{_iterator35.f()}}},{key:"onRotationChanging",value:function onRotationChanging(_ref45){var pagesRotation=_ref45.pagesRotation;this.commitOrRemove();this.viewParameters.rotation=pagesRotation}},{key:"addToAnnotationStorage",value:function addToAnnotationStorage(editor){if(!editor.isEmpty()&&_classPrivateFieldGet(this,_annotationStorage)&&!_classPrivateFieldGet(this,_annotationStorage).has(editor.id)){_classPrivateFieldGet(this,_annotationStorage).setValue(editor.id,editor)}}},{key:"blur",value:function blur(){if(!this.hasSelection){return}var _document2=document,activeElement=_document2.activeElement;var _iterator36=_createForOfIteratorHelper(_classPrivateFieldGet(this,_selectedEditors)),_step36;try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var editor=_step36.value;if(editor.div.contains(activeElement)){_classPrivateFieldSet(this,_lastActiveElement,[editor,activeElement]);editor._focusEventsAllowed=false;break}}}catch(err){_iterator36.e(err)}finally{_iterator36.f()}}},{key:"focus",value:function focus(){if(!_classPrivateFieldGet(this,_lastActiveElement)){return}var _classPrivateFieldGet11=_classPrivateFieldGet(this,_lastActiveElement),_classPrivateFieldGet12=_slicedToArray2(_classPrivateFieldGet11,2),lastEditor=_classPrivateFieldGet12[0],lastActiveElement=_classPrivateFieldGet12[1];_classPrivateFieldSet(this,_lastActiveElement,null);lastActiveElement.addEventListener("focusin",function(){lastEditor._focusEventsAllowed=true},{once:true});lastActiveElement.focus()}},{key:"addEditListeners",value:function addEditListeners(){_classPrivateMethodGet(this,_addKeyboardManager,_addKeyboardManager2).call(this);_classPrivateMethodGet(this,_addCopyPasteListeners,_addCopyPasteListeners2).call(this)}},{key:"removeEditListeners",value:function removeEditListeners(){_classPrivateMethodGet(this,_removeKeyboardManager,_removeKeyboardManager2).call(this);_classPrivateMethodGet(this,_removeCopyPasteListeners,_removeCopyPasteListeners2).call(this)}},{key:"copy",value:function copy(event){var _classPrivateFieldGet13;event.preventDefault();(_classPrivateFieldGet13=_classPrivateFieldGet(this,_activeEditor))===null||_classPrivateFieldGet13===void 0||_classPrivateFieldGet13.commitOrRemove();if(!this.hasSelection){return}var editors=[];var _iterator37=_createForOfIteratorHelper(_classPrivateFieldGet(this,_selectedEditors)),_step37;try{for(_iterator37.s();!(_step37=_iterator37.n()).done;){var editor=_step37.value;var serialized=editor.serialize(true);if(serialized){editors.push(serialized)}}}catch(err){_iterator37.e(err)}finally{_iterator37.f()}if(editors.length===0){return}event.clipboardData.setData("application/pdfjs",JSON.stringify(editors))}},{key:"cut",value:function cut(event){this.copy(event);this["delete"]()}},{key:"paste",value:function paste(event){var _this68=this;event.preventDefault();var clipboardData=event.clipboardData;var _iterator38=_createForOfIteratorHelper(clipboardData.items),_step38;try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var item=_step38.value;var _iterator40=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editorTypes)),_step40;try{for(_iterator40.s();!(_step40=_iterator40.n()).done;){var editorType=_step40.value;if(editorType.isHandlingMimeForPasting(item.type)){editorType.paste(item,this.currentLayer);return}}}catch(err){_iterator40.e(err)}finally{_iterator40.f()}}}catch(err){_iterator38.e(err)}finally{_iterator38.f()}var data=clipboardData.getData("application/pdfjs");if(!data){return}try{data=JSON.parse(data)}catch(ex){(0,_util.warn)("paste: \"".concat(ex.message,"\"."));return}if(!Array.isArray(data)){return}this.unselectAll();var layer=this.currentLayer;try{var newEditors=[];var _iterator39=_createForOfIteratorHelper(data),_step39;try{for(_iterator39.s();!(_step39=_iterator39.n()).done;){var editor=_step39.value;var deserializedEditor=layer.deserialize(editor);if(!deserializedEditor){return}newEditors.push(deserializedEditor)}}catch(err){_iterator39.e(err)}finally{_iterator39.f()}var _cmd=function _cmd(){for(var _i14=0,_newEditors=newEditors;_i14<_newEditors.length;_i14++){var editor=_newEditors[_i14];_classPrivateMethodGet(_this68,_addEditorToLayer,_addEditorToLayer2).call(_this68,editor)}_classPrivateMethodGet(_this68,_selectEditors,_selectEditors2).call(_this68,newEditors)};var _undo=function _undo(){for(var _i15=0,_newEditors2=newEditors;_i15<_newEditors2.length;_i15++){var editor=_newEditors2[_i15];editor.remove()}};this.addCommands({cmd:_cmd,undo:_undo,mustExec:true})}catch(ex){(0,_util.warn)("paste: \"".concat(ex.message,"\"."))}}},{key:"keydown",value:function keydown(event){var _this$getActive;if(!((_this$getActive=this.getActive())!==null&&_this$getActive!==void 0&&_this$getActive.shouldGetKeyboardEvents())){AnnotationEditorUIManager._keyboardManager.exec(this,event)}}},{key:"onEditingAction",value:function onEditingAction(details){if(["undo","redo","delete","selectAll"].includes(details.name)){this[details.name]()}}},{key:"setEditingState",value:function setEditingState(isEditing){if(isEditing){_classPrivateMethodGet(this,_addFocusManager,_addFocusManager2).call(this);_classPrivateMethodGet(this,_addKeyboardManager,_addKeyboardManager2).call(this);_classPrivateMethodGet(this,_addCopyPasteListeners,_addCopyPasteListeners2).call(this);_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{isEditing:_classPrivateFieldGet(this,_mode)!==_util.AnnotationEditorType.NONE,isEmpty:_classPrivateMethodGet(this,_isEmpty,_isEmpty2).call(this),hasSomethingToUndo:_classPrivateFieldGet(this,_commandManager).hasSomethingToUndo(),hasSomethingToRedo:_classPrivateFieldGet(this,_commandManager).hasSomethingToRedo(),hasSelectedEditor:false})}else{_classPrivateMethodGet(this,_removeFocusManager,_removeFocusManager2).call(this);_classPrivateMethodGet(this,_removeKeyboardManager,_removeKeyboardManager2).call(this);_classPrivateMethodGet(this,_removeCopyPasteListeners,_removeCopyPasteListeners2).call(this);_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{isEditing:false});this.disableUserSelect(false)}}},{key:"registerEditorTypes",value:function registerEditorTypes(types){if(_classPrivateFieldGet(this,_editorTypes)){return}_classPrivateFieldSet(this,_editorTypes,types);var _iterator41=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editorTypes)),_step41;try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var editorType=_step41.value;_classPrivateMethodGet(this,_dispatchUpdateUI,_dispatchUpdateUI2).call(this,editorType.defaultPropertiesToUpdate)}}catch(err){_iterator41.e(err)}finally{_iterator41.f()}}},{key:"getId",value:function getId(){return _classPrivateFieldGet(this,_idManager).getId()}},{key:"currentLayer",get:function get(){return _classPrivateFieldGet(this,_allLayers).get(_classPrivateFieldGet(this,_currentPageIndex))}},{key:"getLayer",value:function getLayer(pageIndex){return _classPrivateFieldGet(this,_allLayers).get(pageIndex)}},{key:"currentPageIndex",get:function get(){return _classPrivateFieldGet(this,_currentPageIndex)}},{key:"addLayer",value:function addLayer(layer){_classPrivateFieldGet(this,_allLayers).set(layer.pageIndex,layer);if(_classPrivateFieldGet(this,_isEnabled)){layer.enable()}else{layer.disable()}}},{key:"removeLayer",value:function removeLayer(layer){_classPrivateFieldGet(this,_allLayers)["delete"](layer.pageIndex)}},{key:"updateMode",value:function updateMode(mode){var editId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(_classPrivateFieldGet(this,_mode)===mode){return}_classPrivateFieldSet(this,_mode,mode);if(mode===_util.AnnotationEditorType.NONE){this.setEditingState(false);_classPrivateMethodGet(this,_disableAll,_disableAll2).call(this);return}this.setEditingState(true);_classPrivateMethodGet(this,_enableAll,_enableAll2).call(this);this.unselectAll();var _iterator42=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allLayers).values()),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var _layer3=_step42.value;_layer3.updateMode(mode)}}catch(err){_iterator42.e(err)}finally{_iterator42.f()}if(!editId){return}var _iterator43=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allEditors).values()),_step43;try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var editor=_step43.value;if(editor.annotationElementId===editId){this.setSelected(editor);editor.enterInEditMode();break}}}catch(err){_iterator43.e(err)}finally{_iterator43.f()}}},{key:"updateToolbar",value:function updateToolbar(mode){if(mode===_classPrivateFieldGet(this,_mode)){return}this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:mode})}},{key:"updateParams",value:function updateParams(type,value){if(!_classPrivateFieldGet(this,_editorTypes)){return}if(type===_util.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(type);return}var _iterator44=_createForOfIteratorHelper(_classPrivateFieldGet(this,_selectedEditors)),_step44;try{for(_iterator44.s();!(_step44=_iterator44.n()).done;){var editor=_step44.value;editor.updateParams(type,value)}}catch(err){_iterator44.e(err)}finally{_iterator44.f()}var _iterator45=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editorTypes)),_step45;try{for(_iterator45.s();!(_step45=_iterator45.n()).done;){var editorType=_step45.value;editorType.updateDefaultParams(type,value)}}catch(err){_iterator45.e(err)}finally{_iterator45.f()}}},{key:"enableWaiting",value:function enableWaiting(){var mustWait=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(_classPrivateFieldGet(this,_isWaiting)===mustWait){return}_classPrivateFieldSet(this,_isWaiting,mustWait);var _iterator46=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allLayers).values()),_step46;try{for(_iterator46.s();!(_step46=_iterator46.n()).done;){var _layer4=_step46.value;if(mustWait){_layer4.disableClick()}else{_layer4.enableClick()}_layer4.div.classList.toggle("waiting",mustWait)}}catch(err){_iterator46.e(err)}finally{_iterator46.f()}}},{key:"getEditors",value:function getEditors(pageIndex){var editors=[];var _iterator47=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allEditors).values()),_step47;try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){var editor=_step47.value;if(editor.pageIndex===pageIndex){editors.push(editor)}}}catch(err){_iterator47.e(err)}finally{_iterator47.f()}return editors}},{key:"getEditor",value:function getEditor(id){return _classPrivateFieldGet(this,_allEditors).get(id)}},{key:"addEditor",value:function addEditor(editor){_classPrivateFieldGet(this,_allEditors).set(editor.id,editor)}},{key:"removeEditor",value:function removeEditor(editor){_classPrivateFieldGet(this,_allEditors)["delete"](editor.id);this.unselect(editor);if(!editor.annotationElementId||!_classPrivateFieldGet(this,_deletedAnnotationsElementIds).has(editor.annotationElementId)){var _classPrivateFieldGet14;(_classPrivateFieldGet14=_classPrivateFieldGet(this,_annotationStorage))===null||_classPrivateFieldGet14===void 0||_classPrivateFieldGet14.remove(editor.id)}}},{key:"addDeletedAnnotationElement",value:function addDeletedAnnotationElement(editor){_classPrivateFieldGet(this,_deletedAnnotationsElementIds).add(editor.annotationElementId);editor.deleted=true}},{key:"isDeletedAnnotationElement",value:function isDeletedAnnotationElement(annotationElementId){return _classPrivateFieldGet(this,_deletedAnnotationsElementIds).has(annotationElementId)}},{key:"removeDeletedAnnotationElement",value:function removeDeletedAnnotationElement(editor){_classPrivateFieldGet(this,_deletedAnnotationsElementIds)["delete"](editor.annotationElementId);editor.deleted=false}},{key:"setActiveEditor",value:function setActiveEditor(editor){if(_classPrivateFieldGet(this,_activeEditor)===editor){return}_classPrivateFieldSet(this,_activeEditor,editor);if(editor){_classPrivateMethodGet(this,_dispatchUpdateUI,_dispatchUpdateUI2).call(this,editor.propertiesToUpdate)}}},{key:"toggleSelected",value:function toggleSelected(editor){if(_classPrivateFieldGet(this,_selectedEditors).has(editor)){_classPrivateFieldGet(this,_selectedEditors)["delete"](editor);editor.unselect();_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSelectedEditor:this.hasSelection});return}_classPrivateFieldGet(this,_selectedEditors).add(editor);editor.select();_classPrivateMethodGet(this,_dispatchUpdateUI,_dispatchUpdateUI2).call(this,editor.propertiesToUpdate);_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSelectedEditor:true})}},{key:"setSelected",value:function setSelected(editor){var _iterator48=_createForOfIteratorHelper(_classPrivateFieldGet(this,_selectedEditors)),_step48;try{for(_iterator48.s();!(_step48=_iterator48.n()).done;){var ed=_step48.value;if(ed!==editor){ed.unselect()}}}catch(err){_iterator48.e(err)}finally{_iterator48.f()}_classPrivateFieldGet(this,_selectedEditors).clear();_classPrivateFieldGet(this,_selectedEditors).add(editor);editor.select();_classPrivateMethodGet(this,_dispatchUpdateUI,_dispatchUpdateUI2).call(this,editor.propertiesToUpdate);_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSelectedEditor:true})}},{key:"isSelected",value:function isSelected(editor){return _classPrivateFieldGet(this,_selectedEditors).has(editor)}},{key:"unselect",value:function unselect(editor){editor.unselect();_classPrivateFieldGet(this,_selectedEditors)["delete"](editor);_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSelectedEditor:this.hasSelection})}},{key:"hasSelection",get:function get(){return _classPrivateFieldGet(this,_selectedEditors).size!==0}},{key:"undo",value:function undo(){_classPrivateFieldGet(this,_commandManager).undo();_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSomethingToUndo:_classPrivateFieldGet(this,_commandManager).hasSomethingToUndo(),hasSomethingToRedo:true,isEmpty:_classPrivateMethodGet(this,_isEmpty,_isEmpty2).call(this)})}},{key:"redo",value:function redo(){_classPrivateFieldGet(this,_commandManager).redo();_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSomethingToUndo:true,hasSomethingToRedo:_classPrivateFieldGet(this,_commandManager).hasSomethingToRedo(),isEmpty:_classPrivateMethodGet(this,_isEmpty,_isEmpty2).call(this)})}},{key:"addCommands",value:function addCommands(params){_classPrivateFieldGet(this,_commandManager).add(params);_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSomethingToUndo:true,hasSomethingToRedo:false,isEmpty:_classPrivateMethodGet(this,_isEmpty,_isEmpty2).call(this)})}},{key:"delete",value:function _delete(){var _this69=this;this.commitOrRemove();if(!this.hasSelection){return}var editors=_toConsumableArray2(_classPrivateFieldGet(this,_selectedEditors));var cmd=function cmd(){var _iterator49=_createForOfIteratorHelper(editors),_step49;try{for(_iterator49.s();!(_step49=_iterator49.n()).done;){var editor=_step49.value;editor.remove()}}catch(err){_iterator49.e(err)}finally{_iterator49.f()}};var undo=function undo(){var _iterator50=_createForOfIteratorHelper(editors),_step50;try{for(_iterator50.s();!(_step50=_iterator50.n()).done;){var editor=_step50.value;_classPrivateMethodGet(_this69,_addEditorToLayer,_addEditorToLayer2).call(_this69,editor)}}catch(err){_iterator50.e(err)}finally{_iterator50.f()}};this.addCommands({cmd:cmd,undo:undo,mustExec:true})}},{key:"commitOrRemove",value:function commitOrRemove(){var _classPrivateFieldGet15;(_classPrivateFieldGet15=_classPrivateFieldGet(this,_activeEditor))===null||_classPrivateFieldGet15===void 0||_classPrivateFieldGet15.commitOrRemove()}},{key:"hasSomethingToControl",value:function hasSomethingToControl(){return _classPrivateFieldGet(this,_activeEditor)||this.hasSelection}},{key:"selectAll",value:function selectAll(){var _iterator51=_createForOfIteratorHelper(_classPrivateFieldGet(this,_selectedEditors)),_step51;try{for(_iterator51.s();!(_step51=_iterator51.n()).done;){var editor=_step51.value;editor.commit()}}catch(err){_iterator51.e(err)}finally{_iterator51.f()}_classPrivateMethodGet(this,_selectEditors,_selectEditors2).call(this,_classPrivateFieldGet(this,_allEditors).values())}},{key:"unselectAll",value:function unselectAll(){if(_classPrivateFieldGet(this,_activeEditor)){_classPrivateFieldGet(this,_activeEditor).commitOrRemove();return}if(!this.hasSelection){return}var _iterator52=_createForOfIteratorHelper(_classPrivateFieldGet(this,_selectedEditors)),_step52;try{for(_iterator52.s();!(_step52=_iterator52.n()).done;){var editor=_step52.value;editor.unselect()}}catch(err){_iterator52.e(err)}finally{_iterator52.f()}_classPrivateFieldGet(this,_selectedEditors).clear();_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSelectedEditor:false})}},{key:"translateSelectedEditors",value:function translateSelectedEditors(x,y){var _this70=this;var noCommit=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!noCommit){this.commitOrRemove()}if(!this.hasSelection){return}_classPrivateFieldGet(this,_translation)[0]+=x;_classPrivateFieldGet(this,_translation)[1]+=y;var _classPrivateFieldGet16=_classPrivateFieldGet(this,_translation),_classPrivateFieldGet17=_slicedToArray2(_classPrivateFieldGet16,2),totalX=_classPrivateFieldGet17[0],totalY=_classPrivateFieldGet17[1];var editors=_toConsumableArray2(_classPrivateFieldGet(this,_selectedEditors));var TIME_TO_WAIT=1000;if(_classPrivateFieldGet(this,_translationTimeoutId)){clearTimeout(_classPrivateFieldGet(this,_translationTimeoutId))}_classPrivateFieldSet(this,_translationTimeoutId,setTimeout(function(){_classPrivateFieldSet(_this70,_translationTimeoutId,null);_classPrivateFieldGet(_this70,_translation)[0]=_classPrivateFieldGet(_this70,_translation)[1]=0;_this70.addCommands({cmd:function cmd(){var _iterator53=_createForOfIteratorHelper(editors),_step53;try{for(_iterator53.s();!(_step53=_iterator53.n()).done;){var editor=_step53.value;if(_classPrivateFieldGet(_this70,_allEditors).has(editor.id)){editor.translateInPage(totalX,totalY)}}}catch(err){_iterator53.e(err)}finally{_iterator53.f()}},undo:function undo(){var _iterator54=_createForOfIteratorHelper(editors),_step54;try{for(_iterator54.s();!(_step54=_iterator54.n()).done;){var editor=_step54.value;if(_classPrivateFieldGet(_this70,_allEditors).has(editor.id)){editor.translateInPage(-totalX,-totalY)}}}catch(err){_iterator54.e(err)}finally{_iterator54.f()}},mustExec:false})},TIME_TO_WAIT));var _iterator55=_createForOfIteratorHelper(editors),_step55;try{for(_iterator55.s();!(_step55=_iterator55.n()).done;){var editor=_step55.value;editor.translateInPage(x,y)}}catch(err){_iterator55.e(err)}finally{_iterator55.f()}}},{key:"setUpDragSession",value:function setUpDragSession(){if(!this.hasSelection){return}this.disableUserSelect(true);_classPrivateFieldSet(this,_draggingEditors,new Map);var _iterator56=_createForOfIteratorHelper(_classPrivateFieldGet(this,_selectedEditors)),_step56;try{for(_iterator56.s();!(_step56=_iterator56.n()).done;){var editor=_step56.value;_classPrivateFieldGet(this,_draggingEditors).set(editor,{savedX:editor.x,savedY:editor.y,savedPageIndex:editor.pageIndex,newX:0,newY:0,newPageIndex:-1})}}catch(err){_iterator56.e(err)}finally{_iterator56.f()}}},{key:"endDragSession",value:function endDragSession(){var _this71=this;if(!_classPrivateFieldGet(this,_draggingEditors)){return false}this.disableUserSelect(false);var map=_classPrivateFieldGet(this,_draggingEditors);_classPrivateFieldSet(this,_draggingEditors,null);var mustBeAddedInUndoStack=false;var _iterator57=_createForOfIteratorHelper(map),_step57;try{for(_iterator57.s();!(_step57=_iterator57.n()).done;){var _step57$value=_slicedToArray2(_step57.value,2),_step57$value$=_step57$value[0],x=_step57$value$.x,y=_step57$value$.y,pageIndex=_step57$value$.pageIndex,value=_step57$value[1];value.newX=x;value.newY=y;value.newPageIndex=pageIndex;mustBeAddedInUndoStack||(mustBeAddedInUndoStack=x!==value.savedX||y!==value.savedY||pageIndex!==value.savedPageIndex)}}catch(err){_iterator57.e(err)}finally{_iterator57.f()}if(!mustBeAddedInUndoStack){return false}var move=function move(editor,x,y,pageIndex){if(_classPrivateFieldGet(_this71,_allEditors).has(editor.id)){var parent=_classPrivateFieldGet(_this71,_allLayers).get(pageIndex);if(parent){editor._setParentAndPosition(parent,x,y)}else{editor.pageIndex=pageIndex;editor.x=x;editor.y=y}}};this.addCommands({cmd:function cmd(){var _iterator58=_createForOfIteratorHelper(map),_step58;try{for(_iterator58.s();!(_step58=_iterator58.n()).done;){var _step58$value=_slicedToArray2(_step58.value,2),editor=_step58$value[0],_step58$value$=_step58$value[1],newX=_step58$value$.newX,newY=_step58$value$.newY,newPageIndex=_step58$value$.newPageIndex;move(editor,newX,newY,newPageIndex)}}catch(err){_iterator58.e(err)}finally{_iterator58.f()}},undo:function undo(){var _iterator59=_createForOfIteratorHelper(map),_step59;try{for(_iterator59.s();!(_step59=_iterator59.n()).done;){var _step59$value=_slicedToArray2(_step59.value,2),editor=_step59$value[0],_step59$value$=_step59$value[1],savedX=_step59$value$.savedX,savedY=_step59$value$.savedY,savedPageIndex=_step59$value$.savedPageIndex;move(editor,savedX,savedY,savedPageIndex)}}catch(err){_iterator59.e(err)}finally{_iterator59.f()}},mustExec:true});return true}},{key:"dragSelectedEditors",value:function dragSelectedEditors(tx,ty){if(!_classPrivateFieldGet(this,_draggingEditors)){return}var _iterator60=_createForOfIteratorHelper(_classPrivateFieldGet(this,_draggingEditors).keys()),_step60;try{for(_iterator60.s();!(_step60=_iterator60.n()).done;){var editor=_step60.value;editor.drag(tx,ty)}}catch(err){_iterator60.e(err)}finally{_iterator60.f()}}},{key:"rebuild",value:function rebuild(editor){if(editor.parent===null){var parent=this.getLayer(editor.pageIndex);if(parent){parent.changeParent(editor);parent.addOrRebuild(editor)}else{this.addEditor(editor);this.addToAnnotationStorage(editor);editor.rebuild()}}else{editor.parent.addOrRebuild(editor)}}},{key:"isActive",value:function isActive(editor){return _classPrivateFieldGet(this,_activeEditor)===editor}},{key:"getActive",value:function getActive(){return _classPrivateFieldGet(this,_activeEditor)}},{key:"getMode",value:function getMode(){return _classPrivateFieldGet(this,_mode)}},{key:"imageManager",get:function get(){return(0,_util.shadow)(this,"imageManager",new ImageManager)}}],[{key:"_keyboardManager",get:function get(){var proto=AnnotationEditorUIManager.prototype;var arrowChecker=function arrowChecker(self){var _document3=document,activeElement=_document3.activeElement;return activeElement&&_classPrivateFieldGet(self,_container).contains(activeElement)&&self.hasSomethingToControl()};var small=this.TRANSLATE_SMALL;var big=this.TRANSLATE_BIG;return(0,_util.shadow)(this,"_keyboardManager",new KeyboardManager([[["ctrl+a","mac+meta+a"],proto.selectAll],[["ctrl+z","mac+meta+z"],proto.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],proto.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],proto["delete"]],[["Escape","mac+Escape"],proto.unselectAll],[["ArrowLeft","mac+ArrowLeft"],proto.translateSelectedEditors,{args:[-small,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],proto.translateSelectedEditors,{args:[-big,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],proto.translateSelectedEditors,{args:[small,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],proto.translateSelectedEditors,{args:[big,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],proto.translateSelectedEditors,{args:[0,-small],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],proto.translateSelectedEditors,{args:[0,-big],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],proto.translateSelectedEditors,{args:[0,small],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],proto.translateSelectedEditors,{args:[0,big],checker:arrowChecker}]]))}}]);return AnnotationEditorUIManager}();function _addFocusManager2(){window.addEventListener("focus",_classPrivateFieldGet(this,_boundFocus));window.addEventListener("blur",_classPrivateFieldGet(this,_boundBlur))}function _removeFocusManager2(){window.removeEventListener("focus",_classPrivateFieldGet(this,_boundFocus));window.removeEventListener("blur",_classPrivateFieldGet(this,_boundBlur))}function _addKeyboardManager2(){window.addEventListener("keydown",_classPrivateFieldGet(this,_boundKeydown),{capture:true})}function _removeKeyboardManager2(){window.removeEventListener("keydown",_classPrivateFieldGet(this,_boundKeydown),{capture:true})}function _addCopyPasteListeners2(){document.addEventListener("copy",_classPrivateFieldGet(this,_boundCopy));document.addEventListener("cut",_classPrivateFieldGet(this,_boundCut));document.addEventListener("paste",_classPrivateFieldGet(this,_boundPaste))}function _removeCopyPasteListeners2(){document.removeEventListener("copy",_classPrivateFieldGet(this,_boundCopy));document.removeEventListener("cut",_classPrivateFieldGet(this,_boundCut));document.removeEventListener("paste",_classPrivateFieldGet(this,_boundPaste))}function _dispatchUpdateStates2(details){var _this72=this;var hasChanged=Object.entries(details).some(function(_ref46){var _ref47=_slicedToArray2(_ref46,2),key=_ref47[0],value=_ref47[1];return _classPrivateFieldGet(_this72,_previousStates)[key]!==value});if(hasChanged){this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(_classPrivateFieldGet(this,_previousStates),details)})}}function _dispatchUpdateUI2(details){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:details})}function _enableAll2(){if(!_classPrivateFieldGet(this,_isEnabled)){_classPrivateFieldSet(this,_isEnabled,true);var _iterator61=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allLayers).values()),_step61;try{for(_iterator61.s();!(_step61=_iterator61.n()).done;){var _layer5=_step61.value;_layer5.enable()}}catch(err){_iterator61.e(err)}finally{_iterator61.f()}}}function _disableAll2(){this.unselectAll();if(_classPrivateFieldGet(this,_isEnabled)){_classPrivateFieldSet(this,_isEnabled,false);var _iterator62=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allLayers).values()),_step62;try{for(_iterator62.s();!(_step62=_iterator62.n()).done;){var _layer6=_step62.value;_layer6.disable()}}catch(err){_iterator62.e(err)}finally{_iterator62.f()}}}function _addEditorToLayer2(editor){var layer=_classPrivateFieldGet(this,_allLayers).get(editor.pageIndex);if(layer){layer.addOrRebuild(editor)}else{this.addEditor(editor)}}function _isEmpty2(){if(_classPrivateFieldGet(this,_allEditors).size===0){return true}if(_classPrivateFieldGet(this,_allEditors).size===1){var _iterator63=_createForOfIteratorHelper(_classPrivateFieldGet(this,_allEditors).values()),_step63;try{for(_iterator63.s();!(_step63=_iterator63.n()).done;){var editor=_step63.value;return editor.isEmpty()}}catch(err){_iterator63.e(err)}finally{_iterator63.f()}}return false}function _selectEditors2(editors){_classPrivateFieldGet(this,_selectedEditors).clear();var _iterator64=_createForOfIteratorHelper(editors),_step64;try{for(_iterator64.s();!(_step64=_iterator64.n()).done;){var editor=_step64.value;if(editor.isEmpty()){continue}_classPrivateFieldGet(this,_selectedEditors).add(editor);editor.select()}}catch(err){_iterator64.e(err)}finally{_iterator64.f()}_classPrivateMethodGet(this,_dispatchUpdateStates,_dispatchUpdateStates2).call(this,{hasSelectedEditor:true})}_defineProperty2(AnnotationEditorUIManager,"TRANSLATE_SMALL",1);_defineProperty2(AnnotationEditorUIManager,"TRANSLATE_BIG",10);exports.AnnotationEditorUIManager=AnnotationEditorUIManager}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){var _class19;Object.defineProperty(exports,"__esModule",{value:true});exports.StatTimer=exports.RenderingCancelledException=exports.PixelsPerInch=exports.PageViewport=exports.PDFDateString=exports.DOMStandardFontDataFactory=exports.DOMSVGFactory=exports.DOMFilterFactory=exports.DOMCanvasFactory=exports.DOMCMapReaderFactory=void 0;exports.deprecated=deprecated;exports.getColorValues=getColorValues;exports.getCurrentTransform=getCurrentTransform;exports.getCurrentTransformInverse=getCurrentTransformInverse;exports.getFilenameFromUrl=getFilenameFromUrl;exports.getPdfFilenameFromUrl=getPdfFilenameFromUrl;exports.getRGB=getRGB;exports.getXfaPageViewport=getXfaPageViewport;exports.isDataScheme=isDataScheme;exports.isPdfFile=isPdfFile;exports.isValidFetchUrl=isValidFetchUrl;exports.loadScript=loadScript;exports.noContextMenu=noContextMenu;exports.setLayerDimensions=setLayerDimensions;var _base_factory=__w_pdfjs_require__(7);var _util=__w_pdfjs_require__(1);var SVG_NS="http://www.w3.org/2000/svg";var PixelsPerInch=_createClass2(function PixelsPerInch(){_classCallCheck2(this,PixelsPerInch)});_class19=PixelsPerInch;_defineProperty2(PixelsPerInch,"CSS",96);_defineProperty2(PixelsPerInch,"PDF",72);_defineProperty2(PixelsPerInch,"PDF_TO_CSS_UNITS",_class19.CSS/_class19.PDF);exports.PixelsPerInch=PixelsPerInch;var _cache3=new WeakMap;var _defs=new WeakMap;var _docId2=new WeakMap;var _document4=new WeakMap;var _hcmFilter=new WeakMap;var _hcmKey=new WeakMap;var _hcmUrl=new WeakMap;var _hcmHighlightFilter=new WeakMap;var _hcmHighlightKey=new WeakMap;var _hcmHighlightUrl=new WeakMap;var _id4=new WeakMap;var _cache4=new WeakMap;var _defs2=new WeakMap;var _addGrayConversion=new WeakSet;var _createFilter=new WeakSet;var _appendFeFunc=new WeakSet;var _addTransferMapConversion=new WeakSet;var _getRGB=new WeakSet;var DOMFilterFactory=function(_base_factory$BaseFil){_inherits2(DOMFilterFactory,_base_factory$BaseFil);var _super22=_createSuper(DOMFilterFactory);function DOMFilterFactory(){var _this73;var _ref49=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},docId=_ref49.docId,_ref49$ownerDocument=_ref49.ownerDocument,ownerDocument=_ref49$ownerDocument===void 0?globalThis.document:_ref49$ownerDocument;_classCallCheck2(this,DOMFilterFactory);_this73=_super22.call(this);_classPrivateMethodInitSpec(_assertThisInitialized(_this73),_getRGB);_classPrivateMethodInitSpec(_assertThisInitialized(_this73),_addTransferMapConversion);_classPrivateMethodInitSpec(_assertThisInitialized(_this73),_appendFeFunc);_classPrivateMethodInitSpec(_assertThisInitialized(_this73),_createFilter);_classPrivateMethodInitSpec(_assertThisInitialized(_this73),_addGrayConversion);_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_defs2,{get:_get_defs,set:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_cache4,{get:_get_cache,set:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_cache3,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_defs,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_docId2,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_document4,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_hcmFilter,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_hcmKey,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_hcmUrl,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_hcmHighlightFilter,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_hcmHighlightKey,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_hcmHighlightUrl,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this73),_id4,{writable:true,value:0});_classPrivateFieldSet(_assertThisInitialized(_this73),_docId2,docId);_classPrivateFieldSet(_assertThisInitialized(_this73),_document4,ownerDocument);return _this73}_createClass2(DOMFilterFactory,[{key:"addFilter",value:function addFilter(maps){var _this$id5,_this$id6;if(!maps){return"none"}var value=_classPrivateFieldGet(this,_cache4).get(maps);if(value){return value}var tableR,tableG,tableB,key;if(maps.length===1){var mapR=maps[0];var buffer=new Array(256);for(var _i16=0;_i16<256;_i16++){buffer[_i16]=mapR[_i16]/255}key=tableR=tableG=tableB=buffer.join(",")}else{var _maps=_slicedToArray2(maps,3),_mapR=_maps[0],mapG=_maps[1],mapB=_maps[2];var bufferR=new Array(256);var bufferG=new Array(256);var bufferB=new Array(256);for(var _i17=0;_i17<256;_i17++){bufferR[_i17]=_mapR[_i17]/255;bufferG[_i17]=mapG[_i17]/255;bufferB[_i17]=mapB[_i17]/255}tableR=bufferR.join(",");tableG=bufferG.join(",");tableB=bufferB.join(",");key="".concat(tableR).concat(tableG).concat(tableB)}value=_classPrivateFieldGet(this,_cache4).get(key);if(value){_classPrivateFieldGet(this,_cache4).set(maps,value);return value}var id="g_".concat(_classPrivateFieldGet(this,_docId2),"_transfer_map_").concat((_classPrivateFieldSet(this,_id4,(_this$id5=_classPrivateFieldGet(this,_id4),_this$id6=_this$id5++,_this$id5)),_this$id6));var url="url(#".concat(id,")");_classPrivateFieldGet(this,_cache4).set(maps,url);_classPrivateFieldGet(this,_cache4).set(key,url);var filter=_classPrivateMethodGet(this,_createFilter,_createFilter2).call(this,id);_classPrivateMethodGet(this,_addTransferMapConversion,_addTransferMapConversion2).call(this,tableR,tableG,tableB,filter);return url}},{key:"addHCMFilter",value:function addHCMFilter(fgColor,bgColor){var _classPrivateFieldGet18,_util$Util2,_util$Util3;var key="".concat(fgColor,"-").concat(bgColor);if(_classPrivateFieldGet(this,_hcmKey)===key){return _classPrivateFieldGet(this,_hcmUrl)}_classPrivateFieldSet(this,_hcmKey,key);_classPrivateFieldSet(this,_hcmUrl,"none");(_classPrivateFieldGet18=_classPrivateFieldGet(this,_hcmFilter))===null||_classPrivateFieldGet18===void 0||_classPrivateFieldGet18.remove();if(!fgColor||!bgColor){return _classPrivateFieldGet(this,_hcmUrl)}var fgRGB=_classPrivateMethodGet(this,_getRGB,_getRGB2).call(this,fgColor);fgColor=(_util$Util2=_util.Util).makeHexColor.apply(_util$Util2,_toConsumableArray2(fgRGB));var bgRGB=_classPrivateMethodGet(this,_getRGB,_getRGB2).call(this,bgColor);bgColor=(_util$Util3=_util.Util).makeHexColor.apply(_util$Util3,_toConsumableArray2(bgRGB));_classPrivateFieldGet(this,_defs2).style.color="";if(fgColor==="#000000"&&bgColor==="#ffffff"||fgColor===bgColor){return _classPrivateFieldGet(this,_hcmUrl)}var map=new Array(256);for(var _i18=0;_i18<=255;_i18++){var x=_i18/255;map[_i18]=x<=0.03928?x/12.92:Math.pow((x+0.055)/1.055,2.4)}var table=map.join(",");var id="g_".concat(_classPrivateFieldGet(this,_docId2),"_hcm_filter");var filter=_classPrivateFieldSet(this,_hcmHighlightFilter,_classPrivateMethodGet(this,_createFilter,_createFilter2).call(this,id));_classPrivateMethodGet(this,_addTransferMapConversion,_addTransferMapConversion2).call(this,table,table,table,filter);_classPrivateMethodGet(this,_addGrayConversion,_addGrayConversion2).call(this,filter);var getSteps=function getSteps(c,n){var start=fgRGB[c]/255;var end=bgRGB[c]/255;var arr=new Array(n+1);for(var _i19=0;_i19<=n;_i19++){arr[_i19]=start+_i19/n*(end-start)}return arr.join(",")};_classPrivateMethodGet(this,_addTransferMapConversion,_addTransferMapConversion2).call(this,getSteps(0,5),getSteps(1,5),getSteps(2,5),filter);_classPrivateFieldSet(this,_hcmUrl,"url(#".concat(id,")"));return _classPrivateFieldGet(this,_hcmUrl)}},{key:"addHighlightHCMFilter",value:function addHighlightHCMFilter(fgColor,bgColor,newFgColor,newBgColor){var _classPrivateFieldGet19;var key="".concat(fgColor,"-").concat(bgColor,"-").concat(newFgColor,"-").concat(newBgColor);if(_classPrivateFieldGet(this,_hcmHighlightKey)===key){return _classPrivateFieldGet(this,_hcmHighlightUrl)}_classPrivateFieldSet(this,_hcmHighlightKey,key);_classPrivateFieldSet(this,_hcmHighlightUrl,"none");(_classPrivateFieldGet19=_classPrivateFieldGet(this,_hcmHighlightFilter))===null||_classPrivateFieldGet19===void 0||_classPrivateFieldGet19.remove();if(!fgColor||!bgColor){return _classPrivateFieldGet(this,_hcmHighlightUrl)}var _map=[fgColor,bgColor].map(_classPrivateMethodGet(this,_getRGB,_getRGB2).bind(this)),_map2=_slicedToArray2(_map,2),fgRGB=_map2[0],bgRGB=_map2[1];var fgGray=Math.round(0.2126*fgRGB[0]+0.7152*fgRGB[1]+0.0722*fgRGB[2]);var bgGray=Math.round(0.2126*bgRGB[0]+0.7152*bgRGB[1]+0.0722*bgRGB[2]);var _map3=[newFgColor,newBgColor].map(_classPrivateMethodGet(this,_getRGB,_getRGB2).bind(this)),_map4=_slicedToArray2(_map3,2),newFgRGB=_map4[0],newBgRGB=_map4[1];if(bgGray<fgGray){var _ref50=[bgGray,fgGray,newBgRGB,newFgRGB];fgGray=_ref50[0];bgGray=_ref50[1];newFgRGB=_ref50[2];newBgRGB=_ref50[3]}_classPrivateFieldGet(this,_defs2).style.color="";var getSteps=function getSteps(fg,bg,n){var arr=new Array(256);var step=(bgGray-fgGray)/n;var newStart=fg/255;var newStep=(bg-fg)/(255*n);var prev=0;for(var _i20=0;_i20<=n;_i20++){var k=Math.round(fgGray+_i20*step);var value=newStart+_i20*newStep;for(var j=prev;j<=k;j++){arr[j]=value}prev=k+1}for(var _i21=prev;_i21<256;_i21++){arr[_i21]=arr[prev-1]}return arr.join(",")};var id="g_".concat(_classPrivateFieldGet(this,_docId2),"_hcm_highlight_filter");var filter=_classPrivateFieldSet(this,_hcmHighlightFilter,_classPrivateMethodGet(this,_createFilter,_createFilter2).call(this,id));_classPrivateMethodGet(this,_addGrayConversion,_addGrayConversion2).call(this,filter);_classPrivateMethodGet(this,_addTransferMapConversion,_addTransferMapConversion2).call(this,getSteps(newFgRGB[0],newBgRGB[0],5),getSteps(newFgRGB[1],newBgRGB[1],5),getSteps(newFgRGB[2],newBgRGB[2],5),filter);_classPrivateFieldSet(this,_hcmHighlightUrl,"url(#".concat(id,")"));return _classPrivateFieldGet(this,_hcmHighlightUrl)}},{key:"destroy",value:function destroy(){var keepHCM=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(keepHCM&&(_classPrivateFieldGet(this,_hcmUrl)||_classPrivateFieldGet(this,_hcmHighlightUrl))){return}if(_classPrivateFieldGet(this,_defs)){_classPrivateFieldGet(this,_defs).parentNode.parentNode.remove();_classPrivateFieldSet(this,_defs,null)}if(_classPrivateFieldGet(this,_cache3)){_classPrivateFieldGet(this,_cache3).clear();_classPrivateFieldSet(this,_cache3,null)}_classPrivateFieldSet(this,_id4,0)}}]);return DOMFilterFactory}(_base_factory.BaseFilterFactory);function _get_cache(){return _classPrivateFieldGet(this,_cache3)||_classPrivateFieldSet(this,_cache3,new Map)}function _get_defs(){if(!_classPrivateFieldGet(this,_defs)){var div=_classPrivateFieldGet(this,_document4).createElement("div");var style=div.style;style.visibility="hidden";style.contain="strict";style.width=style.height=0;style.position="absolute";style.top=style.left=0;style.zIndex=-1;var _svg=_classPrivateFieldGet(this,_document4).createElementNS(SVG_NS,"svg");_svg.setAttribute("width",0);_svg.setAttribute("height",0);_classPrivateFieldSet(this,_defs,_classPrivateFieldGet(this,_document4).createElementNS(SVG_NS,"defs"));div.append(_svg);_svg.append(_classPrivateFieldGet(this,_defs));_classPrivateFieldGet(this,_document4).body.append(div)}return _classPrivateFieldGet(this,_defs)}function _addGrayConversion2(filter){var feColorMatrix=_classPrivateFieldGet(this,_document4).createElementNS(SVG_NS,"feColorMatrix");feColorMatrix.setAttribute("type","matrix");feColorMatrix.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0");filter.append(feColorMatrix)}function _createFilter2(id){var filter=_classPrivateFieldGet(this,_document4).createElementNS(SVG_NS,"filter");filter.setAttribute("color-interpolation-filters","sRGB");filter.setAttribute("id",id);_classPrivateFieldGet(this,_defs2).append(filter);return filter}function _appendFeFunc2(feComponentTransfer,func,table){var feFunc=_classPrivateFieldGet(this,_document4).createElementNS(SVG_NS,func);feFunc.setAttribute("type","discrete");feFunc.setAttribute("tableValues",table);feComponentTransfer.append(feFunc)}function _addTransferMapConversion2(rTable,gTable,bTable,filter){var feComponentTransfer=_classPrivateFieldGet(this,_document4).createElementNS(SVG_NS,"feComponentTransfer");filter.append(feComponentTransfer);_classPrivateMethodGet(this,_appendFeFunc,_appendFeFunc2).call(this,feComponentTransfer,"feFuncR",rTable);_classPrivateMethodGet(this,_appendFeFunc,_appendFeFunc2).call(this,feComponentTransfer,"feFuncG",gTable);_classPrivateMethodGet(this,_appendFeFunc,_appendFeFunc2).call(this,feComponentTransfer,"feFuncB",bTable)}function _getRGB2(color){_classPrivateFieldGet(this,_defs2).style.color=color;return getRGB(getComputedStyle(_classPrivateFieldGet(this,_defs2)).getPropertyValue("color"))}exports.DOMFilterFactory=DOMFilterFactory;var DOMCanvasFactory=function(_base_factory$BaseCan){_inherits2(DOMCanvasFactory,_base_factory$BaseCan);var _super23=_createSuper(DOMCanvasFactory);function DOMCanvasFactory(){var _this74;var _ref51=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref51$ownerDocument=_ref51.ownerDocument,ownerDocument=_ref51$ownerDocument===void 0?globalThis.document:_ref51$ownerDocument;_classCallCheck2(this,DOMCanvasFactory);_this74=_super23.call(this);_this74._document=ownerDocument;return _this74}_createClass2(DOMCanvasFactory,[{key:"_createCanvas",value:function _createCanvas(width,height){var canvas=this._document.createElement("canvas");canvas.width=width;canvas.height=height;return canvas}}]);return DOMCanvasFactory}(_base_factory.BaseCanvasFactory);exports.DOMCanvasFactory=DOMCanvasFactory;function fetchData(_x53){return _fetchData.apply(this,arguments)}function _fetchData(){_fetchData=_asyncToGenerator(_regeneratorRuntime().mark(function _callee46(url){var asTypedArray,response,_args47=arguments;return _regeneratorRuntime().wrap(function _callee46$(_context47){while(1)switch(_context47.prev=_context47.next){case 0:asTypedArray=_args47.length>1&&_args47[1]!==undefined?_args47[1]:false;if(!isValidFetchUrl(url,document.baseURI)){_context47.next=21;break}_context47.next=4;return fetch(url);case 4:response=_context47.sent;if(response.ok){_context47.next=7;break}throw new Error(response.statusText);case 7:if(!asTypedArray){_context47.next=15;break}_context47.t1=Uint8Array;_context47.next=11;return response.arrayBuffer();case 11:_context47.t2=_context47.sent;_context47.t0=new _context47.t1(_context47.t2);_context47.next=20;break;case 15:_context47.t3=(0,_util.stringToBytes);_context47.next=18;return response.text();case 18:_context47.t4=_context47.sent;_context47.t0=(0,_context47.t3)(_context47.t4);case 20:return _context47.abrupt("return",_context47.t0);case 21:return _context47.abrupt("return",new Promise(function(resolve,reject){var request=new XMLHttpRequest;request.open("GET",url,true);if(asTypedArray){request.responseType="arraybuffer"}request.onreadystatechange=function(){if(request.readyState!==XMLHttpRequest.DONE){return}if(request.status===200||request.status===0){var _data4;if(asTypedArray&&request.response){_data4=new Uint8Array(request.response)}else if(!asTypedArray&&request.responseText){_data4=(0,_util.stringToBytes)(request.responseText)}if(_data4){resolve(_data4);return}}reject(new Error(request.statusText))};request.send(null)}));case 22:case"end":return _context47.stop()}},_callee46)}));return _fetchData.apply(this,arguments)}var DOMCMapReaderFactory=function(_base_factory$BaseCMa){_inherits2(DOMCMapReaderFactory,_base_factory$BaseCMa);var _super24=_createSuper(DOMCMapReaderFactory);function DOMCMapReaderFactory(){_classCallCheck2(this,DOMCMapReaderFactory);return _super24.apply(this,arguments)}_createClass2(DOMCMapReaderFactory,[{key:"_fetchData",value:function _fetchData(url,compressionType){return fetchData(url,this.isCompressed).then(function(data){return{cMapData:data,compressionType:compressionType}})}}]);return DOMCMapReaderFactory}(_base_factory.BaseCMapReaderFactory);exports.DOMCMapReaderFactory=DOMCMapReaderFactory;var DOMStandardFontDataFactory=function(_base_factory$BaseSta){_inherits2(DOMStandardFontDataFactory,_base_factory$BaseSta);var _super25=_createSuper(DOMStandardFontDataFactory);function DOMStandardFontDataFactory(){_classCallCheck2(this,DOMStandardFontDataFactory);return _super25.apply(this,arguments)}_createClass2(DOMStandardFontDataFactory,[{key:"_fetchData",value:function _fetchData(url){return fetchData(url,true)}}]);return DOMStandardFontDataFactory}(_base_factory.BaseStandardFontDataFactory);exports.DOMStandardFontDataFactory=DOMStandardFontDataFactory;var DOMSVGFactory=function(_base_factory$BaseSVG){_inherits2(DOMSVGFactory,_base_factory$BaseSVG);var _super26=_createSuper(DOMSVGFactory);function DOMSVGFactory(){_classCallCheck2(this,DOMSVGFactory);return _super26.apply(this,arguments)}_createClass2(DOMSVGFactory,[{key:"_createSVG",value:function _createSVG(type){return document.createElementNS(SVG_NS,type)}}]);return DOMSVGFactory}(_base_factory.BaseSVGFactory);exports.DOMSVGFactory=DOMSVGFactory;var PageViewport=function(){function PageViewport(_ref52){var viewBox=_ref52.viewBox,scale=_ref52.scale,rotation=_ref52.rotation,_ref52$offsetX=_ref52.offsetX,offsetX=_ref52$offsetX===void 0?0:_ref52$offsetX,_ref52$offsetY=_ref52.offsetY,offsetY=_ref52$offsetY===void 0?0:_ref52$offsetY,_ref52$dontFlip=_ref52.dontFlip,dontFlip=_ref52$dontFlip===void 0?false:_ref52$dontFlip;_classCallCheck2(this,PageViewport);this.viewBox=viewBox;this.scale=scale;this.rotation=rotation;this.offsetX=offsetX;this.offsetY=offsetY;var centerX=(viewBox[2]+viewBox[0])/2;var centerY=(viewBox[3]+viewBox[1])/2;var rotateA,rotateB,rotateC,rotateD;rotation%=360;if(rotation<0){rotation+=360}switch(rotation){case 180:rotateA=-1;rotateB=0;rotateC=0;rotateD=1;break;case 90:rotateA=0;rotateB=1;rotateC=1;rotateD=0;break;case 270:rotateA=0;rotateB=-1;rotateC=-1;rotateD=0;break;case 0:rotateA=1;rotateB=0;rotateC=0;rotateD=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}if(dontFlip){rotateC=-rotateC;rotateD=-rotateD}var offsetCanvasX,offsetCanvasY;var width,height;if(rotateA===0){offsetCanvasX=Math.abs(centerY-viewBox[1])*scale+offsetX;offsetCanvasY=Math.abs(centerX-viewBox[0])*scale+offsetY;width=(viewBox[3]-viewBox[1])*scale;height=(viewBox[2]-viewBox[0])*scale}else{offsetCanvasX=Math.abs(centerX-viewBox[0])*scale+offsetX;offsetCanvasY=Math.abs(centerY-viewBox[1])*scale+offsetY;width=(viewBox[2]-viewBox[0])*scale;height=(viewBox[3]-viewBox[1])*scale}this.transform=[rotateA*scale,rotateB*scale,rotateC*scale,rotateD*scale,offsetCanvasX-rotateA*scale*centerX-rotateC*scale*centerY,offsetCanvasY-rotateB*scale*centerX-rotateD*scale*centerY];this.width=width;this.height=height}_createClass2(PageViewport,[{key:"rawDims",get:function get(){var viewBox=this.viewBox;return(0,_util.shadow)(this,"rawDims",{pageWidth:viewBox[2]-viewBox[0],pageHeight:viewBox[3]-viewBox[1],pageX:viewBox[0],pageY:viewBox[1]})}},{key:"clone",value:function clone(){var _ref53=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref53$scale=_ref53.scale,scale=_ref53$scale===void 0?this.scale:_ref53$scale,_ref53$rotation=_ref53.rotation,rotation=_ref53$rotation===void 0?this.rotation:_ref53$rotation,_ref53$offsetX=_ref53.offsetX,offsetX=_ref53$offsetX===void 0?this.offsetX:_ref53$offsetX,_ref53$offsetY=_ref53.offsetY,offsetY=_ref53$offsetY===void 0?this.offsetY:_ref53$offsetY,_ref53$dontFlip=_ref53.dontFlip,dontFlip=_ref53$dontFlip===void 0?false:_ref53$dontFlip;return new PageViewport({viewBox:this.viewBox.slice(),scale:scale,rotation:rotation,offsetX:offsetX,offsetY:offsetY,dontFlip:dontFlip})}},{key:"convertToViewportPoint",value:function convertToViewportPoint(x,y){return _util.Util.applyTransform([x,y],this.transform)}},{key:"convertToViewportRectangle",value:function convertToViewportRectangle(rect){var topLeft=_util.Util.applyTransform([rect[0],rect[1]],this.transform);var bottomRight=_util.Util.applyTransform([rect[2],rect[3]],this.transform);return[topLeft[0],topLeft[1],bottomRight[0],bottomRight[1]]}},{key:"convertToPdfPoint",value:function convertToPdfPoint(x,y){return _util.Util.applyInverseTransform([x,y],this.transform)}}]);return PageViewport}();exports.PageViewport=PageViewport;var RenderingCancelledException=function(_util$BaseException){_inherits2(RenderingCancelledException,_util$BaseException);var _super27=_createSuper(RenderingCancelledException);function RenderingCancelledException(msg){var _this75;var extraDelay=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck2(this,RenderingCancelledException);_this75=_super27.call(this,msg,"RenderingCancelledException");_this75.extraDelay=extraDelay;return _this75}return _createClass2(RenderingCancelledException)}(_util.BaseException);exports.RenderingCancelledException=RenderingCancelledException;function isDataScheme(url){var ii=url.length;var i=0;while(i<ii&&url[i].trim()===""){i++}return url.substring(i,i+5).toLowerCase()==="data:"}function isPdfFile(filename){return typeof filename==="string"&&/\.pdf$/i.test(filename)}function getFilenameFromUrl(url){var onlyStripPath=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!onlyStripPath){var _url$split=url.split(/[#?]/,1);var _url$split2=_slicedToArray2(_url$split,1);url=_url$split2[0]}return url.substring(url.lastIndexOf("/")+1)}function getPdfFilenameFromUrl(url){var defaultFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"document.pdf";if(typeof url!=="string"){return defaultFilename}if(isDataScheme(url)){(0,_util.warn)("getPdfFilenameFromUrl: ignore \"data:\"-URL for performance reasons.");return defaultFilename}var reURI=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/;var reFilename=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i;var splitURI=reURI.exec(url);var suggestedFilename=reFilename.exec(splitURI[1])||reFilename.exec(splitURI[2])||reFilename.exec(splitURI[3]);if(suggestedFilename){suggestedFilename=suggestedFilename[0];if(suggestedFilename.includes("%")){try{suggestedFilename=reFilename.exec(decodeURIComponent(suggestedFilename))[0]}catch(_unused11){}}}return suggestedFilename||defaultFilename}var StatTimer=function(){function StatTimer(){_classCallCheck2(this,StatTimer);_defineProperty2(this,"started",Object.create(null));_defineProperty2(this,"times",[])}_createClass2(StatTimer,[{key:"time",value:function time(name){if(name in this.started){(0,_util.warn)("Timer is already running for ".concat(name))}this.started[name]=Date.now()}},{key:"timeEnd",value:function timeEnd(name){if(!(name in this.started)){(0,_util.warn)("Timer has not been started for ".concat(name))}this.times.push({name:name,start:this.started[name],end:Date.now()});delete this.started[name]}},{key:"toString",value:function toString(){var outBuf=[];var longest=0;var _iterator65=_createForOfIteratorHelper(this.times),_step65;try{for(_iterator65.s();!(_step65=_iterator65.n()).done;){var _name8=_step65.value.name;longest=Math.max(_name8.length,longest)}}catch(err){_iterator65.e(err)}finally{_iterator65.f()}var _iterator66=_createForOfIteratorHelper(this.times),_step66;try{for(_iterator66.s();!(_step66=_iterator66.n()).done;){var _step66$value=_step66.value,_name9=_step66$value.name,_start3=_step66$value.start,_end2=_step66$value.end;outBuf.push("".concat(_name9.padEnd(longest)," ").concat(_end2-_start3,"ms\n"))}}catch(err){_iterator66.e(err)}finally{_iterator66.f()}return outBuf.join("")}}]);return StatTimer}();exports.StatTimer=StatTimer;function isValidFetchUrl(url,baseUrl){try{var _ref54=baseUrl?new URL(url,baseUrl):new URL(url),protocol=_ref54.protocol;return protocol==="http:"||protocol==="https:"}catch(_unused12){return false}}function noContextMenu(e){e.preventDefault()}function loadScript(src){var removeScriptElement=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return new Promise(function(resolve,reject){var script=document.createElement("script");script.src=src;script.onload=function(evt){if(removeScriptElement){script.remove()}resolve(evt)};script.onerror=function(){reject(new Error("Cannot load script at: ".concat(script.src)))};(document.head||document.documentElement).append(script)})}function deprecated(details){console.log("Deprecated API usage: "+details)}var pdfDateStringRegex;var PDFDateString=function(){function PDFDateString(){_classCallCheck2(this,PDFDateString)}_createClass2(PDFDateString,null,[{key:"toDateObject",value:function toDateObject(input){if(!input||typeof input!=="string"){return null}pdfDateStringRegex||(pdfDateStringRegex=new RegExp("^D:"+"(\\d{4})"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"([Z|+|-])?"+"(\\d{2})?"+"'?"+"(\\d{2})?"+"'?"));var matches=pdfDateStringRegex.exec(input);if(!matches){return null}var year=parseInt(matches[1],10);var month=parseInt(matches[2],10);month=month>=1&&month<=12?month-1:0;var day=parseInt(matches[3],10);day=day>=1&&day<=31?day:1;var hour=parseInt(matches[4],10);hour=hour>=0&&hour<=23?hour:0;var minute=parseInt(matches[5],10);minute=minute>=0&&minute<=59?minute:0;var second=parseInt(matches[6],10);second=second>=0&&second<=59?second:0;var universalTimeRelation=matches[7]||"Z";var offsetHour=parseInt(matches[8],10);offsetHour=offsetHour>=0&&offsetHour<=23?offsetHour:0;var offsetMinute=parseInt(matches[9],10)||0;offsetMinute=offsetMinute>=0&&offsetMinute<=59?offsetMinute:0;if(universalTimeRelation==="-"){hour+=offsetHour;minute+=offsetMinute}else if(universalTimeRelation==="+"){hour-=offsetHour;minute-=offsetMinute}return new Date(Date.UTC(year,month,day,hour,minute,second))}}]);return PDFDateString}();exports.PDFDateString=PDFDateString;function getXfaPageViewport(xfaPage,_ref55){var _ref55$scale=_ref55.scale,scale=_ref55$scale===void 0?1:_ref55$scale,_ref55$rotation=_ref55.rotation,rotation=_ref55$rotation===void 0?0:_ref55$rotation;var _xfaPage$attributes$s=xfaPage.attributes.style,width=_xfaPage$attributes$s.width,height=_xfaPage$attributes$s.height;var viewBox=[0,0,parseInt(width),parseInt(height)];return new PageViewport({viewBox:viewBox,scale:scale,rotation:rotation})}function getRGB(color){if(color.startsWith("#")){var colorRGB=parseInt(color.slice(1),16);return[(colorRGB&16711680)>>16,(colorRGB&65280)>>8,colorRGB&255]}if(color.startsWith("rgb(")){return color.slice(4,-1).split(",").map(function(x){return parseInt(x)})}if(color.startsWith("rgba(")){return color.slice(5,-1).split(",").map(function(x){return parseInt(x)}).slice(0,3)}(0,_util.warn)("Not a valid color format: \"".concat(color,"\""));return[0,0,0]}function getColorValues(colors){var span=document.createElement("span");span.style.visibility="hidden";document.body.append(span);var _iterator67=_createForOfIteratorHelper(colors.keys()),_step67;try{for(_iterator67.s();!(_step67=_iterator67.n()).done;){var _name10=_step67.value;span.style.color=_name10;var computedColor=window.getComputedStyle(span).color;colors.set(_name10,getRGB(computedColor))}}catch(err){_iterator67.e(err)}finally{_iterator67.f()}span.remove()}function getCurrentTransform(ctx){var _ctx$getTransform=ctx.getTransform(),a=_ctx$getTransform.a,b=_ctx$getTransform.b,c=_ctx$getTransform.c,d=_ctx$getTransform.d,e=_ctx$getTransform.e,f=_ctx$getTransform.f;return[a,b,c,d,e,f]}function getCurrentTransformInverse(ctx){var _ctx$getTransform$inv=ctx.getTransform().invertSelf(),a=_ctx$getTransform$inv.a,b=_ctx$getTransform$inv.b,c=_ctx$getTransform$inv.c,d=_ctx$getTransform$inv.d,e=_ctx$getTransform$inv.e,f=_ctx$getTransform$inv.f;return[a,b,c,d,e,f]}function setLayerDimensions(div,viewport){var mustFlip=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var mustRotate=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(viewport instanceof PageViewport){var _viewport$rawDims=viewport.rawDims,pageWidth=_viewport$rawDims.pageWidth,pageHeight=_viewport$rawDims.pageHeight;var style=div.style;var useRound=_util.FeatureTest.isCSSRoundSupported;var w="var(--scale-factor) * ".concat(pageWidth,"px"),h="var(--scale-factor) * ".concat(pageHeight,"px");var widthStr=useRound?"round(".concat(w,", 1px)"):"calc(".concat(w,")"),heightStr=useRound?"round(".concat(h,", 1px)"):"calc(".concat(h,")");if(!mustFlip||viewport.rotation%180===0){style.width=widthStr;style.height=heightStr}else{style.width=heightStr;style.height=widthStr}}if(mustRotate){div.setAttribute("data-main-rotation",viewport.rotation)}}}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.BaseStandardFontDataFactory=exports.BaseSVGFactory=exports.BaseFilterFactory=exports.BaseCanvasFactory=exports.BaseCMapReaderFactory=void 0;var _util=__w_pdfjs_require__(1);var BaseFilterFactory=function(){function BaseFilterFactory(){_classCallCheck2(this,BaseFilterFactory);if(this.constructor===BaseFilterFactory){(0,_util.unreachable)("Cannot initialize BaseFilterFactory.")}}_createClass2(BaseFilterFactory,[{key:"addFilter",value:function addFilter(maps){return"none"}},{key:"addHCMFilter",value:function addHCMFilter(fgColor,bgColor){return"none"}},{key:"addHighlightHCMFilter",value:function addHighlightHCMFilter(fgColor,bgColor,newFgColor,newBgColor){return"none"}},{key:"destroy",value:function destroy(){var keepHCM=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false}}]);return BaseFilterFactory}();exports.BaseFilterFactory=BaseFilterFactory;var BaseCanvasFactory=function(){function BaseCanvasFactory(){_classCallCheck2(this,BaseCanvasFactory);if(this.constructor===BaseCanvasFactory){(0,_util.unreachable)("Cannot initialize BaseCanvasFactory.")}}_createClass2(BaseCanvasFactory,[{key:"create",value:function create(width,height){if(width<=0||height<=0){throw new Error("Invalid canvas size")}var canvas=this._createCanvas(width,height);return{canvas:canvas,context:canvas.getContext("2d")}}},{key:"reset",value:function reset(canvasAndContext,width,height){if(!canvasAndContext.canvas){throw new Error("Canvas is not specified")}if(width<=0||height<=0){throw new Error("Invalid canvas size")}canvasAndContext.canvas.width=width;canvasAndContext.canvas.height=height}},{key:"destroy",value:function destroy(canvasAndContext){if(!canvasAndContext.canvas){throw new Error("Canvas is not specified")}canvasAndContext.canvas.width=0;canvasAndContext.canvas.height=0;canvasAndContext.canvas=null;canvasAndContext.context=null}},{key:"_createCanvas",value:function _createCanvas(width,height){(0,_util.unreachable)("Abstract method `_createCanvas` called.")}}]);return BaseCanvasFactory}();exports.BaseCanvasFactory=BaseCanvasFactory;var BaseCMapReaderFactory=function(){function BaseCMapReaderFactory(_ref56){var _ref56$baseUrl=_ref56.baseUrl,baseUrl=_ref56$baseUrl===void 0?null:_ref56$baseUrl,_ref56$isCompressed=_ref56.isCompressed,isCompressed=_ref56$isCompressed===void 0?true:_ref56$isCompressed;_classCallCheck2(this,BaseCMapReaderFactory);if(this.constructor===BaseCMapReaderFactory){(0,_util.unreachable)("Cannot initialize BaseCMapReaderFactory.")}this.baseUrl=baseUrl;this.isCompressed=isCompressed}_createClass2(BaseCMapReaderFactory,[{key:"fetch",value:function(){var _fetch=_asyncToGenerator(_regeneratorRuntime().mark(function _callee47(_ref57){var _this76=this;var name,url,compressionType;return _regeneratorRuntime().wrap(function _callee47$(_context48){while(1)switch(_context48.prev=_context48.next){case 0:name=_ref57.name;if(this.baseUrl){_context48.next=3;break}throw new Error("The CMap \"baseUrl\" parameter must be specified, ensure that "+"the \"cMapUrl\" and \"cMapPacked\" API parameters are provided.");case 3:if(name){_context48.next=5;break}throw new Error("CMap name must be specified.");case 5:url=this.baseUrl+name+(this.isCompressed?".bcmap":"");compressionType=this.isCompressed?_util.CMapCompressionType.BINARY:_util.CMapCompressionType.NONE;return _context48.abrupt("return",this._fetchData(url,compressionType)["catch"](function(reason){throw new Error("Unable to load ".concat(_this76.isCompressed?"binary ":"","CMap at: ").concat(url))}));case 8:case"end":return _context48.stop()}},_callee47,this)}));function fetch(_x54){return _fetch.apply(this,arguments)}return fetch}()},{key:"_fetchData",value:function _fetchData(url,compressionType){(0,_util.unreachable)("Abstract method `_fetchData` called.")}}]);return BaseCMapReaderFactory}();exports.BaseCMapReaderFactory=BaseCMapReaderFactory;var BaseStandardFontDataFactory=function(){function BaseStandardFontDataFactory(_ref58){var _ref58$baseUrl=_ref58.baseUrl,baseUrl=_ref58$baseUrl===void 0?null:_ref58$baseUrl;_classCallCheck2(this,BaseStandardFontDataFactory);if(this.constructor===BaseStandardFontDataFactory){(0,_util.unreachable)("Cannot initialize BaseStandardFontDataFactory.")}this.baseUrl=baseUrl}_createClass2(BaseStandardFontDataFactory,[{key:"fetch",value:function(){var _fetch2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee48(_ref59){var filename,url;return _regeneratorRuntime().wrap(function _callee48$(_context49){while(1)switch(_context49.prev=_context49.next){case 0:filename=_ref59.filename;if(this.baseUrl){_context49.next=3;break}throw new Error("The standard font \"baseUrl\" parameter must be specified, ensure that "+"the \"standardFontDataUrl\" API parameter is provided.");case 3:if(filename){_context49.next=5;break}throw new Error("Font filename must be specified.");case 5:url="".concat(this.baseUrl).concat(filename);return _context49.abrupt("return",this._fetchData(url)["catch"](function(reason){throw new Error("Unable to load font data at: ".concat(url))}));case 7:case"end":return _context49.stop()}},_callee48,this)}));function fetch(_x55){return _fetch2.apply(this,arguments)}return fetch}()},{key:"_fetchData",value:function _fetchData(url){(0,_util.unreachable)("Abstract method `_fetchData` called.")}}]);return BaseStandardFontDataFactory}();exports.BaseStandardFontDataFactory=BaseStandardFontDataFactory;var BaseSVGFactory=function(){function BaseSVGFactory(){_classCallCheck2(this,BaseSVGFactory);if(this.constructor===BaseSVGFactory){(0,_util.unreachable)("Cannot initialize BaseSVGFactory.")}}_createClass2(BaseSVGFactory,[{key:"create",value:function create(width,height){var skipDimensions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(width<=0||height<=0){throw new Error("Invalid SVG dimensions")}var svg=this._createSVG("svg:svg");svg.setAttribute("version","1.1");if(!skipDimensions){svg.setAttribute("width","".concat(width,"px"));svg.setAttribute("height","".concat(height,"px"))}svg.setAttribute("preserveAspectRatio","none");svg.setAttribute("viewBox","0 0 ".concat(width," ").concat(height));return svg}},{key:"createElement",value:function createElement(type){if(typeof type!=="string"){throw new Error("Invalid SVG element type")}return this._createSVG(type)}},{key:"_createSVG",value:function _createSVG(type){(0,_util.unreachable)("Abstract method `_createSVG` called.")}}]);return BaseSVGFactory}();exports.BaseSVGFactory=BaseSVGFactory}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.MurmurHash3_64=void 0;var _util=__w_pdfjs_require__(1);var SEED=3285377520;var MASK_HIGH=4294901760;var MASK_LOW=65535;var MurmurHash3_64=function(){function MurmurHash3_64(seed){_classCallCheck2(this,MurmurHash3_64);this.h1=seed?seed&4294967295:SEED;this.h2=seed?seed&4294967295:SEED}_createClass2(MurmurHash3_64,[{key:"update",value:function update(input){var data,length;if(typeof input==="string"){data=new Uint8Array(input.length*2);length=0;for(var _i22=0,ii=input.length;_i22<ii;_i22++){var _code2=input.charCodeAt(_i22);if(_code2<=255){data[length++]=_code2}else{data[length++]=_code2>>>8;data[length++]=_code2&255}}}else if((0,_util.isArrayBuffer)(input)){data=input.slice();length=data.byteLength}else{throw new Error("Wrong data format in MurmurHash3_64_update. "+"Input must be a string or array.")}var blockCounts=length>>2;var tailLength=length-blockCounts*4;var dataUint32=new Uint32Array(data.buffer,0,blockCounts);var k1=0,k2=0;var h1=this.h1,h2=this.h2;var C1=3432918353,C2=461845907;var C1_LOW=C1&MASK_LOW,C2_LOW=C2&MASK_LOW;for(var _i23=0;_i23<blockCounts;_i23++){if(_i23&1){k1=dataUint32[_i23];k1=k1*C1&MASK_HIGH|k1*C1_LOW&MASK_LOW;k1=k1<<15|k1>>>17;k1=k1*C2&MASK_HIGH|k1*C2_LOW&MASK_LOW;h1^=k1;h1=h1<<13|h1>>>19;h1=h1*5+3864292196}else{k2=dataUint32[_i23];k2=k2*C1&MASK_HIGH|k2*C1_LOW&MASK_LOW;k2=k2<<15|k2>>>17;k2=k2*C2&MASK_HIGH|k2*C2_LOW&MASK_LOW;h2^=k2;h2=h2<<13|h2>>>19;h2=h2*5+3864292196}}k1=0;switch(tailLength){case 3:k1^=data[blockCounts*4+2]<<16;case 2:k1^=data[blockCounts*4+1]<<8;case 1:k1^=data[blockCounts*4];k1=k1*C1&MASK_HIGH|k1*C1_LOW&MASK_LOW;k1=k1<<15|k1>>>17;k1=k1*C2&MASK_HIGH|k1*C2_LOW&MASK_LOW;if(blockCounts&1){h1^=k1}else{h2^=k1}}this.h1=h1;this.h2=h2}},{key:"hexdigest",value:function hexdigest(){var h1=this.h1,h2=this.h2;h1^=h2>>>1;h1=h1*3981806797&MASK_HIGH|h1*36045&MASK_LOW;h2=h2*4283543511&MASK_HIGH|((h2<<16|h1>>>16)*2950163797&MASK_HIGH)>>>16;h1^=h2>>>1;h1=h1*444984403&MASK_HIGH|h1*60499&MASK_LOW;h2=h2*3301882366&MASK_HIGH|((h2<<16|h1>>>16)*3120437893&MASK_HIGH)>>>16;h1^=h2>>>1;return(h1>>>0).toString(16).padStart(8,"0")+(h2>>>0).toString(16).padStart(8,"0")}}]);return MurmurHash3_64}();exports.MurmurHash3_64=MurmurHash3_64}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.FontLoader=exports.FontFaceObject=void 0;var _util=__w_pdfjs_require__(1);var _systemFonts=new WeakMap;var FontLoader=function(){function FontLoader(_ref60){var _ref60$ownerDocument=_ref60.ownerDocument,ownerDocument=_ref60$ownerDocument===void 0?globalThis.document:_ref60$ownerDocument,_ref60$styleElement=_ref60.styleElement,styleElement=_ref60$styleElement===void 0?null:_ref60$styleElement;_classCallCheck2(this,FontLoader);_classPrivateFieldInitSpec(this,_systemFonts,{writable:true,value:new Set});this._document=ownerDocument;this.nativeFontFaces=new Set;this.styleElement=null;this.loadingRequests=[];this.loadTestFontId=0}_createClass2(FontLoader,[{key:"addNativeFontFace",value:function addNativeFontFace(nativeFontFace){this.nativeFontFaces.add(nativeFontFace);this._document.fonts.add(nativeFontFace)}},{key:"removeNativeFontFace",value:function removeNativeFontFace(nativeFontFace){this.nativeFontFaces["delete"](nativeFontFace);this._document.fonts["delete"](nativeFontFace)}},{key:"insertRule",value:function insertRule(rule){if(!this.styleElement){this.styleElement=this._document.createElement("style");this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement)}var styleSheet=this.styleElement.sheet;styleSheet.insertRule(rule,styleSheet.cssRules.length)}},{key:"clear",value:function clear(){var _iterator68=_createForOfIteratorHelper(this.nativeFontFaces),_step68;try{for(_iterator68.s();!(_step68=_iterator68.n()).done;){var nativeFontFace=_step68.value;this._document.fonts["delete"](nativeFontFace)}}catch(err){_iterator68.e(err)}finally{_iterator68.f()}this.nativeFontFaces.clear();_classPrivateFieldGet(this,_systemFonts).clear();if(this.styleElement){this.styleElement.remove();this.styleElement=null}}},{key:"loadSystemFont",value:function(){var _loadSystemFont=_asyncToGenerator(_regeneratorRuntime().mark(function _callee49(info){var loadedName,src,style,fontFace;return _regeneratorRuntime().wrap(function _callee49$(_context50){while(1)switch(_context50.prev=_context50.next){case 0:if(!(!info||_classPrivateFieldGet(this,_systemFonts).has(info.loadedName))){_context50.next=2;break}return _context50.abrupt("return");case 2:(0,_util.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set.");if(!this.isFontLoadingAPISupported){_context50.next=18;break}loadedName=info.loadedName,src=info.src,style=info.style;fontFace=new FontFace(loadedName,src,style);this.addNativeFontFace(fontFace);_context50.prev=7;_context50.next=10;return fontFace.load();case 10:_classPrivateFieldGet(this,_systemFonts).add(loadedName);_context50.next=17;break;case 13:_context50.prev=13;_context50.t0=_context50["catch"](7);(0,_util.warn)("Cannot load system font: ".concat(info.baseFontName,", installing it could help to improve PDF rendering."));this.removeNativeFontFace(fontFace);case 17:return _context50.abrupt("return");case 18:(0,_util.unreachable)("Not implemented: loadSystemFont without the Font Loading API.");case 19:case"end":return _context50.stop()}},_callee49,this,[[7,13]])}));function loadSystemFont(_x56){return _loadSystemFont.apply(this,arguments)}return loadSystemFont}()},{key:"bind",value:function(){var _bind=_asyncToGenerator(_regeneratorRuntime().mark(function _callee50(font){var _this77=this;var nativeFontFace,rule;return _regeneratorRuntime().wrap(function _callee50$(_context51){while(1)switch(_context51.prev=_context51.next){case 0:if(!(font.attached||font.missingFile&&!font.systemFontInfo)){_context51.next=2;break}return _context51.abrupt("return");case 2:font.attached=true;if(!font.systemFontInfo){_context51.next=7;break}_context51.next=6;return this.loadSystemFont(font.systemFontInfo);case 6:return _context51.abrupt("return");case 7:if(!this.isFontLoadingAPISupported){_context51.next=22;break}nativeFontFace=font.createNativeFontFace();if(!nativeFontFace){_context51.next=21;break}this.addNativeFontFace(nativeFontFace);_context51.prev=11;_context51.next=14;return nativeFontFace.loaded;case 14:_context51.next=21;break;case 16:_context51.prev=16;_context51.t0=_context51["catch"](11);(0,_util.warn)("Failed to load font '".concat(nativeFontFace.family,"': '").concat(_context51.t0,"'."));font.disableFontFace=true;throw _context51.t0;case 21:return _context51.abrupt("return");case 22:rule=font.createFontFaceRule();if(!rule){_context51.next=29;break}this.insertRule(rule);if(!this.isSyncFontLoadingSupported){_context51.next=27;break}return _context51.abrupt("return");case 27:_context51.next=29;return new Promise(function(resolve){var request=_this77._queueLoadingCallback(resolve);_this77._prepareFontLoadEvent(font,request)});case 29:case"end":return _context51.stop()}},_callee50,this,[[11,16]])}));function bind(_x57){return _bind.apply(this,arguments)}return bind}()},{key:"isFontLoadingAPISupported",get:function get(){var _this$_document;var hasFonts=!!((_this$_document=this._document)!==null&&_this$_document!==void 0&&_this$_document.fonts);return(0,_util.shadow)(this,"isFontLoadingAPISupported",hasFonts)}},{key:"isSyncFontLoadingSupported",get:function get(){var supported=false;if(_util.isNodeJS){supported=true}else if(typeof navigator!=="undefined"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent)){supported=true}return(0,_util.shadow)(this,"isSyncFontLoadingSupported",supported)}},{key:"_queueLoadingCallback",value:function _queueLoadingCallback(callback){function completeRequest(){(0,_util.assert)(!request.done,"completeRequest() cannot be called twice.");request.done=true;while(loadingRequests.length>0&&loadingRequests[0].done){var otherRequest=loadingRequests.shift();setTimeout(otherRequest.callback,0)}}var loadingRequests=this.loadingRequests;var request={done:false,complete:completeRequest,callback:callback};loadingRequests.push(request);return request}},{key:"_loadTestFont",get:function get(){var testFont=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA"+"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA"+"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA"+"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1"+"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD"+"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM"+"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D"+"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA"+"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA"+"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB"+"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY"+"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA"+"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA"+"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC"+"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3"+"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj"+"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,_util.shadow)(this,"_loadTestFont",testFont)}},{key:"_prepareFontLoadEvent",value:function _prepareFontLoadEvent(font,request){function int32(data,offset){return data.charCodeAt(offset)<<24|data.charCodeAt(offset+1)<<16|data.charCodeAt(offset+2)<<8|data.charCodeAt(offset+3)&255}function spliceString(s,offset,remove,insert){var chunk1=s.substring(0,offset);var chunk2=s.substring(offset+remove);return chunk1+insert+chunk2}var i,ii;var canvas=this._document.createElement("canvas");canvas.width=1;canvas.height=1;var ctx=canvas.getContext("2d");var called=0;function isFontReady(name,callback){if(++called>30){(0,_util.warn)("Load test font never loaded.");callback();return}ctx.font="30px "+name;ctx.fillText(".",0,20);var imageData=ctx.getImageData(0,0,1,1);if(imageData.data[3]>0){callback();return}setTimeout(isFontReady.bind(null,name,callback))}var loadTestFontId="lt".concat(Date.now()).concat(this.loadTestFontId++);var data=this._loadTestFont;var COMMENT_OFFSET=976;data=spliceString(data,COMMENT_OFFSET,loadTestFontId.length,loadTestFontId);var CFF_CHECKSUM_OFFSET=16;var XXXX_VALUE=1482184792;var checksum=int32(data,CFF_CHECKSUM_OFFSET);for(i=0,ii=loadTestFontId.length-3;i<ii;i+=4){checksum=checksum-XXXX_VALUE+int32(loadTestFontId,i)|0}if(i<loadTestFontId.length){checksum=checksum-XXXX_VALUE+int32(loadTestFontId+"XXX",i)|0}data=spliceString(data,CFF_CHECKSUM_OFFSET,4,(0,_util.string32)(checksum));var url="url(data:font/opentype;base64,".concat(btoa(data),");");var rule="@font-face {font-family:\"".concat(loadTestFontId,"\";src:").concat(url,"}");this.insertRule(rule);var div=this._document.createElement("div");div.style.visibility="hidden";div.style.width=div.style.height="10px";div.style.position="absolute";div.style.top=div.style.left="0px";for(var _i24=0,_arr3=[font.loadedName,loadTestFontId];_i24<_arr3.length;_i24++){var _name11=_arr3[_i24];var span=this._document.createElement("span");span.textContent="Hi";span.style.fontFamily=_name11;div.append(span)}this._document.body.append(div);isFontReady(loadTestFontId,function(){div.remove();request.complete()})}}]);return FontLoader}();exports.FontLoader=FontLoader;var FontFaceObject=function(){function FontFaceObject(translatedData,_ref61){var _ref61$isEvalSupporte=_ref61.isEvalSupported,isEvalSupported=_ref61$isEvalSupporte===void 0?true:_ref61$isEvalSupporte,_ref61$disableFontFac=_ref61.disableFontFace,disableFontFace=_ref61$disableFontFac===void 0?false:_ref61$disableFontFac,_ref61$ignoreErrors=_ref61.ignoreErrors,ignoreErrors=_ref61$ignoreErrors===void 0?false:_ref61$ignoreErrors,_ref61$inspectFont=_ref61.inspectFont,inspectFont=_ref61$inspectFont===void 0?null:_ref61$inspectFont;_classCallCheck2(this,FontFaceObject);this.compiledGlyphs=Object.create(null);for(var _i25 in translatedData){this[_i25]=translatedData[_i25]}this.isEvalSupported=isEvalSupported!==false;this.disableFontFace=disableFontFace===true;this.ignoreErrors=ignoreErrors===true;this._inspectFont=inspectFont}_createClass2(FontFaceObject,[{key:"createNativeFontFace",value:function createNativeFontFace(){var _this$_inspectFont;if(!this.data||this.disableFontFace){return null}var nativeFontFace;if(!this.cssFontInfo){nativeFontFace=new FontFace(this.loadedName,this.data,{})}else{var _css={weight:this.cssFontInfo.fontWeight};if(this.cssFontInfo.italicAngle){_css.style="oblique ".concat(this.cssFontInfo.italicAngle,"deg")}nativeFontFace=new FontFace(this.cssFontInfo.fontFamily,this.data,_css)}(_this$_inspectFont=this._inspectFont)===null||_this$_inspectFont===void 0||_this$_inspectFont.call(this,this);return nativeFontFace}},{key:"createFontFaceRule",value:function createFontFaceRule(){var _this$_inspectFont2;if(!this.data||this.disableFontFace){return null}var data=(0,_util.bytesToString)(this.data);var url="url(data:".concat(this.mimetype,";base64,").concat(btoa(data),");");var rule;if(!this.cssFontInfo){rule="@font-face {font-family:\"".concat(this.loadedName,"\";src:").concat(url,"}")}else{var _css2="font-weight: ".concat(this.cssFontInfo.fontWeight,";");if(this.cssFontInfo.italicAngle){_css2+="font-style: oblique ".concat(this.cssFontInfo.italicAngle,"deg;")}rule="@font-face {font-family:\"".concat(this.cssFontInfo.fontFamily,"\";").concat(_css2,"src:").concat(url,"}")}(_this$_inspectFont2=this._inspectFont)===null||_this$_inspectFont2===void 0||_this$_inspectFont2.call(this,this,url);return rule}},{key:"getPathGenerator",value:function getPathGenerator(objs,character){if(this.compiledGlyphs[character]!==undefined){return this.compiledGlyphs[character]}var cmds;try{cmds=objs.get(this.loadedName+"_path_"+character)}catch(ex){if(!this.ignoreErrors){throw ex}(0,_util.warn)("getPathGenerator - ignoring character: \"".concat(ex,"\"."));return this.compiledGlyphs[character]=function(c,size){}}if(this.isEvalSupported&&_util.FeatureTest.isEvalSupported){var jsBuf=[];var _iterator69=_createForOfIteratorHelper(cmds),_step69;try{for(_iterator69.s();!(_step69=_iterator69.n()).done;){var current=_step69.value;var args=current.args!==undefined?current.args.join(","):"";jsBuf.push("c.",current.cmd,"(",args,");\n")}}catch(err){_iterator69.e(err)}finally{_iterator69.f()}return this.compiledGlyphs[character]=new Function("c","size",jsBuf.join(""))}return this.compiledGlyphs[character]=function(c,size){var _iterator70=_createForOfIteratorHelper(cmds),_step70;try{for(_iterator70.s();!(_step70=_iterator70.n()).done;){var _current=_step70.value;if(_current.cmd==="scale"){_current.args=[size,-size]}c[_current.cmd].apply(c,_current.args)}}catch(err){_iterator70.e(err)}finally{_iterator70.f()}}}}]);return FontFaceObject}();exports.FontFaceObject=FontFaceObject}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.NodeStandardFontDataFactory=exports.NodeFilterFactory=exports.NodeCanvasFactory=exports.NodeCMapReaderFactory=void 0;var _base_factory=__w_pdfjs_require__(7);__w_pdfjs_require__(1);var fetchData=function fetchData(url){return new Promise(function(resolve,reject){var fs=require$$5;fs.readFile(url,function(error,data){if(error||!data){reject(new Error(error));return}resolve(new Uint8Array(data))})})};var NodeFilterFactory=function(_base_factory$BaseFil2){_inherits2(NodeFilterFactory,_base_factory$BaseFil2);var _super28=_createSuper(NodeFilterFactory);function NodeFilterFactory(){_classCallCheck2(this,NodeFilterFactory);return _super28.apply(this,arguments)}return _createClass2(NodeFilterFactory)}(_base_factory.BaseFilterFactory);exports.NodeFilterFactory=NodeFilterFactory;var NodeCanvasFactory=function(_base_factory$BaseCan2){_inherits2(NodeCanvasFactory,_base_factory$BaseCan2);var _super29=_createSuper(NodeCanvasFactory);function NodeCanvasFactory(){_classCallCheck2(this,NodeCanvasFactory);return _super29.apply(this,arguments)}_createClass2(NodeCanvasFactory,[{key:"_createCanvas",value:function _createCanvas(width,height){var Canvas=require$$5;return Canvas.createCanvas(width,height)}}]);return NodeCanvasFactory}(_base_factory.BaseCanvasFactory);exports.NodeCanvasFactory=NodeCanvasFactory;var NodeCMapReaderFactory=function(_base_factory$BaseCMa2){_inherits2(NodeCMapReaderFactory,_base_factory$BaseCMa2);var _super30=_createSuper(NodeCMapReaderFactory);function NodeCMapReaderFactory(){_classCallCheck2(this,NodeCMapReaderFactory);return _super30.apply(this,arguments)}_createClass2(NodeCMapReaderFactory,[{key:"_fetchData",value:function _fetchData(url,compressionType){return fetchData(url).then(function(data){return{cMapData:data,compressionType:compressionType}})}}]);return NodeCMapReaderFactory}(_base_factory.BaseCMapReaderFactory);exports.NodeCMapReaderFactory=NodeCMapReaderFactory;var NodeStandardFontDataFactory=function(_base_factory$BaseSta2){_inherits2(NodeStandardFontDataFactory,_base_factory$BaseSta2);var _super31=_createSuper(NodeStandardFontDataFactory);function NodeStandardFontDataFactory(){_classCallCheck2(this,NodeStandardFontDataFactory);return _super31.apply(this,arguments)}_createClass2(NodeStandardFontDataFactory,[{key:"_fetchData",value:function _fetchData(url){return fetchData(url)}}]);return NodeStandardFontDataFactory}(_base_factory.BaseStandardFontDataFactory);exports.NodeStandardFontDataFactory=NodeStandardFontDataFactory}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.CanvasGraphics=void 0;var _util=__w_pdfjs_require__(1);var _display_utils=__w_pdfjs_require__(6);var _pattern_helper=__w_pdfjs_require__(12);var _image_utils=__w_pdfjs_require__(13);var MIN_FONT_SIZE=16;var MAX_FONT_SIZE=100;var MAX_GROUP_SIZE=4096;var EXECUTION_TIME=15;var EXECUTION_STEPS=10;var MAX_SIZE_TO_COMPILE=1000;var FULL_CHUNK_HEIGHT=16;function mirrorContextOperations(ctx,destCtx){if(ctx._removeMirroring){throw new Error("Context is already forwarding operations.")}ctx.__originalSave=ctx.save;ctx.__originalRestore=ctx.restore;ctx.__originalRotate=ctx.rotate;ctx.__originalScale=ctx.scale;ctx.__originalTranslate=ctx.translate;ctx.__originalTransform=ctx.transform;ctx.__originalSetTransform=ctx.setTransform;ctx.__originalResetTransform=ctx.resetTransform;ctx.__originalClip=ctx.clip;ctx.__originalMoveTo=ctx.moveTo;ctx.__originalLineTo=ctx.lineTo;ctx.__originalBezierCurveTo=ctx.bezierCurveTo;ctx.__originalRect=ctx.rect;ctx.__originalClosePath=ctx.closePath;ctx.__originalBeginPath=ctx.beginPath;ctx._removeMirroring=function(){ctx.save=ctx.__originalSave;ctx.restore=ctx.__originalRestore;ctx.rotate=ctx.__originalRotate;ctx.scale=ctx.__originalScale;ctx.translate=ctx.__originalTranslate;ctx.transform=ctx.__originalTransform;ctx.setTransform=ctx.__originalSetTransform;ctx.resetTransform=ctx.__originalResetTransform;ctx.clip=ctx.__originalClip;ctx.moveTo=ctx.__originalMoveTo;ctx.lineTo=ctx.__originalLineTo;ctx.bezierCurveTo=ctx.__originalBezierCurveTo;ctx.rect=ctx.__originalRect;ctx.closePath=ctx.__originalClosePath;ctx.beginPath=ctx.__originalBeginPath;delete ctx._removeMirroring};ctx.save=function ctxSave(){destCtx.save();this.__originalSave()};ctx.restore=function ctxRestore(){destCtx.restore();this.__originalRestore()};ctx.translate=function ctxTranslate(x,y){destCtx.translate(x,y);this.__originalTranslate(x,y)};ctx.scale=function ctxScale(x,y){destCtx.scale(x,y);this.__originalScale(x,y)};ctx.transform=function ctxTransform(a,b,c,d,e,f){destCtx.transform(a,b,c,d,e,f);this.__originalTransform(a,b,c,d,e,f)};ctx.setTransform=function ctxSetTransform(a,b,c,d,e,f){destCtx.setTransform(a,b,c,d,e,f);this.__originalSetTransform(a,b,c,d,e,f)};ctx.resetTransform=function ctxResetTransform(){destCtx.resetTransform();this.__originalResetTransform()};ctx.rotate=function ctxRotate(angle){destCtx.rotate(angle);this.__originalRotate(angle)};ctx.clip=function ctxRotate(rule){destCtx.clip(rule);this.__originalClip(rule)};ctx.moveTo=function(x,y){destCtx.moveTo(x,y);this.__originalMoveTo(x,y)};ctx.lineTo=function(x,y){destCtx.lineTo(x,y);this.__originalLineTo(x,y)};ctx.bezierCurveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){destCtx.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y);this.__originalBezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y)};ctx.rect=function(x,y,width,height){destCtx.rect(x,y,width,height);this.__originalRect(x,y,width,height)};ctx.closePath=function(){destCtx.closePath();this.__originalClosePath()};ctx.beginPath=function(){destCtx.beginPath();this.__originalBeginPath()}}var CachedCanvases=function(){function CachedCanvases(canvasFactory){_classCallCheck2(this,CachedCanvases);this.canvasFactory=canvasFactory;this.cache=Object.create(null)}_createClass2(CachedCanvases,[{key:"getCanvas",value:function getCanvas(id,width,height){var canvasEntry;if(this.cache[id]!==undefined){canvasEntry=this.cache[id];this.canvasFactory.reset(canvasEntry,width,height)}else{canvasEntry=this.canvasFactory.create(width,height);this.cache[id]=canvasEntry}return canvasEntry}},{key:"delete",value:function _delete(id){delete this.cache[id]}},{key:"clear",value:function clear(){for(var _id5 in this.cache){var canvasEntry=this.cache[_id5];this.canvasFactory.destroy(canvasEntry);delete this.cache[_id5]}}}]);return CachedCanvases}();function drawImageAtIntegerCoords(ctx,srcImg,srcX,srcY,srcW,srcH,destX,destY,destW,destH){var _ref62=(0,_display_utils.getCurrentTransform)(ctx),_ref63=_slicedToArray2(_ref62,6),a=_ref63[0],b=_ref63[1],c=_ref63[2],d=_ref63[3],tx=_ref63[4],ty=_ref63[5];if(b===0&&c===0){var tlX=destX*a+tx;var rTlX=Math.round(tlX);var tlY=destY*d+ty;var rTlY=Math.round(tlY);var brX=(destX+destW)*a+tx;var rWidth=Math.abs(Math.round(brX)-rTlX)||1;var brY=(destY+destH)*d+ty;var rHeight=Math.abs(Math.round(brY)-rTlY)||1;ctx.setTransform(Math.sign(a),0,0,Math.sign(d),rTlX,rTlY);ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,0,0,rWidth,rHeight);ctx.setTransform(a,b,c,d,tx,ty);return[rWidth,rHeight]}if(a===0&&d===0){var _tlX=destY*c+tx;var _rTlX=Math.round(_tlX);var _tlY=destX*b+ty;var _rTlY=Math.round(_tlY);var _brX=(destY+destH)*c+tx;var _rWidth=Math.abs(Math.round(_brX)-_rTlX)||1;var _brY=(destX+destW)*b+ty;var _rHeight=Math.abs(Math.round(_brY)-_rTlY)||1;ctx.setTransform(0,Math.sign(b),Math.sign(c),0,_rTlX,_rTlY);ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,0,0,_rHeight,_rWidth);ctx.setTransform(a,b,c,d,tx,ty);return[_rHeight,_rWidth]}ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,destX,destY,destW,destH);var scaleX=Math.hypot(a,b);var scaleY=Math.hypot(c,d);return[scaleX*destW,scaleY*destH]}function compileType3Glyph(imgData){var width=imgData.width,height=imgData.height;if(width>MAX_SIZE_TO_COMPILE||height>MAX_SIZE_TO_COMPILE){return null}var POINT_TO_PROCESS_LIMIT=1000;var POINT_TYPES=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]);var width1=width+1;var points=new Uint8Array(width1*(height+1));var i,j,j0;var lineSize=width+7&~7;var data=new Uint8Array(lineSize*height),pos=0;var _iterator71=_createForOfIteratorHelper(imgData.data),_step71;try{for(_iterator71.s();!(_step71=_iterator71.n()).done;){var elem=_step71.value;var mask=128;while(mask>0){data[pos++]=elem&mask?0:255;mask>>=1}}}catch(err){_iterator71.e(err)}finally{_iterator71.f()}var count=0;pos=0;if(data[pos]!==0){points[0]=1;++count}for(j=1;j<width;j++){if(data[pos]!==data[pos+1]){points[j]=data[pos]?2:1;++count}pos++}if(data[pos]!==0){points[j]=2;++count}for(i=1;i<height;i++){pos=i*lineSize;j0=i*width1;if(data[pos-lineSize]!==data[pos]){points[j0]=data[pos]?1:8;++count}var sum=(data[pos]?4:0)+(data[pos-lineSize]?8:0);for(j=1;j<width;j++){sum=(sum>>2)+(data[pos+1]?4:0)+(data[pos-lineSize+1]?8:0);if(POINT_TYPES[sum]){points[j0+j]=POINT_TYPES[sum];++count}pos++}if(data[pos-lineSize]!==data[pos]){points[j0+j]=data[pos]?2:4;++count}if(count>POINT_TO_PROCESS_LIMIT){return null}}pos=lineSize*(height-1);j0=i*width1;if(data[pos]!==0){points[j0]=8;++count}for(j=1;j<width;j++){if(data[pos]!==data[pos+1]){points[j0+j]=data[pos]?4:8;++count}pos++}if(data[pos]!==0){points[j0+j]=4;++count}if(count>POINT_TO_PROCESS_LIMIT){return null}var steps=new Int32Array([0,width1,-1,0,-width1,0,0,0,1]);var path=new Path2D;for(i=0;count&&i<=height;i++){var p=i*width1;var _end3=p+width;while(p<_end3&&!points[p]){p++}if(p===_end3){continue}path.moveTo(p%width1,i);var p0=p;var type=points[p];do{var step=steps[type];do{p+=step}while(!points[p]);var pp=points[p];if(pp!==5&&pp!==10){type=pp;points[p]=0}else{type=pp&51*type>>4;points[p]&=type>>2|type<<2}path.lineTo(p%width1,p/width1|0);if(!points[p]){--count}}while(p0!==p);--i}data=null;points=null;var drawOutline=function drawOutline(c){c.save();c.scale(1/width,-1/height);c.translate(0,-height);c.fill(path);c.beginPath();c.restore()};return drawOutline}var CanvasExtraState=function(){function CanvasExtraState(width,height){_classCallCheck2(this,CanvasExtraState);this.alphaIsShape=false;this.fontSize=0;this.fontSizeScale=1;this.textMatrix=_util.IDENTITY_MATRIX;this.textMatrixScale=1;this.fontMatrix=_util.FONT_IDENTITY_MATRIX;this.leading=0;this.x=0;this.y=0;this.lineX=0;this.lineY=0;this.charSpacing=0;this.wordSpacing=0;this.textHScale=1;this.textRenderingMode=_util.TextRenderingMode.FILL;this.textRise=0;this.fillColor="#000000";this.strokeColor="#000000";this.patternFill=false;this.fillAlpha=1;this.strokeAlpha=1;this.lineWidth=1;this.activeSMask=null;this.transferMaps="none";this.startNewPathAndClipBox([0,0,width,height])}_createClass2(CanvasExtraState,[{key:"clone",value:function clone(){var clone=Object.create(this);clone.clipBox=this.clipBox.slice();return clone}},{key:"setCurrentPoint",value:function setCurrentPoint(x,y){this.x=x;this.y=y}},{key:"updatePathMinMax",value:function updatePathMinMax(transform,x,y){var _util$Util$applyTrans=_util.Util.applyTransform([x,y],transform);var _util$Util$applyTrans2=_slicedToArray2(_util$Util$applyTrans,2);x=_util$Util$applyTrans2[0];y=_util$Util$applyTrans2[1];this.minX=Math.min(this.minX,x);this.minY=Math.min(this.minY,y);this.maxX=Math.max(this.maxX,x);this.maxY=Math.max(this.maxY,y)}},{key:"updateRectMinMax",value:function updateRectMinMax(transform,rect){var p1=_util.Util.applyTransform(rect,transform);var p2=_util.Util.applyTransform(rect.slice(2),transform);this.minX=Math.min(this.minX,p1[0],p2[0]);this.minY=Math.min(this.minY,p1[1],p2[1]);this.maxX=Math.max(this.maxX,p1[0],p2[0]);this.maxY=Math.max(this.maxY,p1[1],p2[1])}},{key:"updateScalingPathMinMax",value:function updateScalingPathMinMax(transform,minMax){_util.Util.scaleMinMax(transform,minMax);this.minX=Math.min(this.minX,minMax[0]);this.maxX=Math.max(this.maxX,minMax[1]);this.minY=Math.min(this.minY,minMax[2]);this.maxY=Math.max(this.maxY,minMax[3])}},{key:"updateCurvePathMinMax",value:function updateCurvePathMinMax(transform,x0,y0,x1,y1,x2,y2,x3,y3,minMax){var box=_util.Util.bezierBoundingBox(x0,y0,x1,y1,x2,y2,x3,y3);if(minMax){minMax[0]=Math.min(minMax[0],box[0],box[2]);minMax[1]=Math.max(minMax[1],box[0],box[2]);minMax[2]=Math.min(minMax[2],box[1],box[3]);minMax[3]=Math.max(minMax[3],box[1],box[3]);return}this.updateRectMinMax(transform,box)}},{key:"getPathBoundingBox",value:function getPathBoundingBox(){var pathType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_pattern_helper.PathType.FILL;var transform=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var box=[this.minX,this.minY,this.maxX,this.maxY];if(pathType===_pattern_helper.PathType.STROKE){if(!transform){(0,_util.unreachable)("Stroke bounding box must include transform.")}var scale=_util.Util.singularValueDecompose2dScale(transform);var xStrokePad=scale[0]*this.lineWidth/2;var yStrokePad=scale[1]*this.lineWidth/2;box[0]-=xStrokePad;box[1]-=yStrokePad;box[2]+=xStrokePad;box[3]+=yStrokePad}return box}},{key:"updateClipFromPath",value:function updateClipFromPath(){var intersect=_util.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(intersect||[0,0,0,0])}},{key:"isEmptyClip",value:function isEmptyClip(){return this.minX===Infinity}},{key:"startNewPathAndClipBox",value:function startNewPathAndClipBox(box){this.clipBox=box;this.minX=Infinity;this.minY=Infinity;this.maxX=0;this.maxY=0}},{key:"getClippedPathBoundingBox",value:function getClippedPathBoundingBox(){var pathType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_pattern_helper.PathType.FILL;var transform=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return _util.Util.intersect(this.clipBox,this.getPathBoundingBox(pathType,transform))}}]);return CanvasExtraState}();function putBinaryImageData(ctx,imgData){if(typeof ImageData!=="undefined"&&imgData instanceof ImageData){ctx.putImageData(imgData,0,0);return}var height=imgData.height,width=imgData.width;var partialChunkHeight=height%FULL_CHUNK_HEIGHT;var fullChunks=(height-partialChunkHeight)/FULL_CHUNK_HEIGHT;var totalChunks=partialChunkHeight===0?fullChunks:fullChunks+1;var chunkImgData=ctx.createImageData(width,FULL_CHUNK_HEIGHT);var srcPos=0,destPos;var src=imgData.data;var dest=chunkImgData.data;var i,j,thisChunkHeight,elemsInThisChunk;if(imgData.kind===_util.ImageKind.GRAYSCALE_1BPP){var srcLength=src.byteLength;var dest32=new Uint32Array(dest.buffer,0,dest.byteLength>>2);var dest32DataLength=dest32.length;var fullSrcDiff=width+7>>3;var white=4294967295;var black=_util.FeatureTest.isLittleEndian?4278190080:255;for(i=0;i<totalChunks;i++){thisChunkHeight=i<fullChunks?FULL_CHUNK_HEIGHT:partialChunkHeight;destPos=0;for(j=0;j<thisChunkHeight;j++){var srcDiff=srcLength-srcPos;var k=0;var kEnd=srcDiff>fullSrcDiff?width:srcDiff*8-7;var kEndUnrolled=kEnd&~7;var mask=0;var srcByte=0;for(;k<kEndUnrolled;k+=8){srcByte=src[srcPos++];dest32[destPos++]=srcByte&128?white:black;dest32[destPos++]=srcByte&64?white:black;dest32[destPos++]=srcByte&32?white:black;dest32[destPos++]=srcByte&16?white:black;dest32[destPos++]=srcByte&8?white:black;dest32[destPos++]=srcByte&4?white:black;dest32[destPos++]=srcByte&2?white:black;dest32[destPos++]=srcByte&1?white:black}for(;k<kEnd;k++){if(mask===0){srcByte=src[srcPos++];mask=128}dest32[destPos++]=srcByte&mask?white:black;mask>>=1}}while(destPos<dest32DataLength){dest32[destPos++]=0}ctx.putImageData(chunkImgData,0,i*FULL_CHUNK_HEIGHT)}}else if(imgData.kind===_util.ImageKind.RGBA_32BPP){j=0;elemsInThisChunk=width*FULL_CHUNK_HEIGHT*4;for(i=0;i<fullChunks;i++){dest.set(src.subarray(srcPos,srcPos+elemsInThisChunk));srcPos+=elemsInThisChunk;ctx.putImageData(chunkImgData,0,j);j+=FULL_CHUNK_HEIGHT}if(i<totalChunks){elemsInThisChunk=width*partialChunkHeight*4;dest.set(src.subarray(srcPos,srcPos+elemsInThisChunk));ctx.putImageData(chunkImgData,0,j)}}else if(imgData.kind===_util.ImageKind.RGB_24BPP){thisChunkHeight=FULL_CHUNK_HEIGHT;elemsInThisChunk=width*thisChunkHeight;for(i=0;i<totalChunks;i++){if(i>=fullChunks){thisChunkHeight=partialChunkHeight;elemsInThisChunk=width*thisChunkHeight}destPos=0;for(j=elemsInThisChunk;j--;){dest[destPos++]=src[srcPos++];dest[destPos++]=src[srcPos++];dest[destPos++]=src[srcPos++];dest[destPos++]=255}ctx.putImageData(chunkImgData,0,i*FULL_CHUNK_HEIGHT)}}else{throw new Error("bad image kind: ".concat(imgData.kind))}}function putBinaryImageMask(ctx,imgData){if(imgData.bitmap){ctx.drawImage(imgData.bitmap,0,0);return}var height=imgData.height,width=imgData.width;var partialChunkHeight=height%FULL_CHUNK_HEIGHT;var fullChunks=(height-partialChunkHeight)/FULL_CHUNK_HEIGHT;var totalChunks=partialChunkHeight===0?fullChunks:fullChunks+1;var chunkImgData=ctx.createImageData(width,FULL_CHUNK_HEIGHT);var srcPos=0;var src=imgData.data;var dest=chunkImgData.data;for(var _i26=0;_i26<totalChunks;_i26++){var thisChunkHeight=_i26<fullChunks?FULL_CHUNK_HEIGHT:partialChunkHeight;var _ref64=(0,_image_utils.convertBlackAndWhiteToRGBA)({src:src,srcPos:srcPos,dest:dest,width:width,height:thisChunkHeight,nonBlackColor:0});srcPos=_ref64.srcPos;ctx.putImageData(chunkImgData,0,_i26*FULL_CHUNK_HEIGHT)}}function copyCtxState(sourceCtx,destCtx){var properties=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(var _i27=0,_properties2=properties;_i27<_properties2.length;_i27++){var property=_properties2[_i27];if(sourceCtx[property]!==undefined){destCtx[property]=sourceCtx[property]}}if(sourceCtx.setLineDash!==undefined){destCtx.setLineDash(sourceCtx.getLineDash());destCtx.lineDashOffset=sourceCtx.lineDashOffset}}function resetCtxToDefault(ctx){ctx.strokeStyle=ctx.fillStyle="#000000";ctx.fillRule="nonzero";ctx.globalAlpha=1;ctx.lineWidth=1;ctx.lineCap="butt";ctx.lineJoin="miter";ctx.miterLimit=10;ctx.globalCompositeOperation="source-over";ctx.font="10px sans-serif";if(ctx.setLineDash!==undefined){ctx.setLineDash([]);ctx.lineDashOffset=0}if(!_util.isNodeJS){var filter=ctx.filter;if(filter!=="none"&&filter!==""){ctx.filter="none"}}}function composeSMaskBackdrop(bytes,r0,g0,b0){var length=bytes.length;for(var _i28=3;_i28<length;_i28+=4){var alpha=bytes[_i28];if(alpha===0){bytes[_i28-3]=r0;bytes[_i28-2]=g0;bytes[_i28-1]=b0}else if(alpha<255){var alpha_=255-alpha;bytes[_i28-3]=bytes[_i28-3]*alpha+r0*alpha_>>8;bytes[_i28-2]=bytes[_i28-2]*alpha+g0*alpha_>>8;bytes[_i28-1]=bytes[_i28-1]*alpha+b0*alpha_>>8}}}function composeSMaskAlpha(maskData,layerData,transferMap){var length=maskData.length;var scale=1/255;for(var _i29=3;_i29<length;_i29+=4){var alpha=transferMap?transferMap[maskData[_i29]]:maskData[_i29];layerData[_i29]=layerData[_i29]*alpha*scale|0}}function composeSMaskLuminosity(maskData,layerData,transferMap){var length=maskData.length;for(var _i30=3;_i30<length;_i30+=4){var y=maskData[_i30-3]*77+maskData[_i30-2]*152+maskData[_i30-1]*28;layerData[_i30]=transferMap?layerData[_i30]*transferMap[y>>8]>>8:layerData[_i30]*y>>16}}function genericComposeSMask(maskCtx,layerCtx,width,height,subtype,backdrop,transferMap,layerOffsetX,layerOffsetY,maskOffsetX,maskOffsetY){var hasBackdrop=!!backdrop;var r0=hasBackdrop?backdrop[0]:0;var g0=hasBackdrop?backdrop[1]:0;var b0=hasBackdrop?backdrop[2]:0;var composeFn=subtype==="Luminosity"?composeSMaskLuminosity:composeSMaskAlpha;var PIXELS_TO_PROCESS=1048576;var chunkSize=Math.min(height,Math.ceil(PIXELS_TO_PROCESS/width));for(var row=0;row<height;row+=chunkSize){var chunkHeight=Math.min(chunkSize,height-row);var maskData=maskCtx.getImageData(layerOffsetX-maskOffsetX,row+(layerOffsetY-maskOffsetY),width,chunkHeight);var layerData=layerCtx.getImageData(layerOffsetX,row+layerOffsetY,width,chunkHeight);if(hasBackdrop){composeSMaskBackdrop(maskData.data,r0,g0,b0)}composeFn(maskData.data,layerData.data,transferMap);layerCtx.putImageData(layerData,layerOffsetX,row+layerOffsetY)}}function composeSMask(ctx,smask,layerCtx,layerBox){var layerOffsetX=layerBox[0];var layerOffsetY=layerBox[1];var layerWidth=layerBox[2]-layerOffsetX;var layerHeight=layerBox[3]-layerOffsetY;if(layerWidth===0||layerHeight===0){return}genericComposeSMask(smask.context,layerCtx,layerWidth,layerHeight,smask.subtype,smask.backdrop,smask.transferMap,layerOffsetX,layerOffsetY,smask.offsetX,smask.offsetY);ctx.save();ctx.globalAlpha=1;ctx.globalCompositeOperation="source-over";ctx.setTransform(1,0,0,1,0,0);ctx.drawImage(layerCtx.canvas,0,0);ctx.restore()}function getImageSmoothingEnabled(transform,interpolate){var scale=_util.Util.singularValueDecompose2dScale(transform);scale[0]=Math.fround(scale[0]);scale[1]=Math.fround(scale[1]);var actualScale=Math.fround((globalThis.devicePixelRatio||1)*_display_utils.PixelsPerInch.PDF_TO_CSS_UNITS);if(interpolate!==undefined){return interpolate}else if(scale[0]<=actualScale||scale[1]<=actualScale){return true}return false}var LINE_CAP_STYLES=["butt","round","square"];var LINE_JOIN_STYLES=["miter","round","bevel"];var NORMAL_CLIP={};var EO_CLIP={};var _restoreInitialState=new WeakSet;var _drawFilter=new WeakSet;var CanvasGraphics=function(){function CanvasGraphics(canvasCtx,commonObjs,objs,canvasFactory,filterFactory,_ref65,annotationCanvasMap,pageColors){var optionalContentConfig=_ref65.optionalContentConfig,_ref65$markedContentS=_ref65.markedContentStack,markedContentStack=_ref65$markedContentS===void 0?null:_ref65$markedContentS;_classCallCheck2(this,CanvasGraphics);_classPrivateMethodInitSpec(this,_drawFilter);_classPrivateMethodInitSpec(this,_restoreInitialState);this.ctx=canvasCtx;this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height);this.stateStack=[];this.pendingClip=null;this.pendingEOFill=false;this.res=null;this.xobjs=null;this.commonObjs=commonObjs;this.objs=objs;this.canvasFactory=canvasFactory;this.filterFactory=filterFactory;this.groupStack=[];this.processingType3=null;this.baseTransform=null;this.baseTransformStack=[];this.groupLevel=0;this.smaskStack=[];this.smaskCounter=0;this.tempSMask=null;this.suspendedCtx=null;this.contentVisible=true;this.markedContentStack=markedContentStack||[];this.optionalContentConfig=optionalContentConfig;this.cachedCanvases=new CachedCanvases(this.canvasFactory);this.cachedPatterns=new Map;this.annotationCanvasMap=annotationCanvasMap;this.viewportScale=1;this.outputScaleX=1;this.outputScaleY=1;this.pageColors=pageColors;this._cachedScaleForStroking=[-1,0];this._cachedGetSinglePixelWidth=null;this._cachedBitmapsMap=new Map}_createClass2(CanvasGraphics,[{key:"getObject",value:function getObject(data){var fallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(typeof data==="string"){return data.startsWith("g_")?this.commonObjs.get(data):this.objs.get(data)}return fallback}},{key:"beginDrawing",value:function beginDrawing(_ref66){var _this$ctx3;var transform=_ref66.transform,viewport=_ref66.viewport,_ref66$transparency=_ref66.transparency,transparency=_ref66$transparency===void 0?false:_ref66$transparency,_ref66$background=_ref66.background,background=_ref66$background===void 0?null:_ref66$background;var width=this.ctx.canvas.width;var height=this.ctx.canvas.height;var savedFillStyle=this.ctx.fillStyle;this.ctx.fillStyle=background||"#ffffff";this.ctx.fillRect(0,0,width,height);this.ctx.fillStyle=savedFillStyle;if(transparency){var _this$ctx;var transparentCanvas=this.cachedCanvases.getCanvas("transparent",width,height);this.compositeCtx=this.ctx;this.transparentCanvas=transparentCanvas.canvas;this.ctx=transparentCanvas.context;this.ctx.save();(_this$ctx=this.ctx).transform.apply(_this$ctx,_toConsumableArray2((0,_display_utils.getCurrentTransform)(this.compositeCtx)))}this.ctx.save();resetCtxToDefault(this.ctx);if(transform){var _this$ctx2;(_this$ctx2=this.ctx).transform.apply(_this$ctx2,_toConsumableArray2(transform));this.outputScaleX=transform[0];this.outputScaleY=transform[0]}(_this$ctx3=this.ctx).transform.apply(_this$ctx3,_toConsumableArray2(viewport.transform));this.viewportScale=viewport.scale;this.baseTransform=(0,_display_utils.getCurrentTransform)(this.ctx)}},{key:"executeOperatorList",value:function executeOperatorList(operatorList,executionStartIdx,continueCallback,stepper){var argsArray=operatorList.argsArray;var fnArray=operatorList.fnArray;var i=executionStartIdx||0;var argsArrayLen=argsArray.length;if(argsArrayLen===i){return i}var chunkOperations=argsArrayLen-i>EXECUTION_STEPS&&typeof continueCallback==="function";var endTime=chunkOperations?Date.now()+EXECUTION_TIME:0;var steps=0;var commonObjs=this.commonObjs;var objs=this.objs;var fnId;while(true){if(stepper!==undefined&&i===stepper.nextBreakPoint){stepper.breakIt(i,continueCallback);return i}fnId=fnArray[i];if(fnId!==_util.OPS.dependency){this[fnId].apply(this,argsArray[i])}else{var _iterator72=_createForOfIteratorHelper(argsArray[i]),_step72;try{for(_iterator72.s();!(_step72=_iterator72.n()).done;){var depObjId=_step72.value;var objsPool=depObjId.startsWith("g_")?commonObjs:objs;if(!objsPool.has(depObjId)){objsPool.get(depObjId,continueCallback);return i}}}catch(err){_iterator72.e(err)}finally{_iterator72.f()}}i++;if(i===argsArrayLen){return i}if(chunkOperations&&++steps>EXECUTION_STEPS){if(Date.now()>endTime){continueCallback();return i}steps=0}}}},{key:"endDrawing",value:function endDrawing(){_classPrivateMethodGet(this,_restoreInitialState,_restoreInitialState2).call(this);this.cachedCanvases.clear();this.cachedPatterns.clear();var _iterator73=_createForOfIteratorHelper(this._cachedBitmapsMap.values()),_step73;try{for(_iterator73.s();!(_step73=_iterator73.n()).done;){var _cache5=_step73.value;var _iterator74=_createForOfIteratorHelper(_cache5.values()),_step74;try{for(_iterator74.s();!(_step74=_iterator74.n()).done;){var canvas=_step74.value;if(typeof HTMLCanvasElement!=="undefined"&&canvas instanceof HTMLCanvasElement){canvas.width=canvas.height=0}}}catch(err){_iterator74.e(err)}finally{_iterator74.f()}_cache5.clear()}}catch(err){_iterator73.e(err)}finally{_iterator73.f()}this._cachedBitmapsMap.clear();_classPrivateMethodGet(this,_drawFilter,_drawFilter2).call(this)}},{key:"_scaleImage",value:function _scaleImage(img,inverseTransform){var width=img.width;var height=img.height;var widthScale=Math.max(Math.hypot(inverseTransform[0],inverseTransform[1]),1);var heightScale=Math.max(Math.hypot(inverseTransform[2],inverseTransform[3]),1);var paintWidth=width,paintHeight=height;var tmpCanvasId="prescale1";var tmpCanvas,tmpCtx;while(widthScale>2&&paintWidth>1||heightScale>2&&paintHeight>1){var newWidth=paintWidth,newHeight=paintHeight;if(widthScale>2&&paintWidth>1){newWidth=paintWidth>=16384?Math.floor(paintWidth/2)-1||1:Math.ceil(paintWidth/2);widthScale/=paintWidth/newWidth}if(heightScale>2&&paintHeight>1){newHeight=paintHeight>=16384?Math.floor(paintHeight/2)-1||1:Math.ceil(paintHeight)/2;heightScale/=paintHeight/newHeight}tmpCanvas=this.cachedCanvases.getCanvas(tmpCanvasId,newWidth,newHeight);tmpCtx=tmpCanvas.context;tmpCtx.clearRect(0,0,newWidth,newHeight);tmpCtx.drawImage(img,0,0,paintWidth,paintHeight,0,0,newWidth,newHeight);img=tmpCanvas.canvas;paintWidth=newWidth;paintHeight=newHeight;tmpCanvasId=tmpCanvasId==="prescale1"?"prescale2":"prescale1"}return{img:img,paintWidth:paintWidth,paintHeight:paintHeight}}},{key:"_createMaskCanvas",value:function _createMaskCanvas(img){var ctx=this.ctx;var width=img.width,height=img.height;var fillColor=this.current.fillColor;var isPatternFill=this.current.patternFill;var currentTransform=(0,_display_utils.getCurrentTransform)(ctx);var cache,cacheKey,scaled,maskCanvas;if((img.bitmap||img.data)&&img.count>1){var mainKey=img.bitmap||img.data.buffer;cacheKey=JSON.stringify(isPatternFill?currentTransform:[currentTransform.slice(0,4),fillColor]);cache=this._cachedBitmapsMap.get(mainKey);if(!cache){cache=new Map;this._cachedBitmapsMap.set(mainKey,cache)}var cachedImage=cache.get(cacheKey);if(cachedImage&&!isPatternFill){var _offsetX=Math.round(Math.min(currentTransform[0],currentTransform[2])+currentTransform[4]);var _offsetY=Math.round(Math.min(currentTransform[1],currentTransform[3])+currentTransform[5]);return{canvas:cachedImage,offsetX:_offsetX,offsetY:_offsetY}}scaled=cachedImage}if(!scaled){maskCanvas=this.cachedCanvases.getCanvas("maskCanvas",width,height);putBinaryImageMask(maskCanvas.context,img)}var maskToCanvas=_util.Util.transform(currentTransform,[1/width,0,0,-1/height,0,0]);maskToCanvas=_util.Util.transform(maskToCanvas,[1,0,0,1,0,-height]);var cord1=_util.Util.applyTransform([0,0],maskToCanvas);var cord2=_util.Util.applyTransform([width,height],maskToCanvas);var rect=_util.Util.normalizeRect([cord1[0],cord1[1],cord2[0],cord2[1]]);var drawnWidth=Math.round(rect[2]-rect[0])||1;var drawnHeight=Math.round(rect[3]-rect[1])||1;var fillCanvas=this.cachedCanvases.getCanvas("fillCanvas",drawnWidth,drawnHeight);var fillCtx=fillCanvas.context;var offsetX=Math.min(cord1[0],cord2[0]);var offsetY=Math.min(cord1[1],cord2[1]);fillCtx.translate(-offsetX,-offsetY);fillCtx.transform.apply(fillCtx,_toConsumableArray2(maskToCanvas));if(!scaled){scaled=this._scaleImage(maskCanvas.canvas,(0,_display_utils.getCurrentTransformInverse)(fillCtx));scaled=scaled.img;if(cache&&isPatternFill){cache.set(cacheKey,scaled)}}fillCtx.imageSmoothingEnabled=getImageSmoothingEnabled((0,_display_utils.getCurrentTransform)(fillCtx),img.interpolate);drawImageAtIntegerCoords(fillCtx,scaled,0,0,scaled.width,scaled.height,0,0,width,height);fillCtx.globalCompositeOperation="source-in";var inverse=_util.Util.transform((0,_display_utils.getCurrentTransformInverse)(fillCtx),[1,0,0,1,-offsetX,-offsetY]);fillCtx.fillStyle=isPatternFill?fillColor.getPattern(ctx,this,inverse,_pattern_helper.PathType.FILL):fillColor;fillCtx.fillRect(0,0,width,height);if(cache&&!isPatternFill){this.cachedCanvases["delete"]("fillCanvas");cache.set(cacheKey,fillCanvas.canvas)}return{canvas:fillCanvas.canvas,offsetX:Math.round(offsetX),offsetY:Math.round(offsetY)}}},{key:"setLineWidth",value:function setLineWidth(width){if(width!==this.current.lineWidth){this._cachedScaleForStroking[0]=-1}this.current.lineWidth=width;this.ctx.lineWidth=width}},{key:"setLineCap",value:function setLineCap(style){this.ctx.lineCap=LINE_CAP_STYLES[style]}},{key:"setLineJoin",value:function setLineJoin(style){this.ctx.lineJoin=LINE_JOIN_STYLES[style]}},{key:"setMiterLimit",value:function setMiterLimit(limit){this.ctx.miterLimit=limit}},{key:"setDash",value:function setDash(dashArray,dashPhase){var ctx=this.ctx;if(ctx.setLineDash!==undefined){ctx.setLineDash(dashArray);ctx.lineDashOffset=dashPhase}}},{key:"setRenderingIntent",value:function setRenderingIntent(intent){}},{key:"setFlatness",value:function setFlatness(flatness){}},{key:"setGState",value:function setGState(states){var _iterator75=_createForOfIteratorHelper(states),_step75;try{for(_iterator75.s();!(_step75=_iterator75.n()).done;){var _step75$value=_slicedToArray2(_step75.value,2),key=_step75$value[0],value=_step75$value[1];switch(key){case"LW":this.setLineWidth(value);break;case"LC":this.setLineCap(value);break;case"LJ":this.setLineJoin(value);break;case"ML":this.setMiterLimit(value);break;case"D":this.setDash(value[0],value[1]);break;case"RI":this.setRenderingIntent(value);break;case"FL":this.setFlatness(value);break;case"Font":this.setFont(value[0],value[1]);break;case"CA":this.current.strokeAlpha=value;break;case"ca":this.current.fillAlpha=value;this.ctx.globalAlpha=value;break;case"BM":this.ctx.globalCompositeOperation=value;break;case"SMask":this.current.activeSMask=value?this.tempSMask:null;this.tempSMask=null;this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(value);break}}}catch(err){_iterator75.e(err)}finally{_iterator75.f()}}},{key:"inSMaskMode",get:function get(){return!!this.suspendedCtx}},{key:"checkSMaskState",value:function checkSMaskState(){var inSMaskMode=this.inSMaskMode;if(this.current.activeSMask&&!inSMaskMode){this.beginSMaskMode()}else if(!this.current.activeSMask&&inSMaskMode){this.endSMaskMode()}}},{key:"beginSMaskMode",value:function beginSMaskMode(){if(this.inSMaskMode){throw new Error("beginSMaskMode called while already in smask mode")}var drawnWidth=this.ctx.canvas.width;var drawnHeight=this.ctx.canvas.height;var cacheId="smaskGroupAt"+this.groupLevel;var scratchCanvas=this.cachedCanvases.getCanvas(cacheId,drawnWidth,drawnHeight);this.suspendedCtx=this.ctx;this.ctx=scratchCanvas.context;var ctx=this.ctx;ctx.setTransform.apply(ctx,_toConsumableArray2((0,_display_utils.getCurrentTransform)(this.suspendedCtx)));copyCtxState(this.suspendedCtx,ctx);mirrorContextOperations(ctx,this.suspendedCtx);this.setGState([["BM","source-over"],["ca",1],["CA",1]])}},{key:"endSMaskMode",value:function endSMaskMode(){if(!this.inSMaskMode){throw new Error("endSMaskMode called while not in smask mode")}this.ctx._removeMirroring();copyCtxState(this.ctx,this.suspendedCtx);this.ctx=this.suspendedCtx;this.suspendedCtx=null}},{key:"compose",value:function compose(dirtyBox){if(!this.current.activeSMask){return}if(!dirtyBox){dirtyBox=[0,0,this.ctx.canvas.width,this.ctx.canvas.height]}else{dirtyBox[0]=Math.floor(dirtyBox[0]);dirtyBox[1]=Math.floor(dirtyBox[1]);dirtyBox[2]=Math.ceil(dirtyBox[2]);dirtyBox[3]=Math.ceil(dirtyBox[3])}var smask=this.current.activeSMask;var suspendedCtx=this.suspendedCtx;composeSMask(suspendedCtx,smask,this.ctx,dirtyBox);this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);this.ctx.restore()}},{key:"save",value:function save(){if(this.inSMaskMode){copyCtxState(this.ctx,this.suspendedCtx);this.suspendedCtx.save()}else{this.ctx.save()}var old=this.current;this.stateStack.push(old);this.current=old.clone()}},{key:"restore",value:function restore(){if(this.stateStack.length===0&&this.inSMaskMode){this.endSMaskMode()}if(this.stateStack.length!==0){this.current=this.stateStack.pop();if(this.inSMaskMode){this.suspendedCtx.restore();copyCtxState(this.suspendedCtx,this.ctx)}else{this.ctx.restore()}this.checkSMaskState();this.pendingClip=null;this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null}}},{key:"transform",value:function transform(a,b,c,d,e,f){this.ctx.transform(a,b,c,d,e,f);this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null}},{key:"constructPath",value:function constructPath(ops,args,minMax){var ctx=this.ctx;var current=this.current;var x=current.x,y=current.y;var startX,startY;var currentTransform=(0,_display_utils.getCurrentTransform)(ctx);var isScalingMatrix=currentTransform[0]===0&&currentTransform[3]===0||currentTransform[1]===0&&currentTransform[2]===0;var minMaxForBezier=isScalingMatrix?minMax.slice(0):null;for(var _i31=0,j=0,ii=ops.length;_i31<ii;_i31++){switch(ops[_i31]|0){case _util.OPS.rectangle:x=args[j++];y=args[j++];var width=args[j++];var height=args[j++];var xw=x+width;var yh=y+height;ctx.moveTo(x,y);if(width===0||height===0){ctx.lineTo(xw,yh)}else{ctx.lineTo(xw,y);ctx.lineTo(xw,yh);ctx.lineTo(x,yh)}if(!isScalingMatrix){current.updateRectMinMax(currentTransform,[x,y,xw,yh])}ctx.closePath();break;case _util.OPS.moveTo:x=args[j++];y=args[j++];ctx.moveTo(x,y);if(!isScalingMatrix){current.updatePathMinMax(currentTransform,x,y)}break;case _util.OPS.lineTo:x=args[j++];y=args[j++];ctx.lineTo(x,y);if(!isScalingMatrix){current.updatePathMinMax(currentTransform,x,y)}break;case _util.OPS.curveTo:startX=x;startY=y;x=args[j+4];y=args[j+5];ctx.bezierCurveTo(args[j],args[j+1],args[j+2],args[j+3],x,y);current.updateCurvePathMinMax(currentTransform,startX,startY,args[j],args[j+1],args[j+2],args[j+3],x,y,minMaxForBezier);j+=6;break;case _util.OPS.curveTo2:startX=x;startY=y;ctx.bezierCurveTo(x,y,args[j],args[j+1],args[j+2],args[j+3]);current.updateCurvePathMinMax(currentTransform,startX,startY,x,y,args[j],args[j+1],args[j+2],args[j+3],minMaxForBezier);x=args[j+2];y=args[j+3];j+=4;break;case _util.OPS.curveTo3:startX=x;startY=y;x=args[j+2];y=args[j+3];ctx.bezierCurveTo(args[j],args[j+1],x,y,x,y);current.updateCurvePathMinMax(currentTransform,startX,startY,args[j],args[j+1],x,y,x,y,minMaxForBezier);j+=4;break;case _util.OPS.closePath:ctx.closePath();break}}if(isScalingMatrix){current.updateScalingPathMinMax(currentTransform,minMaxForBezier)}current.setCurrentPoint(x,y)}},{key:"closePath",value:function closePath(){this.ctx.closePath()}},{key:"stroke",value:function stroke(){var consumePath=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var ctx=this.ctx;var strokeColor=this.current.strokeColor;ctx.globalAlpha=this.current.strokeAlpha;if(this.contentVisible){if(_typeof2(strokeColor)==="object"&&strokeColor!==null&&strokeColor!==void 0&&strokeColor.getPattern){ctx.save();ctx.strokeStyle=strokeColor.getPattern(ctx,this,(0,_display_utils.getCurrentTransformInverse)(ctx),_pattern_helper.PathType.STROKE);this.rescaleAndStroke(false);ctx.restore()}else{this.rescaleAndStroke(true)}}if(consumePath){this.consumePath(this.current.getClippedPathBoundingBox())}ctx.globalAlpha=this.current.fillAlpha}},{key:"closeStroke",value:function closeStroke(){this.closePath();this.stroke()}},{key:"fill",value:function fill(){var consumePath=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var ctx=this.ctx;var fillColor=this.current.fillColor;var isPatternFill=this.current.patternFill;var needRestore=false;if(isPatternFill){ctx.save();ctx.fillStyle=fillColor.getPattern(ctx,this,(0,_display_utils.getCurrentTransformInverse)(ctx),_pattern_helper.PathType.FILL);needRestore=true}var intersect=this.current.getClippedPathBoundingBox();if(this.contentVisible&&intersect!==null){if(this.pendingEOFill){ctx.fill("evenodd");this.pendingEOFill=false}else{ctx.fill()}}if(needRestore){ctx.restore()}if(consumePath){this.consumePath(intersect)}}},{key:"eoFill",value:function eoFill(){this.pendingEOFill=true;this.fill()}},{key:"fillStroke",value:function fillStroke(){this.fill(false);this.stroke(false);this.consumePath()}},{key:"eoFillStroke",value:function eoFillStroke(){this.pendingEOFill=true;this.fillStroke()}},{key:"closeFillStroke",value:function closeFillStroke(){this.closePath();this.fillStroke()}},{key:"closeEOFillStroke",value:function closeEOFillStroke(){this.pendingEOFill=true;this.closePath();this.fillStroke()}},{key:"endPath",value:function endPath(){this.consumePath()}},{key:"clip",value:function clip(){this.pendingClip=NORMAL_CLIP}},{key:"eoClip",value:function eoClip(){this.pendingClip=EO_CLIP}},{key:"beginText",value:function beginText(){this.current.textMatrix=_util.IDENTITY_MATRIX;this.current.textMatrixScale=1;this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0}},{key:"endText",value:function endText(){var paths=this.pendingTextPaths;var ctx=this.ctx;if(paths===undefined){ctx.beginPath();return}ctx.save();ctx.beginPath();var _iterator76=_createForOfIteratorHelper(paths),_step76;try{for(_iterator76.s();!(_step76=_iterator76.n()).done;){var path=_step76.value;ctx.setTransform.apply(ctx,_toConsumableArray2(path.transform));ctx.translate(path.x,path.y);path.addToPath(ctx,path.fontSize)}}catch(err){_iterator76.e(err)}finally{_iterator76.f()}ctx.restore();ctx.clip();ctx.beginPath();delete this.pendingTextPaths}},{key:"setCharSpacing",value:function setCharSpacing(spacing){this.current.charSpacing=spacing}},{key:"setWordSpacing",value:function setWordSpacing(spacing){this.current.wordSpacing=spacing}},{key:"setHScale",value:function setHScale(scale){this.current.textHScale=scale/100}},{key:"setLeading",value:function setLeading(leading){this.current.leading=-leading}},{key:"setFont",value:function setFont(fontRefName,size){var _fontObj$systemFontIn;var fontObj=this.commonObjs.get(fontRefName);var current=this.current;if(!fontObj){throw new Error("Can't find font for ".concat(fontRefName))}current.fontMatrix=fontObj.fontMatrix||_util.FONT_IDENTITY_MATRIX;if(current.fontMatrix[0]===0||current.fontMatrix[3]===0){(0,_util.warn)("Invalid font matrix for font "+fontRefName)}if(size<0){size=-size;current.fontDirection=-1}else{current.fontDirection=1}this.current.font=fontObj;this.current.fontSize=size;if(fontObj.isType3Font){return}var name=fontObj.loadedName||"sans-serif";var typeface=((_fontObj$systemFontIn=fontObj.systemFontInfo)===null||_fontObj$systemFontIn===void 0?void 0:_fontObj$systemFontIn.css)||"\"".concat(name,"\", ").concat(fontObj.fallbackName);var bold="normal";if(fontObj.black){bold="900"}else if(fontObj.bold){bold="bold"}var italic=fontObj.italic?"italic":"normal";var browserFontSize=size;if(size<MIN_FONT_SIZE){browserFontSize=MIN_FONT_SIZE}else if(size>MAX_FONT_SIZE){browserFontSize=MAX_FONT_SIZE}this.current.fontSizeScale=size/browserFontSize;this.ctx.font="".concat(italic," ").concat(bold," ").concat(browserFontSize,"px ").concat(typeface)}},{key:"setTextRenderingMode",value:function setTextRenderingMode(mode){this.current.textRenderingMode=mode}},{key:"setTextRise",value:function setTextRise(rise){this.current.textRise=rise}},{key:"moveText",value:function moveText(x,y){this.current.x=this.current.lineX+=x;this.current.y=this.current.lineY+=y}},{key:"setLeadingMoveText",value:function setLeadingMoveText(x,y){this.setLeading(-y);this.moveText(x,y)}},{key:"setTextMatrix",value:function setTextMatrix(a,b,c,d,e,f){this.current.textMatrix=[a,b,c,d,e,f];this.current.textMatrixScale=Math.hypot(a,b);this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0}},{key:"nextLine",value:function nextLine(){this.moveText(0,this.current.leading)}},{key:"paintChar",value:function paintChar(character,x,y,patternTransform){var ctx=this.ctx;var current=this.current;var font=current.font;var textRenderingMode=current.textRenderingMode;var fontSize=current.fontSize/current.fontSizeScale;var fillStrokeMode=textRenderingMode&_util.TextRenderingMode.FILL_STROKE_MASK;var isAddToPathSet=!!(textRenderingMode&_util.TextRenderingMode.ADD_TO_PATH_FLAG);var patternFill=current.patternFill&&!font.missingFile;var addToPath;if(font.disableFontFace||isAddToPathSet||patternFill){addToPath=font.getPathGenerator(this.commonObjs,character)}if(font.disableFontFace||patternFill){ctx.save();ctx.translate(x,y);ctx.beginPath();addToPath(ctx,fontSize);if(patternTransform){ctx.setTransform.apply(ctx,_toConsumableArray2(patternTransform))}if(fillStrokeMode===_util.TextRenderingMode.FILL||fillStrokeMode===_util.TextRenderingMode.FILL_STROKE){ctx.fill()}if(fillStrokeMode===_util.TextRenderingMode.STROKE||fillStrokeMode===_util.TextRenderingMode.FILL_STROKE){ctx.stroke()}ctx.restore()}else{if(fillStrokeMode===_util.TextRenderingMode.FILL||fillStrokeMode===_util.TextRenderingMode.FILL_STROKE){ctx.fillText(character,x,y)}if(fillStrokeMode===_util.TextRenderingMode.STROKE||fillStrokeMode===_util.TextRenderingMode.FILL_STROKE){ctx.strokeText(character,x,y)}}if(isAddToPathSet){var paths=this.pendingTextPaths||(this.pendingTextPaths=[]);paths.push({transform:(0,_display_utils.getCurrentTransform)(ctx),x:x,y:y,fontSize:fontSize,addToPath:addToPath})}}},{key:"isFontSubpixelAAEnabled",get:function get(){var _this$cachedCanvases$=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10),ctx=_this$cachedCanvases$.context;ctx.scale(1.5,1);ctx.fillText("I",0,10);var data=ctx.getImageData(0,0,10,10).data;var enabled=false;for(var _i32=3;_i32<data.length;_i32+=4){if(data[_i32]>0&&data[_i32]<255){enabled=true;break}}return(0,_util.shadow)(this,"isFontSubpixelAAEnabled",enabled)}},{key:"showText",value:function showText(glyphs){var current=this.current;var font=current.font;if(font.isType3Font){return this.showType3Text(glyphs)}var fontSize=current.fontSize;if(fontSize===0){return undefined}var ctx=this.ctx;var fontSizeScale=current.fontSizeScale;var charSpacing=current.charSpacing;var wordSpacing=current.wordSpacing;var fontDirection=current.fontDirection;var textHScale=current.textHScale*fontDirection;var glyphsLength=glyphs.length;var vertical=font.vertical;var spacingDir=vertical?1:-1;var defaultVMetrics=font.defaultVMetrics;var widthAdvanceScale=fontSize*current.fontMatrix[0];var simpleFillText=current.textRenderingMode===_util.TextRenderingMode.FILL&&!font.disableFontFace&&!current.patternFill;ctx.save();ctx.transform.apply(ctx,_toConsumableArray2(current.textMatrix));ctx.translate(current.x,current.y+current.textRise);if(fontDirection>0){ctx.scale(textHScale,-1)}else{ctx.scale(textHScale,1)}var patternTransform;if(current.patternFill){ctx.save();var pattern=current.fillColor.getPattern(ctx,this,(0,_display_utils.getCurrentTransformInverse)(ctx),_pattern_helper.PathType.FILL);patternTransform=(0,_display_utils.getCurrentTransform)(ctx);ctx.restore();ctx.fillStyle=pattern}var lineWidth=current.lineWidth;var scale=current.textMatrixScale;if(scale===0||lineWidth===0){var fillStrokeMode=current.textRenderingMode&_util.TextRenderingMode.FILL_STROKE_MASK;if(fillStrokeMode===_util.TextRenderingMode.STROKE||fillStrokeMode===_util.TextRenderingMode.FILL_STROKE){lineWidth=this.getSinglePixelWidth()}}else{lineWidth/=scale}if(fontSizeScale!==1){ctx.scale(fontSizeScale,fontSizeScale);lineWidth/=fontSizeScale}ctx.lineWidth=lineWidth;if(font.isInvalidPDFjsFont){var chars=[];var width=0;var _iterator77=_createForOfIteratorHelper(glyphs),_step77;try{for(_iterator77.s();!(_step77=_iterator77.n()).done;){var glyph=_step77.value;chars.push(glyph.unicode);width+=glyph.width}}catch(err){_iterator77.e(err)}finally{_iterator77.f()}ctx.fillText(chars.join(""),0,0);current.x+=width*widthAdvanceScale*textHScale;ctx.restore();this.compose();return undefined}var x=0,i;for(i=0;i<glyphsLength;++i){var _glyph=glyphs[i];if(typeof _glyph==="number"){x+=spacingDir*_glyph*fontSize/1000;continue}var restoreNeeded=false;var spacing=(_glyph.isSpace?wordSpacing:0)+charSpacing;var character=_glyph.fontChar;var accent=_glyph.accent;var scaledX=void 0,scaledY=void 0;var _width2=_glyph.width;if(vertical){var vmetric=_glyph.vmetric||defaultVMetrics;var vx=-(_glyph.vmetric?vmetric[1]:_width2*0.5)*widthAdvanceScale;var vy=vmetric[2]*widthAdvanceScale;_width2=vmetric?-vmetric[0]:_width2;scaledX=vx/fontSizeScale;scaledY=(x+vy)/fontSizeScale}else{scaledX=x/fontSizeScale;scaledY=0}if(font.remeasure&&_width2>0){var measuredWidth=ctx.measureText(character).width*1000/fontSize*fontSizeScale;if(_width2<measuredWidth&&this.isFontSubpixelAAEnabled){var characterScaleX=_width2/measuredWidth;restoreNeeded=true;ctx.save();ctx.scale(characterScaleX,1);scaledX/=characterScaleX}else if(_width2!==measuredWidth){scaledX+=(_width2-measuredWidth)/2000*fontSize/fontSizeScale}}if(this.contentVisible&&(_glyph.isInFont||font.missingFile)){if(simpleFillText&&!accent){ctx.fillText(character,scaledX,scaledY)}else{this.paintChar(character,scaledX,scaledY,patternTransform);if(accent){var scaledAccentX=scaledX+fontSize*accent.offset.x/fontSizeScale;var scaledAccentY=scaledY-fontSize*accent.offset.y/fontSizeScale;this.paintChar(accent.fontChar,scaledAccentX,scaledAccentY,patternTransform)}}}var charWidth=vertical?_width2*widthAdvanceScale-spacing*fontDirection:_width2*widthAdvanceScale+spacing*fontDirection;x+=charWidth;if(restoreNeeded){ctx.restore()}}if(vertical){current.y-=x}else{current.x+=x*textHScale}ctx.restore();this.compose();return undefined}},{key:"showType3Text",value:function showType3Text(glyphs){var ctx=this.ctx;var current=this.current;var font=current.font;var fontSize=current.fontSize;var fontDirection=current.fontDirection;var spacingDir=font.vertical?1:-1;var charSpacing=current.charSpacing;var wordSpacing=current.wordSpacing;var textHScale=current.textHScale*fontDirection;var fontMatrix=current.fontMatrix||_util.FONT_IDENTITY_MATRIX;var glyphsLength=glyphs.length;var isTextInvisible=current.textRenderingMode===_util.TextRenderingMode.INVISIBLE;var i,glyph,width,spacingLength;if(isTextInvisible||fontSize===0){return}this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null;ctx.save();ctx.transform.apply(ctx,_toConsumableArray2(current.textMatrix));ctx.translate(current.x,current.y);ctx.scale(textHScale,fontDirection);for(i=0;i<glyphsLength;++i){glyph=glyphs[i];if(typeof glyph==="number"){spacingLength=spacingDir*glyph*fontSize/1000;this.ctx.translate(spacingLength,0);current.x+=spacingLength*textHScale;continue}var spacing=(glyph.isSpace?wordSpacing:0)+charSpacing;var operatorList=font.charProcOperatorList[glyph.operatorListId];if(!operatorList){(0,_util.warn)("Type3 character \"".concat(glyph.operatorListId,"\" is not available."));continue}if(this.contentVisible){this.processingType3=glyph;this.save();ctx.scale(fontSize,fontSize);ctx.transform.apply(ctx,_toConsumableArray2(fontMatrix));this.executeOperatorList(operatorList);this.restore()}var transformed=_util.Util.applyTransform([glyph.width,0],fontMatrix);width=transformed[0]*fontSize+spacing;ctx.translate(width,0);current.x+=width*textHScale}ctx.restore();this.processingType3=null}},{key:"setCharWidth",value:function setCharWidth(xWidth,yWidth){}},{key:"setCharWidthAndBounds",value:function setCharWidthAndBounds(xWidth,yWidth,llx,lly,urx,ury){this.ctx.rect(llx,lly,urx-llx,ury-lly);this.ctx.clip();this.endPath()}},{key:"getColorN_Pattern",value:function getColorN_Pattern(IR){var _this78=this;var pattern;if(IR[0]==="TilingPattern"){var color=IR[1];var baseTransform=this.baseTransform||(0,_display_utils.getCurrentTransform)(this.ctx);var canvasGraphicsFactory={createCanvasGraphics:function createCanvasGraphics(ctx){return new CanvasGraphics(ctx,_this78.commonObjs,_this78.objs,_this78.canvasFactory,_this78.filterFactory,{optionalContentConfig:_this78.optionalContentConfig,markedContentStack:_this78.markedContentStack})}};pattern=new _pattern_helper.TilingPattern(IR,color,this.ctx,canvasGraphicsFactory,baseTransform)}else{pattern=this._getPattern(IR[1],IR[2])}return pattern}},{key:"setStrokeColorN",value:function setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}},{key:"setFillColorN",value:function setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments);this.current.patternFill=true}},{key:"setStrokeRGBColor",value:function setStrokeRGBColor(r,g,b){var color=_util.Util.makeHexColor(r,g,b);this.ctx.strokeStyle=color;this.current.strokeColor=color}},{key:"setFillRGBColor",value:function setFillRGBColor(r,g,b){var color=_util.Util.makeHexColor(r,g,b);this.ctx.fillStyle=color;this.current.fillColor=color;this.current.patternFill=false}},{key:"_getPattern",value:function _getPattern(objId){var matrix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var pattern;if(this.cachedPatterns.has(objId)){pattern=this.cachedPatterns.get(objId)}else{pattern=(0,_pattern_helper.getShadingPattern)(this.getObject(objId));this.cachedPatterns.set(objId,pattern)}if(matrix){pattern.matrix=matrix}return pattern}},{key:"shadingFill",value:function shadingFill(objId){if(!this.contentVisible){return}var ctx=this.ctx;this.save();var pattern=this._getPattern(objId);ctx.fillStyle=pattern.getPattern(ctx,this,(0,_display_utils.getCurrentTransformInverse)(ctx),_pattern_helper.PathType.SHADING);var inv=(0,_display_utils.getCurrentTransformInverse)(ctx);if(inv){var _ctx$canvas=ctx.canvas,width=_ctx$canvas.width,height=_ctx$canvas.height;var _util$Util$getAxialAl=_util.Util.getAxialAlignedBoundingBox([0,0,width,height],inv),_util$Util$getAxialAl2=_slicedToArray2(_util$Util$getAxialAl,4),x0=_util$Util$getAxialAl2[0],y0=_util$Util$getAxialAl2[1],x1=_util$Util$getAxialAl2[2],y1=_util$Util$getAxialAl2[3];this.ctx.fillRect(x0,y0,x1-x0,y1-y0)}else{this.ctx.fillRect(-1e10,-1e10,2e10,2e10)}this.compose(this.current.getClippedPathBoundingBox());this.restore()}},{key:"beginInlineImage",value:function beginInlineImage(){(0,_util.unreachable)("Should not call beginInlineImage")}},{key:"beginImageData",value:function beginImageData(){(0,_util.unreachable)("Should not call beginImageData")}},{key:"paintFormXObjectBegin",value:function paintFormXObjectBegin(matrix,bbox){if(!this.contentVisible){return}this.save();this.baseTransformStack.push(this.baseTransform);if(Array.isArray(matrix)&&matrix.length===6){this.transform.apply(this,_toConsumableArray2(matrix))}this.baseTransform=(0,_display_utils.getCurrentTransform)(this.ctx);if(bbox){var width=bbox[2]-bbox[0];var height=bbox[3]-bbox[1];this.ctx.rect(bbox[0],bbox[1],width,height);this.current.updateRectMinMax((0,_display_utils.getCurrentTransform)(this.ctx),bbox);this.clip();this.endPath()}}},{key:"paintFormXObjectEnd",value:function paintFormXObjectEnd(){if(!this.contentVisible){return}this.restore();this.baseTransform=this.baseTransformStack.pop()}},{key:"beginGroup",value:function beginGroup(group){if(!this.contentVisible){return}this.save();if(this.inSMaskMode){this.endSMaskMode();this.current.activeSMask=null}var currentCtx=this.ctx;if(!group.isolated){(0,_util.info)("TODO: Support non-isolated groups.")}if(group.knockout){(0,_util.warn)("Knockout groups not supported.")}var currentTransform=(0,_display_utils.getCurrentTransform)(currentCtx);if(group.matrix){currentCtx.transform.apply(currentCtx,_toConsumableArray2(group.matrix))}if(!group.bbox){throw new Error("Bounding box is required.")}var bounds=_util.Util.getAxialAlignedBoundingBox(group.bbox,(0,_display_utils.getCurrentTransform)(currentCtx));var canvasBounds=[0,0,currentCtx.canvas.width,currentCtx.canvas.height];bounds=_util.Util.intersect(bounds,canvasBounds)||[0,0,0,0];var offsetX=Math.floor(bounds[0]);var offsetY=Math.floor(bounds[1]);var drawnWidth=Math.max(Math.ceil(bounds[2])-offsetX,1);var drawnHeight=Math.max(Math.ceil(bounds[3])-offsetY,1);var scaleX=1,scaleY=1;if(drawnWidth>MAX_GROUP_SIZE){scaleX=drawnWidth/MAX_GROUP_SIZE;drawnWidth=MAX_GROUP_SIZE}if(drawnHeight>MAX_GROUP_SIZE){scaleY=drawnHeight/MAX_GROUP_SIZE;drawnHeight=MAX_GROUP_SIZE}this.current.startNewPathAndClipBox([0,0,drawnWidth,drawnHeight]);var cacheId="groupAt"+this.groupLevel;if(group.smask){cacheId+="_smask_"+this.smaskCounter++%2}var scratchCanvas=this.cachedCanvases.getCanvas(cacheId,drawnWidth,drawnHeight);var groupCtx=scratchCanvas.context;groupCtx.scale(1/scaleX,1/scaleY);groupCtx.translate(-offsetX,-offsetY);groupCtx.transform.apply(groupCtx,_toConsumableArray2(currentTransform));if(group.smask){this.smaskStack.push({canvas:scratchCanvas.canvas,context:groupCtx,offsetX:offsetX,offsetY:offsetY,scaleX:scaleX,scaleY:scaleY,subtype:group.smask.subtype,backdrop:group.smask.backdrop,transferMap:group.smask.transferMap||null,startTransformInverse:null})}else{currentCtx.setTransform(1,0,0,1,0,0);currentCtx.translate(offsetX,offsetY);currentCtx.scale(scaleX,scaleY);currentCtx.save()}copyCtxState(currentCtx,groupCtx);this.ctx=groupCtx;this.setGState([["BM","source-over"],["ca",1],["CA",1]]);this.groupStack.push(currentCtx);this.groupLevel++}},{key:"endGroup",value:function endGroup(group){if(!this.contentVisible){return}this.groupLevel--;var groupCtx=this.ctx;var ctx=this.groupStack.pop();this.ctx=ctx;this.ctx.imageSmoothingEnabled=false;if(group.smask){this.tempSMask=this.smaskStack.pop();this.restore()}else{var _this$ctx4;this.ctx.restore();var currentMtx=(0,_display_utils.getCurrentTransform)(this.ctx);this.restore();this.ctx.save();(_this$ctx4=this.ctx).setTransform.apply(_this$ctx4,_toConsumableArray2(currentMtx));var dirtyBox=_util.Util.getAxialAlignedBoundingBox([0,0,groupCtx.canvas.width,groupCtx.canvas.height],currentMtx);this.ctx.drawImage(groupCtx.canvas,0,0);this.ctx.restore();this.compose(dirtyBox)}}},{key:"beginAnnotation",value:function beginAnnotation(id,rect,transform,matrix,hasOwnCanvas){_classPrivateMethodGet(this,_restoreInitialState,_restoreInitialState2).call(this);resetCtxToDefault(this.ctx);this.ctx.save();this.save();if(this.baseTransform){var _this$ctx5;(_this$ctx5=this.ctx).setTransform.apply(_this$ctx5,_toConsumableArray2(this.baseTransform))}if(Array.isArray(rect)&&rect.length===4){var width=rect[2]-rect[0];var height=rect[3]-rect[1];if(hasOwnCanvas&&this.annotationCanvasMap){transform=transform.slice();transform[4]-=rect[0];transform[5]-=rect[1];rect=rect.slice();rect[0]=rect[1]=0;rect[2]=width;rect[3]=height;var _util$Util$singularVa=_util.Util.singularValueDecompose2dScale((0,_display_utils.getCurrentTransform)(this.ctx)),_util$Util$singularVa2=_slicedToArray2(_util$Util$singularVa,2),scaleX=_util$Util$singularVa2[0],scaleY=_util$Util$singularVa2[1];var viewportScale=this.viewportScale;var canvasWidth=Math.ceil(width*this.outputScaleX*viewportScale);var canvasHeight=Math.ceil(height*this.outputScaleY*viewportScale);this.annotationCanvas=this.canvasFactory.create(canvasWidth,canvasHeight);var _this$annotationCanva=this.annotationCanvas,canvas=_this$annotationCanva.canvas,context=_this$annotationCanva.context;this.annotationCanvasMap.set(id,canvas);this.annotationCanvas.savedCtx=this.ctx;this.ctx=context;this.ctx.save();this.ctx.setTransform(scaleX,0,0,-scaleY,0,height*scaleY);resetCtxToDefault(this.ctx)}else{resetCtxToDefault(this.ctx);this.ctx.rect(rect[0],rect[1],width,height);this.ctx.clip();this.endPath()}}this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height);this.transform.apply(this,_toConsumableArray2(transform));this.transform.apply(this,_toConsumableArray2(matrix))}},{key:"endAnnotation",value:function endAnnotation(){if(this.annotationCanvas){this.ctx.restore();_classPrivateMethodGet(this,_drawFilter,_drawFilter2).call(this);this.ctx=this.annotationCanvas.savedCtx;delete this.annotationCanvas.savedCtx;delete this.annotationCanvas}}},{key:"paintImageMaskXObject",value:function paintImageMaskXObject(img){if(!this.contentVisible){return}var count=img.count;img=this.getObject(img.data,img);img.count=count;var ctx=this.ctx;var glyph=this.processingType3;if(glyph){if(glyph.compiled===undefined){glyph.compiled=compileType3Glyph(img)}if(glyph.compiled){glyph.compiled(ctx);return}}var mask=this._createMaskCanvas(img);var maskCanvas=mask.canvas;ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.drawImage(maskCanvas,mask.offsetX,mask.offsetY);ctx.restore();this.compose()}},{key:"paintImageMaskXObjectRepeat",value:function paintImageMaskXObjectRepeat(img,scaleX){var skewX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var skewY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var scaleY=arguments.length>4?arguments[4]:undefined;var positions=arguments.length>5?arguments[5]:undefined;if(!this.contentVisible){return}img=this.getObject(img.data,img);var ctx=this.ctx;ctx.save();var currentTransform=(0,_display_utils.getCurrentTransform)(ctx);ctx.transform(scaleX,skewX,skewY,scaleY,0,0);var mask=this._createMaskCanvas(img);ctx.setTransform(1,0,0,1,mask.offsetX-currentTransform[4],mask.offsetY-currentTransform[5]);for(var _i33=0,ii=positions.length;_i33<ii;_i33+=2){var trans=_util.Util.transform(currentTransform,[scaleX,skewX,skewY,scaleY,positions[_i33],positions[_i33+1]]);var _util$Util$applyTrans3=_util.Util.applyTransform([0,0],trans),_util$Util$applyTrans4=_slicedToArray2(_util$Util$applyTrans3,2),x=_util$Util$applyTrans4[0],y=_util$Util$applyTrans4[1];ctx.drawImage(mask.canvas,x,y)}ctx.restore();this.compose()}},{key:"paintImageMaskXObjectGroup",value:function paintImageMaskXObjectGroup(images){if(!this.contentVisible){return}var ctx=this.ctx;var fillColor=this.current.fillColor;var isPatternFill=this.current.patternFill;var _iterator78=_createForOfIteratorHelper(images),_step78;try{for(_iterator78.s();!(_step78=_iterator78.n()).done;){var image=_step78.value;var _data5=image.data,width=image.width,height=image.height,transform=image.transform;var maskCanvas=this.cachedCanvases.getCanvas("maskCanvas",width,height);var maskCtx=maskCanvas.context;maskCtx.save();var img=this.getObject(_data5,image);putBinaryImageMask(maskCtx,img);maskCtx.globalCompositeOperation="source-in";maskCtx.fillStyle=isPatternFill?fillColor.getPattern(maskCtx,this,(0,_display_utils.getCurrentTransformInverse)(ctx),_pattern_helper.PathType.FILL):fillColor;maskCtx.fillRect(0,0,width,height);maskCtx.restore();ctx.save();ctx.transform.apply(ctx,_toConsumableArray2(transform));ctx.scale(1,-1);drawImageAtIntegerCoords(ctx,maskCanvas.canvas,0,0,width,height,0,-1,1,1);ctx.restore()}}catch(err){_iterator78.e(err)}finally{_iterator78.f()}this.compose()}},{key:"paintImageXObject",value:function paintImageXObject(objId){if(!this.contentVisible){return}var imgData=this.getObject(objId);if(!imgData){(0,_util.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(imgData)}},{key:"paintImageXObjectRepeat",value:function paintImageXObjectRepeat(objId,scaleX,scaleY,positions){if(!this.contentVisible){return}var imgData=this.getObject(objId);if(!imgData){(0,_util.warn)("Dependent image isn't ready yet");return}var width=imgData.width;var height=imgData.height;var map=[];for(var _i34=0,ii=positions.length;_i34<ii;_i34+=2){map.push({transform:[scaleX,0,0,scaleY,positions[_i34],positions[_i34+1]],x:0,y:0,w:width,h:height})}this.paintInlineImageXObjectGroup(imgData,map)}},{key:"applyTransferMapsToCanvas",value:function applyTransferMapsToCanvas(ctx){if(this.current.transferMaps!=="none"){ctx.filter=this.current.transferMaps;ctx.drawImage(ctx.canvas,0,0);ctx.filter="none"}return ctx.canvas}},{key:"applyTransferMapsToBitmap",value:function applyTransferMapsToBitmap(imgData){if(this.current.transferMaps==="none"){return imgData.bitmap}var bitmap=imgData.bitmap,width=imgData.width,height=imgData.height;var tmpCanvas=this.cachedCanvases.getCanvas("inlineImage",width,height);var tmpCtx=tmpCanvas.context;tmpCtx.filter=this.current.transferMaps;tmpCtx.drawImage(bitmap,0,0);tmpCtx.filter="none";return tmpCanvas.canvas}},{key:"paintInlineImageXObject",value:function paintInlineImageXObject(imgData){if(!this.contentVisible){return}var width=imgData.width;var height=imgData.height;var ctx=this.ctx;this.save();if(!_util.isNodeJS){var filter=ctx.filter;if(filter!=="none"&&filter!==""){ctx.filter="none"}}ctx.scale(1/width,-1/height);var imgToPaint;if(imgData.bitmap){imgToPaint=this.applyTransferMapsToBitmap(imgData)}else if(typeof HTMLElement==="function"&&imgData instanceof HTMLElement||!imgData.data){imgToPaint=imgData}else{var tmpCanvas=this.cachedCanvases.getCanvas("inlineImage",width,height);var tmpCtx=tmpCanvas.context;putBinaryImageData(tmpCtx,imgData);imgToPaint=this.applyTransferMapsToCanvas(tmpCtx)}var scaled=this._scaleImage(imgToPaint,(0,_display_utils.getCurrentTransformInverse)(ctx));ctx.imageSmoothingEnabled=getImageSmoothingEnabled((0,_display_utils.getCurrentTransform)(ctx),imgData.interpolate);drawImageAtIntegerCoords(ctx,scaled.img,0,0,scaled.paintWidth,scaled.paintHeight,0,-height,width,height);this.compose();this.restore()}},{key:"paintInlineImageXObjectGroup",value:function paintInlineImageXObjectGroup(imgData,map){if(!this.contentVisible){return}var ctx=this.ctx;var imgToPaint;if(imgData.bitmap){imgToPaint=imgData.bitmap}else{var w=imgData.width;var h=imgData.height;var tmpCanvas=this.cachedCanvases.getCanvas("inlineImage",w,h);var tmpCtx=tmpCanvas.context;putBinaryImageData(tmpCtx,imgData);imgToPaint=this.applyTransferMapsToCanvas(tmpCtx)}var _iterator79=_createForOfIteratorHelper(map),_step79;try{for(_iterator79.s();!(_step79=_iterator79.n()).done;){var entry=_step79.value;ctx.save();ctx.transform.apply(ctx,_toConsumableArray2(entry.transform));ctx.scale(1,-1);drawImageAtIntegerCoords(ctx,imgToPaint,entry.x,entry.y,entry.w,entry.h,0,-1,1,1);ctx.restore()}}catch(err){_iterator79.e(err)}finally{_iterator79.f()}this.compose()}},{key:"paintSolidColorImageMask",value:function paintSolidColorImageMask(){if(!this.contentVisible){return}this.ctx.fillRect(0,0,1,1);this.compose()}},{key:"markPoint",value:function markPoint(tag){}},{key:"markPointProps",value:function markPointProps(tag,properties){}},{key:"beginMarkedContent",value:function beginMarkedContent(tag){this.markedContentStack.push({visible:true})}},{key:"beginMarkedContentProps",value:function beginMarkedContentProps(tag,properties){if(tag==="OC"){this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(properties)})}else{this.markedContentStack.push({visible:true})}this.contentVisible=this.isContentVisible()}},{key:"endMarkedContent",value:function endMarkedContent(){this.markedContentStack.pop();this.contentVisible=this.isContentVisible()}},{key:"beginCompat",value:function beginCompat(){}},{key:"endCompat",value:function endCompat(){}},{key:"consumePath",value:function consumePath(clipBox){var isEmpty=this.current.isEmptyClip();if(this.pendingClip){this.current.updateClipFromPath()}if(!this.pendingClip){this.compose(clipBox)}var ctx=this.ctx;if(this.pendingClip){if(!isEmpty){if(this.pendingClip===EO_CLIP){ctx.clip("evenodd")}else{ctx.clip()}}this.pendingClip=null}this.current.startNewPathAndClipBox(this.current.clipBox);ctx.beginPath()}},{key:"getSinglePixelWidth",value:function getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){var m=(0,_display_utils.getCurrentTransform)(this.ctx);if(m[1]===0&&m[2]===0){this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(m[0]),Math.abs(m[3]))}else{var absDet=Math.abs(m[0]*m[3]-m[2]*m[1]);var normX=Math.hypot(m[0],m[2]);var normY=Math.hypot(m[1],m[3]);this._cachedGetSinglePixelWidth=Math.max(normX,normY)/absDet}}return this._cachedGetSinglePixelWidth}},{key:"getScaleForStroking",value:function getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){var lineWidth=this.current.lineWidth;var _this$ctx$getTransfor=this.ctx.getTransform(),a=_this$ctx$getTransfor.a,b=_this$ctx$getTransfor.b,c=_this$ctx$getTransfor.c,d=_this$ctx$getTransfor.d;var scaleX,scaleY;if(b===0&&c===0){var normX=Math.abs(a);var normY=Math.abs(d);if(normX===normY){if(lineWidth===0){scaleX=scaleY=1/normX}else{var scaledLineWidth=normX*lineWidth;scaleX=scaleY=scaledLineWidth<1?1/scaledLineWidth:1}}else if(lineWidth===0){scaleX=1/normX;scaleY=1/normY}else{var scaledXLineWidth=normX*lineWidth;var scaledYLineWidth=normY*lineWidth;scaleX=scaledXLineWidth<1?1/scaledXLineWidth:1;scaleY=scaledYLineWidth<1?1/scaledYLineWidth:1}}else{var absDet=Math.abs(a*d-b*c);var _normX=Math.hypot(a,b);var _normY=Math.hypot(c,d);if(lineWidth===0){scaleX=_normY/absDet;scaleY=_normX/absDet}else{var baseArea=lineWidth*absDet;scaleX=_normY>baseArea?_normY/baseArea:1;scaleY=_normX>baseArea?_normX/baseArea:1}}this._cachedScaleForStroking[0]=scaleX;this._cachedScaleForStroking[1]=scaleY}return this._cachedScaleForStroking}},{key:"rescaleAndStroke",value:function rescaleAndStroke(saveRestore){var ctx=this.ctx;var lineWidth=this.current.lineWidth;var _this$getScaleForStro=this.getScaleForStroking(),_this$getScaleForStro2=_slicedToArray2(_this$getScaleForStro,2),scaleX=_this$getScaleForStro2[0],scaleY=_this$getScaleForStro2[1];ctx.lineWidth=lineWidth||1;if(scaleX===1&&scaleY===1){ctx.stroke();return}var dashes=ctx.getLineDash();if(saveRestore){ctx.save()}ctx.scale(scaleX,scaleY);if(dashes.length>0){var scale=Math.max(scaleX,scaleY);ctx.setLineDash(dashes.map(function(x){return x/scale}));ctx.lineDashOffset/=scale}ctx.stroke();if(saveRestore){ctx.restore()}}},{key:"isContentVisible",value:function isContentVisible(){for(var _i35=this.markedContentStack.length-1;_i35>=0;_i35--){if(!this.markedContentStack[_i35].visible){return false}}return true}}]);return CanvasGraphics}();function _restoreInitialState2(){while(this.stateStack.length||this.inSMaskMode){this.restore()}this.ctx.restore();if(this.transparentCanvas){this.ctx=this.compositeCtx;this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.drawImage(this.transparentCanvas,0,0);this.ctx.restore();this.transparentCanvas=null}}function _drawFilter2(){if(this.pageColors){var hcmFilterId=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(hcmFilterId!=="none"){var savedFilter=this.ctx.filter;this.ctx.filter=hcmFilterId;this.ctx.drawImage(this.ctx.canvas,0,0);this.ctx.filter=savedFilter}}}exports.CanvasGraphics=CanvasGraphics;for(var op in _util.OPS){if(CanvasGraphics.prototype[op]!==undefined){CanvasGraphics.prototype[_util.OPS[op]]=CanvasGraphics.prototype[op]}}}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.TilingPattern=exports.PathType=void 0;exports.getShadingPattern=getShadingPattern;var _util=__w_pdfjs_require__(1);var _display_utils=__w_pdfjs_require__(6);var PathType={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};exports.PathType=PathType;function applyBoundingBox(ctx,bbox){if(!bbox){return}var width=bbox[2]-bbox[0];var height=bbox[3]-bbox[1];var region=new Path2D;region.rect(bbox[0],bbox[1],width,height);ctx.clip(region)}var BaseShadingPattern=function(){function BaseShadingPattern(){_classCallCheck2(this,BaseShadingPattern);if(this.constructor===BaseShadingPattern){(0,_util.unreachable)("Cannot initialize BaseShadingPattern.")}}_createClass2(BaseShadingPattern,[{key:"getPattern",value:function getPattern(){(0,_util.unreachable)("Abstract method `getPattern` called.")}}]);return BaseShadingPattern}();var RadialAxialShadingPattern=function(_BaseShadingPattern){_inherits2(RadialAxialShadingPattern,_BaseShadingPattern);var _super32=_createSuper(RadialAxialShadingPattern);function RadialAxialShadingPattern(IR){var _this79;_classCallCheck2(this,RadialAxialShadingPattern);_this79=_super32.call(this);_this79._type=IR[1];_this79._bbox=IR[2];_this79._colorStops=IR[3];_this79._p0=IR[4];_this79._p1=IR[5];_this79._r0=IR[6];_this79._r1=IR[7];_this79.matrix=null;return _this79}_createClass2(RadialAxialShadingPattern,[{key:"_createGradient",value:function _createGradient(ctx){var grad;if(this._type==="axial"){grad=ctx.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1])}else if(this._type==="radial"){grad=ctx.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1)}var _iterator80=_createForOfIteratorHelper(this._colorStops),_step80;try{for(_iterator80.s();!(_step80=_iterator80.n()).done;){var colorStop=_step80.value;grad.addColorStop(colorStop[0],colorStop[1])}}catch(err){_iterator80.e(err)}finally{_iterator80.f()}return grad}},{key:"getPattern",value:function getPattern(ctx,owner,inverse,pathType){var pattern;if(pathType===PathType.STROKE||pathType===PathType.FILL){var ownerBBox=owner.current.getClippedPathBoundingBox(pathType,(0,_display_utils.getCurrentTransform)(ctx))||[0,0,0,0];var width=Math.ceil(ownerBBox[2]-ownerBBox[0])||1;var height=Math.ceil(ownerBBox[3]-ownerBBox[1])||1;var tmpCanvas=owner.cachedCanvases.getCanvas("pattern",width,height,true);var tmpCtx=tmpCanvas.context;tmpCtx.clearRect(0,0,tmpCtx.canvas.width,tmpCtx.canvas.height);tmpCtx.beginPath();tmpCtx.rect(0,0,tmpCtx.canvas.width,tmpCtx.canvas.height);tmpCtx.translate(-ownerBBox[0],-ownerBBox[1]);inverse=_util.Util.transform(inverse,[1,0,0,1,ownerBBox[0],ownerBBox[1]]);tmpCtx.transform.apply(tmpCtx,_toConsumableArray2(owner.baseTransform));if(this.matrix){tmpCtx.transform.apply(tmpCtx,_toConsumableArray2(this.matrix))}applyBoundingBox(tmpCtx,this._bbox);tmpCtx.fillStyle=this._createGradient(tmpCtx);tmpCtx.fill();pattern=ctx.createPattern(tmpCanvas.canvas,"no-repeat");var domMatrix=new DOMMatrix(inverse);pattern.setTransform(domMatrix)}else{applyBoundingBox(ctx,this._bbox);pattern=this._createGradient(ctx)}return pattern}}]);return RadialAxialShadingPattern}(BaseShadingPattern);function drawTriangle(data,context,p1,p2,p3,c1,c2,c3){var coords=context.coords,colors=context.colors;var bytes=data.data,rowSize=data.width*4;var tmp;if(coords[p1+1]>coords[p2+1]){tmp=p1;p1=p2;p2=tmp;tmp=c1;c1=c2;c2=tmp}if(coords[p2+1]>coords[p3+1]){tmp=p2;p2=p3;p3=tmp;tmp=c2;c2=c3;c3=tmp}if(coords[p1+1]>coords[p2+1]){tmp=p1;p1=p2;p2=tmp;tmp=c1;c1=c2;c2=tmp}var x1=(coords[p1]+context.offsetX)*context.scaleX;var y1=(coords[p1+1]+context.offsetY)*context.scaleY;var x2=(coords[p2]+context.offsetX)*context.scaleX;var y2=(coords[p2+1]+context.offsetY)*context.scaleY;var x3=(coords[p3]+context.offsetX)*context.scaleX;var y3=(coords[p3+1]+context.offsetY)*context.scaleY;if(y1>=y3){return}var c1r=colors[c1],c1g=colors[c1+1],c1b=colors[c1+2];var c2r=colors[c2],c2g=colors[c2+1],c2b=colors[c2+2];var c3r=colors[c3],c3g=colors[c3+1],c3b=colors[c3+2];var minY=Math.round(y1),maxY=Math.round(y3);var xa,car,cag,cab;var xb,cbr,cbg,cbb;for(var y=minY;y<=maxY;y++){if(y<y2){var _k2=y<y1?0:(y1-y)/(y1-y2);xa=x1-(x1-x2)*_k2;car=c1r-(c1r-c2r)*_k2;cag=c1g-(c1g-c2g)*_k2;cab=c1b-(c1b-c2b)*_k2}else{var _k3=void 0;if(y>y3){_k3=1}else if(y2===y3){_k3=0}else{_k3=(y2-y)/(y2-y3)}xa=x2-(x2-x3)*_k3;car=c2r-(c2r-c3r)*_k3;cag=c2g-(c2g-c3g)*_k3;cab=c2b-(c2b-c3b)*_k3}var k=void 0;if(y<y1){k=0}else if(y>y3){k=1}else{k=(y1-y)/(y1-y3)}xb=x1-(x1-x3)*k;cbr=c1r-(c1r-c3r)*k;cbg=c1g-(c1g-c3g)*k;cbb=c1b-(c1b-c3b)*k;var x1_=Math.round(Math.min(xa,xb));var x2_=Math.round(Math.max(xa,xb));var j=rowSize*y+x1_*4;for(var x=x1_;x<=x2_;x++){k=(xa-x)/(xa-xb);if(k<0){k=0}else if(k>1){k=1}bytes[j++]=car-(car-cbr)*k|0;bytes[j++]=cag-(cag-cbg)*k|0;bytes[j++]=cab-(cab-cbb)*k|0;bytes[j++]=255}}}function drawFigure(data,figure,context){var ps=figure.coords;var cs=figure.colors;var i,ii;switch(figure.type){case"lattice":var verticesPerRow=figure.verticesPerRow;var rows=Math.floor(ps.length/verticesPerRow)-1;var cols=verticesPerRow-1;for(i=0;i<rows;i++){var q=i*verticesPerRow;for(var j=0;j<cols;j++,q++){drawTriangle(data,context,ps[q],ps[q+1],ps[q+verticesPerRow],cs[q],cs[q+1],cs[q+verticesPerRow]);drawTriangle(data,context,ps[q+verticesPerRow+1],ps[q+1],ps[q+verticesPerRow],cs[q+verticesPerRow+1],cs[q+1],cs[q+verticesPerRow])}}break;case"triangles":for(i=0,ii=ps.length;i<ii;i+=3){drawTriangle(data,context,ps[i],ps[i+1],ps[i+2],cs[i],cs[i+1],cs[i+2])}break;default:throw new Error("illegal figure")}}var MeshShadingPattern=function(_BaseShadingPattern2){_inherits2(MeshShadingPattern,_BaseShadingPattern2);var _super33=_createSuper(MeshShadingPattern);function MeshShadingPattern(IR){var _this80;_classCallCheck2(this,MeshShadingPattern);_this80=_super33.call(this);_this80._coords=IR[2];_this80._colors=IR[3];_this80._figures=IR[4];_this80._bounds=IR[5];_this80._bbox=IR[7];_this80._background=IR[8];_this80.matrix=null;return _this80}_createClass2(MeshShadingPattern,[{key:"_createMeshCanvas",value:function _createMeshCanvas(combinedScale,backgroundColor,cachedCanvases){var EXPECTED_SCALE=1.1;var MAX_PATTERN_SIZE=3000;var BORDER_SIZE=2;var offsetX=Math.floor(this._bounds[0]);var offsetY=Math.floor(this._bounds[1]);var boundsWidth=Math.ceil(this._bounds[2])-offsetX;var boundsHeight=Math.ceil(this._bounds[3])-offsetY;var width=Math.min(Math.ceil(Math.abs(boundsWidth*combinedScale[0]*EXPECTED_SCALE)),MAX_PATTERN_SIZE);var height=Math.min(Math.ceil(Math.abs(boundsHeight*combinedScale[1]*EXPECTED_SCALE)),MAX_PATTERN_SIZE);var scaleX=boundsWidth/width;var scaleY=boundsHeight/height;var context={coords:this._coords,colors:this._colors,offsetX:-offsetX,offsetY:-offsetY,scaleX:1/scaleX,scaleY:1/scaleY};var paddedWidth=width+BORDER_SIZE*2;var paddedHeight=height+BORDER_SIZE*2;var tmpCanvas=cachedCanvases.getCanvas("mesh",paddedWidth,paddedHeight,false);var tmpCtx=tmpCanvas.context;var data=tmpCtx.createImageData(width,height);if(backgroundColor){var bytes=data.data;for(var _i36=0,ii=bytes.length;_i36<ii;_i36+=4){bytes[_i36]=backgroundColor[0];bytes[_i36+1]=backgroundColor[1];bytes[_i36+2]=backgroundColor[2];bytes[_i36+3]=255}}var _iterator81=_createForOfIteratorHelper(this._figures),_step81;try{for(_iterator81.s();!(_step81=_iterator81.n()).done;){var figure=_step81.value;drawFigure(data,figure,context)}}catch(err){_iterator81.e(err)}finally{_iterator81.f()}tmpCtx.putImageData(data,BORDER_SIZE,BORDER_SIZE);var canvas=tmpCanvas.canvas;return{canvas:canvas,offsetX:offsetX-BORDER_SIZE*scaleX,offsetY:offsetY-BORDER_SIZE*scaleY,scaleX:scaleX,scaleY:scaleY}}},{key:"getPattern",value:function getPattern(ctx,owner,inverse,pathType){applyBoundingBox(ctx,this._bbox);var scale;if(pathType===PathType.SHADING){scale=_util.Util.singularValueDecompose2dScale((0,_display_utils.getCurrentTransform)(ctx))}else{scale=_util.Util.singularValueDecompose2dScale(owner.baseTransform);if(this.matrix){var matrixScale=_util.Util.singularValueDecompose2dScale(this.matrix);scale=[scale[0]*matrixScale[0],scale[1]*matrixScale[1]]}}var temporaryPatternCanvas=this._createMeshCanvas(scale,pathType===PathType.SHADING?null:this._background,owner.cachedCanvases);if(pathType!==PathType.SHADING){ctx.setTransform.apply(ctx,_toConsumableArray2(owner.baseTransform));if(this.matrix){ctx.transform.apply(ctx,_toConsumableArray2(this.matrix))}}ctx.translate(temporaryPatternCanvas.offsetX,temporaryPatternCanvas.offsetY);ctx.scale(temporaryPatternCanvas.scaleX,temporaryPatternCanvas.scaleY);return ctx.createPattern(temporaryPatternCanvas.canvas,"no-repeat")}}]);return MeshShadingPattern}(BaseShadingPattern);var DummyShadingPattern=function(_BaseShadingPattern3){_inherits2(DummyShadingPattern,_BaseShadingPattern3);var _super34=_createSuper(DummyShadingPattern);function DummyShadingPattern(){_classCallCheck2(this,DummyShadingPattern);return _super34.apply(this,arguments)}_createClass2(DummyShadingPattern,[{key:"getPattern",value:function getPattern(){return"hotpink"}}]);return DummyShadingPattern}(BaseShadingPattern);function getShadingPattern(IR){switch(IR[0]){case"RadialAxial":return new RadialAxialShadingPattern(IR);case"Mesh":return new MeshShadingPattern(IR);case"Dummy":return new DummyShadingPattern}throw new Error("Unknown IR type: ".concat(IR[0]))}var PaintType={COLORED:1,UNCOLORED:2};var TilingPattern=function(){function TilingPattern(IR,color,ctx,canvasGraphicsFactory,baseTransform){_classCallCheck2(this,TilingPattern);this.operatorList=IR[2];this.matrix=IR[3]||[1,0,0,1,0,0];this.bbox=IR[4];this.xstep=IR[5];this.ystep=IR[6];this.paintType=IR[7];this.tilingType=IR[8];this.color=color;this.ctx=ctx;this.canvasGraphicsFactory=canvasGraphicsFactory;this.baseTransform=baseTransform}_createClass2(TilingPattern,[{key:"createPatternCanvas",value:function createPatternCanvas(owner){var operatorList=this.operatorList;var bbox=this.bbox;var xstep=this.xstep;var ystep=this.ystep;var paintType=this.paintType;var tilingType=this.tilingType;var color=this.color;var canvasGraphicsFactory=this.canvasGraphicsFactory;(0,_util.info)("TilingType: "+tilingType);var x0=bbox[0],y0=bbox[1],x1=bbox[2],y1=bbox[3];var matrixScale=_util.Util.singularValueDecompose2dScale(this.matrix);var curMatrixScale=_util.Util.singularValueDecompose2dScale(this.baseTransform);var combinedScale=[matrixScale[0]*curMatrixScale[0],matrixScale[1]*curMatrixScale[1]];var dimx=this.getSizeAndScale(xstep,this.ctx.canvas.width,combinedScale[0]);var dimy=this.getSizeAndScale(ystep,this.ctx.canvas.height,combinedScale[1]);var tmpCanvas=owner.cachedCanvases.getCanvas("pattern",dimx.size,dimy.size,true);var tmpCtx=tmpCanvas.context;var graphics=canvasGraphicsFactory.createCanvasGraphics(tmpCtx);graphics.groupLevel=owner.groupLevel;this.setFillAndStrokeStyleToContext(graphics,paintType,color);var adjustedX0=x0;var adjustedY0=y0;var adjustedX1=x1;var adjustedY1=y1;if(x0<0){adjustedX0=0;adjustedX1+=Math.abs(x0)}if(y0<0){adjustedY0=0;adjustedY1+=Math.abs(y0)}tmpCtx.translate(-(dimx.scale*adjustedX0),-(dimy.scale*adjustedY0));graphics.transform(dimx.scale,0,0,dimy.scale,0,0);tmpCtx.save();this.clipBbox(graphics,adjustedX0,adjustedY0,adjustedX1,adjustedY1);graphics.baseTransform=(0,_display_utils.getCurrentTransform)(graphics.ctx);graphics.executeOperatorList(operatorList);graphics.endDrawing();return{canvas:tmpCanvas.canvas,scaleX:dimx.scale,scaleY:dimy.scale,offsetX:adjustedX0,offsetY:adjustedY0}}},{key:"getSizeAndScale",value:function getSizeAndScale(step,realOutputSize,scale){step=Math.abs(step);var maxSize=Math.max(TilingPattern.MAX_PATTERN_SIZE,realOutputSize);var size=Math.ceil(step*scale);if(size>=maxSize){size=maxSize}else{scale=size/step}return{scale:scale,size:size}}},{key:"clipBbox",value:function clipBbox(graphics,x0,y0,x1,y1){var bboxWidth=x1-x0;var bboxHeight=y1-y0;graphics.ctx.rect(x0,y0,bboxWidth,bboxHeight);graphics.current.updateRectMinMax((0,_display_utils.getCurrentTransform)(graphics.ctx),[x0,y0,x1,y1]);graphics.clip();graphics.endPath()}},{key:"setFillAndStrokeStyleToContext",value:function setFillAndStrokeStyleToContext(graphics,paintType,color){var context=graphics.ctx,current=graphics.current;switch(paintType){case PaintType.COLORED:var ctx=this.ctx;context.fillStyle=ctx.fillStyle;context.strokeStyle=ctx.strokeStyle;current.fillColor=ctx.fillStyle;current.strokeColor=ctx.strokeStyle;break;case PaintType.UNCOLORED:var cssColor=_util.Util.makeHexColor(color[0],color[1],color[2]);context.fillStyle=cssColor;context.strokeStyle=cssColor;current.fillColor=cssColor;current.strokeColor=cssColor;break;default:throw new _util.FormatError("Unsupported paint type: ".concat(paintType))}}},{key:"getPattern",value:function getPattern(ctx,owner,inverse,pathType){var matrix=inverse;if(pathType!==PathType.SHADING){matrix=_util.Util.transform(matrix,owner.baseTransform);if(this.matrix){matrix=_util.Util.transform(matrix,this.matrix)}}var temporaryPatternCanvas=this.createPatternCanvas(owner);var domMatrix=new DOMMatrix(matrix);domMatrix=domMatrix.translate(temporaryPatternCanvas.offsetX,temporaryPatternCanvas.offsetY);domMatrix=domMatrix.scale(1/temporaryPatternCanvas.scaleX,1/temporaryPatternCanvas.scaleY);var pattern=ctx.createPattern(temporaryPatternCanvas.canvas,"repeat");pattern.setTransform(domMatrix);return pattern}}]);return TilingPattern}();_defineProperty2(TilingPattern,"MAX_PATTERN_SIZE",3000);exports.TilingPattern=TilingPattern}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.convertBlackAndWhiteToRGBA=convertBlackAndWhiteToRGBA;exports.convertToRGBA=convertToRGBA;exports.grayToRGBA=grayToRGBA;var _util=__w_pdfjs_require__(1);function convertToRGBA(params){switch(params.kind){case _util.ImageKind.GRAYSCALE_1BPP:return convertBlackAndWhiteToRGBA(params);case _util.ImageKind.RGB_24BPP:return convertRGBToRGBA(params)}return null}function convertBlackAndWhiteToRGBA(_ref67){var src=_ref67.src,_ref67$srcPos=_ref67.srcPos,srcPos=_ref67$srcPos===void 0?0:_ref67$srcPos,dest=_ref67.dest,width=_ref67.width,height=_ref67.height,_ref67$nonBlackColor=_ref67.nonBlackColor,nonBlackColor=_ref67$nonBlackColor===void 0?4294967295:_ref67$nonBlackColor,_ref67$inverseDecode=_ref67.inverseDecode,inverseDecode=_ref67$inverseDecode===void 0?false:_ref67$inverseDecode;var black=_util.FeatureTest.isLittleEndian?4278190080:255;var _ref68=inverseDecode?[nonBlackColor,black]:[black,nonBlackColor],_ref69=_slicedToArray2(_ref68,2),zeroMapping=_ref69[0],oneMapping=_ref69[1];var widthInSource=width>>3;var widthRemainder=width&7;var srcLength=src.length;dest=new Uint32Array(dest.buffer);var destPos=0;for(var _i37=0;_i37<height;_i37++){for(var _max2=srcPos+widthInSource;srcPos<_max2;srcPos++){var _elem=srcPos<srcLength?src[srcPos]:255;dest[destPos++]=_elem&128?oneMapping:zeroMapping;dest[destPos++]=_elem&64?oneMapping:zeroMapping;dest[destPos++]=_elem&32?oneMapping:zeroMapping;dest[destPos++]=_elem&16?oneMapping:zeroMapping;dest[destPos++]=_elem&8?oneMapping:zeroMapping;dest[destPos++]=_elem&4?oneMapping:zeroMapping;dest[destPos++]=_elem&2?oneMapping:zeroMapping;dest[destPos++]=_elem&1?oneMapping:zeroMapping}if(widthRemainder===0){continue}var elem=srcPos<srcLength?src[srcPos++]:255;for(var j=0;j<widthRemainder;j++){dest[destPos++]=elem&1<<7-j?oneMapping:zeroMapping}}return{srcPos:srcPos,destPos:destPos}}function convertRGBToRGBA(_ref70){var src=_ref70.src,_ref70$srcPos=_ref70.srcPos,srcPos=_ref70$srcPos===void 0?0:_ref70$srcPos,dest=_ref70.dest,_ref70$destPos=_ref70.destPos,destPos=_ref70$destPos===void 0?0:_ref70$destPos,width=_ref70.width,height=_ref70.height;var i=0;var len32=src.length>>2;var src32=new Uint32Array(src.buffer,srcPos,len32);if(_util.FeatureTest.isLittleEndian){for(;i<len32-2;i+=3,destPos+=4){var s1=src32[i];var s2=src32[i+1];var s3=src32[i+2];dest[destPos]=s1|4278190080;dest[destPos+1]=s1>>>24|s2<<8|4278190080;dest[destPos+2]=s2>>>16|s3<<16|4278190080;dest[destPos+3]=s3>>>8|4278190080}for(var j=i*4,jj=src.length;j<jj;j+=3){dest[destPos++]=src[j]|src[j+1]<<8|src[j+2]<<16|4278190080}}else{for(;i<len32-2;i+=3,destPos+=4){var _s2=src32[i];var _s3=src32[i+1];var _s4=src32[i+2];dest[destPos]=_s2|255;dest[destPos+1]=_s2<<24|_s3>>>8|255;dest[destPos+2]=_s3<<16|_s4>>>16|255;dest[destPos+3]=_s4<<8|255}for(var _j2=i*4,_jj=src.length;_j2<_jj;_j2+=3){dest[destPos++]=src[_j2]<<24|src[_j2+1]<<16|src[_j2+2]<<8|255}}return{srcPos:srcPos,destPos:destPos}}function grayToRGBA(src,dest){if(_util.FeatureTest.isLittleEndian){for(var _i38=0,ii=src.length;_i38<ii;_i38++){dest[_i38]=src[_i38]*65793|4278190080}}else{for(var _i39=0,_ii=src.length;_i39<_ii;_i39++){dest[_i39]=src[_i39]*16843008|255}}}}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.GlobalWorkerOptions=void 0;var GlobalWorkerOptions=Object.create(null);exports.GlobalWorkerOptions=GlobalWorkerOptions;GlobalWorkerOptions.workerPort=null;GlobalWorkerOptions.workerSrc=""}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.MessageHandler=void 0;var _util=__w_pdfjs_require__(1);var CallbackKind={UNKNOWN:0,DATA:1,ERROR:2};var StreamKind={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function wrapReason(reason){if(!(reason instanceof Error||_typeof2(reason)==="object"&&reason!==null)){(0,_util.unreachable)("wrapReason: Expected \"reason\" to be a (possibly cloned) Error.")}switch(reason.name){case"AbortException":return new _util.AbortException(reason.message);case"MissingPDFException":return new _util.MissingPDFException(reason.message);case"PasswordException":return new _util.PasswordException(reason.message,reason.code);case"UnexpectedResponseException":return new _util.UnexpectedResponseException(reason.message,reason.status);case"UnknownErrorException":return new _util.UnknownErrorException(reason.message,reason.details);default:return new _util.UnknownErrorException(reason.message,reason.toString())}}var _createStreamSink=new WeakSet;var _processStreamMessage=new WeakSet;var _deleteStreamController=new WeakSet;var MessageHandler=function(){function MessageHandler(_sourceName,_targetName,_comObj){var _this81=this;_classCallCheck2(this,MessageHandler);_classPrivateMethodInitSpec(this,_deleteStreamController);_classPrivateMethodInitSpec(this,_processStreamMessage);_classPrivateMethodInitSpec(this,_createStreamSink);this.sourceName=_sourceName;this.targetName=_targetName;this.comObj=_comObj;this.callbackId=1;this.streamId=1;this.streamSinks=Object.create(null);this.streamControllers=Object.create(null);this.callbackCapabilities=Object.create(null);this.actionHandler=Object.create(null);this._onComObjOnMessage=function(event){var data=event.data;if(data.targetName!==_this81.sourceName){return}if(data.stream){_classPrivateMethodGet(_this81,_processStreamMessage,_processStreamMessage2).call(_this81,data);return}if(data.callback){var callbackId=data.callbackId;var capability=_this81.callbackCapabilities[callbackId];if(!capability){throw new Error("Cannot resolve callback ".concat(callbackId))}delete _this81.callbackCapabilities[callbackId];if(data.callback===CallbackKind.DATA){capability.resolve(data.data)}else if(data.callback===CallbackKind.ERROR){capability.reject(wrapReason(data.reason))}else{throw new Error("Unexpected callback case")}return}var action=_this81.actionHandler[data.action];if(!action){throw new Error("Unknown action from worker: ".concat(data.action))}if(data.callbackId){var cbSourceName=_this81.sourceName;var cbTargetName=data.sourceName;new Promise(function(resolve){resolve(action(data.data))}).then(function(result){_comObj.postMessage({sourceName:cbSourceName,targetName:cbTargetName,callback:CallbackKind.DATA,callbackId:data.callbackId,data:result})},function(reason){_comObj.postMessage({sourceName:cbSourceName,targetName:cbTargetName,callback:CallbackKind.ERROR,callbackId:data.callbackId,reason:wrapReason(reason)})});return}if(data.streamId){_classPrivateMethodGet(_this81,_createStreamSink,_createStreamSink2).call(_this81,data);return}action(data.data)};_comObj.addEventListener("message",this._onComObjOnMessage)}_createClass2(MessageHandler,[{key:"on",value:function on(actionName,handler){var ah=this.actionHandler;if(ah[actionName]){throw new Error("There is already an actionName called \"".concat(actionName,"\""))}ah[actionName]=handler}},{key:"send",value:function send(actionName,data,transfers){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:actionName,data:data},transfers)}},{key:"sendWithPromise",value:function sendWithPromise(actionName,data,transfers){var callbackId=this.callbackId++;var capability=new _util.PromiseCapability;this.callbackCapabilities[callbackId]=capability;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:actionName,callbackId:callbackId,data:data},transfers)}catch(ex){capability.reject(ex)}return capability.promise}},{key:"sendWithStream",value:function sendWithStream(actionName,data,queueingStrategy,transfers){var _this82=this;var streamId=this.streamId++,sourceName=this.sourceName,targetName=this.targetName,comObj=this.comObj;return new ReadableStream({start:function start(controller){var startCapability=new _util.PromiseCapability;_this82.streamControllers[streamId]={controller:controller,startCall:startCapability,pullCall:null,cancelCall:null,isClosed:false};comObj.postMessage({sourceName:sourceName,targetName:targetName,action:actionName,streamId:streamId,data:data,desiredSize:controller.desiredSize},transfers);return startCapability.promise},pull:function pull(controller){var pullCapability=new _util.PromiseCapability;_this82.streamControllers[streamId].pullCall=pullCapability;comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.PULL,streamId:streamId,desiredSize:controller.desiredSize});return pullCapability.promise},cancel:function cancel(reason){(0,_util.assert)(reason instanceof Error,"cancel must have a valid reason");var cancelCapability=new _util.PromiseCapability;_this82.streamControllers[streamId].cancelCall=cancelCapability;_this82.streamControllers[streamId].isClosed=true;comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.CANCEL,streamId:streamId,reason:wrapReason(reason)});return cancelCapability.promise}},queueingStrategy)}},{key:"destroy",value:function destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}]);return MessageHandler}();function _createStreamSink2(data){var streamId=data.streamId,sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj;var self=this,action=this.actionHandler[data.action];var streamSink={enqueue:function enqueue(chunk){var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var transfers=arguments.length>2?arguments[2]:undefined;if(this.isCancelled){return}var lastDesiredSize=this.desiredSize;this.desiredSize-=size;if(lastDesiredSize>0&&this.desiredSize<=0){this.sinkCapability=new _util.PromiseCapability;this.ready=this.sinkCapability.promise}comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.ENQUEUE,streamId:streamId,chunk:chunk},transfers)},close:function close(){if(this.isCancelled){return}this.isCancelled=true;comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.CLOSE,streamId:streamId});delete self.streamSinks[streamId]},error:function error(reason){(0,_util.assert)(reason instanceof Error,"error must have a valid reason");if(this.isCancelled){return}this.isCancelled=true;comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.ERROR,streamId:streamId,reason:wrapReason(reason)})},sinkCapability:new _util.PromiseCapability,onPull:null,onCancel:null,isCancelled:false,desiredSize:data.desiredSize,ready:null};streamSink.sinkCapability.resolve();streamSink.ready=streamSink.sinkCapability.promise;this.streamSinks[streamId]=streamSink;new Promise(function(resolve){resolve(action(data.data,streamSink))}).then(function(){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.START_COMPLETE,streamId:streamId,success:true})},function(reason){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.START_COMPLETE,streamId:streamId,reason:wrapReason(reason)})})}function _processStreamMessage2(data){var streamId=data.streamId,sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj;var streamController=this.streamControllers[streamId],streamSink=this.streamSinks[streamId];switch(data.stream){case StreamKind.START_COMPLETE:if(data.success){streamController.startCall.resolve()}else{streamController.startCall.reject(wrapReason(data.reason))}break;case StreamKind.PULL_COMPLETE:if(data.success){streamController.pullCall.resolve()}else{streamController.pullCall.reject(wrapReason(data.reason))}break;case StreamKind.PULL:if(!streamSink){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.PULL_COMPLETE,streamId:streamId,success:true});break}if(streamSink.desiredSize<=0&&data.desiredSize>0){streamSink.sinkCapability.resolve()}streamSink.desiredSize=data.desiredSize;new Promise(function(resolve){var _streamSink$onPull;resolve((_streamSink$onPull=streamSink.onPull)===null||_streamSink$onPull===void 0?void 0:_streamSink$onPull.call(streamSink))}).then(function(){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.PULL_COMPLETE,streamId:streamId,success:true})},function(reason){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.PULL_COMPLETE,streamId:streamId,reason:wrapReason(reason)})});break;case StreamKind.ENQUEUE:(0,_util.assert)(streamController,"enqueue should have stream controller");if(streamController.isClosed){break}streamController.controller.enqueue(data.chunk);break;case StreamKind.CLOSE:(0,_util.assert)(streamController,"close should have stream controller");if(streamController.isClosed){break}streamController.isClosed=true;streamController.controller.close();_classPrivateMethodGet(this,_deleteStreamController,_deleteStreamController2).call(this,streamController,streamId);break;case StreamKind.ERROR:(0,_util.assert)(streamController,"error should have stream controller");streamController.controller.error(wrapReason(data.reason));_classPrivateMethodGet(this,_deleteStreamController,_deleteStreamController2).call(this,streamController,streamId);break;case StreamKind.CANCEL_COMPLETE:if(data.success){streamController.cancelCall.resolve()}else{streamController.cancelCall.reject(wrapReason(data.reason))}_classPrivateMethodGet(this,_deleteStreamController,_deleteStreamController2).call(this,streamController,streamId);break;case StreamKind.CANCEL:if(!streamSink){break}new Promise(function(resolve){var _streamSink$onCancel;resolve((_streamSink$onCancel=streamSink.onCancel)===null||_streamSink$onCancel===void 0?void 0:_streamSink$onCancel.call(streamSink,wrapReason(data.reason)))}).then(function(){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.CANCEL_COMPLETE,streamId:streamId,success:true})},function(reason){comObj.postMessage({sourceName:sourceName,targetName:targetName,stream:StreamKind.CANCEL_COMPLETE,streamId:streamId,reason:wrapReason(reason)})});streamSink.sinkCapability.reject(wrapReason(data.reason));streamSink.isCancelled=true;delete this.streamSinks[streamId];break;default:throw new Error("Unexpected stream case")}}function _deleteStreamController2(_x58,_x59){return _deleteStreamController3.apply(this,arguments)}function _deleteStreamController3(){_deleteStreamController3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee51(streamController,streamId){var _streamController$sta,_streamController$pul,_streamController$can;return _regeneratorRuntime().wrap(function _callee51$(_context52){while(1)switch(_context52.prev=_context52.next){case 0:_context52.next=2;return Promise.allSettled([(_streamController$sta=streamController.startCall)===null||_streamController$sta===void 0?void 0:_streamController$sta.promise,(_streamController$pul=streamController.pullCall)===null||_streamController$pul===void 0?void 0:_streamController$pul.promise,(_streamController$can=streamController.cancelCall)===null||_streamController$can===void 0?void 0:_streamController$can.promise]);case 2:delete this.streamControllers[streamId];case 3:case"end":return _context52.stop()}},_callee51,this)}));return _deleteStreamController3.apply(this,arguments)}exports.MessageHandler=MessageHandler}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.Metadata=void 0;var _util=__w_pdfjs_require__(1);var _metadataMap=new WeakMap;var _data6=new WeakMap;var Metadata=function(){function Metadata(_ref71){var parsedData=_ref71.parsedData,rawData=_ref71.rawData;_classCallCheck2(this,Metadata);_classPrivateFieldInitSpec(this,_metadataMap,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_data6,{writable:true,value:void 0});_classPrivateFieldSet(this,_metadataMap,parsedData);_classPrivateFieldSet(this,_data6,rawData)}_createClass2(Metadata,[{key:"getRaw",value:function getRaw(){return _classPrivateFieldGet(this,_data6)}},{key:"get",value:function get(name){var _classPrivateFieldGet20;return(_classPrivateFieldGet20=_classPrivateFieldGet(this,_metadataMap).get(name))!==null&&_classPrivateFieldGet20!==void 0?_classPrivateFieldGet20:null}},{key:"getAll",value:function getAll(){return(0,_util.objectFromMap)(_classPrivateFieldGet(this,_metadataMap))}},{key:"has",value:function has(name){return _classPrivateFieldGet(this,_metadataMap).has(name)}}]);return Metadata}();exports.Metadata=Metadata}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.OptionalContentConfig=void 0;var _util=__w_pdfjs_require__(1);var _murmurhash=__w_pdfjs_require__(8);var INTERNAL=Symbol("INTERNAL");var _visible=new WeakMap;var OptionalContentGroup=function(){function OptionalContentGroup(name,intent){_classCallCheck2(this,OptionalContentGroup);_classPrivateFieldInitSpec(this,_visible,{writable:true,value:true});this.name=name;this.intent=intent}_createClass2(OptionalContentGroup,[{key:"visible",get:function get(){return _classPrivateFieldGet(this,_visible)}},{key:"_setVisible",value:function _setVisible(internal,visible){if(internal!==INTERNAL){(0,_util.unreachable)("Internal method `_setVisible` called.")}_classPrivateFieldSet(this,_visible,visible)}}]);return OptionalContentGroup}();var _cachedGetHash=new WeakMap;var _groups=new WeakMap;var _initialHash=new WeakMap;var _order=new WeakMap;var _evaluateVisibilityExpression=new WeakSet;var OptionalContentConfig=function(){function OptionalContentConfig(data){_classCallCheck2(this,OptionalContentConfig);_classPrivateMethodInitSpec(this,_evaluateVisibilityExpression);_classPrivateFieldInitSpec(this,_cachedGetHash,{writable:true,value:null});_classPrivateFieldInitSpec(this,_groups,{writable:true,value:new Map});_classPrivateFieldInitSpec(this,_initialHash,{writable:true,value:null});_classPrivateFieldInitSpec(this,_order,{writable:true,value:null});this.name=null;this.creator=null;if(data===null){return}this.name=data.name;this.creator=data.creator;_classPrivateFieldSet(this,_order,data.order);var _iterator82=_createForOfIteratorHelper(data.groups),_step82;try{for(_iterator82.s();!(_step82=_iterator82.n()).done;){var _group=_step82.value;_classPrivateFieldGet(this,_groups).set(_group.id,new OptionalContentGroup(_group.name,_group.intent))}}catch(err){_iterator82.e(err)}finally{_iterator82.f()}if(data.baseState==="OFF"){var _iterator83=_createForOfIteratorHelper(_classPrivateFieldGet(this,_groups).values()),_step83;try{for(_iterator83.s();!(_step83=_iterator83.n()).done;){var group=_step83.value;group._setVisible(INTERNAL,false)}}catch(err){_iterator83.e(err)}finally{_iterator83.f()}}var _iterator84=_createForOfIteratorHelper(data.on),_step84;try{for(_iterator84.s();!(_step84=_iterator84.n()).done;){var on=_step84.value;_classPrivateFieldGet(this,_groups).get(on)._setVisible(INTERNAL,true)}}catch(err){_iterator84.e(err)}finally{_iterator84.f()}var _iterator85=_createForOfIteratorHelper(data.off),_step85;try{for(_iterator85.s();!(_step85=_iterator85.n()).done;){var off=_step85.value;_classPrivateFieldGet(this,_groups).get(off)._setVisible(INTERNAL,false)}}catch(err){_iterator85.e(err)}finally{_iterator85.f()}_classPrivateFieldSet(this,_initialHash,this.getHash())}_createClass2(OptionalContentConfig,[{key:"isVisible",value:function isVisible(group){if(_classPrivateFieldGet(this,_groups).size===0){return true}if(!group){(0,_util.warn)("Optional content group not defined.");return true}if(group.type==="OCG"){if(!_classPrivateFieldGet(this,_groups).has(group.id)){(0,_util.warn)("Optional content group not found: ".concat(group.id));return true}return _classPrivateFieldGet(this,_groups).get(group.id).visible}else if(group.type==="OCMD"){if(group.expression){return _classPrivateMethodGet(this,_evaluateVisibilityExpression,_evaluateVisibilityExpression2).call(this,group.expression)}if(!group.policy||group.policy==="AnyOn"){var _iterator86=_createForOfIteratorHelper(group.ids),_step86;try{for(_iterator86.s();!(_step86=_iterator86.n()).done;){var _id6=_step86.value;if(!_classPrivateFieldGet(this,_groups).has(_id6)){(0,_util.warn)("Optional content group not found: ".concat(_id6));return true}if(_classPrivateFieldGet(this,_groups).get(_id6).visible){return true}}}catch(err){_iterator86.e(err)}finally{_iterator86.f()}return false}else if(group.policy==="AllOn"){var _iterator87=_createForOfIteratorHelper(group.ids),_step87;try{for(_iterator87.s();!(_step87=_iterator87.n()).done;){var _id7=_step87.value;if(!_classPrivateFieldGet(this,_groups).has(_id7)){(0,_util.warn)("Optional content group not found: ".concat(_id7));return true}if(!_classPrivateFieldGet(this,_groups).get(_id7).visible){return false}}}catch(err){_iterator87.e(err)}finally{_iterator87.f()}return true}else if(group.policy==="AnyOff"){var _iterator88=_createForOfIteratorHelper(group.ids),_step88;try{for(_iterator88.s();!(_step88=_iterator88.n()).done;){var _id8=_step88.value;if(!_classPrivateFieldGet(this,_groups).has(_id8)){(0,_util.warn)("Optional content group not found: ".concat(_id8));return true}if(!_classPrivateFieldGet(this,_groups).get(_id8).visible){return true}}}catch(err){_iterator88.e(err)}finally{_iterator88.f()}return false}else if(group.policy==="AllOff"){var _iterator89=_createForOfIteratorHelper(group.ids),_step89;try{for(_iterator89.s();!(_step89=_iterator89.n()).done;){var _id9=_step89.value;if(!_classPrivateFieldGet(this,_groups).has(_id9)){(0,_util.warn)("Optional content group not found: ".concat(_id9));return true}if(_classPrivateFieldGet(this,_groups).get(_id9).visible){return false}}}catch(err){_iterator89.e(err)}finally{_iterator89.f()}return true}(0,_util.warn)("Unknown optional content policy ".concat(group.policy,"."));return true}(0,_util.warn)("Unknown group type ".concat(group.type,"."));return true}},{key:"setVisibility",value:function setVisibility(id){var visible=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!_classPrivateFieldGet(this,_groups).has(id)){(0,_util.warn)("Optional content group not found: ".concat(id));return}_classPrivateFieldGet(this,_groups).get(id)._setVisible(INTERNAL,!!visible);_classPrivateFieldSet(this,_cachedGetHash,null)}},{key:"hasInitialVisibility",get:function get(){return _classPrivateFieldGet(this,_initialHash)===null||this.getHash()===_classPrivateFieldGet(this,_initialHash)}},{key:"getOrder",value:function getOrder(){if(!_classPrivateFieldGet(this,_groups).size){return null}if(_classPrivateFieldGet(this,_order)){return _classPrivateFieldGet(this,_order).slice()}return _toConsumableArray2(_classPrivateFieldGet(this,_groups).keys())}},{key:"getGroups",value:function getGroups(){return _classPrivateFieldGet(this,_groups).size>0?(0,_util.objectFromMap)(_classPrivateFieldGet(this,_groups)):null}},{key:"getGroup",value:function getGroup(id){return _classPrivateFieldGet(this,_groups).get(id)||null}},{key:"getHash",value:function getHash(){if(_classPrivateFieldGet(this,_cachedGetHash)!==null){return _classPrivateFieldGet(this,_cachedGetHash)}var hash=new _murmurhash.MurmurHash3_64;var _iterator90=_createForOfIteratorHelper(_classPrivateFieldGet(this,_groups)),_step90;try{for(_iterator90.s();!(_step90=_iterator90.n()).done;){var _step90$value=_slicedToArray2(_step90.value,2),_id10=_step90$value[0],group=_step90$value[1];hash.update("".concat(_id10,":").concat(group.visible))}}catch(err){_iterator90.e(err)}finally{_iterator90.f()}return _classPrivateFieldSet(this,_cachedGetHash,hash.hexdigest())}}]);return OptionalContentConfig}();function _evaluateVisibilityExpression2(array){var length=array.length;if(length<2){return true}var operator=array[0];for(var _i40=1;_i40<length;_i40++){var element=array[_i40];var state=void 0;if(Array.isArray(element)){state=_classPrivateMethodGet(this,_evaluateVisibilityExpression,_evaluateVisibilityExpression2).call(this,element)}else if(_classPrivateFieldGet(this,_groups).has(element)){state=_classPrivateFieldGet(this,_groups).get(element).visible}else{(0,_util.warn)("Optional content group not found: ".concat(element));return true}switch(operator){case"And":if(!state){return false}break;case"Or":if(state){return true}break;case"Not":return!state;default:return true}}return operator==="And"}exports.OptionalContentConfig=OptionalContentConfig}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFDataTransportStream=void 0;var _util=__w_pdfjs_require__(1);var _display_utils=__w_pdfjs_require__(6);var PDFDataTransportStream=function(){function PDFDataTransportStream(_ref72,pdfDataRangeTransport){var _this83=this;var length=_ref72.length,initialData=_ref72.initialData,_ref72$progressiveDon=_ref72.progressiveDone,progressiveDone=_ref72$progressiveDon===void 0?false:_ref72$progressiveDon,_ref72$contentDisposi=_ref72.contentDispositionFilename,contentDispositionFilename=_ref72$contentDisposi===void 0?null:_ref72$contentDisposi,_ref72$disableRange=_ref72.disableRange,disableRange=_ref72$disableRange===void 0?false:_ref72$disableRange,_ref72$disableStream=_ref72.disableStream,disableStream=_ref72$disableStream===void 0?false:_ref72$disableStream;_classCallCheck2(this,PDFDataTransportStream);(0,_util.assert)(pdfDataRangeTransport,"PDFDataTransportStream - missing required \"pdfDataRangeTransport\" argument.");this._queuedChunks=[];this._progressiveDone=progressiveDone;this._contentDispositionFilename=contentDispositionFilename;if((initialData===null||initialData===void 0?void 0:initialData.length)>0){var buffer=initialData instanceof Uint8Array&&initialData.byteLength===initialData.buffer.byteLength?initialData.buffer:new Uint8Array(initialData).buffer;this._queuedChunks.push(buffer)}this._pdfDataRangeTransport=pdfDataRangeTransport;this._isStreamingSupported=!disableStream;this._isRangeSupported=!disableRange;this._contentLength=length;this._fullRequestReader=null;this._rangeReaders=[];this._pdfDataRangeTransport.addRangeListener(function(begin,chunk){_this83._onReceiveData({begin:begin,chunk:chunk})});this._pdfDataRangeTransport.addProgressListener(function(loaded,total){_this83._onProgress({loaded:loaded,total:total})});this._pdfDataRangeTransport.addProgressiveReadListener(function(chunk){_this83._onReceiveData({chunk:chunk})});this._pdfDataRangeTransport.addProgressiveDoneListener(function(){_this83._onProgressiveDone()});this._pdfDataRangeTransport.transportReady()}_createClass2(PDFDataTransportStream,[{key:"_onReceiveData",value:function _onReceiveData(_ref73){var begin=_ref73.begin,chunk=_ref73.chunk;var buffer=chunk instanceof Uint8Array&&chunk.byteLength===chunk.buffer.byteLength?chunk.buffer:new Uint8Array(chunk).buffer;if(begin===undefined){if(this._fullRequestReader){this._fullRequestReader._enqueue(buffer)}else{this._queuedChunks.push(buffer)}}else{var found=this._rangeReaders.some(function(rangeReader){if(rangeReader._begin!==begin){return false}rangeReader._enqueue(buffer);return true});(0,_util.assert)(found,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}},{key:"_progressiveDataLength",get:function get(){var _this$_fullRequestRea,_this$_fullRequestRea2;return(_this$_fullRequestRea=(_this$_fullRequestRea2=this._fullRequestReader)===null||_this$_fullRequestRea2===void 0?void 0:_this$_fullRequestRea2._loaded)!==null&&_this$_fullRequestRea!==void 0?_this$_fullRequestRea:0}},{key:"_onProgress",value:function _onProgress(evt){if(evt.total===undefined){var _this$_rangeReaders$,_this$_rangeReaders$$;(_this$_rangeReaders$=this._rangeReaders[0])===null||_this$_rangeReaders$===void 0||(_this$_rangeReaders$$=_this$_rangeReaders$.onProgress)===null||_this$_rangeReaders$$===void 0||_this$_rangeReaders$$.call(_this$_rangeReaders$,{loaded:evt.loaded})}else{var _this$_fullRequestRea3,_this$_fullRequestRea4;(_this$_fullRequestRea3=this._fullRequestReader)===null||_this$_fullRequestRea3===void 0||(_this$_fullRequestRea4=_this$_fullRequestRea3.onProgress)===null||_this$_fullRequestRea4===void 0||_this$_fullRequestRea4.call(_this$_fullRequestRea3,{loaded:evt.loaded,total:evt.total})}}},{key:"_onProgressiveDone",value:function _onProgressiveDone(){var _this$_fullRequestRea5;(_this$_fullRequestRea5=this._fullRequestReader)===null||_this$_fullRequestRea5===void 0||_this$_fullRequestRea5.progressiveDone();this._progressiveDone=true}},{key:"_removeRangeReader",value:function _removeRangeReader(reader){var i=this._rangeReaders.indexOf(reader);if(i>=0){this._rangeReaders.splice(i,1)}}},{key:"getFullReader",value:function getFullReader(){(0,_util.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");var queuedChunks=this._queuedChunks;this._queuedChunks=null;return new PDFDataTransportStreamReader(this,queuedChunks,this._progressiveDone,this._contentDispositionFilename)}},{key:"getRangeReader",value:function getRangeReader(begin,end){if(end<=this._progressiveDataLength){return null}var reader=new PDFDataTransportStreamRangeReader(this,begin,end);this._pdfDataRangeTransport.requestDataRange(begin,end);this._rangeReaders.push(reader);return reader}},{key:"cancelAllRequests",value:function cancelAllRequests(reason){var _this$_fullRequestRea6;(_this$_fullRequestRea6=this._fullRequestReader)===null||_this$_fullRequestRea6===void 0||_this$_fullRequestRea6.cancel(reason);var _iterator91=_createForOfIteratorHelper(this._rangeReaders.slice(0)),_step91;try{for(_iterator91.s();!(_step91=_iterator91.n()).done;){var reader=_step91.value;reader.cancel(reason)}}catch(err){_iterator91.e(err)}finally{_iterator91.f()}this._pdfDataRangeTransport.abort()}}]);return PDFDataTransportStream}();exports.PDFDataTransportStream=PDFDataTransportStream;var PDFDataTransportStreamReader=function(){function PDFDataTransportStreamReader(stream,queuedChunks){var progressiveDone=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var contentDispositionFilename=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_classCallCheck2(this,PDFDataTransportStreamReader);this._stream=stream;this._done=progressiveDone||false;this._filename=(0,_display_utils.isPdfFile)(contentDispositionFilename)?contentDispositionFilename:null;this._queuedChunks=queuedChunks||[];this._loaded=0;var _iterator92=_createForOfIteratorHelper(this._queuedChunks),_step92;try{for(_iterator92.s();!(_step92=_iterator92.n()).done;){var chunk=_step92.value;this._loaded+=chunk.byteLength}}catch(err){_iterator92.e(err)}finally{_iterator92.f()}this._requests=[];this._headersReady=Promise.resolve();stream._fullRequestReader=this;this.onProgress=null}_createClass2(PDFDataTransportStreamReader,[{key:"_enqueue",value:function _enqueue(chunk){if(this._done){return}if(this._requests.length>0){var requestCapability=this._requests.shift();requestCapability.resolve({value:chunk,done:false})}else{this._queuedChunks.push(chunk)}this._loaded+=chunk.byteLength}},{key:"headersReady",get:function get(){return this._headersReady}},{key:"filename",get:function get(){return this._filename}},{key:"isRangeSupported",get:function get(){return this._stream._isRangeSupported}},{key:"isStreamingSupported",get:function get(){return this._stream._isStreamingSupported}},{key:"contentLength",get:function get(){return this._stream._contentLength}},{key:"read",value:function(){var _read=_asyncToGenerator(_regeneratorRuntime().mark(function _callee52(){var chunk,requestCapability;return _regeneratorRuntime().wrap(function _callee52$(_context53){while(1)switch(_context53.prev=_context53.next){case 0:if(!(this._queuedChunks.length>0)){_context53.next=3;break}chunk=this._queuedChunks.shift();return _context53.abrupt("return",{value:chunk,done:false});case 3:if(!this._done){_context53.next=5;break}return _context53.abrupt("return",{value:undefined,done:true});case 5:requestCapability=new _util.PromiseCapability;this._requests.push(requestCapability);return _context53.abrupt("return",requestCapability.promise);case 8:case"end":return _context53.stop()}},_callee52,this)}));function read(){return _read.apply(this,arguments)}return read}()},{key:"cancel",value:function cancel(reason){this._done=true;var _iterator93=_createForOfIteratorHelper(this._requests),_step93;try{for(_iterator93.s();!(_step93=_iterator93.n()).done;){var requestCapability=_step93.value;requestCapability.resolve({value:undefined,done:true})}}catch(err){_iterator93.e(err)}finally{_iterator93.f()}this._requests.length=0}},{key:"progressiveDone",value:function progressiveDone(){if(this._done){return}this._done=true}}]);return PDFDataTransportStreamReader}();var PDFDataTransportStreamRangeReader=function(){function PDFDataTransportStreamRangeReader(stream,begin,end){_classCallCheck2(this,PDFDataTransportStreamRangeReader);this._stream=stream;this._begin=begin;this._end=end;this._queuedChunk=null;this._requests=[];this._done=false;this.onProgress=null}_createClass2(PDFDataTransportStreamRangeReader,[{key:"_enqueue",value:function _enqueue(chunk){if(this._done){return}if(this._requests.length===0){this._queuedChunk=chunk}else{var requestsCapability=this._requests.shift();requestsCapability.resolve({value:chunk,done:false});var _iterator94=_createForOfIteratorHelper(this._requests),_step94;try{for(_iterator94.s();!(_step94=_iterator94.n()).done;){var requestCapability=_step94.value;requestCapability.resolve({value:undefined,done:true})}}catch(err){_iterator94.e(err)}finally{_iterator94.f()}this._requests.length=0}this._done=true;this._stream._removeRangeReader(this)}},{key:"isStreamingSupported",get:function get(){return false}},{key:"read",value:function(){var _read2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee53(){var chunk,requestCapability;return _regeneratorRuntime().wrap(function _callee53$(_context54){while(1)switch(_context54.prev=_context54.next){case 0:if(!this._queuedChunk){_context54.next=4;break}chunk=this._queuedChunk;this._queuedChunk=null;return _context54.abrupt("return",{value:chunk,done:false});case 4:if(!this._done){_context54.next=6;break}return _context54.abrupt("return",{value:undefined,done:true});case 6:requestCapability=new _util.PromiseCapability;this._requests.push(requestCapability);return _context54.abrupt("return",requestCapability.promise);case 9:case"end":return _context54.stop()}},_callee53,this)}));function read(){return _read2.apply(this,arguments)}return read}()},{key:"cancel",value:function cancel(reason){this._done=true;var _iterator95=_createForOfIteratorHelper(this._requests),_step95;try{for(_iterator95.s();!(_step95=_iterator95.n()).done;){var requestCapability=_step95.value;requestCapability.resolve({value:undefined,done:true})}}catch(err){_iterator95.e(err)}finally{_iterator95.f()}this._requests.length=0;this._stream._removeRangeReader(this)}}]);return PDFDataTransportStreamRangeReader}()}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFFetchStream=void 0;var _util=__w_pdfjs_require__(1);var _network_utils=__w_pdfjs_require__(20);function createFetchOptions(headers,withCredentials,abortController){return{method:"GET",headers:headers,signal:abortController.signal,mode:"cors",credentials:withCredentials?"include":"same-origin",redirect:"follow"}}function createHeaders(httpHeaders){var headers=new Headers;for(var property in httpHeaders){var value=httpHeaders[property];if(value===undefined){continue}headers.append(property,value)}return headers}function getArrayBuffer(val){if(val instanceof Uint8Array){return val.buffer}if(val instanceof ArrayBuffer){return val}(0,_util.warn)("getArrayBuffer - unexpected data format: ".concat(val));return new Uint8Array(val).buffer}var PDFFetchStream=function(){function PDFFetchStream(source){_classCallCheck2(this,PDFFetchStream);this.source=source;this.isHttp=/^https?:/i.test(source.url);this.httpHeaders=this.isHttp&&source.httpHeaders||{};this._fullRequestReader=null;this._rangeRequestReaders=[]}_createClass2(PDFFetchStream,[{key:"_progressiveDataLength",get:function get(){var _this$_fullRequestRea7,_this$_fullRequestRea8;return(_this$_fullRequestRea7=(_this$_fullRequestRea8=this._fullRequestReader)===null||_this$_fullRequestRea8===void 0?void 0:_this$_fullRequestRea8._loaded)!==null&&_this$_fullRequestRea7!==void 0?_this$_fullRequestRea7:0}},{key:"getFullReader",value:function getFullReader(){(0,_util.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once.");this._fullRequestReader=new PDFFetchStreamReader(this);return this._fullRequestReader}},{key:"getRangeReader",value:function getRangeReader(begin,end){if(end<=this._progressiveDataLength){return null}var reader=new PDFFetchStreamRangeReader(this,begin,end);this._rangeRequestReaders.push(reader);return reader}},{key:"cancelAllRequests",value:function cancelAllRequests(reason){var _this$_fullRequestRea9;(_this$_fullRequestRea9=this._fullRequestReader)===null||_this$_fullRequestRea9===void 0||_this$_fullRequestRea9.cancel(reason);var _iterator96=_createForOfIteratorHelper(this._rangeRequestReaders.slice(0)),_step96;try{for(_iterator96.s();!(_step96=_iterator96.n()).done;){var reader=_step96.value;reader.cancel(reason)}}catch(err){_iterator96.e(err)}finally{_iterator96.f()}}}]);return PDFFetchStream}();exports.PDFFetchStream=PDFFetchStream;var PDFFetchStreamReader=function(){function PDFFetchStreamReader(stream){var _this84=this;_classCallCheck2(this,PDFFetchStreamReader);this._stream=stream;this._reader=null;this._loaded=0;this._filename=null;var source=stream.source;this._withCredentials=source.withCredentials||false;this._contentLength=source.length;this._headersCapability=new _util.PromiseCapability;this._disableRange=source.disableRange||false;this._rangeChunkSize=source.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._abortController=new AbortController;this._isStreamingSupported=!source.disableStream;this._isRangeSupported=!source.disableRange;this._headers=createHeaders(this._stream.httpHeaders);var url=source.url;fetch(url,createFetchOptions(this._headers,this._withCredentials,this._abortController)).then(function(response){if(!(0,_network_utils.validateResponseStatus)(response.status)){throw(0,_network_utils.createResponseStatusError)(response.status,url)}_this84._reader=response.body.getReader();_this84._headersCapability.resolve();var getResponseHeader=function getResponseHeader(name){return response.headers.get(name)};var _ref74=(0,_network_utils.validateRangeRequestCapabilities)({getResponseHeader:getResponseHeader,isHttp:_this84._stream.isHttp,rangeChunkSize:_this84._rangeChunkSize,disableRange:_this84._disableRange}),allowRangeRequests=_ref74.allowRangeRequests,suggestedLength=_ref74.suggestedLength;_this84._isRangeSupported=allowRangeRequests;_this84._contentLength=suggestedLength||_this84._contentLength;_this84._filename=(0,_network_utils.extractFilenameFromHeader)(getResponseHeader);if(!_this84._isStreamingSupported&&_this84._isRangeSupported){_this84.cancel(new _util.AbortException("Streaming is disabled."))}})["catch"](this._headersCapability.reject);this.onProgress=null}_createClass2(PDFFetchStreamReader,[{key:"headersReady",get:function get(){return this._headersCapability.promise}},{key:"filename",get:function get(){return this._filename}},{key:"contentLength",get:function get(){return this._contentLength}},{key:"isRangeSupported",get:function get(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported}},{key:"read",value:function(){var _read3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee54(){var _this$onProgress;var _yield$this$_reader$r,value,done;return _regeneratorRuntime().wrap(function _callee54$(_context55){while(1)switch(_context55.prev=_context55.next){case 0:_context55.next=2;return this._headersCapability.promise;case 2:_context55.next=4;return this._reader.read();case 4:_yield$this$_reader$r=_context55.sent;value=_yield$this$_reader$r.value;done=_yield$this$_reader$r.done;if(!done){_context55.next=9;break}return _context55.abrupt("return",{value:value,done:done});case 9:this._loaded+=value.byteLength;(_this$onProgress=this.onProgress)===null||_this$onProgress===void 0||_this$onProgress.call(this,{loaded:this._loaded,total:this._contentLength});return _context55.abrupt("return",{value:getArrayBuffer(value),done:false});case 12:case"end":return _context55.stop()}},_callee54,this)}));function read(){return _read3.apply(this,arguments)}return read}()},{key:"cancel",value:function cancel(reason){var _this$_reader;(_this$_reader=this._reader)===null||_this$_reader===void 0||_this$_reader.cancel(reason);this._abortController.abort()}}]);return PDFFetchStreamReader}();var PDFFetchStreamRangeReader=function(){function PDFFetchStreamRangeReader(stream,begin,end){var _this85=this;_classCallCheck2(this,PDFFetchStreamRangeReader);this._stream=stream;this._reader=null;this._loaded=0;var source=stream.source;this._withCredentials=source.withCredentials||false;this._readCapability=new _util.PromiseCapability;this._isStreamingSupported=!source.disableStream;this._abortController=new AbortController;this._headers=createHeaders(this._stream.httpHeaders);this._headers.append("Range","bytes=".concat(begin,"-").concat(end-1));var url=source.url;fetch(url,createFetchOptions(this._headers,this._withCredentials,this._abortController)).then(function(response){if(!(0,_network_utils.validateResponseStatus)(response.status)){throw(0,_network_utils.createResponseStatusError)(response.status,url)}_this85._readCapability.resolve();_this85._reader=response.body.getReader()})["catch"](this._readCapability.reject);this.onProgress=null}_createClass2(PDFFetchStreamRangeReader,[{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported}},{key:"read",value:function(){var _read4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee55(){var _this$onProgress2;var _yield$this$_reader$r2,value,done;return _regeneratorRuntime().wrap(function _callee55$(_context56){while(1)switch(_context56.prev=_context56.next){case 0:_context56.next=2;return this._readCapability.promise;case 2:_context56.next=4;return this._reader.read();case 4:_yield$this$_reader$r2=_context56.sent;value=_yield$this$_reader$r2.value;done=_yield$this$_reader$r2.done;if(!done){_context56.next=9;break}return _context56.abrupt("return",{value:value,done:done});case 9:this._loaded+=value.byteLength;(_this$onProgress2=this.onProgress)===null||_this$onProgress2===void 0||_this$onProgress2.call(this,{loaded:this._loaded});return _context56.abrupt("return",{value:getArrayBuffer(value),done:false});case 12:case"end":return _context56.stop()}},_callee55,this)}));function read(){return _read4.apply(this,arguments)}return read}()},{key:"cancel",value:function cancel(reason){var _this$_reader2;(_this$_reader2=this._reader)===null||_this$_reader2===void 0||_this$_reader2.cancel(reason);this._abortController.abort()}}]);return PDFFetchStreamRangeReader}()}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.createResponseStatusError=createResponseStatusError;exports.extractFilenameFromHeader=extractFilenameFromHeader;exports.validateRangeRequestCapabilities=validateRangeRequestCapabilities;exports.validateResponseStatus=validateResponseStatus;var _util=__w_pdfjs_require__(1);var _content_disposition=__w_pdfjs_require__(21);var _display_utils=__w_pdfjs_require__(6);function validateRangeRequestCapabilities(_ref75){var getResponseHeader=_ref75.getResponseHeader,isHttp=_ref75.isHttp,rangeChunkSize=_ref75.rangeChunkSize,disableRange=_ref75.disableRange;var returnValues={allowRangeRequests:false,suggestedLength:undefined};var length=parseInt(getResponseHeader("Content-Length"),10);if(!Number.isInteger(length)){return returnValues}returnValues.suggestedLength=length;if(length<=2*rangeChunkSize){return returnValues}if(disableRange||!isHttp){return returnValues}if(getResponseHeader("Accept-Ranges")!=="bytes"){return returnValues}var contentEncoding=getResponseHeader("Content-Encoding")||"identity";if(contentEncoding!=="identity"){return returnValues}returnValues.allowRangeRequests=true;return returnValues}function extractFilenameFromHeader(getResponseHeader){var contentDisposition=getResponseHeader("Content-Disposition");if(contentDisposition){var filename=(0,_content_disposition.getFilenameFromContentDispositionHeader)(contentDisposition);if(filename.includes("%")){try{filename=decodeURIComponent(filename)}catch(_unused14){}}if((0,_display_utils.isPdfFile)(filename)){return filename}}return null}function createResponseStatusError(status,url){if(status===404||status===0&&url.startsWith("file:")){return new _util.MissingPDFException("Missing PDF \""+url+"\".")}return new _util.UnexpectedResponseException("Unexpected server response (".concat(status,") while retrieving PDF \"").concat(url,"\"."),status)}function validateResponseStatus(status){return status===200||status===206}}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.getFilenameFromContentDispositionHeader=getFilenameFromContentDispositionHeader;var _util=__w_pdfjs_require__(1);function getFilenameFromContentDispositionHeader(contentDisposition){var needsEncodingFixup=true;var tmp=toParamRegExp("filename\\*","i").exec(contentDisposition);if(tmp){tmp=tmp[1];var filename=rfc2616unquote(tmp);filename=unescape(filename);filename=rfc5987decode(filename);filename=rfc2047decode(filename);return fixupEncoding(filename)}tmp=rfc2231getparam(contentDisposition);if(tmp){var _filename=rfc2047decode(tmp);return fixupEncoding(_filename)}tmp=toParamRegExp("filename","i").exec(contentDisposition);if(tmp){tmp=tmp[1];var _filename2=rfc2616unquote(tmp);_filename2=rfc2047decode(_filename2);return fixupEncoding(_filename2)}function toParamRegExp(attributePattern,flags){return new RegExp("(?:^|;)\\s*"+attributePattern+"\\s*=\\s*"+"("+"[^\";\\s][^;\\s]*"+"|"+"\"(?:[^\"\\\\]|\\\\\"?)+\"?"+")",flags)}function textdecode(encoding,value){if(encoding){if(!/^[\x00-\xFF]+$/.test(value)){return value}try{var decoder=new TextDecoder(encoding,{fatal:true});var buffer=(0,_util.stringToBytes)(value);value=decoder.decode(buffer);needsEncodingFixup=false}catch(_unused15){}}return value}function fixupEncoding(value){if(needsEncodingFixup&&/[\x80-\xff]/.test(value)){value=textdecode("utf-8",value);if(needsEncodingFixup){value=textdecode("iso-8859-1",value)}}return value}function rfc2231getparam(contentDispositionStr){var matches=[];var match;var iter=toParamRegExp("filename\\*((?!0\\d)\\d+)(\\*?)","ig");while((match=iter.exec(contentDispositionStr))!==null){var _match=match,_match2=_slicedToArray2(_match,4),n=_match2[1],quot=_match2[2],part=_match2[3];n=parseInt(n,10);if(n in matches){if(n===0){break}continue}matches[n]=[quot,part]}var parts=[];for(var _n2=0;_n2<matches.length;++_n2){if(!(_n2 in matches)){break}var _matches$_n=_slicedToArray2(matches[_n2],2),_quot=_matches$_n[0],_part=_matches$_n[1];_part=rfc2616unquote(_part);if(_quot){_part=unescape(_part);if(_n2===0){_part=rfc5987decode(_part)}}parts.push(_part)}return parts.join("")}function rfc2616unquote(value){if(value.startsWith("\"")){var parts=value.slice(1).split("\\\"");for(var _i41=0;_i41<parts.length;++_i41){var quotindex=parts[_i41].indexOf("\"");if(quotindex!==-1){parts[_i41]=parts[_i41].slice(0,quotindex);parts.length=_i41+1}parts[_i41]=parts[_i41].replaceAll(/\\(.)/g,"$1")}value=parts.join("\"")}return value}function rfc5987decode(extvalue){var encodingend=extvalue.indexOf("'");if(encodingend===-1){return extvalue}var encoding=extvalue.slice(0,encodingend);var langvalue=extvalue.slice(encodingend+1);var value=langvalue.replace(/^[^']*'/,"");return textdecode(encoding,value)}function rfc2047decode(value){if(!value.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(value)){return value}return value.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(matches,charset,encoding,text){if(encoding==="q"||encoding==="Q"){text=text.replaceAll("_"," ");text=text.replaceAll(/=([0-9a-fA-F]{2})/g,function(match,hex){return String.fromCharCode(parseInt(hex,16))});return textdecode(charset,text)}try{text=atob(text)}catch(_unused16){}return textdecode(charset,text)})}return""}}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFNetworkStream=void 0;var _util=__w_pdfjs_require__(1);var _network_utils=__w_pdfjs_require__(20);var OK_RESPONSE=200;var PARTIAL_CONTENT_RESPONSE=206;function getArrayBuffer(xhr){var data=xhr.response;if(typeof data!=="string"){return data}return(0,_util.stringToBytes)(data).buffer}var NetworkManager=function(){function NetworkManager(url){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck2(this,NetworkManager);this.url=url;this.isHttp=/^https?:/i.test(url);this.httpHeaders=this.isHttp&&args.httpHeaders||Object.create(null);this.withCredentials=args.withCredentials||false;this.currXhrId=0;this.pendingRequests=Object.create(null)}_createClass2(NetworkManager,[{key:"requestRange",value:function requestRange(begin,end,listeners){var args={begin:begin,end:end};for(var prop in listeners){args[prop]=listeners[prop]}return this.request(args)}},{key:"requestFull",value:function requestFull(listeners){return this.request(listeners)}},{key:"request",value:function request(args){var xhr=new XMLHttpRequest;var xhrId=this.currXhrId++;var pendingRequest=this.pendingRequests[xhrId]={xhr:xhr};xhr.open("GET",this.url);xhr.withCredentials=this.withCredentials;for(var property in this.httpHeaders){var value=this.httpHeaders[property];if(value===undefined){continue}xhr.setRequestHeader(property,value)}if(this.isHttp&&"begin"in args&&"end"in args){xhr.setRequestHeader("Range","bytes=".concat(args.begin,"-").concat(args.end-1));pendingRequest.expectedStatus=PARTIAL_CONTENT_RESPONSE}else{pendingRequest.expectedStatus=OK_RESPONSE}xhr.responseType="arraybuffer";if(args.onError){xhr.onerror=function(evt){args.onError(xhr.status)}}xhr.onreadystatechange=this.onStateChange.bind(this,xhrId);xhr.onprogress=this.onProgress.bind(this,xhrId);pendingRequest.onHeadersReceived=args.onHeadersReceived;pendingRequest.onDone=args.onDone;pendingRequest.onError=args.onError;pendingRequest.onProgress=args.onProgress;xhr.send(null);return xhrId}},{key:"onProgress",value:function onProgress(xhrId,evt){var _pendingRequest$onPro;var pendingRequest=this.pendingRequests[xhrId];if(!pendingRequest){return}(_pendingRequest$onPro=pendingRequest.onProgress)===null||_pendingRequest$onPro===void 0||_pendingRequest$onPro.call(pendingRequest,evt)}},{key:"onStateChange",value:function onStateChange(xhrId,evt){var pendingRequest=this.pendingRequests[xhrId];if(!pendingRequest){return}var xhr=pendingRequest.xhr;if(xhr.readyState>=2&&pendingRequest.onHeadersReceived){pendingRequest.onHeadersReceived();delete pendingRequest.onHeadersReceived}if(xhr.readyState!==4){return}if(!(xhrId in this.pendingRequests)){return}delete this.pendingRequests[xhrId];if(xhr.status===0&&this.isHttp){var _pendingRequest$onErr;(_pendingRequest$onErr=pendingRequest.onError)===null||_pendingRequest$onErr===void 0||_pendingRequest$onErr.call(pendingRequest,xhr.status);return}var xhrStatus=xhr.status||OK_RESPONSE;var ok_response_on_range_request=xhrStatus===OK_RESPONSE&&pendingRequest.expectedStatus===PARTIAL_CONTENT_RESPONSE;if(!ok_response_on_range_request&&xhrStatus!==pendingRequest.expectedStatus){var _pendingRequest$onErr2;(_pendingRequest$onErr2=pendingRequest.onError)===null||_pendingRequest$onErr2===void 0||_pendingRequest$onErr2.call(pendingRequest,xhr.status);return}var chunk=getArrayBuffer(xhr);if(xhrStatus===PARTIAL_CONTENT_RESPONSE){var rangeHeader=xhr.getResponseHeader("Content-Range");var matches=/bytes (\d+)-(\d+)\/(\d+)/.exec(rangeHeader);pendingRequest.onDone({begin:parseInt(matches[1],10),chunk:chunk})}else if(chunk){pendingRequest.onDone({begin:0,chunk:chunk})}else{var _pendingRequest$onErr3;(_pendingRequest$onErr3=pendingRequest.onError)===null||_pendingRequest$onErr3===void 0||_pendingRequest$onErr3.call(pendingRequest,xhr.status)}}},{key:"getRequestXhr",value:function getRequestXhr(xhrId){return this.pendingRequests[xhrId].xhr}},{key:"isPendingRequest",value:function isPendingRequest(xhrId){return xhrId in this.pendingRequests}},{key:"abortRequest",value:function abortRequest(xhrId){var xhr=this.pendingRequests[xhrId].xhr;delete this.pendingRequests[xhrId];xhr.abort()}}]);return NetworkManager}();var PDFNetworkStream=function(){function PDFNetworkStream(source){_classCallCheck2(this,PDFNetworkStream);this._source=source;this._manager=new NetworkManager(source.url,{httpHeaders:source.httpHeaders,withCredentials:source.withCredentials});this._rangeChunkSize=source.rangeChunkSize;this._fullRequestReader=null;this._rangeRequestReaders=[]}_createClass2(PDFNetworkStream,[{key:"_onRangeRequestReaderClosed",value:function _onRangeRequestReaderClosed(reader){var i=this._rangeRequestReaders.indexOf(reader);if(i>=0){this._rangeRequestReaders.splice(i,1)}}},{key:"getFullReader",value:function getFullReader(){(0,_util.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once.");this._fullRequestReader=new PDFNetworkStreamFullRequestReader(this._manager,this._source);return this._fullRequestReader}},{key:"getRangeReader",value:function getRangeReader(begin,end){var reader=new PDFNetworkStreamRangeRequestReader(this._manager,begin,end);reader.onClosed=this._onRangeRequestReaderClosed.bind(this);this._rangeRequestReaders.push(reader);return reader}},{key:"cancelAllRequests",value:function cancelAllRequests(reason){var _this$_fullRequestRea10;(_this$_fullRequestRea10=this._fullRequestReader)===null||_this$_fullRequestRea10===void 0||_this$_fullRequestRea10.cancel(reason);var _iterator97=_createForOfIteratorHelper(this._rangeRequestReaders.slice(0)),_step97;try{for(_iterator97.s();!(_step97=_iterator97.n()).done;){var reader=_step97.value;reader.cancel(reason)}}catch(err){_iterator97.e(err)}finally{_iterator97.f()}}}]);return PDFNetworkStream}();exports.PDFNetworkStream=PDFNetworkStream;var PDFNetworkStreamFullRequestReader=function(){function PDFNetworkStreamFullRequestReader(manager,source){_classCallCheck2(this,PDFNetworkStreamFullRequestReader);this._manager=manager;var args={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=source.url;this._fullRequestId=manager.requestFull(args);this._headersReceivedCapability=new _util.PromiseCapability;this._disableRange=source.disableRange||false;this._contentLength=source.length;this._rangeChunkSize=source.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._isStreamingSupported=false;this._isRangeSupported=false;this._cachedChunks=[];this._requests=[];this._done=false;this._storedError=undefined;this._filename=null;this.onProgress=null}_createClass2(PDFNetworkStreamFullRequestReader,[{key:"_onHeadersReceived",value:function _onHeadersReceived(){var fullRequestXhrId=this._fullRequestId;var fullRequestXhr=this._manager.getRequestXhr(fullRequestXhrId);var getResponseHeader=function getResponseHeader(name){return fullRequestXhr.getResponseHeader(name)};var _ref76=(0,_network_utils.validateRangeRequestCapabilities)({getResponseHeader:getResponseHeader,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange}),allowRangeRequests=_ref76.allowRangeRequests,suggestedLength=_ref76.suggestedLength;if(allowRangeRequests){this._isRangeSupported=true}this._contentLength=suggestedLength||this._contentLength;this._filename=(0,_network_utils.extractFilenameFromHeader)(getResponseHeader);if(this._isRangeSupported){this._manager.abortRequest(fullRequestXhrId)}this._headersReceivedCapability.resolve()}},{key:"_onDone",value:function _onDone(data){if(data){if(this._requests.length>0){var requestCapability=this._requests.shift();requestCapability.resolve({value:data.chunk,done:false})}else{this._cachedChunks.push(data.chunk)}}this._done=true;if(this._cachedChunks.length>0){return}var _iterator98=_createForOfIteratorHelper(this._requests),_step98;try{for(_iterator98.s();!(_step98=_iterator98.n()).done;){var _requestCapability=_step98.value;_requestCapability.resolve({value:undefined,done:true})}}catch(err){_iterator98.e(err)}finally{_iterator98.f()}this._requests.length=0}},{key:"_onError",value:function _onError(status){this._storedError=(0,_network_utils.createResponseStatusError)(status,this._url);this._headersReceivedCapability.reject(this._storedError);var _iterator99=_createForOfIteratorHelper(this._requests),_step99;try{for(_iterator99.s();!(_step99=_iterator99.n()).done;){var requestCapability=_step99.value;requestCapability.reject(this._storedError)}}catch(err){_iterator99.e(err)}finally{_iterator99.f()}this._requests.length=0;this._cachedChunks.length=0}},{key:"_onProgress",value:function _onProgress(evt){var _this$onProgress3;(_this$onProgress3=this.onProgress)===null||_this$onProgress3===void 0||_this$onProgress3.call(this,{loaded:evt.loaded,total:evt.lengthComputable?evt.total:this._contentLength})}},{key:"filename",get:function get(){return this._filename}},{key:"isRangeSupported",get:function get(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported}},{key:"contentLength",get:function get(){return this._contentLength}},{key:"headersReady",get:function get(){return this._headersReceivedCapability.promise}},{key:"read",value:function(){var _read5=_asyncToGenerator(_regeneratorRuntime().mark(function _callee56(){var chunk,requestCapability;return _regeneratorRuntime().wrap(function _callee56$(_context57){while(1)switch(_context57.prev=_context57.next){case 0:if(!this._storedError){_context57.next=2;break}throw this._storedError;case 2:if(!(this._cachedChunks.length>0)){_context57.next=5;break}chunk=this._cachedChunks.shift();return _context57.abrupt("return",{value:chunk,done:false});case 5:if(!this._done){_context57.next=7;break}return _context57.abrupt("return",{value:undefined,done:true});case 7:requestCapability=new _util.PromiseCapability;this._requests.push(requestCapability);return _context57.abrupt("return",requestCapability.promise);case 10:case"end":return _context57.stop()}},_callee56,this)}));function read(){return _read5.apply(this,arguments)}return read}()},{key:"cancel",value:function cancel(reason){this._done=true;this._headersReceivedCapability.reject(reason);var _iterator100=_createForOfIteratorHelper(this._requests),_step100;try{for(_iterator100.s();!(_step100=_iterator100.n()).done;){var requestCapability=_step100.value;requestCapability.resolve({value:undefined,done:true})}}catch(err){_iterator100.e(err)}finally{_iterator100.f()}this._requests.length=0;if(this._manager.isPendingRequest(this._fullRequestId)){this._manager.abortRequest(this._fullRequestId)}this._fullRequestReader=null}}]);return PDFNetworkStreamFullRequestReader}();var PDFNetworkStreamRangeRequestReader=function(){function PDFNetworkStreamRangeRequestReader(manager,begin,end){_classCallCheck2(this,PDFNetworkStreamRangeRequestReader);this._manager=manager;var args={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=manager.url;this._requestId=manager.requestRange(begin,end,args);this._requests=[];this._queuedChunk=null;this._done=false;this._storedError=undefined;this.onProgress=null;this.onClosed=null}_createClass2(PDFNetworkStreamRangeRequestReader,[{key:"_close",value:function _close(){var _this$onClosed;(_this$onClosed=this.onClosed)===null||_this$onClosed===void 0||_this$onClosed.call(this,this)}},{key:"_onDone",value:function _onDone(data){var chunk=data.chunk;if(this._requests.length>0){var requestCapability=this._requests.shift();requestCapability.resolve({value:chunk,done:false})}else{this._queuedChunk=chunk}this._done=true;var _iterator101=_createForOfIteratorHelper(this._requests),_step101;try{for(_iterator101.s();!(_step101=_iterator101.n()).done;){var _requestCapability2=_step101.value;_requestCapability2.resolve({value:undefined,done:true})}}catch(err){_iterator101.e(err)}finally{_iterator101.f()}this._requests.length=0;this._close()}},{key:"_onError",value:function _onError(status){this._storedError=(0,_network_utils.createResponseStatusError)(status,this._url);var _iterator102=_createForOfIteratorHelper(this._requests),_step102;try{for(_iterator102.s();!(_step102=_iterator102.n()).done;){var requestCapability=_step102.value;requestCapability.reject(this._storedError)}}catch(err){_iterator102.e(err)}finally{_iterator102.f()}this._requests.length=0;this._queuedChunk=null}},{key:"_onProgress",value:function _onProgress(evt){if(!this.isStreamingSupported){var _this$onProgress4;(_this$onProgress4=this.onProgress)===null||_this$onProgress4===void 0||_this$onProgress4.call(this,{loaded:evt.loaded})}}},{key:"isStreamingSupported",get:function get(){return false}},{key:"read",value:function(){var _read6=_asyncToGenerator(_regeneratorRuntime().mark(function _callee57(){var chunk,requestCapability;return _regeneratorRuntime().wrap(function _callee57$(_context58){while(1)switch(_context58.prev=_context58.next){case 0:if(!this._storedError){_context58.next=2;break}throw this._storedError;case 2:if(!(this._queuedChunk!==null)){_context58.next=6;break}chunk=this._queuedChunk;this._queuedChunk=null;return _context58.abrupt("return",{value:chunk,done:false});case 6:if(!this._done){_context58.next=8;break}return _context58.abrupt("return",{value:undefined,done:true});case 8:requestCapability=new _util.PromiseCapability;this._requests.push(requestCapability);return _context58.abrupt("return",requestCapability.promise);case 11:case"end":return _context58.stop()}},_callee57,this)}));function read(){return _read6.apply(this,arguments)}return read}()},{key:"cancel",value:function cancel(reason){this._done=true;var _iterator103=_createForOfIteratorHelper(this._requests),_step103;try{for(_iterator103.s();!(_step103=_iterator103.n()).done;){var requestCapability=_step103.value;requestCapability.resolve({value:undefined,done:true})}}catch(err){_iterator103.e(err)}finally{_iterator103.f()}this._requests.length=0;if(this._manager.isPendingRequest(this._requestId)){this._manager.abortRequest(this._requestId)}this._close()}}]);return PDFNetworkStreamRangeRequestReader}()}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFNodeStream=void 0;var _util=__w_pdfjs_require__(1);var _network_utils=__w_pdfjs_require__(20);var fileUriRegex=/^file:\/\/\/[a-zA-Z]:\//;function parseUrl(sourceUrl){var url=require$$5;var parsedUrl=url.parse(sourceUrl);if(parsedUrl.protocol==="file:"||parsedUrl.host){return parsedUrl}if(/^[a-z]:[/\\]/i.test(sourceUrl)){return url.parse("file:///".concat(sourceUrl))}if(!parsedUrl.host){parsedUrl.protocol="file:"}return parsedUrl}var PDFNodeStream=function(){function PDFNodeStream(source){_classCallCheck2(this,PDFNodeStream);this.source=source;this.url=parseUrl(source.url);this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:";this.isFsUrl=this.url.protocol==="file:";this.httpHeaders=this.isHttp&&source.httpHeaders||{};this._fullRequestReader=null;this._rangeRequestReaders=[]}_createClass2(PDFNodeStream,[{key:"_progressiveDataLength",get:function get(){var _this$_fullRequestRea11,_this$_fullRequestRea12;return(_this$_fullRequestRea11=(_this$_fullRequestRea12=this._fullRequestReader)===null||_this$_fullRequestRea12===void 0?void 0:_this$_fullRequestRea12._loaded)!==null&&_this$_fullRequestRea11!==void 0?_this$_fullRequestRea11:0}},{key:"getFullReader",value:function getFullReader(){(0,_util.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once.");this._fullRequestReader=this.isFsUrl?new PDFNodeStreamFsFullReader(this):new PDFNodeStreamFullReader(this);return this._fullRequestReader}},{key:"getRangeReader",value:function getRangeReader(start,end){if(end<=this._progressiveDataLength){return null}var rangeReader=this.isFsUrl?new PDFNodeStreamFsRangeReader(this,start,end):new PDFNodeStreamRangeReader(this,start,end);this._rangeRequestReaders.push(rangeReader);return rangeReader}},{key:"cancelAllRequests",value:function cancelAllRequests(reason){var _this$_fullRequestRea13;(_this$_fullRequestRea13=this._fullRequestReader)===null||_this$_fullRequestRea13===void 0||_this$_fullRequestRea13.cancel(reason);var _iterator104=_createForOfIteratorHelper(this._rangeRequestReaders.slice(0)),_step104;try{for(_iterator104.s();!(_step104=_iterator104.n()).done;){var reader=_step104.value;reader.cancel(reason)}}catch(err){_iterator104.e(err)}finally{_iterator104.f()}}}]);return PDFNodeStream}();exports.PDFNodeStream=PDFNodeStream;var BaseFullReader=function(){function BaseFullReader(stream){_classCallCheck2(this,BaseFullReader);this._url=stream.url;this._done=false;this._storedError=null;this.onProgress=null;var source=stream.source;this._contentLength=source.length;this._loaded=0;this._filename=null;this._disableRange=source.disableRange||false;this._rangeChunkSize=source.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._isStreamingSupported=!source.disableStream;this._isRangeSupported=!source.disableRange;this._readableStream=null;this._readCapability=new _util.PromiseCapability;this._headersCapability=new _util.PromiseCapability}_createClass2(BaseFullReader,[{key:"headersReady",get:function get(){return this._headersCapability.promise}},{key:"filename",get:function get(){return this._filename}},{key:"contentLength",get:function get(){return this._contentLength}},{key:"isRangeSupported",get:function get(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported}},{key:"read",value:function(){var _read7=_asyncToGenerator(_regeneratorRuntime().mark(function _callee58(){var _this$onProgress5;var chunk,buffer;return _regeneratorRuntime().wrap(function _callee58$(_context59){while(1)switch(_context59.prev=_context59.next){case 0:_context59.next=2;return this._readCapability.promise;case 2:if(!this._done){_context59.next=4;break}return _context59.abrupt("return",{value:undefined,done:true});case 4:if(!this._storedError){_context59.next=6;break}throw this._storedError;case 6:chunk=this._readableStream.read();if(!(chunk===null)){_context59.next=10;break}this._readCapability=new _util.PromiseCapability;return _context59.abrupt("return",this.read());case 10:this._loaded+=chunk.length;(_this$onProgress5=this.onProgress)===null||_this$onProgress5===void 0||_this$onProgress5.call(this,{loaded:this._loaded,total:this._contentLength});buffer=new Uint8Array(chunk).buffer;return _context59.abrupt("return",{value:buffer,done:false});case 14:case"end":return _context59.stop()}},_callee58,this)}));function read(){return _read7.apply(this,arguments)}return read}()},{key:"cancel",value:function cancel(reason){if(!this._readableStream){this._error(reason);return}this._readableStream.destroy(reason)}},{key:"_error",value:function _error(reason){this._storedError=reason;this._readCapability.resolve()}},{key:"_setReadableStream",value:function _setReadableStream(readableStream){var _this86=this;this._readableStream=readableStream;readableStream.on("readable",function(){_this86._readCapability.resolve()});readableStream.on("end",function(){readableStream.destroy();_this86._done=true;_this86._readCapability.resolve()});readableStream.on("error",function(reason){_this86._error(reason)});if(!this._isStreamingSupported&&this._isRangeSupported){this._error(new _util.AbortException("streaming is disabled"))}if(this._storedError){this._readableStream.destroy(this._storedError)}}}]);return BaseFullReader}();var BaseRangeReader=function(){function BaseRangeReader(stream){_classCallCheck2(this,BaseRangeReader);this._url=stream.url;this._done=false;this._storedError=null;this.onProgress=null;this._loaded=0;this._readableStream=null;this._readCapability=new _util.PromiseCapability;var source=stream.source;this._isStreamingSupported=!source.disableStream}_createClass2(BaseRangeReader,[{key:"isStreamingSupported",get:function get(){return this._isStreamingSupported}},{key:"read",value:function(){var _read8=_asyncToGenerator(_regeneratorRuntime().mark(function _callee59(){var _this$onProgress6;var chunk,buffer;return _regeneratorRuntime().wrap(function _callee59$(_context60){while(1)switch(_context60.prev=_context60.next){case 0:_context60.next=2;return this._readCapability.promise;case 2:if(!this._done){_context60.next=4;break}return _context60.abrupt("return",{value:undefined,done:true});case 4:if(!this._storedError){_context60.next=6;break}throw this._storedError;case 6:chunk=this._readableStream.read();if(!(chunk===null)){_context60.next=10;break}this._readCapability=new _util.PromiseCapability;return _context60.abrupt("return",this.read());case 10:this._loaded+=chunk.length;(_this$onProgress6=this.onProgress)===null||_this$onProgress6===void 0||_this$onProgress6.call(this,{loaded:this._loaded});buffer=new Uint8Array(chunk).buffer;return _context60.abrupt("return",{value:buffer,done:false});case 14:case"end":return _context60.stop()}},_callee59,this)}));function read(){return _read8.apply(this,arguments)}return read}()},{key:"cancel",value:function cancel(reason){if(!this._readableStream){this._error(reason);return}this._readableStream.destroy(reason)}},{key:"_error",value:function _error(reason){this._storedError=reason;this._readCapability.resolve()}},{key:"_setReadableStream",value:function _setReadableStream(readableStream){var _this87=this;this._readableStream=readableStream;readableStream.on("readable",function(){_this87._readCapability.resolve()});readableStream.on("end",function(){readableStream.destroy();_this87._done=true;_this87._readCapability.resolve()});readableStream.on("error",function(reason){_this87._error(reason)});if(this._storedError){this._readableStream.destroy(this._storedError)}}}]);return BaseRangeReader}();function createRequestOptions(parsedUrl,headers){return{protocol:parsedUrl.protocol,auth:parsedUrl.auth,host:parsedUrl.hostname,port:parsedUrl.port,path:parsedUrl.path,method:"GET",headers:headers}}var PDFNodeStreamFullReader=function(_BaseFullReader){_inherits2(PDFNodeStreamFullReader,_BaseFullReader);var _super35=_createSuper(PDFNodeStreamFullReader);function PDFNodeStreamFullReader(stream){var _this88;_classCallCheck2(this,PDFNodeStreamFullReader);_this88=_super35.call(this,stream);var handleResponse=function handleResponse(response){if(response.statusCode===404){var error=new _util.MissingPDFException("Missing PDF \"".concat(_this88._url,"\"."));_this88._storedError=error;_this88._headersCapability.reject(error);return}_this88._headersCapability.resolve();_this88._setReadableStream(response);var getResponseHeader=function getResponseHeader(name){return _this88._readableStream.headers[name.toLowerCase()]};var _ref77=(0,_network_utils.validateRangeRequestCapabilities)({getResponseHeader:getResponseHeader,isHttp:stream.isHttp,rangeChunkSize:_this88._rangeChunkSize,disableRange:_this88._disableRange}),allowRangeRequests=_ref77.allowRangeRequests,suggestedLength=_ref77.suggestedLength;_this88._isRangeSupported=allowRangeRequests;_this88._contentLength=suggestedLength||_this88._contentLength;_this88._filename=(0,_network_utils.extractFilenameFromHeader)(getResponseHeader)};_this88._request=null;if(_this88._url.protocol==="http:"){var http=require$$5;_this88._request=http.request(createRequestOptions(_this88._url,stream.httpHeaders),handleResponse)}else{var https=require$$5;_this88._request=https.request(createRequestOptions(_this88._url,stream.httpHeaders),handleResponse)}_this88._request.on("error",function(reason){_this88._storedError=reason;_this88._headersCapability.reject(reason)});_this88._request.end();return _this88}return _createClass2(PDFNodeStreamFullReader)}(BaseFullReader);var PDFNodeStreamRangeReader=function(_BaseRangeReader){_inherits2(PDFNodeStreamRangeReader,_BaseRangeReader);var _super36=_createSuper(PDFNodeStreamRangeReader);function PDFNodeStreamRangeReader(stream,start,end){var _this89;_classCallCheck2(this,PDFNodeStreamRangeReader);_this89=_super36.call(this,stream);_this89._httpHeaders={};for(var property in stream.httpHeaders){var value=stream.httpHeaders[property];if(value===undefined){continue}_this89._httpHeaders[property]=value}_this89._httpHeaders.Range="bytes=".concat(start,"-").concat(end-1);var handleResponse=function handleResponse(response){if(response.statusCode===404){var error=new _util.MissingPDFException("Missing PDF \"".concat(_this89._url,"\"."));_this89._storedError=error;return}_this89._setReadableStream(response)};_this89._request=null;if(_this89._url.protocol==="http:"){var http=require$$5;_this89._request=http.request(createRequestOptions(_this89._url,_this89._httpHeaders),handleResponse)}else{var https=require$$5;_this89._request=https.request(createRequestOptions(_this89._url,_this89._httpHeaders),handleResponse)}_this89._request.on("error",function(reason){_this89._storedError=reason});_this89._request.end();return _this89}return _createClass2(PDFNodeStreamRangeReader)}(BaseRangeReader);var PDFNodeStreamFsFullReader=function(_BaseFullReader2){_inherits2(PDFNodeStreamFsFullReader,_BaseFullReader2);var _super37=_createSuper(PDFNodeStreamFsFullReader);function PDFNodeStreamFsFullReader(stream){var _this90;_classCallCheck2(this,PDFNodeStreamFsFullReader);_this90=_super37.call(this,stream);var path=decodeURIComponent(_this90._url.path);if(fileUriRegex.test(_this90._url.href)){path=path.replace(/^\//,"")}var fs=require$$5;fs.lstat(path,function(error,stat){if(error){if(error.code==="ENOENT"){error=new _util.MissingPDFException("Missing PDF \"".concat(path,"\"."))}_this90._storedError=error;_this90._headersCapability.reject(error);return}_this90._contentLength=stat.size;_this90._setReadableStream(fs.createReadStream(path));_this90._headersCapability.resolve()});return _this90}return _createClass2(PDFNodeStreamFsFullReader)}(BaseFullReader);var PDFNodeStreamFsRangeReader=function(_BaseRangeReader2){_inherits2(PDFNodeStreamFsRangeReader,_BaseRangeReader2);var _super38=_createSuper(PDFNodeStreamFsRangeReader);function PDFNodeStreamFsRangeReader(stream,start,end){var _this91;_classCallCheck2(this,PDFNodeStreamFsRangeReader);_this91=_super38.call(this,stream);var path=decodeURIComponent(_this91._url.path);if(fileUriRegex.test(_this91._url.href)){path=path.replace(/^\//,"")}var fs=require$$5;_this91._setReadableStream(fs.createReadStream(path,{start:start,end:end-1}));return _this91}return _createClass2(PDFNodeStreamFsRangeReader)}(BaseRangeReader)}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.SVGGraphics=void 0;var _display_utils=__w_pdfjs_require__(6);var _util=__w_pdfjs_require__(1);var SVG_DEFAULTS={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"};var XML_NS="http://www.w3.org/XML/1998/namespace";var XLINK_NS="http://www.w3.org/1999/xlink";var LINE_CAP_STYLES=["butt","round","square"];var LINE_JOIN_STYLES=["miter","round","bevel"];var createObjectURL=function createObjectURL(data){var contentType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var forceDataSchema=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(URL.createObjectURL&&typeof Blob!=="undefined"&&!forceDataSchema){return URL.createObjectURL(new Blob([data],{type:contentType}))}var digits="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var buffer="data:".concat(contentType,";base64,");for(var _i42=0,ii=data.length;_i42<ii;_i42+=3){var b1=data[_i42]&255;var b2=data[_i42+1]&255;var b3=data[_i42+2]&255;var d1=b1>>2,d2=(b1&3)<<4|b2>>4;var d3=_i42+1<ii?(b2&15)<<2|b3>>6:64;var d4=_i42+2<ii?b3&63:64;buffer+=digits[d1]+digits[d2]+digits[d3]+digits[d4]}return buffer};var convertImgDataToPng=function(){var PNG_HEADER=new Uint8Array([137,80,78,71,13,10,26,10]);var CHUNK_WRAPPER_SIZE=12;var crcTable=new Int32Array(256);for(var _i43=0;_i43<256;_i43++){var c=_i43;for(var h=0;h<8;h++){c=c&1?3988292384^c>>1&2147483647:c>>1&2147483647}crcTable[_i43]=c}function crc32(data,start,end){var crc=-1;for(var _i44=start;_i44<end;_i44++){var a=(crc^data[_i44])&255;var b=crcTable[a];crc=crc>>>8^b}return crc^-1}function writePngChunk(type,body,data,offset){var p=offset;var len=body.length;data[p]=len>>24&255;data[p+1]=len>>16&255;data[p+2]=len>>8&255;data[p+3]=len&255;p+=4;data[p]=type.charCodeAt(0)&255;data[p+1]=type.charCodeAt(1)&255;data[p+2]=type.charCodeAt(2)&255;data[p+3]=type.charCodeAt(3)&255;p+=4;data.set(body,p);p+=body.length;var crc=crc32(data,offset+4,p);data[p]=crc>>24&255;data[p+1]=crc>>16&255;data[p+2]=crc>>8&255;data[p+3]=crc&255}function adler32(data,start,end){var a=1;var b=0;for(var _i45=start;_i45<end;++_i45){a=(a+(data[_i45]&255))%65521;b=(b+a)%65521}return b<<16|a}function deflateSync(literals){if(!_util.isNodeJS){return deflateSyncUncompressed(literals)}try{var input=parseInt(process.versions.node)>=8?literals:Buffer.from(literals);var output=require$$5.deflateSync(input,{level:9});return output instanceof Uint8Array?output:new Uint8Array(output)}catch(e){(0,_util.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+e)}return deflateSyncUncompressed(literals)}function deflateSyncUncompressed(literals){var len=literals.length;var maxBlockLength=65535;var deflateBlocks=Math.ceil(len/maxBlockLength);var idat=new Uint8Array(2+len+deflateBlocks*5+4);var pi=0;idat[pi++]=120;idat[pi++]=156;var pos=0;while(len>maxBlockLength){idat[pi++]=0;idat[pi++]=255;idat[pi++]=255;idat[pi++]=0;idat[pi++]=0;idat.set(literals.subarray(pos,pos+maxBlockLength),pi);pi+=maxBlockLength;pos+=maxBlockLength;len-=maxBlockLength}idat[pi++]=1;idat[pi++]=len&255;idat[pi++]=len>>8&255;idat[pi++]=~len&65535&255;idat[pi++]=(~len&65535)>>8&255;idat.set(literals.subarray(pos),pi);pi+=literals.length-pos;var adler=adler32(literals,0,literals.length);idat[pi++]=adler>>24&255;idat[pi++]=adler>>16&255;idat[pi++]=adler>>8&255;idat[pi++]=adler&255;return idat}function encode(imgData,kind,forceDataSchema,isMask){var width=imgData.width;var height=imgData.height;var bitDepth,colorType,lineSize;var bytes=imgData.data;switch(kind){case _util.ImageKind.GRAYSCALE_1BPP:colorType=0;bitDepth=1;lineSize=width+7>>3;break;case _util.ImageKind.RGB_24BPP:colorType=2;bitDepth=8;lineSize=width*3;break;case _util.ImageKind.RGBA_32BPP:colorType=6;bitDepth=8;lineSize=width*4;break;default:throw new Error("invalid format")}var literals=new Uint8Array((1+lineSize)*height);var offsetLiterals=0,offsetBytes=0;for(var y=0;y<height;++y){literals[offsetLiterals++]=0;literals.set(bytes.subarray(offsetBytes,offsetBytes+lineSize),offsetLiterals);offsetBytes+=lineSize;offsetLiterals+=lineSize}if(kind===_util.ImageKind.GRAYSCALE_1BPP&&isMask){offsetLiterals=0;for(var _y2=0;_y2<height;_y2++){offsetLiterals++;for(var _i46=0;_i46<lineSize;_i46++){literals[offsetLiterals++]^=255}}}var ihdr=new Uint8Array([width>>24&255,width>>16&255,width>>8&255,width&255,height>>24&255,height>>16&255,height>>8&255,height&255,bitDepth,colorType,0,0,0]);var idat=deflateSync(literals);var pngLength=PNG_HEADER.length+CHUNK_WRAPPER_SIZE*3+ihdr.length+idat.length;var data=new Uint8Array(pngLength);var offset=0;data.set(PNG_HEADER,offset);offset+=PNG_HEADER.length;writePngChunk("IHDR",ihdr,data,offset);offset+=CHUNK_WRAPPER_SIZE+ihdr.length;writePngChunk("IDATA",idat,data,offset);offset+=CHUNK_WRAPPER_SIZE+idat.length;writePngChunk("IEND",new Uint8Array(0),data,offset);return createObjectURL(data,"image/png",forceDataSchema)}return function convertImgDataToPng(imgData,forceDataSchema,isMask){var kind=imgData.kind===undefined?_util.ImageKind.GRAYSCALE_1BPP:imgData.kind;return encode(imgData,kind,forceDataSchema,isMask)}}();var SVGExtraState=function(){function SVGExtraState(){_classCallCheck2(this,SVGExtraState);this.fontSizeScale=1;this.fontWeight=SVG_DEFAULTS.fontWeight;this.fontSize=0;this.textMatrix=_util.IDENTITY_MATRIX;this.fontMatrix=_util.FONT_IDENTITY_MATRIX;this.leading=0;this.textRenderingMode=_util.TextRenderingMode.FILL;this.textMatrixScale=1;this.x=0;this.y=0;this.lineX=0;this.lineY=0;this.charSpacing=0;this.wordSpacing=0;this.textHScale=1;this.textRise=0;this.fillColor=SVG_DEFAULTS.fillColor;this.strokeColor="#000000";this.fillAlpha=1;this.strokeAlpha=1;this.lineWidth=1;this.lineJoin="";this.lineCap="";this.miterLimit=0;this.dashArray=[];this.dashPhase=0;this.dependencies=[];this.activeClipUrl=null;this.clipGroup=null;this.maskId=""}_createClass2(SVGExtraState,[{key:"clone",value:function clone(){return Object.create(this)}},{key:"setCurrentPoint",value:function setCurrentPoint(x,y){this.x=x;this.y=y}}]);return SVGExtraState}();function opListToTree(opList){var opTree=[];var tmp=[];var _iterator105=_createForOfIteratorHelper(opList),_step105;try{for(_iterator105.s();!(_step105=_iterator105.n()).done;){var opListElement=_step105.value;if(opListElement.fn==="save"){opTree.push({fnId:92,fn:"group",items:[]});tmp.push(opTree);opTree=opTree.at(-1).items;continue}if(opListElement.fn==="restore"){opTree=tmp.pop()}else{opTree.push(opListElement)}}}catch(err){_iterator105.e(err)}finally{_iterator105.f()}return opTree}function pf(value){if(Number.isInteger(value)){return value.toString()}var s=value.toFixed(10);var i=s.length-1;if(s[i]!=="0"){return s}do{i--}while(s[i]==="0");return s.substring(0,s[i]==="."?i:i+1)}function pm(m){if(m[4]===0&&m[5]===0){if(m[1]===0&&m[2]===0){if(m[0]===1&&m[3]===1){return""}return"scale(".concat(pf(m[0])," ").concat(pf(m[3]),")")}if(m[0]===m[3]&&m[1]===-m[2]){var a=Math.acos(m[0])*180/Math.PI;return"rotate(".concat(pf(a),")")}}else if(m[0]===1&&m[1]===0&&m[2]===0&&m[3]===1){return"translate(".concat(pf(m[4])," ").concat(pf(m[5]),")")}return"matrix(".concat(pf(m[0])," ").concat(pf(m[1])," ").concat(pf(m[2])," ").concat(pf(m[3])," ").concat(pf(m[4])," ")+"".concat(pf(m[5]),")")}var clipCount=0;var maskCount=0;var shadingCount=0;var SVGGraphics=function(){function SVGGraphics(commonObjs,objs){var forceDataSchema=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;_classCallCheck2(this,SVGGraphics);(0,_display_utils.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future.");this.svgFactory=new _display_utils.DOMSVGFactory;this.current=new SVGExtraState;this.transformMatrix=_util.IDENTITY_MATRIX;this.transformStack=[];this.extraStack=[];this.commonObjs=commonObjs;this.objs=objs;this.pendingClip=null;this.pendingEOFill=false;this.embedFonts=false;this.embeddedFonts=Object.create(null);this.cssStyle=null;this.forceDataSchema=!!forceDataSchema;this._operatorIdMapping=[];for(var op in _util.OPS){this._operatorIdMapping[_util.OPS[op]]=op}}_createClass2(SVGGraphics,[{key:"getObject",value:function getObject(data){var fallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(typeof data==="string"){return data.startsWith("g_")?this.commonObjs.get(data):this.objs.get(data)}return fallback}},{key:"save",value:function save(){this.transformStack.push(this.transformMatrix);var old=this.current;this.extraStack.push(old);this.current=old.clone()}},{key:"restore",value:function restore(){this.transformMatrix=this.transformStack.pop();this.current=this.extraStack.pop();this.pendingClip=null;this.tgrp=null}},{key:"group",value:function group(items){this.save();this.executeOpTree(items);this.restore()}},{key:"loadDependencies",value:function loadDependencies(operatorList){var _this92=this;var fnArray=operatorList.fnArray;var argsArray=operatorList.argsArray;for(var _i47=0,ii=fnArray.length;_i47<ii;_i47++){if(fnArray[_i47]!==_util.OPS.dependency){continue}var _iterator106=_createForOfIteratorHelper(argsArray[_i47]),_step106;try{var _loop4=function _loop4(){var obj=_step106.value;var objsPool=obj.startsWith("g_")?_this92.commonObjs:_this92.objs;var promise=new Promise(function(resolve){objsPool.get(obj,resolve)});_this92.current.dependencies.push(promise)};for(_iterator106.s();!(_step106=_iterator106.n()).done;){_loop4()}}catch(err){_iterator106.e(err)}finally{_iterator106.f()}}return Promise.all(this.current.dependencies)}},{key:"transform",value:function transform(a,b,c,d,e,f){var transformMatrix=[a,b,c,d,e,f];this.transformMatrix=_util.Util.transform(this.transformMatrix,transformMatrix);this.tgrp=null}},{key:"getSVG",value:function getSVG(operatorList,viewport){var _this93=this;this.viewport=viewport;var svgElement=this._initialize(viewport);return this.loadDependencies(operatorList).then(function(){_this93.transformMatrix=_util.IDENTITY_MATRIX;_this93.executeOpTree(_this93.convertOpList(operatorList));return svgElement})}},{key:"convertOpList",value:function convertOpList(operatorList){var operatorIdMapping=this._operatorIdMapping;var argsArray=operatorList.argsArray;var fnArray=operatorList.fnArray;var opList=[];for(var _i48=0,ii=fnArray.length;_i48<ii;_i48++){var fnId=fnArray[_i48];opList.push({fnId:fnId,fn:operatorIdMapping[fnId],args:argsArray[_i48]})}return opListToTree(opList)}},{key:"executeOpTree",value:function executeOpTree(opTree){var _iterator107=_createForOfIteratorHelper(opTree),_step107;try{for(_iterator107.s();!(_step107=_iterator107.n()).done;){var opTreeElement=_step107.value;var fn=opTreeElement.fn;var fnId=opTreeElement.fnId;var args=opTreeElement.args;switch(fnId|0){case _util.OPS.beginText:this.beginText();break;case _util.OPS.dependency:break;case _util.OPS.setLeading:this.setLeading(args);break;case _util.OPS.setLeadingMoveText:this.setLeadingMoveText(args[0],args[1]);break;case _util.OPS.setFont:this.setFont(args);break;case _util.OPS.showText:this.showText(args[0]);break;case _util.OPS.showSpacedText:this.showText(args[0]);break;case _util.OPS.endText:this.endText();break;case _util.OPS.moveText:this.moveText(args[0],args[1]);break;case _util.OPS.setCharSpacing:this.setCharSpacing(args[0]);break;case _util.OPS.setWordSpacing:this.setWordSpacing(args[0]);break;case _util.OPS.setHScale:this.setHScale(args[0]);break;case _util.OPS.setTextMatrix:this.setTextMatrix(args[0],args[1],args[2],args[3],args[4],args[5]);break;case _util.OPS.setTextRise:this.setTextRise(args[0]);break;case _util.OPS.setTextRenderingMode:this.setTextRenderingMode(args[0]);break;case _util.OPS.setLineWidth:this.setLineWidth(args[0]);break;case _util.OPS.setLineJoin:this.setLineJoin(args[0]);break;case _util.OPS.setLineCap:this.setLineCap(args[0]);break;case _util.OPS.setMiterLimit:this.setMiterLimit(args[0]);break;case _util.OPS.setFillRGBColor:this.setFillRGBColor(args[0],args[1],args[2]);break;case _util.OPS.setStrokeRGBColor:this.setStrokeRGBColor(args[0],args[1],args[2]);break;case _util.OPS.setStrokeColorN:this.setStrokeColorN(args);break;case _util.OPS.setFillColorN:this.setFillColorN(args);break;case _util.OPS.shadingFill:this.shadingFill(args[0]);break;case _util.OPS.setDash:this.setDash(args[0],args[1]);break;case _util.OPS.setRenderingIntent:this.setRenderingIntent(args[0]);break;case _util.OPS.setFlatness:this.setFlatness(args[0]);break;case _util.OPS.setGState:this.setGState(args[0]);break;case _util.OPS.fill:this.fill();break;case _util.OPS.eoFill:this.eoFill();break;case _util.OPS.stroke:this.stroke();break;case _util.OPS.fillStroke:this.fillStroke();break;case _util.OPS.eoFillStroke:this.eoFillStroke();break;case _util.OPS.clip:this.clip("nonzero");break;case _util.OPS.eoClip:this.clip("evenodd");break;case _util.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case _util.OPS.paintImageXObject:this.paintImageXObject(args[0]);break;case _util.OPS.paintInlineImageXObject:this.paintInlineImageXObject(args[0]);break;case _util.OPS.paintImageMaskXObject:this.paintImageMaskXObject(args[0]);break;case _util.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(args[0],args[1]);break;case _util.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case _util.OPS.closePath:this.closePath();break;case _util.OPS.closeStroke:this.closeStroke();break;case _util.OPS.closeFillStroke:this.closeFillStroke();break;case _util.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case _util.OPS.nextLine:this.nextLine();break;case _util.OPS.transform:this.transform(args[0],args[1],args[2],args[3],args[4],args[5]);break;case _util.OPS.constructPath:this.constructPath(args[0],args[1]);break;case _util.OPS.endPath:this.endPath();break;case 92:this.group(opTreeElement.items);break;default:(0,_util.warn)("Unimplemented operator ".concat(fn));break}}}catch(err){_iterator107.e(err)}finally{_iterator107.f()}}},{key:"setWordSpacing",value:function setWordSpacing(wordSpacing){this.current.wordSpacing=wordSpacing}},{key:"setCharSpacing",value:function setCharSpacing(charSpacing){this.current.charSpacing=charSpacing}},{key:"nextLine",value:function nextLine(){this.moveText(0,this.current.leading)}},{key:"setTextMatrix",value:function setTextMatrix(a,b,c,d,e,f){var current=this.current;current.textMatrix=current.lineMatrix=[a,b,c,d,e,f];current.textMatrixScale=Math.hypot(a,b);current.x=current.lineX=0;current.y=current.lineY=0;current.xcoords=[];current.ycoords=[];current.tspan=this.svgFactory.createElement("svg:tspan");current.tspan.setAttributeNS(null,"font-family",current.fontFamily);current.tspan.setAttributeNS(null,"font-size","".concat(pf(current.fontSize),"px"));current.tspan.setAttributeNS(null,"y",pf(-current.y));current.txtElement=this.svgFactory.createElement("svg:text");current.txtElement.append(current.tspan)}},{key:"beginText",value:function beginText(){var current=this.current;current.x=current.lineX=0;current.y=current.lineY=0;current.textMatrix=_util.IDENTITY_MATRIX;current.lineMatrix=_util.IDENTITY_MATRIX;current.textMatrixScale=1;current.tspan=this.svgFactory.createElement("svg:tspan");current.txtElement=this.svgFactory.createElement("svg:text");current.txtgrp=this.svgFactory.createElement("svg:g");current.xcoords=[];current.ycoords=[]}},{key:"moveText",value:function moveText(x,y){var current=this.current;current.x=current.lineX+=x;current.y=current.lineY+=y;current.xcoords=[];current.ycoords=[];current.tspan=this.svgFactory.createElement("svg:tspan");current.tspan.setAttributeNS(null,"font-family",current.fontFamily);current.tspan.setAttributeNS(null,"font-size","".concat(pf(current.fontSize),"px"));current.tspan.setAttributeNS(null,"y",pf(-current.y))}},{key:"showText",value:function showText(glyphs){var current=this.current;var font=current.font;var fontSize=current.fontSize;if(fontSize===0){return}var fontSizeScale=current.fontSizeScale;var charSpacing=current.charSpacing;var wordSpacing=current.wordSpacing;var fontDirection=current.fontDirection;var textHScale=current.textHScale*fontDirection;var vertical=font.vertical;var spacingDir=vertical?1:-1;var defaultVMetrics=font.defaultVMetrics;var widthAdvanceScale=fontSize*current.fontMatrix[0];var x=0;var _iterator108=_createForOfIteratorHelper(glyphs),_step108;try{for(_iterator108.s();!(_step108=_iterator108.n()).done;){var glyph=_step108.value;if(glyph===null){x+=fontDirection*wordSpacing;continue}else if(typeof glyph==="number"){x+=spacingDir*glyph*fontSize/1000;continue}var spacing=(glyph.isSpace?wordSpacing:0)+charSpacing;var character=glyph.fontChar;var scaledX=void 0,scaledY=void 0;var width=glyph.width;if(vertical){var vx=void 0;var vmetric=glyph.vmetric||defaultVMetrics;vx=glyph.vmetric?vmetric[1]:width*0.5;vx=-vx*widthAdvanceScale;var vy=vmetric[2]*widthAdvanceScale;width=vmetric?-vmetric[0]:width;scaledX=vx/fontSizeScale;scaledY=(x+vy)/fontSizeScale}else{scaledX=x/fontSizeScale;scaledY=0}if(glyph.isInFont||font.missingFile){current.xcoords.push(current.x+scaledX);if(vertical){current.ycoords.push(-current.y+scaledY)}current.tspan.textContent+=character}var charWidth=vertical?width*widthAdvanceScale-spacing*fontDirection:width*widthAdvanceScale+spacing*fontDirection;x+=charWidth}}catch(err){_iterator108.e(err)}finally{_iterator108.f()}current.tspan.setAttributeNS(null,"x",current.xcoords.map(pf).join(" "));if(vertical){current.tspan.setAttributeNS(null,"y",current.ycoords.map(pf).join(" "))}else{current.tspan.setAttributeNS(null,"y",pf(-current.y))}if(vertical){current.y-=x}else{current.x+=x*textHScale}current.tspan.setAttributeNS(null,"font-family",current.fontFamily);current.tspan.setAttributeNS(null,"font-size","".concat(pf(current.fontSize),"px"));if(current.fontStyle!==SVG_DEFAULTS.fontStyle){current.tspan.setAttributeNS(null,"font-style",current.fontStyle)}if(current.fontWeight!==SVG_DEFAULTS.fontWeight){current.tspan.setAttributeNS(null,"font-weight",current.fontWeight)}var fillStrokeMode=current.textRenderingMode&_util.TextRenderingMode.FILL_STROKE_MASK;if(fillStrokeMode===_util.TextRenderingMode.FILL||fillStrokeMode===_util.TextRenderingMode.FILL_STROKE){if(current.fillColor!==SVG_DEFAULTS.fillColor){current.tspan.setAttributeNS(null,"fill",current.fillColor)}if(current.fillAlpha<1){current.tspan.setAttributeNS(null,"fill-opacity",current.fillAlpha)}}else if(current.textRenderingMode===_util.TextRenderingMode.ADD_TO_PATH){current.tspan.setAttributeNS(null,"fill","transparent")}else{current.tspan.setAttributeNS(null,"fill","none")}if(fillStrokeMode===_util.TextRenderingMode.STROKE||fillStrokeMode===_util.TextRenderingMode.FILL_STROKE){var lineWidthScale=1/(current.textMatrixScale||1);this._setStrokeAttributes(current.tspan,lineWidthScale)}var textMatrix=current.textMatrix;if(current.textRise!==0){textMatrix=textMatrix.slice();textMatrix[5]+=current.textRise}current.txtElement.setAttributeNS(null,"transform","".concat(pm(textMatrix)," scale(").concat(pf(textHScale),", -1)"));current.txtElement.setAttributeNS(XML_NS,"xml:space","preserve");current.txtElement.append(current.tspan);current.txtgrp.append(current.txtElement);this._ensureTransformGroup().append(current.txtElement)}},{key:"setLeadingMoveText",value:function setLeadingMoveText(x,y){this.setLeading(-y);this.moveText(x,y)}},{key:"addFontStyle",value:function addFontStyle(fontObj){if(!fontObj.data){throw new Error("addFontStyle: No font data available, "+"ensure that the \"fontExtraProperties\" API parameter is set.")}if(!this.cssStyle){this.cssStyle=this.svgFactory.createElement("svg:style");this.cssStyle.setAttributeNS(null,"type","text/css");this.defs.append(this.cssStyle)}var url=createObjectURL(fontObj.data,fontObj.mimetype,this.forceDataSchema);this.cssStyle.textContent+="@font-face { font-family: \"".concat(fontObj.loadedName,"\";")+" src: url(".concat(url,"); }\n")}},{key:"setFont",value:function setFont(details){var current=this.current;var fontObj=this.commonObjs.get(details[0]);var size=details[1];current.font=fontObj;if(this.embedFonts&&!fontObj.missingFile&&!this.embeddedFonts[fontObj.loadedName]){this.addFontStyle(fontObj);this.embeddedFonts[fontObj.loadedName]=fontObj}current.fontMatrix=fontObj.fontMatrix||_util.FONT_IDENTITY_MATRIX;var bold="normal";if(fontObj.black){bold="900"}else if(fontObj.bold){bold="bold"}var italic=fontObj.italic?"italic":"normal";if(size<0){size=-size;current.fontDirection=-1}else{current.fontDirection=1}current.fontSize=size;current.fontFamily=fontObj.loadedName;current.fontWeight=bold;current.fontStyle=italic;current.tspan=this.svgFactory.createElement("svg:tspan");current.tspan.setAttributeNS(null,"y",pf(-current.y));current.xcoords=[];current.ycoords=[]}},{key:"endText",value:function endText(){var _current$txtElement;var current=this.current;if(current.textRenderingMode&_util.TextRenderingMode.ADD_TO_PATH_FLAG&&(_current$txtElement=current.txtElement)!==null&&_current$txtElement!==void 0&&_current$txtElement.hasChildNodes()){current.element=current.txtElement;this.clip("nonzero");this.endPath()}}},{key:"setLineWidth",value:function setLineWidth(width){if(width>0){this.current.lineWidth=width}}},{key:"setLineCap",value:function setLineCap(style){this.current.lineCap=LINE_CAP_STYLES[style]}},{key:"setLineJoin",value:function setLineJoin(style){this.current.lineJoin=LINE_JOIN_STYLES[style]}},{key:"setMiterLimit",value:function setMiterLimit(limit){this.current.miterLimit=limit}},{key:"setStrokeAlpha",value:function setStrokeAlpha(strokeAlpha){this.current.strokeAlpha=strokeAlpha}},{key:"setStrokeRGBColor",value:function setStrokeRGBColor(r,g,b){this.current.strokeColor=_util.Util.makeHexColor(r,g,b)}},{key:"setFillAlpha",value:function setFillAlpha(fillAlpha){this.current.fillAlpha=fillAlpha}},{key:"setFillRGBColor",value:function setFillRGBColor(r,g,b){this.current.fillColor=_util.Util.makeHexColor(r,g,b);this.current.tspan=this.svgFactory.createElement("svg:tspan");this.current.xcoords=[];this.current.ycoords=[]}},{key:"setStrokeColorN",value:function setStrokeColorN(args){this.current.strokeColor=this._makeColorN_Pattern(args)}},{key:"setFillColorN",value:function setFillColorN(args){this.current.fillColor=this._makeColorN_Pattern(args)}},{key:"shadingFill",value:function shadingFill(args){var _this$viewport=this.viewport,width=_this$viewport.width,height=_this$viewport.height;var inv=_util.Util.inverseTransform(this.transformMatrix);var _util$Util$getAxialAl3=_util.Util.getAxialAlignedBoundingBox([0,0,width,height],inv),_util$Util$getAxialAl4=_slicedToArray2(_util$Util$getAxialAl3,4),x0=_util$Util$getAxialAl4[0],y0=_util$Util$getAxialAl4[1],x1=_util$Util$getAxialAl4[2],y1=_util$Util$getAxialAl4[3];var rect=this.svgFactory.createElement("svg:rect");rect.setAttributeNS(null,"x",x0);rect.setAttributeNS(null,"y",y0);rect.setAttributeNS(null,"width",x1-x0);rect.setAttributeNS(null,"height",y1-y0);rect.setAttributeNS(null,"fill",this._makeShadingPattern(args));if(this.current.fillAlpha<1){rect.setAttributeNS(null,"fill-opacity",this.current.fillAlpha)}this._ensureTransformGroup().append(rect)}},{key:"_makeColorN_Pattern",value:function _makeColorN_Pattern(args){if(args[0]==="TilingPattern"){return this._makeTilingPattern(args)}return this._makeShadingPattern(args)}},{key:"_makeTilingPattern",value:function _makeTilingPattern(args){var color=args[1];var operatorList=args[2];var matrix=args[3]||_util.IDENTITY_MATRIX;var _args$=_slicedToArray2(args[4],4),x0=_args$[0],y0=_args$[1],x1=_args$[2],y1=_args$[3];var xstep=args[5];var ystep=args[6];var paintType=args[7];var tilingId="shading".concat(shadingCount++);var _util$Util$normalizeR=_util.Util.normalizeRect([].concat(_toConsumableArray2(_util.Util.applyTransform([x0,y0],matrix)),_toConsumableArray2(_util.Util.applyTransform([x1,y1],matrix)))),_util$Util$normalizeR2=_slicedToArray2(_util$Util$normalizeR,4),tx0=_util$Util$normalizeR2[0],ty0=_util$Util$normalizeR2[1],tx1=_util$Util$normalizeR2[2],ty1=_util$Util$normalizeR2[3];var _util$Util$singularVa3=_util.Util.singularValueDecompose2dScale(matrix),_util$Util$singularVa4=_slicedToArray2(_util$Util$singularVa3,2),xscale=_util$Util$singularVa4[0],yscale=_util$Util$singularVa4[1];var txstep=xstep*xscale;var tystep=ystep*yscale;var tiling=this.svgFactory.createElement("svg:pattern");tiling.setAttributeNS(null,"id",tilingId);tiling.setAttributeNS(null,"patternUnits","userSpaceOnUse");tiling.setAttributeNS(null,"width",txstep);tiling.setAttributeNS(null,"height",tystep);tiling.setAttributeNS(null,"x","".concat(tx0));tiling.setAttributeNS(null,"y","".concat(ty0));var svg=this.svg;var transformMatrix=this.transformMatrix;var fillColor=this.current.fillColor;var strokeColor=this.current.strokeColor;var bbox=this.svgFactory.create(tx1-tx0,ty1-ty0);this.svg=bbox;this.transformMatrix=matrix;if(paintType===2){var _util$Util4;var cssColor=(_util$Util4=_util.Util).makeHexColor.apply(_util$Util4,_toConsumableArray2(color));this.current.fillColor=cssColor;this.current.strokeColor=cssColor}this.executeOpTree(this.convertOpList(operatorList));this.svg=svg;this.transformMatrix=transformMatrix;this.current.fillColor=fillColor;this.current.strokeColor=strokeColor;tiling.append(bbox.childNodes[0]);this.defs.append(tiling);return"url(#".concat(tilingId,")")}},{key:"_makeShadingPattern",value:function _makeShadingPattern(args){if(typeof args==="string"){args=this.objs.get(args)}switch(args[0]){case"RadialAxial":var shadingId="shading".concat(shadingCount++);var colorStops=args[3];var gradient;switch(args[1]){case"axial":var point0=args[4];var point1=args[5];gradient=this.svgFactory.createElement("svg:linearGradient");gradient.setAttributeNS(null,"id",shadingId);gradient.setAttributeNS(null,"gradientUnits","userSpaceOnUse");gradient.setAttributeNS(null,"x1",point0[0]);gradient.setAttributeNS(null,"y1",point0[1]);gradient.setAttributeNS(null,"x2",point1[0]);gradient.setAttributeNS(null,"y2",point1[1]);break;case"radial":var focalPoint=args[4];var circlePoint=args[5];var focalRadius=args[6];var circleRadius=args[7];gradient=this.svgFactory.createElement("svg:radialGradient");gradient.setAttributeNS(null,"id",shadingId);gradient.setAttributeNS(null,"gradientUnits","userSpaceOnUse");gradient.setAttributeNS(null,"cx",circlePoint[0]);gradient.setAttributeNS(null,"cy",circlePoint[1]);gradient.setAttributeNS(null,"r",circleRadius);gradient.setAttributeNS(null,"fx",focalPoint[0]);gradient.setAttributeNS(null,"fy",focalPoint[1]);gradient.setAttributeNS(null,"fr",focalRadius);break;default:throw new Error("Unknown RadialAxial type: ".concat(args[1]))}var _iterator109=_createForOfIteratorHelper(colorStops),_step109;try{for(_iterator109.s();!(_step109=_iterator109.n()).done;){var colorStop=_step109.value;var stop=this.svgFactory.createElement("svg:stop");stop.setAttributeNS(null,"offset",colorStop[0]);stop.setAttributeNS(null,"stop-color",colorStop[1]);gradient.append(stop)}}catch(err){_iterator109.e(err)}finally{_iterator109.f()}this.defs.append(gradient);return"url(#".concat(shadingId,")");case"Mesh":(0,_util.warn)("Unimplemented pattern Mesh");return null;case"Dummy":return"hotpink";default:throw new Error("Unknown IR type: ".concat(args[0]))}}},{key:"setDash",value:function setDash(dashArray,dashPhase){this.current.dashArray=dashArray;this.current.dashPhase=dashPhase}},{key:"constructPath",value:function constructPath(ops,args){var current=this.current;var x=current.x,y=current.y;var d=[];var j=0;var _iterator110=_createForOfIteratorHelper(ops),_step110;try{for(_iterator110.s();!(_step110=_iterator110.n()).done;){var op=_step110.value;switch(op|0){case _util.OPS.rectangle:x=args[j++];y=args[j++];var width=args[j++];var height=args[j++];var xw=x+width;var yh=y+height;d.push("M",pf(x),pf(y),"L",pf(xw),pf(y),"L",pf(xw),pf(yh),"L",pf(x),pf(yh),"Z");break;case _util.OPS.moveTo:x=args[j++];y=args[j++];d.push("M",pf(x),pf(y));break;case _util.OPS.lineTo:x=args[j++];y=args[j++];d.push("L",pf(x),pf(y));break;case _util.OPS.curveTo:x=args[j+4];y=args[j+5];d.push("C",pf(args[j]),pf(args[j+1]),pf(args[j+2]),pf(args[j+3]),pf(x),pf(y));j+=6;break;case _util.OPS.curveTo2:d.push("C",pf(x),pf(y),pf(args[j]),pf(args[j+1]),pf(args[j+2]),pf(args[j+3]));x=args[j+2];y=args[j+3];j+=4;break;case _util.OPS.curveTo3:x=args[j+2];y=args[j+3];d.push("C",pf(args[j]),pf(args[j+1]),pf(x),pf(y),pf(x),pf(y));j+=4;break;case _util.OPS.closePath:d.push("Z");break}}}catch(err){_iterator110.e(err)}finally{_iterator110.f()}d=d.join(" ");if(current.path&&ops.length>0&&ops[0]!==_util.OPS.rectangle&&ops[0]!==_util.OPS.moveTo){d=current.path.getAttributeNS(null,"d")+d}else{current.path=this.svgFactory.createElement("svg:path");this._ensureTransformGroup().append(current.path)}current.path.setAttributeNS(null,"d",d);current.path.setAttributeNS(null,"fill","none");current.element=current.path;current.setCurrentPoint(x,y)}},{key:"endPath",value:function endPath(){var current=this.current;current.path=null;if(!this.pendingClip){return}if(!current.element){this.pendingClip=null;return}var clipId="clippath".concat(clipCount++);var clipPath=this.svgFactory.createElement("svg:clipPath");clipPath.setAttributeNS(null,"id",clipId);clipPath.setAttributeNS(null,"transform",pm(this.transformMatrix));var clipElement=current.element.cloneNode(true);if(this.pendingClip==="evenodd"){clipElement.setAttributeNS(null,"clip-rule","evenodd")}else{clipElement.setAttributeNS(null,"clip-rule","nonzero")}this.pendingClip=null;clipPath.append(clipElement);this.defs.append(clipPath);if(current.activeClipUrl){current.clipGroup=null;var _iterator111=_createForOfIteratorHelper(this.extraStack),_step111;try{for(_iterator111.s();!(_step111=_iterator111.n()).done;){var prev=_step111.value;prev.clipGroup=null}}catch(err){_iterator111.e(err)}finally{_iterator111.f()}clipPath.setAttributeNS(null,"clip-path",current.activeClipUrl)}current.activeClipUrl="url(#".concat(clipId,")");this.tgrp=null}},{key:"clip",value:function clip(type){this.pendingClip=type}},{key:"closePath",value:function closePath(){var current=this.current;if(current.path){var d="".concat(current.path.getAttributeNS(null,"d"),"Z");current.path.setAttributeNS(null,"d",d)}}},{key:"setLeading",value:function setLeading(leading){this.current.leading=-leading}},{key:"setTextRise",value:function setTextRise(textRise){this.current.textRise=textRise}},{key:"setTextRenderingMode",value:function setTextRenderingMode(textRenderingMode){this.current.textRenderingMode=textRenderingMode}},{key:"setHScale",value:function setHScale(scale){this.current.textHScale=scale/100}},{key:"setRenderingIntent",value:function setRenderingIntent(intent){}},{key:"setFlatness",value:function setFlatness(flatness){}},{key:"setGState",value:function setGState(states){var _iterator112=_createForOfIteratorHelper(states),_step112;try{for(_iterator112.s();!(_step112=_iterator112.n()).done;){var _step112$value=_slicedToArray2(_step112.value,2),key=_step112$value[0],value=_step112$value[1];switch(key){case"LW":this.setLineWidth(value);break;case"LC":this.setLineCap(value);break;case"LJ":this.setLineJoin(value);break;case"ML":this.setMiterLimit(value);break;case"D":this.setDash(value[0],value[1]);break;case"RI":this.setRenderingIntent(value);break;case"FL":this.setFlatness(value);break;case"Font":this.setFont(value);break;case"CA":this.setStrokeAlpha(value);break;case"ca":this.setFillAlpha(value);break;default:(0,_util.warn)("Unimplemented graphic state operator ".concat(key));break}}}catch(err){_iterator112.e(err)}finally{_iterator112.f()}}},{key:"fill",value:function fill(){var current=this.current;if(current.element){current.element.setAttributeNS(null,"fill",current.fillColor);current.element.setAttributeNS(null,"fill-opacity",current.fillAlpha);this.endPath()}}},{key:"stroke",value:function stroke(){var current=this.current;if(current.element){this._setStrokeAttributes(current.element);current.element.setAttributeNS(null,"fill","none");this.endPath()}}},{key:"_setStrokeAttributes",value:function _setStrokeAttributes(element){var lineWidthScale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var current=this.current;var dashArray=current.dashArray;if(lineWidthScale!==1&&dashArray.length>0){dashArray=dashArray.map(function(value){return lineWidthScale*value})}element.setAttributeNS(null,"stroke",current.strokeColor);element.setAttributeNS(null,"stroke-opacity",current.strokeAlpha);element.setAttributeNS(null,"stroke-miterlimit",pf(current.miterLimit));element.setAttributeNS(null,"stroke-linecap",current.lineCap);element.setAttributeNS(null,"stroke-linejoin",current.lineJoin);element.setAttributeNS(null,"stroke-width",pf(lineWidthScale*current.lineWidth)+"px");element.setAttributeNS(null,"stroke-dasharray",dashArray.map(pf).join(" "));element.setAttributeNS(null,"stroke-dashoffset",pf(lineWidthScale*current.dashPhase)+"px")}},{key:"eoFill",value:function eoFill(){var _this$current$element;(_this$current$element=this.current.element)===null||_this$current$element===void 0||_this$current$element.setAttributeNS(null,"fill-rule","evenodd");this.fill()}},{key:"fillStroke",value:function fillStroke(){this.stroke();this.fill()}},{key:"eoFillStroke",value:function eoFillStroke(){var _this$current$element2;(_this$current$element2=this.current.element)===null||_this$current$element2===void 0||_this$current$element2.setAttributeNS(null,"fill-rule","evenodd");this.fillStroke()}},{key:"closeStroke",value:function closeStroke(){this.closePath();this.stroke()}},{key:"closeFillStroke",value:function closeFillStroke(){this.closePath();this.fillStroke()}},{key:"closeEOFillStroke",value:function closeEOFillStroke(){this.closePath();this.eoFillStroke()}},{key:"paintSolidColorImageMask",value:function paintSolidColorImageMask(){var rect=this.svgFactory.createElement("svg:rect");rect.setAttributeNS(null,"x","0");rect.setAttributeNS(null,"y","0");rect.setAttributeNS(null,"width","1px");rect.setAttributeNS(null,"height","1px");rect.setAttributeNS(null,"fill",this.current.fillColor);this._ensureTransformGroup().append(rect)}},{key:"paintImageXObject",value:function paintImageXObject(objId){var imgData=this.getObject(objId);if(!imgData){(0,_util.warn)("Dependent image with object ID ".concat(objId," is not ready yet"));return}this.paintInlineImageXObject(imgData)}},{key:"paintInlineImageXObject",value:function paintInlineImageXObject(imgData,mask){var width=imgData.width;var height=imgData.height;var imgSrc=convertImgDataToPng(imgData,this.forceDataSchema,!!mask);var cliprect=this.svgFactory.createElement("svg:rect");cliprect.setAttributeNS(null,"x","0");cliprect.setAttributeNS(null,"y","0");cliprect.setAttributeNS(null,"width",pf(width));cliprect.setAttributeNS(null,"height",pf(height));this.current.element=cliprect;this.clip("nonzero");var imgEl=this.svgFactory.createElement("svg:image");imgEl.setAttributeNS(XLINK_NS,"xlink:href",imgSrc);imgEl.setAttributeNS(null,"x","0");imgEl.setAttributeNS(null,"y",pf(-height));imgEl.setAttributeNS(null,"width",pf(width)+"px");imgEl.setAttributeNS(null,"height",pf(height)+"px");imgEl.setAttributeNS(null,"transform","scale(".concat(pf(1/width)," ").concat(pf(-1/height),")"));if(mask){mask.append(imgEl)}else{this._ensureTransformGroup().append(imgEl)}}},{key:"paintImageMaskXObject",value:function paintImageMaskXObject(img){var imgData=this.getObject(img.data,img);if(imgData.bitmap){(0,_util.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, "+"ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}var current=this.current;var width=imgData.width;var height=imgData.height;var fillColor=current.fillColor;current.maskId="mask".concat(maskCount++);var mask=this.svgFactory.createElement("svg:mask");mask.setAttributeNS(null,"id",current.maskId);var rect=this.svgFactory.createElement("svg:rect");rect.setAttributeNS(null,"x","0");rect.setAttributeNS(null,"y","0");rect.setAttributeNS(null,"width",pf(width));rect.setAttributeNS(null,"height",pf(height));rect.setAttributeNS(null,"fill",fillColor);rect.setAttributeNS(null,"mask","url(#".concat(current.maskId,")"));this.defs.append(mask);this._ensureTransformGroup().append(rect);this.paintInlineImageXObject(imgData,mask)}},{key:"paintFormXObjectBegin",value:function paintFormXObjectBegin(matrix,bbox){if(Array.isArray(matrix)&&matrix.length===6){this.transform(matrix[0],matrix[1],matrix[2],matrix[3],matrix[4],matrix[5])}if(bbox){var width=bbox[2]-bbox[0];var height=bbox[3]-bbox[1];var cliprect=this.svgFactory.createElement("svg:rect");cliprect.setAttributeNS(null,"x",bbox[0]);cliprect.setAttributeNS(null,"y",bbox[1]);cliprect.setAttributeNS(null,"width",pf(width));cliprect.setAttributeNS(null,"height",pf(height));this.current.element=cliprect;this.clip("nonzero");this.endPath()}}},{key:"paintFormXObjectEnd",value:function paintFormXObjectEnd(){}},{key:"_initialize",value:function _initialize(viewport){var svg=this.svgFactory.create(viewport.width,viewport.height);var definitions=this.svgFactory.createElement("svg:defs");svg.append(definitions);this.defs=definitions;var rootGroup=this.svgFactory.createElement("svg:g");rootGroup.setAttributeNS(null,"transform",pm(viewport.transform));svg.append(rootGroup);this.svg=rootGroup;return svg}},{key:"_ensureClipGroup",value:function _ensureClipGroup(){if(!this.current.clipGroup){var clipGroup=this.svgFactory.createElement("svg:g");clipGroup.setAttributeNS(null,"clip-path",this.current.activeClipUrl);this.svg.append(clipGroup);this.current.clipGroup=clipGroup}return this.current.clipGroup}},{key:"_ensureTransformGroup",value:function _ensureTransformGroup(){if(!this.tgrp){this.tgrp=this.svgFactory.createElement("svg:g");this.tgrp.setAttributeNS(null,"transform",pm(this.transformMatrix));if(this.current.activeClipUrl){this._ensureClipGroup().append(this.tgrp)}else{this.svg.append(this.tgrp)}}return this.tgrp}}]);return SVGGraphics}();exports.SVGGraphics=SVGGraphics}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.XfaText=void 0;var XfaText=function(){function XfaText(){_classCallCheck2(this,XfaText)}_createClass2(XfaText,null,[{key:"textContent",value:function textContent(xfa){var items=[];var output={items:items,styles:Object.create(null)};function walk(node){var _node$attributes;if(!node){return}var str=null;var name=node.name;if(name==="#text"){str=node.value}else if(!XfaText.shouldBuildText(name)){return}else if(node!==null&&node!==void 0&&(_node$attributes=node.attributes)!==null&&_node$attributes!==void 0&&_node$attributes.textContent){str=node.attributes.textContent}else if(node.value){str=node.value}if(str!==null){items.push({str:str})}if(!node.children){return}var _iterator113=_createForOfIteratorHelper(node.children),_step113;try{for(_iterator113.s();!(_step113=_iterator113.n()).done;){var child=_step113.value;walk(child)}}catch(err){_iterator113.e(err)}finally{_iterator113.f()}}walk(xfa);return output}},{key:"shouldBuildText",value:function shouldBuildText(name){return!(name==="textarea"||name==="input"||name==="option"||name==="select")}}]);return XfaText}();exports.XfaText=XfaText}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.TextLayerRenderTask=void 0;exports.renderTextLayer=renderTextLayer;exports.updateTextLayer=updateTextLayer;var _util=__w_pdfjs_require__(1);var _display_utils=__w_pdfjs_require__(6);var MAX_TEXT_DIVS_TO_RENDER=100000;var DEFAULT_FONT_SIZE=30;var DEFAULT_FONT_ASCENT=0.8;var ascentCache=new Map;function getCtx(size,isOffscreenCanvasSupported){var ctx;if(isOffscreenCanvasSupported&&_util.FeatureTest.isOffscreenCanvasSupported){ctx=new OffscreenCanvas(size,size).getContext("2d",{alpha:false})}else{var canvas=document.createElement("canvas");canvas.width=canvas.height=size;ctx=canvas.getContext("2d",{alpha:false})}return ctx}function getAscent(fontFamily,isOffscreenCanvasSupported){var cachedAscent=ascentCache.get(fontFamily);if(cachedAscent){return cachedAscent}var ctx=getCtx(DEFAULT_FONT_SIZE,isOffscreenCanvasSupported);ctx.font="".concat(DEFAULT_FONT_SIZE,"px ").concat(fontFamily);var metrics=ctx.measureText("");var ascent=metrics.fontBoundingBoxAscent;var descent=Math.abs(metrics.fontBoundingBoxDescent);if(ascent){var ratio=ascent/(ascent+descent);ascentCache.set(fontFamily,ratio);ctx.canvas.width=ctx.canvas.height=0;return ratio}ctx.strokeStyle="red";ctx.clearRect(0,0,DEFAULT_FONT_SIZE,DEFAULT_FONT_SIZE);ctx.strokeText("g",0,0);var pixels=ctx.getImageData(0,0,DEFAULT_FONT_SIZE,DEFAULT_FONT_SIZE).data;descent=0;for(var _i49=pixels.length-1-3;_i49>=0;_i49-=4){if(pixels[_i49]>0){descent=Math.ceil(_i49/4/DEFAULT_FONT_SIZE);break}}ctx.clearRect(0,0,DEFAULT_FONT_SIZE,DEFAULT_FONT_SIZE);ctx.strokeText("A",0,DEFAULT_FONT_SIZE);pixels=ctx.getImageData(0,0,DEFAULT_FONT_SIZE,DEFAULT_FONT_SIZE).data;ascent=0;for(var _i50=0,ii=pixels.length;_i50<ii;_i50+=4){if(pixels[_i50]>0){ascent=DEFAULT_FONT_SIZE-Math.floor(_i50/4/DEFAULT_FONT_SIZE);break}}ctx.canvas.width=ctx.canvas.height=0;if(ascent){var _ratio=ascent/(ascent+descent);ascentCache.set(fontFamily,_ratio);return _ratio}ascentCache.set(fontFamily,DEFAULT_FONT_ASCENT);return DEFAULT_FONT_ASCENT}function appendText(task,geom,styles){var textDiv=document.createElement("span");var textDivProperties={angle:0,canvasWidth:0,hasText:geom.str!=="",hasEOL:geom.hasEOL,fontSize:0};task._textDivs.push(textDiv);var tx=_util.Util.transform(task._transform,geom.transform);var angle=Math.atan2(tx[1],tx[0]);var style=styles[geom.fontName];if(style.vertical){angle+=Math.PI/2}var fontHeight=Math.hypot(tx[2],tx[3]);var fontAscent=fontHeight*getAscent(style.fontFamily,task._isOffscreenCanvasSupported);var left,top;if(angle===0){left=tx[4];top=tx[5]-fontAscent}else{left=tx[4]+fontAscent*Math.sin(angle);top=tx[5]-fontAscent*Math.cos(angle)}var scaleFactorStr="calc(var(--scale-factor)*";var divStyle=textDiv.style;if(task._container===task._rootContainer){divStyle.left="".concat((100*left/task._pageWidth).toFixed(2),"%");divStyle.top="".concat((100*top/task._pageHeight).toFixed(2),"%")}else{divStyle.left="".concat(scaleFactorStr).concat(left.toFixed(2),"px)");divStyle.top="".concat(scaleFactorStr).concat(top.toFixed(2),"px)")}divStyle.fontSize="".concat(scaleFactorStr).concat(fontHeight.toFixed(2),"px)");divStyle.fontFamily=style.fontFamily;textDivProperties.fontSize=fontHeight;textDiv.setAttribute("role","presentation");textDiv.textContent=geom.str;textDiv.dir=geom.dir;if(task._fontInspectorEnabled){textDiv.dataset.fontName=geom.fontName}if(angle!==0){textDivProperties.angle=angle*(180/Math.PI)}var shouldScaleText=false;if(geom.str.length>1){shouldScaleText=true}else if(geom.str!==" "&&geom.transform[0]!==geom.transform[3]){var absScaleX=Math.abs(geom.transform[0]),absScaleY=Math.abs(geom.transform[3]);if(absScaleX!==absScaleY&&Math.max(absScaleX,absScaleY)/Math.min(absScaleX,absScaleY)>1.5){shouldScaleText=true}}if(shouldScaleText){textDivProperties.canvasWidth=style.vertical?geom.height:geom.width}task._textDivProperties.set(textDiv,textDivProperties);if(task._isReadableStream){task._layoutText(textDiv)}}function layout(params){var div=params.div,scale=params.scale,properties=params.properties,ctx=params.ctx,prevFontSize=params.prevFontSize,prevFontFamily=params.prevFontFamily;var style=div.style;var transform="";if(properties.canvasWidth!==0&&properties.hasText){var fontFamily=style.fontFamily;var canvasWidth=properties.canvasWidth,fontSize=properties.fontSize;if(prevFontSize!==fontSize||prevFontFamily!==fontFamily){ctx.font="".concat(fontSize*scale,"px ").concat(fontFamily);params.prevFontSize=fontSize;params.prevFontFamily=fontFamily}var _ctx$measureText=ctx.measureText(div.textContent),width=_ctx$measureText.width;if(width>0){transform="scaleX(".concat(canvasWidth*scale/width,")")}}if(properties.angle!==0){transform="rotate(".concat(properties.angle,"deg) ").concat(transform)}if(transform.length>0){style.transform=transform}}function render(task){if(task._canceled){return}var textDivs=task._textDivs;var capability=task._capability;var textDivsLength=textDivs.length;if(textDivsLength>MAX_TEXT_DIVS_TO_RENDER){capability.resolve();return}if(!task._isReadableStream){var _iterator114=_createForOfIteratorHelper(textDivs),_step114;try{for(_iterator114.s();!(_step114=_iterator114.n()).done;){var textDiv=_step114.value;task._layoutText(textDiv)}}catch(err){_iterator114.e(err)}finally{_iterator114.f()}}capability.resolve()}var TextLayerRenderTask=function(){function TextLayerRenderTask(_ref78){var _globalThis$FontInspe2,_this94=this;var textContentSource=_ref78.textContentSource,container=_ref78.container,viewport=_ref78.viewport,textDivs=_ref78.textDivs,textDivProperties=_ref78.textDivProperties,textContentItemsStr=_ref78.textContentItemsStr,isOffscreenCanvasSupported=_ref78.isOffscreenCanvasSupported;_classCallCheck2(this,TextLayerRenderTask);this._textContentSource=textContentSource;this._isReadableStream=textContentSource instanceof ReadableStream;this._container=this._rootContainer=container;this._textDivs=textDivs||[];this._textContentItemsStr=textContentItemsStr||[];this._isOffscreenCanvasSupported=isOffscreenCanvasSupported;this._fontInspectorEnabled=!!((_globalThis$FontInspe2=globalThis.FontInspector)!==null&&_globalThis$FontInspe2!==void 0&&_globalThis$FontInspe2.enabled);this._reader=null;this._textDivProperties=textDivProperties||new WeakMap;this._canceled=false;this._capability=new _util.PromiseCapability;this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:viewport.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:getCtx(0,isOffscreenCanvasSupported)};var _viewport$rawDims2=viewport.rawDims,pageWidth=_viewport$rawDims2.pageWidth,pageHeight=_viewport$rawDims2.pageHeight,pageX=_viewport$rawDims2.pageX,pageY=_viewport$rawDims2.pageY;this._transform=[1,0,0,-1,-pageX,pageY+pageHeight];this._pageWidth=pageWidth;this._pageHeight=pageHeight;(0,_display_utils.setLayerDimensions)(container,viewport);this._capability.promise["finally"](function(){_this94._layoutTextParams=null})["catch"](function(){})}_createClass2(TextLayerRenderTask,[{key:"promise",get:function get(){return this._capability.promise}},{key:"cancel",value:function cancel(){this._canceled=true;if(this._reader){this._reader.cancel(new _util.AbortException("TextLayer task cancelled."))["catch"](function(){});this._reader=null}this._capability.reject(new _util.AbortException("TextLayer task cancelled."))}},{key:"_processItems",value:function _processItems(items,styleCache){var _iterator115=_createForOfIteratorHelper(items),_step115;try{for(_iterator115.s();!(_step115=_iterator115.n()).done;){var item=_step115.value;if(item.str===undefined){if(item.type==="beginMarkedContentProps"||item.type==="beginMarkedContent"){var parent=this._container;this._container=document.createElement("span");this._container.classList.add("markedContent");if(item.id!==null){this._container.setAttribute("id","".concat(item.id))}parent.append(this._container)}else if(item.type==="endMarkedContent"){this._container=this._container.parentNode}continue}this._textContentItemsStr.push(item.str);appendText(this,item,styleCache)}}catch(err){_iterator115.e(err)}finally{_iterator115.f()}}},{key:"_layoutText",value:function _layoutText(textDiv){var textDivProperties=this._layoutTextParams.properties=this._textDivProperties.get(textDiv);this._layoutTextParams.div=textDiv;layout(this._layoutTextParams);if(textDivProperties.hasText){this._container.append(textDiv)}if(textDivProperties.hasEOL){var br=document.createElement("br");br.setAttribute("role","presentation");this._container.append(br)}}},{key:"_render",value:function _render(){var _this95=this;var capability=new _util.PromiseCapability;var styleCache=Object.create(null);if(this._isReadableStream){var pump=function pump(){_this95._reader.read().then(function(_ref79){var value=_ref79.value,done=_ref79.done;if(done){capability.resolve();return}Object.assign(styleCache,value.styles);_this95._processItems(value.items,styleCache);pump()},capability.reject)};this._reader=this._textContentSource.getReader();pump()}else if(this._textContentSource){var _this$_textContentSou=this._textContentSource,items=_this$_textContentSou.items,styles=_this$_textContentSou.styles;this._processItems(items,styles);capability.resolve()}else{throw new Error("No \"textContentSource\" parameter specified.")}capability.promise.then(function(){styleCache=null;render(_this95)},this._capability.reject)}}]);return TextLayerRenderTask}();exports.TextLayerRenderTask=TextLayerRenderTask;function renderTextLayer(params){if(!params.textContentSource&&(params.textContent||params.textContentStream)){(0,_display_utils.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters "+"will be removed in the future, please use `textContentSource` instead.");params.textContentSource=params.textContent||params.textContentStream}var container=params.container,viewport=params.viewport;var style=getComputedStyle(container);var visibility=style.getPropertyValue("visibility");var scaleFactor=parseFloat(style.getPropertyValue("--scale-factor"));if(visibility==="visible"&&(!scaleFactor||Math.abs(scaleFactor-viewport.scale)>1e-5)){console.error("The `--scale-factor` CSS-variable must be set, "+"to the same value as `viewport.scale`, "+"either on the `container`-element itself or higher up in the DOM.")}var task=new TextLayerRenderTask(params);task._render();return task}function updateTextLayer(_ref80){var container=_ref80.container,viewport=_ref80.viewport,textDivs=_ref80.textDivs,textDivProperties=_ref80.textDivProperties,isOffscreenCanvasSupported=_ref80.isOffscreenCanvasSupported,_ref80$mustRotate=_ref80.mustRotate,mustRotate=_ref80$mustRotate===void 0?true:_ref80$mustRotate,_ref80$mustRescale=_ref80.mustRescale,mustRescale=_ref80$mustRescale===void 0?true:_ref80$mustRescale;if(mustRotate){(0,_display_utils.setLayerDimensions)(container,{rotation:viewport.rotation})}if(mustRescale){var ctx=getCtx(0,isOffscreenCanvasSupported);var scale=viewport.scale*(globalThis.devicePixelRatio||1);var params={prevFontSize:null,prevFontFamily:null,div:null,scale:scale,properties:null,ctx:ctx};var _iterator116=_createForOfIteratorHelper(textDivs),_step116;try{for(_iterator116.s();!(_step116=_iterator116.n()).done;){var div=_step116.value;params.properties=textDivProperties.get(div);params.div=div;layout(params)}}catch(err){_iterator116.e(err)}finally{_iterator116.f()}}}}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.AnnotationEditorLayer=void 0;var _util=__w_pdfjs_require__(1);var _editor=__w_pdfjs_require__(4);var _freetext=__w_pdfjs_require__(28);var _ink=__w_pdfjs_require__(33);var _display_utils=__w_pdfjs_require__(6);var _stamp=__w_pdfjs_require__(34);var _accessibilityManager=new WeakMap;var _allowClick=new WeakMap;var _annotationLayer=new WeakMap;var _boundPointerup=new WeakMap;var _boundPointerdown=new WeakMap;var _editors=new WeakMap;var _hadPointerDown=new WeakMap;var _isCleaningUp=new WeakMap;var _isDisabling=new WeakMap;var _uiManager=new WeakMap;var _createNewEditor=new WeakSet;var _createAndAddNewEditor=new WeakSet;var _getCenterPoint=new WeakSet;var _cleanup=new WeakSet;var AnnotationEditorLayer=function(){function AnnotationEditorLayer(_ref81){var uiManager=_ref81.uiManager,pageIndex=_ref81.pageIndex,div=_ref81.div,accessibilityManager=_ref81.accessibilityManager,annotationLayer=_ref81.annotationLayer,viewport=_ref81.viewport,l10n=_ref81.l10n;_classCallCheck2(this,AnnotationEditorLayer);_classPrivateMethodInitSpec(this,_cleanup);_classPrivateMethodInitSpec(this,_getCenterPoint);_classPrivateMethodInitSpec(this,_createAndAddNewEditor);_classPrivateMethodInitSpec(this,_createNewEditor);_classPrivateFieldInitSpec(this,_accessibilityManager,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_allowClick,{writable:true,value:false});_classPrivateFieldInitSpec(this,_annotationLayer,{writable:true,value:null});_classPrivateFieldInitSpec(this,_boundPointerup,{writable:true,value:this.pointerup.bind(this)});_classPrivateFieldInitSpec(this,_boundPointerdown,{writable:true,value:this.pointerdown.bind(this)});_classPrivateFieldInitSpec(this,_editors,{writable:true,value:new Map});_classPrivateFieldInitSpec(this,_hadPointerDown,{writable:true,value:false});_classPrivateFieldInitSpec(this,_isCleaningUp,{writable:true,value:false});_classPrivateFieldInitSpec(this,_isDisabling,{writable:true,value:false});_classPrivateFieldInitSpec(this,_uiManager,{writable:true,value:void 0});var editorTypes=[_freetext.FreeTextEditor,_ink.InkEditor,_stamp.StampEditor];if(!AnnotationEditorLayer._initialized){AnnotationEditorLayer._initialized=true;var _iterator117=_createForOfIteratorHelper(editorTypes),_step117;try{for(_iterator117.s();!(_step117=_iterator117.n()).done;){var editorType=_step117.value;editorType.initialize(l10n)}}catch(err){_iterator117.e(err)}finally{_iterator117.f()}}uiManager.registerEditorTypes(editorTypes);_classPrivateFieldSet(this,_uiManager,uiManager);this.pageIndex=pageIndex;this.div=div;_classPrivateFieldSet(this,_accessibilityManager,accessibilityManager);_classPrivateFieldSet(this,_annotationLayer,annotationLayer);this.viewport=viewport;_classPrivateFieldGet(this,_uiManager).addLayer(this)}_createClass2(AnnotationEditorLayer,[{key:"isEmpty",get:function get(){return _classPrivateFieldGet(this,_editors).size===0}},{key:"updateToolbar",value:function updateToolbar(mode){_classPrivateFieldGet(this,_uiManager).updateToolbar(mode)}},{key:"updateMode",value:function updateMode(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_classPrivateFieldGet(this,_uiManager).getMode();_classPrivateMethodGet(this,_cleanup,_cleanup2).call(this);if(mode===_util.AnnotationEditorType.INK){this.addInkEditorIfNeeded(false);this.disableClick()}else{this.enableClick()}if(mode!==_util.AnnotationEditorType.NONE){this.div.classList.toggle("freeTextEditing",mode===_util.AnnotationEditorType.FREETEXT);this.div.classList.toggle("inkEditing",mode===_util.AnnotationEditorType.INK);this.div.classList.toggle("stampEditing",mode===_util.AnnotationEditorType.STAMP);this.div.hidden=false}}},{key:"addInkEditorIfNeeded",value:function addInkEditorIfNeeded(isCommitting){if(!isCommitting&&_classPrivateFieldGet(this,_uiManager).getMode()!==_util.AnnotationEditorType.INK){return}if(!isCommitting){var _iterator118=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editors).values()),_step118;try{for(_iterator118.s();!(_step118=_iterator118.n()).done;){var _editor2=_step118.value;if(_editor2.isEmpty()){_editor2.setInBackground();return}}}catch(err){_iterator118.e(err)}finally{_iterator118.f()}}var editor=_classPrivateMethodGet(this,_createAndAddNewEditor,_createAndAddNewEditor2).call(this,{offsetX:0,offsetY:0},false);editor.setInBackground()}},{key:"setEditingState",value:function setEditingState(isEditing){_classPrivateFieldGet(this,_uiManager).setEditingState(isEditing)}},{key:"addCommands",value:function addCommands(params){_classPrivateFieldGet(this,_uiManager).addCommands(params)}},{key:"enable",value:function enable(){this.div.style.pointerEvents="auto";var annotationElementIds=new Set;var _iterator119=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editors).values()),_step119;try{for(_iterator119.s();!(_step119=_iterator119.n()).done;){var editor=_step119.value;editor.enableEditing();if(editor.annotationElementId){annotationElementIds.add(editor.annotationElementId)}}}catch(err){_iterator119.e(err)}finally{_iterator119.f()}if(!_classPrivateFieldGet(this,_annotationLayer)){return}var editables=_classPrivateFieldGet(this,_annotationLayer).getEditableAnnotations();var _iterator120=_createForOfIteratorHelper(editables),_step120;try{for(_iterator120.s();!(_step120=_iterator120.n()).done;){var _editable=_step120.value;_editable.hide();if(_classPrivateFieldGet(this,_uiManager).isDeletedAnnotationElement(_editable.data.id)){continue}if(annotationElementIds.has(_editable.data.id)){continue}var _editor3=this.deserialize(_editable);if(!_editor3){continue}this.addOrRebuild(_editor3);_editor3.enableEditing()}}catch(err){_iterator120.e(err)}finally{_iterator120.f()}}},{key:"disable",value:function disable(){_classPrivateFieldSet(this,_isDisabling,true);this.div.style.pointerEvents="none";var hiddenAnnotationIds=new Set;var _iterator121=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editors).values()),_step121;try{for(_iterator121.s();!(_step121=_iterator121.n()).done;){var _this$getEditableAnno;var editor=_step121.value;editor.disableEditing();if(!editor.annotationElementId||editor.serialize()!==null){hiddenAnnotationIds.add(editor.annotationElementId);continue}(_this$getEditableAnno=this.getEditableAnnotation(editor.annotationElementId))===null||_this$getEditableAnno===void 0||_this$getEditableAnno.show();editor.remove()}}catch(err){_iterator121.e(err)}finally{_iterator121.f()}if(_classPrivateFieldGet(this,_annotationLayer)){var editables=_classPrivateFieldGet(this,_annotationLayer).getEditableAnnotations();var _iterator122=_createForOfIteratorHelper(editables),_step122;try{for(_iterator122.s();!(_step122=_iterator122.n()).done;){var _editable2=_step122.value;var _id11=_editable2.data.id;if(hiddenAnnotationIds.has(_id11)||_classPrivateFieldGet(this,_uiManager).isDeletedAnnotationElement(_id11)){continue}_editable2.show()}}catch(err){_iterator122.e(err)}finally{_iterator122.f()}}_classPrivateMethodGet(this,_cleanup,_cleanup2).call(this);if(this.isEmpty){this.div.hidden=true}_classPrivateFieldSet(this,_isDisabling,false)}},{key:"getEditableAnnotation",value:function getEditableAnnotation(id){var _classPrivateFieldGet21;return((_classPrivateFieldGet21=_classPrivateFieldGet(this,_annotationLayer))===null||_classPrivateFieldGet21===void 0?void 0:_classPrivateFieldGet21.getEditableAnnotation(id))||null}},{key:"setActiveEditor",value:function setActiveEditor(editor){var currentActive=_classPrivateFieldGet(this,_uiManager).getActive();if(currentActive===editor){return}_classPrivateFieldGet(this,_uiManager).setActiveEditor(editor)}},{key:"enableClick",value:function enableClick(){this.div.addEventListener("pointerdown",_classPrivateFieldGet(this,_boundPointerdown));this.div.addEventListener("pointerup",_classPrivateFieldGet(this,_boundPointerup))}},{key:"disableClick",value:function disableClick(){this.div.removeEventListener("pointerdown",_classPrivateFieldGet(this,_boundPointerdown));this.div.removeEventListener("pointerup",_classPrivateFieldGet(this,_boundPointerup))}},{key:"attach",value:function attach(editor){_classPrivateFieldGet(this,_editors).set(editor.id,editor);var annotationElementId=editor.annotationElementId;if(annotationElementId&&_classPrivateFieldGet(this,_uiManager).isDeletedAnnotationElement(annotationElementId)){_classPrivateFieldGet(this,_uiManager).removeDeletedAnnotationElement(editor)}}},{key:"detach",value:function detach(editor){var _classPrivateFieldGet22;_classPrivateFieldGet(this,_editors)["delete"](editor.id);(_classPrivateFieldGet22=_classPrivateFieldGet(this,_accessibilityManager))===null||_classPrivateFieldGet22===void 0||_classPrivateFieldGet22.removePointerInTextLayer(editor.contentDiv);if(!_classPrivateFieldGet(this,_isDisabling)&&editor.annotationElementId){_classPrivateFieldGet(this,_uiManager).addDeletedAnnotationElement(editor)}}},{key:"remove",value:function remove(editor){var _this96=this;this.detach(editor);_classPrivateFieldGet(this,_uiManager).removeEditor(editor);if(editor.div.contains(document.activeElement)){setTimeout(function(){_classPrivateFieldGet(_this96,_uiManager).focusMainContainer()},0)}editor.div.remove();editor.isAttachedToDOM=false;if(!_classPrivateFieldGet(this,_isCleaningUp)){this.addInkEditorIfNeeded(false)}}},{key:"changeParent",value:function changeParent(editor){var _editor$parent;if(editor.parent===this){return}if(editor.annotationElementId){_classPrivateFieldGet(this,_uiManager).addDeletedAnnotationElement(editor.annotationElementId);_editor.AnnotationEditor.deleteAnnotationElement(editor);editor.annotationElementId=null}this.attach(editor);(_editor$parent=editor.parent)===null||_editor$parent===void 0||_editor$parent.detach(editor);editor.setParent(this);if(editor.div&&editor.isAttachedToDOM){editor.div.remove();this.div.append(editor.div)}}},{key:"add",value:function add(editor){this.changeParent(editor);_classPrivateFieldGet(this,_uiManager).addEditor(editor);this.attach(editor);if(!editor.isAttachedToDOM){var div=editor.render();this.div.append(div);editor.isAttachedToDOM=true}editor.fixAndSetPosition();editor.onceAdded();_classPrivateFieldGet(this,_uiManager).addToAnnotationStorage(editor)}},{key:"moveEditorInDOM",value:function moveEditorInDOM(editor){var _classPrivateFieldGet23;if(!editor.isAttachedToDOM){return}var _document5=document,activeElement=_document5.activeElement;if(editor.div.contains(activeElement)){editor._focusEventsAllowed=false;setTimeout(function(){if(!editor.div.contains(document.activeElement)){editor.div.addEventListener("focusin",function(){editor._focusEventsAllowed=true},{once:true});activeElement.focus()}else{editor._focusEventsAllowed=true}},0)}editor._structTreeParentId=(_classPrivateFieldGet23=_classPrivateFieldGet(this,_accessibilityManager))===null||_classPrivateFieldGet23===void 0?void 0:_classPrivateFieldGet23.moveElementInDOM(this.div,editor.div,editor.contentDiv,true)}},{key:"addOrRebuild",value:function addOrRebuild(editor){if(editor.needsToBeRebuilt()){editor.rebuild()}else{this.add(editor)}}},{key:"addUndoableEditor",value:function addUndoableEditor(editor){var cmd=function cmd(){return editor._uiManager.rebuild(editor)};var undo=function undo(){editor.remove()};this.addCommands({cmd:cmd,undo:undo,mustExec:false})}},{key:"getNextId",value:function getNextId(){return _classPrivateFieldGet(this,_uiManager).getId()}},{key:"pasteEditor",value:function pasteEditor(mode,params){_classPrivateFieldGet(this,_uiManager).updateToolbar(mode);_classPrivateFieldGet(this,_uiManager).updateMode(mode);var _classPrivateMethodGe5=_classPrivateMethodGet(this,_getCenterPoint,_getCenterPoint2).call(this),offsetX=_classPrivateMethodGe5.offsetX,offsetY=_classPrivateMethodGe5.offsetY;var id=this.getNextId();var editor=_classPrivateMethodGet(this,_createNewEditor,_createNewEditor2).call(this,_objectSpread2({parent:this,id:id,x:offsetX,y:offsetY,uiManager:_classPrivateFieldGet(this,_uiManager),isCentered:true},params));if(editor){this.add(editor)}}},{key:"deserialize",value:function deserialize(data){var _data$annotationType;switch((_data$annotationType=data.annotationType)!==null&&_data$annotationType!==void 0?_data$annotationType:data.annotationEditorType){case _util.AnnotationEditorType.FREETEXT:return _freetext.FreeTextEditor.deserialize(data,this,_classPrivateFieldGet(this,_uiManager));case _util.AnnotationEditorType.INK:return _ink.InkEditor.deserialize(data,this,_classPrivateFieldGet(this,_uiManager));case _util.AnnotationEditorType.STAMP:return _stamp.StampEditor.deserialize(data,this,_classPrivateFieldGet(this,_uiManager))}return null}},{key:"addNewEditor",value:function addNewEditor(){_classPrivateMethodGet(this,_createAndAddNewEditor,_createAndAddNewEditor2).call(this,_classPrivateMethodGet(this,_getCenterPoint,_getCenterPoint2).call(this),true)}},{key:"setSelected",value:function setSelected(editor){_classPrivateFieldGet(this,_uiManager).setSelected(editor)}},{key:"toggleSelected",value:function toggleSelected(editor){_classPrivateFieldGet(this,_uiManager).toggleSelected(editor)}},{key:"isSelected",value:function isSelected(editor){return _classPrivateFieldGet(this,_uiManager).isSelected(editor)}},{key:"unselect",value:function unselect(editor){_classPrivateFieldGet(this,_uiManager).unselect(editor)}},{key:"pointerup",value:function pointerup(event){var isMac=_util.FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){return}if(event.target!==this.div){return}if(!_classPrivateFieldGet(this,_hadPointerDown)){return}_classPrivateFieldSet(this,_hadPointerDown,false);if(!_classPrivateFieldGet(this,_allowClick)){_classPrivateFieldSet(this,_allowClick,true);return}if(_classPrivateFieldGet(this,_uiManager).getMode()===_util.AnnotationEditorType.STAMP){_classPrivateFieldGet(this,_uiManager).unselectAll();return}_classPrivateMethodGet(this,_createAndAddNewEditor,_createAndAddNewEditor2).call(this,event,false)}},{key:"pointerdown",value:function pointerdown(event){if(_classPrivateFieldGet(this,_hadPointerDown)){_classPrivateFieldSet(this,_hadPointerDown,false);return}var isMac=_util.FeatureTest.platform.isMac;if(event.button!==0||event.ctrlKey&&isMac){return}if(event.target!==this.div){return}_classPrivateFieldSet(this,_hadPointerDown,true);var editor=_classPrivateFieldGet(this,_uiManager).getActive();_classPrivateFieldSet(this,_allowClick,!editor||editor.isEmpty())}},{key:"findNewParent",value:function findNewParent(editor,x,y){var layer=_classPrivateFieldGet(this,_uiManager).findParent(x,y);if(layer===null||layer===this){return false}layer.changeParent(editor);return true}},{key:"destroy",value:function destroy(){var _classPrivateFieldGet24;if(((_classPrivateFieldGet24=_classPrivateFieldGet(this,_uiManager).getActive())===null||_classPrivateFieldGet24===void 0?void 0:_classPrivateFieldGet24.parent)===this){_classPrivateFieldGet(this,_uiManager).commitOrRemove();_classPrivateFieldGet(this,_uiManager).setActiveEditor(null)}var _iterator123=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editors).values()),_step123;try{for(_iterator123.s();!(_step123=_iterator123.n()).done;){var _classPrivateFieldGet25;var editor=_step123.value;(_classPrivateFieldGet25=_classPrivateFieldGet(this,_accessibilityManager))===null||_classPrivateFieldGet25===void 0||_classPrivateFieldGet25.removePointerInTextLayer(editor.contentDiv);editor.setParent(null);editor.isAttachedToDOM=false;editor.div.remove()}}catch(err){_iterator123.e(err)}finally{_iterator123.f()}this.div=null;_classPrivateFieldGet(this,_editors).clear();_classPrivateFieldGet(this,_uiManager).removeLayer(this)}},{key:"render",value:function render(_ref82){var viewport=_ref82.viewport;this.viewport=viewport;(0,_display_utils.setLayerDimensions)(this.div,viewport);var _iterator124=_createForOfIteratorHelper(_classPrivateFieldGet(this,_uiManager).getEditors(this.pageIndex)),_step124;try{for(_iterator124.s();!(_step124=_iterator124.n()).done;){var editor=_step124.value;this.add(editor)}}catch(err){_iterator124.e(err)}finally{_iterator124.f()}this.updateMode()}},{key:"update",value:function update(_ref83){var viewport=_ref83.viewport;_classPrivateFieldGet(this,_uiManager).commitOrRemove();this.viewport=viewport;(0,_display_utils.setLayerDimensions)(this.div,{rotation:viewport.rotation});this.updateMode()}},{key:"pageDimensions",get:function get(){var _this$viewport$rawDim=this.viewport.rawDims,pageWidth=_this$viewport$rawDim.pageWidth,pageHeight=_this$viewport$rawDim.pageHeight;return[pageWidth,pageHeight]}}]);return AnnotationEditorLayer}();function _createNewEditor2(params){switch(_classPrivateFieldGet(this,_uiManager).getMode()){case _util.AnnotationEditorType.FREETEXT:return new _freetext.FreeTextEditor(params);case _util.AnnotationEditorType.INK:return new _ink.InkEditor(params);case _util.AnnotationEditorType.STAMP:return new _stamp.StampEditor(params)}return null}function _createAndAddNewEditor2(event,isCentered){var id=this.getNextId();var editor=_classPrivateMethodGet(this,_createNewEditor,_createNewEditor2).call(this,{parent:this,id:id,x:event.offsetX,y:event.offsetY,uiManager:_classPrivateFieldGet(this,_uiManager),isCentered:isCentered});if(editor){this.add(editor)}return editor}function _getCenterPoint2(){var _this$div$getBounding2=this.div.getBoundingClientRect(),x=_this$div$getBounding2.x,y=_this$div$getBounding2.y,width=_this$div$getBounding2.width,height=_this$div$getBounding2.height;var tlX=Math.max(0,x);var tlY=Math.max(0,y);var brX=Math.min(window.innerWidth,x+width);var brY=Math.min(window.innerHeight,y+height);var centerX=(tlX+brX)/2-x;var centerY=(tlY+brY)/2-y;var _ref84=this.viewport.rotation%180===0?[centerX,centerY]:[centerY,centerX],_ref85=_slicedToArray2(_ref84,2),offsetX=_ref85[0],offsetY=_ref85[1];return{offsetX:offsetX,offsetY:offsetY}}function _cleanup2(){_classPrivateFieldSet(this,_isCleaningUp,true);var _iterator125=_createForOfIteratorHelper(_classPrivateFieldGet(this,_editors).values()),_step125;try{for(_iterator125.s();!(_step125=_iterator125.n()).done;){var editor=_step125.value;if(editor.isEmpty()){editor.remove()}}}catch(err){_iterator125.e(err)}finally{_iterator125.f()}_classPrivateFieldSet(this,_isCleaningUp,false)}_defineProperty2(AnnotationEditorLayer,"_initialized",false);exports.AnnotationEditorLayer=AnnotationEditorLayer}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){var _class30;Object.defineProperty(exports,"__esModule",{value:true});exports.FreeTextEditor=void 0;var _util=__w_pdfjs_require__(1);var _tools=__w_pdfjs_require__(5);var _editor=__w_pdfjs_require__(4);var _annotation_layer=__w_pdfjs_require__(29);var _boundEditorDivBlur=new WeakMap;var _boundEditorDivFocus=new WeakMap;var _boundEditorDivInput=new WeakMap;var _boundEditorDivKeydown=new WeakMap;var _color=new WeakMap;var _content2=new WeakMap;var _editorDivId=new WeakMap;var _fontSize=new WeakMap;var _initialData=new WeakMap;var _updateFontSize=new WeakSet;var _updateColor=new WeakSet;var _extractText=new WeakSet;var _setEditorDimensions=new WeakSet;var _setContent=new WeakSet;var _hasElementChanged=new WeakSet;var _cheatInitialRect=new WeakSet;var FreeTextEditor=function(_editor$AnnotationEdi){_inherits2(FreeTextEditor,_editor$AnnotationEdi);var _super39=_createSuper(FreeTextEditor);function FreeTextEditor(params){var _this97;_classCallCheck2(this,FreeTextEditor);_this97=_super39.call(this,_objectSpread2(_objectSpread2({},params),{},{name:"freeTextEditor"}));_classPrivateMethodInitSpec(_assertThisInitialized(_this97),_cheatInitialRect);_classPrivateMethodInitSpec(_assertThisInitialized(_this97),_hasElementChanged);_classPrivateMethodInitSpec(_assertThisInitialized(_this97),_setContent);_classPrivateMethodInitSpec(_assertThisInitialized(_this97),_setEditorDimensions);_classPrivateMethodInitSpec(_assertThisInitialized(_this97),_extractText);_classPrivateMethodInitSpec(_assertThisInitialized(_this97),_updateColor);_classPrivateMethodInitSpec(_assertThisInitialized(_this97),_updateFontSize);_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_boundEditorDivBlur,{writable:true,value:_this97.editorDivBlur.bind(_assertThisInitialized(_this97))});_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_boundEditorDivFocus,{writable:true,value:_this97.editorDivFocus.bind(_assertThisInitialized(_this97))});_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_boundEditorDivInput,{writable:true,value:_this97.editorDivInput.bind(_assertThisInitialized(_this97))});_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_boundEditorDivKeydown,{writable:true,value:_this97.editorDivKeydown.bind(_assertThisInitialized(_this97))});_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_color,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_content2,{writable:true,value:""});_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_editorDivId,{writable:true,value:"".concat(_this97.id,"-editor")});_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_fontSize,{writable:true,value:void 0});_classPrivateFieldInitSpec(_assertThisInitialized(_this97),_initialData,{writable:true,value:null});_classPrivateFieldSet(_assertThisInitialized(_this97),_color,params.color||FreeTextEditor._defaultColor||_editor.AnnotationEditor._defaultLineColor);_classPrivateFieldSet(_assertThisInitialized(_this97),_fontSize,params.fontSize||FreeTextEditor._defaultFontSize);return _this97}_createClass2(FreeTextEditor,[{key:"updateParams",value:function updateParams(type,value){switch(type){case _util.AnnotationEditorParamsType.FREETEXT_SIZE:_classPrivateMethodGet(this,_updateFontSize,_updateFontSize2).call(this,value);break;case _util.AnnotationEditorParamsType.FREETEXT_COLOR:_classPrivateMethodGet(this,_updateColor,_updateColor2).call(this,value);break}}},{key:"propertiesToUpdate",get:function get(){return[[_util.AnnotationEditorParamsType.FREETEXT_SIZE,_classPrivateFieldGet(this,_fontSize)],[_util.AnnotationEditorParamsType.FREETEXT_COLOR,_classPrivateFieldGet(this,_color)]]}},{key:"_translateEmpty",value:function _translateEmpty(x,y){this._uiManager.translateSelectedEditors(x,y,true)}},{key:"getInitialTranslation",value:function getInitialTranslation(){var scale=this.parentScale;return[-FreeTextEditor._internalPadding*scale,-(FreeTextEditor._internalPadding+_classPrivateFieldGet(this,_fontSize))*scale]}},{key:"rebuild",value:function rebuild(){if(!this.parent){return}_get5(_getPrototypeOf(FreeTextEditor.prototype),"rebuild",this).call(this);if(this.div===null){return}if(!this.isAttachedToDOM){this.parent.add(this)}}},{key:"enableEditMode",value:function enableEditMode(){if(this.isInEditMode()){return}this.parent.setEditingState(false);this.parent.updateToolbar(_util.AnnotationEditorType.FREETEXT);_get5(_getPrototypeOf(FreeTextEditor.prototype),"enableEditMode",this).call(this);this.overlayDiv.classList.remove("enabled");this.editorDiv.contentEditable=true;this._isDraggable=false;this.div.removeAttribute("aria-activedescendant");this.editorDiv.addEventListener("keydown",_classPrivateFieldGet(this,_boundEditorDivKeydown));this.editorDiv.addEventListener("focus",_classPrivateFieldGet(this,_boundEditorDivFocus));this.editorDiv.addEventListener("blur",_classPrivateFieldGet(this,_boundEditorDivBlur));this.editorDiv.addEventListener("input",_classPrivateFieldGet(this,_boundEditorDivInput))}},{key:"disableEditMode",value:function disableEditMode(){if(!this.isInEditMode()){return}this.parent.setEditingState(true);_get5(_getPrototypeOf(FreeTextEditor.prototype),"disableEditMode",this).call(this);this.overlayDiv.classList.add("enabled");this.editorDiv.contentEditable=false;this.div.setAttribute("aria-activedescendant",_classPrivateFieldGet(this,_editorDivId));this._isDraggable=true;this.editorDiv.removeEventListener("keydown",_classPrivateFieldGet(this,_boundEditorDivKeydown));this.editorDiv.removeEventListener("focus",_classPrivateFieldGet(this,_boundEditorDivFocus));this.editorDiv.removeEventListener("blur",_classPrivateFieldGet(this,_boundEditorDivBlur));this.editorDiv.removeEventListener("input",_classPrivateFieldGet(this,_boundEditorDivInput));this.div.focus({preventScroll:true});this.isEditing=false;this.parent.div.classList.add("freeTextEditing")}},{key:"focusin",value:function focusin(event){if(!this._focusEventsAllowed){return}_get5(_getPrototypeOf(FreeTextEditor.prototype),"focusin",this).call(this,event);if(event.target!==this.editorDiv){this.editorDiv.focus()}}},{key:"onceAdded",value:function onceAdded(){var _this$_initialOptions;if(this.width){_classPrivateMethodGet(this,_cheatInitialRect,_cheatInitialRect2).call(this);return}this.enableEditMode();this.editorDiv.focus();if((_this$_initialOptions=this._initialOptions)!==null&&_this$_initialOptions!==void 0&&_this$_initialOptions.isCentered){this.center()}this._initialOptions=null}},{key:"isEmpty",value:function isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}},{key:"remove",value:function remove(){this.isEditing=false;if(this.parent){this.parent.setEditingState(true);this.parent.div.classList.add("freeTextEditing")}_get5(_getPrototypeOf(FreeTextEditor.prototype),"remove",this).call(this)}},{key:"commit",value:function commit(){var _this98=this;if(!this.isInEditMode()){return}_get5(_getPrototypeOf(FreeTextEditor.prototype),"commit",this).call(this);this.disableEditMode();var savedText=_classPrivateFieldGet(this,_content2);var newText=_classPrivateFieldSet(this,_content2,_classPrivateMethodGet(this,_extractText,_extractText2).call(this).trimEnd());if(savedText===newText){return}var setText=function setText(text){_classPrivateFieldSet(_this98,_content2,text);if(!text){_this98.remove();return}_classPrivateMethodGet(_this98,_setContent,_setContent2).call(_this98);_this98._uiManager.rebuild(_this98);_classPrivateMethodGet(_this98,_setEditorDimensions,_setEditorDimensions2).call(_this98)};this.addCommands({cmd:function cmd(){setText(newText)},undo:function undo(){setText(savedText)},mustExec:false});_classPrivateMethodGet(this,_setEditorDimensions,_setEditorDimensions2).call(this)}},{key:"shouldGetKeyboardEvents",value:function shouldGetKeyboardEvents(){return this.isInEditMode()}},{key:"enterInEditMode",value:function enterInEditMode(){this.enableEditMode();this.editorDiv.focus()}},{key:"dblclick",value:function dblclick(event){this.enterInEditMode()}},{key:"keydown",value:function keydown(event){if(event.target===this.div&&event.key==="Enter"){this.enterInEditMode();event.preventDefault()}}},{key:"editorDivKeydown",value:function editorDivKeydown(event){FreeTextEditor._keyboardManager.exec(this,event)}},{key:"editorDivFocus",value:function editorDivFocus(event){this.isEditing=true}},{key:"editorDivBlur",value:function editorDivBlur(event){this.isEditing=false}},{key:"editorDivInput",value:function editorDivInput(event){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}},{key:"disableEditing",value:function disableEditing(){this.editorDiv.setAttribute("role","comment");this.editorDiv.removeAttribute("aria-multiline")}},{key:"enableEditing",value:function enableEditing(){this.editorDiv.setAttribute("role","textbox");this.editorDiv.setAttribute("aria-multiline",true)}},{key:"render",value:function render(){var _this99=this;if(this.div){return this.div}var baseX,baseY;if(this.width){baseX=this.x;baseY=this.y}_get5(_getPrototypeOf(FreeTextEditor.prototype),"render",this).call(this);this.editorDiv=document.createElement("div");this.editorDiv.className="internal";this.editorDiv.setAttribute("id",_classPrivateFieldGet(this,_editorDivId));this.enableEditing();_editor.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(function(msg){var _this99$editorDiv;return(_this99$editorDiv=_this99.editorDiv)===null||_this99$editorDiv===void 0?void 0:_this99$editorDiv.setAttribute("aria-label",msg)});_editor.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(function(msg){var _this99$editorDiv2;return(_this99$editorDiv2=_this99.editorDiv)===null||_this99$editorDiv2===void 0?void 0:_this99$editorDiv2.setAttribute("default-content",msg)});this.editorDiv.contentEditable=true;var style=this.editorDiv.style;style.fontSize="calc(".concat(_classPrivateFieldGet(this,_fontSize),"px * var(--scale-factor))");style.color=_classPrivateFieldGet(this,_color);this.div.append(this.editorDiv);this.overlayDiv=document.createElement("div");this.overlayDiv.classList.add("overlay","enabled");this.div.append(this.overlayDiv);(0,_tools.bindEvents)(this,this.div,["dblclick","keydown"]);if(this.width){var _this$parentDimension9=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension9[0],parentHeight=_this$parentDimension9[1];if(this.annotationElementId){var _classPrivateFieldGet26=_classPrivateFieldGet(this,_initialData),position=_classPrivateFieldGet26.position;var _this$getInitialTrans3=this.getInitialTranslation(),_this$getInitialTrans4=_slicedToArray2(_this$getInitialTrans3,2),tx=_this$getInitialTrans4[0],ty=_this$getInitialTrans4[1];var _this$pageTranslation2=this.pageTranslationToScreen(tx,ty);var _this$pageTranslation3=_slicedToArray2(_this$pageTranslation2,2);tx=_this$pageTranslation3[0];ty=_this$pageTranslation3[1];var _this$pageDimensions7=_slicedToArray2(this.pageDimensions,2),pageWidth=_this$pageDimensions7[0],pageHeight=_this$pageDimensions7[1];var _this$pageTranslation4=_slicedToArray2(this.pageTranslation,2),pageX=_this$pageTranslation4[0],pageY=_this$pageTranslation4[1];var posX,posY;switch(this.rotation){case 0:posX=baseX+(position[0]-pageX)/pageWidth;posY=baseY+this.height-(position[1]-pageY)/pageHeight;break;case 90:posX=baseX+(position[0]-pageX)/pageWidth;posY=baseY-(position[1]-pageY)/pageHeight;var _ref86=[ty,-tx];tx=_ref86[0];ty=_ref86[1];break;case 180:posX=baseX-this.width+(position[0]-pageX)/pageWidth;posY=baseY-(position[1]-pageY)/pageHeight;var _ref87=[-tx,-ty];tx=_ref87[0];ty=_ref87[1];break;case 270:posX=baseX+(position[0]-pageX-this.height*pageHeight)/pageWidth;posY=baseY+(position[1]-pageY-this.width*pageWidth)/pageHeight;var _ref88=[-ty,tx];tx=_ref88[0];ty=_ref88[1];break}this.setAt(posX*parentWidth,posY*parentHeight,tx,ty)}else{this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight)}_classPrivateMethodGet(this,_setContent,_setContent2).call(this);this._isDraggable=true;this.editorDiv.contentEditable=false}else{this._isDraggable=false;this.editorDiv.contentEditable=true}return this.div}},{key:"contentDiv",get:function get(){return this.editorDiv}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.isEmpty()){return null}if(this.deleted){return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:true}}var padding=FreeTextEditor._internalPadding*this.parentScale;var rect=this.getRect(padding,padding);var color=_editor.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:_classPrivateFieldGet(this,_color));var serialized={annotationType:_util.AnnotationEditorType.FREETEXT,color:color,fontSize:_classPrivateFieldGet(this,_fontSize),value:_classPrivateFieldGet(this,_content2),pageIndex:this.pageIndex,rect:rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(isForCopying){return serialized}if(this.annotationElementId&&!_classPrivateMethodGet(this,_hasElementChanged,_hasElementChanged2).call(this,serialized)){return null}serialized.id=this.annotationElementId;return serialized}}],[{key:"_keyboardManager",get:function get(){var proto=FreeTextEditor.prototype;var arrowChecker=function arrowChecker(self){return self.isEmpty()};var small=_tools.AnnotationEditorUIManager.TRANSLATE_SMALL;var big=_tools.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,_util.shadow)(this,"_keyboardManager",new _tools.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],proto.commitOrRemove,{bubbles:true}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],proto.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],proto._translateEmpty,{args:[-small,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],proto._translateEmpty,{args:[-big,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],proto._translateEmpty,{args:[small,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],proto._translateEmpty,{args:[big,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],proto._translateEmpty,{args:[0,-small],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],proto._translateEmpty,{args:[0,-big],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],proto._translateEmpty,{args:[0,small],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],proto._translateEmpty,{args:[0,big],checker:arrowChecker}]]))}},{key:"initialize",value:function initialize(l10n){_editor.AnnotationEditor.initialize(l10n,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});var style=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(style.getPropertyValue("--freetext-padding"))}},{key:"updateDefaultParams",value:function updateDefaultParams(type,value){switch(type){case _util.AnnotationEditorParamsType.FREETEXT_SIZE:FreeTextEditor._defaultFontSize=value;break;case _util.AnnotationEditorParamsType.FREETEXT_COLOR:FreeTextEditor._defaultColor=value;break}}},{key:"defaultPropertiesToUpdate",get:function get(){return[[_util.AnnotationEditorParamsType.FREETEXT_SIZE,FreeTextEditor._defaultFontSize],[_util.AnnotationEditorParamsType.FREETEXT_COLOR,FreeTextEditor._defaultColor||_editor.AnnotationEditor._defaultLineColor]]}},{key:"deserialize",value:function deserialize(data,parent,uiManager){var _util$Util5;var initialData=null;if(data instanceof _annotation_layer.FreeTextAnnotationElement){var _data7=data,_data7$data=_data7.data,_data7$data$defaultAp=_data7$data.defaultAppearanceData,fontSize=_data7$data$defaultAp.fontSize,fontColor=_data7$data$defaultAp.fontColor,rect=_data7$data.rect,rotation=_data7$data.rotation,_id12=_data7$data.id,textContent=_data7.textContent,textPosition=_data7.textPosition,pageNumber=_data7.parent.page.pageNumber;if(!textContent||textContent.length===0){return null}initialData=data={annotationType:_util.AnnotationEditorType.FREETEXT,color:Array.from(fontColor),fontSize:fontSize,value:textContent.join("\n"),position:textPosition,pageIndex:pageNumber-1,rect:rect,rotation:rotation,id:_id12,deleted:false}}var editor=_get5(_getPrototypeOf(FreeTextEditor),"deserialize",this).call(this,data,parent,uiManager);_classPrivateFieldSet(editor,_fontSize,data.fontSize);_classPrivateFieldSet(editor,_color,(_util$Util5=_util.Util).makeHexColor.apply(_util$Util5,_toConsumableArray2(data.color)));_classPrivateFieldSet(editor,_content2,data.value);editor.annotationElementId=data.id||null;_classPrivateFieldSet(editor,_initialData,initialData);return editor}}]);return FreeTextEditor}(_editor.AnnotationEditor);_class30=FreeTextEditor;function _updateFontSize2(fontSize){var _this100=this;var setFontsize=function setFontsize(size){_this100.editorDiv.style.fontSize="calc(".concat(size,"px * var(--scale-factor))");_this100.translate(0,-(size-_classPrivateFieldGet(_this100,_fontSize))*_this100.parentScale);_classPrivateFieldSet(_this100,_fontSize,size);_classPrivateMethodGet(_this100,_setEditorDimensions,_setEditorDimensions2).call(_this100)};var savedFontsize=_classPrivateFieldGet(this,_fontSize);this.addCommands({cmd:function cmd(){setFontsize(fontSize)},undo:function undo(){setFontsize(savedFontsize)},mustExec:true,type:_util.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:true,keepUndo:true})}function _updateColor2(color){var _this101=this;var savedColor=_classPrivateFieldGet(this,_color);this.addCommands({cmd:function cmd(){_classPrivateFieldSet(_this101,_color,_this101.editorDiv.style.color=color)},undo:function undo(){_classPrivateFieldSet(_this101,_color,_this101.editorDiv.style.color=savedColor)},mustExec:true,type:_util.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:true,keepUndo:true})}function _extractText2(){var divs=this.editorDiv.getElementsByTagName("div");if(divs.length===0){return this.editorDiv.innerText}var buffer=[];var _iterator126=_createForOfIteratorHelper(divs),_step126;try{for(_iterator126.s();!(_step126=_iterator126.n()).done;){var div=_step126.value;buffer.push(div.innerText.replace(/\r\n?|\n/,""))}}catch(err){_iterator126.e(err)}finally{_iterator126.f()}return buffer.join("\n")}function _setEditorDimensions2(){var _this$parentDimension10=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension10[0],parentHeight=_this$parentDimension10[1];var rect;if(this.isAttachedToDOM){rect=this.div.getBoundingClientRect()}else{var currentLayer=this.currentLayer,div=this.div;var savedDisplay=div.style.display;div.style.display="hidden";currentLayer.div.append(this.div);rect=div.getBoundingClientRect();div.remove();div.style.display=savedDisplay}if(this.rotation%180===this.parentRotation%180){this.width=rect.width/parentWidth;this.height=rect.height/parentHeight}else{this.width=rect.height/parentWidth;this.height=rect.width/parentHeight}this.fixAndSetPosition()}function _setContent2(){this.editorDiv.replaceChildren();if(!_classPrivateFieldGet(this,_content2)){return}var _iterator127=_createForOfIteratorHelper(_classPrivateFieldGet(this,_content2).split("\n")),_step127;try{for(_iterator127.s();!(_step127=_iterator127.n()).done;){var line=_step127.value;var div=document.createElement("div");div.append(line?document.createTextNode(line):document.createElement("br"));this.editorDiv.append(div)}}catch(err){_iterator127.e(err)}finally{_iterator127.f()}}function _hasElementChanged2(serialized){var _classPrivateFieldGet27=_classPrivateFieldGet(this,_initialData),value=_classPrivateFieldGet27.value,fontSize=_classPrivateFieldGet27.fontSize,color=_classPrivateFieldGet27.color,rect=_classPrivateFieldGet27.rect,pageIndex=_classPrivateFieldGet27.pageIndex;return serialized.value!==value||serialized.fontSize!==fontSize||serialized.rect.some(function(x,i){return Math.abs(x-rect[i])>=1})||serialized.color.some(function(c,i){return c!==color[i]})||serialized.pageIndex!==pageIndex}function _cheatInitialRect2(){var _this102=this;var delayed=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this.annotationElementId){return}_classPrivateMethodGet(this,_setEditorDimensions,_setEditorDimensions2).call(this);if(!delayed&&(this.width===0||this.height===0)){setTimeout(function(){return _classPrivateMethodGet(_this102,_cheatInitialRect,_cheatInitialRect2).call(_this102,true)},0);return}var padding=_class30._internalPadding*this.parentScale;_classPrivateFieldGet(this,_initialData).rect=this.getRect(padding,padding)}_defineProperty2(FreeTextEditor,"_freeTextDefaultContent","");_defineProperty2(FreeTextEditor,"_internalPadding",0);_defineProperty2(FreeTextEditor,"_defaultColor",null);_defineProperty2(FreeTextEditor,"_defaultFontSize",10);_defineProperty2(FreeTextEditor,"_type","freetext");exports.FreeTextEditor=FreeTextEditor}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.StampAnnotationElement=exports.InkAnnotationElement=exports.FreeTextAnnotationElement=exports.AnnotationLayer=void 0;var _util=__w_pdfjs_require__(1);var _display_utils=__w_pdfjs_require__(6);var _annotation_storage=__w_pdfjs_require__(3);var _scripting_utils=__w_pdfjs_require__(30);var _displayL10n_utils=__w_pdfjs_require__(31);var _xfa_layer=__w_pdfjs_require__(32);var DEFAULT_TAB_INDEX=1000;var DEFAULT_FONT_SIZE=9;var GetElementsByNameSet=new WeakSet;function getRectDims(rect){return{width:rect[2]-rect[0],height:rect[3]-rect[1]}}var AnnotationElementFactory=function(){function AnnotationElementFactory(){_classCallCheck2(this,AnnotationElementFactory)}_createClass2(AnnotationElementFactory,null,[{key:"create",value:function create(parameters){var subtype=parameters.data.annotationType;switch(subtype){case _util.AnnotationType.LINK:return new LinkAnnotationElement(parameters);case _util.AnnotationType.TEXT:return new TextAnnotationElement(parameters);case _util.AnnotationType.WIDGET:var fieldType=parameters.data.fieldType;switch(fieldType){case"Tx":return new TextWidgetAnnotationElement(parameters);case"Btn":if(parameters.data.radioButton){return new RadioButtonWidgetAnnotationElement(parameters)}else if(parameters.data.checkBox){return new CheckboxWidgetAnnotationElement(parameters)}return new PushButtonWidgetAnnotationElement(parameters);case"Ch":return new ChoiceWidgetAnnotationElement(parameters);case"Sig":return new SignatureWidgetAnnotationElement(parameters)}return new WidgetAnnotationElement(parameters);case _util.AnnotationType.POPUP:return new PopupAnnotationElement(parameters);case _util.AnnotationType.FREETEXT:return new FreeTextAnnotationElement(parameters);case _util.AnnotationType.LINE:return new LineAnnotationElement(parameters);case _util.AnnotationType.SQUARE:return new SquareAnnotationElement(parameters);case _util.AnnotationType.CIRCLE:return new CircleAnnotationElement(parameters);case _util.AnnotationType.POLYLINE:return new PolylineAnnotationElement(parameters);case _util.AnnotationType.CARET:return new CaretAnnotationElement(parameters);case _util.AnnotationType.INK:return new InkAnnotationElement(parameters);case _util.AnnotationType.POLYGON:return new PolygonAnnotationElement(parameters);case _util.AnnotationType.HIGHLIGHT:return new HighlightAnnotationElement(parameters);case _util.AnnotationType.UNDERLINE:return new UnderlineAnnotationElement(parameters);case _util.AnnotationType.SQUIGGLY:return new SquigglyAnnotationElement(parameters);case _util.AnnotationType.STRIKEOUT:return new StrikeOutAnnotationElement(parameters);case _util.AnnotationType.STAMP:return new StampAnnotationElement(parameters);case _util.AnnotationType.FILEATTACHMENT:return new FileAttachmentAnnotationElement(parameters);default:return new AnnotationElement(parameters)}}}]);return AnnotationElementFactory}();var _hasBorder=new WeakMap;var AnnotationElement=function(){function AnnotationElement(parameters){var _ref89=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref89$isRenderable=_ref89.isRenderable,isRenderable=_ref89$isRenderable===void 0?false:_ref89$isRenderable,_ref89$ignoreBorder=_ref89.ignoreBorder,ignoreBorder=_ref89$ignoreBorder===void 0?false:_ref89$ignoreBorder,_ref89$createQuadrila=_ref89.createQuadrilaterals,createQuadrilaterals=_ref89$createQuadrila===void 0?false:_ref89$createQuadrila;_classCallCheck2(this,AnnotationElement);_classPrivateFieldInitSpec(this,_hasBorder,{writable:true,value:false});this.isRenderable=isRenderable;this.data=parameters.data;this.layer=parameters.layer;this.linkService=parameters.linkService;this.downloadManager=parameters.downloadManager;this.imageResourcesPath=parameters.imageResourcesPath;this.renderForms=parameters.renderForms;this.svgFactory=parameters.svgFactory;this.annotationStorage=parameters.annotationStorage;this.enableScripting=parameters.enableScripting;this.hasJSActions=parameters.hasJSActions;this._fieldObjects=parameters.fieldObjects;this.parent=parameters.parent;if(isRenderable){this.container=this._createContainer(ignoreBorder)}if(createQuadrilaterals){this._createQuadrilaterals()}}_createClass2(AnnotationElement,[{key:"hasPopupData",get:function get(){return AnnotationElement._hasPopupData(this.data)}},{key:"_createContainer",value:function _createContainer(ignoreBorder){var data=this.data,_this$parent3=this.parent,page=_this$parent3.page,viewport=_this$parent3.viewport;var container=document.createElement("section");container.setAttribute("data-annotation-id",data.id);if(!(this instanceof WidgetAnnotationElement)){container.tabIndex=DEFAULT_TAB_INDEX}container.style.zIndex=this.parent.zIndex++;if(this.data.popupRef){container.setAttribute("aria-haspopup","dialog")}if(data.noRotate){container.classList.add("norotate")}var _viewport$rawDims3=viewport.rawDims,pageWidth=_viewport$rawDims3.pageWidth,pageHeight=_viewport$rawDims3.pageHeight,pageX=_viewport$rawDims3.pageX,pageY=_viewport$rawDims3.pageY;if(!data.rect||this instanceof PopupAnnotationElement){var _rotation2=data.rotation;if(!data.hasOwnCanvas&&_rotation2!==0){this.setRotation(_rotation2,container)}return container}var _getRectDims=getRectDims(data.rect),width=_getRectDims.width,height=_getRectDims.height;var rect=_util.Util.normalizeRect([data.rect[0],page.view[3]-data.rect[1]+page.view[1],data.rect[2],page.view[3]-data.rect[3]+page.view[1]]);if(!ignoreBorder&&data.borderStyle.width>0){container.style.borderWidth="".concat(data.borderStyle.width,"px");var horizontalRadius=data.borderStyle.horizontalCornerRadius;var verticalRadius=data.borderStyle.verticalCornerRadius;if(horizontalRadius>0||verticalRadius>0){var radius="calc(".concat(horizontalRadius,"px * var(--scale-factor)) / calc(").concat(verticalRadius,"px * var(--scale-factor))");container.style.borderRadius=radius}else if(this instanceof RadioButtonWidgetAnnotationElement){var _radius="calc(".concat(width,"px * var(--scale-factor)) / calc(").concat(height,"px * var(--scale-factor))");container.style.borderRadius=_radius}switch(data.borderStyle.style){case _util.AnnotationBorderStyleType.SOLID:container.style.borderStyle="solid";break;case _util.AnnotationBorderStyleType.DASHED:container.style.borderStyle="dashed";break;case _util.AnnotationBorderStyleType.BEVELED:(0,_util.warn)("Unimplemented border style: beveled");break;case _util.AnnotationBorderStyleType.INSET:(0,_util.warn)("Unimplemented border style: inset");break;case _util.AnnotationBorderStyleType.UNDERLINE:container.style.borderBottomStyle="solid";break}var borderColor=data.borderColor||null;if(borderColor){_classPrivateFieldSet(this,_hasBorder,true);container.style.borderColor=_util.Util.makeHexColor(borderColor[0]|0,borderColor[1]|0,borderColor[2]|0)}else{container.style.borderWidth=0}}container.style.left="".concat(100*(rect[0]-pageX)/pageWidth,"%");container.style.top="".concat(100*(rect[1]-pageY)/pageHeight,"%");var rotation=data.rotation;if(data.hasOwnCanvas||rotation===0){container.style.width="".concat(100*width/pageWidth,"%");container.style.height="".concat(100*height/pageHeight,"%")}else{this.setRotation(rotation,container)}return container}},{key:"setRotation",value:function setRotation(angle){var container=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.container;if(!this.data.rect){return}var _this$parent$viewport3=this.parent.viewport.rawDims,pageWidth=_this$parent$viewport3.pageWidth,pageHeight=_this$parent$viewport3.pageHeight;var _getRectDims2=getRectDims(this.data.rect),width=_getRectDims2.width,height=_getRectDims2.height;var elementWidth,elementHeight;if(angle%180===0){elementWidth=100*width/pageWidth;elementHeight=100*height/pageHeight}else{elementWidth=100*height/pageWidth;elementHeight=100*width/pageHeight}container.style.width="".concat(elementWidth,"%");container.style.height="".concat(elementHeight,"%");container.setAttribute("data-main-rotation",(360-angle)%360)}},{key:"_commonActions",get:function get(){var _this103=this;var setColor=function setColor(jsName,styleName,event){var color=event.detail[jsName];var colorType=color[0];var colorArray=color.slice(1);event.target.style[styleName]=_scripting_utils.ColorConverters["".concat(colorType,"_HTML")](colorArray);_this103.annotationStorage.setValue(_this103.data.id,_defineProperty2({},styleName,_scripting_utils.ColorConverters["".concat(colorType,"_rgb")](colorArray)))};return(0,_util.shadow)(this,"_commonActions",{display:function display(event){var display=event.detail.display;var hidden=display%2===1;_this103.container.style.visibility=hidden?"hidden":"visible";_this103.annotationStorage.setValue(_this103.data.id,{noView:hidden,noPrint:display===1||display===2})},print:function print(event){_this103.annotationStorage.setValue(_this103.data.id,{noPrint:!event.detail.print})},hidden:function hidden(event){var hidden=event.detail.hidden;_this103.container.style.visibility=hidden?"hidden":"visible";_this103.annotationStorage.setValue(_this103.data.id,{noPrint:hidden,noView:hidden})},focus:function focus(event){setTimeout(function(){return event.target.focus({preventScroll:false})},0)},userName:function userName(event){event.target.title=event.detail.userName},readonly:function readonly(event){event.target.disabled=event.detail.readonly},required:function required(event){_this103._setRequired(event.target,event.detail.required)},bgColor:function bgColor(event){setColor("bgColor","backgroundColor",event)},fillColor:function fillColor(event){setColor("fillColor","backgroundColor",event)},fgColor:function fgColor(event){setColor("fgColor","color",event)},textColor:function textColor(event){setColor("textColor","color",event)},borderColor:function borderColor(event){setColor("borderColor","borderColor",event)},strokeColor:function strokeColor(event){setColor("strokeColor","borderColor",event)},rotation:function rotation(event){var angle=event.detail.rotation;_this103.setRotation(angle);_this103.annotationStorage.setValue(_this103.data.id,{rotation:angle})}})}},{key:"_dispatchEventFromSandbox",value:function _dispatchEventFromSandbox(actions,jsEvent){var commonActions=this._commonActions;for(var _i51=0,_Object$keys=Object.keys(jsEvent.detail);_i51<_Object$keys.length;_i51++){var _name12=_Object$keys[_i51];var action=actions[_name12]||commonActions[_name12];action===null||action===void 0||action(jsEvent)}}},{key:"_setDefaultPropertiesFromJS",value:function _setDefaultPropertiesFromJS(element){if(!this.enableScripting){return}var storedData=this.annotationStorage.getRawValue(this.data.id);if(!storedData){return}var commonActions=this._commonActions;for(var _i52=0,_Object$entries3=Object.entries(storedData);_i52<_Object$entries3.length;_i52++){var _Object$entries3$_i=_slicedToArray2(_Object$entries3[_i52],2),actionName=_Object$entries3$_i[0],detail=_Object$entries3$_i[1];var action=commonActions[actionName];if(action){var eventProxy={detail:_defineProperty2({},actionName,detail),target:element};action(eventProxy);delete storedData[actionName]}}}},{key:"_createQuadrilaterals",value:function _createQuadrilaterals(){if(!this.container){return}var quadPoints=this.data.quadPoints;if(!quadPoints){return}var _this$data$rect=_slicedToArray2(this.data.rect,4),rectBlX=_this$data$rect[0],rectBlY=_this$data$rect[1],rectTrX=_this$data$rect[2],rectTrY=_this$data$rect[3];if(quadPoints.length===1){var _quadPoints$=_slicedToArray2(quadPoints[0],3),_quadPoints$$=_quadPoints$[1],trX=_quadPoints$$.x,trY=_quadPoints$$.y,_quadPoints$$2=_quadPoints$[2],blX=_quadPoints$$2.x,blY=_quadPoints$$2.y;if(rectTrX===trX&&rectTrY===trY&&rectBlX===blX&&rectBlY===blY){return}}var style=this.container.style;var svgBuffer;if(_classPrivateFieldGet(this,_hasBorder)){var borderColor=style.borderColor,borderWidth=style.borderWidth;style.borderWidth=0;svgBuffer=["url('data:image/svg+xml;utf8,","<svg xmlns=\"http://www.w3.org/2000/svg\""," preserveAspectRatio=\"none\" viewBox=\"0 0 1 1\">","<g fill=\"transparent\" stroke=\"".concat(borderColor,"\" stroke-width=\"").concat(borderWidth,"\">")];this.container.classList.add("hasBorder")}var width=rectTrX-rectBlX;var height=rectTrY-rectBlY;var svgFactory=this.svgFactory;var svg=svgFactory.createElement("svg");svg.classList.add("quadrilateralsContainer");svg.setAttribute("width",0);svg.setAttribute("height",0);var defs=svgFactory.createElement("defs");svg.append(defs);var clipPath=svgFactory.createElement("clipPath");var id="clippath_".concat(this.data.id);clipPath.setAttribute("id",id);clipPath.setAttribute("clipPathUnits","objectBoundingBox");defs.append(clipPath);var _iterator128=_createForOfIteratorHelper(quadPoints),_step128;try{for(_iterator128.s();!(_step128=_iterator128.n()).done;){var _svgBuffer;var _step128$value=_slicedToArray2(_step128.value,3),_step128$value$=_step128$value[1],_trX=_step128$value$.x,_trY=_step128$value$.y,_step128$value$2=_step128$value[2],_blX=_step128$value$2.x,_blY=_step128$value$2.y;var rect=svgFactory.createElement("rect");var x=(_blX-rectBlX)/width;var y=(rectTrY-_trY)/height;var rectWidth=(_trX-_blX)/width;var rectHeight=(_trY-_blY)/height;rect.setAttribute("x",x);rect.setAttribute("y",y);rect.setAttribute("width",rectWidth);rect.setAttribute("height",rectHeight);clipPath.append(rect);(_svgBuffer=svgBuffer)===null||_svgBuffer===void 0||_svgBuffer.push("<rect vector-effect=\"non-scaling-stroke\" x=\"".concat(x,"\" y=\"").concat(y,"\" width=\"").concat(rectWidth,"\" height=\"").concat(rectHeight,"\"/>"))}}catch(err){_iterator128.e(err)}finally{_iterator128.f()}if(_classPrivateFieldGet(this,_hasBorder)){svgBuffer.push("</g></svg>')");style.backgroundImage=svgBuffer.join("")}this.container.append(svg);this.container.style.clipPath="url(#".concat(id,")")}},{key:"_createPopup",value:function _createPopup(){var container=this.container,data=this.data;container.setAttribute("aria-haspopup","dialog");var popup=new PopupAnnotationElement({data:{color:data.color,titleObj:data.titleObj,modificationDate:data.modificationDate,contentsObj:data.contentsObj,richText:data.richText,parentRect:data.rect,borderStyle:0,id:"popup_".concat(data.id),rotation:data.rotation},parent:this.parent,elements:[this]});this.parent.div.append(popup.render())}},{key:"render",value:function render(){(0,_util.unreachable)("Abstract method `AnnotationElement.render` called")}},{key:"_getElementsByName",value:function _getElementsByName(name){var skipId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var fields=[];if(this._fieldObjects){var fieldObj=this._fieldObjects[name];if(fieldObj){var _iterator129=_createForOfIteratorHelper(fieldObj),_step129;try{for(_iterator129.s();!(_step129=_iterator129.n()).done;){var _step129$value=_step129.value,page=_step129$value.page,_id13=_step129$value.id,exportValues=_step129$value.exportValues;if(page===-1){continue}if(_id13===skipId){continue}var exportValue=typeof exportValues==="string"?exportValues:null;var domElement=document.querySelector("[data-element-id=\"".concat(_id13,"\"]"));if(domElement&&!GetElementsByNameSet.has(domElement)){(0,_util.warn)("_getElementsByName - element not allowed: ".concat(_id13));continue}fields.push({id:_id13,exportValue:exportValue,domElement:domElement})}}catch(err){_iterator129.e(err)}finally{_iterator129.f()}}return fields}var _iterator130=_createForOfIteratorHelper(document.getElementsByName(name)),_step130;try{for(_iterator130.s();!(_step130=_iterator130.n()).done;){var _domElement=_step130.value;var _exportValue=_domElement.exportValue;var _id14=_domElement.getAttribute("data-element-id");if(_id14===skipId){continue}if(!GetElementsByNameSet.has(_domElement)){continue}fields.push({id:_id14,exportValue:_exportValue,domElement:_domElement})}}catch(err){_iterator130.e(err)}finally{_iterator130.f()}return fields}},{key:"show",value:function show(){var _this$popup;if(this.container){this.container.hidden=false}(_this$popup=this.popup)===null||_this$popup===void 0||_this$popup.maybeShow()}},{key:"hide",value:function hide(){var _this$popup2;if(this.container){this.container.hidden=true}(_this$popup2=this.popup)===null||_this$popup2===void 0||_this$popup2.forceHide()}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return this.container}},{key:"addHighlightArea",value:function addHighlightArea(){var triggers=this.getElementsToTriggerPopup();if(Array.isArray(triggers)){var _iterator131=_createForOfIteratorHelper(triggers),_step131;try{for(_iterator131.s();!(_step131=_iterator131.n()).done;){var element=_step131.value;element.classList.add("highlightArea")}}catch(err){_iterator131.e(err)}finally{_iterator131.f()}}else{triggers.classList.add("highlightArea")}}},{key:"_editOnDoubleClick",value:function _editOnDoubleClick(){var _this104=this;var mode=this.annotationEditorType,editId=this.data.id;this.container.addEventListener("dblclick",function(){var _this104$linkService$;(_this104$linkService$=_this104.linkService.eventBus)===null||_this104$linkService$===void 0||_this104$linkService$.dispatch("switchannotationeditormode",{source:_this104,mode:mode,editId:editId})})}}],[{key:"_hasPopupData",value:function _hasPopupData(_ref90){var titleObj=_ref90.titleObj,contentsObj=_ref90.contentsObj,richText=_ref90.richText;return!!(titleObj!==null&&titleObj!==void 0&&titleObj.str||contentsObj!==null&&contentsObj!==void 0&&contentsObj.str||richText!==null&&richText!==void 0&&richText.str)}}]);return AnnotationElement}();var _setInternalLink=new WeakSet;var _bindSetOCGState=new WeakSet;var LinkAnnotationElement=function(_AnnotationElement){_inherits2(LinkAnnotationElement,_AnnotationElement);var _super40=_createSuper(LinkAnnotationElement);function LinkAnnotationElement(parameters){var _this105;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck2(this,LinkAnnotationElement);_this105=_super40.call(this,parameters,{isRenderable:true,ignoreBorder:!!(options!==null&&options!==void 0&&options.ignoreBorder),createQuadrilaterals:true});_classPrivateMethodInitSpec(_assertThisInitialized(_this105),_bindSetOCGState);_classPrivateMethodInitSpec(_assertThisInitialized(_this105),_setInternalLink);_this105.isTooltipOnly=parameters.data.isTooltipOnly;return _this105}_createClass2(LinkAnnotationElement,[{key:"render",value:function render(){var data=this.data,linkService=this.linkService;var link=document.createElement("a");link.setAttribute("data-element-id",data.id);var isBound=false;if(data.url){linkService.addLinkAttributes(link,data.url,data.newWindow);isBound=true}else if(data.action){this._bindNamedAction(link,data.action);isBound=true}else if(data.attachment){this._bindAttachment(link,data.attachment);isBound=true}else if(data.setOCGState){_classPrivateMethodGet(this,_bindSetOCGState,_bindSetOCGState2).call(this,link,data.setOCGState);isBound=true}else if(data.dest){this._bindLink(link,data.dest);isBound=true}else{if(data.actions&&(data.actions.Action||data.actions["Mouse Up"]||data.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions){this._bindJSAction(link,data);isBound=true}if(data.resetForm){this._bindResetFormAction(link,data.resetForm);isBound=true}else if(this.isTooltipOnly&&!isBound){this._bindLink(link,"");isBound=true}}this.container.classList.add("linkAnnotation");if(isBound){this.container.append(link)}return this.container}},{key:"_bindLink",value:function _bindLink(link,destination){var _this106=this;link.href=this.linkService.getDestinationHash(destination);link.onclick=function(){if(destination){_this106.linkService.goToDestination(destination)}return false};if(destination||destination===""){_classPrivateMethodGet(this,_setInternalLink,_setInternalLink2).call(this)}}},{key:"_bindNamedAction",value:function _bindNamedAction(link,action){var _this107=this;link.href=this.linkService.getAnchorUrl("");link.onclick=function(){_this107.linkService.executeNamedAction(action);return false};_classPrivateMethodGet(this,_setInternalLink,_setInternalLink2).call(this)}},{key:"_bindAttachment",value:function _bindAttachment(link,attachment){var _this108=this;link.href=this.linkService.getAnchorUrl("");link.onclick=function(){var _this108$downloadMana;(_this108$downloadMana=_this108.downloadManager)===null||_this108$downloadMana===void 0||_this108$downloadMana.openOrDownloadData(_this108.container,attachment.content,attachment.filename);return false};_classPrivateMethodGet(this,_setInternalLink,_setInternalLink2).call(this)}},{key:"_bindJSAction",value:function _bindJSAction(link,data){var _this109=this;link.href=this.linkService.getAnchorUrl("");var map=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);var _loop5=function _loop5(){var name=_Object$keys2[_i53];var jsName=map.get(name);if(!jsName){return 1}link[jsName]=function(){var _this109$linkService$;(_this109$linkService$=_this109.linkService.eventBus)===null||_this109$linkService$===void 0||_this109$linkService$.dispatch("dispatcheventinsandbox",{source:_this109,detail:{id:data.id,name:name}});return false}};for(var _i53=0,_Object$keys2=Object.keys(data.actions);_i53<_Object$keys2.length;_i53++){if(_loop5())continue}if(!link.onclick){link.onclick=function(){return false}}_classPrivateMethodGet(this,_setInternalLink,_setInternalLink2).call(this)}},{key:"_bindResetFormAction",value:function _bindResetFormAction(link,resetForm){var _this110=this;var otherClickAction=link.onclick;if(!otherClickAction){link.href=this.linkService.getAnchorUrl("")}_classPrivateMethodGet(this,_setInternalLink,_setInternalLink2).call(this);if(!this._fieldObjects){(0,_util.warn)("_bindResetFormAction - \"resetForm\" action not supported, "+"ensure that the `fieldObjects` parameter is provided.");if(!otherClickAction){link.onclick=function(){return false}}return}link.onclick=function(){otherClickAction===null||otherClickAction===void 0||otherClickAction();var resetFormFields=resetForm.fields,resetFormRefs=resetForm.refs,include=resetForm.include;var allFields=[];if(resetFormFields.length!==0||resetFormRefs.length!==0){var fieldIds=new Set(resetFormRefs);var _iterator132=_createForOfIteratorHelper(resetFormFields),_step132;try{for(_iterator132.s();!(_step132=_iterator132.n()).done;){var fieldName=_step132.value;var _fields=_this110._fieldObjects[fieldName]||[];var _iterator134=_createForOfIteratorHelper(_fields),_step134;try{for(_iterator134.s();!(_step134=_iterator134.n()).done;){var _id15=_step134.value.id;fieldIds.add(_id15)}}catch(err){_iterator134.e(err)}finally{_iterator134.f()}}}catch(err){_iterator132.e(err)}finally{_iterator132.f()}for(var _i54=0,_Object$values=Object.values(_this110._fieldObjects);_i54<_Object$values.length;_i54++){var fields=_Object$values[_i54];var _iterator133=_createForOfIteratorHelper(fields),_step133;try{for(_iterator133.s();!(_step133=_iterator133.n()).done;){var field=_step133.value;if(fieldIds.has(field.id)===include){allFields.push(field)}}}catch(err){_iterator133.e(err)}finally{_iterator133.f()}}}else{for(var _i55=0,_Object$values2=Object.values(_this110._fieldObjects);_i55<_Object$values2.length;_i55++){var _fields2=_Object$values2[_i55];allFields.push.apply(allFields,_toConsumableArray2(_fields2))}}var storage=_this110.annotationStorage;var allIds=[];for(var _i56=0,_allFields=allFields;_i56<_allFields.length;_i56++){var _field=_allFields[_i56];var _id16=_field.id;allIds.push(_id16);switch(_field.type){case"text":{var value=_field.defaultValue||"";storage.setValue(_id16,{value:value});break}case"checkbox":case"radiobutton":{var _value2=_field.defaultValue===_field.exportValues;storage.setValue(_id16,{value:_value2});break}case"combobox":case"listbox":{var _value3=_field.defaultValue||"";storage.setValue(_id16,{value:_value3});break}default:continue}var domElement=document.querySelector("[data-element-id=\"".concat(_id16,"\"]"));if(!domElement){continue}else if(!GetElementsByNameSet.has(domElement)){(0,_util.warn)("_bindResetFormAction - element not allowed: ".concat(_id16));continue}domElement.dispatchEvent(new Event("resetform"))}if(_this110.enableScripting){var _this110$linkService$;(_this110$linkService$=_this110.linkService.eventBus)===null||_this110$linkService$===void 0||_this110$linkService$.dispatch("dispatcheventinsandbox",{source:_this110,detail:{id:"app",ids:allIds,name:"ResetForm"}})}return false}}}]);return LinkAnnotationElement}(AnnotationElement);function _setInternalLink2(){this.container.setAttribute("data-internal-link","")}function _bindSetOCGState2(link,action){var _this127=this;link.href=this.linkService.getAnchorUrl("");link.onclick=function(){_this127.linkService.executeSetOCGState(action);return false};_classPrivateMethodGet(this,_setInternalLink,_setInternalLink2).call(this)}var TextAnnotationElement=function(_AnnotationElement2){_inherits2(TextAnnotationElement,_AnnotationElement2);var _super41=_createSuper(TextAnnotationElement);function TextAnnotationElement(parameters){_classCallCheck2(this,TextAnnotationElement);return _super41.call(this,parameters,{isRenderable:true})}_createClass2(TextAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("textAnnotation");var image=document.createElement("img");image.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg";image.alt="[{{type}} Annotation]";image.dataset.l10nId="text_annotation_type";image.dataset.l10nArgs=JSON.stringify({type:this.data.name});if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.append(image);return this.container}}]);return TextAnnotationElement}(AnnotationElement);var WidgetAnnotationElement=function(_AnnotationElement3){_inherits2(WidgetAnnotationElement,_AnnotationElement3);var _super42=_createSuper(WidgetAnnotationElement);function WidgetAnnotationElement(){_classCallCheck2(this,WidgetAnnotationElement);return _super42.apply(this,arguments)}_createClass2(WidgetAnnotationElement,[{key:"render",value:function render(){if(this.data.alternativeText){this.container.title=this.data.alternativeText}return this.container}},{key:"showElementAndHideCanvas",value:function showElementAndHideCanvas(element){if(this.data.hasOwnCanvas){var _element$previousSibl;if(((_element$previousSibl=element.previousSibling)===null||_element$previousSibl===void 0?void 0:_element$previousSibl.nodeName)==="CANVAS"){element.previousSibling.hidden=true}element.hidden=false}}},{key:"_getKeyModifier",value:function _getKeyModifier(event){var _util$FeatureTest$pla=_util.FeatureTest.platform,isWin=_util$FeatureTest$pla.isWin,isMac=_util$FeatureTest$pla.isMac;return isWin&&event.ctrlKey||isMac&&event.metaKey}},{key:"_setEventListener",value:function _setEventListener(element,elementData,baseName,eventName,valueGetter){var _this111=this;if(baseName.includes("mouse")){element.addEventListener(baseName,function(event){var _this111$linkService$;(_this111$linkService$=_this111.linkService.eventBus)===null||_this111$linkService$===void 0||_this111$linkService$.dispatch("dispatcheventinsandbox",{source:_this111,detail:{id:_this111.data.id,name:eventName,value:valueGetter(event),shift:event.shiftKey,modifier:_this111._getKeyModifier(event)}})})}else{element.addEventListener(baseName,function(event){var _this111$linkService$2;if(baseName==="blur"){if(!elementData.focused||!event.relatedTarget){return}elementData.focused=false}else if(baseName==="focus"){if(elementData.focused){return}elementData.focused=true}if(!valueGetter){return}(_this111$linkService$2=_this111.linkService.eventBus)===null||_this111$linkService$2===void 0||_this111$linkService$2.dispatch("dispatcheventinsandbox",{source:_this111,detail:{id:_this111.data.id,name:eventName,value:valueGetter(event)}})})}}},{key:"_setEventListeners",value:function _setEventListeners(element,elementData,names,getter){var _iterator135=_createForOfIteratorHelper(names),_step135;try{for(_iterator135.s();!(_step135=_iterator135.n()).done;){var _this$data$actions;var _step135$value=_slicedToArray2(_step135.value,2),baseName=_step135$value[0],eventName=_step135$value[1];if(eventName==="Action"||(_this$data$actions=this.data.actions)!==null&&_this$data$actions!==void 0&&_this$data$actions[eventName]){var _this$data$actions2,_this$data$actions3;if(eventName==="Focus"||eventName==="Blur"){elementData||(elementData={focused:false})}this._setEventListener(element,elementData,baseName,eventName,getter);if(eventName==="Focus"&&!((_this$data$actions2=this.data.actions)!==null&&_this$data$actions2!==void 0&&_this$data$actions2.Blur)){this._setEventListener(element,elementData,"blur","Blur",null)}else if(eventName==="Blur"&&!((_this$data$actions3=this.data.actions)!==null&&_this$data$actions3!==void 0&&_this$data$actions3.Focus)){this._setEventListener(element,elementData,"focus","Focus",null)}}}}catch(err){_iterator135.e(err)}finally{_iterator135.f()}}},{key:"_setBackgroundColor",value:function _setBackgroundColor(element){var color=this.data.backgroundColor||null;element.style.backgroundColor=color===null?"transparent":_util.Util.makeHexColor(color[0],color[1],color[2])}},{key:"_setTextStyle",value:function _setTextStyle(element){var TEXT_ALIGNMENT=["left","center","right"];var fontColor=this.data.defaultAppearanceData.fontColor;var fontSize=this.data.defaultAppearanceData.fontSize||DEFAULT_FONT_SIZE;var style=element.style;var computedFontSize;var BORDER_SIZE=2;var roundToOneDecimal=function roundToOneDecimal(x){return Math.round(10*x)/10};if(this.data.multiLine){var height=Math.abs(this.data.rect[3]-this.data.rect[1]-BORDER_SIZE);var numberOfLines=Math.round(height/(_util.LINE_FACTOR*fontSize))||1;var lineHeight=height/numberOfLines;computedFontSize=Math.min(fontSize,roundToOneDecimal(lineHeight/_util.LINE_FACTOR))}else{var _height3=Math.abs(this.data.rect[3]-this.data.rect[1]-BORDER_SIZE);computedFontSize=Math.min(fontSize,roundToOneDecimal(_height3/_util.LINE_FACTOR))}style.fontSize="calc(".concat(computedFontSize,"px * var(--scale-factor))");style.color=_util.Util.makeHexColor(fontColor[0],fontColor[1],fontColor[2]);if(this.data.textAlignment!==null){style.textAlign=TEXT_ALIGNMENT[this.data.textAlignment]}}},{key:"_setRequired",value:function _setRequired(element,isRequired){if(isRequired){element.setAttribute("required",true)}else{element.removeAttribute("required")}element.setAttribute("aria-required",isRequired)}}]);return WidgetAnnotationElement}(AnnotationElement);var TextWidgetAnnotationElement=function(_WidgetAnnotationElem){_inherits2(TextWidgetAnnotationElement,_WidgetAnnotationElem);var _super43=_createSuper(TextWidgetAnnotationElement);function TextWidgetAnnotationElement(parameters){_classCallCheck2(this,TextWidgetAnnotationElement);var isRenderable=parameters.renderForms||!parameters.data.hasAppearance&&!!parameters.data.fieldValue;return _super43.call(this,parameters,{isRenderable:isRenderable})}_createClass2(TextWidgetAnnotationElement,[{key:"setPropertyOnSiblings",value:function setPropertyOnSiblings(base,key,value,keyInStorage){var storage=this.annotationStorage;var _iterator136=_createForOfIteratorHelper(this._getElementsByName(base.name,base.id)),_step136;try{for(_iterator136.s();!(_step136=_iterator136.n()).done;){var element=_step136.value;if(element.domElement){element.domElement[key]=value}storage.setValue(element.id,_defineProperty2({},keyInStorage,value))}}catch(err){_iterator136.e(err)}finally{_iterator136.f()}}},{key:"render",value:function render(){var _this112=this;var storage=this.annotationStorage;var id=this.data.id;this.container.classList.add("textWidgetAnnotation");var element=null;if(this.renderForms){var _this$data$textConten;var storedData=storage.getValue(id,{value:this.data.fieldValue});var textContent=storedData.value||"";var maxLen=storage.getValue(id,{charLimit:this.data.maxLen}).charLimit;if(maxLen&&textContent.length>maxLen){textContent=textContent.slice(0,maxLen)}var fieldFormattedValues=storedData.formattedValue||((_this$data$textConten=this.data.textContent)===null||_this$data$textConten===void 0?void 0:_this$data$textConten.join("\n"))||null;if(fieldFormattedValues&&this.data.comb){fieldFormattedValues=fieldFormattedValues.replaceAll(/\s+/g,"")}var elementData={userValue:textContent,formattedValue:fieldFormattedValues,lastCommittedValue:null,commitKey:1,focused:false};if(this.data.multiLine){var _fieldFormattedValues;element=document.createElement("textarea");element.textContent=(_fieldFormattedValues=fieldFormattedValues)!==null&&_fieldFormattedValues!==void 0?_fieldFormattedValues:textContent;if(this.data.doNotScroll){element.style.overflowY="hidden"}}else{var _fieldFormattedValues2;element=document.createElement("input");element.type="text";element.setAttribute("value",(_fieldFormattedValues2=fieldFormattedValues)!==null&&_fieldFormattedValues2!==void 0?_fieldFormattedValues2:textContent);if(this.data.doNotScroll){element.style.overflowX="hidden"}}if(this.data.hasOwnCanvas){element.hidden=true}GetElementsByNameSet.add(element);element.setAttribute("data-element-id",id);element.disabled=this.data.readOnly;element.name=this.data.fieldName;element.tabIndex=DEFAULT_TAB_INDEX;this._setRequired(element,this.data.required);if(maxLen){element.maxLength=maxLen}element.addEventListener("input",function(event){storage.setValue(id,{value:event.target.value});_this112.setPropertyOnSiblings(element,"value",event.target.value,"value");elementData.formattedValue=null});element.addEventListener("resetform",function(event){var _this112$data$default;var defaultValue=(_this112$data$default=_this112.data.defaultFieldValue)!==null&&_this112$data$default!==void 0?_this112$data$default:"";element.value=elementData.userValue=defaultValue;elementData.formattedValue=null});var blurListener=function blurListener(event){var formattedValue=elementData.formattedValue;if(formattedValue!==null&&formattedValue!==undefined){event.target.value=formattedValue}event.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var _this$data$actions4;element.addEventListener("focus",function(event){if(elementData.focused){return}var target=event.target;if(elementData.userValue){target.value=elementData.userValue}elementData.lastCommittedValue=target.value;elementData.commitKey=1;elementData.focused=true});element.addEventListener("updatefromsandbox",function(jsEvent){_this112.showElementAndHideCanvas(jsEvent.target);var actions={value:function value(event){var _event$detail$value;elementData.userValue=(_event$detail$value=event.detail.value)!==null&&_event$detail$value!==void 0?_event$detail$value:"";storage.setValue(id,{value:elementData.userValue.toString()});event.target.value=elementData.userValue},formattedValue:function formattedValue(event){var formattedValue=event.detail.formattedValue;elementData.formattedValue=formattedValue;if(formattedValue!==null&&formattedValue!==undefined&&event.target!==document.activeElement){event.target.value=formattedValue}storage.setValue(id,{formattedValue:formattedValue})},selRange:function selRange(event){var _event$target;(_event$target=event.target).setSelectionRange.apply(_event$target,_toConsumableArray2(event.detail.selRange))},charLimit:function charLimit(event){var _this112$linkService$;var charLimit=event.detail.charLimit;var target=event.target;if(charLimit===0){target.removeAttribute("maxLength");return}target.setAttribute("maxLength",charLimit);var value=elementData.userValue;if(!value||value.length<=charLimit){return}value=value.slice(0,charLimit);target.value=elementData.userValue=value;storage.setValue(id,{value:value});(_this112$linkService$=_this112.linkService.eventBus)===null||_this112$linkService$===void 0||_this112$linkService$.dispatch("dispatcheventinsandbox",{source:_this112,detail:{id:id,name:"Keystroke",value:value,willCommit:true,commitKey:1,selStart:target.selectionStart,selEnd:target.selectionEnd}})}};_this112._dispatchEventFromSandbox(actions,jsEvent)});element.addEventListener("keydown",function(event){var _this112$linkService$2;elementData.commitKey=1;var commitKey=-1;if(event.key==="Escape"){commitKey=0}else if(event.key==="Enter"&&!_this112.data.multiLine){commitKey=2}else if(event.key==="Tab"){elementData.commitKey=3}if(commitKey===-1){return}var value=event.target.value;if(elementData.lastCommittedValue===value){return}elementData.lastCommittedValue=value;elementData.userValue=value;(_this112$linkService$2=_this112.linkService.eventBus)===null||_this112$linkService$2===void 0||_this112$linkService$2.dispatch("dispatcheventinsandbox",{source:_this112,detail:{id:id,name:"Keystroke",value:value,willCommit:true,commitKey:commitKey,selStart:event.target.selectionStart,selEnd:event.target.selectionEnd}})});var _blurListener=blurListener;blurListener=null;element.addEventListener("blur",function(event){if(!elementData.focused||!event.relatedTarget){return}elementData.focused=false;var value=event.target.value;elementData.userValue=value;if(elementData.lastCommittedValue!==value){var _this112$linkService$3;(_this112$linkService$3=_this112.linkService.eventBus)===null||_this112$linkService$3===void 0||_this112$linkService$3.dispatch("dispatcheventinsandbox",{source:_this112,detail:{id:id,name:"Keystroke",value:value,willCommit:true,commitKey:elementData.commitKey,selStart:event.target.selectionStart,selEnd:event.target.selectionEnd}})}_blurListener(event)});if((_this$data$actions4=this.data.actions)!==null&&_this$data$actions4!==void 0&&_this$data$actions4.Keystroke){element.addEventListener("beforeinput",function(event){var _this112$linkService$4;elementData.lastCommittedValue=null;var data=event.data,target=event.target;var value=target.value,selectionStart=target.selectionStart,selectionEnd=target.selectionEnd;var selStart=selectionStart,selEnd=selectionEnd;switch(event.inputType){case"deleteWordBackward":{var match=value.substring(0,selectionStart).match(/\w*[^\w]*$/);if(match){selStart-=match[0].length}break}case"deleteWordForward":{var _match3=value.substring(selectionStart).match(/^[^\w]*\w*/);if(_match3){selEnd+=_match3[0].length}break}case"deleteContentBackward":if(selectionStart===selectionEnd){selStart-=1}break;case"deleteContentForward":if(selectionStart===selectionEnd){selEnd+=1}break}event.preventDefault();(_this112$linkService$4=_this112.linkService.eventBus)===null||_this112$linkService$4===void 0||_this112$linkService$4.dispatch("dispatcheventinsandbox",{source:_this112,detail:{id:id,name:"Keystroke",value:value,change:data||"",willCommit:false,selStart:selStart,selEnd:selEnd}})})}this._setEventListeners(element,elementData,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],function(event){return event.target.value})}if(blurListener){element.addEventListener("blur",blurListener)}if(this.data.comb){var fieldWidth=this.data.rect[2]-this.data.rect[0];var combWidth=fieldWidth/maxLen;element.classList.add("comb");element.style.letterSpacing="calc(".concat(combWidth,"px * var(--scale-factor) - 1ch)")}}else{element=document.createElement("div");element.textContent=this.data.fieldValue;element.style.verticalAlign="middle";element.style.display="table-cell"}this._setTextStyle(element);this._setBackgroundColor(element);this._setDefaultPropertiesFromJS(element);this.container.append(element);return this.container}}]);return TextWidgetAnnotationElement}(WidgetAnnotationElement);var SignatureWidgetAnnotationElement=function(_WidgetAnnotationElem2){_inherits2(SignatureWidgetAnnotationElement,_WidgetAnnotationElem2);var _super44=_createSuper(SignatureWidgetAnnotationElement);function SignatureWidgetAnnotationElement(parameters){_classCallCheck2(this,SignatureWidgetAnnotationElement);return _super44.call(this,parameters,{isRenderable:!!parameters.data.hasOwnCanvas})}return _createClass2(SignatureWidgetAnnotationElement)}(WidgetAnnotationElement);var CheckboxWidgetAnnotationElement=function(_WidgetAnnotationElem3){_inherits2(CheckboxWidgetAnnotationElement,_WidgetAnnotationElem3);var _super45=_createSuper(CheckboxWidgetAnnotationElement);function CheckboxWidgetAnnotationElement(parameters){_classCallCheck2(this,CheckboxWidgetAnnotationElement);return _super45.call(this,parameters,{isRenderable:parameters.renderForms})}_createClass2(CheckboxWidgetAnnotationElement,[{key:"render",value:function render(){var _this113=this;var storage=this.annotationStorage;var data=this.data;var id=data.id;var value=storage.getValue(id,{value:data.exportValue===data.fieldValue}).value;if(typeof value==="string"){value=value!=="Off";storage.setValue(id,{value:value})}this.container.classList.add("buttonWidgetAnnotation","checkBox");var element=document.createElement("input");GetElementsByNameSet.add(element);element.setAttribute("data-element-id",id);element.disabled=data.readOnly;this._setRequired(element,this.data.required);element.type="checkbox";element.name=data.fieldName;if(value){element.setAttribute("checked",true)}element.setAttribute("exportValue",data.exportValue);element.tabIndex=DEFAULT_TAB_INDEX;element.addEventListener("change",function(event){var _event$target2=event.target,name=_event$target2.name,checked=_event$target2.checked;var _iterator137=_createForOfIteratorHelper(_this113._getElementsByName(name,id)),_step137;try{for(_iterator137.s();!(_step137=_iterator137.n()).done;){var checkbox=_step137.value;var curChecked=checked&&checkbox.exportValue===data.exportValue;if(checkbox.domElement){checkbox.domElement.checked=curChecked}storage.setValue(checkbox.id,{value:curChecked})}}catch(err){_iterator137.e(err)}finally{_iterator137.f()}storage.setValue(id,{value:checked})});element.addEventListener("resetform",function(event){var defaultValue=data.defaultFieldValue||"Off";event.target.checked=defaultValue===data.exportValue});if(this.enableScripting&&this.hasJSActions){element.addEventListener("updatefromsandbox",function(jsEvent){var actions={value:function value(event){event.target.checked=event.detail.value!=="Off";storage.setValue(id,{value:event.target.checked})}};_this113._dispatchEventFromSandbox(actions,jsEvent)});this._setEventListeners(element,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],function(event){return event.target.checked})}this._setBackgroundColor(element);this._setDefaultPropertiesFromJS(element);this.container.append(element);return this.container}}]);return CheckboxWidgetAnnotationElement}(WidgetAnnotationElement);var RadioButtonWidgetAnnotationElement=function(_WidgetAnnotationElem4){_inherits2(RadioButtonWidgetAnnotationElement,_WidgetAnnotationElem4);var _super46=_createSuper(RadioButtonWidgetAnnotationElement);function RadioButtonWidgetAnnotationElement(parameters){_classCallCheck2(this,RadioButtonWidgetAnnotationElement);return _super46.call(this,parameters,{isRenderable:parameters.renderForms})}_createClass2(RadioButtonWidgetAnnotationElement,[{key:"render",value:function render(){var _this114=this;this.container.classList.add("buttonWidgetAnnotation","radioButton");var storage=this.annotationStorage;var data=this.data;var id=data.id;var value=storage.getValue(id,{value:data.fieldValue===data.buttonValue}).value;if(typeof value==="string"){value=value!==data.buttonValue;storage.setValue(id,{value:value})}var element=document.createElement("input");GetElementsByNameSet.add(element);element.setAttribute("data-element-id",id);element.disabled=data.readOnly;this._setRequired(element,this.data.required);element.type="radio";element.name=data.fieldName;if(value){element.setAttribute("checked",true)}element.tabIndex=DEFAULT_TAB_INDEX;element.addEventListener("change",function(event){var _event$target3=event.target,name=_event$target3.name,checked=_event$target3.checked;var _iterator138=_createForOfIteratorHelper(_this114._getElementsByName(name,id)),_step138;try{for(_iterator138.s();!(_step138=_iterator138.n()).done;){var radio=_step138.value;storage.setValue(radio.id,{value:false})}}catch(err){_iterator138.e(err)}finally{_iterator138.f()}storage.setValue(id,{value:checked})});element.addEventListener("resetform",function(event){var defaultValue=data.defaultFieldValue;event.target.checked=defaultValue!==null&&defaultValue!==undefined&&defaultValue===data.buttonValue});if(this.enableScripting&&this.hasJSActions){var pdfButtonValue=data.buttonValue;element.addEventListener("updatefromsandbox",function(jsEvent){var actions={value:function value(event){var checked=pdfButtonValue===event.detail.value;var _iterator139=_createForOfIteratorHelper(_this114._getElementsByName(event.target.name)),_step139;try{for(_iterator139.s();!(_step139=_iterator139.n()).done;){var radio=_step139.value;var curChecked=checked&&radio.id===id;if(radio.domElement){radio.domElement.checked=curChecked}storage.setValue(radio.id,{value:curChecked})}}catch(err){_iterator139.e(err)}finally{_iterator139.f()}}};_this114._dispatchEventFromSandbox(actions,jsEvent)});this._setEventListeners(element,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],function(event){return event.target.checked})}this._setBackgroundColor(element);this._setDefaultPropertiesFromJS(element);this.container.append(element);return this.container}}]);return RadioButtonWidgetAnnotationElement}(WidgetAnnotationElement);var PushButtonWidgetAnnotationElement=function(_LinkAnnotationElemen){_inherits2(PushButtonWidgetAnnotationElement,_LinkAnnotationElemen);var _super47=_createSuper(PushButtonWidgetAnnotationElement);function PushButtonWidgetAnnotationElement(parameters){_classCallCheck2(this,PushButtonWidgetAnnotationElement);return _super47.call(this,parameters,{ignoreBorder:parameters.data.hasAppearance})}_createClass2(PushButtonWidgetAnnotationElement,[{key:"render",value:function render(){var _this115=this;var container=_get5(_getPrototypeOf(PushButtonWidgetAnnotationElement.prototype),"render",this).call(this);container.classList.add("buttonWidgetAnnotation","pushButton");if(this.data.alternativeText){container.title=this.data.alternativeText}var linkElement=container.lastChild;if(this.enableScripting&&this.hasJSActions&&linkElement){this._setDefaultPropertiesFromJS(linkElement);linkElement.addEventListener("updatefromsandbox",function(jsEvent){_this115._dispatchEventFromSandbox({},jsEvent)})}return container}}]);return PushButtonWidgetAnnotationElement}(LinkAnnotationElement);var ChoiceWidgetAnnotationElement=function(_WidgetAnnotationElem5){_inherits2(ChoiceWidgetAnnotationElement,_WidgetAnnotationElem5);var _super48=_createSuper(ChoiceWidgetAnnotationElement);function ChoiceWidgetAnnotationElement(parameters){_classCallCheck2(this,ChoiceWidgetAnnotationElement);return _super48.call(this,parameters,{isRenderable:parameters.renderForms})}_createClass2(ChoiceWidgetAnnotationElement,[{key:"render",value:function render(){var _this116=this;this.container.classList.add("choiceWidgetAnnotation");var storage=this.annotationStorage;var id=this.data.id;var storedData=storage.getValue(id,{value:this.data.fieldValue});var selectElement=document.createElement("select");GetElementsByNameSet.add(selectElement);selectElement.setAttribute("data-element-id",id);selectElement.disabled=this.data.readOnly;this._setRequired(selectElement,this.data.required);selectElement.name=this.data.fieldName;selectElement.tabIndex=DEFAULT_TAB_INDEX;var addAnEmptyEntry=this.data.combo&&this.data.options.length>0;if(!this.data.combo){selectElement.size=this.data.options.length;if(this.data.multiSelect){selectElement.multiple=true}}selectElement.addEventListener("resetform",function(event){var defaultValue=_this116.data.defaultFieldValue;var _iterator140=_createForOfIteratorHelper(selectElement.options),_step140;try{for(_iterator140.s();!(_step140=_iterator140.n()).done;){var option=_step140.value;option.selected=option.value===defaultValue}}catch(err){_iterator140.e(err)}finally{_iterator140.f()}});var _iterator141=_createForOfIteratorHelper(this.data.options),_step141;try{for(_iterator141.s();!(_step141=_iterator141.n()).done;){var option=_step141.value;var optionElement=document.createElement("option");optionElement.textContent=option.displayValue;optionElement.value=option.exportValue;if(storedData.value.includes(option.exportValue)){optionElement.setAttribute("selected",true);addAnEmptyEntry=false}selectElement.append(optionElement)}}catch(err){_iterator141.e(err)}finally{_iterator141.f()}var _removeEmptyEntry=null;if(addAnEmptyEntry){var noneOptionElement=document.createElement("option");noneOptionElement.value=" ";noneOptionElement.setAttribute("hidden",true);noneOptionElement.setAttribute("selected",true);selectElement.prepend(noneOptionElement);_removeEmptyEntry=function removeEmptyEntry(){noneOptionElement.remove();selectElement.removeEventListener("input",_removeEmptyEntry);_removeEmptyEntry=null};selectElement.addEventListener("input",_removeEmptyEntry)}var getValue=function getValue(isExport){var name=isExport?"value":"textContent";var options=selectElement.options,multiple=selectElement.multiple;if(!multiple){return options.selectedIndex===-1?null:options[options.selectedIndex][name]}return Array.prototype.filter.call(options,function(option){return option.selected}).map(function(option){return option[name]})};var selectedValues=getValue(false);var getItems=function getItems(event){var options=event.target.options;return Array.prototype.map.call(options,function(option){return{displayValue:option.textContent,exportValue:option.value}})};if(this.enableScripting&&this.hasJSActions){selectElement.addEventListener("updatefromsandbox",function(jsEvent){var actions={value:function value(event){var _removeEmptyEntry2;(_removeEmptyEntry2=_removeEmptyEntry)===null||_removeEmptyEntry2===void 0||_removeEmptyEntry2();var value=event.detail.value;var values=new Set(Array.isArray(value)?value:[value]);var _iterator142=_createForOfIteratorHelper(selectElement.options),_step142;try{for(_iterator142.s();!(_step142=_iterator142.n()).done;){var option=_step142.value;option.selected=values.has(option.value)}}catch(err){_iterator142.e(err)}finally{_iterator142.f()}storage.setValue(id,{value:getValue(true)});selectedValues=getValue(false)},multipleSelection:function multipleSelection(event){selectElement.multiple=true},remove:function remove(event){var options=selectElement.options;var index=event.detail.remove;options[index].selected=false;selectElement.remove(index);if(options.length>0){var _i57=Array.prototype.findIndex.call(options,function(option){return option.selected});if(_i57===-1){options[0].selected=true}}storage.setValue(id,{value:getValue(true),items:getItems(event)});selectedValues=getValue(false)},clear:function clear(event){while(selectElement.length!==0){selectElement.remove(0)}storage.setValue(id,{value:null,items:[]});selectedValues=getValue(false)},insert:function insert(event){var _event$detail$insert=event.detail.insert,index=_event$detail$insert.index,displayValue=_event$detail$insert.displayValue,exportValue=_event$detail$insert.exportValue;var selectChild=selectElement.children[index];var optionElement=document.createElement("option");optionElement.textContent=displayValue;optionElement.value=exportValue;if(selectChild){selectChild.before(optionElement)}else{selectElement.append(optionElement)}storage.setValue(id,{value:getValue(true),items:getItems(event)});selectedValues=getValue(false)},items:function items(event){var items=event.detail.items;while(selectElement.length!==0){selectElement.remove(0)}var _iterator143=_createForOfIteratorHelper(items),_step143;try{for(_iterator143.s();!(_step143=_iterator143.n()).done;){var item=_step143.value;var displayValue=item.displayValue,exportValue=item.exportValue;var optionElement=document.createElement("option");optionElement.textContent=displayValue;optionElement.value=exportValue;selectElement.append(optionElement)}}catch(err){_iterator143.e(err)}finally{_iterator143.f()}if(selectElement.options.length>0){selectElement.options[0].selected=true}storage.setValue(id,{value:getValue(true),items:getItems(event)});selectedValues=getValue(false)},indices:function indices(event){var indices=new Set(event.detail.indices);var _iterator144=_createForOfIteratorHelper(event.target.options),_step144;try{for(_iterator144.s();!(_step144=_iterator144.n()).done;){var option=_step144.value;option.selected=indices.has(option.index)}}catch(err){_iterator144.e(err)}finally{_iterator144.f()}storage.setValue(id,{value:getValue(true)});selectedValues=getValue(false)},editable:function editable(event){event.target.disabled=!event.detail.editable}};_this116._dispatchEventFromSandbox(actions,jsEvent)});selectElement.addEventListener("input",function(event){var _this116$linkService$;var exportValue=getValue(true);storage.setValue(id,{value:exportValue});event.preventDefault();(_this116$linkService$=_this116.linkService.eventBus)===null||_this116$linkService$===void 0||_this116$linkService$.dispatch("dispatcheventinsandbox",{source:_this116,detail:{id:id,name:"Keystroke",value:selectedValues,changeEx:exportValue,willCommit:false,commitKey:1,keyDown:false}})});this._setEventListeners(selectElement,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],function(event){return event.target.value})}else{selectElement.addEventListener("input",function(event){storage.setValue(id,{value:getValue(true)})})}if(this.data.combo){this._setTextStyle(selectElement)}this._setBackgroundColor(selectElement);this._setDefaultPropertiesFromJS(selectElement);this.container.append(selectElement);return this.container}}]);return ChoiceWidgetAnnotationElement}(WidgetAnnotationElement);var PopupAnnotationElement=function(_AnnotationElement4){_inherits2(PopupAnnotationElement,_AnnotationElement4);var _super49=_createSuper(PopupAnnotationElement);function PopupAnnotationElement(parameters){var _this117;_classCallCheck2(this,PopupAnnotationElement);var data=parameters.data,elements=parameters.elements;_this117=_super49.call(this,parameters,{isRenderable:AnnotationElement._hasPopupData(data)});_this117.elements=elements;return _this117}_createClass2(PopupAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("popupAnnotation");var popup=new PopupElement({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open});var elementIds=[];var _iterator145=_createForOfIteratorHelper(this.elements),_step145;try{for(_iterator145.s();!(_step145=_iterator145.n()).done;){var element=_step145.value;element.popup=popup;elementIds.push(element.data.id);element.addHighlightArea()}}catch(err){_iterator145.e(err)}finally{_iterator145.f()}this.container.setAttribute("aria-controls",elementIds.map(function(id){return"".concat(_util.AnnotationPrefix).concat(id)}).join(","));return this.container}}]);return PopupAnnotationElement}(AnnotationElement);var _dateTimePromise=new WeakMap;var _boundKeyDown=new WeakMap;var _boundHide=new WeakMap;var _boundShow=new WeakMap;var _boundToggle=new WeakMap;var _color2=new WeakMap;var _container2=new WeakMap;var _contentsObj=new WeakMap;var _elements=new WeakMap;var _parent2=new WeakMap;var _parentRect=new WeakMap;var _pinned=new WeakMap;var _popup=new WeakMap;var _rect2=new WeakMap;var _richText=new WeakMap;var _titleObj=new WeakMap;var _wasVisible=new WeakMap;var _keyDown=new WeakSet;var _toggle=new WeakSet;var _show=new WeakSet;var _hide=new WeakSet;var PopupElement=function(){function PopupElement(_ref91){var container=_ref91.container,color=_ref91.color,elements=_ref91.elements,titleObj=_ref91.titleObj,modificationDate=_ref91.modificationDate,contentsObj=_ref91.contentsObj,richText=_ref91.richText,parent=_ref91.parent,rect=_ref91.rect,parentRect=_ref91.parentRect,open=_ref91.open;_classCallCheck2(this,PopupElement);_classPrivateMethodInitSpec(this,_hide);_classPrivateMethodInitSpec(this,_show);_classPrivateMethodInitSpec(this,_toggle);_classPrivateMethodInitSpec(this,_keyDown);_classPrivateFieldInitSpec(this,_dateTimePromise,{writable:true,value:null});_classPrivateFieldInitSpec(this,_boundKeyDown,{writable:true,value:_classPrivateMethodGet(this,_keyDown,_keyDown2).bind(this)});_classPrivateFieldInitSpec(this,_boundHide,{writable:true,value:_classPrivateMethodGet(this,_hide,_hide2).bind(this)});_classPrivateFieldInitSpec(this,_boundShow,{writable:true,value:_classPrivateMethodGet(this,_show,_show2).bind(this)});_classPrivateFieldInitSpec(this,_boundToggle,{writable:true,value:_classPrivateMethodGet(this,_toggle,_toggle2).bind(this)});_classPrivateFieldInitSpec(this,_color2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_container2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_contentsObj,{writable:true,value:null});_classPrivateFieldInitSpec(this,_elements,{writable:true,value:null});_classPrivateFieldInitSpec(this,_parent2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_parentRect,{writable:true,value:null});_classPrivateFieldInitSpec(this,_pinned,{writable:true,value:false});_classPrivateFieldInitSpec(this,_popup,{writable:true,value:null});_classPrivateFieldInitSpec(this,_rect2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_richText,{writable:true,value:null});_classPrivateFieldInitSpec(this,_titleObj,{writable:true,value:null});_classPrivateFieldInitSpec(this,_wasVisible,{writable:true,value:false});_classPrivateFieldSet(this,_container2,container);_classPrivateFieldSet(this,_titleObj,titleObj);_classPrivateFieldSet(this,_contentsObj,contentsObj);_classPrivateFieldSet(this,_richText,richText);_classPrivateFieldSet(this,_parent2,parent);_classPrivateFieldSet(this,_color2,color);_classPrivateFieldSet(this,_rect2,rect);_classPrivateFieldSet(this,_parentRect,parentRect);_classPrivateFieldSet(this,_elements,elements);var dateObject=_display_utils.PDFDateString.toDateObject(modificationDate);if(dateObject){_classPrivateFieldSet(this,_dateTimePromise,parent.l10n.get("annotation_date_string",{date:dateObject.toLocaleDateString(),time:dateObject.toLocaleTimeString()}))}this.trigger=elements.flatMap(function(e){return e.getElementsToTriggerPopup()});var _iterator146=_createForOfIteratorHelper(this.trigger),_step146;try{for(_iterator146.s();!(_step146=_iterator146.n()).done;){var element=_step146.value;element.addEventListener("click",_classPrivateFieldGet(this,_boundToggle));element.addEventListener("mouseenter",_classPrivateFieldGet(this,_boundShow));element.addEventListener("mouseleave",_classPrivateFieldGet(this,_boundHide));element.classList.add("popupTriggerArea")}}catch(err){_iterator146.e(err)}finally{_iterator146.f()}var _iterator147=_createForOfIteratorHelper(elements),_step147;try{for(_iterator147.s();!(_step147=_iterator147.n()).done;){var _element$container;var _element=_step147.value;(_element$container=_element.container)===null||_element$container===void 0||_element$container.addEventListener("keydown",_classPrivateFieldGet(this,_boundKeyDown))}}catch(err){_iterator147.e(err)}finally{_iterator147.f()}_classPrivateFieldGet(this,_container2).hidden=true;if(open){_classPrivateMethodGet(this,_toggle,_toggle2).call(this)}}_createClass2(PopupElement,[{key:"render",value:function render(){if(_classPrivateFieldGet(this,_popup)){return}var _classPrivateFieldGet28=_classPrivateFieldGet(this,_parent2),view=_classPrivateFieldGet28.page.view,_classPrivateFieldGet29=_classPrivateFieldGet28.viewport.rawDims,pageWidth=_classPrivateFieldGet29.pageWidth,pageHeight=_classPrivateFieldGet29.pageHeight,pageX=_classPrivateFieldGet29.pageX,pageY=_classPrivateFieldGet29.pageY;var popup=_classPrivateFieldSet(this,_popup,document.createElement("div"));popup.className="popup";if(_classPrivateFieldGet(this,_color2)){var _util$Util6;var baseColor=popup.style.outlineColor=(_util$Util6=_util.Util).makeHexColor.apply(_util$Util6,_toConsumableArray2(_classPrivateFieldGet(this,_color2)));if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)")){popup.style.backgroundColor="color-mix(in srgb, ".concat(baseColor," 30%, white)")}else{var _util$Util7;var BACKGROUND_ENLIGHT=0.7;popup.style.backgroundColor=(_util$Util7=_util.Util).makeHexColor.apply(_util$Util7,_toConsumableArray2(_classPrivateFieldGet(this,_color2).map(function(c){return Math.floor(BACKGROUND_ENLIGHT*(255-c)+c)})))}}var header=document.createElement("span");header.className="header";var title=document.createElement("h1");header.append(title);var _classPrivateFieldGet30=_classPrivateFieldGet(this,_titleObj);title.dir=_classPrivateFieldGet30.dir;title.textContent=_classPrivateFieldGet30.str;popup.append(header);if(_classPrivateFieldGet(this,_dateTimePromise)){var modificationDate=document.createElement("span");modificationDate.classList.add("popupDate");_classPrivateFieldGet(this,_dateTimePromise).then(function(localized){modificationDate.textContent=localized});header.append(modificationDate)}var contentsObj=_classPrivateFieldGet(this,_contentsObj);var richText=_classPrivateFieldGet(this,_richText);if(richText!==null&&richText!==void 0&&richText.str&&(!(contentsObj!==null&&contentsObj!==void 0&&contentsObj.str)||contentsObj.str===richText.str)){_xfa_layer.XfaLayer.render({xfaHtml:richText.html,intent:"richText",div:popup});popup.lastChild.classList.add("richText","popupContent")}else{var contents=this._formatContents(contentsObj);popup.append(contents)}var useParentRect=!!_classPrivateFieldGet(this,_parentRect);var rect=useParentRect?_classPrivateFieldGet(this,_parentRect):_classPrivateFieldGet(this,_rect2);var _iterator148=_createForOfIteratorHelper(_classPrivateFieldGet(this,_elements)),_step148;try{for(_iterator148.s();!(_step148=_iterator148.n()).done;){var element=_step148.value;if(!rect||_util.Util.intersect(element.data.rect,rect)!==null){rect=element.data.rect;useParentRect=true;break}}}catch(err){_iterator148.e(err)}finally{_iterator148.f()}var normalizedRect=_util.Util.normalizeRect([rect[0],view[3]-rect[1]+view[1],rect[2],view[3]-rect[3]+view[1]]);var HORIZONTAL_SPACE_AFTER_ANNOTATION=5;var parentWidth=useParentRect?rect[2]-rect[0]+HORIZONTAL_SPACE_AFTER_ANNOTATION:0;var popupLeft=normalizedRect[0]+parentWidth;var popupTop=normalizedRect[1];var _classPrivateFieldGet31=_classPrivateFieldGet(this,_container2),style=_classPrivateFieldGet31.style;style.left="".concat(100*(popupLeft-pageX)/pageWidth,"%");style.top="".concat(100*(popupTop-pageY)/pageHeight,"%");_classPrivateFieldGet(this,_container2).append(popup)}},{key:"_formatContents",value:function _formatContents(_ref92){var str=_ref92.str,dir=_ref92.dir;var p=document.createElement("p");p.classList.add("popupContent");p.dir=dir;var lines=str.split(/(?:\r\n?|\n)/);for(var _i58=0,ii=lines.length;_i58<ii;++_i58){var line=lines[_i58];p.append(document.createTextNode(line));if(_i58<ii-1){p.append(document.createElement("br"))}}return p}},{key:"forceHide",value:function forceHide(){_classPrivateFieldSet(this,_wasVisible,this.isVisible);if(!_classPrivateFieldGet(this,_wasVisible)){return}_classPrivateFieldGet(this,_container2).hidden=true}},{key:"maybeShow",value:function maybeShow(){if(!_classPrivateFieldGet(this,_wasVisible)){return}_classPrivateFieldSet(this,_wasVisible,false);_classPrivateFieldGet(this,_container2).hidden=false}},{key:"isVisible",get:function get(){return _classPrivateFieldGet(this,_container2).hidden===false}}]);return PopupElement}();function _keyDown2(event){if(event.altKey||event.shiftKey||event.ctrlKey||event.metaKey){return}if(event.key==="Enter"||event.key==="Escape"&&_classPrivateFieldGet(this,_pinned)){_classPrivateMethodGet(this,_toggle,_toggle2).call(this)}}function _toggle2(){_classPrivateFieldSet(this,_pinned,!_classPrivateFieldGet(this,_pinned));if(_classPrivateFieldGet(this,_pinned)){_classPrivateMethodGet(this,_show,_show2).call(this);_classPrivateFieldGet(this,_container2).addEventListener("click",_classPrivateFieldGet(this,_boundToggle));_classPrivateFieldGet(this,_container2).addEventListener("keydown",_classPrivateFieldGet(this,_boundKeyDown))}else{_classPrivateMethodGet(this,_hide,_hide2).call(this);_classPrivateFieldGet(this,_container2).removeEventListener("click",_classPrivateFieldGet(this,_boundToggle));_classPrivateFieldGet(this,_container2).removeEventListener("keydown",_classPrivateFieldGet(this,_boundKeyDown))}}function _show2(){if(!_classPrivateFieldGet(this,_popup)){this.render()}if(!this.isVisible){_classPrivateFieldGet(this,_container2).hidden=false;_classPrivateFieldGet(this,_container2).style.zIndex=parseInt(_classPrivateFieldGet(this,_container2).style.zIndex)+1000}else if(_classPrivateFieldGet(this,_pinned)){_classPrivateFieldGet(this,_container2).classList.add("focused")}}function _hide2(){_classPrivateFieldGet(this,_container2).classList.remove("focused");if(_classPrivateFieldGet(this,_pinned)||!this.isVisible){return}_classPrivateFieldGet(this,_container2).hidden=true;_classPrivateFieldGet(this,_container2).style.zIndex=parseInt(_classPrivateFieldGet(this,_container2).style.zIndex)-1000}var FreeTextAnnotationElement=function(_AnnotationElement5){_inherits2(FreeTextAnnotationElement,_AnnotationElement5);var _super50=_createSuper(FreeTextAnnotationElement);function FreeTextAnnotationElement(parameters){var _this118;_classCallCheck2(this,FreeTextAnnotationElement);_this118=_super50.call(this,parameters,{isRenderable:true,ignoreBorder:true});_this118.textContent=parameters.data.textContent;_this118.textPosition=parameters.data.textPosition;_this118.annotationEditorType=_util.AnnotationEditorType.FREETEXT;return _this118}_createClass2(FreeTextAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("freeTextAnnotation");if(this.textContent){var _content3=document.createElement("div");_content3.classList.add("annotationTextContent");_content3.setAttribute("role","comment");var _iterator149=_createForOfIteratorHelper(this.textContent),_step149;try{for(_iterator149.s();!(_step149=_iterator149.n()).done;){var line=_step149.value;var lineSpan=document.createElement("span");lineSpan.textContent=line;_content3.append(lineSpan)}}catch(err){_iterator149.e(err)}finally{_iterator149.f()}this.container.append(_content3)}if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this._editOnDoubleClick();return this.container}}]);return FreeTextAnnotationElement}(AnnotationElement);exports.FreeTextAnnotationElement=FreeTextAnnotationElement;var _line=new WeakMap;var LineAnnotationElement=function(_AnnotationElement6){_inherits2(LineAnnotationElement,_AnnotationElement6);var _super51=_createSuper(LineAnnotationElement);function LineAnnotationElement(parameters){var _this119;_classCallCheck2(this,LineAnnotationElement);_this119=_super51.call(this,parameters,{isRenderable:true,ignoreBorder:true});_classPrivateFieldInitSpec(_assertThisInitialized(_this119),_line,{writable:true,value:null});return _this119}_createClass2(LineAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("lineAnnotation");var data=this.data;var _getRectDims3=getRectDims(data.rect),width=_getRectDims3.width,height=_getRectDims3.height;var svg=this.svgFactory.create(width,height,true);var line=_classPrivateFieldSet(this,_line,this.svgFactory.createElement("svg:line"));line.setAttribute("x1",data.rect[2]-data.lineCoordinates[0]);line.setAttribute("y1",data.rect[3]-data.lineCoordinates[1]);line.setAttribute("x2",data.rect[2]-data.lineCoordinates[2]);line.setAttribute("y2",data.rect[3]-data.lineCoordinates[3]);line.setAttribute("stroke-width",data.borderStyle.width||1);line.setAttribute("stroke","transparent");line.setAttribute("fill","transparent");svg.append(line);this.container.append(svg);if(!data.popupRef&&this.hasPopupData){this._createPopup()}return this.container}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(this,_line)}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea")}}]);return LineAnnotationElement}(AnnotationElement);var _square=new WeakMap;var SquareAnnotationElement=function(_AnnotationElement7){_inherits2(SquareAnnotationElement,_AnnotationElement7);var _super52=_createSuper(SquareAnnotationElement);function SquareAnnotationElement(parameters){var _this120;_classCallCheck2(this,SquareAnnotationElement);_this120=_super52.call(this,parameters,{isRenderable:true,ignoreBorder:true});_classPrivateFieldInitSpec(_assertThisInitialized(_this120),_square,{writable:true,value:null});return _this120}_createClass2(SquareAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("squareAnnotation");var data=this.data;var _getRectDims4=getRectDims(data.rect),width=_getRectDims4.width,height=_getRectDims4.height;var svg=this.svgFactory.create(width,height,true);var borderWidth=data.borderStyle.width;var square=_classPrivateFieldSet(this,_square,this.svgFactory.createElement("svg:rect"));square.setAttribute("x",borderWidth/2);square.setAttribute("y",borderWidth/2);square.setAttribute("width",width-borderWidth);square.setAttribute("height",height-borderWidth);square.setAttribute("stroke-width",borderWidth||1);square.setAttribute("stroke","transparent");square.setAttribute("fill","transparent");svg.append(square);this.container.append(svg);if(!data.popupRef&&this.hasPopupData){this._createPopup()}return this.container}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(this,_square)}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea")}}]);return SquareAnnotationElement}(AnnotationElement);var _circle=new WeakMap;var CircleAnnotationElement=function(_AnnotationElement8){_inherits2(CircleAnnotationElement,_AnnotationElement8);var _super53=_createSuper(CircleAnnotationElement);function CircleAnnotationElement(parameters){var _this121;_classCallCheck2(this,CircleAnnotationElement);_this121=_super53.call(this,parameters,{isRenderable:true,ignoreBorder:true});_classPrivateFieldInitSpec(_assertThisInitialized(_this121),_circle,{writable:true,value:null});return _this121}_createClass2(CircleAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("circleAnnotation");var data=this.data;var _getRectDims5=getRectDims(data.rect),width=_getRectDims5.width,height=_getRectDims5.height;var svg=this.svgFactory.create(width,height,true);var borderWidth=data.borderStyle.width;var circle=_classPrivateFieldSet(this,_circle,this.svgFactory.createElement("svg:ellipse"));circle.setAttribute("cx",width/2);circle.setAttribute("cy",height/2);circle.setAttribute("rx",width/2-borderWidth/2);circle.setAttribute("ry",height/2-borderWidth/2);circle.setAttribute("stroke-width",borderWidth||1);circle.setAttribute("stroke","transparent");circle.setAttribute("fill","transparent");svg.append(circle);this.container.append(svg);if(!data.popupRef&&this.hasPopupData){this._createPopup()}return this.container}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(this,_circle)}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea")}}]);return CircleAnnotationElement}(AnnotationElement);var _polyline=new WeakMap;var PolylineAnnotationElement=function(_AnnotationElement9){_inherits2(PolylineAnnotationElement,_AnnotationElement9);var _super54=_createSuper(PolylineAnnotationElement);function PolylineAnnotationElement(parameters){var _this122;_classCallCheck2(this,PolylineAnnotationElement);_this122=_super54.call(this,parameters,{isRenderable:true,ignoreBorder:true});_classPrivateFieldInitSpec(_assertThisInitialized(_this122),_polyline,{writable:true,value:null});_this122.containerClassName="polylineAnnotation";_this122.svgElementName="svg:polyline";return _this122}_createClass2(PolylineAnnotationElement,[{key:"render",value:function render(){this.container.classList.add(this.containerClassName);var data=this.data;var _getRectDims6=getRectDims(data.rect),width=_getRectDims6.width,height=_getRectDims6.height;var svg=this.svgFactory.create(width,height,true);var points=[];var _iterator150=_createForOfIteratorHelper(data.vertices),_step150;try{for(_iterator150.s();!(_step150=_iterator150.n()).done;){var coordinate=_step150.value;var x=coordinate.x-data.rect[0];var y=data.rect[3]-coordinate.y;points.push(x+","+y)}}catch(err){_iterator150.e(err)}finally{_iterator150.f()}points=points.join(" ");var polyline=_classPrivateFieldSet(this,_polyline,this.svgFactory.createElement(this.svgElementName));polyline.setAttribute("points",points);polyline.setAttribute("stroke-width",data.borderStyle.width||1);polyline.setAttribute("stroke","transparent");polyline.setAttribute("fill","transparent");svg.append(polyline);this.container.append(svg);if(!data.popupRef&&this.hasPopupData){this._createPopup()}return this.container}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(this,_polyline)}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea")}}]);return PolylineAnnotationElement}(AnnotationElement);var PolygonAnnotationElement=function(_PolylineAnnotationEl){_inherits2(PolygonAnnotationElement,_PolylineAnnotationEl);var _super55=_createSuper(PolygonAnnotationElement);function PolygonAnnotationElement(parameters){var _this123;_classCallCheck2(this,PolygonAnnotationElement);_this123=_super55.call(this,parameters);_this123.containerClassName="polygonAnnotation";_this123.svgElementName="svg:polygon";return _this123}return _createClass2(PolygonAnnotationElement)}(PolylineAnnotationElement);var CaretAnnotationElement=function(_AnnotationElement10){_inherits2(CaretAnnotationElement,_AnnotationElement10);var _super56=_createSuper(CaretAnnotationElement);function CaretAnnotationElement(parameters){_classCallCheck2(this,CaretAnnotationElement);return _super56.call(this,parameters,{isRenderable:true,ignoreBorder:true})}_createClass2(CaretAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("caretAnnotation");if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}return this.container}}]);return CaretAnnotationElement}(AnnotationElement);var _polylines=new WeakMap;var InkAnnotationElement=function(_AnnotationElement11){_inherits2(InkAnnotationElement,_AnnotationElement11);var _super57=_createSuper(InkAnnotationElement);function InkAnnotationElement(parameters){var _this124;_classCallCheck2(this,InkAnnotationElement);_this124=_super57.call(this,parameters,{isRenderable:true,ignoreBorder:true});_classPrivateFieldInitSpec(_assertThisInitialized(_this124),_polylines,{writable:true,value:[]});_this124.containerClassName="inkAnnotation";_this124.svgElementName="svg:polyline";_this124.annotationEditorType=_util.AnnotationEditorType.INK;return _this124}_createClass2(InkAnnotationElement,[{key:"render",value:function render(){this.container.classList.add(this.containerClassName);var data=this.data;var _getRectDims7=getRectDims(data.rect),width=_getRectDims7.width,height=_getRectDims7.height;var svg=this.svgFactory.create(width,height,true);var _iterator151=_createForOfIteratorHelper(data.inkLists),_step151;try{for(_iterator151.s();!(_step151=_iterator151.n()).done;){var inkList=_step151.value;var points=[];var _iterator152=_createForOfIteratorHelper(inkList),_step152;try{for(_iterator152.s();!(_step152=_iterator152.n()).done;){var coordinate=_step152.value;var x=coordinate.x-data.rect[0];var y=data.rect[3]-coordinate.y;points.push("".concat(x,",").concat(y))}}catch(err){_iterator152.e(err)}finally{_iterator152.f()}points=points.join(" ");var polyline=this.svgFactory.createElement(this.svgElementName);_classPrivateFieldGet(this,_polylines).push(polyline);polyline.setAttribute("points",points);polyline.setAttribute("stroke-width",data.borderStyle.width||1);polyline.setAttribute("stroke","transparent");polyline.setAttribute("fill","transparent");if(!data.popupRef&&this.hasPopupData){this._createPopup()}svg.append(polyline)}}catch(err){_iterator151.e(err)}finally{_iterator151.f()}this.container.append(svg);return this.container}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(this,_polylines)}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea")}}]);return InkAnnotationElement}(AnnotationElement);exports.InkAnnotationElement=InkAnnotationElement;var HighlightAnnotationElement=function(_AnnotationElement12){_inherits2(HighlightAnnotationElement,_AnnotationElement12);var _super58=_createSuper(HighlightAnnotationElement);function HighlightAnnotationElement(parameters){_classCallCheck2(this,HighlightAnnotationElement);return _super58.call(this,parameters,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}_createClass2(HighlightAnnotationElement,[{key:"render",value:function render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("highlightAnnotation");return this.container}}]);return HighlightAnnotationElement}(AnnotationElement);var UnderlineAnnotationElement=function(_AnnotationElement13){_inherits2(UnderlineAnnotationElement,_AnnotationElement13);var _super59=_createSuper(UnderlineAnnotationElement);function UnderlineAnnotationElement(parameters){_classCallCheck2(this,UnderlineAnnotationElement);return _super59.call(this,parameters,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}_createClass2(UnderlineAnnotationElement,[{key:"render",value:function render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("underlineAnnotation");return this.container}}]);return UnderlineAnnotationElement}(AnnotationElement);var SquigglyAnnotationElement=function(_AnnotationElement14){_inherits2(SquigglyAnnotationElement,_AnnotationElement14);var _super60=_createSuper(SquigglyAnnotationElement);function SquigglyAnnotationElement(parameters){_classCallCheck2(this,SquigglyAnnotationElement);return _super60.call(this,parameters,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}_createClass2(SquigglyAnnotationElement,[{key:"render",value:function render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("squigglyAnnotation");return this.container}}]);return SquigglyAnnotationElement}(AnnotationElement);var StrikeOutAnnotationElement=function(_AnnotationElement15){_inherits2(StrikeOutAnnotationElement,_AnnotationElement15);var _super61=_createSuper(StrikeOutAnnotationElement);function StrikeOutAnnotationElement(parameters){_classCallCheck2(this,StrikeOutAnnotationElement);return _super61.call(this,parameters,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}_createClass2(StrikeOutAnnotationElement,[{key:"render",value:function render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("strikeoutAnnotation");return this.container}}]);return StrikeOutAnnotationElement}(AnnotationElement);var StampAnnotationElement=function(_AnnotationElement16){_inherits2(StampAnnotationElement,_AnnotationElement16);var _super62=_createSuper(StampAnnotationElement);function StampAnnotationElement(parameters){_classCallCheck2(this,StampAnnotationElement);return _super62.call(this,parameters,{isRenderable:true,ignoreBorder:true})}_createClass2(StampAnnotationElement,[{key:"render",value:function render(){this.container.classList.add("stampAnnotation");if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}return this.container}}]);return StampAnnotationElement}(AnnotationElement);exports.StampAnnotationElement=StampAnnotationElement;var _trigger=new WeakMap;var _download=new WeakSet;var FileAttachmentAnnotationElement=function(_AnnotationElement17){_inherits2(FileAttachmentAnnotationElement,_AnnotationElement17);var _super63=_createSuper(FileAttachmentAnnotationElement);function FileAttachmentAnnotationElement(parameters){var _this125$linkService$;var _this125;_classCallCheck2(this,FileAttachmentAnnotationElement);_this125=_super63.call(this,parameters,{isRenderable:true});_classPrivateMethodInitSpec(_assertThisInitialized(_this125),_download);_classPrivateFieldInitSpec(_assertThisInitialized(_this125),_trigger,{writable:true,value:null});var _this125$data$file=_this125.data.file,filename=_this125$data$file.filename,content=_this125$data$file.content;_this125.filename=(0,_display_utils.getFilenameFromUrl)(filename,true);_this125.content=content;(_this125$linkService$=_this125.linkService.eventBus)===null||_this125$linkService$===void 0||_this125$linkService$.dispatch("fileattachmentannotation",{source:_assertThisInitialized(_this125),filename:filename,content:content});return _this125}_createClass2(FileAttachmentAnnotationElement,[{key:"render",value:function render(){var _this126=this;this.container.classList.add("fileAttachmentAnnotation");var container=this.container,data=this.data;var trigger;if(data.hasAppearance||data.fillAlpha===0){trigger=document.createElement("div")}else{trigger=document.createElement("img");trigger.src="".concat(this.imageResourcesPath,"annotation-").concat(/paperclip/i.test(data.name)?"paperclip":"pushpin",".svg");if(data.fillAlpha&&data.fillAlpha<1){trigger.style="filter: opacity(".concat(Math.round(data.fillAlpha*100),"%);")}}trigger.addEventListener("dblclick",_classPrivateMethodGet(this,_download,_download2).bind(this));_classPrivateFieldSet(this,_trigger,trigger);var isMac=_util.FeatureTest.platform.isMac;container.addEventListener("keydown",function(evt){if(evt.key==="Enter"&&(isMac?evt.metaKey:evt.ctrlKey)){_classPrivateMethodGet(_this126,_download,_download2).call(_this126)}});if(!data.popupRef&&this.hasPopupData){this._createPopup()}else{trigger.classList.add("popupTriggerArea")}container.append(trigger);return container}},{key:"getElementsToTriggerPopup",value:function getElementsToTriggerPopup(){return _classPrivateFieldGet(this,_trigger)}},{key:"addHighlightArea",value:function addHighlightArea(){this.container.classList.add("highlightArea")}}]);return FileAttachmentAnnotationElement}(AnnotationElement);function _download2(){var _this$downloadManager;(_this$downloadManager=this.downloadManager)===null||_this$downloadManager===void 0||_this$downloadManager.openOrDownloadData(this.container,this.content,this.filename)}var _accessibilityManager2=new WeakMap;var _annotationCanvasMap=new WeakMap;var _editableAnnotations=new WeakMap;var _appendElement=new WeakSet;var _setAnnotationCanvasMap=new WeakSet;var AnnotationLayer=function(){function AnnotationLayer(_ref93){var div=_ref93.div,accessibilityManager=_ref93.accessibilityManager,annotationCanvasMap=_ref93.annotationCanvasMap,l10n=_ref93.l10n,page=_ref93.page,viewport=_ref93.viewport;_classCallCheck2(this,AnnotationLayer);_classPrivateMethodInitSpec(this,_setAnnotationCanvasMap);_classPrivateMethodInitSpec(this,_appendElement);_classPrivateFieldInitSpec(this,_accessibilityManager2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_annotationCanvasMap,{writable:true,value:null});_classPrivateFieldInitSpec(this,_editableAnnotations,{writable:true,value:new Map});this.div=div;_classPrivateFieldSet(this,_accessibilityManager2,accessibilityManager);_classPrivateFieldSet(this,_annotationCanvasMap,annotationCanvasMap);this.l10n=l10n;this.page=page;this.viewport=viewport;this.zIndex=0;this.l10n||(this.l10n=_displayL10n_utils.NullL10n)}_createClass2(AnnotationLayer,[{key:"render",value:function(){var _render2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee60(params){var annotations,layer,popupToElements,elementParams,_iterator153,_step153,_data8,isPopupAnnotation,_getRectDims8,width,height,elements,element,_elements2,rendered;return _regeneratorRuntime().wrap(function _callee60$(_context61){while(1)switch(_context61.prev=_context61.next){case 0:annotations=params.annotations;layer=this.div;(0,_display_utils.setLayerDimensions)(layer,this.viewport);popupToElements=new Map;elementParams={data:null,layer:layer,linkService:params.linkService,downloadManager:params.downloadManager,imageResourcesPath:params.imageResourcesPath||"",renderForms:params.renderForms!==false,svgFactory:new _display_utils.DOMSVGFactory,annotationStorage:params.annotationStorage||new _annotation_storage.AnnotationStorage,enableScripting:params.enableScripting===true,hasJSActions:params.hasJSActions,fieldObjects:params.fieldObjects,parent:this,elements:null};_iterator153=_createForOfIteratorHelper(annotations);_context61.prev=6;_iterator153.s();case 8:if((_step153=_iterator153.n()).done){_context61.next=34;break}_data8=_step153.value;if(!_data8.noHTML){_context61.next=12;break}return _context61.abrupt("continue",32);case 12:isPopupAnnotation=_data8.annotationType===_util.AnnotationType.POPUP;if(isPopupAnnotation){_context61.next=19;break}_getRectDims8=getRectDims(_data8.rect),width=_getRectDims8.width,height=_getRectDims8.height;if(!(width<=0||height<=0)){_context61.next=17;break}return _context61.abrupt("continue",32);case 17:_context61.next=23;break;case 19:elements=popupToElements.get(_data8.id);if(elements){_context61.next=22;break}return _context61.abrupt("continue",32);case 22:elementParams.elements=elements;case 23:elementParams.data=_data8;element=AnnotationElementFactory.create(elementParams);if(element.isRenderable){_context61.next=27;break}return _context61.abrupt("continue",32);case 27:if(!isPopupAnnotation&&_data8.popupRef){_elements2=popupToElements.get(_data8.popupRef);if(!_elements2){popupToElements.set(_data8.popupRef,[element])}else{_elements2.push(element)}}if(element.annotationEditorType>0){_classPrivateFieldGet(this,_editableAnnotations).set(element.data.id,element)}rendered=element.render();if(_data8.hidden){rendered.style.visibility="hidden"}_classPrivateMethodGet(this,_appendElement,_appendElement2).call(this,rendered,_data8.id);case 32:_context61.next=8;break;case 34:_context61.next=39;break;case 36:_context61.prev=36;_context61.t0=_context61["catch"](6);_iterator153.e(_context61.t0);case 39:_context61.prev=39;_iterator153.f();return _context61.finish(39);case 42:_classPrivateMethodGet(this,_setAnnotationCanvasMap,_setAnnotationCanvasMap2).call(this);_context61.next=45;return this.l10n.translate(layer);case 45:case"end":return _context61.stop()}},_callee60,this,[[6,36,39,42]])}));function render(_x60){return _render2.apply(this,arguments)}return render}()},{key:"update",value:function update(_ref94){var viewport=_ref94.viewport;var layer=this.div;this.viewport=viewport;(0,_display_utils.setLayerDimensions)(layer,{rotation:viewport.rotation});_classPrivateMethodGet(this,_setAnnotationCanvasMap,_setAnnotationCanvasMap2).call(this);layer.hidden=false}},{key:"getEditableAnnotations",value:function getEditableAnnotations(){return Array.from(_classPrivateFieldGet(this,_editableAnnotations).values())}},{key:"getEditableAnnotation",value:function getEditableAnnotation(id){return _classPrivateFieldGet(this,_editableAnnotations).get(id)}}]);return AnnotationLayer}();function _appendElement2(element,id){var _classPrivateFieldGet32;var contentElement=element.firstChild||element;contentElement.id="".concat(_util.AnnotationPrefix).concat(id);this.div.append(element);(_classPrivateFieldGet32=_classPrivateFieldGet(this,_accessibilityManager2))===null||_classPrivateFieldGet32===void 0||_classPrivateFieldGet32.moveElementInDOM(this.div,element,contentElement,false)}function _setAnnotationCanvasMap2(){if(!_classPrivateFieldGet(this,_annotationCanvasMap)){return}var layer=this.div;var _iterator154=_createForOfIteratorHelper(_classPrivateFieldGet(this,_annotationCanvasMap)),_step154;try{for(_iterator154.s();!(_step154=_iterator154.n()).done;){var _step154$value=_slicedToArray2(_step154.value,2),_id17=_step154$value[0],canvas=_step154$value[1];var element=layer.querySelector("[data-annotation-id=\"".concat(_id17,"\"]"));if(!element){continue}var firstChild=element.firstChild;if(!firstChild){element.append(canvas)}else if(firstChild.nodeName==="CANVAS"){firstChild.replaceWith(canvas)}else{firstChild.before(canvas)}}}catch(err){_iterator154.e(err)}finally{_iterator154.f()}_classPrivateFieldGet(this,_annotationCanvasMap).clear()}exports.AnnotationLayer=AnnotationLayer}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ColorConverters=void 0;function makeColorComp(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function scaleAndClamp(x){return Math.max(0,Math.min(255,255*x))}var ColorConverters=function(){function ColorConverters(){_classCallCheck2(this,ColorConverters)}_createClass2(ColorConverters,null,[{key:"CMYK_G",value:function CMYK_G(_ref95){var _ref96=_slicedToArray2(_ref95,4),c=_ref96[0],y=_ref96[1],m=_ref96[2],k=_ref96[3];return["G",1-Math.min(1,0.3*c+0.59*m+0.11*y+k)]}},{key:"G_CMYK",value:function G_CMYK(_ref97){var _ref98=_slicedToArray2(_ref97,1),g=_ref98[0];return["CMYK",0,0,0,1-g]}},{key:"G_RGB",value:function G_RGB(_ref99){var _ref100=_slicedToArray2(_ref99,1),g=_ref100[0];return["RGB",g,g,g]}},{key:"G_rgb",value:function G_rgb(_ref101){var _ref102=_slicedToArray2(_ref101,1),g=_ref102[0];g=scaleAndClamp(g);return[g,g,g]}},{key:"G_HTML",value:function G_HTML(_ref103){var _ref104=_slicedToArray2(_ref103,1),g=_ref104[0];var G=makeColorComp(g);return"#".concat(G).concat(G).concat(G)}},{key:"RGB_G",value:function RGB_G(_ref105){var _ref106=_slicedToArray2(_ref105,3),r=_ref106[0],g=_ref106[1],b=_ref106[2];return["G",0.3*r+0.59*g+0.11*b]}},{key:"RGB_rgb",value:function RGB_rgb(color){return color.map(scaleAndClamp)}},{key:"RGB_HTML",value:function RGB_HTML(color){return"#".concat(color.map(makeColorComp).join(""))}},{key:"T_HTML",value:function T_HTML(){return"#00000000"}},{key:"T_rgb",value:function T_rgb(){return[null]}},{key:"CMYK_RGB",value:function CMYK_RGB(_ref107){var _ref108=_slicedToArray2(_ref107,4),c=_ref108[0],y=_ref108[1],m=_ref108[2],k=_ref108[3];return["RGB",1-Math.min(1,c+k),1-Math.min(1,m+k),1-Math.min(1,y+k)]}},{key:"CMYK_rgb",value:function CMYK_rgb(_ref109){var _ref110=_slicedToArray2(_ref109,4),c=_ref110[0],y=_ref110[1],m=_ref110[2],k=_ref110[3];return[scaleAndClamp(1-Math.min(1,c+k)),scaleAndClamp(1-Math.min(1,m+k)),scaleAndClamp(1-Math.min(1,y+k))]}},{key:"CMYK_HTML",value:function CMYK_HTML(components){var rgb=this.CMYK_RGB(components).slice(1);return this.RGB_HTML(rgb)}},{key:"RGB_CMYK",value:function RGB_CMYK(_ref111){var _ref112=_slicedToArray2(_ref111,3),r=_ref112[0],g=_ref112[1],b=_ref112[2];var c=1-r;var m=1-g;var y=1-b;var k=Math.min(c,m,y);return["CMYK",c,m,y,k]}}]);return ColorConverters}();exports.ColorConverters=ColorConverters}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.NullL10n=void 0;exports.getL10nFallback=getL10nFallback;var DEFAULT_L10N_STRINGS={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} \xD7 {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} \xD7 {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing\u2026",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};{DEFAULT_L10N_STRINGS.print_progress_percent="{{progress}}%"}function getL10nFallback(key,args){switch(key){case"find_match_count":key="find_match_count[".concat(args.total===1?"one":"other","]");break;case"find_match_count_limit":key="find_match_count_limit[".concat(args.limit===1?"one":"other","]");break}return DEFAULT_L10N_STRINGS[key]||""}function formatL10nValue(text,args){if(!args){return text}return text.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,function(all,name){return name in args?args[name]:"{{"+name+"}}"})}var NullL10n={getLanguage:function getLanguage(){return _asyncToGenerator(_regeneratorRuntime().mark(function _callee61(){return _regeneratorRuntime().wrap(function _callee61$(_context62){while(1)switch(_context62.prev=_context62.next){case 0:return _context62.abrupt("return","en-us");case 1:case"end":return _context62.stop()}},_callee61)}))()},getDirection:function getDirection(){return _asyncToGenerator(_regeneratorRuntime().mark(function _callee62(){return _regeneratorRuntime().wrap(function _callee62$(_context63){while(1)switch(_context63.prev=_context63.next){case 0:return _context63.abrupt("return","ltr");case 1:case"end":return _context63.stop()}},_callee62)}))()},get:function get(key){var _arguments2=arguments;return _asyncToGenerator(_regeneratorRuntime().mark(function _callee63(){var args,fallback;return _regeneratorRuntime().wrap(function _callee63$(_context64){while(1)switch(_context64.prev=_context64.next){case 0:args=_arguments2.length>1&&_arguments2[1]!==undefined?_arguments2[1]:null;fallback=_arguments2.length>2&&_arguments2[2]!==undefined?_arguments2[2]:getL10nFallback(key,args);return _context64.abrupt("return",formatL10nValue(fallback,args));case 3:case"end":return _context64.stop()}},_callee63)}))()},translate:function translate(element){return _asyncToGenerator(_regeneratorRuntime().mark(function _callee64(){return _regeneratorRuntime().wrap(function _callee64$(_context65){while(1)switch(_context65.prev=_context65.next){case 0:case"end":return _context65.stop()}},_callee64)}))()}};exports.NullL10n=NullL10n}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.XfaLayer=void 0;var _xfa_text=__w_pdfjs_require__(25);var XfaLayer=function(){function XfaLayer(){_classCallCheck2(this,XfaLayer)}_createClass2(XfaLayer,null,[{key:"setupStorage",value:function setupStorage(html,id,element,storage,intent){var storedData=storage.getValue(id,{value:null});switch(element.name){case"textarea":if(storedData.value!==null){html.textContent=storedData.value}if(intent==="print"){break}html.addEventListener("input",function(event){storage.setValue(id,{value:event.target.value})});break;case"input":if(element.attributes.type==="radio"||element.attributes.type==="checkbox"){if(storedData.value===element.attributes.xfaOn){html.setAttribute("checked",true)}else if(storedData.value===element.attributes.xfaOff){html.removeAttribute("checked")}if(intent==="print"){break}html.addEventListener("change",function(event){storage.setValue(id,{value:event.target.checked?event.target.getAttribute("xfaOn"):event.target.getAttribute("xfaOff")})})}else{if(storedData.value!==null){html.setAttribute("value",storedData.value)}if(intent==="print"){break}html.addEventListener("input",function(event){storage.setValue(id,{value:event.target.value})})}break;case"select":if(storedData.value!==null){html.setAttribute("value",storedData.value);var _iterator155=_createForOfIteratorHelper(element.children),_step155;try{for(_iterator155.s();!(_step155=_iterator155.n()).done;){var option=_step155.value;if(option.attributes.value===storedData.value){option.attributes.selected=true}else if(option.attributes.hasOwnProperty("selected")){delete option.attributes.selected}}}catch(err){_iterator155.e(err)}finally{_iterator155.f()}}html.addEventListener("input",function(event){var options=event.target.options;var value=options.selectedIndex===-1?"":options[options.selectedIndex].value;storage.setValue(id,{value:value})});break}}},{key:"setAttributes",value:function setAttributes(_ref113){var html=_ref113.html,element=_ref113.element,_ref113$storage=_ref113.storage,storage=_ref113$storage===void 0?null:_ref113$storage,intent=_ref113.intent,linkService=_ref113.linkService;var attributes=element.attributes;var isHTMLAnchorElement=html instanceof HTMLAnchorElement;if(attributes.type==="radio"){attributes.name="".concat(attributes.name,"-").concat(intent)}for(var _i59=0,_Object$entries4=Object.entries(attributes);_i59<_Object$entries4.length;_i59++){var _Object$entries4$_i=_slicedToArray2(_Object$entries4[_i59],2),key=_Object$entries4$_i[0],value=_Object$entries4$_i[1];if(value===null||value===undefined){continue}switch(key){case"class":if(value.length){html.setAttribute(key,value.join(" "))}break;case"dataId":break;case"id":html.setAttribute("data-element-id",value);break;case"style":Object.assign(html.style,value);break;case"textContent":html.textContent=value;break;default:if(!isHTMLAnchorElement||key!=="href"&&key!=="newWindow"){html.setAttribute(key,value)}}}if(isHTMLAnchorElement){linkService.addLinkAttributes(html,attributes.href,attributes.newWindow)}if(storage&&attributes.dataId){this.setupStorage(html,attributes.dataId,element,storage)}}},{key:"render",value:function render(parameters){var storage=parameters.annotationStorage;var linkService=parameters.linkService;var root=parameters.xfaHtml;var intent=parameters.intent||"display";var rootHtml=document.createElement(root.name);if(root.attributes){this.setAttributes({html:rootHtml,element:root,intent:intent,linkService:linkService})}var stack=[[root,-1,rootHtml]];var rootDiv=parameters.div;rootDiv.append(rootHtml);if(parameters.viewport){var transform="matrix(".concat(parameters.viewport.transform.join(","),")");rootDiv.style.transform=transform}if(intent!=="richText"){rootDiv.setAttribute("class","xfaLayer xfaFont")}var textDivs=[];while(stack.length>0){var _child$attributes;var _stack$at=stack.at(-1),_stack$at2=_slicedToArray2(_stack$at,3),parent=_stack$at2[0],_i60=_stack$at2[1],_html=_stack$at2[2];if(_i60+1===parent.children.length){stack.pop();continue}var child=parent.children[++stack.at(-1)[1]];if(child===null){continue}var _name13=child.name;if(_name13==="#text"){var node=document.createTextNode(child.value);textDivs.push(node);_html.append(node);continue}var childHtml=child!==null&&child!==void 0&&(_child$attributes=child.attributes)!==null&&_child$attributes!==void 0&&_child$attributes.xmlns?document.createElementNS(child.attributes.xmlns,_name13):document.createElement(_name13);_html.append(childHtml);if(child.attributes){this.setAttributes({html:childHtml,element:child,storage:storage,intent:intent,linkService:linkService})}if(child.children&&child.children.length>0){stack.push([child,-1,childHtml])}else if(child.value){var _node=document.createTextNode(child.value);if(_xfa_text.XfaText.shouldBuildText(_name13)){textDivs.push(_node)}childHtml.append(_node)}}var _iterator156=_createForOfIteratorHelper(rootDiv.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea")),_step156;try{for(_iterator156.s();!(_step156=_iterator156.n()).done;){var el=_step156.value;el.setAttribute("readOnly",true)}}catch(err){_iterator156.e(err)}finally{_iterator156.f()}return{textDivs:textDivs}}},{key:"update",value:function update(parameters){var transform="matrix(".concat(parameters.viewport.transform.join(","),")");parameters.div.style.transform=transform;parameters.div.hidden=false}}]);return XfaLayer}();exports.XfaLayer=XfaLayer}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){var _class41;Object.defineProperty(exports,"__esModule",{value:true});exports.InkEditor=void 0;var _util=__w_pdfjs_require__(1);var _editor=__w_pdfjs_require__(4);var _annotation_layer=__w_pdfjs_require__(29);var _display_utils=__w_pdfjs_require__(6);var _tools=__w_pdfjs_require__(5);var _baseHeight=new WeakMap;var _baseWidth=new WeakMap;var _boundCanvasPointermove=new WeakMap;var _boundCanvasPointerleave=new WeakMap;var _boundCanvasPointerup=new WeakMap;var _boundCanvasPointerdown=new WeakMap;var _currentPath2D=new WeakMap;var _disableEditing=new WeakMap;var _hasSomethingToDraw=new WeakMap;var _isCanvasInitialized=new WeakMap;var _observer=new WeakMap;var _realWidth=new WeakMap;var _realHeight=new WeakMap;var _requestFrameCallback=new WeakMap;var _updateThickness=new WeakSet;var _updateColor3=new WeakSet;var _updateOpacity=new WeakSet;var _getInitialBBox=new WeakSet;var _setStroke=new WeakSet;var _startDrawing=new WeakSet;var _draw=new WeakSet;var _endPath=new WeakSet;var _stopDrawing=new WeakSet;var _drawPoints=new WeakSet;var _makeBezierCurve=new WeakSet;var _generateBezierPoints=new WeakSet;var _redraw=new WeakSet;var _endDrawing=new WeakSet;var _createCanvas2=new WeakSet;var _createObserver=new WeakSet;var _setCanvasDims=new WeakSet;var _setScaleFactor=new WeakSet;var _updateTransform=new WeakSet;var _serializePaths=new WeakSet;var _getBbox=new WeakSet;var _getPadding=new WeakSet;var _fitToContent=new WeakSet;var InkEditor=function(_editor$AnnotationEdi2){_inherits2(InkEditor,_editor$AnnotationEdi2);var _super64=_createSuper(InkEditor);function InkEditor(params){var _this128;_classCallCheck2(this,InkEditor);_this128=_super64.call(this,_objectSpread2(_objectSpread2({},params),{},{name:"inkEditor"}));_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_fitToContent);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_getPadding);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_getBbox);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_serializePaths);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_updateTransform);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_setScaleFactor);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_setCanvasDims);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_createObserver);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_createCanvas2);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_endDrawing);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_redraw);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_generateBezierPoints);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_makeBezierCurve);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_drawPoints);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_stopDrawing);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_endPath);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_draw);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_startDrawing);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_setStroke);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_getInitialBBox);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_updateOpacity);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_updateColor3);_classPrivateMethodInitSpec(_assertThisInitialized(_this128),_updateThickness);_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_baseHeight,{writable:true,value:0});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_baseWidth,{writable:true,value:0});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_boundCanvasPointermove,{writable:true,value:_this128.canvasPointermove.bind(_assertThisInitialized(_this128))});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_boundCanvasPointerleave,{writable:true,value:_this128.canvasPointerleave.bind(_assertThisInitialized(_this128))});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_boundCanvasPointerup,{writable:true,value:_this128.canvasPointerup.bind(_assertThisInitialized(_this128))});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_boundCanvasPointerdown,{writable:true,value:_this128.canvasPointerdown.bind(_assertThisInitialized(_this128))});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_currentPath2D,{writable:true,value:new Path2D});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_disableEditing,{writable:true,value:false});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_hasSomethingToDraw,{writable:true,value:false});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_isCanvasInitialized,{writable:true,value:false});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_observer,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_realWidth,{writable:true,value:0});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_realHeight,{writable:true,value:0});_classPrivateFieldInitSpec(_assertThisInitialized(_this128),_requestFrameCallback,{writable:true,value:null});_this128.color=params.color||null;_this128.thickness=params.thickness||null;_this128.opacity=params.opacity||null;_this128.paths=[];_this128.bezierPath2D=[];_this128.allRawPaths=[];_this128.currentPath=[];_this128.scaleFactor=1;_this128.translationX=_this128.translationY=0;_this128.x=0;_this128.y=0;_this128._willKeepAspectRatio=true;return _this128}_createClass2(InkEditor,[{key:"updateParams",value:function updateParams(type,value){switch(type){case _util.AnnotationEditorParamsType.INK_THICKNESS:_classPrivateMethodGet(this,_updateThickness,_updateThickness2).call(this,value);break;case _util.AnnotationEditorParamsType.INK_COLOR:_classPrivateMethodGet(this,_updateColor3,_updateColor4).call(this,value);break;case _util.AnnotationEditorParamsType.INK_OPACITY:_classPrivateMethodGet(this,_updateOpacity,_updateOpacity2).call(this,value);break}}},{key:"propertiesToUpdate",get:function get(){var _this$opacity;return[[_util.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||InkEditor._defaultThickness],[_util.AnnotationEditorParamsType.INK_COLOR,this.color||InkEditor._defaultColor||_editor.AnnotationEditor._defaultLineColor],[_util.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*((_this$opacity=this.opacity)!==null&&_this$opacity!==void 0?_this$opacity:InkEditor._defaultOpacity))]]}},{key:"rebuild",value:function rebuild(){if(!this.parent){return}_get5(_getPrototypeOf(InkEditor.prototype),"rebuild",this).call(this);if(this.div===null){return}if(!this.canvas){_classPrivateMethodGet(this,_createCanvas2,_createCanvas3).call(this);_classPrivateMethodGet(this,_createObserver,_createObserver2).call(this)}if(!this.isAttachedToDOM){this.parent.add(this);_classPrivateMethodGet(this,_setCanvasDims,_setCanvasDims2).call(this)}_classPrivateMethodGet(this,_fitToContent,_fitToContent2).call(this)}},{key:"remove",value:function remove(){if(this.canvas===null){return}if(!this.isEmpty()){this.commit()}this.canvas.width=this.canvas.height=0;this.canvas.remove();this.canvas=null;_classPrivateFieldGet(this,_observer).disconnect();_classPrivateFieldSet(this,_observer,null);_get5(_getPrototypeOf(InkEditor.prototype),"remove",this).call(this)}},{key:"setParent",value:function setParent(parent){if(!this.parent&&parent){this._uiManager.removeShouldRescale(this)}else if(this.parent&&parent===null){this._uiManager.addShouldRescale(this)}_get5(_getPrototypeOf(InkEditor.prototype),"setParent",this).call(this,parent)}},{key:"onScaleChanging",value:function onScaleChanging(){var _this$parentDimension11=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension11[0],parentHeight=_this$parentDimension11[1];var width=this.width*parentWidth;var height=this.height*parentHeight;this.setDimensions(width,height)}},{key:"enableEditMode",value:function enableEditMode(){if(_classPrivateFieldGet(this,_disableEditing)||this.canvas===null){return}_get5(_getPrototypeOf(InkEditor.prototype),"enableEditMode",this).call(this);this._isDraggable=false;this.canvas.addEventListener("pointerdown",_classPrivateFieldGet(this,_boundCanvasPointerdown))}},{key:"disableEditMode",value:function disableEditMode(){if(!this.isInEditMode()||this.canvas===null){return}_get5(_getPrototypeOf(InkEditor.prototype),"disableEditMode",this).call(this);this._isDraggable=!this.isEmpty();this.div.classList.remove("editing");this.canvas.removeEventListener("pointerdown",_classPrivateFieldGet(this,_boundCanvasPointerdown))}},{key:"onceAdded",value:function onceAdded(){this._isDraggable=!this.isEmpty()}},{key:"isEmpty",value:function isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}},{key:"commit",value:function commit(){if(_classPrivateFieldGet(this,_disableEditing)){return}_get5(_getPrototypeOf(InkEditor.prototype),"commit",this).call(this);this.isEditing=false;this.disableEditMode();this.setInForeground();_classPrivateFieldSet(this,_disableEditing,true);this.div.classList.add("disabled");_classPrivateMethodGet(this,_fitToContent,_fitToContent2).call(this,true);this.makeResizable();this.parent.addInkEditorIfNeeded(true);this.moveInDOM();this.div.focus({preventScroll:true})}},{key:"focusin",value:function focusin(event){if(!this._focusEventsAllowed){return}_get5(_getPrototypeOf(InkEditor.prototype),"focusin",this).call(this,event);this.enableEditMode()}},{key:"canvasPointerdown",value:function canvasPointerdown(event){if(event.button!==0||!this.isInEditMode()||_classPrivateFieldGet(this,_disableEditing)){return}this.setInForeground();event.preventDefault();if(event.type!=="mouse"){this.div.focus()}_classPrivateMethodGet(this,_startDrawing,_startDrawing2).call(this,event.offsetX,event.offsetY)}},{key:"canvasPointermove",value:function canvasPointermove(event){event.preventDefault();_classPrivateMethodGet(this,_draw,_draw2).call(this,event.offsetX,event.offsetY)}},{key:"canvasPointerup",value:function canvasPointerup(event){event.preventDefault();_classPrivateMethodGet(this,_endDrawing,_endDrawing2).call(this,event)}},{key:"canvasPointerleave",value:function canvasPointerleave(event){_classPrivateMethodGet(this,_endDrawing,_endDrawing2).call(this,event)}},{key:"isResizable",get:function get(){return!this.isEmpty()&&_classPrivateFieldGet(this,_disableEditing)}},{key:"render",value:function render(){var _this129=this;if(this.div){return this.div}var baseX,baseY;if(this.width){baseX=this.x;baseY=this.y}_get5(_getPrototypeOf(InkEditor.prototype),"render",this).call(this);_editor.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(function(msg){var _this129$div;return(_this129$div=_this129.div)===null||_this129$div===void 0?void 0:_this129$div.setAttribute("aria-label",msg)});var _classPrivateMethodGe6=_classPrivateMethodGet(this,_getInitialBBox,_getInitialBBox2).call(this),_classPrivateMethodGe7=_slicedToArray2(_classPrivateMethodGe6,4),x=_classPrivateMethodGe7[0],y=_classPrivateMethodGe7[1],w=_classPrivateMethodGe7[2],h=_classPrivateMethodGe7[3];this.setAt(x,y,0,0);this.setDims(w,h);_classPrivateMethodGet(this,_createCanvas2,_createCanvas3).call(this);if(this.width){var _this$parentDimension12=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension12[0],parentHeight=_this$parentDimension12[1];this.setAspectRatio(this.width*parentWidth,this.height*parentHeight);this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight);_classPrivateFieldSet(this,_isCanvasInitialized,true);_classPrivateMethodGet(this,_setCanvasDims,_setCanvasDims2).call(this);this.setDims(this.width*parentWidth,this.height*parentHeight);_classPrivateMethodGet(this,_redraw,_redraw2).call(this);this.div.classList.add("disabled")}else{this.div.classList.add("editing");this.enableEditMode()}_classPrivateMethodGet(this,_createObserver,_createObserver2).call(this);return this.div}},{key:"setDimensions",value:function setDimensions(width,height){var roundedWidth=Math.round(width);var roundedHeight=Math.round(height);if(_classPrivateFieldGet(this,_realWidth)===roundedWidth&&_classPrivateFieldGet(this,_realHeight)===roundedHeight){return}_classPrivateFieldSet(this,_realWidth,roundedWidth);_classPrivateFieldSet(this,_realHeight,roundedHeight);this.canvas.style.visibility="hidden";var _this$parentDimension13=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension13[0],parentHeight=_this$parentDimension13[1];this.width=width/parentWidth;this.height=height/parentHeight;this.fixAndSetPosition();if(_classPrivateFieldGet(this,_disableEditing)){_classPrivateMethodGet(this,_setScaleFactor,_setScaleFactor2).call(this,width,height)}_classPrivateMethodGet(this,_setCanvasDims,_setCanvasDims2).call(this);_classPrivateMethodGet(this,_redraw,_redraw2).call(this);this.canvas.style.visibility="visible";this.fixDims()}},{key:"serialize",value:function serialize(){if(this.isEmpty()){return null}var rect=this.getRect(0,0);var color=_editor.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:_util.AnnotationEditorType.INK,color:color,thickness:this.thickness,opacity:this.opacity,paths:_classPrivateMethodGet(this,_serializePaths,_serializePaths2).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,rect),pageIndex:this.pageIndex,rect:rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}],[{key:"initialize",value:function initialize(l10n){_editor.AnnotationEditor.initialize(l10n,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}},{key:"updateDefaultParams",value:function updateDefaultParams(type,value){switch(type){case _util.AnnotationEditorParamsType.INK_THICKNESS:InkEditor._defaultThickness=value;break;case _util.AnnotationEditorParamsType.INK_COLOR:InkEditor._defaultColor=value;break;case _util.AnnotationEditorParamsType.INK_OPACITY:InkEditor._defaultOpacity=value/100;break}}},{key:"defaultPropertiesToUpdate",get:function get(){return[[_util.AnnotationEditorParamsType.INK_THICKNESS,InkEditor._defaultThickness],[_util.AnnotationEditorParamsType.INK_COLOR,InkEditor._defaultColor||_editor.AnnotationEditor._defaultLineColor],[_util.AnnotationEditorParamsType.INK_OPACITY,Math.round(InkEditor._defaultOpacity*100)]]}},{key:"deserialize",value:function deserialize(data,parent,uiManager){var _util$Util8;if(data instanceof _annotation_layer.InkAnnotationElement){return null}var editor=_get5(_getPrototypeOf(InkEditor),"deserialize",this).call(this,data,parent,uiManager);editor.thickness=data.thickness;editor.color=(_util$Util8=_util.Util).makeHexColor.apply(_util$Util8,_toConsumableArray2(data.color));editor.opacity=data.opacity;var _editor$pageDimension2=_slicedToArray2(editor.pageDimensions,2),pageWidth=_editor$pageDimension2[0],pageHeight=_editor$pageDimension2[1];var width=editor.width*pageWidth;var height=editor.height*pageHeight;var scaleFactor=editor.parentScale;var padding=data.thickness/2;_classPrivateFieldSet(editor,_disableEditing,true);_classPrivateFieldSet(editor,_realWidth,Math.round(width));_classPrivateFieldSet(editor,_realHeight,Math.round(height));var paths=data.paths,rect=data.rect,rotation=data.rotation;var _iterator157=_createForOfIteratorHelper(paths),_step157;try{for(_iterator157.s();!(_step157=_iterator157.n()).done;){var bezier=_step157.value.bezier;bezier=_classStaticPrivateMethodGet(InkEditor,InkEditor,_fromPDFCoordinates).call(InkEditor,bezier,rect,rotation);var path=[];editor.paths.push(path);var p0=scaleFactor*(bezier[0]-padding);var p1=scaleFactor*(bezier[1]-padding);for(var _i61=2,ii=bezier.length;_i61<ii;_i61+=6){var p10=scaleFactor*(bezier[_i61]-padding);var p11=scaleFactor*(bezier[_i61+1]-padding);var p20=scaleFactor*(bezier[_i61+2]-padding);var p21=scaleFactor*(bezier[_i61+3]-padding);var p30=scaleFactor*(bezier[_i61+4]-padding);var p31=scaleFactor*(bezier[_i61+5]-padding);path.push([[p0,p1],[p10,p11],[p20,p21],[p30,p31]]);p0=p30;p1=p31}var path2D=_classStaticPrivateMethodGet(this,InkEditor,_buildPath2D).call(this,path);editor.bezierPath2D.push(path2D)}}catch(err){_iterator157.e(err)}finally{_iterator157.f()}var bbox=_classPrivateMethodGet(editor,_getBbox,_getBbox2).call(editor);_classPrivateFieldSet(editor,_baseWidth,Math.max(_editor.AnnotationEditor.MIN_SIZE,bbox[2]-bbox[0]));_classPrivateFieldSet(editor,_baseHeight,Math.max(_editor.AnnotationEditor.MIN_SIZE,bbox[3]-bbox[1]));_classPrivateMethodGet(editor,_setScaleFactor,_setScaleFactor2).call(editor,width,height);return editor}}]);return InkEditor}(_editor.AnnotationEditor);_class41=InkEditor;function _updateThickness2(thickness){var _this130=this;var savedThickness=this.thickness;this.addCommands({cmd:function cmd(){_this130.thickness=thickness;_classPrivateMethodGet(_this130,_fitToContent,_fitToContent2).call(_this130)},undo:function undo(){_this130.thickness=savedThickness;_classPrivateMethodGet(_this130,_fitToContent,_fitToContent2).call(_this130)},mustExec:true,type:_util.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:true,keepUndo:true})}function _updateColor4(color){var _this131=this;var savedColor=this.color;this.addCommands({cmd:function cmd(){_this131.color=color;_classPrivateMethodGet(_this131,_redraw,_redraw2).call(_this131)},undo:function undo(){_this131.color=savedColor;_classPrivateMethodGet(_this131,_redraw,_redraw2).call(_this131)},mustExec:true,type:_util.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:true,keepUndo:true})}function _updateOpacity2(opacity){var _this132=this;opacity/=100;var savedOpacity=this.opacity;this.addCommands({cmd:function cmd(){_this132.opacity=opacity;_classPrivateMethodGet(_this132,_redraw,_redraw2).call(_this132)},undo:function undo(){_this132.opacity=savedOpacity;_classPrivateMethodGet(_this132,_redraw,_redraw2).call(_this132)},mustExec:true,type:_util.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:true,keepUndo:true})}function _getInitialBBox2(){var parentRotation=this.parentRotation,_this$parentDimension14=_slicedToArray2(this.parentDimensions,2),width=_this$parentDimension14[0],height=_this$parentDimension14[1];switch(parentRotation){case 90:return[0,height,height,width];case 180:return[width,height,width,height];case 270:return[width,0,height,width];default:return[0,0,width,height]}}function _setStroke2(){var ctx=this.ctx,color=this.color,opacity=this.opacity,thickness=this.thickness,parentScale=this.parentScale,scaleFactor=this.scaleFactor;ctx.lineWidth=thickness*parentScale/scaleFactor;ctx.lineCap="round";ctx.lineJoin="round";ctx.miterLimit=10;ctx.strokeStyle="".concat(color).concat((0,_tools.opacityToHex)(opacity))}function _startDrawing2(x,y){var _this133=this;this.canvas.addEventListener("contextmenu",_display_utils.noContextMenu);this.canvas.addEventListener("pointerleave",_classPrivateFieldGet(this,_boundCanvasPointerleave));this.canvas.addEventListener("pointermove",_classPrivateFieldGet(this,_boundCanvasPointermove));this.canvas.addEventListener("pointerup",_classPrivateFieldGet(this,_boundCanvasPointerup));this.canvas.removeEventListener("pointerdown",_classPrivateFieldGet(this,_boundCanvasPointerdown));this.isEditing=true;if(!_classPrivateFieldGet(this,_isCanvasInitialized)){var _this$opacity2;_classPrivateFieldSet(this,_isCanvasInitialized,true);_classPrivateMethodGet(this,_setCanvasDims,_setCanvasDims2).call(this);this.thickness||(this.thickness=_class41._defaultThickness);this.color||(this.color=_class41._defaultColor||_editor.AnnotationEditor._defaultLineColor);(_this$opacity2=this.opacity)!==null&&_this$opacity2!==void 0?_this$opacity2:this.opacity=_class41._defaultOpacity}this.currentPath.push([x,y]);_classPrivateFieldSet(this,_hasSomethingToDraw,false);_classPrivateMethodGet(this,_setStroke,_setStroke2).call(this);_classPrivateFieldSet(this,_requestFrameCallback,function(){_classPrivateMethodGet(_this133,_drawPoints,_drawPoints2).call(_this133);if(_classPrivateFieldGet(_this133,_requestFrameCallback)){window.requestAnimationFrame(_classPrivateFieldGet(_this133,_requestFrameCallback))}});window.requestAnimationFrame(_classPrivateFieldGet(this,_requestFrameCallback))}function _draw2(x,y){var _classPrivateMethodGe8;var _this$currentPath$at=this.currentPath.at(-1),_this$currentPath$at2=_slicedToArray2(_this$currentPath$at,2),lastX=_this$currentPath$at2[0],lastY=_this$currentPath$at2[1];if(this.currentPath.length>1&&x===lastX&&y===lastY){return}var currentPath=this.currentPath;var path2D=_classPrivateFieldGet(this,_currentPath2D);currentPath.push([x,y]);_classPrivateFieldSet(this,_hasSomethingToDraw,true);if(currentPath.length<=2){var _path2D;(_path2D=path2D).moveTo.apply(_path2D,_toConsumableArray2(currentPath[0]));path2D.lineTo(x,y);return}if(currentPath.length===3){var _path2D2;_classPrivateFieldSet(this,_currentPath2D,path2D=new Path2D);(_path2D2=path2D).moveTo.apply(_path2D2,_toConsumableArray2(currentPath[0]))}(_classPrivateMethodGe8=_classPrivateMethodGet(this,_makeBezierCurve,_makeBezierCurve2)).call.apply(_classPrivateMethodGe8,[this,path2D].concat(_toConsumableArray2(currentPath.at(-3)),_toConsumableArray2(currentPath.at(-2)),[x,y]))}function _endPath2(){var _classPrivateFieldGet33;if(this.currentPath.length===0){return}var lastPoint=this.currentPath.at(-1);(_classPrivateFieldGet33=_classPrivateFieldGet(this,_currentPath2D)).lineTo.apply(_classPrivateFieldGet33,_toConsumableArray2(lastPoint))}function _stopDrawing2(x,y){var _this134=this;_classPrivateFieldSet(this,_requestFrameCallback,null);x=Math.min(Math.max(x,0),this.canvas.width);y=Math.min(Math.max(y,0),this.canvas.height);_classPrivateMethodGet(this,_draw,_draw2).call(this,x,y);_classPrivateMethodGet(this,_endPath,_endPath2).call(this);var bezier;if(this.currentPath.length!==1){bezier=_classPrivateMethodGet(this,_generateBezierPoints,_generateBezierPoints2).call(this)}else{var xy=[x,y];bezier=[[xy,xy.slice(),xy.slice(),xy]]}var path2D=_classPrivateFieldGet(this,_currentPath2D);var currentPath=this.currentPath;this.currentPath=[];_classPrivateFieldSet(this,_currentPath2D,new Path2D);var cmd=function cmd(){_this134.allRawPaths.push(currentPath);_this134.paths.push(bezier);_this134.bezierPath2D.push(path2D);_this134.rebuild()};var undo=function undo(){_this134.allRawPaths.pop();_this134.paths.pop();_this134.bezierPath2D.pop();if(_this134.paths.length===0){_this134.remove()}else{if(!_this134.canvas){_classPrivateMethodGet(_this134,_createCanvas2,_createCanvas3).call(_this134);_classPrivateMethodGet(_this134,_createObserver,_createObserver2).call(_this134)}_classPrivateMethodGet(_this134,_fitToContent,_fitToContent2).call(_this134)}};this.addCommands({cmd:cmd,undo:undo,mustExec:true})}function _drawPoints2(){if(!_classPrivateFieldGet(this,_hasSomethingToDraw)){return}_classPrivateFieldSet(this,_hasSomethingToDraw,false);var thickness=Math.ceil(this.thickness*this.parentScale);var lastPoints=this.currentPath.slice(-3);var x=lastPoints.map(function(xy){return xy[0]});var y=lastPoints.map(function(xy){return xy[1]});Math.min.apply(Math,_toConsumableArray2(x))-thickness;Math.max.apply(Math,_toConsumableArray2(x))+thickness;Math.min.apply(Math,_toConsumableArray2(y))-thickness;Math.max.apply(Math,_toConsumableArray2(y))+thickness;var ctx=this.ctx;ctx.save();ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var _iterator158=_createForOfIteratorHelper(this.bezierPath2D),_step158;try{for(_iterator158.s();!(_step158=_iterator158.n()).done;){var path=_step158.value;ctx.stroke(path)}}catch(err){_iterator158.e(err)}finally{_iterator158.f()}ctx.stroke(_classPrivateFieldGet(this,_currentPath2D));ctx.restore()}function _makeBezierCurve2(path2D,x0,y0,x1,y1,x2,y2){var prevX=(x0+x1)/2;var prevY=(y0+y1)/2;var x3=(x1+x2)/2;var y3=(y1+y2)/2;path2D.bezierCurveTo(prevX+2*(x1-prevX)/3,prevY+2*(y1-prevY)/3,x3+2*(x1-x3)/3,y3+2*(y1-y3)/3,x3,y3)}function _generateBezierPoints2(){var path=this.currentPath;if(path.length<=2){return[[path[0],path[0],path.at(-1),path.at(-1)]]}var bezierPoints=[];var i;var _path$=_slicedToArray2(path[0],2),x0=_path$[0],y0=_path$[1];for(i=1;i<path.length-2;i++){var _path$i=_slicedToArray2(path[i],2),_x61=_path$i[0],_y3=_path$i[1];var _path=_slicedToArray2(path[i+1],2),_x62=_path[0],_y4=_path[1];var x3=(_x61+_x62)/2;var y3=(_y3+_y4)/2;var _control=[x0+2*(_x61-x0)/3,y0+2*(_y3-y0)/3];var _control2=[x3+2*(_x61-x3)/3,y3+2*(_y3-y3)/3];bezierPoints.push([[x0,y0],_control,_control2,[x3,y3]]);x0=x3;y0=y3}var _path$i2=_slicedToArray2(path[i],2),x1=_path$i2[0],y1=_path$i2[1];var _path2=_slicedToArray2(path[i+1],2),x2=_path2[0],y2=_path2[1];var control1=[x0+2*(x1-x0)/3,y0+2*(y1-y0)/3];var control2=[x2+2*(x1-x2)/3,y2+2*(y1-y2)/3];bezierPoints.push([[x0,y0],control1,control2,[x2,y2]]);return bezierPoints}function _redraw2(){if(this.isEmpty()){_classPrivateMethodGet(this,_updateTransform,_updateTransform2).call(this);return}_classPrivateMethodGet(this,_setStroke,_setStroke2).call(this);var canvas=this.canvas,ctx=this.ctx;ctx.setTransform(1,0,0,1,0,0);ctx.clearRect(0,0,canvas.width,canvas.height);_classPrivateMethodGet(this,_updateTransform,_updateTransform2).call(this);var _iterator159=_createForOfIteratorHelper(this.bezierPath2D),_step159;try{for(_iterator159.s();!(_step159=_iterator159.n()).done;){var path=_step159.value;ctx.stroke(path)}}catch(err){_iterator159.e(err)}finally{_iterator159.f()}}function _endDrawing2(event){var _this135=this;this.canvas.removeEventListener("pointerleave",_classPrivateFieldGet(this,_boundCanvasPointerleave));this.canvas.removeEventListener("pointermove",_classPrivateFieldGet(this,_boundCanvasPointermove));this.canvas.removeEventListener("pointerup",_classPrivateFieldGet(this,_boundCanvasPointerup));this.canvas.addEventListener("pointerdown",_classPrivateFieldGet(this,_boundCanvasPointerdown));setTimeout(function(){_this135.canvas.removeEventListener("contextmenu",_display_utils.noContextMenu)},10);_classPrivateMethodGet(this,_stopDrawing,_stopDrawing2).call(this,event.offsetX,event.offsetY);this.addToAnnotationStorage();this.setInBackground()}function _createCanvas3(){var _this136=this;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=0;this.canvas.className="inkEditorCanvas";_editor.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(function(msg){var _this136$canvas;return(_this136$canvas=_this136.canvas)===null||_this136$canvas===void 0?void 0:_this136$canvas.setAttribute("aria-label",msg)});this.div.append(this.canvas);this.ctx=this.canvas.getContext("2d")}function _createObserver2(){var _this137=this;_classPrivateFieldSet(this,_observer,new ResizeObserver(function(entries){var rect=entries[0].contentRect;if(rect.width&&rect.height){_this137.setDimensions(rect.width,rect.height)}}));_classPrivateFieldGet(this,_observer).observe(this.div)}function _setCanvasDims2(){if(!_classPrivateFieldGet(this,_isCanvasInitialized)){return}var _this$parentDimension15=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension15[0],parentHeight=_this$parentDimension15[1];this.canvas.width=Math.ceil(this.width*parentWidth);this.canvas.height=Math.ceil(this.height*parentHeight);_classPrivateMethodGet(this,_updateTransform,_updateTransform2).call(this)}function _setScaleFactor2(width,height){var padding=_classPrivateMethodGet(this,_getPadding,_getPadding2).call(this);var scaleFactorW=(width-padding)/_classPrivateFieldGet(this,_baseWidth);var scaleFactorH=(height-padding)/_classPrivateFieldGet(this,_baseHeight);this.scaleFactor=Math.min(scaleFactorW,scaleFactorH)}function _updateTransform2(){var padding=_classPrivateMethodGet(this,_getPadding,_getPadding2).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+padding,this.translationY*this.scaleFactor+padding)}function _buildPath2D(bezier){var path2D=new Path2D;for(var _i62=0,ii=bezier.length;_i62<ii;_i62++){var _bezier$_i=_slicedToArray2(bezier[_i62],4),first=_bezier$_i[0],control1=_bezier$_i[1],control2=_bezier$_i[2],second=_bezier$_i[3];if(_i62===0){path2D.moveTo.apply(path2D,_toConsumableArray2(first))}path2D.bezierCurveTo(control1[0],control1[1],control2[0],control2[1],second[0],second[1])}return path2D}function _toPDFCoordinates(points,rect,rotation){var _rect3=_slicedToArray2(rect,4),blX=_rect3[0],blY=_rect3[1],trX=_rect3[2],trY=_rect3[3];switch(rotation){case 0:for(var _i63=0,ii=points.length;_i63<ii;_i63+=2){points[_i63]+=blX;points[_i63+1]=trY-points[_i63+1]}break;case 90:for(var _i64=0,_ii2=points.length;_i64<_ii2;_i64+=2){var x=points[_i64];points[_i64]=points[_i64+1]+blX;points[_i64+1]=x+blY}break;case 180:for(var _i65=0,_ii3=points.length;_i65<_ii3;_i65+=2){points[_i65]=trX-points[_i65];points[_i65+1]+=blY}break;case 270:for(var _i66=0,_ii4=points.length;_i66<_ii4;_i66+=2){var _x63=points[_i66];points[_i66]=trX-points[_i66+1];points[_i66+1]=trY-_x63}break;default:throw new Error("Invalid rotation")}return points}function _fromPDFCoordinates(points,rect,rotation){var _rect4=_slicedToArray2(rect,4),blX=_rect4[0],blY=_rect4[1],trX=_rect4[2],trY=_rect4[3];switch(rotation){case 0:for(var _i67=0,ii=points.length;_i67<ii;_i67+=2){points[_i67]-=blX;points[_i67+1]=trY-points[_i67+1]}break;case 90:for(var _i68=0,_ii5=points.length;_i68<_ii5;_i68+=2){var x=points[_i68];points[_i68]=points[_i68+1]-blY;points[_i68+1]=x-blX}break;case 180:for(var _i69=0,_ii6=points.length;_i69<_ii6;_i69+=2){points[_i69]=trX-points[_i69];points[_i69+1]-=blY}break;case 270:for(var _i70=0,_ii7=points.length;_i70<_ii7;_i70+=2){var _x64=points[_i70];points[_i70]=trY-points[_i70+1];points[_i70+1]=trX-_x64}break;default:throw new Error("Invalid rotation")}return points}function _serializePaths2(s,tx,ty,rect){var paths=[];var padding=this.thickness/2;var shiftX=s*tx+padding;var shiftY=s*ty+padding;var _iterator160=_createForOfIteratorHelper(this.paths),_step160;try{for(_iterator160.s();!(_step160=_iterator160.n()).done;){var bezier=_step160.value;var buffer=[];var points=[];for(var j=0,jj=bezier.length;j<jj;j++){var _bezier$j=_slicedToArray2(bezier[j],4),first=_bezier$j[0],control1=_bezier$j[1],control2=_bezier$j[2],second=_bezier$j[3];var p10=s*first[0]+shiftX;var p11=s*first[1]+shiftY;var p20=s*control1[0]+shiftX;var p21=s*control1[1]+shiftY;var p30=s*control2[0]+shiftX;var p31=s*control2[1]+shiftY;var p40=s*second[0]+shiftX;var p41=s*second[1]+shiftY;if(j===0){buffer.push(p10,p11);points.push(p10,p11)}buffer.push(p20,p21,p30,p31,p40,p41);points.push(p20,p21);if(j===jj-1){points.push(p40,p41)}}paths.push({bezier:_classStaticPrivateMethodGet(_class41,_class41,_toPDFCoordinates).call(_class41,buffer,rect,this.rotation),points:_classStaticPrivateMethodGet(_class41,_class41,_toPDFCoordinates).call(_class41,points,rect,this.rotation)})}}catch(err){_iterator160.e(err)}finally{_iterator160.f()}return paths}function _getBbox2(){var xMin=Infinity;var xMax=-Infinity;var yMin=Infinity;var yMax=-Infinity;var _iterator161=_createForOfIteratorHelper(this.paths),_step161;try{for(_iterator161.s();!(_step161=_iterator161.n()).done;){var path=_step161.value;var _iterator162=_createForOfIteratorHelper(path),_step162;try{for(_iterator162.s();!(_step162=_iterator162.n()).done;){var _util$Util9;var _step162$value=_slicedToArray2(_step162.value,4),first=_step162$value[0],control1=_step162$value[1],control2=_step162$value[2],second=_step162$value[3];var bbox=(_util$Util9=_util.Util).bezierBoundingBox.apply(_util$Util9,_toConsumableArray2(first).concat(_toConsumableArray2(control1),_toConsumableArray2(control2),_toConsumableArray2(second)));xMin=Math.min(xMin,bbox[0]);yMin=Math.min(yMin,bbox[1]);xMax=Math.max(xMax,bbox[2]);yMax=Math.max(yMax,bbox[3])}}catch(err){_iterator162.e(err)}finally{_iterator162.f()}}}catch(err){_iterator161.e(err)}finally{_iterator161.f()}return[xMin,yMin,xMax,yMax]}function _getPadding2(){return _classPrivateFieldGet(this,_disableEditing)?Math.ceil(this.thickness*this.parentScale):0}function _fitToContent2(){var firstTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.isEmpty()){return}if(!_classPrivateFieldGet(this,_disableEditing)){_classPrivateMethodGet(this,_redraw,_redraw2).call(this);return}var bbox=_classPrivateMethodGet(this,_getBbox,_getBbox2).call(this);var padding=_classPrivateMethodGet(this,_getPadding,_getPadding2).call(this);_classPrivateFieldSet(this,_baseWidth,Math.max(_editor.AnnotationEditor.MIN_SIZE,bbox[2]-bbox[0]));_classPrivateFieldSet(this,_baseHeight,Math.max(_editor.AnnotationEditor.MIN_SIZE,bbox[3]-bbox[1]));var width=Math.ceil(padding+_classPrivateFieldGet(this,_baseWidth)*this.scaleFactor);var height=Math.ceil(padding+_classPrivateFieldGet(this,_baseHeight)*this.scaleFactor);var _this$parentDimension16=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension16[0],parentHeight=_this$parentDimension16[1];this.width=width/parentWidth;this.height=height/parentHeight;this.setAspectRatio(width,height);var prevTranslationX=this.translationX;var prevTranslationY=this.translationY;this.translationX=-bbox[0];this.translationY=-bbox[1];_classPrivateMethodGet(this,_setCanvasDims,_setCanvasDims2).call(this);_classPrivateMethodGet(this,_redraw,_redraw2).call(this);_classPrivateFieldSet(this,_realWidth,width);_classPrivateFieldSet(this,_realHeight,height);this.setDims(width,height);var unscaledPadding=firstTime?padding/this.scaleFactor/2:0;this.translate(prevTranslationX-this.translationX-unscaledPadding,prevTranslationY-this.translationY-unscaledPadding)}_defineProperty2(InkEditor,"_defaultColor",null);_defineProperty2(InkEditor,"_defaultOpacity",1);_defineProperty2(InkEditor,"_defaultThickness",1);_defineProperty2(InkEditor,"_type","ink");exports.InkEditor=InkEditor}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){var _class42;Object.defineProperty(exports,"__esModule",{value:true});exports.StampEditor=void 0;var _util=__w_pdfjs_require__(1);var _editor=__w_pdfjs_require__(4);var _display_utils=__w_pdfjs_require__(6);var _annotation_layer=__w_pdfjs_require__(29);var _bitmap=new WeakMap;var _bitmapId=new WeakMap;var _bitmapPromise=new WeakMap;var _bitmapUrl=new WeakMap;var _bitmapFile=new WeakMap;var _canvas2=new WeakMap;var _observer2=new WeakMap;var _resizeTimeoutId=new WeakMap;var _isSvg=new WeakMap;var _hasBeenAddedInUndoStack=new WeakMap;var _getBitmapFetched=new WeakSet;var _getBitmapDone=new WeakSet;var _getBitmap=new WeakSet;var _createCanvas4=new WeakSet;var _setDimensions=new WeakSet;var _scaleBitmap=new WeakSet;var _drawBitmap=new WeakSet;var _serializeBitmap=new WeakSet;var _createObserver3=new WeakSet;var StampEditor=function(_editor$AnnotationEdi3){_inherits2(StampEditor,_editor$AnnotationEdi3);var _super65=_createSuper(StampEditor);function StampEditor(params){var _this138;_classCallCheck2(this,StampEditor);_this138=_super65.call(this,_objectSpread2(_objectSpread2({},params),{},{name:"stampEditor"}));_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_createObserver3);_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_serializeBitmap);_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_drawBitmap);_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_scaleBitmap);_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_setDimensions);_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_createCanvas4);_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_getBitmap);_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_getBitmapDone);_classPrivateMethodInitSpec(_assertThisInitialized(_this138),_getBitmapFetched);_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_bitmap,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_bitmapId,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_bitmapPromise,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_bitmapUrl,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_bitmapFile,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_canvas2,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_observer2,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_resizeTimeoutId,{writable:true,value:null});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_isSvg,{writable:true,value:false});_classPrivateFieldInitSpec(_assertThisInitialized(_this138),_hasBeenAddedInUndoStack,{writable:true,value:false});_classPrivateFieldSet(_assertThisInitialized(_this138),_bitmapUrl,params.bitmapUrl);_classPrivateFieldSet(_assertThisInitialized(_this138),_bitmapFile,params.bitmapFile);return _this138}_createClass2(StampEditor,[{key:"remove",value:function remove(){if(_classPrivateFieldGet(this,_bitmapId)){var _classPrivateFieldGet34,_classPrivateFieldGet35;_classPrivateFieldSet(this,_bitmap,null);this._uiManager.imageManager.deleteId(_classPrivateFieldGet(this,_bitmapId));(_classPrivateFieldGet34=_classPrivateFieldGet(this,_canvas2))===null||_classPrivateFieldGet34===void 0||_classPrivateFieldGet34.remove();_classPrivateFieldSet(this,_canvas2,null);(_classPrivateFieldGet35=_classPrivateFieldGet(this,_observer2))===null||_classPrivateFieldGet35===void 0||_classPrivateFieldGet35.disconnect();_classPrivateFieldSet(this,_observer2,null)}_get5(_getPrototypeOf(StampEditor.prototype),"remove",this).call(this)}},{key:"rebuild",value:function rebuild(){if(!this.parent){if(_classPrivateFieldGet(this,_bitmapId)){_classPrivateMethodGet(this,_getBitmap,_getBitmap2).call(this)}return}_get5(_getPrototypeOf(StampEditor.prototype),"rebuild",this).call(this);if(this.div===null){return}if(_classPrivateFieldGet(this,_bitmapId)){_classPrivateMethodGet(this,_getBitmap,_getBitmap2).call(this)}if(!this.isAttachedToDOM){this.parent.add(this)}}},{key:"onceAdded",value:function onceAdded(){this._isDraggable=true;this.div.focus()}},{key:"isEmpty",value:function isEmpty(){return!(_classPrivateFieldGet(this,_bitmapPromise)||_classPrivateFieldGet(this,_bitmap)||_classPrivateFieldGet(this,_bitmapUrl)||_classPrivateFieldGet(this,_bitmapFile))}},{key:"isResizable",get:function get(){return true}},{key:"render",value:function render(){if(this.div){return this.div}var baseX,baseY;if(this.width){baseX=this.x;baseY=this.y}_get5(_getPrototypeOf(StampEditor.prototype),"render",this).call(this);this.div.hidden=true;if(_classPrivateFieldGet(this,_bitmap)){_classPrivateMethodGet(this,_createCanvas4,_createCanvas5).call(this)}else{_classPrivateMethodGet(this,_getBitmap,_getBitmap2).call(this)}if(this.width){var _this$parentDimension17=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension17[0],parentHeight=_this$parentDimension17[1];this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight)}return this.div}},{key:"serialize",value:function serialize(){var isForCopying=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.isEmpty()){return null}var serialized={annotationType:_util.AnnotationEditorType.STAMP,bitmapId:_classPrivateFieldGet(this,_bitmapId),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:_classPrivateFieldGet(this,_isSvg),structTreeParentId:this._structTreeParentId};if(isForCopying){serialized.bitmapUrl=_classPrivateMethodGet(this,_serializeBitmap,_serializeBitmap2).call(this,true);serialized.accessibilityData=this.altTextData;return serialized}var _this$altTextData=this.altTextData,decorative=_this$altTextData.decorative,altText=_this$altTextData.altText;if(!decorative&&altText){serialized.accessibilityData={type:"Figure",alt:altText}}if(context===null){return serialized}context.stamps||(context.stamps=new Map);var area=_classPrivateFieldGet(this,_isSvg)?(serialized.rect[2]-serialized.rect[0])*(serialized.rect[3]-serialized.rect[1]):null;if(!context.stamps.has(_classPrivateFieldGet(this,_bitmapId))){context.stamps.set(_classPrivateFieldGet(this,_bitmapId),{area:area,serialized:serialized});serialized.bitmap=_classPrivateMethodGet(this,_serializeBitmap,_serializeBitmap2).call(this,false)}else if(_classPrivateFieldGet(this,_isSvg)){var prevData=context.stamps.get(_classPrivateFieldGet(this,_bitmapId));if(area>prevData.area){prevData.area=area;prevData.serialized.bitmap.close();prevData.serialized.bitmap=_classPrivateMethodGet(this,_serializeBitmap,_serializeBitmap2).call(this,false)}}return serialized}}],[{key:"initialize",value:function initialize(l10n){_editor.AnnotationEditor.initialize(l10n)}},{key:"supportedTypes",get:function get(){var types=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,_util.shadow)(this,"supportedTypes",types.map(function(type){return"image/".concat(type)}))}},{key:"supportedTypesStr",get:function get(){return(0,_util.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}},{key:"isHandlingMimeForPasting",value:function isHandlingMimeForPasting(mime){return this.supportedTypes.includes(mime)}},{key:"paste",value:function paste(item,parent){parent.pasteEditor(_util.AnnotationEditorType.STAMP,{bitmapFile:item.getAsFile()})}},{key:"deserialize",value:function deserialize(data,parent,uiManager){if(data instanceof _annotation_layer.StampAnnotationElement){return null}var editor=_get5(_getPrototypeOf(StampEditor),"deserialize",this).call(this,data,parent,uiManager);var rect=data.rect,bitmapUrl=data.bitmapUrl,bitmapId=data.bitmapId,isSvg=data.isSvg,accessibilityData=data.accessibilityData;if(bitmapId&&uiManager.imageManager.isValidId(bitmapId)){_classPrivateFieldSet(editor,_bitmapId,bitmapId)}else{_classPrivateFieldSet(editor,_bitmapUrl,bitmapUrl)}_classPrivateFieldSet(editor,_isSvg,isSvg);var _editor$pageDimension3=_slicedToArray2(editor.pageDimensions,2),parentWidth=_editor$pageDimension3[0],parentHeight=_editor$pageDimension3[1];editor.width=(rect[2]-rect[0])/parentWidth;editor.height=(rect[3]-rect[1])/parentHeight;if(accessibilityData){editor.altTextData=accessibilityData}return editor}}]);return StampEditor}(_editor.AnnotationEditor);_class42=StampEditor;function _getBitmapFetched2(data){var fromId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!data){this.remove();return}_classPrivateFieldSet(this,_bitmap,data.bitmap);if(!fromId){_classPrivateFieldSet(this,_bitmapId,data.id);_classPrivateFieldSet(this,_isSvg,data.isSvg)}_classPrivateMethodGet(this,_createCanvas4,_createCanvas5).call(this)}function _getBitmapDone2(){_classPrivateFieldSet(this,_bitmapPromise,null);this._uiManager.enableWaiting(false);if(_classPrivateFieldGet(this,_canvas2)){this.div.focus()}}function _getBitmap2(){var _this139=this;if(_classPrivateFieldGet(this,_bitmapId)){this._uiManager.enableWaiting(true);this._uiManager.imageManager.getFromId(_classPrivateFieldGet(this,_bitmapId)).then(function(data){return _classPrivateMethodGet(_this139,_getBitmapFetched,_getBitmapFetched2).call(_this139,data,true)})["finally"](function(){return _classPrivateMethodGet(_this139,_getBitmapDone,_getBitmapDone2).call(_this139)});return}if(_classPrivateFieldGet(this,_bitmapUrl)){var url=_classPrivateFieldGet(this,_bitmapUrl);_classPrivateFieldSet(this,_bitmapUrl,null);this._uiManager.enableWaiting(true);_classPrivateFieldSet(this,_bitmapPromise,this._uiManager.imageManager.getFromUrl(url).then(function(data){return _classPrivateMethodGet(_this139,_getBitmapFetched,_getBitmapFetched2).call(_this139,data)})["finally"](function(){return _classPrivateMethodGet(_this139,_getBitmapDone,_getBitmapDone2).call(_this139)}));return}if(_classPrivateFieldGet(this,_bitmapFile)){var file=_classPrivateFieldGet(this,_bitmapFile);_classPrivateFieldSet(this,_bitmapFile,null);this._uiManager.enableWaiting(true);_classPrivateFieldSet(this,_bitmapPromise,this._uiManager.imageManager.getFromFile(file).then(function(data){return _classPrivateMethodGet(_this139,_getBitmapFetched,_getBitmapFetched2).call(_this139,data)})["finally"](function(){return _classPrivateMethodGet(_this139,_getBitmapDone,_getBitmapDone2).call(_this139)}));return}var input=document.createElement("input");input.type="file";input.accept=_class42.supportedTypesStr;_classPrivateFieldSet(this,_bitmapPromise,new Promise(function(resolve){input.addEventListener("change",_asyncToGenerator(_regeneratorRuntime().mark(function _callee65(){var _data9;return _regeneratorRuntime().wrap(function _callee65$(_context66){while(1)switch(_context66.prev=_context66.next){case 0:if(!(!input.files||input.files.length===0)){_context66.next=4;break}_this139.remove();_context66.next=9;break;case 4:_this139._uiManager.enableWaiting(true);_context66.next=7;return _this139._uiManager.imageManager.getFromFile(input.files[0]);case 7:_data9=_context66.sent;_classPrivateMethodGet(_this139,_getBitmapFetched,_getBitmapFetched2).call(_this139,_data9);case 9:resolve();case 10:case"end":return _context66.stop()}},_callee65)})));input.addEventListener("cancel",function(){_this139.remove();resolve()})})["finally"](function(){return _classPrivateMethodGet(_this139,_getBitmapDone,_getBitmapDone2).call(_this139)}));input.click()}function _createCanvas5(){var div=this.div;var _classPrivateFieldGet36=_classPrivateFieldGet(this,_bitmap),width=_classPrivateFieldGet36.width,height=_classPrivateFieldGet36.height;var _this$pageDimensions8=_slicedToArray2(this.pageDimensions,2),pageWidth=_this$pageDimensions8[0],pageHeight=_this$pageDimensions8[1];var MAX_RATIO=0.75;if(this.width){width=this.width*pageWidth;height=this.height*pageHeight}else if(width>MAX_RATIO*pageWidth||height>MAX_RATIO*pageHeight){var factor=Math.min(MAX_RATIO*pageWidth/width,MAX_RATIO*pageHeight/height);width*=factor;height*=factor}var _this$parentDimension18=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension18[0],parentHeight=_this$parentDimension18[1];this.setDims(width*parentWidth/pageWidth,height*parentHeight/pageHeight);this._uiManager.enableWaiting(false);var canvas=_classPrivateFieldSet(this,_canvas2,document.createElement("canvas"));div.append(canvas);div.hidden=false;_classPrivateMethodGet(this,_drawBitmap,_drawBitmap2).call(this,width,height);_classPrivateMethodGet(this,_createObserver3,_createObserver4).call(this);if(!_classPrivateFieldGet(this,_hasBeenAddedInUndoStack)){this.parent.addUndoableEditor(this);_classPrivateFieldSet(this,_hasBeenAddedInUndoStack,true)}this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}});this.addAltTextButton()}function _setDimensions2(width,height){var _this$_initialOptions2,_this140=this;var _this$parentDimension19=_slicedToArray2(this.parentDimensions,2),parentWidth=_this$parentDimension19[0],parentHeight=_this$parentDimension19[1];this.width=width/parentWidth;this.height=height/parentHeight;this.setDims(width,height);if((_this$_initialOptions2=this._initialOptions)!==null&&_this$_initialOptions2!==void 0&&_this$_initialOptions2.isCentered){this.center()}else{this.fixAndSetPosition()}this._initialOptions=null;if(_classPrivateFieldGet(this,_resizeTimeoutId)!==null){clearTimeout(_classPrivateFieldGet(this,_resizeTimeoutId))}var TIME_TO_WAIT=200;_classPrivateFieldSet(this,_resizeTimeoutId,setTimeout(function(){_classPrivateFieldSet(_this140,_resizeTimeoutId,null);_classPrivateMethodGet(_this140,_drawBitmap,_drawBitmap2).call(_this140,width,height)},TIME_TO_WAIT))}function _scaleBitmap2(width,height){var _classPrivateFieldGet37=_classPrivateFieldGet(this,_bitmap),bitmapWidth=_classPrivateFieldGet37.width,bitmapHeight=_classPrivateFieldGet37.height;var newWidth=bitmapWidth;var newHeight=bitmapHeight;var bitmap=_classPrivateFieldGet(this,_bitmap);while(newWidth>2*width||newHeight>2*height){var prevWidth=newWidth;var prevHeight=newHeight;if(newWidth>2*width){newWidth=newWidth>=16384?Math.floor(newWidth/2)-1:Math.ceil(newWidth/2)}if(newHeight>2*height){newHeight=newHeight>=16384?Math.floor(newHeight/2)-1:Math.ceil(newHeight/2)}var offscreen=new OffscreenCanvas(newWidth,newHeight);var ctx=offscreen.getContext("2d");ctx.drawImage(bitmap,0,0,prevWidth,prevHeight,0,0,newWidth,newHeight);bitmap=offscreen.transferToImageBitmap()}return bitmap}function _drawBitmap2(width,height){width=Math.ceil(width);height=Math.ceil(height);var canvas=_classPrivateFieldGet(this,_canvas2);if(!canvas||canvas.width===width&&canvas.height===height){return}canvas.width=width;canvas.height=height;var bitmap=_classPrivateFieldGet(this,_isSvg)?_classPrivateFieldGet(this,_bitmap):_classPrivateMethodGet(this,_scaleBitmap,_scaleBitmap2).call(this,width,height);var ctx=canvas.getContext("2d");ctx.filter=this._uiManager.hcmFilter;ctx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,width,height)}function _serializeBitmap2(toUrl){if(toUrl){if(_classPrivateFieldGet(this,_isSvg)){var url=this._uiManager.imageManager.getSvgUrl(_classPrivateFieldGet(this,_bitmapId));if(url){return url}}var canvas=document.createElement("canvas");var _classPrivateFieldGet38=_classPrivateFieldGet(this,_bitmap);canvas.width=_classPrivateFieldGet38.width;canvas.height=_classPrivateFieldGet38.height;var ctx=canvas.getContext("2d");ctx.drawImage(_classPrivateFieldGet(this,_bitmap),0,0);return canvas.toDataURL()}if(_classPrivateFieldGet(this,_isSvg)){var _this$pageDimensions9=_slicedToArray2(this.pageDimensions,2),pageWidth=_this$pageDimensions9[0],pageHeight=_this$pageDimensions9[1];var width=Math.round(this.width*pageWidth*_display_utils.PixelsPerInch.PDF_TO_CSS_UNITS);var height=Math.round(this.height*pageHeight*_display_utils.PixelsPerInch.PDF_TO_CSS_UNITS);var offscreen=new OffscreenCanvas(width,height);var _ctx=offscreen.getContext("2d");_ctx.drawImage(_classPrivateFieldGet(this,_bitmap),0,0,_classPrivateFieldGet(this,_bitmap).width,_classPrivateFieldGet(this,_bitmap).height,0,0,width,height);return offscreen.transferToImageBitmap()}return structuredClone(_classPrivateFieldGet(this,_bitmap))}function _createObserver4(){var _this141=this;_classPrivateFieldSet(this,_observer2,new ResizeObserver(function(entries){var rect=entries[0].contentRect;if(rect.width&&rect.height){_classPrivateMethodGet(_this141,_setDimensions,_setDimensions2).call(_this141,rect.width,rect.height)}}));_classPrivateFieldGet(this,_observer2).observe(this.div)}_defineProperty2(StampEditor,"_type","stamp");exports.StampEditor=StampEditor})];var __webpack_module_cache__={};function __w_pdfjs_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==undefined){return cachedModule.exports}var module=__webpack_module_cache__[moduleId]={exports:{}};__webpack_modules__[moduleId](module,module.exports,__w_pdfjs_require__);return module.exports}var __webpack_exports__={};(function(){var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"AbortException",{enumerable:true,get:function get(){return _util.AbortException}});Object.defineProperty(exports,"AnnotationEditorLayer",{enumerable:true,get:function get(){return _annotation_editor_layer.AnnotationEditorLayer}});Object.defineProperty(exports,"AnnotationEditorParamsType",{enumerable:true,get:function get(){return _util.AnnotationEditorParamsType}});Object.defineProperty(exports,"AnnotationEditorType",{enumerable:true,get:function get(){return _util.AnnotationEditorType}});Object.defineProperty(exports,"AnnotationEditorUIManager",{enumerable:true,get:function get(){return _tools.AnnotationEditorUIManager}});Object.defineProperty(exports,"AnnotationLayer",{enumerable:true,get:function get(){return _annotation_layer.AnnotationLayer}});Object.defineProperty(exports,"AnnotationMode",{enumerable:true,get:function get(){return _util.AnnotationMode}});Object.defineProperty(exports,"CMapCompressionType",{enumerable:true,get:function get(){return _util.CMapCompressionType}});Object.defineProperty(exports,"DOMSVGFactory",{enumerable:true,get:function get(){return _display_utils.DOMSVGFactory}});Object.defineProperty(exports,"FeatureTest",{enumerable:true,get:function get(){return _util.FeatureTest}});Object.defineProperty(exports,"GlobalWorkerOptions",{enumerable:true,get:function get(){return _worker_options.GlobalWorkerOptions}});Object.defineProperty(exports,"ImageKind",{enumerable:true,get:function get(){return _util.ImageKind}});Object.defineProperty(exports,"InvalidPDFException",{enumerable:true,get:function get(){return _util.InvalidPDFException}});Object.defineProperty(exports,"MissingPDFException",{enumerable:true,get:function get(){return _util.MissingPDFException}});Object.defineProperty(exports,"OPS",{enumerable:true,get:function get(){return _util.OPS}});Object.defineProperty(exports,"PDFDataRangeTransport",{enumerable:true,get:function get(){return _api.PDFDataRangeTransport}});Object.defineProperty(exports,"PDFDateString",{enumerable:true,get:function get(){return _display_utils.PDFDateString}});Object.defineProperty(exports,"PDFWorker",{enumerable:true,get:function get(){return _api.PDFWorker}});Object.defineProperty(exports,"PasswordResponses",{enumerable:true,get:function get(){return _util.PasswordResponses}});Object.defineProperty(exports,"PermissionFlag",{enumerable:true,get:function get(){return _util.PermissionFlag}});Object.defineProperty(exports,"PixelsPerInch",{enumerable:true,get:function get(){return _display_utils.PixelsPerInch}});Object.defineProperty(exports,"PromiseCapability",{enumerable:true,get:function get(){return _util.PromiseCapability}});Object.defineProperty(exports,"RenderingCancelledException",{enumerable:true,get:function get(){return _display_utils.RenderingCancelledException}});Object.defineProperty(exports,"SVGGraphics",{enumerable:true,get:function get(){return _api.SVGGraphics}});Object.defineProperty(exports,"UnexpectedResponseException",{enumerable:true,get:function get(){return _util.UnexpectedResponseException}});Object.defineProperty(exports,"Util",{enumerable:true,get:function get(){return _util.Util}});Object.defineProperty(exports,"VerbosityLevel",{enumerable:true,get:function get(){return _util.VerbosityLevel}});Object.defineProperty(exports,"XfaLayer",{enumerable:true,get:function get(){return _xfa_layer.XfaLayer}});Object.defineProperty(exports,"build",{enumerable:true,get:function get(){return _api.build}});Object.defineProperty(exports,"createValidAbsoluteUrl",{enumerable:true,get:function get(){return _util.createValidAbsoluteUrl}});Object.defineProperty(exports,"getDocument",{enumerable:true,get:function get(){return _api.getDocument}});Object.defineProperty(exports,"getFilenameFromUrl",{enumerable:true,get:function get(){return _display_utils.getFilenameFromUrl}});Object.defineProperty(exports,"getPdfFilenameFromUrl",{enumerable:true,get:function get(){return _display_utils.getPdfFilenameFromUrl}});Object.defineProperty(exports,"getXfaPageViewport",{enumerable:true,get:function get(){return _display_utils.getXfaPageViewport}});Object.defineProperty(exports,"isDataScheme",{enumerable:true,get:function get(){return _display_utils.isDataScheme}});Object.defineProperty(exports,"isPdfFile",{enumerable:true,get:function get(){return _display_utils.isPdfFile}});Object.defineProperty(exports,"loadScript",{enumerable:true,get:function get(){return _display_utils.loadScript}});Object.defineProperty(exports,"noContextMenu",{enumerable:true,get:function get(){return _display_utils.noContextMenu}});Object.defineProperty(exports,"normalizeUnicode",{enumerable:true,get:function get(){return _util.normalizeUnicode}});Object.defineProperty(exports,"renderTextLayer",{enumerable:true,get:function get(){return _text_layer.renderTextLayer}});Object.defineProperty(exports,"setLayerDimensions",{enumerable:true,get:function get(){return _display_utils.setLayerDimensions}});Object.defineProperty(exports,"shadow",{enumerable:true,get:function get(){return _util.shadow}});Object.defineProperty(exports,"updateTextLayer",{enumerable:true,get:function get(){return _text_layer.updateTextLayer}});Object.defineProperty(exports,"version",{enumerable:true,get:function get(){return _api.version}});var _util=__w_pdfjs_require__(1);var _api=__w_pdfjs_require__(2);var _display_utils=__w_pdfjs_require__(6);var _text_layer=__w_pdfjs_require__(26);var _annotation_editor_layer=__w_pdfjs_require__(27);var _tools=__w_pdfjs_require__(5);var _annotation_layer=__w_pdfjs_require__(29);var _worker_options=__w_pdfjs_require__(14);var _xfa_layer=__w_pdfjs_require__(32)})();return __webpack_exports__}()})})(pdf);var pdfExports=pdf.exports;var pdfjsLib=getDefaultExportFromCjs(pdfExports);var pdf_viewer={exports:{}};(function(module,exports){(function webpackUniversalModuleDefinition(root,factory){module.exports=root.pdfjsViewer=factory()})(globalThis,function(){return function(){var __webpack_modules__=[,(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFFindController=exports.FindState=void 0;var _ui_utils=__w_pdfjs_require__(2);var _pdf_find_utils=__w_pdfjs_require__(3);var _pdfjsLib=__w_pdfjs_require__(4);var FindState={FOUND:0,NOT_FOUND:1,WRAPPED:2,PENDING:3};exports.FindState=FindState;var FIND_TIMEOUT=250;var MATCH_SCROLL_OFFSET_TOP=-50;var MATCH_SCROLL_OFFSET_LEFT=-400;var CHARACTERS_TO_NORMALIZE={"\u2010":"-","\u2018":"'","\u2019":"'","\u201A":"'","\u201B":"'","\u201C":"\"","\u201D":"\"","\u201E":"\"","\u201F":"\"","\xBC":"1/4","\xBD":"1/2","\xBE":"3/4"};var DIACRITICS_EXCEPTION=new Set([12441,12442,2381,2509,2637,2765,2893,3021,3149,3277,3387,3388,3405,3530,3642,3770,3972,4153,4154,5908,5940,6098,6752,6980,7082,7083,7154,7155,11647,43014,43052,43204,43347,43456,43766,44013,3158,3953,3954,3962,3963,3964,3965,3968,3956]);var DIACRITICS_EXCEPTION_STR;var DIACRITICS_REG_EXP=/(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CF3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECE\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDEFD-\uDEFF\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDE41\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6\uDF00\uDF01\uDF03\uDF34-\uDF3A\uDF3E-\uDF42]|\uD80D[\uDC40\uDC47-\uDC55]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDC8F\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD839[\uDCEC-\uDCEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF])+/g;var SPECIAL_CHARS_REG_EXP=/([\$\(-\+\.\?\[-\^\{-\}])|((?:[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))|([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+)|((?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CF3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECE\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDEFD-\uDEFF\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDE41\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6\uDF00\uDF01\uDF03\uDF34-\uDF3A\uDF3E-\uDF42]|\uD80D[\uDC40\uDC47-\uDC55]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDC8F\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD839[\uDCEC-\uDCEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF]))|((?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF]))/g;var NOT_DIACRITIC_FROM_END_REG_EXP=/((?:[\0-\u02FF\u0370-\u0482\u048A-\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u060F\u061B-\u064A\u0660-\u066F\u0671-\u06D5\u06DD\u06DE\u06E5\u06E6\u06E9\u06EE-\u0710\u0712-\u072F\u074B-\u07A5\u07B1-\u07EA\u07F4-\u07FC\u07FE-\u0815\u081A\u0824\u0828\u082E-\u0858\u085C-\u0897\u08A0-\u08C9\u08E2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0964-\u0980\u0984-\u09BB\u09BD\u09C5\u09C6\u09C9\u09CA\u09CE-\u09D6\u09D8-\u09E1\u09E4-\u09FD\u09FF\u0A00\u0A04-\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A6F\u0A72-\u0A74\u0A76-\u0A80\u0A84-\u0ABB\u0ABD\u0AC6\u0ACA\u0ACE-\u0AE1\u0AE4-\u0AF9\u0B00\u0B04-\u0B3B\u0B3D\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B54\u0B58-\u0B61\u0B64-\u0B81\u0B83-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE-\u0BD6\u0BD8-\u0BFF\u0C05-\u0C3B\u0C3D\u0C45\u0C49\u0C4E-\u0C54\u0C57-\u0C61\u0C64-\u0C80\u0C84-\u0CBB\u0CBD\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CE1\u0CE4-\u0CF2\u0CF4-\u0CFF\u0D04-\u0D3A\u0D3D\u0D45\u0D49\u0D4E-\u0D56\u0D58-\u0D61\u0D64-\u0D80\u0D84-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF4-\u0E30\u0E32\u0E33\u0E3B-\u0E46\u0E4F-\u0EB0\u0EB2\u0EB3\u0EBD-\u0EC7\u0ECF-\u0F17\u0F1A-\u0F34\u0F36\u0F38\u0F3A-\u0F3D\u0F40-\u0F70\u0F85\u0F88-\u0F8C\u0F98\u0FBD-\u0FC5\u0FC7-\u102A\u103F-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u1090-\u1099\u109E-\u135C\u1360-\u1711\u1716-\u1731\u1735-\u1751\u1754-\u1771\u1774-\u17B3\u17D4-\u17DC\u17DE-\u180A\u180E\u1810-\u1884\u1887-\u18A8\u18AA-\u191F\u192C-\u192F\u193C-\u1A16\u1A1C-\u1A54\u1A5F\u1A7D\u1A7E\u1A80-\u1AAF\u1ACF-\u1AFF\u1B05-\u1B33\u1B45-\u1B6A\u1B74-\u1B7F\u1B83-\u1BA0\u1BAE-\u1BE5\u1BF4-\u1C23\u1C38-\u1CCF\u1CD3\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA-\u1DBF\u1E00-\u20CF\u20F1-\u2CEE\u2CF2-\u2D7E\u2D80-\u2DDF\u2E00-\u3029\u3030-\u3098\u309B-\uA66E\uA673\uA67E-\uA69D\uA6A0-\uA6EF\uA6F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA828-\uA82B\uA82D-\uA87F\uA882-\uA8B3\uA8C6-\uA8DF\uA8F2-\uA8FE\uA900-\uA925\uA92E-\uA946\uA954-\uA97F\uA984-\uA9B2\uA9C1-\uA9E4\uA9E6-\uAA28\uAA37-\uAA42\uAA44-\uAA4B\uAA4E-\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2-\uAAEA\uAAF0-\uAAF4\uAAF7-\uABE2\uABEB\uABEE-\uD7FF\uE000-\uFB1D\uFB1F-\uFDFF\uFE10-\uFE1F\uFE30-\uFFFF]|\uD800[\uDC00-\uDDFC\uDDFE-\uDEDF\uDEE1-\uDF75\uDF7B-\uDFFF]|[\uD801\uD808-\uD80C\uD80E-\uD819\uD81C-\uD82E\uD830-\uD832\uD835\uD837\uD83B-\uDB3F\uDB41-\uDBFF][\uDC00-\uDFFF]|\uD802[\uDC00-\uDE00\uDE04\uDE07-\uDE0B\uDE10-\uDE37\uDE3B-\uDE3E\uDE40-\uDEE4\uDEE7-\uDFFF]|\uD803[\uDC00-\uDD23\uDD28-\uDEAA\uDEAD-\uDEFC\uDF00-\uDF45\uDF51-\uDF81\uDF86-\uDFFF]|\uD804[\uDC03-\uDC37\uDC47-\uDC6F\uDC71\uDC72\uDC75-\uDC7E\uDC83-\uDCAF\uDCBB-\uDCC1\uDCC3-\uDCFF\uDD03-\uDD26\uDD35-\uDD44\uDD47-\uDD72\uDD74-\uDD7F\uDD83-\uDDB2\uDDC1-\uDDC8\uDDCD\uDDD0-\uDE2B\uDE38-\uDE3D\uDE3F\uDE40\uDE42-\uDEDE\uDEEB-\uDEFF\uDF04-\uDF3A\uDF3D\uDF45\uDF46\uDF49\uDF4A\uDF4E-\uDF56\uDF58-\uDF61\uDF64\uDF65\uDF6D-\uDF6F\uDF75-\uDFFF]|\uD805[\uDC00-\uDC34\uDC47-\uDC5D\uDC5F-\uDCAF\uDCC4-\uDDAE\uDDB6\uDDB7\uDDC1-\uDDDB\uDDDE-\uDE2F\uDE41-\uDEAA\uDEB8-\uDF1C\uDF2C-\uDFFF]|\uD806[\uDC00-\uDC2B\uDC3B-\uDD2F\uDD36\uDD39\uDD3A\uDD3F\uDD41\uDD44-\uDDD0\uDDD8\uDDD9\uDDE1-\uDDE3\uDDE5-\uDE00\uDE0B-\uDE32\uDE3A\uDE3F-\uDE46\uDE48-\uDE50\uDE5C-\uDE89\uDE9A-\uDFFF]|\uD807[\uDC00-\uDC2E\uDC37\uDC40-\uDC91\uDCA8\uDCB7-\uDD30\uDD37-\uDD39\uDD3B\uDD3E\uDD46\uDD48-\uDD89\uDD8F\uDD92\uDD98-\uDEF2\uDEF7-\uDEFF\uDF02\uDF04-\uDF33\uDF3B-\uDF3D\uDF43-\uDFFF]|\uD80D[\uDC00-\uDC3F\uDC41-\uDC46\uDC56-\uDFFF]|\uD81A[\uDC00-\uDEEF\uDEF5-\uDF2F\uDF37-\uDFFF]|\uD81B[\uDC00-\uDF4E\uDF50\uDF88-\uDF8E\uDF93-\uDFE3\uDFE5-\uDFEF\uDFF2-\uDFFF]|\uD82F[\uDC00-\uDC9C\uDC9F-\uDFFF]|\uD833[\uDC00-\uDEFF\uDF2E\uDF2F\uDF47-\uDFFF]|\uD834[\uDC00-\uDD64\uDD6A-\uDD6C\uDD73-\uDD7A\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDE41\uDE45-\uDFFF]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85-\uDE9A\uDEA0\uDEB0-\uDFFF]|\uD838[\uDC07\uDC19\uDC1A\uDC22\uDC25\uDC2B-\uDC8E\uDC90-\uDD2F\uDD37-\uDEAD\uDEAF-\uDEEB\uDEF0-\uDFFF]|\uD839[\uDC00-\uDCEB\uDCF0-\uDFFF]|\uD83A[\uDC00-\uDCCF\uDCD7-\uDD43\uDD4B-\uDFFF]|\uDB40[\uDC00-\uDCFF\uDDF0-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CF3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECE\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDEFD-\uDEFF\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDE41\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6\uDF00\uDF01\uDF03\uDF34-\uDF3A\uDF3E-\uDF42]|\uD80D[\uDC40\uDC47-\uDC55]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDC8F\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD839[\uDCEC-\uDCEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF])*$/;var NOT_DIACRITIC_FROM_START_REG_EXP=/^(?:[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u0898-\u089F\u08CA-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3C\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CF3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECE\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1715\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u180F\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ACE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD803[\uDD24-\uDD27\uDEAB\uDEAC\uDEFD-\uDEFF\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC70\uDC73\uDC74\uDC7F-\uDC82\uDCB0-\uDCBA\uDCC2\uDD00-\uDD02\uDD27-\uDD34\uDD45\uDD46\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDDC9-\uDDCC\uDDCE\uDDCF\uDE2C-\uDE37\uDE3E\uDE41\uDEDF-\uDEEA\uDF00-\uDF03\uDF3B\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC35-\uDC46\uDC5E\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDDDC\uDDDD\uDE30-\uDE40\uDEAB-\uDEB7\uDF1D-\uDF2B]|\uD806[\uDC2C-\uDC3A\uDD30-\uDD35\uDD37\uDD38\uDD3B-\uDD3E\uDD40\uDD42\uDD43\uDDD1-\uDDD7\uDDDA-\uDDE0\uDDE4\uDE01-\uDE0A\uDE33-\uDE39\uDE3B-\uDE3E\uDE47\uDE51-\uDE5B\uDE8A-\uDE99]|\uD807[\uDC2F-\uDC36\uDC38-\uDC3F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD31-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD45\uDD47\uDD8A-\uDD8E\uDD90\uDD91\uDD93-\uDD97\uDEF3-\uDEF6\uDF00\uDF01\uDF03\uDF34-\uDF3A\uDF3E-\uDF42]|\uD80D[\uDC40\uDC47-\uDC55]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF4F\uDF51-\uDF87\uDF8F-\uDF92\uDFE4\uDFF0\uDFF1]|\uD82F[\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDC8F\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD839[\uDCEC-\uDCEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD4A]|\uDB40[\uDD00-\uDDEF])*((?:[\0-\u02FF\u0370-\u0482\u048A-\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u060F\u061B-\u064A\u0660-\u066F\u0671-\u06D5\u06DD\u06DE\u06E5\u06E6\u06E9\u06EE-\u0710\u0712-\u072F\u074B-\u07A5\u07B1-\u07EA\u07F4-\u07FC\u07FE-\u0815\u081A\u0824\u0828\u082E-\u0858\u085C-\u0897\u08A0-\u08C9\u08E2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0964-\u0980\u0984-\u09BB\u09BD\u09C5\u09C6\u09C9\u09CA\u09CE-\u09D6\u09D8-\u09E1\u09E4-\u09FD\u09FF\u0A00\u0A04-\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A6F\u0A72-\u0A74\u0A76-\u0A80\u0A84-\u0ABB\u0ABD\u0AC6\u0ACA\u0ACE-\u0AE1\u0AE4-\u0AF9\u0B00\u0B04-\u0B3B\u0B3D\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B54\u0B58-\u0B61\u0B64-\u0B81\u0B83-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE-\u0BD6\u0BD8-\u0BFF\u0C05-\u0C3B\u0C3D\u0C45\u0C49\u0C4E-\u0C54\u0C57-\u0C61\u0C64-\u0C80\u0C84-\u0CBB\u0CBD\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CE1\u0CE4-\u0CF2\u0CF4-\u0CFF\u0D04-\u0D3A\u0D3D\u0D45\u0D49\u0D4E-\u0D56\u0D58-\u0D61\u0D64-\u0D80\u0D84-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF4-\u0E30\u0E32\u0E33\u0E3B-\u0E46\u0E4F-\u0EB0\u0EB2\u0EB3\u0EBD-\u0EC7\u0ECF-\u0F17\u0F1A-\u0F34\u0F36\u0F38\u0F3A-\u0F3D\u0F40-\u0F70\u0F85\u0F88-\u0F8C\u0F98\u0FBD-\u0FC5\u0FC7-\u102A\u103F-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u1090-\u1099\u109E-\u135C\u1360-\u1711\u1716-\u1731\u1735-\u1751\u1754-\u1771\u1774-\u17B3\u17D4-\u17DC\u17DE-\u180A\u180E\u1810-\u1884\u1887-\u18A8\u18AA-\u191F\u192C-\u192F\u193C-\u1A16\u1A1C-\u1A54\u1A5F\u1A7D\u1A7E\u1A80-\u1AAF\u1ACF-\u1AFF\u1B05-\u1B33\u1B45-\u1B6A\u1B74-\u1B7F\u1B83-\u1BA0\u1BAE-\u1BE5\u1BF4-\u1C23\u1C38-\u1CCF\u1CD3\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA-\u1DBF\u1E00-\u20CF\u20F1-\u2CEE\u2CF2-\u2D7E\u2D80-\u2DDF\u2E00-\u3029\u3030-\u3098\u309B-\uA66E\uA673\uA67E-\uA69D\uA6A0-\uA6EF\uA6F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA828-\uA82B\uA82D-\uA87F\uA882-\uA8B3\uA8C6-\uA8DF\uA8F2-\uA8FE\uA900-\uA925\uA92E-\uA946\uA954-\uA97F\uA984-\uA9B2\uA9C1-\uA9E4\uA9E6-\uAA28\uAA37-\uAA42\uAA44-\uAA4B\uAA4E-\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2-\uAAEA\uAAF0-\uAAF4\uAAF7-\uABE2\uABEB\uABEE-\uD7FF\uE000-\uFB1D\uFB1F-\uFDFF\uFE10-\uFE1F\uFE30-\uFFFF]|\uD800[\uDC00-\uDDFC\uDDFE-\uDEDF\uDEE1-\uDF75\uDF7B-\uDFFF]|[\uD801\uD808-\uD80C\uD80E-\uD819\uD81C-\uD82E\uD830-\uD832\uD835\uD837\uD83B-\uDB3F\uDB41-\uDBFF][\uDC00-\uDFFF]|\uD802[\uDC00-\uDE00\uDE04\uDE07-\uDE0B\uDE10-\uDE37\uDE3B-\uDE3E\uDE40-\uDEE4\uDEE7-\uDFFF]|\uD803[\uDC00-\uDD23\uDD28-\uDEAA\uDEAD-\uDEFC\uDF00-\uDF45\uDF51-\uDF81\uDF86-\uDFFF]|\uD804[\uDC03-\uDC37\uDC47-\uDC6F\uDC71\uDC72\uDC75-\uDC7E\uDC83-\uDCAF\uDCBB-\uDCC1\uDCC3-\uDCFF\uDD03-\uDD26\uDD35-\uDD44\uDD47-\uDD72\uDD74-\uDD7F\uDD83-\uDDB2\uDDC1-\uDDC8\uDDCD\uDDD0-\uDE2B\uDE38-\uDE3D\uDE3F\uDE40\uDE42-\uDEDE\uDEEB-\uDEFF\uDF04-\uDF3A\uDF3D\uDF45\uDF46\uDF49\uDF4A\uDF4E-\uDF56\uDF58-\uDF61\uDF64\uDF65\uDF6D-\uDF6F\uDF75-\uDFFF]|\uD805[\uDC00-\uDC34\uDC47-\uDC5D\uDC5F-\uDCAF\uDCC4-\uDDAE\uDDB6\uDDB7\uDDC1-\uDDDB\uDDDE-\uDE2F\uDE41-\uDEAA\uDEB8-\uDF1C\uDF2C-\uDFFF]|\uD806[\uDC00-\uDC2B\uDC3B-\uDD2F\uDD36\uDD39\uDD3A\uDD3F\uDD41\uDD44-\uDDD0\uDDD8\uDDD9\uDDE1-\uDDE3\uDDE5-\uDE00\uDE0B-\uDE32\uDE3A\uDE3F-\uDE46\uDE48-\uDE50\uDE5C-\uDE89\uDE9A-\uDFFF]|\uD807[\uDC00-\uDC2E\uDC37\uDC40-\uDC91\uDCA8\uDCB7-\uDD30\uDD37-\uDD39\uDD3B\uDD3E\uDD46\uDD48-\uDD89\uDD8F\uDD92\uDD98-\uDEF2\uDEF7-\uDEFF\uDF02\uDF04-\uDF33\uDF3B-\uDF3D\uDF43-\uDFFF]|\uD80D[\uDC00-\uDC3F\uDC41-\uDC46\uDC56-\uDFFF]|\uD81A[\uDC00-\uDEEF\uDEF5-\uDF2F\uDF37-\uDFFF]|\uD81B[\uDC00-\uDF4E\uDF50\uDF88-\uDF8E\uDF93-\uDFE3\uDFE5-\uDFEF\uDFF2-\uDFFF]|\uD82F[\uDC00-\uDC9C\uDC9F-\uDFFF]|\uD833[\uDC00-\uDEFF\uDF2E\uDF2F\uDF47-\uDFFF]|\uD834[\uDC00-\uDD64\uDD6A-\uDD6C\uDD73-\uDD7A\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDE41\uDE45-\uDFFF]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85-\uDE9A\uDEA0\uDEB0-\uDFFF]|\uD838[\uDC07\uDC19\uDC1A\uDC22\uDC25\uDC2B-\uDC8E\uDC90-\uDD2F\uDD37-\uDEAD\uDEAF-\uDEEB\uDEF0-\uDFFF]|\uD839[\uDC00-\uDCEB\uDCF0-\uDFFF]|\uD83A[\uDC00-\uDCCF\uDCD7-\uDD43\uDD4B-\uDFFF]|\uDB40[\uDC00-\uDCFF\uDDF0-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))/;var SYLLABLES_REG_EXP=/[\uAC00-\uD7AF\uFA6C\uFACF-\uFAD1\uFAD5-\uFAD7]+/g;var SYLLABLES_LENGTHS=new Map;var FIRST_CHAR_SYLLABLES_REG_EXP="[\\u1100-\\u1112\\ud7a4-\\ud7af\\ud84a\\ud84c\\ud850\\ud854\\ud857\\ud85f]";var NFKC_CHARS_TO_NORMALIZE=new Map;var noSyllablesRegExp=null;var withSyllablesRegExp=null;function normalize(text){var syllablePositions=[];var m;while((m=SYLLABLES_REG_EXP.exec(text))!==null){var _m=m,index=_m.index;var _iterator163=_createForOfIteratorHelper(m[0]),_step163;try{for(_iterator163.s();!(_step163=_iterator163.n()).done;){var _char=_step163.value;var len=SYLLABLES_LENGTHS.get(_char);if(!len){len=_char.normalize("NFD").length;SYLLABLES_LENGTHS.set(_char,len)}syllablePositions.push([len,index++])}}catch(err){_iterator163.e(err)}finally{_iterator163.f()}}var normalizationRegex;if(syllablePositions.length===0&&noSyllablesRegExp){normalizationRegex=noSyllablesRegExp}else if(syllablePositions.length>0&&withSyllablesRegExp){normalizationRegex=withSyllablesRegExp}else{var replace=Object.keys(CHARACTERS_TO_NORMALIZE).join("");var toNormalizeWithNFKC=(0,_pdf_find_utils.getNormalizeWithNFKC)();var CJK="(?:\\p{Ideographic}|[\u3040-\u30FF])";var HKDiacritics="(?:\u3099|\u309A)";var regexp="([".concat(replace,"])|([").concat(toNormalizeWithNFKC,"])|(").concat(HKDiacritics,"\\n)|(\\p{M}+(?:-\\n)?)|(\\S-\\n)|(").concat(CJK,"\\n)|(\\n)");if(syllablePositions.length===0){normalizationRegex=noSyllablesRegExp=new RegExp(regexp+"|(\\u0000)","gum")}else{normalizationRegex=withSyllablesRegExp=new RegExp(regexp+"|(".concat(FIRST_CHAR_SYLLABLES_REG_EXP,")"),"gum")}}var rawDiacriticsPositions=[];while((m=DIACRITICS_REG_EXP.exec(text))!==null){rawDiacriticsPositions.push([m[0].length,m.index])}var normalized=text.normalize("NFD");var positions=[[0,0]];var rawDiacriticsIndex=0;var syllableIndex=0;var shift=0;var shiftOrigin=0;var eol=0;var hasDiacritics=false;normalized=normalized.replace(normalizationRegex,function(match,p1,p2,p3,p4,p5,p6,p7,p8,i){var _syllablePositions$sy;i-=shiftOrigin;if(p1){var replacement=CHARACTERS_TO_NORMALIZE[p1];var jj=replacement.length;for(var j=1;j<jj;j++){positions.push([i-shift+j,shift-j])}shift-=jj-1;return replacement}if(p2){var _replacement=NFKC_CHARS_TO_NORMALIZE.get(p2);if(!_replacement){_replacement=p2.normalize("NFKC");NFKC_CHARS_TO_NORMALIZE.set(p2,_replacement)}var _jj2=_replacement.length;for(var _j3=1;_j3<_jj2;_j3++){positions.push([i-shift+_j3,shift-_j3])}shift-=_jj2-1;return _replacement}if(p3){var _rawDiacriticsPositio;hasDiacritics=true;if(i+eol===((_rawDiacriticsPositio=rawDiacriticsPositions[rawDiacriticsIndex])===null||_rawDiacriticsPositio===void 0?void 0:_rawDiacriticsPositio[1])){++rawDiacriticsIndex}else{positions.push([i-1-shift+1,shift-1]);shift-=1;shiftOrigin+=1}positions.push([i-shift+1,shift]);shiftOrigin+=1;eol+=1;return p3.charAt(0)}if(p4){var _rawDiacriticsPositio2;var hasTrailingDashEOL=p4.endsWith("\n");var _len7=hasTrailingDashEOL?p4.length-2:p4.length;hasDiacritics=true;var _jj3=_len7;if(i+eol===((_rawDiacriticsPositio2=rawDiacriticsPositions[rawDiacriticsIndex])===null||_rawDiacriticsPositio2===void 0?void 0:_rawDiacriticsPositio2[1])){_jj3-=rawDiacriticsPositions[rawDiacriticsIndex][0];++rawDiacriticsIndex}for(var _j4=1;_j4<=_jj3;_j4++){positions.push([i-1-shift+_j4,shift-_j4])}shift-=_jj3;shiftOrigin+=_jj3;if(hasTrailingDashEOL){i+=_len7-1;positions.push([i-shift+1,1+shift]);shift+=1;shiftOrigin+=1;eol+=1;return p4.slice(0,_len7)}return p4}if(p5){var _len8=p5.length-2;positions.push([i-shift+_len8,1+shift]);shift+=1;shiftOrigin+=1;eol+=1;return p5.slice(0,-2)}if(p6){var _len9=p6.length-1;positions.push([i-shift+_len9,shift]);shiftOrigin+=1;eol+=1;return p6.slice(0,-1)}if(p7){positions.push([i-shift+1,shift-1]);shift-=1;shiftOrigin+=1;eol+=1;return" "}if(i+eol===((_syllablePositions$sy=syllablePositions[syllableIndex])===null||_syllablePositions$sy===void 0?void 0:_syllablePositions$sy[1])){var newCharLen=syllablePositions[syllableIndex][0]-1;++syllableIndex;for(var _j5=1;_j5<=newCharLen;_j5++){positions.push([i-(shift-_j5),shift-_j5])}shift-=newCharLen;shiftOrigin+=newCharLen}return p8});positions.push([normalized.length,shift]);return[normalized,positions,hasDiacritics]}function getOriginalIndex(diffs,pos,len){if(!diffs){return[pos,len]}var start=pos;var end=pos+len-1;var i=(0,_ui_utils.binarySearchFirstItem)(diffs,function(x){return x[0]>=start});if(diffs[i][0]>start){--i}var j=(0,_ui_utils.binarySearchFirstItem)(diffs,function(x){return x[0]>=end},i);if(diffs[j][0]>end){--j}var oldStart=start+diffs[i][1];var oldEnd=end+diffs[j][1];var oldLen=oldEnd+1-oldStart;return[oldStart,oldLen]}var _state2=new WeakMap;var _updateMatchesCountOnProgress=new WeakMap;var _visitedPagesCount=new WeakMap;var _onFind=new WeakSet;var _reset=new WeakSet;var _query=new WeakMap;var _shouldDirtyMatch=new WeakSet;var _isEntireWord=new WeakSet;var _calculateRegExpMatch=new WeakSet;var _convertToRegExpString=new WeakSet;var _calculateMatch=new WeakSet;var _extractText3=new WeakSet;var _updatePage=new WeakSet;var _updateAllPages=new WeakSet;var _nextMatch=new WeakSet;var _matchesReady=new WeakSet;var _nextPageMatch=new WeakSet;var _advanceOffsetPage=new WeakSet;var _updateMatch=new WeakSet;var _onFindBarClose=new WeakSet;var _requestMatchesCount=new WeakSet;var _updateUIResultsCount=new WeakSet;var _updateUIState=new WeakSet;var PDFFindController=function(){function PDFFindController(_ref115){var _linkService=_ref115.linkService,eventBus=_ref115.eventBus,_ref115$updateMatches=_ref115.updateMatchesCountOnProgress,updateMatchesCountOnProgress=_ref115$updateMatches===void 0?true:_ref115$updateMatches;_classCallCheck2(this,PDFFindController);_classPrivateMethodInitSpec(this,_updateUIState);_classPrivateMethodInitSpec(this,_updateUIResultsCount);_classPrivateMethodInitSpec(this,_requestMatchesCount);_classPrivateMethodInitSpec(this,_onFindBarClose);_classPrivateMethodInitSpec(this,_updateMatch);_classPrivateMethodInitSpec(this,_advanceOffsetPage);_classPrivateMethodInitSpec(this,_nextPageMatch);_classPrivateMethodInitSpec(this,_matchesReady);_classPrivateMethodInitSpec(this,_nextMatch);_classPrivateMethodInitSpec(this,_updateAllPages);_classPrivateMethodInitSpec(this,_updatePage);_classPrivateMethodInitSpec(this,_extractText3);_classPrivateMethodInitSpec(this,_calculateMatch);_classPrivateMethodInitSpec(this,_convertToRegExpString);_classPrivateMethodInitSpec(this,_calculateRegExpMatch);_classPrivateMethodInitSpec(this,_isEntireWord);_classPrivateMethodInitSpec(this,_shouldDirtyMatch);_classPrivateFieldInitSpec(this,_query,{get:_get_query,set:void 0});_classPrivateMethodInitSpec(this,_reset);_classPrivateMethodInitSpec(this,_onFind);_classPrivateFieldInitSpec(this,_state2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_updateMatchesCountOnProgress,{writable:true,value:true});_classPrivateFieldInitSpec(this,_visitedPagesCount,{writable:true,value:0});this._linkService=_linkService;this._eventBus=eventBus;_classPrivateFieldSet(this,_updateMatchesCountOnProgress,updateMatchesCountOnProgress);this.onIsPageVisible=null;_classPrivateMethodGet(this,_reset,_reset2).call(this);eventBus._on("find",_classPrivateMethodGet(this,_onFind,_onFind2).bind(this));eventBus._on("findbarclose",_classPrivateMethodGet(this,_onFindBarClose,_onFindBarClose2).bind(this))}_createClass2(PDFFindController,[{key:"highlightMatches",get:function get(){return this._highlightMatches}},{key:"pageMatches",get:function get(){return this._pageMatches}},{key:"pageMatchesLength",get:function get(){return this._pageMatchesLength}},{key:"selected",get:function get(){return this._selected}},{key:"state",get:function get(){return _classPrivateFieldGet(this,_state2)}},{key:"setDocument",value:function setDocument(pdfDocument){if(this._pdfDocument){_classPrivateMethodGet(this,_reset,_reset2).call(this)}if(!pdfDocument){return}this._pdfDocument=pdfDocument;this._firstPageCapability.resolve()}},{key:"scrollMatchIntoView",value:function scrollMatchIntoView(_ref116){var _ref116$element=_ref116.element,element=_ref116$element===void 0?null:_ref116$element,_ref116$selectedLeft=_ref116.selectedLeft,selectedLeft=_ref116$selectedLeft===void 0?0:_ref116$selectedLeft,_ref116$pageIndex=_ref116.pageIndex,pageIndex=_ref116$pageIndex===void 0?-1:_ref116$pageIndex,_ref116$matchIndex=_ref116.matchIndex,matchIndex=_ref116$matchIndex===void 0?-1:_ref116$matchIndex;if(!this._scrollMatches||!element){return}else if(matchIndex===-1||matchIndex!==this._selected.matchIdx){return}else if(pageIndex===-1||pageIndex!==this._selected.pageIdx){return}this._scrollMatches=false;var spot={top:MATCH_SCROLL_OFFSET_TOP,left:selectedLeft+MATCH_SCROLL_OFFSET_LEFT};(0,_ui_utils.scrollIntoView)(element,spot,true)}}]);return PDFFindController}();function _onFind2(state){var _this142=this;if(!state){return}if(state.phraseSearch===false){console.error("The `phraseSearch`-parameter was removed, please provide "+"an Array of strings in the `query`-parameter instead.");if(typeof state.query==="string"){state.query=state.query.match(/\S+/g)}}var pdfDocument=this._pdfDocument;var type=state.type;if(_classPrivateFieldGet(this,_state2)===null||_classPrivateMethodGet(this,_shouldDirtyMatch,_shouldDirtyMatch2).call(this,state)){this._dirtyMatch=true}_classPrivateFieldSet(this,_state2,state);if(type!=="highlightallchange"){_classPrivateMethodGet(this,_updateUIState,_updateUIState2).call(this,FindState.PENDING)}this._firstPageCapability.promise.then(function(){if(!_this142._pdfDocument||pdfDocument&&_this142._pdfDocument!==pdfDocument){return}_classPrivateMethodGet(_this142,_extractText3,_extractText4).call(_this142);var findbarClosed=!_this142._highlightMatches;var pendingTimeout=!!_this142._findTimeout;if(_this142._findTimeout){clearTimeout(_this142._findTimeout);_this142._findTimeout=null}if(!type){_this142._findTimeout=setTimeout(function(){_classPrivateMethodGet(_this142,_nextMatch,_nextMatch2).call(_this142);_this142._findTimeout=null},FIND_TIMEOUT)}else if(_this142._dirtyMatch){_classPrivateMethodGet(_this142,_nextMatch,_nextMatch2).call(_this142)}else if(type==="again"){_classPrivateMethodGet(_this142,_nextMatch,_nextMatch2).call(_this142);if(findbarClosed&&_classPrivateFieldGet(_this142,_state2).highlightAll){_classPrivateMethodGet(_this142,_updateAllPages,_updateAllPages2).call(_this142)}}else if(type==="highlightallchange"){if(pendingTimeout){_classPrivateMethodGet(_this142,_nextMatch,_nextMatch2).call(_this142)}else{_this142._highlightMatches=true}_classPrivateMethodGet(_this142,_updateAllPages,_updateAllPages2).call(_this142)}else{_classPrivateMethodGet(_this142,_nextMatch,_nextMatch2).call(_this142)}})}function _reset2(){this._highlightMatches=false;this._scrollMatches=false;this._pdfDocument=null;this._pageMatches=[];this._pageMatchesLength=[];_classPrivateFieldSet(this,_visitedPagesCount,0);_classPrivateFieldSet(this,_state2,null);this._selected={pageIdx:-1,matchIdx:-1};this._offset={pageIdx:null,matchIdx:null,wrapped:false};this._extractTextPromises=[];this._pageContents=[];this._pageDiffs=[];this._hasDiacritics=[];this._matchesCountTotal=0;this._pagesToSearch=null;this._pendingFindMatches=new Set;this._resumePageIdx=null;this._dirtyMatch=false;clearTimeout(this._findTimeout);this._findTimeout=null;this._firstPageCapability=new _pdfjsLib.PromiseCapability}function _get_query(){var _classPrivateFieldGet39=_classPrivateFieldGet(this,_state2),query=_classPrivateFieldGet39.query;if(typeof query==="string"){if(query!==this._rawQuery){this._rawQuery=query;var _normalize=normalize(query);var _normalize2=_slicedToArray2(_normalize,1);this._normalizedQuery=_normalize2[0]}return this._normalizedQuery}return(query||[]).filter(function(q){return!!q}).map(function(q){return normalize(q)[0]})}function _shouldDirtyMatch2(state){var _this$onIsPageVisible,_this$onIsPageVisible2;var newQuery=state.query,prevQuery=_classPrivateFieldGet(this,_state2).query;var newType=_typeof2(newQuery),prevType=_typeof2(prevQuery);if(newType!==prevType){return true}if(newType==="string"){if(newQuery!==prevQuery){return true}}else if(JSON.stringify(newQuery)!==JSON.stringify(prevQuery)){return true}switch(state.type){case"again":var pageNumber=this._selected.pageIdx+1;var linkService=this._linkService;return pageNumber>=1&&pageNumber<=linkService.pagesCount&&pageNumber!==linkService.page&&!((_this$onIsPageVisible=(_this$onIsPageVisible2=this.onIsPageVisible)===null||_this$onIsPageVisible2===void 0?void 0:_this$onIsPageVisible2.call(this,pageNumber))!==null&&_this$onIsPageVisible!==void 0?_this$onIsPageVisible:true);case"highlightallchange":return false}return true}function _isEntireWord2(content,startIdx,length){var match=content.slice(0,startIdx).match(NOT_DIACRITIC_FROM_END_REG_EXP);if(match){var first=content.charCodeAt(startIdx);var limit=match[1].charCodeAt(0);if((0,_pdf_find_utils.getCharacterType)(first)===(0,_pdf_find_utils.getCharacterType)(limit)){return false}}match=content.slice(startIdx+length).match(NOT_DIACRITIC_FROM_START_REG_EXP);if(match){var last=content.charCodeAt(startIdx+length-1);var _limit=match[1].charCodeAt(0);if((0,_pdf_find_utils.getCharacterType)(last)===(0,_pdf_find_utils.getCharacterType)(_limit)){return false}}return true}function _calculateRegExpMatch2(query,entireWord,pageIndex,pageContent){var matches=this._pageMatches[pageIndex]=[];var matchesLength=this._pageMatchesLength[pageIndex]=[];if(!query){return}var diffs=this._pageDiffs[pageIndex];var match;while((match=query.exec(pageContent))!==null){if(entireWord&&!_classPrivateMethodGet(this,_isEntireWord,_isEntireWord2).call(this,pageContent,match.index,match[0].length)){continue}var _getOriginalIndex=getOriginalIndex(diffs,match.index,match[0].length),_getOriginalIndex2=_slicedToArray2(_getOriginalIndex,2),matchPos=_getOriginalIndex2[0],matchLen=_getOriginalIndex2[1];if(matchLen){matches.push(matchPos);matchesLength.push(matchLen)}}}function _convertToRegExpString2(query,hasDiacritics){var _classPrivateFieldGet40=_classPrivateFieldGet(this,_state2),matchDiacritics=_classPrivateFieldGet40.matchDiacritics;var isUnicode=false;query=query.replaceAll(SPECIAL_CHARS_REG_EXP,function(match,p1,p2,p3,p4,p5){if(p1){return"[ ]*\\".concat(p1,"[ ]*")}if(p2){return"[ ]*".concat(p2,"[ ]*")}if(p3){return"[ ]+"}if(matchDiacritics){return p4||p5}if(p4){return DIACRITICS_EXCEPTION.has(p4.charCodeAt(0))?p4:""}if(hasDiacritics){isUnicode=true;return"".concat(p5,"\\p{M}*")}return p5});var trailingSpaces="[ ]*";if(query.endsWith(trailingSpaces)){query=query.slice(0,query.length-trailingSpaces.length)}if(matchDiacritics){if(hasDiacritics){DIACRITICS_EXCEPTION_STR||(DIACRITICS_EXCEPTION_STR=String.fromCharCode.apply(String,_toConsumableArray2(DIACRITICS_EXCEPTION)));isUnicode=true;query="".concat(query,"(?=[").concat(DIACRITICS_EXCEPTION_STR,"]|[^\\p{M}]|$)")}}return[isUnicode,query]}function _calculateMatch2(pageIndex){var _this143=this;var _this$visitedPagesCou;var query=_classPrivateFieldGet(this,_query);if(query.length===0){return}var _classPrivateFieldGet41=_classPrivateFieldGet(this,_state2),caseSensitive=_classPrivateFieldGet41.caseSensitive,entireWord=_classPrivateFieldGet41.entireWord;var pageContent=this._pageContents[pageIndex];var hasDiacritics=this._hasDiacritics[pageIndex];var isUnicode=false;if(typeof query==="string"){var _classPrivateMethodGe9=_classPrivateMethodGet(this,_convertToRegExpString,_convertToRegExpString2).call(this,query,hasDiacritics);var _classPrivateMethodGe10=_slicedToArray2(_classPrivateMethodGe9,2);isUnicode=_classPrivateMethodGe10[0];query=_classPrivateMethodGe10[1]}else{query=query.sort().reverse().map(function(q){var _classPrivateMethodGe11=_classPrivateMethodGet(_this143,_convertToRegExpString,_convertToRegExpString2).call(_this143,q,hasDiacritics),_classPrivateMethodGe12=_slicedToArray2(_classPrivateMethodGe11,2),isUnicodePart=_classPrivateMethodGe12[0],queryPart=_classPrivateMethodGe12[1];isUnicode||(isUnicode=isUnicodePart);return"(".concat(queryPart,")")}).join("|")}var flags="g".concat(isUnicode?"u":"").concat(caseSensitive?"":"i");query=query?new RegExp(query,flags):null;_classPrivateMethodGet(this,_calculateRegExpMatch,_calculateRegExpMatch2).call(this,query,entireWord,pageIndex,pageContent);if(_classPrivateFieldGet(this,_state2).highlightAll){_classPrivateMethodGet(this,_updatePage,_updatePage2).call(this,pageIndex)}if(this._resumePageIdx===pageIndex){this._resumePageIdx=null;_classPrivateMethodGet(this,_nextPageMatch,_nextPageMatch2).call(this)}var pageMatchesCount=this._pageMatches[pageIndex].length;this._matchesCountTotal+=pageMatchesCount;if(_classPrivateFieldGet(this,_updateMatchesCountOnProgress)){if(pageMatchesCount>0){_classPrivateMethodGet(this,_updateUIResultsCount,_updateUIResultsCount2).call(this)}}else if(_classPrivateFieldSet(this,_visitedPagesCount,(_this$visitedPagesCou=_classPrivateFieldGet(this,_visitedPagesCount),++_this$visitedPagesCou))===this._linkService.pagesCount){_classPrivateMethodGet(this,_updateUIResultsCount,_updateUIResultsCount2).call(this)}}function _extractText4(){var _this144=this;if(this._extractTextPromises.length>0){return}var promise=Promise.resolve();var textOptions={disableNormalization:true};var _loop6=function _loop6(_i71){var extractTextCapability=new _pdfjsLib.PromiseCapability;_this144._extractTextPromises[_i71]=extractTextCapability.promise;promise=promise.then(function(){return _this144._pdfDocument.getPage(_i71+1).then(function(pdfPage){return pdfPage.getTextContent(textOptions)}).then(function(textContent){var strBuf=[];var _iterator164=_createForOfIteratorHelper(textContent.items),_step164;try{for(_iterator164.s();!(_step164=_iterator164.n()).done;){var textItem=_step164.value;strBuf.push(textItem.str);if(textItem.hasEOL){strBuf.push("\n")}}}catch(err){_iterator164.e(err)}finally{_iterator164.f()}var _normalize3=normalize(strBuf.join(""));var _normalize4=_slicedToArray2(_normalize3,3);_this144._pageContents[_i71]=_normalize4[0];_this144._pageDiffs[_i71]=_normalize4[1];_this144._hasDiacritics[_i71]=_normalize4[2];extractTextCapability.resolve()},function(reason){console.error("Unable to get text content for page ".concat(_i71+1),reason);_this144._pageContents[_i71]="";_this144._pageDiffs[_i71]=null;_this144._hasDiacritics[_i71]=false;extractTextCapability.resolve()})})};for(var _i71=0,ii=this._linkService.pagesCount;_i71<ii;_i71++){_loop6(_i71)}}function _updatePage2(index){if(this._scrollMatches&&this._selected.pageIdx===index){this._linkService.page=index+1}this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:index})}function _updateAllPages2(){this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:-1})}function _nextMatch2(){var _this145=this;var previous=_classPrivateFieldGet(this,_state2).findPrevious;var currentPageIndex=this._linkService.page-1;var numPages=this._linkService.pagesCount;this._highlightMatches=true;if(this._dirtyMatch){this._dirtyMatch=false;this._selected.pageIdx=this._selected.matchIdx=-1;this._offset.pageIdx=currentPageIndex;this._offset.matchIdx=null;this._offset.wrapped=false;this._resumePageIdx=null;this._pageMatches.length=0;this._pageMatchesLength.length=0;_classPrivateFieldSet(this,_visitedPagesCount,0);this._matchesCountTotal=0;_classPrivateMethodGet(this,_updateAllPages,_updateAllPages2).call(this);var _loop7=function _loop7(_i72){if(_this145._pendingFindMatches.has(_i72)){return 1}_this145._pendingFindMatches.add(_i72);_this145._extractTextPromises[_i72].then(function(){_this145._pendingFindMatches["delete"](_i72);_classPrivateMethodGet(_this145,_calculateMatch,_calculateMatch2).call(_this145,_i72)})};for(var _i72=0;_i72<numPages;_i72++){if(_loop7(_i72))continue}}var query=_classPrivateFieldGet(this,_query);if(query.length===0){_classPrivateMethodGet(this,_updateUIState,_updateUIState2).call(this,FindState.FOUND);return}if(this._resumePageIdx){return}var offset=this._offset;this._pagesToSearch=numPages;if(offset.matchIdx!==null){var numPageMatches=this._pageMatches[offset.pageIdx].length;if(!previous&&offset.matchIdx+1<numPageMatches||previous&&offset.matchIdx>0){offset.matchIdx=previous?offset.matchIdx-1:offset.matchIdx+1;_classPrivateMethodGet(this,_updateMatch,_updateMatch2).call(this,true);return}_classPrivateMethodGet(this,_advanceOffsetPage,_advanceOffsetPage2).call(this,previous)}_classPrivateMethodGet(this,_nextPageMatch,_nextPageMatch2).call(this)}function _matchesReady2(matches){var offset=this._offset;var numMatches=matches.length;var previous=_classPrivateFieldGet(this,_state2).findPrevious;if(numMatches){offset.matchIdx=previous?numMatches-1:0;_classPrivateMethodGet(this,_updateMatch,_updateMatch2).call(this,true);return true}_classPrivateMethodGet(this,_advanceOffsetPage,_advanceOffsetPage2).call(this,previous);if(offset.wrapped){offset.matchIdx=null;if(this._pagesToSearch<0){_classPrivateMethodGet(this,_updateMatch,_updateMatch2).call(this,false);return true}}return false}function _nextPageMatch2(){if(this._resumePageIdx!==null){console.error("There can only be one pending page.")}var matches=null;do{var pageIdx=this._offset.pageIdx;matches=this._pageMatches[pageIdx];if(!matches){this._resumePageIdx=pageIdx;break}}while(!_classPrivateMethodGet(this,_matchesReady,_matchesReady2).call(this,matches))}function _advanceOffsetPage2(previous){var offset=this._offset;var numPages=this._linkService.pagesCount;offset.pageIdx=previous?offset.pageIdx-1:offset.pageIdx+1;offset.matchIdx=null;this._pagesToSearch--;if(offset.pageIdx>=numPages||offset.pageIdx<0){offset.pageIdx=previous?numPages-1:0;offset.wrapped=true}}function _updateMatch2(){var found=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var state=FindState.NOT_FOUND;var wrapped=this._offset.wrapped;this._offset.wrapped=false;if(found){var previousPage=this._selected.pageIdx;this._selected.pageIdx=this._offset.pageIdx;this._selected.matchIdx=this._offset.matchIdx;state=wrapped?FindState.WRAPPED:FindState.FOUND;if(previousPage!==-1&&previousPage!==this._selected.pageIdx){_classPrivateMethodGet(this,_updatePage,_updatePage2).call(this,previousPage)}}_classPrivateMethodGet(this,_updateUIState,_updateUIState2).call(this,state,_classPrivateFieldGet(this,_state2).findPrevious);if(this._selected.pageIdx!==-1){this._scrollMatches=true;_classPrivateMethodGet(this,_updatePage,_updatePage2).call(this,this._selected.pageIdx)}}function _onFindBarClose2(evt){var _this146=this;var pdfDocument=this._pdfDocument;this._firstPageCapability.promise.then(function(){if(!_this146._pdfDocument||pdfDocument&&_this146._pdfDocument!==pdfDocument){return}if(_this146._findTimeout){clearTimeout(_this146._findTimeout);_this146._findTimeout=null}if(_this146._resumePageIdx){_this146._resumePageIdx=null;_this146._dirtyMatch=true}_classPrivateMethodGet(_this146,_updateUIState,_updateUIState2).call(_this146,FindState.FOUND);_this146._highlightMatches=false;_classPrivateMethodGet(_this146,_updateAllPages,_updateAllPages2).call(_this146)})}function _requestMatchesCount2(){var _this$_selected=this._selected,pageIdx=_this$_selected.pageIdx,matchIdx=_this$_selected.matchIdx;var current=0,total=this._matchesCountTotal;if(matchIdx!==-1){for(var _i73=0;_i73<pageIdx;_i73++){var _this$_pageMatches$_i;current+=((_this$_pageMatches$_i=this._pageMatches[_i73])===null||_this$_pageMatches$_i===void 0?void 0:_this$_pageMatches$_i.length)||0}current+=matchIdx+1}if(current<1||current>total){current=total=0}return{current:current,total:total}}function _updateUIResultsCount2(){this._eventBus.dispatch("updatefindmatchescount",{source:this,matchesCount:_classPrivateMethodGet(this,_requestMatchesCount,_requestMatchesCount2).call(this)})}function _updateUIState2(state){var _classPrivateFieldGet42,_classPrivateFieldGet43;var previous=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!_classPrivateFieldGet(this,_updateMatchesCountOnProgress)&&(_classPrivateFieldGet(this,_visitedPagesCount)!==this._linkService.pagesCount||state===FindState.PENDING)){return}this._eventBus.dispatch("updatefindcontrolstate",{source:this,state:state,previous:previous,matchesCount:_classPrivateMethodGet(this,_requestMatchesCount,_requestMatchesCount2).call(this),rawQuery:(_classPrivateFieldGet42=(_classPrivateFieldGet43=_classPrivateFieldGet(this,_state2))===null||_classPrivateFieldGet43===void 0?void 0:_classPrivateFieldGet43.query)!==null&&_classPrivateFieldGet42!==void 0?_classPrivateFieldGet42:null})}exports.PDFFindController=PDFFindController}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.animationStarted=exports.VERTICAL_PADDING=exports.UNKNOWN_SCALE=exports.TextLayerMode=exports.SpreadMode=exports.SidebarView=exports.ScrollMode=exports.SCROLLBAR_PADDING=exports.RenderingStates=exports.ProgressBar=exports.PresentationModeState=exports.OutputScale=exports.MIN_SCALE=exports.MAX_SCALE=exports.MAX_AUTO_SCALE=exports.DEFAULT_SCALE_VALUE=exports.DEFAULT_SCALE_DELTA=exports.DEFAULT_SCALE=exports.CursorTool=exports.AutoPrintRegExp=void 0;exports.apiPageLayoutToViewerModes=apiPageLayoutToViewerModes;exports.apiPageModeToSidebarView=apiPageModeToSidebarView;exports.approximateFraction=approximateFraction;exports.backtrackBeforeAllVisibleElements=backtrackBeforeAllVisibleElements;exports.binarySearchFirstItem=binarySearchFirstItem;exports.docStyle=void 0;exports.getActiveOrFocusedElement=getActiveOrFocusedElement;exports.getPageSizeInches=getPageSizeInches;exports.getVisibleElements=getVisibleElements;exports.isPortraitOrientation=isPortraitOrientation;exports.isValidRotation=isValidRotation;exports.isValidScrollMode=isValidScrollMode;exports.isValidSpreadMode=isValidSpreadMode;exports.normalizeWheelEventDelta=normalizeWheelEventDelta;exports.normalizeWheelEventDirection=normalizeWheelEventDirection;exports.parseQueryString=parseQueryString;exports.removeNullCharacters=removeNullCharacters;exports.roundToDivide=roundToDivide;exports.scrollIntoView=scrollIntoView;exports.toggleCheckedBtn=toggleCheckedBtn;exports.toggleExpandedBtn=toggleExpandedBtn;exports.watchScroll=watchScroll;var DEFAULT_SCALE_VALUE="auto";exports.DEFAULT_SCALE_VALUE=DEFAULT_SCALE_VALUE;var DEFAULT_SCALE=1;exports.DEFAULT_SCALE=DEFAULT_SCALE;var DEFAULT_SCALE_DELTA=1.1;exports.DEFAULT_SCALE_DELTA=DEFAULT_SCALE_DELTA;var MIN_SCALE=0.1;exports.MIN_SCALE=MIN_SCALE;var MAX_SCALE=10;exports.MAX_SCALE=MAX_SCALE;var UNKNOWN_SCALE=0;exports.UNKNOWN_SCALE=UNKNOWN_SCALE;var MAX_AUTO_SCALE=1.25;exports.MAX_AUTO_SCALE=MAX_AUTO_SCALE;var SCROLLBAR_PADDING=40;exports.SCROLLBAR_PADDING=SCROLLBAR_PADDING;var VERTICAL_PADDING=5;exports.VERTICAL_PADDING=VERTICAL_PADDING;var RenderingStates={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3};exports.RenderingStates=RenderingStates;var PresentationModeState={UNKNOWN:0,NORMAL:1,CHANGING:2,FULLSCREEN:3};exports.PresentationModeState=PresentationModeState;var SidebarView={UNKNOWN:-1,NONE:0,THUMBS:1,OUTLINE:2,ATTACHMENTS:3,LAYERS:4};exports.SidebarView=SidebarView;var TextLayerMode={DISABLE:0,ENABLE:1,ENABLE_PERMISSIONS:2};exports.TextLayerMode=TextLayerMode;var ScrollMode={UNKNOWN:-1,VERTICAL:0,HORIZONTAL:1,WRAPPED:2,PAGE:3};exports.ScrollMode=ScrollMode;var SpreadMode={UNKNOWN:-1,NONE:0,ODD:1,EVEN:2};exports.SpreadMode=SpreadMode;var CursorTool={SELECT:0,HAND:1,ZOOM:2};exports.CursorTool=CursorTool;var AutoPrintRegExp=/\bprint\s*\(/;exports.AutoPrintRegExp=AutoPrintRegExp;var OutputScale=function(){function OutputScale(){_classCallCheck2(this,OutputScale);var pixelRatio=window.devicePixelRatio||1;this.sx=pixelRatio;this.sy=pixelRatio}_createClass2(OutputScale,[{key:"scaled",get:function get(){return this.sx!==1||this.sy!==1}}]);return OutputScale}();exports.OutputScale=OutputScale;function scrollIntoView(element,spot){var scrollMatches=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var parent=element.offsetParent;if(!parent){console.error("offsetParent is not set -- cannot scroll");return}var offsetY=element.offsetTop+element.clientTop;var offsetX=element.offsetLeft+element.clientLeft;while(parent.clientHeight===parent.scrollHeight&&parent.clientWidth===parent.scrollWidth||scrollMatches&&(parent.classList.contains("markedContent")||getComputedStyle(parent).overflow==="hidden")){offsetY+=parent.offsetTop;offsetX+=parent.offsetLeft;parent=parent.offsetParent;if(!parent){return}}if(spot){if(spot.top!==undefined){offsetY+=spot.top}if(spot.left!==undefined){offsetX+=spot.left;parent.scrollLeft=offsetX}}parent.scrollTop=offsetY}function watchScroll(viewAreaElement,callback){var debounceScroll=function debounceScroll(evt){if(rAF){return}rAF=window.requestAnimationFrame(function viewAreaElementScrolled(){rAF=null;var currentX=viewAreaElement.scrollLeft;var lastX=state.lastX;if(currentX!==lastX){state.right=currentX>lastX}state.lastX=currentX;var currentY=viewAreaElement.scrollTop;var lastY=state.lastY;if(currentY!==lastY){state.down=currentY>lastY}state.lastY=currentY;callback(state)})};var state={right:true,down:true,lastX:viewAreaElement.scrollLeft,lastY:viewAreaElement.scrollTop,_eventHandler:debounceScroll};var rAF=null;viewAreaElement.addEventListener("scroll",debounceScroll,true);return state}function parseQueryString(query){var params=new Map;var _iterator165=_createForOfIteratorHelper(new URLSearchParams(query)),_step165;try{for(_iterator165.s();!(_step165=_iterator165.n()).done;){var _step165$value=_slicedToArray2(_step165.value,2),key=_step165$value[0],value=_step165$value[1];params.set(key.toLowerCase(),value)}}catch(err){_iterator165.e(err)}finally{_iterator165.f()}return params}var InvisibleCharactersRegExp=/[\x01-\x1F]/g;function removeNullCharacters(str){var replaceInvisible=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(typeof str!=="string"){console.error("The argument must be a string.");return str}if(replaceInvisible){str=str.replaceAll(InvisibleCharactersRegExp," ")}return str.replaceAll("\0","")}function binarySearchFirstItem(items,condition){var start=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var minIndex=start;var maxIndex=items.length-1;if(maxIndex<0||!condition(items[maxIndex])){return items.length}if(condition(items[minIndex])){return minIndex}while(minIndex<maxIndex){var currentIndex=minIndex+maxIndex>>1;var currentItem=items[currentIndex];if(condition(currentItem)){maxIndex=currentIndex}else{minIndex=currentIndex+1}}return minIndex}function approximateFraction(x){if(Math.floor(x)===x){return[x,1]}var xinv=1/x;var limit=8;if(xinv>limit){return[1,limit]}else if(Math.floor(xinv)===xinv){return[1,xinv]}var x_=x>1?xinv:x;var a=0,b=1,c=1,d=1;while(true){var p=a+c,q=b+d;if(q>limit){break}if(x_<=p/q){c=p;d=q}else{a=p;b=q}}var result;if(x_-a/b<c/d-x_){result=x_===x?[a,b]:[b,a]}else{result=x_===x?[c,d]:[d,c]}return result}function roundToDivide(x,div){var r=x%div;return r===0?x:Math.round(x-r+div)}function getPageSizeInches(_ref117){var view=_ref117.view,userUnit=_ref117.userUnit,rotate=_ref117.rotate;var _view2=_slicedToArray2(view,4),x1=_view2[0],y1=_view2[1],x2=_view2[2],y2=_view2[3];var changeOrientation=rotate%180!==0;var width=(x2-x1)/72*userUnit;var height=(y2-y1)/72*userUnit;return{width:changeOrientation?height:width,height:changeOrientation?width:height}}function backtrackBeforeAllVisibleElements(index,views,top){if(index<2){return index}var elt=views[index].div;var pageTop=elt.offsetTop+elt.clientTop;if(pageTop>=top){elt=views[index-1].div;pageTop=elt.offsetTop+elt.clientTop}for(var _i74=index-2;_i74>=0;--_i74){elt=views[_i74].div;if(elt.offsetTop+elt.clientTop+elt.clientHeight<=pageTop){break}index=_i74}return index}function getVisibleElements(_ref118){var scrollEl=_ref118.scrollEl,views=_ref118.views,_ref118$sortByVisibil=_ref118.sortByVisibility,sortByVisibility=_ref118$sortByVisibil===void 0?false:_ref118$sortByVisibil,_ref118$horizontal=_ref118.horizontal,horizontal=_ref118$horizontal===void 0?false:_ref118$horizontal,_ref118$rtl=_ref118.rtl,rtl=_ref118$rtl===void 0?false:_ref118$rtl;var top=scrollEl.scrollTop,bottom=top+scrollEl.clientHeight;var left=scrollEl.scrollLeft,right=left+scrollEl.clientWidth;function isElementBottomAfterViewTop(view){var element=view.div;var elementBottom=element.offsetTop+element.clientTop+element.clientHeight;return elementBottom>top}function isElementNextAfterViewHorizontally(view){var element=view.div;var elementLeft=element.offsetLeft+element.clientLeft;var elementRight=elementLeft+element.clientWidth;return rtl?elementLeft<right:elementRight>left}var visible=[],ids=new Set,numViews=views.length;var firstVisibleElementInd=binarySearchFirstItem(views,horizontal?isElementNextAfterViewHorizontally:isElementBottomAfterViewTop);if(firstVisibleElementInd>0&&firstVisibleElementInd<numViews&&!horizontal){firstVisibleElementInd=backtrackBeforeAllVisibleElements(firstVisibleElementInd,views,top)}var lastEdge=horizontal?right:-1;for(var _i75=firstVisibleElementInd;_i75<numViews;_i75++){var view=views[_i75],element=view.div;var currentWidth=element.offsetLeft+element.clientLeft;var currentHeight=element.offsetTop+element.clientTop;var viewWidth=element.clientWidth,viewHeight=element.clientHeight;var viewRight=currentWidth+viewWidth;var viewBottom=currentHeight+viewHeight;if(lastEdge===-1){if(viewBottom>=bottom){lastEdge=viewBottom}}else if((horizontal?currentWidth:currentHeight)>lastEdge){break}if(viewBottom<=top||currentHeight>=bottom||viewRight<=left||currentWidth>=right){continue}var hiddenHeight=Math.max(0,top-currentHeight)+Math.max(0,viewBottom-bottom);var hiddenWidth=Math.max(0,left-currentWidth)+Math.max(0,viewRight-right);var fractionHeight=(viewHeight-hiddenHeight)/viewHeight,fractionWidth=(viewWidth-hiddenWidth)/viewWidth;var _percent=fractionHeight*fractionWidth*100|0;visible.push({id:view.id,x:currentWidth,y:currentHeight,view:view,percent:_percent,widthPercent:fractionWidth*100|0});ids.add(view.id)}var first=visible[0],last=visible.at(-1);if(sortByVisibility){visible.sort(function(a,b){var pc=a.percent-b.percent;if(Math.abs(pc)>0.001){return-pc}return a.id-b.id})}return{first:first,last:last,views:visible,ids:ids}}function normalizeWheelEventDirection(evt){var delta=Math.hypot(evt.deltaX,evt.deltaY);var angle=Math.atan2(evt.deltaY,evt.deltaX);if(-0.25*Math.PI<angle&&angle<0.75*Math.PI){delta=-delta}return delta}function normalizeWheelEventDelta(evt){var deltaMode=evt.deltaMode;var delta=normalizeWheelEventDirection(evt);var MOUSE_PIXELS_PER_LINE=30;var MOUSE_LINES_PER_PAGE=30;if(deltaMode===WheelEvent.DOM_DELTA_PIXEL){delta/=MOUSE_PIXELS_PER_LINE*MOUSE_LINES_PER_PAGE}else if(deltaMode===WheelEvent.DOM_DELTA_LINE){delta/=MOUSE_LINES_PER_PAGE}return delta}function isValidRotation(angle){return Number.isInteger(angle)&&angle%90===0}function isValidScrollMode(mode){return Number.isInteger(mode)&&Object.values(ScrollMode).includes(mode)&&mode!==ScrollMode.UNKNOWN}function isValidSpreadMode(mode){return Number.isInteger(mode)&&Object.values(SpreadMode).includes(mode)&&mode!==SpreadMode.UNKNOWN}function isPortraitOrientation(size){return size.width<=size.height}var animationStarted=new Promise(function(resolve){window.requestAnimationFrame(resolve)});exports.animationStarted=animationStarted;var docStyle=document.documentElement.style;exports.docStyle=docStyle;function clamp(v,min,max){return Math.min(Math.max(v,min),max)}var _classList2=new WeakMap;var _disableAutoFetchTimeout=new WeakMap;var _percent2=new WeakMap;var _style=new WeakMap;var _visible2=new WeakMap;var ProgressBar=function(){function ProgressBar(bar){_classCallCheck2(this,ProgressBar);_classPrivateFieldInitSpec(this,_classList2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_disableAutoFetchTimeout,{writable:true,value:null});_classPrivateFieldInitSpec(this,_percent2,{writable:true,value:0});_classPrivateFieldInitSpec(this,_style,{writable:true,value:null});_classPrivateFieldInitSpec(this,_visible2,{writable:true,value:true});_classPrivateFieldSet(this,_classList2,bar.classList);_classPrivateFieldSet(this,_style,bar.style)}_createClass2(ProgressBar,[{key:"percent",get:function get(){return _classPrivateFieldGet(this,_percent2)},set:function set(val){_classPrivateFieldSet(this,_percent2,clamp(val,0,100));if(isNaN(val)){_classPrivateFieldGet(this,_classList2).add("indeterminate");return}_classPrivateFieldGet(this,_classList2).remove("indeterminate");_classPrivateFieldGet(this,_style).setProperty("--progressBar-percent","".concat(_classPrivateFieldGet(this,_percent2),"%"))}},{key:"setWidth",value:function setWidth(viewer){if(!viewer){return}var container=viewer.parentNode;var scrollbarWidth=container.offsetWidth-viewer.offsetWidth;if(scrollbarWidth>0){_classPrivateFieldGet(this,_style).setProperty("--progressBar-end-offset","".concat(scrollbarWidth,"px"))}}},{key:"setDisableAutoFetch",value:function setDisableAutoFetch(){var _this147=this;var delay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:5000;if(isNaN(_classPrivateFieldGet(this,_percent2))){return}if(_classPrivateFieldGet(this,_disableAutoFetchTimeout)){clearTimeout(_classPrivateFieldGet(this,_disableAutoFetchTimeout))}this.show();_classPrivateFieldSet(this,_disableAutoFetchTimeout,setTimeout(function(){_classPrivateFieldSet(_this147,_disableAutoFetchTimeout,null);_this147.hide()},delay))}},{key:"hide",value:function hide(){if(!_classPrivateFieldGet(this,_visible2)){return}_classPrivateFieldSet(this,_visible2,false);_classPrivateFieldGet(this,_classList2).add("hidden")}},{key:"show",value:function show(){if(_classPrivateFieldGet(this,_visible2)){return}_classPrivateFieldSet(this,_visible2,true);_classPrivateFieldGet(this,_classList2).remove("hidden")}}]);return ProgressBar}();exports.ProgressBar=ProgressBar;function getActiveOrFocusedElement(){var curRoot=document;var curActiveOrFocused=curRoot.activeElement||curRoot.querySelector(":focus");while((_curActiveOrFocused=curActiveOrFocused)!==null&&_curActiveOrFocused!==void 0&&_curActiveOrFocused.shadowRoot){var _curActiveOrFocused;curRoot=curActiveOrFocused.shadowRoot;curActiveOrFocused=curRoot.activeElement||curRoot.querySelector(":focus")}return curActiveOrFocused}function apiPageLayoutToViewerModes(layout){var scrollMode=ScrollMode.VERTICAL,spreadMode=SpreadMode.NONE;switch(layout){case"SinglePage":scrollMode=ScrollMode.PAGE;break;case"OneColumn":break;case"TwoPageLeft":scrollMode=ScrollMode.PAGE;case"TwoColumnLeft":spreadMode=SpreadMode.ODD;break;case"TwoPageRight":scrollMode=ScrollMode.PAGE;case"TwoColumnRight":spreadMode=SpreadMode.EVEN;break}return{scrollMode:scrollMode,spreadMode:spreadMode}}function apiPageModeToSidebarView(mode){switch(mode){case"UseNone":return SidebarView.NONE;case"UseThumbs":return SidebarView.THUMBS;case"UseOutlines":return SidebarView.OUTLINE;case"UseAttachments":return SidebarView.ATTACHMENTS;case"UseOC":return SidebarView.LAYERS}return SidebarView.NONE}function toggleCheckedBtn(button,toggle){var view=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;button.classList.toggle("toggled",toggle);button.setAttribute("aria-checked",toggle);view===null||view===void 0||view.classList.toggle("hidden",!toggle)}function toggleExpandedBtn(button,toggle){var view=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;button.classList.toggle("toggled",toggle);button.setAttribute("aria-expanded",toggle);view===null||view===void 0||view.classList.toggle("hidden",!toggle)}}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.CharacterType=void 0;exports.getCharacterType=getCharacterType;exports.getNormalizeWithNFKC=getNormalizeWithNFKC;var CharacterType={SPACE:0,ALPHA_LETTER:1,PUNCT:2,HAN_LETTER:3,KATAKANA_LETTER:4,HIRAGANA_LETTER:5,HALFWIDTH_KATAKANA_LETTER:6,THAI_LETTER:7};exports.CharacterType=CharacterType;function isAlphabeticalScript(charCode){return charCode<11904}function isAscii(charCode){return(charCode&65408)===0}function isAsciiAlpha(charCode){return charCode>=97&&charCode<=122||charCode>=65&&charCode<=90}function isAsciiDigit(charCode){return charCode>=48&&charCode<=57}function isAsciiSpace(charCode){return charCode===32||charCode===9||charCode===13||charCode===10}function isHan(charCode){return charCode>=13312&&charCode<=40959||charCode>=63744&&charCode<=64255}function isKatakana(charCode){return charCode>=12448&&charCode<=12543}function isHiragana(charCode){return charCode>=12352&&charCode<=12447}function isHalfwidthKatakana(charCode){return charCode>=65376&&charCode<=65439}function isThai(charCode){return(charCode&65408)===3584}function getCharacterType(charCode){if(isAlphabeticalScript(charCode)){if(isAscii(charCode)){if(isAsciiSpace(charCode)){return CharacterType.SPACE}else if(isAsciiAlpha(charCode)||isAsciiDigit(charCode)||charCode===95){return CharacterType.ALPHA_LETTER}return CharacterType.PUNCT}else if(isThai(charCode)){return CharacterType.THAI_LETTER}else if(charCode===160){return CharacterType.SPACE}return CharacterType.ALPHA_LETTER}if(isHan(charCode)){return CharacterType.HAN_LETTER}else if(isKatakana(charCode)){return CharacterType.KATAKANA_LETTER}else if(isHiragana(charCode)){return CharacterType.HIRAGANA_LETTER}else if(isHalfwidthKatakana(charCode)){return CharacterType.HALFWIDTH_KATAKANA_LETTER}return CharacterType.ALPHA_LETTER}var NormalizeWithNFKC;function getNormalizeWithNFKC(){NormalizeWithNFKC||(NormalizeWithNFKC="\xA0\xA8\xAA\xAF\xB2-\xB5\xB8-\xBA\xBC-\xBE\u0132-\u0133\u013F-\u0140\u0149\u017F\u01C4-\u01CC\u01F1-\u01F3\u02B0-\u02B8\u02D8-\u02DD\u02E0-\u02E4\u0374\u037A\u037E\u0384-\u0385\u0387\u03D0-\u03D6\u03F0-\u03F2\u03F4-\u03F5\u03F9\u0587\u0675-\u0678\u0958-\u095F\u09DC-\u09DD\u09DF\u0A33\u0A36\u0A59-\u0A5B\u0A5E\u0B5C-\u0B5D\u0E33\u0EB3\u0EDC-\u0EDD\u0F0C\u0F43\u0F4D\u0F52\u0F57\u0F5C\u0F69\u10FC\u1D2C-\u1D2E\u1D30-\u1D3A\u1D3C-\u1D4D\u1D4F-\u1D6A\u1D78\u1D9B-\u1DBF\u1E9A-\u1E9B\u1F71\u1F73\u1F75\u1F77\u1F79\u1F7B\u1F7D\u1FBB\u1FBD-\u1FC1\u1FC9\u1FCB\u1FCD-\u1FCF\u1FD3\u1FDB\u1FDD-\u1FDF\u1FE3\u1FEB\u1FED-\u1FEF\u1FF9\u1FFB\u1FFD-\u1FFE\u2000-\u200A\u2011\u2017\u2024-\u2026\u202F\u2033-\u2034\u2036-\u2037\u203C\u203E\u2047-\u2049\u2057\u205F\u2070-\u2071\u2074-\u208E\u2090-\u209C\u20A8\u2100-\u2103\u2105-\u2107\u2109-\u2113\u2115-\u2116\u2119-\u211D\u2120-\u2122\u2124\u2126\u2128\u212A-\u212D\u212F-\u2131\u2133-\u2139\u213B-\u2140\u2145-\u2149\u2150-\u217F\u2189\u222C-\u222D\u222F-\u2230\u2329-\u232A\u2460-\u24EA\u2A0C\u2A74-\u2A76\u2ADC\u2C7C-\u2C7D\u2D6F\u2E9F\u2EF3\u2F00-\u2FD5\u3000\u3036\u3038-\u303A\u309B-\u309C\u309F\u30FF\u3131-\u318E\u3192-\u319F\u3200-\u321E\u3220-\u3247\u3250-\u327E\u3280-\u33FF\uA69C-\uA69D\uA770\uA7F2-\uA7F4\uA7F8-\uA7F9\uAB5C-\uAB5F\uAB69\uF900-\uFA0D\uFA10\uFA12\uFA15-\uFA1E\uFA20\uFA22\uFA25-\uFA26\uFA2A-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFC\uFE10-\uFE19\uFE30-\uFE44\uFE47-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFE70-\uFE72\uFE74\uFE76-\uFEFC\uFF01-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE0-\uFFE6");return NormalizeWithNFKC}}),(function(module){module.exports=globalThis.pdfjsLib}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.SimpleLinkService=exports.PDFLinkService=exports.LinkTarget=void 0;var _ui_utils=__w_pdfjs_require__(2);var DEFAULT_LINK_REL="noopener noreferrer nofollow";var LinkTarget={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4};exports.LinkTarget=LinkTarget;function _addLinkAttributes(link){var _ref119=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},url=_ref119.url,target=_ref119.target,rel=_ref119.rel,_ref119$enabled=_ref119.enabled,enabled=_ref119$enabled===void 0?true:_ref119$enabled;if(!url||typeof url!=="string"){throw new Error("A valid \"url\" parameter must provided.")}if(enabled){link.href=link.title=url}else{link.href="";link.title="Disabled: ".concat(url);link.onclick=function(){return false}}var targetStr="";switch(target){case LinkTarget.NONE:break;case LinkTarget.SELF:targetStr="_self";break;case LinkTarget.BLANK:targetStr="_blank";break;case LinkTarget.PARENT:targetStr="_parent";break;case LinkTarget.TOP:targetStr="_top";break}link.target=targetStr;link.rel=typeof rel==="string"?rel:DEFAULT_LINK_REL}var _pagesRefCache=new WeakMap;var _goToDestinationHelper=new WeakSet;var PDFLinkService=function(){function PDFLinkService(){var _ref120=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},eventBus=_ref120.eventBus,_ref120$externalLinkT=_ref120.externalLinkTarget,externalLinkTarget=_ref120$externalLinkT===void 0?null:_ref120$externalLinkT,_ref120$externalLinkR=_ref120.externalLinkRel,externalLinkRel=_ref120$externalLinkR===void 0?null:_ref120$externalLinkR,_ref120$ignoreDestina=_ref120.ignoreDestinationZoom,ignoreDestinationZoom=_ref120$ignoreDestina===void 0?false:_ref120$ignoreDestina;_classCallCheck2(this,PDFLinkService);_classPrivateMethodInitSpec(this,_goToDestinationHelper);_classPrivateFieldInitSpec(this,_pagesRefCache,{writable:true,value:new Map});this.eventBus=eventBus;this.externalLinkTarget=externalLinkTarget;this.externalLinkRel=externalLinkRel;this.externalLinkEnabled=true;this._ignoreDestinationZoom=ignoreDestinationZoom;this.baseUrl=null;this.pdfDocument=null;this.pdfViewer=null;this.pdfHistory=null}_createClass2(PDFLinkService,[{key:"setDocument",value:function setDocument(pdfDocument){var baseUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.baseUrl=baseUrl;this.pdfDocument=pdfDocument;_classPrivateFieldGet(this,_pagesRefCache).clear()}},{key:"setViewer",value:function setViewer(pdfViewer){this.pdfViewer=pdfViewer}},{key:"setHistory",value:function setHistory(pdfHistory){this.pdfHistory=pdfHistory}},{key:"pagesCount",get:function get(){return this.pdfDocument?this.pdfDocument.numPages:0}},{key:"page",get:function get(){return this.pdfViewer.currentPageNumber},set:function set(value){this.pdfViewer.currentPageNumber=value}},{key:"rotation",get:function get(){return this.pdfViewer.pagesRotation},set:function set(value){this.pdfViewer.pagesRotation=value}},{key:"isInPresentationMode",get:function get(){return this.pdfViewer.isInPresentationMode}},{key:"goToDestination",value:function(){var _goToDestination=_asyncToGenerator(_regeneratorRuntime().mark(function _callee66(dest){var namedDest,explicitDest;return _regeneratorRuntime().wrap(function _callee66$(_context67){while(1)switch(_context67.prev=_context67.next){case 0:if(this.pdfDocument){_context67.next=2;break}return _context67.abrupt("return");case 2:if(!(typeof dest==="string")){_context67.next=9;break}namedDest=dest;_context67.next=6;return this.pdfDocument.getDestination(dest);case 6:explicitDest=_context67.sent;_context67.next=13;break;case 9:namedDest=null;_context67.next=12;return dest;case 12:explicitDest=_context67.sent;case 13:if(Array.isArray(explicitDest)){_context67.next=16;break}console.error("PDFLinkService.goToDestination: \"".concat(explicitDest,"\" is not ")+"a valid destination array, for dest=\"".concat(dest,"\"."));return _context67.abrupt("return");case 16:_classPrivateMethodGet(this,_goToDestinationHelper,_goToDestinationHelper2).call(this,dest,namedDest,explicitDest);case 17:case"end":return _context67.stop()}},_callee66,this)}));function goToDestination(_x65){return _goToDestination.apply(this,arguments)}return goToDestination}()},{key:"goToPage",value:function goToPage(val){if(!this.pdfDocument){return}var pageNumber=typeof val==="string"&&this.pdfViewer.pageLabelToPageNumber(val)||val|0;if(!(Number.isInteger(pageNumber)&&pageNumber>0&&pageNumber<=this.pagesCount)){console.error("PDFLinkService.goToPage: \"".concat(val,"\" is not a valid page."));return}if(this.pdfHistory){this.pdfHistory.pushCurrentPosition();this.pdfHistory.pushPage(pageNumber)}this.pdfViewer.scrollPageIntoView({pageNumber:pageNumber})}},{key:"addLinkAttributes",value:function addLinkAttributes(link,url){var newWindow=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;_addLinkAttributes(link,{url:url,target:newWindow?LinkTarget.BLANK:this.externalLinkTarget,rel:this.externalLinkRel,enabled:this.externalLinkEnabled})}},{key:"getDestinationHash",value:function getDestinationHash(dest){if(typeof dest==="string"){if(dest.length>0){return this.getAnchorUrl("#"+escape(dest))}}else if(Array.isArray(dest)){var str=JSON.stringify(dest);if(str.length>0){return this.getAnchorUrl("#"+escape(str))}}return this.getAnchorUrl("")}},{key:"getAnchorUrl",value:function getAnchorUrl(anchor){return this.baseUrl?this.baseUrl+anchor:anchor}},{key:"setHash",value:function setHash(hash){if(!this.pdfDocument){return}var pageNumber,dest;if(hash.includes("=")){var params=(0,_ui_utils.parseQueryString)(hash);if(params.has("search")){var query=params.get("search").replaceAll("\"",""),_phrase=params.get("phrase")==="true";this.eventBus.dispatch("findfromurlhash",{source:this,query:_phrase?query:query.match(/\S+/g)})}if(params.has("page")){pageNumber=params.get("page")|0||1}if(params.has("zoom")){var zoomArgs=params.get("zoom").split(",");var zoomArg=zoomArgs[0];var zoomArgNumber=parseFloat(zoomArg);if(!zoomArg.includes("Fit")){dest=[null,{name:"XYZ"},zoomArgs.length>1?zoomArgs[1]|0:null,zoomArgs.length>2?zoomArgs[2]|0:null,zoomArgNumber?zoomArgNumber/100:zoomArg]}else if(zoomArg==="Fit"||zoomArg==="FitB"){dest=[null,{name:zoomArg}]}else if(zoomArg==="FitH"||zoomArg==="FitBH"||zoomArg==="FitV"||zoomArg==="FitBV"){dest=[null,{name:zoomArg},zoomArgs.length>1?zoomArgs[1]|0:null]}else if(zoomArg==="FitR"){if(zoomArgs.length!==5){console.error("PDFLinkService.setHash: Not enough parameters for \"FitR\".")}else{dest=[null,{name:zoomArg},zoomArgs[1]|0,zoomArgs[2]|0,zoomArgs[3]|0,zoomArgs[4]|0]}}else{console.error("PDFLinkService.setHash: \"".concat(zoomArg,"\" is not a valid zoom value."))}}if(dest){this.pdfViewer.scrollPageIntoView({pageNumber:pageNumber||this.page,destArray:dest,allowNegativeOffset:true})}else if(pageNumber){this.page=pageNumber}if(params.has("pagemode")){this.eventBus.dispatch("pagemode",{source:this,mode:params.get("pagemode")})}if(params.has("nameddest")){this.goToDestination(params.get("nameddest"))}}else{dest=unescape(hash);try{dest=JSON.parse(dest);if(!Array.isArray(dest)){dest=dest.toString()}}catch(_unused17){}if(typeof dest==="string"||_classStaticPrivateMethodGet(PDFLinkService,PDFLinkService,_isValidExplicitDestination).call(PDFLinkService,dest)){this.goToDestination(dest);return}console.error("PDFLinkService.setHash: \"".concat(unescape(hash),"\" is not a valid destination."))}}},{key:"executeNamedAction",value:function executeNamedAction(action){var _this$pdfHistory,_this$pdfHistory2;switch(action){case"GoBack":(_this$pdfHistory=this.pdfHistory)===null||_this$pdfHistory===void 0||_this$pdfHistory.back();break;case"GoForward":(_this$pdfHistory2=this.pdfHistory)===null||_this$pdfHistory2===void 0||_this$pdfHistory2.forward();break;case"NextPage":this.pdfViewer.nextPage();break;case"PrevPage":this.pdfViewer.previousPage();break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1;break}this.eventBus.dispatch("namedaction",{source:this,action:action})}},{key:"executeSetOCGState",value:function(){var _executeSetOCGState=_asyncToGenerator(_regeneratorRuntime().mark(function _callee67(action){var pdfDocument,optionalContentConfig,operator,_iterator166,_step166,elem,group;return _regeneratorRuntime().wrap(function _callee67$(_context68){while(1)switch(_context68.prev=_context68.next){case 0:pdfDocument=this.pdfDocument;_context68.next=3;return this.pdfViewer.optionalContentConfigPromise;case 3:optionalContentConfig=_context68.sent;if(!(pdfDocument!==this.pdfDocument)){_context68.next=6;break}return _context68.abrupt("return");case 6:_iterator166=_createForOfIteratorHelper(action.state);_context68.prev=7;_iterator166.s();case 9:if((_step166=_iterator166.n()).done){_context68.next=28;break}elem=_step166.value;_context68.t0=elem;_context68.next=_context68.t0==="ON"?14:_context68.t0==="OFF"?14:_context68.t0==="Toggle"?14:16;break;case 14:operator=elem;return _context68.abrupt("continue",26);case 16:_context68.t1=operator;_context68.next=_context68.t1==="ON"?19:_context68.t1==="OFF"?21:_context68.t1==="Toggle"?23:26;break;case 19:optionalContentConfig.setVisibility(elem,true);return _context68.abrupt("break",26);case 21:optionalContentConfig.setVisibility(elem,false);return _context68.abrupt("break",26);case 23:group=optionalContentConfig.getGroup(elem);if(group){optionalContentConfig.setVisibility(elem,!group.visible)}return _context68.abrupt("break",26);case 26:_context68.next=9;break;case 28:_context68.next=33;break;case 30:_context68.prev=30;_context68.t2=_context68["catch"](7);_iterator166.e(_context68.t2);case 33:_context68.prev=33;_iterator166.f();return _context68.finish(33);case 36:this.pdfViewer.optionalContentConfigPromise=Promise.resolve(optionalContentConfig);case 37:case"end":return _context68.stop()}},_callee67,this,[[7,30,33,36]])}));function executeSetOCGState(_x66){return _executeSetOCGState.apply(this,arguments)}return executeSetOCGState}()},{key:"cachePageRef",value:function cachePageRef(pageNum,pageRef){if(!pageRef){return}var refStr=pageRef.gen===0?"".concat(pageRef.num,"R"):"".concat(pageRef.num,"R").concat(pageRef.gen);_classPrivateFieldGet(this,_pagesRefCache).set(refStr,pageNum)}},{key:"_cachedPageNumber",value:function _cachedPageNumber(pageRef){if(!pageRef){return null}var refStr=pageRef.gen===0?"".concat(pageRef.num,"R"):"".concat(pageRef.num,"R").concat(pageRef.gen);return _classPrivateFieldGet(this,_pagesRefCache).get(refStr)||null}}]);return PDFLinkService}();function _goToDestinationHelper2(rawDest){var _this148=this;var namedDest=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var explicitDest=arguments.length>2?arguments[2]:undefined;var destRef=explicitDest[0];var pageNumber;if(_typeof2(destRef)==="object"&&destRef!==null){pageNumber=this._cachedPageNumber(destRef);if(!pageNumber){this.pdfDocument.getPageIndex(destRef).then(function(pageIndex){_this148.cachePageRef(pageIndex+1,destRef);_classPrivateMethodGet(_this148,_goToDestinationHelper,_goToDestinationHelper2).call(_this148,rawDest,namedDest,explicitDest)})["catch"](function(){console.error("PDFLinkService.#goToDestinationHelper: \"".concat(destRef,"\" is not ")+"a valid page reference, for dest=\"".concat(rawDest,"\"."))});return}}else if(Number.isInteger(destRef)){pageNumber=destRef+1}else{console.error("PDFLinkService.#goToDestinationHelper: \"".concat(destRef,"\" is not ")+"a valid destination reference, for dest=\"".concat(rawDest,"\"."));return}if(!pageNumber||pageNumber<1||pageNumber>this.pagesCount){console.error("PDFLinkService.#goToDestinationHelper: \"".concat(pageNumber,"\" is not ")+"a valid page number, for dest=\"".concat(rawDest,"\"."));return}if(this.pdfHistory){this.pdfHistory.pushCurrentPosition();this.pdfHistory.push({namedDest:namedDest,explicitDest:explicitDest,pageNumber:pageNumber})}this.pdfViewer.scrollPageIntoView({pageNumber:pageNumber,destArray:explicitDest,ignoreDestinationZoom:this._ignoreDestinationZoom})}function _isValidExplicitDestination(dest){if(!Array.isArray(dest)){return false}var destLength=dest.length;if(destLength<2){return false}var page=dest[0];if(!(_typeof2(page)==="object"&&Number.isInteger(page.num)&&Number.isInteger(page.gen))&&!(Number.isInteger(page)&&page>=0)){return false}var zoom=dest[1];if(!(_typeof2(zoom)==="object"&&typeof zoom.name==="string")){return false}var allowNull=true;switch(zoom.name){case"XYZ":if(destLength!==5){return false}break;case"Fit":case"FitB":return destLength===2;case"FitH":case"FitBH":case"FitV":case"FitBV":if(destLength!==3){return false}break;case"FitR":if(destLength!==6){return false}allowNull=false;break;default:return false}for(var _i76=2;_i76<destLength;_i76++){var param=dest[_i76];if(!(typeof param==="number"||allowNull&&param===null)){return false}}return true}exports.PDFLinkService=PDFLinkService;var SimpleLinkService=function(){function SimpleLinkService(){_classCallCheck2(this,SimpleLinkService);this.externalLinkEnabled=true}_createClass2(SimpleLinkService,[{key:"pagesCount",get:function get(){return 0}},{key:"page",get:function get(){return 0},set:function set(value){}},{key:"rotation",get:function get(){return 0},set:function set(value){}},{key:"isInPresentationMode",get:function get(){return false}},{key:"goToDestination",value:function(){var _goToDestination2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee68(dest){return _regeneratorRuntime().wrap(function _callee68$(_context69){while(1)switch(_context69.prev=_context69.next){case 0:case"end":return _context69.stop()}},_callee68)}));function goToDestination(_x67){return _goToDestination2.apply(this,arguments)}return goToDestination}()},{key:"goToPage",value:function goToPage(val){}},{key:"addLinkAttributes",value:function addLinkAttributes(link,url){var newWindow=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;_addLinkAttributes(link,{url:url,enabled:this.externalLinkEnabled})}},{key:"getDestinationHash",value:function getDestinationHash(dest){return"#"}},{key:"getAnchorUrl",value:function getAnchorUrl(hash){return"#"}},{key:"setHash",value:function setHash(hash){}},{key:"executeNamedAction",value:function executeNamedAction(action){}},{key:"executeSetOCGState",value:function executeSetOCGState(action){}},{key:"cachePageRef",value:function cachePageRef(pageNum,pageRef){}}]);return SimpleLinkService}();exports.SimpleLinkService=SimpleLinkService}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.AnnotationLayerBuilder=void 0;var _pdfjsLib=__w_pdfjs_require__(4);var _l10n_utils=__w_pdfjs_require__(7);var _ui_utils=__w_pdfjs_require__(2);var _onPresentationModeChanged=new WeakMap;var _updatePresentationModeState=new WeakSet;var AnnotationLayerBuilder=function(){function AnnotationLayerBuilder(_ref121){var pageDiv=_ref121.pageDiv,pdfPage=_ref121.pdfPage,linkService=_ref121.linkService,downloadManager=_ref121.downloadManager,_ref121$annotationSto=_ref121.annotationStorage,annotationStorage=_ref121$annotationSto===void 0?null:_ref121$annotationSto,_ref121$imageResource=_ref121.imageResourcesPath,imageResourcesPath=_ref121$imageResource===void 0?"":_ref121$imageResource,_ref121$renderForms=_ref121.renderForms,renderForms=_ref121$renderForms===void 0?true:_ref121$renderForms,_ref121$l10n=_ref121.l10n,l10n=_ref121$l10n===void 0?_l10n_utils.NullL10n:_ref121$l10n,_ref121$enableScripti=_ref121.enableScripting,enableScripting=_ref121$enableScripti===void 0?false:_ref121$enableScripti,_ref121$hasJSActionsP=_ref121.hasJSActionsPromise,hasJSActionsPromise=_ref121$hasJSActionsP===void 0?null:_ref121$hasJSActionsP,_ref121$fieldObjectsP=_ref121.fieldObjectsPromise,fieldObjectsPromise=_ref121$fieldObjectsP===void 0?null:_ref121$fieldObjectsP,_ref121$annotationCan=_ref121.annotationCanvasMap,annotationCanvasMap=_ref121$annotationCan===void 0?null:_ref121$annotationCan,_ref121$accessibility=_ref121.accessibilityManager,accessibilityManager=_ref121$accessibility===void 0?null:_ref121$accessibility;_classCallCheck2(this,AnnotationLayerBuilder);_classPrivateMethodInitSpec(this,_updatePresentationModeState);_classPrivateFieldInitSpec(this,_onPresentationModeChanged,{writable:true,value:null});this.pageDiv=pageDiv;this.pdfPage=pdfPage;this.linkService=linkService;this.downloadManager=downloadManager;this.imageResourcesPath=imageResourcesPath;this.renderForms=renderForms;this.l10n=l10n;this.annotationStorage=annotationStorage;this.enableScripting=enableScripting;this._hasJSActionsPromise=hasJSActionsPromise||Promise.resolve(false);this._fieldObjectsPromise=fieldObjectsPromise||Promise.resolve(null);this._annotationCanvasMap=annotationCanvasMap;this._accessibilityManager=accessibilityManager;this.annotationLayer=null;this.div=null;this._cancelled=false;this._eventBus=linkService.eventBus}_createClass2(AnnotationLayerBuilder,[{key:"render",value:function(){var _render3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee69(viewport){var _this149=this;var intent,_yield$Promise$all,_yield$Promise$all2,annotations,hasJSActions,fieldObjects,div,_this$_eventBus,_args70=arguments;return _regeneratorRuntime().wrap(function _callee69$(_context70){while(1)switch(_context70.prev=_context70.next){case 0:intent=_args70.length>1&&_args70[1]!==undefined?_args70[1]:"display";if(!this.div){_context70.next=6;break}if(!(this._cancelled||!this.annotationLayer)){_context70.next=4;break}return _context70.abrupt("return");case 4:this.annotationLayer.update({viewport:viewport.clone({dontFlip:true})});return _context70.abrupt("return");case 6:_context70.next=8;return Promise.all([this.pdfPage.getAnnotations({intent:intent}),this._hasJSActionsPromise,this._fieldObjectsPromise]);case 8:_yield$Promise$all=_context70.sent;_yield$Promise$all2=_slicedToArray2(_yield$Promise$all,3);annotations=_yield$Promise$all2[0];hasJSActions=_yield$Promise$all2[1];fieldObjects=_yield$Promise$all2[2];if(!this._cancelled){_context70.next=15;break}return _context70.abrupt("return");case 15:div=this.div=document.createElement("div");div.className="annotationLayer";this.pageDiv.append(div);if(!(annotations.length===0)){_context70.next=21;break}this.hide();return _context70.abrupt("return");case 21:this.annotationLayer=new _pdfjsLib.AnnotationLayer({div:div,accessibilityManager:this._accessibilityManager,annotationCanvasMap:this._annotationCanvasMap,l10n:this.l10n,page:this.pdfPage,viewport:viewport.clone({dontFlip:true})});_context70.next=24;return this.annotationLayer.render({annotations:annotations,imageResourcesPath:this.imageResourcesPath,renderForms:this.renderForms,linkService:this.linkService,downloadManager:this.downloadManager,annotationStorage:this.annotationStorage,enableScripting:this.enableScripting,hasJSActions:hasJSActions,fieldObjects:fieldObjects});case 24:if(this.linkService.isInPresentationMode){_classPrivateMethodGet(this,_updatePresentationModeState,_updatePresentationModeState2).call(this,_ui_utils.PresentationModeState.FULLSCREEN)}if(!_classPrivateFieldGet(this,_onPresentationModeChanged)){_classPrivateFieldSet(this,_onPresentationModeChanged,function(evt){_classPrivateMethodGet(_this149,_updatePresentationModeState,_updatePresentationModeState2).call(_this149,evt.state)});(_this$_eventBus=this._eventBus)===null||_this$_eventBus===void 0||_this$_eventBus._on("presentationmodechanged",_classPrivateFieldGet(this,_onPresentationModeChanged))}case 26:case"end":return _context70.stop()}},_callee69,this)}));function render(_x68){return _render3.apply(this,arguments)}return render}()},{key:"cancel",value:function cancel(){this._cancelled=true;if(_classPrivateFieldGet(this,_onPresentationModeChanged)){var _this$_eventBus2;(_this$_eventBus2=this._eventBus)===null||_this$_eventBus2===void 0||_this$_eventBus2._off("presentationmodechanged",_classPrivateFieldGet(this,_onPresentationModeChanged));_classPrivateFieldSet(this,_onPresentationModeChanged,null)}}},{key:"hide",value:function hide(){if(!this.div){return}this.div.hidden=true}}]);return AnnotationLayerBuilder}();function _updatePresentationModeState2(state){if(!this.div){return}var disableFormElements=false;switch(state){case _ui_utils.PresentationModeState.FULLSCREEN:disableFormElements=true;break;case _ui_utils.PresentationModeState.NORMAL:break;default:return}var _iterator167=_createForOfIteratorHelper(this.div.childNodes),_step167;try{for(_iterator167.s();!(_step167=_iterator167.n()).done;){var section=_step167.value;if(section.hasAttribute("data-internal-link")){continue}section.inert=disableFormElements}}catch(err){_iterator167.e(err)}finally{_iterator167.f()}}exports.AnnotationLayerBuilder=AnnotationLayerBuilder}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.NullL10n=void 0;exports.getL10nFallback=getL10nFallback;var DEFAULT_L10N_STRINGS={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} \xD7 {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} \xD7 {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing\u2026",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};{DEFAULT_L10N_STRINGS.print_progress_percent="{{progress}}%"}function getL10nFallback(key,args){switch(key){case"find_match_count":key="find_match_count[".concat(args.total===1?"one":"other","]");break;case"find_match_count_limit":key="find_match_count_limit[".concat(args.limit===1?"one":"other","]");break}return DEFAULT_L10N_STRINGS[key]||""}function formatL10nValue(text,args){if(!args){return text}return text.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,function(all,name){return name in args?args[name]:"{{"+name+"}}"})}var NullL10n={getLanguage:function getLanguage(){return _asyncToGenerator(_regeneratorRuntime().mark(function _callee70(){return _regeneratorRuntime().wrap(function _callee70$(_context71){while(1)switch(_context71.prev=_context71.next){case 0:return _context71.abrupt("return","en-us");case 1:case"end":return _context71.stop()}},_callee70)}))()},getDirection:function getDirection(){return _asyncToGenerator(_regeneratorRuntime().mark(function _callee71(){return _regeneratorRuntime().wrap(function _callee71$(_context72){while(1)switch(_context72.prev=_context72.next){case 0:return _context72.abrupt("return","ltr");case 1:case"end":return _context72.stop()}},_callee71)}))()},get:function get(key){var _arguments3=arguments;return _asyncToGenerator(_regeneratorRuntime().mark(function _callee72(){var args,fallback;return _regeneratorRuntime().wrap(function _callee72$(_context73){while(1)switch(_context73.prev=_context73.next){case 0:args=_arguments3.length>1&&_arguments3[1]!==undefined?_arguments3[1]:null;fallback=_arguments3.length>2&&_arguments3[2]!==undefined?_arguments3[2]:getL10nFallback(key,args);return _context73.abrupt("return",formatL10nValue(fallback,args));case 3:case"end":return _context73.stop()}},_callee72)}))()},translate:function translate(element){return _asyncToGenerator(_regeneratorRuntime().mark(function _callee73(){return _regeneratorRuntime().wrap(function _callee73$(_context74){while(1)switch(_context74.prev=_context74.next){case 0:case"end":return _context74.stop()}},_callee73)}))()}};exports.NullL10n=NullL10n}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.DownloadManager=void 0;var _pdfjsLib=__w_pdfjs_require__(4);function _download3(blobUrl,filename){var a=document.createElement("a");if(!a.click){throw new Error("DownloadManager: \"a.click()\" is not supported.")}a.href=blobUrl;a.target="_parent";if("download"in a){a.download=filename}(document.body||document.documentElement).append(a);a.click();a.remove()}var _openBlobUrls=new WeakMap;var DownloadManager=function(){function DownloadManager(){_classCallCheck2(this,DownloadManager);_classPrivateFieldInitSpec(this,_openBlobUrls,{writable:true,value:new WeakMap})}_createClass2(DownloadManager,[{key:"downloadUrl",value:function downloadUrl(url,filename,_options){if(!(0,_pdfjsLib.createValidAbsoluteUrl)(url,"http://example.com")){console.error("downloadUrl - not a valid URL: ".concat(url));return}_download3(url+"#pdfjs.action=download",filename)}},{key:"downloadData",value:function downloadData(data,filename,contentType){var blobUrl=URL.createObjectURL(new Blob([data],{type:contentType}));_download3(blobUrl,filename)}},{key:"openOrDownloadData",value:function openOrDownloadData(element,data,filename){var isPdfData=(0,_pdfjsLib.isPdfFile)(filename);var contentType=isPdfData?"application/pdf":"";this.downloadData(data,filename,contentType);return false}},{key:"download",value:function download(blob,url,filename,_options){var blobUrl=URL.createObjectURL(blob);_download3(blobUrl,filename)}}]);return DownloadManager}();exports.DownloadManager=DownloadManager}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.WaitOnType=exports.EventBus=exports.AutomationEventBus=void 0;exports.waitOnEventOrTimeout=waitOnEventOrTimeout;var WaitOnType={EVENT:"event",TIMEOUT:"timeout"};exports.WaitOnType=WaitOnType;function waitOnEventOrTimeout(_ref122){var target=_ref122.target,name=_ref122.name,_ref122$delay=_ref122.delay,delay=_ref122$delay===void 0?0:_ref122$delay;return new Promise(function(resolve,reject){if(_typeof2(target)!=="object"||!(name&&typeof name==="string")||!(Number.isInteger(delay)&&delay>=0)){throw new Error("waitOnEventOrTimeout - invalid parameters.")}function handler(type){if(target instanceof EventBus){target._off(name,eventHandler)}else{target.removeEventListener(name,eventHandler)}if(timeout){clearTimeout(timeout)}resolve(type)}var eventHandler=handler.bind(null,WaitOnType.EVENT);if(target instanceof EventBus){target._on(name,eventHandler)}else{target.addEventListener(name,eventHandler)}var timeoutHandler=handler.bind(null,WaitOnType.TIMEOUT);var timeout=setTimeout(timeoutHandler,delay)})}var _listeners2=new WeakMap;var EventBus=function(){function EventBus(){_classCallCheck2(this,EventBus);_classPrivateFieldInitSpec(this,_listeners2,{writable:true,value:Object.create(null)})}_createClass2(EventBus,[{key:"on",value:function on(eventName,listener){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this._on(eventName,listener,{external:true,once:options===null||options===void 0?void 0:options.once})}},{key:"off",value:function off(eventName,listener){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this._off(eventName,listener,{external:true,once:options===null||options===void 0?void 0:options.once})}},{key:"dispatch",value:function dispatch(eventName,data){var eventListeners=_classPrivateFieldGet(this,_listeners2)[eventName];if(!eventListeners||eventListeners.length===0){return}var externalListeners;var _iterator168=_createForOfIteratorHelper(eventListeners.slice(0)),_step168;try{for(_iterator168.s();!(_step168=_iterator168.n()).done;){var _step168$value=_step168.value,_listener=_step168$value.listener,external=_step168$value.external,once=_step168$value.once;if(once){this._off(eventName,_listener)}if(external){(externalListeners||(externalListeners=[])).push(_listener);continue}_listener(data)}}catch(err){_iterator168.e(err)}finally{_iterator168.f()}if(externalListeners){var _iterator169=_createForOfIteratorHelper(externalListeners),_step169;try{for(_iterator169.s();!(_step169=_iterator169.n()).done;){var listener=_step169.value;listener(data)}}catch(err){_iterator169.e(err)}finally{_iterator169.f()}externalListeners=null}}},{key:"_on",value:function _on(eventName,listener){var _classPrivateFieldGet44;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var eventListeners=(_classPrivateFieldGet44=_classPrivateFieldGet(this,_listeners2))[eventName]||(_classPrivateFieldGet44[eventName]=[]);eventListeners.push({listener:listener,external:(options===null||options===void 0?void 0:options.external)===true,once:(options===null||options===void 0?void 0:options.once)===true})}},{key:"_off",value:function _off(eventName,listener){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var eventListeners=_classPrivateFieldGet(this,_listeners2)[eventName];if(!eventListeners){return}for(var _i77=0,ii=eventListeners.length;_i77<ii;_i77++){if(eventListeners[_i77].listener===listener){eventListeners.splice(_i77,1);return}}}}]);return EventBus}();exports.EventBus=EventBus;var AutomationEventBus=function(_EventBus){_inherits2(AutomationEventBus,_EventBus);var _super66=_createSuper(AutomationEventBus);function AutomationEventBus(){_classCallCheck2(this,AutomationEventBus);return _super66.apply(this,arguments)}_createClass2(AutomationEventBus,[{key:"dispatch",value:function dispatch(eventName,data){throw new Error("Not implemented: AutomationEventBus.dispatch")}}]);return AutomationEventBus}(EventBus);exports.AutomationEventBus=AutomationEventBus}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.GenericL10n=void 0;__w_pdfjs_require__(11);var _l10n_utils=__w_pdfjs_require__(7);var PARTIAL_LANG_CODES={en:"en-US",es:"es-ES",fy:"fy-NL",ga:"ga-IE",gu:"gu-IN",hi:"hi-IN",hy:"hy-AM",nb:"nb-NO",ne:"ne-NP",nn:"nn-NO",pa:"pa-IN",pt:"pt-PT",sv:"sv-SE",zh:"zh-CN"};function fixupLangCode(langCode){return PARTIAL_LANG_CODES[langCode===null||langCode===void 0?void 0:langCode.toLowerCase()]||langCode}var GenericL10n=function(){function GenericL10n(lang){_classCallCheck2(this,GenericL10n);var _document6=document,webL10n=_document6.webL10n;this._lang=lang;this._ready=new Promise(function(resolve,reject){webL10n.setLanguage(fixupLangCode(lang),function(){resolve(webL10n)})})}_createClass2(GenericL10n,[{key:"getLanguage",value:function(){var _getLanguage=_asyncToGenerator(_regeneratorRuntime().mark(function _callee74(){var l10n;return _regeneratorRuntime().wrap(function _callee74$(_context75){while(1)switch(_context75.prev=_context75.next){case 0:_context75.next=2;return this._ready;case 2:l10n=_context75.sent;return _context75.abrupt("return",l10n.getLanguage());case 4:case"end":return _context75.stop()}},_callee74,this)}));function getLanguage(){return _getLanguage.apply(this,arguments)}return getLanguage}()},{key:"getDirection",value:function(){var _getDirection=_asyncToGenerator(_regeneratorRuntime().mark(function _callee75(){var l10n;return _regeneratorRuntime().wrap(function _callee75$(_context76){while(1)switch(_context76.prev=_context76.next){case 0:_context76.next=2;return this._ready;case 2:l10n=_context76.sent;return _context76.abrupt("return",l10n.getDirection());case 4:case"end":return _context76.stop()}},_callee75,this)}));function getDirection(){return _getDirection.apply(this,arguments)}return getDirection}()},{key:"get",value:function(){var _get6=_asyncToGenerator(_regeneratorRuntime().mark(function _callee76(key){var args,fallback,l10n,_args77=arguments;return _regeneratorRuntime().wrap(function _callee76$(_context77){while(1)switch(_context77.prev=_context77.next){case 0:args=_args77.length>1&&_args77[1]!==undefined?_args77[1]:null;fallback=_args77.length>2&&_args77[2]!==undefined?_args77[2]:(0,_l10n_utils.getL10nFallback)(key,args);_context77.next=4;return this._ready;case 4:l10n=_context77.sent;return _context77.abrupt("return",l10n.get(key,args,fallback));case 6:case"end":return _context77.stop()}},_callee76,this)}));function get(_x69){return _get6.apply(this,arguments)}return get}()},{key:"translate",value:function(){var _translate3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee77(element){var l10n;return _regeneratorRuntime().wrap(function _callee77$(_context78){while(1)switch(_context78.prev=_context78.next){case 0:_context78.next=2;return this._ready;case 2:l10n=_context78.sent;return _context78.abrupt("return",l10n.translate(element));case 4:case"end":return _context78.stop()}},_callee77,this)}));function translate(_x70){return _translate3.apply(this,arguments)}return translate}()}]);return GenericL10n}();exports.GenericL10n=GenericL10n}),(function(){document.webL10n=function(window,document){var gL10nData={};var gTextData="";var gTextProp="textContent";var gLanguage="";var gMacros={};var gReadyState="loading";var gAsyncResourceLoading=true;function getL10nResourceLinks(){return document.querySelectorAll("link[type=\"application/l10n\"]")}function getL10nDictionary(){var script=document.querySelector("script[type=\"application/l10n\"]");return script?JSON.parse(script.innerHTML):null}function getTranslatableChildren(element){return element?element.querySelectorAll("*[data-l10n-id]"):[]}function getL10nAttributes(element){if(!element)return{};var l10nId=element.getAttribute("data-l10n-id");var l10nArgs=element.getAttribute("data-l10n-args");var args={};if(l10nArgs){try{args=JSON.parse(l10nArgs)}catch(e){console.warn("could not parse arguments for #"+l10nId)}}return{id:l10nId,args:args}}function xhrLoadText(url,onSuccess,onFailure){onSuccess=onSuccess||function _onSuccess(data){};onFailure=onFailure||function _onFailure(){};var xhr=new XMLHttpRequest;xhr.open("GET",url,gAsyncResourceLoading);if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=utf-8")}xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200||xhr.status===0){onSuccess(xhr.responseText)}else{onFailure()}}};xhr.onerror=onFailure;xhr.ontimeout=onFailure;try{xhr.send(null)}catch(e){onFailure()}}function parseResource(href,lang,successCallback,failureCallback){var baseURL=href.replace(/[^\/]*$/,"")||"./";function evalString(text){if(text.lastIndexOf("\\")<0)return text;return text.replace(/\\\\/g,"\\").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\{/g,"{").replace(/\\}/g,"}").replace(/\\"/g,"\"").replace(/\\'/g,"'")}function parseProperties(text,parsedPropertiesCallback){var dictionary={};var reBlank=/^\s*|\s*$/;var reComment=/^\s*#|^\s*$/;var reSection=/^\s*\[(.*)\]\s*$/;var reImport=/^\s*@import\s+url\((.*)\)\s*$/i;var reSplit=/^([^=\s]*)\s*=\s*(.+)$/;function parseRawLines(rawText,extendedSyntax,parsedRawLinesCallback){var entries=rawText.replace(reBlank,"").split(/[\r\n]+/);var currentLang="*";var genericLang=lang.split("-",1)[0];var skipLang=false;var match="";function nextEntry(){while(true){if(!entries.length){parsedRawLinesCallback();return}var line=entries.shift();if(reComment.test(line))continue;if(extendedSyntax){match=reSection.exec(line);if(match){currentLang=match[1].toLowerCase();skipLang=currentLang!=="*"&&currentLang!==lang&&currentLang!==genericLang;continue}else if(skipLang){continue}match=reImport.exec(line);if(match){loadImport(baseURL+match[1],nextEntry);return}}var tmp=line.match(reSplit);if(tmp&&tmp.length==3){dictionary[tmp[1]]=evalString(tmp[2])}}}nextEntry()}function loadImport(url,callback){xhrLoadText(url,function(content){parseRawLines(content,false,callback)},function(){console.warn(url+" not found.");callback()})}parseRawLines(text,true,function(){parsedPropertiesCallback(dictionary)})}xhrLoadText(href,function(response){gTextData+=response;parseProperties(response,function(data){for(var key in data){var id,prop,index=key.lastIndexOf(".");if(index>0){id=key.substring(0,index);prop=key.substring(index+1)}else{id=key;prop=gTextProp}if(!gL10nData[id]){gL10nData[id]={}}gL10nData[id][prop]=data[key]}if(successCallback){successCallback()}})},failureCallback)}function loadLocale(lang,callback){if(lang){lang=lang.toLowerCase()}callback=callback||function _callback(){};clear();gLanguage=lang;var langLinks=getL10nResourceLinks();var langCount=langLinks.length;if(langCount===0){var dict=getL10nDictionary();if(dict&&dict.locales&&dict.default_locale){console.log("using the embedded JSON directory, early way out");gL10nData=dict.locales[lang];if(!gL10nData){var defaultLocale=dict.default_locale.toLowerCase();for(var anyCaseLang in dict.locales){anyCaseLang=anyCaseLang.toLowerCase();if(anyCaseLang===lang){gL10nData=dict.locales[lang];break}else if(anyCaseLang===defaultLocale){gL10nData=dict.locales[defaultLocale]}}}callback()}else{console.log("no resource to load, early way out")}gReadyState="complete";return}var onResourceLoaded=null;var gResourceCount=0;onResourceLoaded=function onResourceLoaded(){gResourceCount++;if(gResourceCount>=langCount){callback();gReadyState="complete"}};function L10nResourceLink(link){var href=link.href;this.load=function(lang,callback){parseResource(href,lang,callback,function(){console.warn(href+" not found.");console.warn("\""+lang+"\" resource not found");gLanguage="";callback()})}}for(var i=0;i<langCount;i++){var resource=new L10nResourceLink(langLinks[i]);resource.load(lang,onResourceLoaded)}}function clear(){gL10nData={};gTextData="";gLanguage=""}function getPluralRules(lang){var locales2rules={"af":3,"ak":4,"am":4,"ar":1,"asa":3,"az":0,"be":11,"bem":3,"bez":3,"bg":3,"bh":4,"bm":0,"bn":3,"bo":0,"br":20,"brx":3,"bs":11,"ca":3,"cgg":3,"chr":3,"cs":12,"cy":17,"da":3,"de":3,"dv":3,"dz":0,"ee":3,"el":3,"en":3,"eo":3,"es":3,"et":3,"eu":3,"fa":0,"ff":5,"fi":3,"fil":4,"fo":3,"fr":5,"fur":3,"fy":3,"ga":8,"gd":24,"gl":3,"gsw":3,"gu":3,"guw":4,"gv":23,"ha":3,"haw":3,"he":2,"hi":4,"hr":11,"hu":0,"id":0,"ig":0,"ii":0,"is":3,"it":3,"iu":7,"ja":0,"jmc":3,"jv":0,"ka":0,"kab":5,"kaj":3,"kcg":3,"kde":0,"kea":0,"kk":3,"kl":3,"km":0,"kn":0,"ko":0,"ksb":3,"ksh":21,"ku":3,"kw":7,"lag":18,"lb":3,"lg":3,"ln":4,"lo":0,"lt":10,"lv":6,"mas":3,"mg":4,"mk":16,"ml":3,"mn":3,"mo":9,"mr":3,"ms":0,"mt":15,"my":0,"nah":3,"naq":7,"nb":3,"nd":3,"ne":3,"nl":3,"nn":3,"no":3,"nr":3,"nso":4,"ny":3,"nyn":3,"om":3,"or":3,"pa":3,"pap":3,"pl":13,"ps":3,"pt":3,"rm":3,"ro":9,"rof":3,"ru":11,"rwk":3,"sah":0,"saq":3,"se":7,"seh":3,"ses":0,"sg":0,"sh":11,"shi":19,"sk":12,"sl":14,"sma":7,"smi":7,"smj":7,"smn":7,"sms":7,"sn":3,"so":3,"sq":3,"sr":11,"ss":3,"ssy":3,"st":3,"sv":3,"sw":3,"syr":3,"ta":3,"te":3,"teo":3,"th":0,"ti":4,"tig":3,"tk":3,"tl":4,"tn":3,"to":0,"tr":0,"ts":3,"tzm":22,"uk":11,"ur":3,"ve":3,"vi":0,"vun":3,"wa":4,"wae":3,"wo":0,"xh":3,"xog":3,"yo":0,"zh":0,"zu":3};function isIn(n,list){return list.indexOf(n)!==-1}function isBetween(n,start,end){return start<=n&&n<=end}var pluralRules={"0":function _(n){return"other"},"1":function _(n){if(isBetween(n%100,3,10))return"few";if(n===0)return"zero";if(isBetween(n%100,11,99))return"many";if(n==2)return"two";if(n==1)return"one";return"other"},"2":function _(n){if(n!==0&&n%10===0)return"many";if(n==2)return"two";if(n==1)return"one";return"other"},"3":function _(n){if(n==1)return"one";return"other"},"4":function _(n){if(isBetween(n,0,1))return"one";return"other"},"5":function _(n){if(isBetween(n,0,2)&&n!=2)return"one";return"other"},"6":function _(n){if(n===0)return"zero";if(n%10==1&&n%100!=11)return"one";return"other"},"7":function _(n){if(n==2)return"two";if(n==1)return"one";return"other"},"8":function _(n){if(isBetween(n,3,6))return"few";if(isBetween(n,7,10))return"many";if(n==2)return"two";if(n==1)return"one";return"other"},"9":function _(n){if(n===0||n!=1&&isBetween(n%100,1,19))return"few";if(n==1)return"one";return"other"},"10":function _(n){if(isBetween(n%10,2,9)&&!isBetween(n%100,11,19))return"few";if(n%10==1&&!isBetween(n%100,11,19))return"one";return"other"},"11":function _(n){if(isBetween(n%10,2,4)&&!isBetween(n%100,12,14))return"few";if(n%10===0||isBetween(n%10,5,9)||isBetween(n%100,11,14))return"many";if(n%10==1&&n%100!=11)return"one";return"other"},"12":function _(n){if(isBetween(n,2,4))return"few";if(n==1)return"one";return"other"},"13":function _(n){if(isBetween(n%10,2,4)&&!isBetween(n%100,12,14))return"few";if(n!=1&&isBetween(n%10,0,1)||isBetween(n%10,5,9)||isBetween(n%100,12,14))return"many";if(n==1)return"one";return"other"},"14":function _(n){if(isBetween(n%100,3,4))return"few";if(n%100==2)return"two";if(n%100==1)return"one";return"other"},"15":function _(n){if(n===0||isBetween(n%100,2,10))return"few";if(isBetween(n%100,11,19))return"many";if(n==1)return"one";return"other"},"16":function _(n){if(n%10==1&&n!=11)return"one";return"other"},"17":function _(n){if(n==3)return"few";if(n===0)return"zero";if(n==6)return"many";if(n==2)return"two";if(n==1)return"one";return"other"},"18":function _(n){if(n===0)return"zero";if(isBetween(n,0,2)&&n!==0&&n!=2)return"one";return"other"},"19":function _(n){if(isBetween(n,2,10))return"few";if(isBetween(n,0,1))return"one";return"other"},"20":function _(n){if((isBetween(n%10,3,4)||n%10==9)&&!(isBetween(n%100,10,19)||isBetween(n%100,70,79)||isBetween(n%100,90,99)))return"few";if(n%1000000===0&&n!==0)return"many";if(n%10==2&&!isIn(n%100,[12,72,92]))return"two";if(n%10==1&&!isIn(n%100,[11,71,91]))return"one";return"other"},"21":function _(n){if(n===0)return"zero";if(n==1)return"one";return"other"},"22":function _(n){if(isBetween(n,0,1)||isBetween(n,11,99))return"one";return"other"},"23":function _(n){if(isBetween(n%10,1,2)||n%20===0)return"one";return"other"},"24":function _(n){if(isBetween(n,3,10)||isBetween(n,13,19))return"few";if(isIn(n,[2,12]))return"two";if(isIn(n,[1,11]))return"one";return"other"}};var index=locales2rules[lang.replace(/-.*$/,"")];if(!(index in pluralRules)){console.warn("plural form unknown for ["+lang+"]");return function(){return"other"}}return pluralRules[index]}gMacros.plural=function(str,param,key,prop){var n=parseFloat(param);if(isNaN(n))return str;if(prop!=gTextProp)return str;if(!gMacros._pluralRules){gMacros._pluralRules=getPluralRules(gLanguage)}var index="["+gMacros._pluralRules(n)+"]";if(n===0&&key+"[zero]"in gL10nData){str=gL10nData[key+"[zero]"][prop]}else if(n==1&&key+"[one]"in gL10nData){str=gL10nData[key+"[one]"][prop]}else if(n==2&&key+"[two]"in gL10nData){str=gL10nData[key+"[two]"][prop]}else if(key+index in gL10nData){str=gL10nData[key+index][prop]}else if(key+"[other]"in gL10nData){str=gL10nData[key+"[other]"][prop]}return str};function getL10nData(key,args,fallback){var data=gL10nData[key];if(!data){console.warn("#"+key+" is undefined.");if(!fallback){return null}data=fallback}var rv={};for(var prop in data){var str=data[prop];str=substIndexes(str,args,key,prop);str=substArguments(str,args,key);rv[prop]=str}return rv}function substIndexes(str,args,key,prop){var reIndex=/\{\[\s*([a-zA-Z]+)\(([a-zA-Z]+)\)\s*\]\}/;var reMatch=reIndex.exec(str);if(!reMatch||!reMatch.length)return str;var macroName=reMatch[1];var paramName=reMatch[2];var param;if(args&&paramName in args){param=args[paramName]}else if(paramName in gL10nData){param=gL10nData[paramName]}if(macroName in gMacros){var macro=gMacros[macroName];str=macro(str,param,key,prop)}return str}function substArguments(str,args,key){var reArgs=/\{\{\s*(.+?)\s*\}\}/g;return str.replace(reArgs,function(matched_text,arg){if(args&&arg in args){return args[arg]}if(arg in gL10nData){return gL10nData[arg]}console.log("argument {{"+arg+"}} for #"+key+" is undefined.");return matched_text})}function translateElement(element){var l10n=getL10nAttributes(element);if(!l10n.id)return;var data=getL10nData(l10n.id,l10n.args);if(!data){console.warn("#"+l10n.id+" is undefined.");return}if(data[gTextProp]){if(getChildElementCount(element)===0){element[gTextProp]=data[gTextProp]}else{var children=element.childNodes;var found=false;for(var i=0,l=children.length;i<l;i++){if(children[i].nodeType===3&&/\S/.test(children[i].nodeValue)){if(found){children[i].nodeValue=""}else{children[i].nodeValue=data[gTextProp];found=true}}}if(!found){var textNode=document.createTextNode(data[gTextProp]);element.prepend(textNode)}}delete data[gTextProp]}for(var k in data){element[k]=data[k]}}function getChildElementCount(element){if(element.children){return element.children.length}if(typeof element.childElementCount!=="undefined"){return element.childElementCount}var count=0;for(var i=0;i<element.childNodes.length;i++){count+=element.nodeType===1?1:0}return count}function translateFragment(element){element=element||document.documentElement;var children=getTranslatableChildren(element);var elementCount=children.length;for(var i=0;i<elementCount;i++){translateElement(children[i])}translateElement(element)}return{get:function get(key,args,fallbackString){var index=key.lastIndexOf(".");var prop=gTextProp;if(index>0){prop=key.substring(index+1);key=key.substring(0,index)}var fallback;if(fallbackString){fallback={};fallback[prop]=fallbackString}var data=getL10nData(key,args,fallback);if(data&&prop in data){return data[prop]}return"{{"+key+"}}"},getData:function getData(){return gL10nData},getText:function getText(){return gTextData},getLanguage:function getLanguage(){return gLanguage},setLanguage:function setLanguage(lang,callback){loadLocale(lang,function(){if(callback)callback()})},getDirection:function getDirection(){var rtlList=["ar","he","fa","ps","ur"];var shortCode=gLanguage.split("-",1)[0];return rtlList.indexOf(shortCode)>=0?"rtl":"ltr"},translate:translateFragment,getReadyState:function getReadyState(){return gReadyState},ready:function ready(callback){if(!callback){return}else if(gReadyState=="complete"||gReadyState=="interactive"){window.setTimeout(function(){callback()})}else if(document.addEventListener){document.addEventListener("localized",function once(){document.removeEventListener("localized",once);callback()})}}}}(window,document)}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFHistory=void 0;exports.isDestArraysEqual=isDestArraysEqual;exports.isDestHashesEqual=isDestHashesEqual;var _ui_utils=__w_pdfjs_require__(2);var _event_utils=__w_pdfjs_require__(9);var HASH_CHANGE_TIMEOUT=1000;var POSITION_UPDATED_THRESHOLD=50;var UPDATE_VIEWAREA_TIMEOUT=1000;function getCurrentHash(){return document.location.hash}var PDFHistory=function(){function PDFHistory(_ref123){var _this150=this;var linkService=_ref123.linkService,eventBus=_ref123.eventBus;_classCallCheck2(this,PDFHistory);this.linkService=linkService;this.eventBus=eventBus;this._initialized=false;this._fingerprint="";this.reset();this._boundEvents=null;this.eventBus._on("pagesinit",function(){_this150._isPagesLoaded=false;_this150.eventBus._on("pagesloaded",function(evt){_this150._isPagesLoaded=!!evt.pagesCount},{once:true})})}_createClass2(PDFHistory,[{key:"initialize",value:function initialize(_ref124){var fingerprint=_ref124.fingerprint,_ref124$resetHistory=_ref124.resetHistory,resetHistory=_ref124$resetHistory===void 0?false:_ref124$resetHistory,_ref124$updateUrl=_ref124.updateUrl,updateUrl=_ref124$updateUrl===void 0?false:_ref124$updateUrl;if(!fingerprint||typeof fingerprint!=="string"){console.error("PDFHistory.initialize: The \"fingerprint\" must be a non-empty string.");return}if(this._initialized){this.reset()}var reInitialized=this._fingerprint!==""&&this._fingerprint!==fingerprint;this._fingerprint=fingerprint;this._updateUrl=updateUrl===true;this._initialized=true;this._bindEvents();var state=window.history.state;this._popStateInProgress=false;this._blockHashChange=0;this._currentHash=getCurrentHash();this._numPositionUpdates=0;this._uid=this._maxUid=0;this._destination=null;this._position=null;if(!this._isValidState(state,true)||resetHistory){var _this$_parseCurrentHa=this._parseCurrentHash(true),_hash=_this$_parseCurrentHa.hash,page=_this$_parseCurrentHa.page,rotation=_this$_parseCurrentHa.rotation;if(!_hash||reInitialized||resetHistory){this._pushOrReplaceState(null,true);return}this._pushOrReplaceState({hash:_hash,page:page,rotation:rotation},true);return}var destination=state.destination;this._updateInternalState(destination,state.uid,true);if(destination.rotation!==undefined){this._initialRotation=destination.rotation}if(destination.dest){this._initialBookmark=JSON.stringify(destination.dest);this._destination.page=null}else if(destination.hash){this._initialBookmark=destination.hash}else if(destination.page){this._initialBookmark="page=".concat(destination.page)}}},{key:"reset",value:function reset(){if(this._initialized){this._pageHide();this._initialized=false;this._unbindEvents()}if(this._updateViewareaTimeout){clearTimeout(this._updateViewareaTimeout);this._updateViewareaTimeout=null}this._initialBookmark=null;this._initialRotation=null}},{key:"push",value:function push(_ref125){var _this151=this;var _ref125$namedDest=_ref125.namedDest,namedDest=_ref125$namedDest===void 0?null:_ref125$namedDest,explicitDest=_ref125.explicitDest,pageNumber=_ref125.pageNumber;if(!this._initialized){return}if(namedDest&&typeof namedDest!=="string"){console.error("PDFHistory.push: "+"\"".concat(namedDest,"\" is not a valid namedDest parameter."));return}else if(!Array.isArray(explicitDest)){console.error("PDFHistory.push: "+"\"".concat(explicitDest,"\" is not a valid explicitDest parameter."));return}else if(!this._isValidPage(pageNumber)){if(pageNumber!==null||this._destination){console.error("PDFHistory.push: "+"\"".concat(pageNumber,"\" is not a valid pageNumber parameter."));return}}var hash=namedDest||JSON.stringify(explicitDest);if(!hash){return}var forceReplace=false;if(this._destination&&(isDestHashesEqual(this._destination.hash,hash)||isDestArraysEqual(this._destination.dest,explicitDest))){if(this._destination.page){return}forceReplace=true}if(this._popStateInProgress&&!forceReplace){return}this._pushOrReplaceState({dest:explicitDest,hash:hash,page:pageNumber,rotation:this.linkService.rotation},forceReplace);if(!this._popStateInProgress){this._popStateInProgress=true;Promise.resolve().then(function(){_this151._popStateInProgress=false})}}},{key:"pushPage",value:function pushPage(pageNumber){var _this$_destination,_this152=this;if(!this._initialized){return}if(!this._isValidPage(pageNumber)){console.error("PDFHistory.pushPage: \"".concat(pageNumber,"\" is not a valid page number."));return}if(((_this$_destination=this._destination)===null||_this$_destination===void 0?void 0:_this$_destination.page)===pageNumber){return}if(this._popStateInProgress){return}this._pushOrReplaceState({dest:null,hash:"page=".concat(pageNumber),page:pageNumber,rotation:this.linkService.rotation});if(!this._popStateInProgress){this._popStateInProgress=true;Promise.resolve().then(function(){_this152._popStateInProgress=false})}}},{key:"pushCurrentPosition",value:function pushCurrentPosition(){if(!this._initialized||this._popStateInProgress){return}this._tryPushCurrentPosition()}},{key:"back",value:function back(){if(!this._initialized||this._popStateInProgress){return}var state=window.history.state;if(this._isValidState(state)&&state.uid>0){window.history.back()}}},{key:"forward",value:function forward(){if(!this._initialized||this._popStateInProgress){return}var state=window.history.state;if(this._isValidState(state)&&state.uid<this._maxUid){window.history.forward()}}},{key:"popStateInProgress",get:function get(){return this._initialized&&(this._popStateInProgress||this._blockHashChange>0)}},{key:"initialBookmark",get:function get(){return this._initialized?this._initialBookmark:null}},{key:"initialRotation",get:function get(){return this._initialized?this._initialRotation:null}},{key:"_pushOrReplaceState",value:function _pushOrReplaceState(destination){var forceReplace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var shouldReplace=forceReplace||!this._destination;var newState={fingerprint:this._fingerprint,uid:shouldReplace?this._uid:this._uid+1,destination:destination};this._updateInternalState(destination,newState.uid);var newUrl;if(this._updateUrl&&destination!==null&&destination!==void 0&&destination.hash){var baseUrl=document.location.href.split("#")[0];if(!baseUrl.startsWith("file://")){newUrl="".concat(baseUrl,"#").concat(destination.hash)}}if(shouldReplace){window.history.replaceState(newState,"",newUrl)}else{window.history.pushState(newState,"",newUrl)}}},{key:"_tryPushCurrentPosition",value:function _tryPushCurrentPosition(){var temporary=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this._position){return}var position=this._position;if(temporary){position=Object.assign(Object.create(null),this._position);position.temporary=true}if(!this._destination){this._pushOrReplaceState(position);return}if(this._destination.temporary){this._pushOrReplaceState(position,true);return}if(this._destination.hash===position.hash){return}if(!this._destination.page&&this._numPositionUpdates<=POSITION_UPDATED_THRESHOLD){return}var forceReplace=false;if(this._destination.page>=position.first&&this._destination.page<=position.page){if(this._destination.dest!==undefined||!this._destination.first){return}forceReplace=true}this._pushOrReplaceState(position,forceReplace)}},{key:"_isValidPage",value:function _isValidPage(val){return Number.isInteger(val)&&val>0&&val<=this.linkService.pagesCount}},{key:"_isValidState",value:function _isValidState(state){var checkReload=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!state){return false}if(state.fingerprint!==this._fingerprint){if(checkReload){if(typeof state.fingerprint!=="string"||state.fingerprint.length!==this._fingerprint.length){return false}var _performance$getEntri=performance.getEntriesByType("navigation"),_performance$getEntri2=_slicedToArray2(_performance$getEntri,1),perfEntry=_performance$getEntri2[0];if((perfEntry===null||perfEntry===void 0?void 0:perfEntry.type)!=="reload"){return false}}else{return false}}if(!Number.isInteger(state.uid)||state.uid<0){return false}if(state.destination===null||_typeof2(state.destination)!=="object"){return false}return true}},{key:"_updateInternalState",value:function _updateInternalState(destination,uid){var removeTemporary=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(this._updateViewareaTimeout){clearTimeout(this._updateViewareaTimeout);this._updateViewareaTimeout=null}if(removeTemporary&&destination!==null&&destination!==void 0&&destination.temporary){delete destination.temporary}this._destination=destination;this._uid=uid;this._maxUid=Math.max(this._maxUid,uid);this._numPositionUpdates=0}},{key:"_parseCurrentHash",value:function _parseCurrentHash(){var checkNameddest=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var hash=unescape(getCurrentHash()).substring(1);var params=(0,_ui_utils.parseQueryString)(hash);var nameddest=params.get("nameddest")||"";var page=params.get("page")|0;if(!this._isValidPage(page)||checkNameddest&&nameddest.length>0){page=null}return{hash:hash,page:page,rotation:this.linkService.rotation}}},{key:"_updateViewarea",value:function _updateViewarea(_ref126){var _this153=this;var location=_ref126.location;if(this._updateViewareaTimeout){clearTimeout(this._updateViewareaTimeout);this._updateViewareaTimeout=null}this._position={hash:location.pdfOpenParams.substring(1),page:this.linkService.page,first:location.pageNumber,rotation:location.rotation};if(this._popStateInProgress){return}if(this._isPagesLoaded&&this._destination&&!this._destination.page){this._numPositionUpdates++}{this._updateViewareaTimeout=setTimeout(function(){if(!_this153._popStateInProgress){_this153._tryPushCurrentPosition(true)}_this153._updateViewareaTimeout=null},UPDATE_VIEWAREA_TIMEOUT)}}},{key:"_popState",value:function _popState(_ref127){var _this154=this;var state=_ref127.state;var newHash=getCurrentHash(),hashChanged=this._currentHash!==newHash;this._currentHash=newHash;if(!state){this._uid++;var _this$_parseCurrentHa2=this._parseCurrentHash(),_hash2=_this$_parseCurrentHa2.hash,page=_this$_parseCurrentHa2.page,rotation=_this$_parseCurrentHa2.rotation;this._pushOrReplaceState({hash:_hash2,page:page,rotation:rotation},true);return}if(!this._isValidState(state)){return}this._popStateInProgress=true;if(hashChanged){this._blockHashChange++;(0,_event_utils.waitOnEventOrTimeout)({target:window,name:"hashchange",delay:HASH_CHANGE_TIMEOUT}).then(function(){_this154._blockHashChange--})}var destination=state.destination;this._updateInternalState(destination,state.uid,true);if((0,_ui_utils.isValidRotation)(destination.rotation)){this.linkService.rotation=destination.rotation}if(destination.dest){this.linkService.goToDestination(destination.dest)}else if(destination.hash){this.linkService.setHash(destination.hash)}else if(destination.page){this.linkService.page=destination.page}Promise.resolve().then(function(){_this154._popStateInProgress=false})}},{key:"_pageHide",value:function _pageHide(){if(!this._destination||this._destination.temporary){this._tryPushCurrentPosition()}}},{key:"_bindEvents",value:function _bindEvents(){if(this._boundEvents){return}this._boundEvents={updateViewarea:this._updateViewarea.bind(this),popState:this._popState.bind(this),pageHide:this._pageHide.bind(this)};this.eventBus._on("updateviewarea",this._boundEvents.updateViewarea);window.addEventListener("popstate",this._boundEvents.popState);window.addEventListener("pagehide",this._boundEvents.pageHide)}},{key:"_unbindEvents",value:function _unbindEvents(){if(!this._boundEvents){return}this.eventBus._off("updateviewarea",this._boundEvents.updateViewarea);window.removeEventListener("popstate",this._boundEvents.popState);window.removeEventListener("pagehide",this._boundEvents.pageHide);this._boundEvents=null}}]);return PDFHistory}();exports.PDFHistory=PDFHistory;function isDestHashesEqual(destHash,pushHash){if(typeof destHash!=="string"||typeof pushHash!=="string"){return false}if(destHash===pushHash){return true}var nameddest=(0,_ui_utils.parseQueryString)(destHash).get("nameddest");if(nameddest===pushHash){return true}return false}function isDestArraysEqual(firstDest,secondDest){function isEntryEqual(first,second){if(_typeof2(first)!==_typeof2(second)){return false}if(Array.isArray(first)||Array.isArray(second)){return false}if(first!==null&&_typeof2(first)==="object"&&second!==null){if(Object.keys(first).length!==Object.keys(second).length){return false}for(var key in first){if(!isEntryEqual(first[key],second[key])){return false}}return true}return first===second||Number.isNaN(first)&&Number.isNaN(second)}if(!(Array.isArray(firstDest)&&Array.isArray(secondDest))){return false}if(firstDest.length!==secondDest.length){return false}for(var _i78=0,ii=firstDest.length;_i78<ii;_i78++){if(!isEntryEqual(firstDest[_i78],secondDest[_i78])){return false}}return true}}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFPageView=void 0;var _pdfjsLib=__w_pdfjs_require__(4);var _ui_utils=__w_pdfjs_require__(2);var _annotation_editor_layer_builder=__w_pdfjs_require__(14);var _annotation_layer_builder=__w_pdfjs_require__(6);var _app_options=__w_pdfjs_require__(15);var _l10n_utils=__w_pdfjs_require__(7);var _pdf_link_service=__w_pdfjs_require__(5);var _struct_tree_layer_builder=__w_pdfjs_require__(16);var _text_accessibility=__w_pdfjs_require__(17);var _text_highlighter=__w_pdfjs_require__(18);var _text_layer_builder=__w_pdfjs_require__(19);var _xfa_layer_builder=__w_pdfjs_require__(20);var MAX_CANVAS_PIXELS=_app_options.compatibilityParams.maxCanvasPixels||16777216;var DEFAULT_LAYER_PROPERTIES=function DEFAULT_LAYER_PROPERTIES(){return{annotationEditorUIManager:null,annotationStorage:null,downloadManager:null,enableScripting:false,fieldObjectsPromise:null,findController:null,hasJSActionsPromise:null,get linkService(){return new _pdf_link_service.SimpleLinkService}}};var _annotationMode=new WeakMap;var _hasRestrictedScaling=new WeakMap;var _layerProperties=new WeakMap;var _loadingId=new WeakMap;var _previousRotation=new WeakMap;var _renderError=new WeakMap;var _renderingState=new WeakMap;var _textLayerMode=new WeakMap;var _useThumbnailCanvas=new WeakMap;var _viewportMap=new WeakMap;var _setDimensions3=new WeakSet;var _renderAnnotationLayer=new WeakSet;var _renderAnnotationEditorLayer=new WeakSet;var _renderXfaLayer=new WeakSet;var _renderTextLayer=new WeakSet;var _renderStructTreeLayer=new WeakSet;var _buildXfaTextContentItems=new WeakSet;var _finishRenderTask=new WeakSet;var PDFPageView=function(){function PDFPageView(options){var _options$textLayerMod,_options$annotationMo,_options$isOffscreenC,_options$maxCanvasPix,_this$renderingQueue,_this155=this;_classCallCheck2(this,PDFPageView);_classPrivateMethodInitSpec(this,_finishRenderTask);_classPrivateMethodInitSpec(this,_buildXfaTextContentItems);_classPrivateMethodInitSpec(this,_renderStructTreeLayer);_classPrivateMethodInitSpec(this,_renderTextLayer);_classPrivateMethodInitSpec(this,_renderXfaLayer);_classPrivateMethodInitSpec(this,_renderAnnotationEditorLayer);_classPrivateMethodInitSpec(this,_renderAnnotationLayer);_classPrivateMethodInitSpec(this,_setDimensions3);_classPrivateFieldInitSpec(this,_annotationMode,{writable:true,value:_pdfjsLib.AnnotationMode.ENABLE_FORMS});_classPrivateFieldInitSpec(this,_hasRestrictedScaling,{writable:true,value:false});_classPrivateFieldInitSpec(this,_layerProperties,{writable:true,value:null});_classPrivateFieldInitSpec(this,_loadingId,{writable:true,value:null});_classPrivateFieldInitSpec(this,_previousRotation,{writable:true,value:null});_classPrivateFieldInitSpec(this,_renderError,{writable:true,value:null});_classPrivateFieldInitSpec(this,_renderingState,{writable:true,value:_ui_utils.RenderingStates.INITIAL});_classPrivateFieldInitSpec(this,_textLayerMode,{writable:true,value:_ui_utils.TextLayerMode.ENABLE});_classPrivateFieldInitSpec(this,_useThumbnailCanvas,{writable:true,value:{directDrawing:true,initialOptionalContent:true,regularAnnotations:true}});_classPrivateFieldInitSpec(this,_viewportMap,{writable:true,value:new WeakMap});var container=options.container;var defaultViewport=options.defaultViewport;this.id=options.id;this.renderingId="page"+this.id;_classPrivateFieldSet(this,_layerProperties,options.layerProperties||DEFAULT_LAYER_PROPERTIES);this.pdfPage=null;this.pageLabel=null;this.rotation=0;this.scale=options.scale||_ui_utils.DEFAULT_SCALE;this.viewport=defaultViewport;this.pdfPageRotate=defaultViewport.rotation;this._optionalContentConfigPromise=options.optionalContentConfigPromise||null;_classPrivateFieldSet(this,_textLayerMode,(_options$textLayerMod=options.textLayerMode)!==null&&_options$textLayerMod!==void 0?_options$textLayerMod:_ui_utils.TextLayerMode.ENABLE);_classPrivateFieldSet(this,_annotationMode,(_options$annotationMo=options.annotationMode)!==null&&_options$annotationMo!==void 0?_options$annotationMo:_pdfjsLib.AnnotationMode.ENABLE_FORMS);this.imageResourcesPath=options.imageResourcesPath||"";this.isOffscreenCanvasSupported=(_options$isOffscreenC=options.isOffscreenCanvasSupported)!==null&&_options$isOffscreenC!==void 0?_options$isOffscreenC:true;this.maxCanvasPixels=(_options$maxCanvasPix=options.maxCanvasPixels)!==null&&_options$maxCanvasPix!==void 0?_options$maxCanvasPix:MAX_CANVAS_PIXELS;this.pageColors=options.pageColors||null;this.eventBus=options.eventBus;this.renderingQueue=options.renderingQueue;this.l10n=options.l10n||_l10n_utils.NullL10n;this.renderTask=null;this.resume=null;this._isStandalone=!((_this$renderingQueue=this.renderingQueue)!==null&&_this$renderingQueue!==void 0&&_this$renderingQueue.hasViewer());this._container=container;if(options.useOnlyCssZoom){console.error("useOnlyCssZoom was removed, please use `maxCanvasPixels = 0` instead.");this.maxCanvasPixels=0}this._annotationCanvasMap=null;this.annotationLayer=null;this.annotationEditorLayer=null;this.textLayer=null;this.zoomLayer=null;this.xfaLayer=null;this.structTreeLayer=null;var div=document.createElement("div");div.className="page";div.setAttribute("data-page-number",this.id);div.setAttribute("role","region");this.l10n.get("page_landmark",{page:this.id}).then(function(msg){div.setAttribute("aria-label",msg)});this.div=div;_classPrivateMethodGet(this,_setDimensions3,_setDimensions4).call(this);container===null||container===void 0||container.append(div);if(this._isStandalone){container===null||container===void 0||container.style.setProperty("--scale-factor",this.scale*_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS);var optionalContentConfigPromise=options.optionalContentConfigPromise;if(optionalContentConfigPromise){optionalContentConfigPromise.then(function(optionalContentConfig){if(optionalContentConfigPromise!==_this155._optionalContentConfigPromise){return}_classPrivateFieldGet(_this155,_useThumbnailCanvas).initialOptionalContent=optionalContentConfig.hasInitialVisibility})}}}_createClass2(PDFPageView,[{key:"renderingState",get:function get(){return _classPrivateFieldGet(this,_renderingState)},set:function set(state){var _this156=this;if(state===_classPrivateFieldGet(this,_renderingState)){return}_classPrivateFieldSet(this,_renderingState,state);if(_classPrivateFieldGet(this,_loadingId)){clearTimeout(_classPrivateFieldGet(this,_loadingId));_classPrivateFieldSet(this,_loadingId,null)}switch(state){case _ui_utils.RenderingStates.PAUSED:this.div.classList.remove("loading");break;case _ui_utils.RenderingStates.RUNNING:this.div.classList.add("loadingIcon");_classPrivateFieldSet(this,_loadingId,setTimeout(function(){_this156.div.classList.add("loading");_classPrivateFieldSet(_this156,_loadingId,null)},0));break;case _ui_utils.RenderingStates.INITIAL:case _ui_utils.RenderingStates.FINISHED:this.div.classList.remove("loadingIcon","loading");break}}},{key:"setPdfPage",value:function setPdfPage(pdfPage){var _this$pageColors,_this$pageColors2;if(this._isStandalone&&(((_this$pageColors=this.pageColors)===null||_this$pageColors===void 0?void 0:_this$pageColors.foreground)==="CanvasText"||((_this$pageColors2=this.pageColors)===null||_this$pageColors2===void 0?void 0:_this$pageColors2.background)==="Canvas")){var _this$_container;(_this$_container=this._container)===null||_this$_container===void 0||_this$_container.style.setProperty("--hcm-highligh-filter",pdfPage.filterFactory.addHighlightHCMFilter("CanvasText","Canvas","HighlightText","Highlight"))}this.pdfPage=pdfPage;this.pdfPageRotate=pdfPage.rotate;var totalRotation=(this.rotation+this.pdfPageRotate)%360;this.viewport=pdfPage.getViewport({scale:this.scale*_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:totalRotation});_classPrivateMethodGet(this,_setDimensions3,_setDimensions4).call(this);this.reset()}},{key:"destroy",value:function destroy(){var _this$pdfPage;this.reset();(_this$pdfPage=this.pdfPage)===null||_this$pdfPage===void 0||_this$pdfPage.cleanup()}},{key:"_textHighlighter",get:function get(){return(0,_pdfjsLib.shadow)(this,"_textHighlighter",new _text_highlighter.TextHighlighter({pageIndex:this.id-1,eventBus:this.eventBus,findController:_classPrivateFieldGet(this,_layerProperties).call(this).findController}))}},{key:"_resetZoomLayer",value:function _resetZoomLayer(){var removeFromDOM=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this.zoomLayer){return}var zoomLayerCanvas=this.zoomLayer.firstChild;_classPrivateFieldGet(this,_viewportMap)["delete"](zoomLayerCanvas);zoomLayerCanvas.width=0;zoomLayerCanvas.height=0;if(removeFromDOM){this.zoomLayer.remove()}this.zoomLayer=null}},{key:"reset",value:function reset(){var _this$annotationLayer,_this$annotationEdito,_this$xfaLayer,_this$textLayer,_this$structTreeLayer;var _ref128=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref128$keepZoomLayer=_ref128.keepZoomLayer,keepZoomLayer=_ref128$keepZoomLayer===void 0?false:_ref128$keepZoomLayer,_ref128$keepAnnotatio=_ref128.keepAnnotationLayer,keepAnnotationLayer=_ref128$keepAnnotatio===void 0?false:_ref128$keepAnnotatio,_ref128$keepAnnotatio2=_ref128.keepAnnotationEditorLayer,keepAnnotationEditorLayer=_ref128$keepAnnotatio2===void 0?false:_ref128$keepAnnotatio2,_ref128$keepXfaLayer=_ref128.keepXfaLayer,keepXfaLayer=_ref128$keepXfaLayer===void 0?false:_ref128$keepXfaLayer,_ref128$keepTextLayer=_ref128.keepTextLayer,keepTextLayer=_ref128$keepTextLayer===void 0?false:_ref128$keepTextLayer;this.cancelRendering({keepAnnotationLayer:keepAnnotationLayer,keepAnnotationEditorLayer:keepAnnotationEditorLayer,keepXfaLayer:keepXfaLayer,keepTextLayer:keepTextLayer});this.renderingState=_ui_utils.RenderingStates.INITIAL;var div=this.div;var childNodes=div.childNodes,zoomLayerNode=keepZoomLayer&&this.zoomLayer||null,annotationLayerNode=keepAnnotationLayer&&((_this$annotationLayer=this.annotationLayer)===null||_this$annotationLayer===void 0?void 0:_this$annotationLayer.div)||null,annotationEditorLayerNode=keepAnnotationEditorLayer&&((_this$annotationEdito=this.annotationEditorLayer)===null||_this$annotationEdito===void 0?void 0:_this$annotationEdito.div)||null,xfaLayerNode=keepXfaLayer&&((_this$xfaLayer=this.xfaLayer)===null||_this$xfaLayer===void 0?void 0:_this$xfaLayer.div)||null,textLayerNode=keepTextLayer&&((_this$textLayer=this.textLayer)===null||_this$textLayer===void 0?void 0:_this$textLayer.div)||null;for(var _i79=childNodes.length-1;_i79>=0;_i79--){var node=childNodes[_i79];switch(node){case zoomLayerNode:case annotationLayerNode:case annotationEditorLayerNode:case xfaLayerNode:case textLayerNode:continue}node.remove()}div.removeAttribute("data-loaded");if(annotationLayerNode){this.annotationLayer.hide()}if(annotationEditorLayerNode){this.annotationEditorLayer.hide()}if(xfaLayerNode){this.xfaLayer.hide()}if(textLayerNode){this.textLayer.hide()}(_this$structTreeLayer=this.structTreeLayer)===null||_this$structTreeLayer===void 0||_this$structTreeLayer.hide();if(!zoomLayerNode){if(this.canvas){_classPrivateFieldGet(this,_viewportMap)["delete"](this.canvas);this.canvas.width=0;this.canvas.height=0;delete this.canvas}this._resetZoomLayer()}}},{key:"update",value:function update(_ref129){var _this157=this;var _ref129$scale=_ref129.scale,scale=_ref129$scale===void 0?0:_ref129$scale,_ref129$rotation=_ref129.rotation,rotation=_ref129$rotation===void 0?null:_ref129$rotation,_ref129$optionalConte=_ref129.optionalContentConfigPromise,optionalContentConfigPromise=_ref129$optionalConte===void 0?null:_ref129$optionalConte,_ref129$drawingDelay=_ref129.drawingDelay,drawingDelay=_ref129$drawingDelay===void 0?-1:_ref129$drawingDelay;this.scale=scale||this.scale;if(typeof rotation==="number"){this.rotation=rotation}if(optionalContentConfigPromise instanceof Promise){this._optionalContentConfigPromise=optionalContentConfigPromise;optionalContentConfigPromise.then(function(optionalContentConfig){if(optionalContentConfigPromise!==_this157._optionalContentConfigPromise){return}_classPrivateFieldGet(_this157,_useThumbnailCanvas).initialOptionalContent=optionalContentConfig.hasInitialVisibility})}_classPrivateFieldGet(this,_useThumbnailCanvas).directDrawing=true;var totalRotation=(this.rotation+this.pdfPageRotate)%360;this.viewport=this.viewport.clone({scale:this.scale*_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:totalRotation});_classPrivateMethodGet(this,_setDimensions3,_setDimensions4).call(this);if(this._isStandalone){var _this$_container2;(_this$_container2=this._container)===null||_this$_container2===void 0||_this$_container2.style.setProperty("--scale-factor",this.viewport.scale)}if(this.canvas){var onlyCssZoom=false;if(_classPrivateFieldGet(this,_hasRestrictedScaling)){if(this.maxCanvasPixels===0){onlyCssZoom=true}else if(this.maxCanvasPixels>0){var _this$viewport2=this.viewport,width=_this$viewport2.width,height=_this$viewport2.height;var _this$outputScale=this.outputScale,sx=_this$outputScale.sx,sy=_this$outputScale.sy;onlyCssZoom=(Math.floor(width)*sx|0)*(Math.floor(height)*sy|0)>this.maxCanvasPixels}}var postponeDrawing=!onlyCssZoom&&drawingDelay>=0&&drawingDelay<1000;if(postponeDrawing||onlyCssZoom){if(postponeDrawing&&this.renderingState!==_ui_utils.RenderingStates.FINISHED){this.cancelRendering({keepZoomLayer:true,keepAnnotationLayer:true,keepAnnotationEditorLayer:true,keepXfaLayer:true,keepTextLayer:true,cancelExtraDelay:drawingDelay});this.renderingState=_ui_utils.RenderingStates.FINISHED;_classPrivateFieldGet(this,_useThumbnailCanvas).directDrawing=false}this.cssTransform({target:this.canvas,redrawAnnotationLayer:true,redrawAnnotationEditorLayer:true,redrawXfaLayer:true,redrawTextLayer:!postponeDrawing,hideTextLayer:postponeDrawing});if(postponeDrawing){return}this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:true,timestamp:performance.now(),error:_classPrivateFieldGet(this,_renderError)});return}if(!this.zoomLayer&&!this.canvas.hidden){this.zoomLayer=this.canvas.parentNode;this.zoomLayer.style.position="absolute"}}if(this.zoomLayer){this.cssTransform({target:this.zoomLayer.firstChild})}this.reset({keepZoomLayer:true,keepAnnotationLayer:true,keepAnnotationEditorLayer:true,keepXfaLayer:true,keepTextLayer:true})}},{key:"cancelRendering",value:function cancelRendering(){var _ref130=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref130$keepAnnotatio=_ref130.keepAnnotationLayer,keepAnnotationLayer=_ref130$keepAnnotatio===void 0?false:_ref130$keepAnnotatio,_ref130$keepAnnotatio2=_ref130.keepAnnotationEditorLayer,keepAnnotationEditorLayer=_ref130$keepAnnotatio2===void 0?false:_ref130$keepAnnotatio2,_ref130$keepXfaLayer=_ref130.keepXfaLayer,keepXfaLayer=_ref130$keepXfaLayer===void 0?false:_ref130$keepXfaLayer,_ref130$keepTextLayer=_ref130.keepTextLayer,keepTextLayer=_ref130$keepTextLayer===void 0?false:_ref130$keepTextLayer,_ref130$cancelExtraDe=_ref130.cancelExtraDelay,cancelExtraDelay=_ref130$cancelExtraDe===void 0?0:_ref130$cancelExtraDe;if(this.renderTask){this.renderTask.cancel(cancelExtraDelay);this.renderTask=null}this.resume=null;if(this.textLayer&&(!keepTextLayer||!this.textLayer.div)){this.textLayer.cancel();this.textLayer=null}if(this.structTreeLayer&&!this.textLayer){this.structTreeLayer=null}if(this.annotationLayer&&(!keepAnnotationLayer||!this.annotationLayer.div)){this.annotationLayer.cancel();this.annotationLayer=null;this._annotationCanvasMap=null}if(this.annotationEditorLayer&&(!keepAnnotationEditorLayer||!this.annotationEditorLayer.div)){this.annotationEditorLayer.cancel();this.annotationEditorLayer=null}if(this.xfaLayer&&(!keepXfaLayer||!this.xfaLayer.div)){var _this$_textHighlighte;this.xfaLayer.cancel();this.xfaLayer=null;(_this$_textHighlighte=this._textHighlighter)===null||_this$_textHighlighte===void 0||_this$_textHighlighte.disable()}}},{key:"cssTransform",value:function cssTransform(_ref131){var target=_ref131.target,_ref131$redrawAnnotat=_ref131.redrawAnnotationLayer,redrawAnnotationLayer=_ref131$redrawAnnotat===void 0?false:_ref131$redrawAnnotat,_ref131$redrawAnnotat2=_ref131.redrawAnnotationEditorLayer,redrawAnnotationEditorLayer=_ref131$redrawAnnotat2===void 0?false:_ref131$redrawAnnotat2,_ref131$redrawXfaLaye=_ref131.redrawXfaLayer,redrawXfaLayer=_ref131$redrawXfaLaye===void 0?false:_ref131$redrawXfaLaye,_ref131$redrawTextLay=_ref131.redrawTextLayer,redrawTextLayer=_ref131$redrawTextLay===void 0?false:_ref131$redrawTextLay,_ref131$hideTextLayer=_ref131.hideTextLayer,hideTextLayer=_ref131$hideTextLayer===void 0?false:_ref131$hideTextLayer;if(!target.hasAttribute("zooming")){target.setAttribute("zooming",true);var style=target.style;style.width=style.height=""}var originalViewport=_classPrivateFieldGet(this,_viewportMap).get(target);if(this.viewport!==originalViewport){var relativeRotation=this.viewport.rotation-originalViewport.rotation;var absRotation=Math.abs(relativeRotation);var scaleX=1,scaleY=1;if(absRotation===90||absRotation===270){var _this$viewport3=this.viewport,width=_this$viewport3.width,height=_this$viewport3.height;scaleX=height/width;scaleY=width/height}target.style.transform="rotate(".concat(relativeRotation,"deg) scale(").concat(scaleX,", ").concat(scaleY,")")}if(redrawAnnotationLayer&&this.annotationLayer){_classPrivateMethodGet(this,_renderAnnotationLayer,_renderAnnotationLayer2).call(this)}if(redrawAnnotationEditorLayer&&this.annotationEditorLayer){_classPrivateMethodGet(this,_renderAnnotationEditorLayer,_renderAnnotationEditorLayer2).call(this)}if(redrawXfaLayer&&this.xfaLayer){_classPrivateMethodGet(this,_renderXfaLayer,_renderXfaLayer2).call(this)}if(this.textLayer){if(hideTextLayer){var _this$structTreeLayer2;this.textLayer.hide();(_this$structTreeLayer2=this.structTreeLayer)===null||_this$structTreeLayer2===void 0||_this$structTreeLayer2.hide()}else if(redrawTextLayer){_classPrivateMethodGet(this,_renderTextLayer,_renderTextLayer2).call(this)}}}},{key:"width",get:function get(){return this.viewport.width}},{key:"height",get:function get(){return this.viewport.height}},{key:"getPagePoint",value:function getPagePoint(x,y){return this.viewport.convertToPdfPoint(x,y)}},{key:"draw",value:function(){var _draw3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee79(){var _this158=this;var div,l10n,pageColors,pdfPage,viewport,canvasWrapper,_classPrivateFieldGet45,annotationStorage,downloadManager,enableScripting,fieldObjectsPromise,hasJSActionsPromise,linkService,renderContinueCallback,width,height,canvas,hasHCM,_showCanvas2,ctx,outputScale,invScale,pixelsInViewport,maxScale,sfx,sfy,style,transform,renderContext,renderTask,resultPromise,_classPrivateFieldGet47,_annotationStorage2,_linkService2;return _regeneratorRuntime().wrap(function _callee79$(_context80){while(1)switch(_context80.prev=_context80.next){case 0:if(this.renderingState!==_ui_utils.RenderingStates.INITIAL){console.error("Must be in new state before drawing");this.reset()}div=this.div,l10n=this.l10n,pageColors=this.pageColors,pdfPage=this.pdfPage,viewport=this.viewport;if(pdfPage){_context80.next=5;break}this.renderingState=_ui_utils.RenderingStates.FINISHED;throw new Error("pdfPage is not loaded");case 5:this.renderingState=_ui_utils.RenderingStates.RUNNING;canvasWrapper=document.createElement("div");canvasWrapper.classList.add("canvasWrapper");div.append(canvasWrapper);if(!this.textLayer&&_classPrivateFieldGet(this,_textLayerMode)!==_ui_utils.TextLayerMode.DISABLE&&!pdfPage.isPureXfa){this._accessibilityManager||(this._accessibilityManager=new _text_accessibility.TextAccessibilityManager);this.textLayer=new _text_layer_builder.TextLayerBuilder({highlighter:this._textHighlighter,accessibilityManager:this._accessibilityManager,isOffscreenCanvasSupported:this.isOffscreenCanvasSupported,enablePermissions:_classPrivateFieldGet(this,_textLayerMode)===_ui_utils.TextLayerMode.ENABLE_PERMISSIONS});div.append(this.textLayer.div)}if(!this.annotationLayer&&_classPrivateFieldGet(this,_annotationMode)!==_pdfjsLib.AnnotationMode.DISABLE){_classPrivateFieldGet45=_classPrivateFieldGet(this,_layerProperties).call(this),annotationStorage=_classPrivateFieldGet45.annotationStorage,downloadManager=_classPrivateFieldGet45.downloadManager,enableScripting=_classPrivateFieldGet45.enableScripting,fieldObjectsPromise=_classPrivateFieldGet45.fieldObjectsPromise,hasJSActionsPromise=_classPrivateFieldGet45.hasJSActionsPromise,linkService=_classPrivateFieldGet45.linkService;this._annotationCanvasMap||(this._annotationCanvasMap=new Map);this.annotationLayer=new _annotation_layer_builder.AnnotationLayerBuilder({pageDiv:div,pdfPage:pdfPage,annotationStorage:annotationStorage,imageResourcesPath:this.imageResourcesPath,renderForms:_classPrivateFieldGet(this,_annotationMode)===_pdfjsLib.AnnotationMode.ENABLE_FORMS,linkService:linkService,downloadManager:downloadManager,l10n:l10n,enableScripting:enableScripting,hasJSActionsPromise:hasJSActionsPromise,fieldObjectsPromise:fieldObjectsPromise,annotationCanvasMap:this._annotationCanvasMap,accessibilityManager:this._accessibilityManager})}renderContinueCallback=function renderContinueCallback(cont){var _showCanvas;(_showCanvas=_showCanvas2)===null||_showCanvas===void 0||_showCanvas(false);if(_this158.renderingQueue&&!_this158.renderingQueue.isHighestPriority(_this158)){_this158.renderingState=_ui_utils.RenderingStates.PAUSED;_this158.resume=function(){_this158.renderingState=_ui_utils.RenderingStates.RUNNING;cont()};return}cont()};width=viewport.width,height=viewport.height;canvas=document.createElement("canvas");canvas.setAttribute("role","presentation");canvas.hidden=true;hasHCM=!!(pageColors!==null&&pageColors!==void 0&&pageColors.background&&pageColors!==null&&pageColors!==void 0&&pageColors.foreground);_showCanvas2=function showCanvas(isLastShow){if(!hasHCM||isLastShow){canvas.hidden=false;_showCanvas2=null}};canvasWrapper.append(canvas);this.canvas=canvas;ctx=canvas.getContext("2d",{alpha:false});outputScale=this.outputScale=new _ui_utils.OutputScale;if(this.maxCanvasPixels===0){invScale=1/this.scale;outputScale.sx*=invScale;outputScale.sy*=invScale;_classPrivateFieldSet(this,_hasRestrictedScaling,true)}else if(this.maxCanvasPixels>0){pixelsInViewport=width*height;maxScale=Math.sqrt(this.maxCanvasPixels/pixelsInViewport);if(outputScale.sx>maxScale||outputScale.sy>maxScale){outputScale.sx=maxScale;outputScale.sy=maxScale;_classPrivateFieldSet(this,_hasRestrictedScaling,true)}else{_classPrivateFieldSet(this,_hasRestrictedScaling,false)}}sfx=(0,_ui_utils.approximateFraction)(outputScale.sx);sfy=(0,_ui_utils.approximateFraction)(outputScale.sy);canvas.width=(0,_ui_utils.roundToDivide)(width*outputScale.sx,sfx[0]);canvas.height=(0,_ui_utils.roundToDivide)(height*outputScale.sy,sfy[0]);style=canvas.style;style.width=(0,_ui_utils.roundToDivide)(width,sfx[1])+"px";style.height=(0,_ui_utils.roundToDivide)(height,sfy[1])+"px";_classPrivateFieldGet(this,_viewportMap).set(canvas,viewport);transform=outputScale.scaled?[outputScale.sx,0,0,outputScale.sy,0,0]:null;renderContext={canvasContext:ctx,transform:transform,viewport:viewport,annotationMode:_classPrivateFieldGet(this,_annotationMode),optionalContentConfigPromise:this._optionalContentConfigPromise,annotationCanvasMap:this._annotationCanvasMap,pageColors:pageColors};renderTask=this.renderTask=this.pdfPage.render(renderContext);renderTask.onContinue=renderContinueCallback;resultPromise=renderTask.promise.then(_asyncToGenerator(_regeneratorRuntime().mark(function _callee78(){var _showCanvas3;var _this158$annotationLa,_classPrivateFieldGet46,annotationEditorUIManager;return _regeneratorRuntime().wrap(function _callee78$(_context79){while(1)switch(_context79.prev=_context79.next){case 0:(_showCanvas3=_showCanvas2)===null||_showCanvas3===void 0||_showCanvas3(true);_context79.next=3;return _classPrivateMethodGet(_this158,_finishRenderTask,_finishRenderTask2).call(_this158,renderTask);case 3:_classPrivateMethodGet(_this158,_renderTextLayer,_renderTextLayer2).call(_this158);if(!_this158.annotationLayer){_context79.next=7;break}_context79.next=7;return _classPrivateMethodGet(_this158,_renderAnnotationLayer,_renderAnnotationLayer2).call(_this158);case 7:if(_this158.annotationEditorLayer){_context79.next=12;break}_classPrivateFieldGet46=_classPrivateFieldGet(_this158,_layerProperties).call(_this158),annotationEditorUIManager=_classPrivateFieldGet46.annotationEditorUIManager;if(annotationEditorUIManager){_context79.next=11;break}return _context79.abrupt("return");case 11:_this158.annotationEditorLayer=new _annotation_editor_layer_builder.AnnotationEditorLayerBuilder({uiManager:annotationEditorUIManager,pageDiv:div,pdfPage:pdfPage,l10n:l10n,accessibilityManager:_this158._accessibilityManager,annotationLayer:(_this158$annotationLa=_this158.annotationLayer)===null||_this158$annotationLa===void 0?void 0:_this158$annotationLa.annotationLayer});case 12:_classPrivateMethodGet(_this158,_renderAnnotationEditorLayer,_renderAnnotationEditorLayer2).call(_this158);case 13:case"end":return _context79.stop()}},_callee78)})),function(error){if(!(error instanceof _pdfjsLib.RenderingCancelledException)){var _showCanvas4;(_showCanvas4=_showCanvas2)===null||_showCanvas4===void 0||_showCanvas4(true)}return _classPrivateMethodGet(_this158,_finishRenderTask,_finishRenderTask2).call(_this158,renderTask,error)});if(pdfPage.isPureXfa){if(!this.xfaLayer){_classPrivateFieldGet47=_classPrivateFieldGet(this,_layerProperties).call(this),_annotationStorage2=_classPrivateFieldGet47.annotationStorage,_linkService2=_classPrivateFieldGet47.linkService;this.xfaLayer=new _xfa_layer_builder.XfaLayerBuilder({pageDiv:div,pdfPage:pdfPage,annotationStorage:_annotationStorage2,linkService:_linkService2})}else if(this.xfaLayer.div){div.append(this.xfaLayer.div)}_classPrivateMethodGet(this,_renderXfaLayer,_renderXfaLayer2).call(this)}div.setAttribute("data-loaded",true);this.eventBus.dispatch("pagerender",{source:this,pageNumber:this.id});return _context80.abrupt("return",resultPromise);case 40:case"end":return _context80.stop()}},_callee79,this)}));function draw(){return _draw3.apply(this,arguments)}return draw}()},{key:"setPageLabel",value:function setPageLabel(label){this.pageLabel=typeof label==="string"?label:null;if(this.pageLabel!==null){this.div.setAttribute("data-page-label",this.pageLabel)}else{this.div.removeAttribute("data-page-label")}}},{key:"thumbnailCanvas",get:function get(){var _classPrivateFieldGet48=_classPrivateFieldGet(this,_useThumbnailCanvas),directDrawing=_classPrivateFieldGet48.directDrawing,initialOptionalContent=_classPrivateFieldGet48.initialOptionalContent,regularAnnotations=_classPrivateFieldGet48.regularAnnotations;return directDrawing&&initialOptionalContent&&regularAnnotations?this.canvas:null}}]);return PDFPageView}();function _setDimensions4(){var viewport=this.viewport;if(this.pdfPage){if(_classPrivateFieldGet(this,_previousRotation)===viewport.rotation){return}_classPrivateFieldSet(this,_previousRotation,viewport.rotation)}(0,_pdfjsLib.setLayerDimensions)(this.div,viewport,true,false)}function _renderAnnotationLayer2(){return _renderAnnotationLayer3.apply(this,arguments)}function _renderAnnotationLayer3(){_renderAnnotationLayer3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee80(){var error;return _regeneratorRuntime().wrap(function _callee80$(_context81){while(1)switch(_context81.prev=_context81.next){case 0:error=null;_context81.prev=1;_context81.next=4;return this.annotationLayer.render(this.viewport,"display");case 4:_context81.next=10;break;case 6:_context81.prev=6;_context81.t0=_context81["catch"](1);console.error("#renderAnnotationLayer: \"".concat(_context81.t0,"\"."));error=_context81.t0;case 10:_context81.prev=10;this.eventBus.dispatch("annotationlayerrendered",{source:this,pageNumber:this.id,error:error});return _context81.finish(10);case 13:case"end":return _context81.stop()}},_callee80,this,[[1,6,10,13]])}));return _renderAnnotationLayer3.apply(this,arguments)}function _renderAnnotationEditorLayer2(){return _renderAnnotationEditorLayer3.apply(this,arguments)}function _renderAnnotationEditorLayer3(){_renderAnnotationEditorLayer3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee81(){var error;return _regeneratorRuntime().wrap(function _callee81$(_context82){while(1)switch(_context82.prev=_context82.next){case 0:error=null;_context82.prev=1;_context82.next=4;return this.annotationEditorLayer.render(this.viewport,"display");case 4:_context82.next=10;break;case 6:_context82.prev=6;_context82.t0=_context82["catch"](1);console.error("#renderAnnotationEditorLayer: \"".concat(_context82.t0,"\"."));error=_context82.t0;case 10:_context82.prev=10;this.eventBus.dispatch("annotationeditorlayerrendered",{source:this,pageNumber:this.id,error:error});return _context82.finish(10);case 13:case"end":return _context82.stop()}},_callee81,this,[[1,6,10,13]])}));return _renderAnnotationEditorLayer3.apply(this,arguments)}function _renderXfaLayer2(){return _renderXfaLayer3.apply(this,arguments)}function _renderXfaLayer3(){_renderXfaLayer3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee82(){var error,result;return _regeneratorRuntime().wrap(function _callee82$(_context83){while(1)switch(_context83.prev=_context83.next){case 0:error=null;_context83.prev=1;_context83.next=4;return this.xfaLayer.render(this.viewport,"display");case 4:result=_context83.sent;if(result!==null&&result!==void 0&&result.textDivs&&this._textHighlighter){_classPrivateMethodGet(this,_buildXfaTextContentItems,_buildXfaTextContentItems2).call(this,result.textDivs)}_context83.next=12;break;case 8:_context83.prev=8;_context83.t0=_context83["catch"](1);console.error("#renderXfaLayer: \"".concat(_context83.t0,"\"."));error=_context83.t0;case 12:_context83.prev=12;this.eventBus.dispatch("xfalayerrendered",{source:this,pageNumber:this.id,error:error});return _context83.finish(12);case 15:case"end":return _context83.stop()}},_callee82,this,[[1,8,12,15]])}));return _renderXfaLayer3.apply(this,arguments)}function _renderTextLayer2(){return _renderTextLayer3.apply(this,arguments)}function _renderTextLayer3(){_renderTextLayer3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee83(){var pdfPage,textLayer,viewport,error,readableStream;return _regeneratorRuntime().wrap(function _callee83$(_context84){while(1)switch(_context84.prev=_context84.next){case 0:pdfPage=this.pdfPage,textLayer=this.textLayer,viewport=this.viewport;if(textLayer){_context84.next=3;break}return _context84.abrupt("return");case 3:error=null;_context84.prev=4;if(!textLayer.renderingDone){readableStream=pdfPage.streamTextContent({includeMarkedContent:true,disableNormalization:true});textLayer.setTextContentSource(readableStream)}_context84.next=8;return textLayer.render(viewport);case 8:_context84.next=16;break;case 10:_context84.prev=10;_context84.t0=_context84["catch"](4);if(!(_context84.t0 instanceof _pdfjsLib.AbortException)){_context84.next=14;break}return _context84.abrupt("return");case 14:console.error("#renderTextLayer: \"".concat(_context84.t0,"\"."));error=_context84.t0;case 16:this.eventBus.dispatch("textlayerrendered",{source:this,pageNumber:this.id,numTextDivs:textLayer.numTextDivs,error:error});_classPrivateMethodGet(this,_renderStructTreeLayer,_renderStructTreeLayer2).call(this);case 18:case"end":return _context84.stop()}},_callee83,this,[[4,10]])}));return _renderTextLayer3.apply(this,arguments)}function _renderStructTreeLayer2(){return _renderStructTreeLayer3.apply(this,arguments)}function _renderStructTreeLayer3(){_renderStructTreeLayer3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee84(){var _this$structTreeLayer3,_this$structTreeLayer4;var tree,treeDom,_this$canvas;return _regeneratorRuntime().wrap(function _callee84$(_context85){while(1)switch(_context85.prev=_context85.next){case 0:if(this.textLayer){_context85.next=2;break}return _context85.abrupt("return");case 2:this.structTreeLayer||(this.structTreeLayer=new _struct_tree_layer_builder.StructTreeLayerBuilder);_context85.next=5;return!this.structTreeLayer.renderingDone?this.pdfPage.getStructTree():null;case 5:tree=_context85.sent;treeDom=(_this$structTreeLayer3=this.structTreeLayer)===null||_this$structTreeLayer3===void 0?void 0:_this$structTreeLayer3.render(tree);if(treeDom){(_this$canvas=this.canvas)===null||_this$canvas===void 0||_this$canvas.append(treeDom)}(_this$structTreeLayer4=this.structTreeLayer)===null||_this$structTreeLayer4===void 0||_this$structTreeLayer4.show();case 9:case"end":return _context85.stop()}},_callee84,this)}));return _renderStructTreeLayer3.apply(this,arguments)}function _buildXfaTextContentItems2(_x71){return _buildXfaTextContentItems3.apply(this,arguments)}function _buildXfaTextContentItems3(){_buildXfaTextContentItems3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee85(textDivs){var text,items,_iterator170,_step170,item;return _regeneratorRuntime().wrap(function _callee85$(_context86){while(1)switch(_context86.prev=_context86.next){case 0:_context86.next=2;return this.pdfPage.getTextContent();case 2:text=_context86.sent;items=[];_iterator170=_createForOfIteratorHelper(text.items);try{for(_iterator170.s();!(_step170=_iterator170.n()).done;){item=_step170.value;items.push(item.str)}}catch(err){_iterator170.e(err)}finally{_iterator170.f()}this._textHighlighter.setTextMapping(textDivs,items);this._textHighlighter.enable();case 8:case"end":return _context86.stop()}},_callee85,this)}));return _buildXfaTextContentItems3.apply(this,arguments)}function _finishRenderTask2(_x72){return _finishRenderTask3.apply(this,arguments)}function _finishRenderTask3(){_finishRenderTask3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee86(renderTask){var error,_args87=arguments;return _regeneratorRuntime().wrap(function _callee86$(_context87){while(1)switch(_context87.prev=_context87.next){case 0:error=_args87.length>1&&_args87[1]!==undefined?_args87[1]:null;if(renderTask===this.renderTask){this.renderTask=null}if(!(error instanceof _pdfjsLib.RenderingCancelledException)){_context87.next=5;break}_classPrivateFieldSet(this,_renderError,null);return _context87.abrupt("return");case 5:_classPrivateFieldSet(this,_renderError,error);this.renderingState=_ui_utils.RenderingStates.FINISHED;this._resetZoomLayer(true);_classPrivateFieldGet(this,_useThumbnailCanvas).regularAnnotations=!renderTask.separateAnnots;this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:false,timestamp:performance.now(),error:_classPrivateFieldGet(this,_renderError)});if(!error){_context87.next=12;break}throw error;case 12:case"end":return _context87.stop()}},_callee86,this)}));return _finishRenderTask3.apply(this,arguments)}exports.PDFPageView=PDFPageView}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.AnnotationEditorLayerBuilder=void 0;var _pdfjsLib=__w_pdfjs_require__(4);var _l10n_utils=__w_pdfjs_require__(7);var _annotationLayer2=new WeakMap;var _uiManager2=new WeakMap;var AnnotationEditorLayerBuilder=function(){function AnnotationEditorLayerBuilder(options){_classCallCheck2(this,AnnotationEditorLayerBuilder);_classPrivateFieldInitSpec(this,_annotationLayer2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_uiManager2,{writable:true,value:void 0});this.pageDiv=options.pageDiv;this.pdfPage=options.pdfPage;this.accessibilityManager=options.accessibilityManager;this.l10n=options.l10n||_l10n_utils.NullL10n;this.annotationEditorLayer=null;this.div=null;this._cancelled=false;_classPrivateFieldSet(this,_uiManager2,options.uiManager);_classPrivateFieldSet(this,_annotationLayer2,options.annotationLayer||null)}_createClass2(AnnotationEditorLayerBuilder,[{key:"render",value:function(){var _render4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee87(viewport){var intent,clonedViewport,div,parameters,_args88=arguments;return _regeneratorRuntime().wrap(function _callee87$(_context88){while(1)switch(_context88.prev=_context88.next){case 0:intent=_args88.length>1&&_args88[1]!==undefined?_args88[1]:"display";if(!(intent!=="display")){_context88.next=3;break}return _context88.abrupt("return");case 3:if(!this._cancelled){_context88.next=5;break}return _context88.abrupt("return");case 5:clonedViewport=viewport.clone({dontFlip:true});if(!this.div){_context88.next=10;break}this.annotationEditorLayer.update({viewport:clonedViewport});this.show();return _context88.abrupt("return");case 10:div=this.div=document.createElement("div");div.className="annotationEditorLayer";div.tabIndex=0;div.hidden=true;div.dir=_classPrivateFieldGet(this,_uiManager2).direction;this.pageDiv.append(div);this.annotationEditorLayer=new _pdfjsLib.AnnotationEditorLayer({uiManager:_classPrivateFieldGet(this,_uiManager2),div:div,accessibilityManager:this.accessibilityManager,pageIndex:this.pdfPage.pageNumber-1,l10n:this.l10n,viewport:clonedViewport,annotationLayer:_classPrivateFieldGet(this,_annotationLayer2)});parameters={viewport:clonedViewport,div:div,annotations:null,intent:intent};this.annotationEditorLayer.render(parameters);this.show();case 20:case"end":return _context88.stop()}},_callee87,this)}));function render(_x73){return _render4.apply(this,arguments)}return render}()},{key:"cancel",value:function cancel(){this._cancelled=true;if(!this.div){return}this.pageDiv=null;this.annotationEditorLayer.destroy();this.div.remove()}},{key:"hide",value:function hide(){if(!this.div){return}this.div.hidden=true}},{key:"show",value:function show(){if(!this.div||this.annotationEditorLayer.isEmpty){return}this.div.hidden=false}}]);return AnnotationEditorLayerBuilder}();exports.AnnotationEditorLayerBuilder=AnnotationEditorLayerBuilder}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.compatibilityParams=exports.OptionKind=exports.AppOptions=void 0;var compatibilityParams=Object.create(null);exports.compatibilityParams=compatibilityParams;{var userAgent=navigator.userAgent||"";var platform=navigator.platform||"";var maxTouchPoints=navigator.maxTouchPoints||1;var isAndroid=/Android/.test(userAgent);var isIOS=/\b(iPad|iPhone|iPod)(?=;)/.test(userAgent)||platform==="MacIntel"&&maxTouchPoints>1;(function checkCanvasSizeLimitation(){if(isIOS||isAndroid){compatibilityParams.maxCanvasPixels=5242880}})()}var OptionKind={VIEWER:2,API:4,WORKER:8,PREFERENCE:128};exports.OptionKind=OptionKind;var defaultOptions={annotationEditorMode:{value:0,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},annotationMode:{value:2,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},cursorToolOnLoad:{value:0,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},defaultZoomDelay:{value:400,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},defaultZoomValue:{value:"",kind:OptionKind.VIEWER+OptionKind.PREFERENCE},disableHistory:{value:false,kind:OptionKind.VIEWER},disablePageLabels:{value:false,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},enablePermissions:{value:false,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},enablePrintAutoRotate:{value:true,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},enableScripting:{value:true,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},enableStampEditor:{value:true,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},externalLinkRel:{value:"noopener noreferrer nofollow",kind:OptionKind.VIEWER},externalLinkTarget:{value:0,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},historyUpdateUrl:{value:false,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},ignoreDestinationZoom:{value:false,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},imageResourcesPath:{value:"./images/",kind:OptionKind.VIEWER},maxCanvasPixels:{value:16777216,kind:OptionKind.VIEWER},forcePageColors:{value:false,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},pageColorsBackground:{value:"Canvas",kind:OptionKind.VIEWER+OptionKind.PREFERENCE},pageColorsForeground:{value:"CanvasText",kind:OptionKind.VIEWER+OptionKind.PREFERENCE},pdfBugEnabled:{value:false,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},printResolution:{value:150,kind:OptionKind.VIEWER},sidebarViewOnLoad:{value:-1,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},scrollModeOnLoad:{value:-1,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},spreadModeOnLoad:{value:-1,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},textLayerMode:{value:1,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},viewerCssTheme:{value:0,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},viewOnLoad:{value:0,kind:OptionKind.VIEWER+OptionKind.PREFERENCE},cMapPacked:{value:true,kind:OptionKind.API},cMapUrl:{value:"../web/cmaps/",kind:OptionKind.API},disableAutoFetch:{value:false,kind:OptionKind.API+OptionKind.PREFERENCE},disableFontFace:{value:false,kind:OptionKind.API+OptionKind.PREFERENCE},disableRange:{value:false,kind:OptionKind.API+OptionKind.PREFERENCE},disableStream:{value:false,kind:OptionKind.API+OptionKind.PREFERENCE},docBaseUrl:{value:"",kind:OptionKind.API},enableXfa:{value:true,kind:OptionKind.API+OptionKind.PREFERENCE},fontExtraProperties:{value:false,kind:OptionKind.API},isEvalSupported:{value:true,kind:OptionKind.API},isOffscreenCanvasSupported:{value:true,kind:OptionKind.API},maxImageSize:{value:-1,kind:OptionKind.API},pdfBug:{value:false,kind:OptionKind.API},standardFontDataUrl:{value:"../web/standard_fonts/",kind:OptionKind.API},verbosity:{value:1,kind:OptionKind.API},workerPort:{value:null,kind:OptionKind.WORKER},workerSrc:{value:"../build/pdf.worker.js",kind:OptionKind.WORKER}};{defaultOptions.defaultUrl={value:"compressed.tracemonkey-pldi-09.pdf",kind:OptionKind.VIEWER};defaultOptions.disablePreferences={value:false,kind:OptionKind.VIEWER};defaultOptions.locale={value:navigator.language||"en-US",kind:OptionKind.VIEWER};defaultOptions.sandboxBundleSrc={value:"../build/pdf.sandbox.js",kind:OptionKind.VIEWER}}var userOptions=Object.create(null);var AppOptions=function(){function AppOptions(){_classCallCheck2(this,AppOptions);throw new Error("Cannot initialize AppOptions.")}_createClass2(AppOptions,null,[{key:"get",value:function get(name){var userOption=userOptions[name];if(userOption!==undefined){return userOption}var defaultOption=defaultOptions[name];if(defaultOption!==undefined){var _compatibilityParams$;return(_compatibilityParams$=compatibilityParams[name])!==null&&_compatibilityParams$!==void 0?_compatibilityParams$:defaultOption.value}return undefined}},{key:"getAll",value:function getAll(){var kind=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var options=Object.create(null);for(var _name14 in defaultOptions){var _compatibilityParams$2;var defaultOption=defaultOptions[_name14];if(kind){if((kind&defaultOption.kind)===0){continue}if(kind===OptionKind.PREFERENCE){var value=defaultOption.value,valueType=_typeof2(value);if(valueType==="boolean"||valueType==="string"||valueType==="number"&&Number.isInteger(value)){options[_name14]=value;continue}throw new Error("Invalid type for preference: ".concat(_name14))}}var userOption=userOptions[_name14];options[_name14]=userOption!==undefined?userOption:(_compatibilityParams$2=compatibilityParams[_name14])!==null&&_compatibilityParams$2!==void 0?_compatibilityParams$2:defaultOption.value}return options}},{key:"set",value:function set(name,value){userOptions[name]=value}},{key:"setAll",value:function setAll(options){for(var _name15 in options){userOptions[_name15]=options[_name15]}}},{key:"remove",value:function remove(name){delete userOptions[name]}}]);return AppOptions}();exports.AppOptions=AppOptions;{AppOptions._hasUserOptions=function(){return Object.keys(userOptions).length>0}}}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.StructTreeLayerBuilder=void 0;var _ui_utils=__w_pdfjs_require__(2);var PDF_ROLE_TO_HTML_ROLE={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null};var HEADING_PATTERN=/^H(\d+)$/;var _treeDom=new WeakMap;var _setAttributes=new WeakSet;var _walk=new WeakSet;var StructTreeLayerBuilder=function(){function StructTreeLayerBuilder(){_classCallCheck2(this,StructTreeLayerBuilder);_classPrivateMethodInitSpec(this,_walk);_classPrivateMethodInitSpec(this,_setAttributes);_classPrivateFieldInitSpec(this,_treeDom,{writable:true,value:undefined})}_createClass2(StructTreeLayerBuilder,[{key:"renderingDone",get:function get(){return _classPrivateFieldGet(this,_treeDom)!==undefined}},{key:"render",value:function render(structTree){if(_classPrivateFieldGet(this,_treeDom)!==undefined){return _classPrivateFieldGet(this,_treeDom)}var treeDom=_classPrivateMethodGet(this,_walk,_walk2).call(this,structTree);treeDom===null||treeDom===void 0||treeDom.classList.add("structTree");return _classPrivateFieldSet(this,_treeDom,treeDom)}},{key:"hide",value:function hide(){if(_classPrivateFieldGet(this,_treeDom)&&!_classPrivateFieldGet(this,_treeDom).hidden){_classPrivateFieldGet(this,_treeDom).hidden=true}}},{key:"show",value:function show(){var _classPrivateFieldGet49;if((_classPrivateFieldGet49=_classPrivateFieldGet(this,_treeDom))!==null&&_classPrivateFieldGet49!==void 0&&_classPrivateFieldGet49.hidden){_classPrivateFieldGet(this,_treeDom).hidden=false}}}]);return StructTreeLayerBuilder}();function _setAttributes2(structElement,htmlElement){var alt=structElement.alt,id=structElement.id,lang=structElement.lang;if(alt!==undefined){htmlElement.setAttribute("aria-label",(0,_ui_utils.removeNullCharacters)(alt))}if(id!==undefined){htmlElement.setAttribute("aria-owns",id)}if(lang!==undefined){htmlElement.setAttribute("lang",(0,_ui_utils.removeNullCharacters)(lang,true))}}function _walk2(node){if(!node){return null}var element=document.createElement("span");if("role"in node){var role=node.role;var match=role.match(HEADING_PATTERN);if(match){element.setAttribute("role","heading");element.setAttribute("aria-level",match[1])}else if(PDF_ROLE_TO_HTML_ROLE[role]){element.setAttribute("role",PDF_ROLE_TO_HTML_ROLE[role])}}_classPrivateMethodGet(this,_setAttributes,_setAttributes2).call(this,node,element);if(node.children){if(node.children.length===1&&"id"in node.children[0]){_classPrivateMethodGet(this,_setAttributes,_setAttributes2).call(this,node.children[0],element)}else{var _iterator171=_createForOfIteratorHelper(node.children),_step171;try{for(_iterator171.s();!(_step171=_iterator171.n()).done;){var kid=_step171.value;element.append(_classPrivateMethodGet(this,_walk,_walk2).call(this,kid))}}catch(err){_iterator171.e(err)}finally{_iterator171.f()}}}return element}exports.StructTreeLayerBuilder=StructTreeLayerBuilder}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.TextAccessibilityManager=void 0;var _ui_utils=__w_pdfjs_require__(2);var _enabled=new WeakMap;var _textChildren=new WeakMap;var _textNodes=new WeakMap;var _waitingElements=new WeakMap;var _addIdToAriaOwns=new WeakSet;var TextAccessibilityManager=function(){function TextAccessibilityManager(){_classCallCheck2(this,TextAccessibilityManager);_classPrivateMethodInitSpec(this,_addIdToAriaOwns);_classPrivateFieldInitSpec(this,_enabled,{writable:true,value:false});_classPrivateFieldInitSpec(this,_textChildren,{writable:true,value:null});_classPrivateFieldInitSpec(this,_textNodes,{writable:true,value:new Map});_classPrivateFieldInitSpec(this,_waitingElements,{writable:true,value:new Map})}_createClass2(TextAccessibilityManager,[{key:"setTextMapping",value:function setTextMapping(textDivs){_classPrivateFieldSet(this,_textChildren,textDivs)}},{key:"enable",value:function enable(){if(_classPrivateFieldGet(this,_enabled)){throw new Error("TextAccessibilityManager is already enabled.")}if(!_classPrivateFieldGet(this,_textChildren)){throw new Error("Text divs and strings have not been set.")}_classPrivateFieldSet(this,_enabled,true);_classPrivateFieldSet(this,_textChildren,_classPrivateFieldGet(this,_textChildren).slice());_classPrivateFieldGet(this,_textChildren).sort(_classStaticPrivateMethodGet(TextAccessibilityManager,TextAccessibilityManager,_compareElementPositions));if(_classPrivateFieldGet(this,_textNodes).size>0){var textChildren=_classPrivateFieldGet(this,_textChildren);var _iterator172=_createForOfIteratorHelper(_classPrivateFieldGet(this,_textNodes)),_step172;try{for(_iterator172.s();!(_step172=_iterator172.n()).done;){var _step172$value=_slicedToArray2(_step172.value,2),_id18=_step172$value[0],nodeIndex=_step172$value[1];var element=document.getElementById(_id18);if(!element){_classPrivateFieldGet(this,_textNodes)["delete"](_id18);continue}_classPrivateMethodGet(this,_addIdToAriaOwns,_addIdToAriaOwns2).call(this,_id18,textChildren[nodeIndex])}}catch(err){_iterator172.e(err)}finally{_iterator172.f()}}var _iterator173=_createForOfIteratorHelper(_classPrivateFieldGet(this,_waitingElements)),_step173;try{for(_iterator173.s();!(_step173=_iterator173.n()).done;){var _step173$value=_slicedToArray2(_step173.value,2),_element2=_step173$value[0],isRemovable=_step173$value[1];this.addPointerInTextLayer(_element2,isRemovable)}}catch(err){_iterator173.e(err)}finally{_iterator173.f()}_classPrivateFieldGet(this,_waitingElements).clear()}},{key:"disable",value:function disable(){if(!_classPrivateFieldGet(this,_enabled)){return}_classPrivateFieldGet(this,_waitingElements).clear();_classPrivateFieldSet(this,_textChildren,null);_classPrivateFieldSet(this,_enabled,false)}},{key:"removePointerInTextLayer",value:function removePointerInTextLayer(element){var _owns;if(!_classPrivateFieldGet(this,_enabled)){_classPrivateFieldGet(this,_waitingElements)["delete"](element);return}var children=_classPrivateFieldGet(this,_textChildren);if(!children||children.length===0){return}var id=element.id;var nodeIndex=_classPrivateFieldGet(this,_textNodes).get(id);if(nodeIndex===undefined){return}var node=children[nodeIndex];_classPrivateFieldGet(this,_textNodes)["delete"](id);var owns=node.getAttribute("aria-owns");if((_owns=owns)!==null&&_owns!==void 0&&_owns.includes(id)){owns=owns.split(" ").filter(function(x){return x!==id}).join(" ");if(owns){node.setAttribute("aria-owns",owns)}else{node.removeAttribute("aria-owns");node.setAttribute("role","presentation")}}}},{key:"addPointerInTextLayer",value:function addPointerInTextLayer(element,isRemovable){var id=element.id;if(!id){return null}if(!_classPrivateFieldGet(this,_enabled)){_classPrivateFieldGet(this,_waitingElements).set(element,isRemovable);return null}if(isRemovable){this.removePointerInTextLayer(element)}var children=_classPrivateFieldGet(this,_textChildren);if(!children||children.length===0){return null}var index=(0,_ui_utils.binarySearchFirstItem)(children,function(node){return _classStaticPrivateMethodGet(TextAccessibilityManager,TextAccessibilityManager,_compareElementPositions).call(TextAccessibilityManager,element,node)<0});var nodeIndex=Math.max(0,index-1);var child=children[nodeIndex];_classPrivateMethodGet(this,_addIdToAriaOwns,_addIdToAriaOwns2).call(this,id,child);_classPrivateFieldGet(this,_textNodes).set(id,nodeIndex);var parent=child.parentNode;return parent!==null&&parent!==void 0&&parent.classList.contains("markedContent")?parent.id:null}},{key:"moveElementInDOM",value:function moveElementInDOM(container,element,contentElement,isRemovable){var id=this.addPointerInTextLayer(contentElement,isRemovable);if(!container.hasChildNodes()){container.append(element);return id}var children=Array.from(container.childNodes).filter(function(node){return node!==element});if(children.length===0){return id}var elementToCompare=contentElement||element;var index=(0,_ui_utils.binarySearchFirstItem)(children,function(node){return _classStaticPrivateMethodGet(TextAccessibilityManager,TextAccessibilityManager,_compareElementPositions).call(TextAccessibilityManager,elementToCompare,node)<0});if(index===0){children[0].before(element)}else{children[index-1].after(element)}return id}}]);return TextAccessibilityManager}();function _compareElementPositions(e1,e2){var rect1=e1.getBoundingClientRect();var rect2=e2.getBoundingClientRect();if(rect1.width===0&&rect1.height===0){return+1}if(rect2.width===0&&rect2.height===0){return-1}var top1=rect1.y;var bot1=rect1.y+rect1.height;var mid1=rect1.y+rect1.height/2;var top2=rect2.y;var bot2=rect2.y+rect2.height;var mid2=rect2.y+rect2.height/2;if(mid1<=top2&&mid2>=bot1){return-1}if(mid2<=top1&&mid1>=bot2){return+1}var centerX1=rect1.x+rect1.width/2;var centerX2=rect2.x+rect2.width/2;return centerX1-centerX2}function _addIdToAriaOwns2(id,node){var owns=node.getAttribute("aria-owns");if(!(owns!==null&&owns!==void 0&&owns.includes(id))){node.setAttribute("aria-owns",owns?"".concat(owns," ").concat(id):id)}node.removeAttribute("role")}exports.TextAccessibilityManager=TextAccessibilityManager}),(function(__unused_webpack_module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.TextHighlighter=void 0;var TextHighlighter=function(){function TextHighlighter(_ref133){var findController=_ref133.findController,eventBus=_ref133.eventBus,pageIndex=_ref133.pageIndex;_classCallCheck2(this,TextHighlighter);this.findController=findController;this.matches=[];this.eventBus=eventBus;this.pageIdx=pageIndex;this._onUpdateTextLayerMatches=null;this.textDivs=null;this.textContentItemsStr=null;this.enabled=false}_createClass2(TextHighlighter,[{key:"setTextMapping",value:function setTextMapping(divs,texts){this.textDivs=divs;this.textContentItemsStr=texts}},{key:"enable",value:function enable(){var _this159=this;if(!this.textDivs||!this.textContentItemsStr){throw new Error("Text divs and strings have not been set.")}if(this.enabled){throw new Error("TextHighlighter is already enabled.")}this.enabled=true;if(!this._onUpdateTextLayerMatches){this._onUpdateTextLayerMatches=function(evt){if(evt.pageIndex===_this159.pageIdx||evt.pageIndex===-1){_this159._updateMatches()}};this.eventBus._on("updatetextlayermatches",this._onUpdateTextLayerMatches)}this._updateMatches()}},{key:"disable",value:function disable(){if(!this.enabled){return}this.enabled=false;if(this._onUpdateTextLayerMatches){this.eventBus._off("updatetextlayermatches",this._onUpdateTextLayerMatches);this._onUpdateTextLayerMatches=null}this._updateMatches(true)}},{key:"_convertMatches",value:function _convertMatches(matches,matchesLength){if(!matches){return[]}var textContentItemsStr=this.textContentItemsStr;var i=0,iIndex=0;var end=textContentItemsStr.length-1;var result=[];for(var m=0,mm=matches.length;m<mm;m++){var matchIdx=matches[m];while(i!==end&&matchIdx>=iIndex+textContentItemsStr[i].length){iIndex+=textContentItemsStr[i].length;i++}if(i===textContentItemsStr.length){console.error("Could not find a matching mapping")}var match={begin:{divIdx:i,offset:matchIdx-iIndex}};matchIdx+=matchesLength[m];while(i!==end&&matchIdx>iIndex+textContentItemsStr[i].length){iIndex+=textContentItemsStr[i].length;i++}match.end={divIdx:i,offset:matchIdx-iIndex};result.push(match)}return result}},{key:"_renderMatches",value:function _renderMatches(matches){if(matches.length===0){return}var findController=this.findController,pageIdx=this.pageIdx;var textContentItemsStr=this.textContentItemsStr,textDivs=this.textDivs;var isSelectedPage=pageIdx===findController.selected.pageIdx;var selectedMatchIdx=findController.selected.matchIdx;var highlightAll=findController.state.highlightAll;var prevEnd=null;var infinity={divIdx:-1,offset:undefined};function beginText(begin,className){var divIdx=begin.divIdx;textDivs[divIdx].textContent="";return appendTextToDiv(divIdx,0,begin.offset,className)}function appendTextToDiv(divIdx,fromOffset,toOffset,className){var div=textDivs[divIdx];if(div.nodeType===Node.TEXT_NODE){var span=document.createElement("span");div.before(span);span.append(div);textDivs[divIdx]=span;div=span}var content=textContentItemsStr[divIdx].substring(fromOffset,toOffset);var node=document.createTextNode(content);if(className){var _span=document.createElement("span");_span.className="".concat(className," appended");_span.append(node);div.append(_span);return className.includes("selected")?_span.offsetLeft:0}div.append(node);return 0}var i0=selectedMatchIdx,i1=i0+1;if(highlightAll){i0=0;i1=matches.length}else if(!isSelectedPage){return}var lastDivIdx=-1;var lastOffset=-1;for(var _i80=i0;_i80<i1;_i80++){var match=matches[_i80];var begin=match.begin;if(begin.divIdx===lastDivIdx&&begin.offset===lastOffset){continue}lastDivIdx=begin.divIdx;lastOffset=begin.offset;var _end4=match.end;var isSelected=isSelectedPage&&_i80===selectedMatchIdx;var highlightSuffix=isSelected?" selected":"";var selectedLeft=0;if(!prevEnd||begin.divIdx!==prevEnd.divIdx){if(prevEnd!==null){appendTextToDiv(prevEnd.divIdx,prevEnd.offset,infinity.offset)}beginText(begin)}else{appendTextToDiv(prevEnd.divIdx,prevEnd.offset,begin.offset)}if(begin.divIdx===_end4.divIdx){selectedLeft=appendTextToDiv(begin.divIdx,begin.offset,_end4.offset,"highlight"+highlightSuffix)}else{selectedLeft=appendTextToDiv(begin.divIdx,begin.offset,infinity.offset,"highlight begin"+highlightSuffix);for(var n0=begin.divIdx+1,n1=_end4.divIdx;n0<n1;n0++){textDivs[n0].className="highlight middle"+highlightSuffix}beginText(_end4,"highlight end"+highlightSuffix)}prevEnd=_end4;if(isSelected){findController.scrollMatchIntoView({element:textDivs[begin.divIdx],selectedLeft:selectedLeft,pageIndex:pageIdx,matchIndex:selectedMatchIdx})}}if(prevEnd){appendTextToDiv(prevEnd.divIdx,prevEnd.offset,infinity.offset)}}},{key:"_updateMatches",value:function _updateMatches(){var reset=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this.enabled&&!reset){return}var findController=this.findController,matches=this.matches,pageIdx=this.pageIdx;var textContentItemsStr=this.textContentItemsStr,textDivs=this.textDivs;var clearedUntilDivIdx=-1;var _iterator174=_createForOfIteratorHelper(matches),_step174;try{for(_iterator174.s();!(_step174=_iterator174.n()).done;){var match=_step174.value;var begin=Math.max(clearedUntilDivIdx,match.begin.divIdx);for(var n=begin,_end5=match.end.divIdx;n<=_end5;n++){var div=textDivs[n];div.textContent=textContentItemsStr[n];div.className=""}clearedUntilDivIdx=match.end.divIdx+1}}catch(err){_iterator174.e(err)}finally{_iterator174.f()}if(!(findController!==null&&findController!==void 0&&findController.highlightMatches)||reset){return}var pageMatches=findController.pageMatches[pageIdx]||null;var pageMatchesLength=findController.pageMatchesLength[pageIdx]||null;this.matches=this._convertMatches(pageMatches,pageMatchesLength);this._renderMatches(this.matches)}}]);return TextHighlighter}();exports.TextHighlighter=TextHighlighter}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.TextLayerBuilder=void 0;var _pdfjsLib=__w_pdfjs_require__(4);var _ui_utils=__w_pdfjs_require__(2);var _enablePermissions=new WeakMap;var _rotation3=new WeakMap;var _scale=new WeakMap;var _textContentSource=new WeakMap;var _finishRendering=new WeakSet;var _bindMouse=new WeakSet;var TextLayerBuilder=function(){function TextLayerBuilder(_ref134){var _ref134$highlighter=_ref134.highlighter,highlighter=_ref134$highlighter===void 0?null:_ref134$highlighter,_ref134$accessibility=_ref134.accessibilityManager,accessibilityManager=_ref134$accessibility===void 0?null:_ref134$accessibility,_ref134$isOffscreenCa=_ref134.isOffscreenCanvasSupported,isOffscreenCanvasSupported=_ref134$isOffscreenCa===void 0?true:_ref134$isOffscreenCa,_ref134$enablePermiss=_ref134.enablePermissions,enablePermissions=_ref134$enablePermiss===void 0?false:_ref134$enablePermiss;_classCallCheck2(this,TextLayerBuilder);_classPrivateMethodInitSpec(this,_bindMouse);_classPrivateMethodInitSpec(this,_finishRendering);_classPrivateFieldInitSpec(this,_enablePermissions,{writable:true,value:false});_classPrivateFieldInitSpec(this,_rotation3,{writable:true,value:0});_classPrivateFieldInitSpec(this,_scale,{writable:true,value:0});_classPrivateFieldInitSpec(this,_textContentSource,{writable:true,value:null});this.textContentItemsStr=[];this.renderingDone=false;this.textDivs=[];this.textDivProperties=new WeakMap;this.textLayerRenderTask=null;this.highlighter=highlighter;this.accessibilityManager=accessibilityManager;this.isOffscreenCanvasSupported=isOffscreenCanvasSupported;_classPrivateFieldSet(this,_enablePermissions,enablePermissions===true);this.div=document.createElement("div");this.div.className="textLayer";this.hide()}_createClass2(TextLayerBuilder,[{key:"numTextDivs",get:function get(){return this.textDivs.length}},{key:"render",value:function(){var _render5=_asyncToGenerator(_regeneratorRuntime().mark(function _callee88(viewport){var _this$highlighter,_this$accessibilityMa,_this$accessibilityMa2;var scale,rotation,mustRotate,mustRescale;return _regeneratorRuntime().wrap(function _callee88$(_context89){while(1)switch(_context89.prev=_context89.next){case 0:if(_classPrivateFieldGet(this,_textContentSource)){_context89.next=2;break}throw new Error("No \"textContentSource\" parameter specified.");case 2:scale=viewport.scale*(globalThis.devicePixelRatio||1);rotation=viewport.rotation;if(!this.renderingDone){_context89.next=10;break}mustRotate=rotation!==_classPrivateFieldGet(this,_rotation3);mustRescale=scale!==_classPrivateFieldGet(this,_scale);if(mustRotate||mustRescale){this.hide();(0,_pdfjsLib.updateTextLayer)({container:this.div,viewport:viewport,textDivs:this.textDivs,textDivProperties:this.textDivProperties,isOffscreenCanvasSupported:this.isOffscreenCanvasSupported,mustRescale:mustRescale,mustRotate:mustRotate});_classPrivateFieldSet(this,_scale,scale);_classPrivateFieldSet(this,_rotation3,rotation)}this.show();return _context89.abrupt("return");case 10:this.cancel();(_this$highlighter=this.highlighter)===null||_this$highlighter===void 0||_this$highlighter.setTextMapping(this.textDivs,this.textContentItemsStr);(_this$accessibilityMa=this.accessibilityManager)===null||_this$accessibilityMa===void 0||_this$accessibilityMa.setTextMapping(this.textDivs);this.textLayerRenderTask=(0,_pdfjsLib.renderTextLayer)({textContentSource:_classPrivateFieldGet(this,_textContentSource),container:this.div,viewport:viewport,textDivs:this.textDivs,textDivProperties:this.textDivProperties,textContentItemsStr:this.textContentItemsStr,isOffscreenCanvasSupported:this.isOffscreenCanvasSupported});_context89.next=16;return this.textLayerRenderTask.promise;case 16:_classPrivateMethodGet(this,_finishRendering,_finishRendering2).call(this);_classPrivateFieldSet(this,_scale,scale);_classPrivateFieldSet(this,_rotation3,rotation);this.show();(_this$accessibilityMa2=this.accessibilityManager)===null||_this$accessibilityMa2===void 0||_this$accessibilityMa2.enable();case 21:case"end":return _context89.stop()}},_callee88,this)}));function render(_x74){return _render5.apply(this,arguments)}return render}()},{key:"hide",value:function hide(){if(!this.div.hidden){var _this$highlighter2;(_this$highlighter2=this.highlighter)===null||_this$highlighter2===void 0||_this$highlighter2.disable();this.div.hidden=true}}},{key:"show",value:function show(){if(this.div.hidden&&this.renderingDone){var _this$highlighter3;this.div.hidden=false;(_this$highlighter3=this.highlighter)===null||_this$highlighter3===void 0||_this$highlighter3.enable()}}},{key:"cancel",value:function cancel(){var _this$highlighter4,_this$accessibilityMa3;if(this.textLayerRenderTask){this.textLayerRenderTask.cancel();this.textLayerRenderTask=null}(_this$highlighter4=this.highlighter)===null||_this$highlighter4===void 0||_this$highlighter4.disable();(_this$accessibilityMa3=this.accessibilityManager)===null||_this$accessibilityMa3===void 0||_this$accessibilityMa3.disable();this.textContentItemsStr.length=0;this.textDivs.length=0;this.textDivProperties=new WeakMap}},{key:"setTextContentSource",value:function setTextContentSource(source){this.cancel();_classPrivateFieldSet(this,_textContentSource,source)}}]);return TextLayerBuilder}();function _finishRendering2(){this.renderingDone=true;var endOfContent=document.createElement("div");endOfContent.className="endOfContent";this.div.append(endOfContent);_classPrivateMethodGet(this,_bindMouse,_bindMouse2).call(this)}function _bindMouse2(){var _this160=this;var div=this.div;div.addEventListener("mousedown",function(evt){var end=div.querySelector(".endOfContent");if(!end){return}var adjustTop=evt.target!==div;adjustTop&&(adjustTop=getComputedStyle(end).getPropertyValue("-moz-user-select")!=="none");if(adjustTop){var divBounds=div.getBoundingClientRect();var r=Math.max(0,(evt.pageY-divBounds.top)/divBounds.height);end.style.top=(r*100).toFixed(2)+"%"}end.classList.add("active")});div.addEventListener("mouseup",function(){var end=div.querySelector(".endOfContent");if(!end){return}end.style.top="";end.classList.remove("active")});div.addEventListener("copy",function(event){if(!_classPrivateFieldGet(_this160,_enablePermissions)){var _selection=document.getSelection();event.clipboardData.setData("text/plain",(0,_ui_utils.removeNullCharacters)((0,_pdfjsLib.normalizeUnicode)(_selection.toString())))}event.preventDefault();event.stopPropagation()})}exports.TextLayerBuilder=TextLayerBuilder}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.XfaLayerBuilder=void 0;var _pdfjsLib=__w_pdfjs_require__(4);var XfaLayerBuilder=function(){function XfaLayerBuilder(_ref135){var pageDiv=_ref135.pageDiv,pdfPage=_ref135.pdfPage,_ref135$annotationSto=_ref135.annotationStorage,annotationStorage=_ref135$annotationSto===void 0?null:_ref135$annotationSto,linkService=_ref135.linkService,_ref135$xfaHtml=_ref135.xfaHtml,xfaHtml=_ref135$xfaHtml===void 0?null:_ref135$xfaHtml;_classCallCheck2(this,XfaLayerBuilder);this.pageDiv=pageDiv;this.pdfPage=pdfPage;this.annotationStorage=annotationStorage;this.linkService=linkService;this.xfaHtml=xfaHtml;this.div=null;this._cancelled=false}_createClass2(XfaLayerBuilder,[{key:"render",value:function(){var _render6=_asyncToGenerator(_regeneratorRuntime().mark(function _callee89(viewport){var intent,_parameters,div,xfaHtml,parameters,_args90=arguments;return _regeneratorRuntime().wrap(function _callee89$(_context90){while(1)switch(_context90.prev=_context90.next){case 0:intent=_args90.length>1&&_args90[1]!==undefined?_args90[1]:"display";if(!(intent==="print")){_context90.next=7;break}_parameters={viewport:viewport.clone({dontFlip:true}),div:this.div,xfaHtml:this.xfaHtml,annotationStorage:this.annotationStorage,linkService:this.linkService,intent:intent};div=document.createElement("div");this.pageDiv.append(div);_parameters.div=div;return _context90.abrupt("return",_pdfjsLib.XfaLayer.render(_parameters));case 7:_context90.next=9;return this.pdfPage.getXfa();case 9:xfaHtml=_context90.sent;if(!(this._cancelled||!xfaHtml)){_context90.next=12;break}return _context90.abrupt("return",{textDivs:[]});case 12:parameters={viewport:viewport.clone({dontFlip:true}),div:this.div,xfaHtml:xfaHtml,annotationStorage:this.annotationStorage,linkService:this.linkService,intent:intent};if(!this.div){_context90.next=15;break}return _context90.abrupt("return",_pdfjsLib.XfaLayer.update(parameters));case 15:this.div=document.createElement("div");this.pageDiv.append(this.div);parameters.div=this.div;return _context90.abrupt("return",_pdfjsLib.XfaLayer.render(parameters));case 19:case"end":return _context90.stop()}},_callee89,this)}));function render(_x75){return _render6.apply(this,arguments)}return render}()},{key:"cancel",value:function cancel(){this._cancelled=true}},{key:"hide",value:function hide(){if(!this.div){return}this.div.hidden=true}}]);return XfaLayerBuilder}();exports.XfaLayerBuilder=XfaLayerBuilder}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFScriptingManager=void 0;var _generic_scripting=__w_pdfjs_require__(22);var _pdf_scripting_manager=__w_pdfjs_require__(23);var PDFScriptingManagerComponents=function(_pdf_scripting_manage){_inherits2(PDFScriptingManagerComponents,_pdf_scripting_manage);var _super67=_createSuper(PDFScriptingManagerComponents);function PDFScriptingManagerComponents(options){_classCallCheck2(this,PDFScriptingManagerComponents);if(!options.externalServices){window.addEventListener("updatefromsandbox",function(event){options.eventBus.dispatch("updatefromsandbox",{source:window,detail:event.detail})})}options.externalServices||(options.externalServices={createScripting:function createScripting(_ref136){var sandboxBundleSrc=_ref136.sandboxBundleSrc;return new _generic_scripting.GenericScripting(sandboxBundleSrc)}});options.docProperties||(options.docProperties=function(pdfDocument){return(0,_generic_scripting.docProperties)(pdfDocument)});return _super67.call(this,options)}return _createClass2(PDFScriptingManagerComponents)}(_pdf_scripting_manager.PDFScriptingManager);exports.PDFScriptingManager=PDFScriptingManagerComponents}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.GenericScripting=void 0;exports.docProperties=docProperties;var _pdfjsLib=__w_pdfjs_require__(4);function docProperties(_x76){return _docProperties.apply(this,arguments)}function _docProperties(){_docProperties=_asyncToGenerator(_regeneratorRuntime().mark(function _callee93(pdfDocument){var url,baseUrl,_yield$pdfDocument$ge,info,metadata,contentDispositionFilename,contentLength,_yield$pdfDocument$ge2,length;return _regeneratorRuntime().wrap(function _callee93$(_context94){while(1)switch(_context94.prev=_context94.next){case 0:url="",baseUrl=url.split("#")[0];_context94.next=3;return pdfDocument.getMetadata();case 3:_yield$pdfDocument$ge=_context94.sent;info=_yield$pdfDocument$ge.info;metadata=_yield$pdfDocument$ge.metadata;contentDispositionFilename=_yield$pdfDocument$ge.contentDispositionFilename;contentLength=_yield$pdfDocument$ge.contentLength;if(contentLength){_context94.next=14;break}_context94.next=11;return pdfDocument.getDownloadInfo();case 11:_yield$pdfDocument$ge2=_context94.sent;length=_yield$pdfDocument$ge2.length;contentLength=length;case 14:return _context94.abrupt("return",_objectSpread2(_objectSpread2({},info),{},{baseURL:baseUrl,filesize:contentLength,filename:contentDispositionFilename||(0,_pdfjsLib.getPdfFilenameFromUrl)(url),metadata:metadata===null||metadata===void 0?void 0:metadata.getRaw(),authors:metadata===null||metadata===void 0?void 0:metadata.get("dc:creator"),numPages:pdfDocument.numPages,URL:url}));case 15:case"end":return _context94.stop()}},_callee93)}));return _docProperties.apply(this,arguments)}var GenericScripting=function(){function GenericScripting(sandboxBundleSrc){_classCallCheck2(this,GenericScripting);this._ready=(0,_pdfjsLib.loadScript)(sandboxBundleSrc,true).then(function(){return window.pdfjsSandbox.QuickJSSandbox()})}_createClass2(GenericScripting,[{key:"createSandbox",value:function(){var _createSandbox=_asyncToGenerator(_regeneratorRuntime().mark(function _callee90(data){var sandbox;return _regeneratorRuntime().wrap(function _callee90$(_context91){while(1)switch(_context91.prev=_context91.next){case 0:_context91.next=2;return this._ready;case 2:sandbox=_context91.sent;sandbox.create(data);case 4:case"end":return _context91.stop()}},_callee90,this)}));function createSandbox(_x77){return _createSandbox.apply(this,arguments)}return createSandbox}()},{key:"dispatchEventInSandbox",value:function(){var _dispatchEventInSandbox=_asyncToGenerator(_regeneratorRuntime().mark(function _callee91(event){var sandbox;return _regeneratorRuntime().wrap(function _callee91$(_context92){while(1)switch(_context92.prev=_context92.next){case 0:_context92.next=2;return this._ready;case 2:sandbox=_context92.sent;setTimeout(function(){return sandbox.dispatchEvent(event)},0);case 4:case"end":return _context92.stop()}},_callee91,this)}));function dispatchEventInSandbox(_x78){return _dispatchEventInSandbox.apply(this,arguments)}return dispatchEventInSandbox}()},{key:"destroySandbox",value:function(){var _destroySandbox=_asyncToGenerator(_regeneratorRuntime().mark(function _callee92(){var sandbox;return _regeneratorRuntime().wrap(function _callee92$(_context93){while(1)switch(_context93.prev=_context93.next){case 0:_context93.next=2;return this._ready;case 2:sandbox=_context93.sent;sandbox.nukeSandbox();case 4:case"end":return _context93.stop()}},_callee92,this)}));function destroySandbox(){return _destroySandbox.apply(this,arguments)}return destroySandbox}()}]);return GenericScripting}();exports.GenericScripting=GenericScripting}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFScriptingManager=void 0;var _ui_utils=__w_pdfjs_require__(2);var _pdfjsLib=__w_pdfjs_require__(4);var _closeCapability=new WeakMap;var _destroyCapability=new WeakMap;var _docProperties2=new WeakMap;var _eventBus=new WeakMap;var _externalServices=new WeakMap;var _pdfDocument=new WeakMap;var _pdfViewer=new WeakMap;var _ready=new WeakMap;var _sandboxBundleSrc=new WeakMap;var _scripting=new WeakMap;var _willPrintCapability=new WeakMap;var _updateFromSandbox=new WeakSet;var _dispatchPageOpen=new WeakSet;var _dispatchPageClose=new WeakSet;var _initScripting=new WeakSet;var _destroyScripting=new WeakSet;var PDFScriptingManager=function(){function PDFScriptingManager(_ref137){var eventBus=_ref137.eventBus,_ref137$sandboxBundle=_ref137.sandboxBundleSrc,sandboxBundleSrc=_ref137$sandboxBundle===void 0?null:_ref137$sandboxBundle,_ref137$externalServi=_ref137.externalServices,externalServices=_ref137$externalServi===void 0?null:_ref137$externalServi,_ref137$docProperties=_ref137.docProperties,docProperties=_ref137$docProperties===void 0?null:_ref137$docProperties;_classCallCheck2(this,PDFScriptingManager);_classPrivateMethodInitSpec(this,_destroyScripting);_classPrivateMethodInitSpec(this,_initScripting);_classPrivateMethodInitSpec(this,_dispatchPageClose);_classPrivateMethodInitSpec(this,_dispatchPageOpen);_classPrivateMethodInitSpec(this,_updateFromSandbox);_classPrivateFieldInitSpec(this,_closeCapability,{writable:true,value:null});_classPrivateFieldInitSpec(this,_destroyCapability,{writable:true,value:null});_classPrivateFieldInitSpec(this,_docProperties2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_eventBus,{writable:true,value:null});_classPrivateFieldInitSpec(this,_externalServices,{writable:true,value:null});_classPrivateFieldInitSpec(this,_pdfDocument,{writable:true,value:null});_classPrivateFieldInitSpec(this,_pdfViewer,{writable:true,value:null});_classPrivateFieldInitSpec(this,_ready,{writable:true,value:false});_classPrivateFieldInitSpec(this,_sandboxBundleSrc,{writable:true,value:null});_classPrivateFieldInitSpec(this,_scripting,{writable:true,value:null});_classPrivateFieldInitSpec(this,_willPrintCapability,{writable:true,value:null});_classPrivateFieldSet(this,_eventBus,eventBus);_classPrivateFieldSet(this,_sandboxBundleSrc,sandboxBundleSrc);_classPrivateFieldSet(this,_externalServices,externalServices);_classPrivateFieldSet(this,_docProperties2,docProperties)}_createClass2(PDFScriptingManager,[{key:"setViewer",value:function setViewer(pdfViewer){_classPrivateFieldSet(this,_pdfViewer,pdfViewer)}},{key:"setDocument",value:function(){var _setDocument=_asyncToGenerator(_regeneratorRuntime().mark(function _callee95(pdfDocument){var _this161=this,_classPrivateFieldGet53;var _yield$Promise$all3,_yield$Promise$all4,objects,calculationOrder,docActions,_iterator175,_step175,_step175$value,_name16,listener,docProperties;return _regeneratorRuntime().wrap(function _callee95$(_context96){while(1)switch(_context96.prev=_context96.next){case 0:if(!_classPrivateFieldGet(this,_pdfDocument)){_context96.next=3;break}_context96.next=3;return _classPrivateMethodGet(this,_destroyScripting,_destroyScripting2).call(this);case 3:_classPrivateFieldSet(this,_pdfDocument,pdfDocument);if(pdfDocument){_context96.next=6;break}return _context96.abrupt("return");case 6:_context96.next=8;return Promise.all([pdfDocument.getFieldObjects(),pdfDocument.getCalculationOrderIds(),pdfDocument.getJSActions()]);case 8:_yield$Promise$all3=_context96.sent;_yield$Promise$all4=_slicedToArray2(_yield$Promise$all3,3);objects=_yield$Promise$all4[0];calculationOrder=_yield$Promise$all4[1];docActions=_yield$Promise$all4[2];if(!(!objects&&!docActions)){_context96.next=17;break}_context96.next=16;return _classPrivateMethodGet(this,_destroyScripting,_destroyScripting2).call(this);case 16:return _context96.abrupt("return");case 17:if(!(pdfDocument!==_classPrivateFieldGet(this,_pdfDocument))){_context96.next=19;break}return _context96.abrupt("return");case 19:_context96.prev=19;_classPrivateFieldSet(this,_scripting,_classPrivateMethodGet(this,_initScripting,_initScripting2).call(this));_context96.next=29;break;case 23:_context96.prev=23;_context96.t0=_context96["catch"](19);console.error("setDocument: \"".concat(_context96.t0.message,"\"."));_context96.next=28;return _classPrivateMethodGet(this,_destroyScripting,_destroyScripting2).call(this);case 28:return _context96.abrupt("return");case 29:this._internalEvents.set("updatefromsandbox",function(event){if((event===null||event===void 0?void 0:event.source)===window){_classPrivateMethodGet(_this161,_updateFromSandbox,_updateFromSandbox2).call(_this161,event.detail)}});this._internalEvents.set("dispatcheventinsandbox",function(event){var _classPrivateFieldGet50;(_classPrivateFieldGet50=_classPrivateFieldGet(_this161,_scripting))===null||_classPrivateFieldGet50===void 0||_classPrivateFieldGet50.dispatchEventInSandbox(event.detail)});this._internalEvents.set("pagechanging",function(_ref138){var pageNumber=_ref138.pageNumber,previous=_ref138.previous;if(pageNumber===previous){return}_classPrivateMethodGet(_this161,_dispatchPageClose,_dispatchPageClose2).call(_this161,previous);_classPrivateMethodGet(_this161,_dispatchPageOpen,_dispatchPageOpen2).call(_this161,pageNumber)});this._internalEvents.set("pagerendered",function(_ref139){var pageNumber=_ref139.pageNumber;if(!_this161._pageOpenPending.has(pageNumber)){return}if(pageNumber!==_classPrivateFieldGet(_this161,_pdfViewer).currentPageNumber){return}_classPrivateMethodGet(_this161,_dispatchPageOpen,_dispatchPageOpen2).call(_this161,pageNumber)});this._internalEvents.set("pagesdestroy",_asyncToGenerator(_regeneratorRuntime().mark(function _callee94(){var _classPrivateFieldGet51,_classPrivateFieldGet52;return _regeneratorRuntime().wrap(function _callee94$(_context95){while(1)switch(_context95.prev=_context95.next){case 0:_context95.next=2;return _classPrivateMethodGet(_this161,_dispatchPageClose,_dispatchPageClose2).call(_this161,_classPrivateFieldGet(_this161,_pdfViewer).currentPageNumber);case 2:_context95.next=4;return(_classPrivateFieldGet51=_classPrivateFieldGet(_this161,_scripting))===null||_classPrivateFieldGet51===void 0?void 0:_classPrivateFieldGet51.dispatchEventInSandbox({id:"doc",name:"WillClose"});case 4:(_classPrivateFieldGet52=_classPrivateFieldGet(_this161,_closeCapability))===null||_classPrivateFieldGet52===void 0||_classPrivateFieldGet52.resolve();case 5:case"end":return _context95.stop()}},_callee94)})));_iterator175=_createForOfIteratorHelper(this._internalEvents);try{for(_iterator175.s();!(_step175=_iterator175.n()).done;){_step175$value=_slicedToArray2(_step175.value,2),_name16=_step175$value[0],listener=_step175$value[1];_classPrivateFieldGet(this,_eventBus)._on(_name16,listener)}}catch(err){_iterator175.e(err)}finally{_iterator175.f()}_context96.prev=36;_context96.next=39;return _classPrivateFieldGet(this,_docProperties2).call(this,pdfDocument);case 39:docProperties=_context96.sent;if(!(pdfDocument!==_classPrivateFieldGet(this,_pdfDocument))){_context96.next=42;break}return _context96.abrupt("return");case 42:_context96.next=44;return _classPrivateFieldGet(this,_scripting).createSandbox({objects:objects,calculationOrder:calculationOrder,appInfo:{platform:navigator.platform,language:navigator.language},docInfo:_objectSpread2(_objectSpread2({},docProperties),{},{actions:docActions})});case 44:_classPrivateFieldGet(this,_eventBus).dispatch("sandboxcreated",{source:this});_context96.next=53;break;case 47:_context96.prev=47;_context96.t1=_context96["catch"](36);console.error("setDocument: \"".concat(_context96.t1.message,"\"."));_context96.next=52;return _classPrivateMethodGet(this,_destroyScripting,_destroyScripting2).call(this);case 52:return _context96.abrupt("return");case 53:_context96.next=55;return(_classPrivateFieldGet53=_classPrivateFieldGet(this,_scripting))===null||_classPrivateFieldGet53===void 0?void 0:_classPrivateFieldGet53.dispatchEventInSandbox({id:"doc",name:"Open"});case 55:_context96.next=57;return _classPrivateMethodGet(this,_dispatchPageOpen,_dispatchPageOpen2).call(this,_classPrivateFieldGet(this,_pdfViewer).currentPageNumber,true);case 57:Promise.resolve().then(function(){if(pdfDocument===_classPrivateFieldGet(_this161,_pdfDocument)){_classPrivateFieldSet(_this161,_ready,true)}});case 58:case"end":return _context96.stop()}},_callee95,this,[[19,23],[36,47]])}));function setDocument(_x79){return _setDocument.apply(this,arguments)}return setDocument}()},{key:"dispatchWillSave",value:function(){var _dispatchWillSave=_asyncToGenerator(_regeneratorRuntime().mark(function _callee96(){var _classPrivateFieldGet54;return _regeneratorRuntime().wrap(function _callee96$(_context97){while(1)switch(_context97.prev=_context97.next){case 0:return _context97.abrupt("return",(_classPrivateFieldGet54=_classPrivateFieldGet(this,_scripting))===null||_classPrivateFieldGet54===void 0?void 0:_classPrivateFieldGet54.dispatchEventInSandbox({id:"doc",name:"WillSave"}));case 1:case"end":return _context97.stop()}},_callee96,this)}));function dispatchWillSave(){return _dispatchWillSave.apply(this,arguments)}return dispatchWillSave}()},{key:"dispatchDidSave",value:function(){var _dispatchDidSave=_asyncToGenerator(_regeneratorRuntime().mark(function _callee97(){var _classPrivateFieldGet55;return _regeneratorRuntime().wrap(function _callee97$(_context98){while(1)switch(_context98.prev=_context98.next){case 0:return _context98.abrupt("return",(_classPrivateFieldGet55=_classPrivateFieldGet(this,_scripting))===null||_classPrivateFieldGet55===void 0?void 0:_classPrivateFieldGet55.dispatchEventInSandbox({id:"doc",name:"DidSave"}));case 1:case"end":return _context98.stop()}},_callee97,this)}));function dispatchDidSave(){return _dispatchDidSave.apply(this,arguments)}return dispatchDidSave}()},{key:"dispatchWillPrint",value:function(){var _dispatchWillPrint=_asyncToGenerator(_regeneratorRuntime().mark(function _callee98(){var _classPrivateFieldGet56;return _regeneratorRuntime().wrap(function _callee98$(_context99){while(1)switch(_context99.prev=_context99.next){case 0:if(_classPrivateFieldGet(this,_scripting)){_context99.next=2;break}return _context99.abrupt("return");case 2:_context99.next=4;return(_classPrivateFieldGet56=_classPrivateFieldGet(this,_willPrintCapability))===null||_classPrivateFieldGet56===void 0?void 0:_classPrivateFieldGet56.promise;case 4:_classPrivateFieldSet(this,_willPrintCapability,new _pdfjsLib.PromiseCapability);_context99.prev=5;_context99.next=8;return _classPrivateFieldGet(this,_scripting).dispatchEventInSandbox({id:"doc",name:"WillPrint"});case 8:_context99.next=15;break;case 10:_context99.prev=10;_context99.t0=_context99["catch"](5);_classPrivateFieldGet(this,_willPrintCapability).resolve();_classPrivateFieldSet(this,_willPrintCapability,null);throw _context99.t0;case 15:_context99.next=17;return _classPrivateFieldGet(this,_willPrintCapability).promise;case 17:case"end":return _context99.stop()}},_callee98,this,[[5,10]])}));function dispatchWillPrint(){return _dispatchWillPrint.apply(this,arguments)}return dispatchWillPrint}()},{key:"dispatchDidPrint",value:function(){var _dispatchDidPrint=_asyncToGenerator(_regeneratorRuntime().mark(function _callee99(){var _classPrivateFieldGet57;return _regeneratorRuntime().wrap(function _callee99$(_context100){while(1)switch(_context100.prev=_context100.next){case 0:return _context100.abrupt("return",(_classPrivateFieldGet57=_classPrivateFieldGet(this,_scripting))===null||_classPrivateFieldGet57===void 0?void 0:_classPrivateFieldGet57.dispatchEventInSandbox({id:"doc",name:"DidPrint"}));case 1:case"end":return _context100.stop()}},_callee99,this)}));function dispatchDidPrint(){return _dispatchDidPrint.apply(this,arguments)}return dispatchDidPrint}()},{key:"destroyPromise",get:function get(){var _classPrivateFieldGet58;return((_classPrivateFieldGet58=_classPrivateFieldGet(this,_destroyCapability))===null||_classPrivateFieldGet58===void 0?void 0:_classPrivateFieldGet58.promise)||null}},{key:"ready",get:function get(){return _classPrivateFieldGet(this,_ready)}},{key:"_internalEvents",get:function get(){return(0,_pdfjsLib.shadow)(this,"_internalEvents",new Map)}},{key:"_pageOpenPending",get:function get(){return(0,_pdfjsLib.shadow)(this,"_pageOpenPending",new Set)}},{key:"_visitedPages",get:function get(){return(0,_pdfjsLib.shadow)(this,"_visitedPages",new Map)}}]);return PDFScriptingManager}();function _updateFromSandbox2(_x80){return _updateFromSandbox3.apply(this,arguments)}function _updateFromSandbox3(){_updateFromSandbox3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee100(detail){var _classPrivateFieldGet59;var pdfViewer,isInPresentationMode,id,siblings,command,value,modes,ids,_iterator176,_step176,elementId,element,_classPrivateFieldGet60;return _regeneratorRuntime().wrap(function _callee100$(_context101){while(1)switch(_context101.prev=_context101.next){case 0:pdfViewer=_classPrivateFieldGet(this,_pdfViewer);isInPresentationMode=pdfViewer.isInPresentationMode||pdfViewer.isChangingPresentationMode;id=detail.id,siblings=detail.siblings,command=detail.command,value=detail.value;if(id){_context101.next=41;break}_context101.t0=command;_context101.next=_context101.t0==="clear"?7:_context101.t0==="error"?9:_context101.t0==="layout"?11:_context101.t0==="page-num"?13:_context101.t0==="print"?15:_context101.t0==="println"?19:_context101.t0==="zoom"?21:_context101.t0==="SaveAs"?23:_context101.t0==="FirstPage"?25:_context101.t0==="LastPage"?27:_context101.t0==="NextPage"?29:_context101.t0==="PrevPage"?31:_context101.t0==="ZoomViewIn"?33:_context101.t0==="ZoomViewOut"?35:_context101.t0==="WillPrintFinished"?37:40;break;case 7:console.clear();return _context101.abrupt("break",40);case 9:console.error(value);return _context101.abrupt("break",40);case 11:if(!isInPresentationMode){modes=(0,_ui_utils.apiPageLayoutToViewerModes)(value);pdfViewer.spreadMode=modes.spreadMode}return _context101.abrupt("break",40);case 13:pdfViewer.currentPageNumber=value+1;return _context101.abrupt("break",40);case 15:_context101.next=17;return pdfViewer.pagesPromise;case 17:_classPrivateFieldGet(this,_eventBus).dispatch("print",{source:this});return _context101.abrupt("break",40);case 19:console.log(value);return _context101.abrupt("break",40);case 21:if(!isInPresentationMode){pdfViewer.currentScaleValue=value}return _context101.abrupt("break",40);case 23:_classPrivateFieldGet(this,_eventBus).dispatch("download",{source:this});return _context101.abrupt("break",40);case 25:pdfViewer.currentPageNumber=1;return _context101.abrupt("break",40);case 27:pdfViewer.currentPageNumber=pdfViewer.pagesCount;return _context101.abrupt("break",40);case 29:pdfViewer.nextPage();return _context101.abrupt("break",40);case 31:pdfViewer.previousPage();return _context101.abrupt("break",40);case 33:if(!isInPresentationMode){pdfViewer.increaseScale()}return _context101.abrupt("break",40);case 35:if(!isInPresentationMode){pdfViewer.decreaseScale()}return _context101.abrupt("break",40);case 37:(_classPrivateFieldGet59=_classPrivateFieldGet(this,_willPrintCapability))===null||_classPrivateFieldGet59===void 0||_classPrivateFieldGet59.resolve();_classPrivateFieldSet(this,_willPrintCapability,null);return _context101.abrupt("break",40);case 40:return _context101.abrupt("return");case 41:if(!(isInPresentationMode&&detail.focus)){_context101.next=43;break}return _context101.abrupt("return");case 43:delete detail.id;delete detail.siblings;ids=siblings?[id].concat(_toConsumableArray2(siblings)):[id];_iterator176=_createForOfIteratorHelper(ids);try{for(_iterator176.s();!(_step176=_iterator176.n()).done;){elementId=_step176.value;element=document.querySelector("[data-element-id=\"".concat(elementId,"\"]"));if(element){element.dispatchEvent(new CustomEvent("updatefromsandbox",{detail:detail}))}else{(_classPrivateFieldGet60=_classPrivateFieldGet(this,_pdfDocument))===null||_classPrivateFieldGet60===void 0||_classPrivateFieldGet60.annotationStorage.setValue(elementId,detail)}}}catch(err){_iterator176.e(err)}finally{_iterator176.f()}case 48:case"end":return _context101.stop()}},_callee100,this)}));return _updateFromSandbox3.apply(this,arguments)}function _dispatchPageOpen2(_x81){return _dispatchPageOpen3.apply(this,arguments)}function _dispatchPageOpen3(){_dispatchPageOpen3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee102(pageNumber){var _this162=this;var initialize,pdfDocument,visitedPages,pageView,actionsPromise,_args103=arguments;return _regeneratorRuntime().wrap(function _callee102$(_context103){while(1)switch(_context103.prev=_context103.next){case 0:initialize=_args103.length>1&&_args103[1]!==undefined?_args103[1]:false;pdfDocument=_classPrivateFieldGet(this,_pdfDocument),visitedPages=this._visitedPages;if(initialize){_classPrivateFieldSet(this,_closeCapability,new _pdfjsLib.PromiseCapability)}if(_classPrivateFieldGet(this,_closeCapability)){_context103.next=5;break}return _context103.abrupt("return");case 5:pageView=_classPrivateFieldGet(this,_pdfViewer).getPageView(pageNumber-1);if(!((pageView===null||pageView===void 0?void 0:pageView.renderingState)!==_ui_utils.RenderingStates.FINISHED)){_context103.next=9;break}this._pageOpenPending.add(pageNumber);return _context103.abrupt("return");case 9:this._pageOpenPending["delete"](pageNumber);actionsPromise=_asyncToGenerator(_regeneratorRuntime().mark(function _callee101(){var _pageView$pdfPage,_classPrivateFieldGet61;var actions;return _regeneratorRuntime().wrap(function _callee101$(_context102){while(1)switch(_context102.prev=_context102.next){case 0:_context102.next=2;return!visitedPages.has(pageNumber)?(_pageView$pdfPage=pageView.pdfPage)===null||_pageView$pdfPage===void 0?void 0:_pageView$pdfPage.getJSActions():null;case 2:actions=_context102.sent;if(!(pdfDocument!==_classPrivateFieldGet(_this162,_pdfDocument))){_context102.next=5;break}return _context102.abrupt("return");case 5:_context102.next=7;return(_classPrivateFieldGet61=_classPrivateFieldGet(_this162,_scripting))===null||_classPrivateFieldGet61===void 0?void 0:_classPrivateFieldGet61.dispatchEventInSandbox({id:"page",name:"PageOpen",pageNumber:pageNumber,actions:actions});case 7:case"end":return _context102.stop()}},_callee101)}))();visitedPages.set(pageNumber,actionsPromise);case 12:case"end":return _context103.stop()}},_callee102,this)}));return _dispatchPageOpen3.apply(this,arguments)}function _dispatchPageClose2(_x82){return _dispatchPageClose3.apply(this,arguments)}function _dispatchPageClose3(){_dispatchPageClose3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee103(pageNumber){var _classPrivateFieldGet62;var pdfDocument,visitedPages,actionsPromise;return _regeneratorRuntime().wrap(function _callee103$(_context104){while(1)switch(_context104.prev=_context104.next){case 0:pdfDocument=_classPrivateFieldGet(this,_pdfDocument),visitedPages=this._visitedPages;if(_classPrivateFieldGet(this,_closeCapability)){_context104.next=3;break}return _context104.abrupt("return");case 3:if(!this._pageOpenPending.has(pageNumber)){_context104.next=5;break}return _context104.abrupt("return");case 5:actionsPromise=visitedPages.get(pageNumber);if(actionsPromise){_context104.next=8;break}return _context104.abrupt("return");case 8:visitedPages.set(pageNumber,null);_context104.next=11;return actionsPromise;case 11:if(!(pdfDocument!==_classPrivateFieldGet(this,_pdfDocument))){_context104.next=13;break}return _context104.abrupt("return");case 13:_context104.next=15;return(_classPrivateFieldGet62=_classPrivateFieldGet(this,_scripting))===null||_classPrivateFieldGet62===void 0?void 0:_classPrivateFieldGet62.dispatchEventInSandbox({id:"page",name:"PageClose",pageNumber:pageNumber});case 15:case"end":return _context104.stop()}},_callee103,this)}));return _dispatchPageClose3.apply(this,arguments)}function _initScripting2(){_classPrivateFieldSet(this,_destroyCapability,new _pdfjsLib.PromiseCapability);if(_classPrivateFieldGet(this,_scripting)){throw new Error("#initScripting: Scripting already exists.")}return _classPrivateFieldGet(this,_externalServices).createScripting({sandboxBundleSrc:_classPrivateFieldGet(this,_sandboxBundleSrc)})}function _destroyScripting2(){return _destroyScripting3.apply(this,arguments)}function _destroyScripting3(){_destroyScripting3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee104(){var _classPrivateFieldGet64,_classPrivateFieldGet65;var _classPrivateFieldGet63,_iterator177,_step177,_step177$value,_name17,listener;return _regeneratorRuntime().wrap(function _callee104$(_context105){while(1)switch(_context105.prev=_context105.next){case 0:if(_classPrivateFieldGet(this,_scripting)){_context105.next=4;break}_classPrivateFieldSet(this,_pdfDocument,null);(_classPrivateFieldGet63=_classPrivateFieldGet(this,_destroyCapability))===null||_classPrivateFieldGet63===void 0||_classPrivateFieldGet63.resolve();return _context105.abrupt("return");case 4:if(!_classPrivateFieldGet(this,_closeCapability)){_context105.next=8;break}_context105.next=7;return Promise.race([_classPrivateFieldGet(this,_closeCapability).promise,new Promise(function(resolve){setTimeout(resolve,1000)})])["catch"](function(){});case 7:_classPrivateFieldSet(this,_closeCapability,null);case 8:_classPrivateFieldSet(this,_pdfDocument,null);_context105.prev=9;_context105.next=12;return _classPrivateFieldGet(this,_scripting).destroySandbox();case 12:_context105.next=16;break;case 14:_context105.prev=14;_context105.t0=_context105["catch"](9);case 16:(_classPrivateFieldGet64=_classPrivateFieldGet(this,_willPrintCapability))===null||_classPrivateFieldGet64===void 0||_classPrivateFieldGet64.reject(new Error("Scripting destroyed."));_classPrivateFieldSet(this,_willPrintCapability,null);_iterator177=_createForOfIteratorHelper(this._internalEvents);try{for(_iterator177.s();!(_step177=_iterator177.n()).done;){_step177$value=_slicedToArray2(_step177.value,2),_name17=_step177$value[0],listener=_step177$value[1];_classPrivateFieldGet(this,_eventBus)._off(_name17,listener)}}catch(err){_iterator177.e(err)}finally{_iterator177.f()}this._internalEvents.clear();this._pageOpenPending.clear();this._visitedPages.clear();_classPrivateFieldSet(this,_scripting,null);_classPrivateFieldSet(this,_ready,false);(_classPrivateFieldGet65=_classPrivateFieldGet(this,_destroyCapability))===null||_classPrivateFieldGet65===void 0||_classPrivateFieldGet65.resolve();case 26:case"end":return _context105.stop()}},_callee104,this,[[9,14]])}));return _destroyScripting3.apply(this,arguments)}exports.PDFScriptingManager=PDFScriptingManager}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFSinglePageViewer=void 0;var _ui_utils=__w_pdfjs_require__(2);var _pdf_viewer=__w_pdfjs_require__(25);var PDFSinglePageViewer=function(_pdf_viewer$PDFViewer){_inherits2(PDFSinglePageViewer,_pdf_viewer$PDFViewer);var _super68=_createSuper(PDFSinglePageViewer);function PDFSinglePageViewer(){_classCallCheck2(this,PDFSinglePageViewer);return _super68.apply(this,arguments)}_createClass2(PDFSinglePageViewer,[{key:"_resetView",value:function _resetView(){_get5(_getPrototypeOf(PDFSinglePageViewer.prototype),"_resetView",this).call(this);this._scrollMode=_ui_utils.ScrollMode.PAGE;this._spreadMode=_ui_utils.SpreadMode.NONE}},{key:"scrollMode",set:function set(mode){}},{key:"_updateScrollMode",value:function _updateScrollMode(){}},{key:"spreadMode",set:function set(mode){}},{key:"_updateSpreadMode",value:function _updateSpreadMode(){}}]);return PDFSinglePageViewer}(_pdf_viewer.PDFViewer);exports.PDFSinglePageViewer=PDFSinglePageViewer}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){var _Symbol$iterator;Object.defineProperty(exports,"__esModule",{value:true});exports.PagesCountLimit=exports.PDFViewer=exports.PDFPageViewBuffer=void 0;var _pdfjsLib=__w_pdfjs_require__(4);var _ui_utils=__w_pdfjs_require__(2);var _l10n_utils=__w_pdfjs_require__(7);var _pdf_page_view=__w_pdfjs_require__(13);var _pdf_rendering_queue=__w_pdfjs_require__(26);var _pdf_link_service=__w_pdfjs_require__(5);var DEFAULT_CACHE_SIZE=10;var PagesCountLimit={FORCE_SCROLL_MODE_PAGE:15000,FORCE_LAZY_PAGE_INIT:7500,PAUSE_EAGER_PAGE_INIT:250};exports.PagesCountLimit=PagesCountLimit;function isValidAnnotationEditorMode(mode){return Object.values(_pdfjsLib.AnnotationEditorType).includes(mode)&&mode!==_pdfjsLib.AnnotationEditorType.DISABLE}var _buf=new WeakMap;var _size=new WeakMap;var _destroyFirstView=new WeakSet;_Symbol$iterator=Symbol.iterator;var PDFPageViewBuffer=function(){function PDFPageViewBuffer(size){_classCallCheck2(this,PDFPageViewBuffer);_classPrivateMethodInitSpec(this,_destroyFirstView);_classPrivateFieldInitSpec(this,_buf,{writable:true,value:new Set});_classPrivateFieldInitSpec(this,_size,{writable:true,value:0});_classPrivateFieldSet(this,_size,size)}_createClass2(PDFPageViewBuffer,[{key:"push",value:function push(view){var buf=_classPrivateFieldGet(this,_buf);if(buf.has(view)){buf["delete"](view)}buf.add(view);if(buf.size>_classPrivateFieldGet(this,_size)){_classPrivateMethodGet(this,_destroyFirstView,_destroyFirstView2).call(this)}}},{key:"resize",value:function resize(newSize){var idsToKeep=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classPrivateFieldSet(this,_size,newSize);var buf=_classPrivateFieldGet(this,_buf);if(idsToKeep){var ii=buf.size;var _i81=1;var _iterator178=_createForOfIteratorHelper(buf),_step178;try{for(_iterator178.s();!(_step178=_iterator178.n()).done;){var view=_step178.value;if(idsToKeep.has(view.id)){buf["delete"](view);buf.add(view)}if(++_i81>ii){break}}}catch(err){_iterator178.e(err)}finally{_iterator178.f()}}while(buf.size>_classPrivateFieldGet(this,_size)){_classPrivateMethodGet(this,_destroyFirstView,_destroyFirstView2).call(this)}}},{key:"has",value:function has(view){return _classPrivateFieldGet(this,_buf).has(view)}},{key:_Symbol$iterator,value:function value(){return _classPrivateFieldGet(this,_buf).keys()}}]);return PDFPageViewBuffer}();function _destroyFirstView2(){var firstView=_classPrivateFieldGet(this,_buf).keys().next().value;firstView===null||firstView===void 0||firstView.destroy();_classPrivateFieldGet(this,_buf)["delete"](firstView)}exports.PDFPageViewBuffer=PDFPageViewBuffer;var _buffer=new WeakMap;var _altTextManager2=new WeakMap;var _annotationEditorMode=new WeakMap;var _annotationEditorUIManager=new WeakMap;var _annotationMode2=new WeakMap;var _containerTopLeft=new WeakMap;var _copyCallbackBound=new WeakMap;var _enablePermissions2=new WeakMap;var _getAllTextInProgress=new WeakMap;var _hiddenCopyElement=new WeakMap;var _interruptCopyCondition=new WeakMap;var _previousContainerHeight=new WeakMap;var _resizeObserver=new WeakMap;var _scrollModePageState=new WeakMap;var _onVisibilityChange=new WeakMap;var _scaleTimeoutId=new WeakMap;var _textLayerMode2=new WeakMap;var _layerProperties2=new WeakSet;var _initializePermissions=new WeakSet;var _onePageRenderedOrForceFetch=new WeakSet;var _copyCallback=new WeakSet;var _ensurePageViewVisible=new WeakSet;var _scrollIntoView=new WeakSet;var _isSameScale=new WeakSet;var _setScaleUpdatePages=new WeakSet;var _pageWidthScaleFactor=new WeakMap;var _setScale=new WeakSet;var _resetCurrentPageView=new WeakSet;var _ensurePdfPageLoaded=new WeakSet;var _getScrollAhead=new WeakSet;var _updateContainerHeightCss=new WeakSet;var _resizeObserverCallback=new WeakSet;var PDFViewer=function(){function PDFViewer(_options2){var _this$container,_this$viewer,_this163=this,_options2$textLayerMo,_options2$annotationM,_options2$annotationE,_options2$isOffscreen;_classCallCheck2(this,PDFViewer);_classPrivateMethodInitSpec(this,_resizeObserverCallback);_classPrivateMethodInitSpec(this,_updateContainerHeightCss);_classPrivateMethodInitSpec(this,_getScrollAhead);_classPrivateMethodInitSpec(this,_ensurePdfPageLoaded);_classPrivateMethodInitSpec(this,_resetCurrentPageView);_classPrivateMethodInitSpec(this,_setScale);_classPrivateFieldInitSpec(this,_pageWidthScaleFactor,{get:_get_pageWidthScaleFactor,set:void 0});_classPrivateMethodInitSpec(this,_setScaleUpdatePages);_classPrivateMethodInitSpec(this,_isSameScale);_classPrivateMethodInitSpec(this,_scrollIntoView);_classPrivateMethodInitSpec(this,_ensurePageViewVisible);_classPrivateMethodInitSpec(this,_copyCallback);_classPrivateMethodInitSpec(this,_onePageRenderedOrForceFetch);_classPrivateMethodInitSpec(this,_initializePermissions);_classPrivateMethodInitSpec(this,_layerProperties2);_classPrivateFieldInitSpec(this,_buffer,{writable:true,value:null});_classPrivateFieldInitSpec(this,_altTextManager2,{writable:true,value:null});_classPrivateFieldInitSpec(this,_annotationEditorMode,{writable:true,value:_pdfjsLib.AnnotationEditorType.NONE});_classPrivateFieldInitSpec(this,_annotationEditorUIManager,{writable:true,value:null});_classPrivateFieldInitSpec(this,_annotationMode2,{writable:true,value:_pdfjsLib.AnnotationMode.ENABLE_FORMS});_classPrivateFieldInitSpec(this,_containerTopLeft,{writable:true,value:null});_classPrivateFieldInitSpec(this,_copyCallbackBound,{writable:true,value:null});_classPrivateFieldInitSpec(this,_enablePermissions2,{writable:true,value:false});_classPrivateFieldInitSpec(this,_getAllTextInProgress,{writable:true,value:false});_classPrivateFieldInitSpec(this,_hiddenCopyElement,{writable:true,value:null});_classPrivateFieldInitSpec(this,_interruptCopyCondition,{writable:true,value:false});_classPrivateFieldInitSpec(this,_previousContainerHeight,{writable:true,value:0});_classPrivateFieldInitSpec(this,_resizeObserver,{writable:true,value:new ResizeObserver(_classPrivateMethodGet(this,_resizeObserverCallback,_resizeObserverCallback2).bind(this))});_classPrivateFieldInitSpec(this,_scrollModePageState,{writable:true,value:null});_classPrivateFieldInitSpec(this,_onVisibilityChange,{writable:true,value:null});_classPrivateFieldInitSpec(this,_scaleTimeoutId,{writable:true,value:null});_classPrivateFieldInitSpec(this,_textLayerMode2,{writable:true,value:_ui_utils.TextLayerMode.ENABLE});var viewerVersion="3.11.174";if(_pdfjsLib.version!==viewerVersion){throw new Error("The API version \"".concat(_pdfjsLib.version,"\" does not match the Viewer version \"").concat(viewerVersion,"\"."))}this.container=_options2.container;this.viewer=_options2.viewer||_options2.container.firstElementChild;if(((_this$container=this.container)===null||_this$container===void 0?void 0:_this$container.tagName)!=="DIV"||((_this$viewer=this.viewer)===null||_this$viewer===void 0?void 0:_this$viewer.tagName)!=="DIV"){throw new Error("Invalid `container` and/or `viewer` option.")}if(this.container.offsetParent&&getComputedStyle(this.container).position!=="absolute"){throw new Error("The `container` must be absolutely positioned.")}_classPrivateFieldGet(this,_resizeObserver).observe(this.container);this.eventBus=_options2.eventBus;this.linkService=_options2.linkService||new _pdf_link_service.SimpleLinkService;this.downloadManager=_options2.downloadManager||null;this.findController=_options2.findController||null;_classPrivateFieldSet(this,_altTextManager2,_options2.altTextManager||null);if(this.findController){this.findController.onIsPageVisible=function(pageNumber){return _this163._getVisiblePages().ids.has(pageNumber)}}this._scriptingManager=_options2.scriptingManager||null;_classPrivateFieldSet(this,_textLayerMode2,(_options2$textLayerMo=_options2.textLayerMode)!==null&&_options2$textLayerMo!==void 0?_options2$textLayerMo:_ui_utils.TextLayerMode.ENABLE);_classPrivateFieldSet(this,_annotationMode2,(_options2$annotationM=_options2.annotationMode)!==null&&_options2$annotationM!==void 0?_options2$annotationM:_pdfjsLib.AnnotationMode.ENABLE_FORMS);_classPrivateFieldSet(this,_annotationEditorMode,(_options2$annotationE=_options2.annotationEditorMode)!==null&&_options2$annotationE!==void 0?_options2$annotationE:_pdfjsLib.AnnotationEditorType.NONE);this.imageResourcesPath=_options2.imageResourcesPath||"";this.enablePrintAutoRotate=_options2.enablePrintAutoRotate||false;this.removePageBorders=_options2.removePageBorders||false;if(_options2.useOnlyCssZoom){console.error("useOnlyCssZoom was removed, please use `maxCanvasPixels = 0` instead.");_options2.maxCanvasPixels=0}this.isOffscreenCanvasSupported=(_options2$isOffscreen=_options2.isOffscreenCanvasSupported)!==null&&_options2$isOffscreen!==void 0?_options2$isOffscreen:true;this.maxCanvasPixels=_options2.maxCanvasPixels;this.l10n=_options2.l10n||_l10n_utils.NullL10n;_classPrivateFieldSet(this,_enablePermissions2,_options2.enablePermissions||false);this.pageColors=_options2.pageColors||null;this.defaultRenderingQueue=!_options2.renderingQueue;if(this.defaultRenderingQueue){this.renderingQueue=new _pdf_rendering_queue.PDFRenderingQueue;this.renderingQueue.setViewer(this)}else{this.renderingQueue=_options2.renderingQueue}this.scroll=(0,_ui_utils.watchScroll)(this.container,this._scrollUpdate.bind(this));this.presentationModeState=_ui_utils.PresentationModeState.UNKNOWN;this._onBeforeDraw=this._onAfterDraw=null;this._resetView();if(this.removePageBorders){this.viewer.classList.add("removePageBorders")}_classPrivateMethodGet(this,_updateContainerHeightCss,_updateContainerHeightCss2).call(this);this.eventBus._on("thumbnailrendered",function(_ref142){var pageNumber=_ref142.pageNumber,pdfPage=_ref142.pdfPage;var pageView=_this163._pages[pageNumber-1];if(!_classPrivateFieldGet(_this163,_buffer).has(pageView)){pdfPage===null||pdfPage===void 0||pdfPage.cleanup()}})}_createClass2(PDFViewer,[{key:"pagesCount",get:function get(){return this._pages.length}},{key:"getPageView",value:function getPageView(index){return this._pages[index]}},{key:"getCachedPageViews",value:function getCachedPageViews(){return new Set(_classPrivateFieldGet(this,_buffer))}},{key:"pageViewsReady",get:function get(){return this._pagesCapability.settled&&this._pages.every(function(pageView){return pageView===null||pageView===void 0?void 0:pageView.pdfPage})}},{key:"renderForms",get:function get(){return _classPrivateFieldGet(this,_annotationMode2)===_pdfjsLib.AnnotationMode.ENABLE_FORMS}},{key:"enableScripting",get:function get(){return!!this._scriptingManager}},{key:"currentPageNumber",get:function get(){return this._currentPageNumber},set:function set(val){if(!Number.isInteger(val)){throw new Error("Invalid page number.")}if(!this.pdfDocument){return}if(!this._setCurrentPageNumber(val,true)){console.error("currentPageNumber: \"".concat(val,"\" is not a valid page."))}}},{key:"_setCurrentPageNumber",value:function _setCurrentPageNumber(val){var _this$_pageLabels,_this$_pageLabels2;var resetCurrentPageView=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._currentPageNumber===val){if(resetCurrentPageView){_classPrivateMethodGet(this,_resetCurrentPageView,_resetCurrentPageView2).call(this)}return true}if(!(0<val&&val<=this.pagesCount)){return false}var previous=this._currentPageNumber;this._currentPageNumber=val;this.eventBus.dispatch("pagechanging",{source:this,pageNumber:val,pageLabel:(_this$_pageLabels=(_this$_pageLabels2=this._pageLabels)===null||_this$_pageLabels2===void 0?void 0:_this$_pageLabels2[val-1])!==null&&_this$_pageLabels!==void 0?_this$_pageLabels:null,previous:previous});if(resetCurrentPageView){_classPrivateMethodGet(this,_resetCurrentPageView,_resetCurrentPageView2).call(this)}return true}},{key:"currentPageLabel",get:function get(){var _this$_pageLabels3,_this$_pageLabels4;return(_this$_pageLabels3=(_this$_pageLabels4=this._pageLabels)===null||_this$_pageLabels4===void 0?void 0:_this$_pageLabels4[this._currentPageNumber-1])!==null&&_this$_pageLabels3!==void 0?_this$_pageLabels3:null},set:function set(val){if(!this.pdfDocument){return}var page=val|0;if(this._pageLabels){var _i82=this._pageLabels.indexOf(val);if(_i82>=0){page=_i82+1}}if(!this._setCurrentPageNumber(page,true)){console.error("currentPageLabel: \"".concat(val,"\" is not a valid page."))}}},{key:"currentScale",get:function get(){return this._currentScale!==_ui_utils.UNKNOWN_SCALE?this._currentScale:_ui_utils.DEFAULT_SCALE},set:function set(val){if(isNaN(val)){throw new Error("Invalid numeric scale.")}if(!this.pdfDocument){return}_classPrivateMethodGet(this,_setScale,_setScale2).call(this,val,{noScroll:false})}},{key:"currentScaleValue",get:function get(){return this._currentScaleValue},set:function set(val){if(!this.pdfDocument){return}_classPrivateMethodGet(this,_setScale,_setScale2).call(this,val,{noScroll:false})}},{key:"pagesRotation",get:function get(){return this._pagesRotation},set:function set(rotation){if(!(0,_ui_utils.isValidRotation)(rotation)){throw new Error("Invalid pages rotation angle.")}if(!this.pdfDocument){return}rotation%=360;if(rotation<0){rotation+=360}if(this._pagesRotation===rotation){return}this._pagesRotation=rotation;var pageNumber=this._currentPageNumber;this.refresh(true,{rotation:rotation});if(this._currentScaleValue){_classPrivateMethodGet(this,_setScale,_setScale2).call(this,this._currentScaleValue,{noScroll:true})}this.eventBus.dispatch("rotationchanging",{source:this,pagesRotation:rotation,pageNumber:pageNumber});if(this.defaultRenderingQueue){this.update()}}},{key:"firstPagePromise",get:function get(){return this.pdfDocument?this._firstPageCapability.promise:null}},{key:"onePageRendered",get:function get(){return this.pdfDocument?this._onePageRenderedCapability.promise:null}},{key:"pagesPromise",get:function get(){return this.pdfDocument?this._pagesCapability.promise:null}},{key:"getAllText",value:function(){var _getAllText=_asyncToGenerator(_regeneratorRuntime().mark(function _callee105(){var texts,buffer,pageNum,pagesCount,page,_yield$page$getTextCo,items,_iterator179,_step179,item;return _regeneratorRuntime().wrap(function _callee105$(_context106){while(1)switch(_context106.prev=_context106.next){case 0:texts=[];buffer=[];pageNum=1,pagesCount=this.pdfDocument.numPages;case 3:if(!(pageNum<=pagesCount)){_context106.next=20;break}if(!_classPrivateFieldGet(this,_interruptCopyCondition)){_context106.next=6;break}return _context106.abrupt("return",null);case 6:buffer.length=0;_context106.next=9;return this.pdfDocument.getPage(pageNum);case 9:page=_context106.sent;_context106.next=12;return page.getTextContent();case 12:_yield$page$getTextCo=_context106.sent;items=_yield$page$getTextCo.items;_iterator179=_createForOfIteratorHelper(items);try{for(_iterator179.s();!(_step179=_iterator179.n()).done;){item=_step179.value;if(item.str){buffer.push(item.str)}if(item.hasEOL){buffer.push("\n")}}}catch(err){_iterator179.e(err)}finally{_iterator179.f()}texts.push((0,_ui_utils.removeNullCharacters)(buffer.join("")));case 17:++pageNum;_context106.next=3;break;case 20:return _context106.abrupt("return",texts.join("\n"));case 21:case"end":return _context106.stop()}},_callee105,this)}));function getAllText(){return _getAllText.apply(this,arguments)}return getAllText}()},{key:"setDocument",value:function setDocument(pdfDocument){var _this164=this;if(this.pdfDocument){var _this$findController,_this$_scriptingManag;this.eventBus.dispatch("pagesdestroy",{source:this});this._cancelRendering();this._resetView();(_this$findController=this.findController)===null||_this$findController===void 0||_this$findController.setDocument(null);(_this$_scriptingManag=this._scriptingManager)===null||_this$_scriptingManag===void 0||_this$_scriptingManag.setDocument(null);if(_classPrivateFieldGet(this,_annotationEditorUIManager)){_classPrivateFieldGet(this,_annotationEditorUIManager).destroy();_classPrivateFieldSet(this,_annotationEditorUIManager,null)}}this.pdfDocument=pdfDocument;if(!pdfDocument){return}var pagesCount=pdfDocument.numPages;var firstPagePromise=pdfDocument.getPage(1);var optionalContentConfigPromise=pdfDocument.getOptionalContentConfig();var permissionsPromise=_classPrivateFieldGet(this,_enablePermissions2)?pdfDocument.getPermissions():Promise.resolve();if(pagesCount>PagesCountLimit.FORCE_SCROLL_MODE_PAGE){console.warn("Forcing PAGE-scrolling for performance reasons, given the length of the document.");var mode=this._scrollMode=_ui_utils.ScrollMode.PAGE;this.eventBus.dispatch("scrollmodechanged",{source:this,mode:mode})}this._pagesCapability.promise.then(function(){_this164.eventBus.dispatch("pagesloaded",{source:_this164,pagesCount:pagesCount})},function(){});this._onBeforeDraw=function(evt){var pageView=_this164._pages[evt.pageNumber-1];if(!pageView){return}_classPrivateFieldGet(_this164,_buffer).push(pageView)};this.eventBus._on("pagerender",this._onBeforeDraw);this._onAfterDraw=function(evt){if(evt.cssTransform||_this164._onePageRenderedCapability.settled){return}_this164._onePageRenderedCapability.resolve({timestamp:evt.timestamp});_this164.eventBus._off("pagerendered",_this164._onAfterDraw);_this164._onAfterDraw=null;if(_classPrivateFieldGet(_this164,_onVisibilityChange)){document.removeEventListener("visibilitychange",_classPrivateFieldGet(_this164,_onVisibilityChange));_classPrivateFieldSet(_this164,_onVisibilityChange,null)}};this.eventBus._on("pagerendered",this._onAfterDraw);Promise.all([firstPagePromise,permissionsPromise]).then(function(_ref143){var _this164$pageColors,_this164$pageColors2;var _ref144=_slicedToArray2(_ref143,2),firstPdfPage=_ref144[0],permissions=_ref144[1];if(pdfDocument!==_this164.pdfDocument){return}_this164._firstPageCapability.resolve(firstPdfPage);_this164._optionalContentConfigPromise=optionalContentConfigPromise;var _classPrivateMethodGe13=_classPrivateMethodGet(_this164,_initializePermissions,_initializePermissions2).call(_this164,permissions),annotationEditorMode=_classPrivateMethodGe13.annotationEditorMode,annotationMode=_classPrivateMethodGe13.annotationMode,textLayerMode=_classPrivateMethodGe13.textLayerMode;if(textLayerMode!==_ui_utils.TextLayerMode.DISABLE){var element=_classPrivateFieldSet(_this164,_hiddenCopyElement,document.createElement("div"));element.id="hiddenCopyElement";_this164.viewer.before(element)}if(annotationEditorMode!==_pdfjsLib.AnnotationEditorType.DISABLE){var _mode2=annotationEditorMode;if(pdfDocument.isPureXfa){console.warn("Warning: XFA-editing is not implemented.")}else if(isValidAnnotationEditorMode(_mode2)){_classPrivateFieldSet(_this164,_annotationEditorUIManager,new _pdfjsLib.AnnotationEditorUIManager(_this164.container,_this164.viewer,_classPrivateFieldGet(_this164,_altTextManager2),_this164.eventBus,pdfDocument,_this164.pageColors));if(_mode2!==_pdfjsLib.AnnotationEditorType.NONE){_classPrivateFieldGet(_this164,_annotationEditorUIManager).updateMode(_mode2)}}else{console.error("Invalid AnnotationEditor mode: ".concat(_mode2))}}var layerProperties=_classPrivateMethodGet(_this164,_layerProperties2,_layerProperties3).bind(_this164);var viewerElement=_this164._scrollMode===_ui_utils.ScrollMode.PAGE?null:_this164.viewer;var scale=_this164.currentScale;var viewport=firstPdfPage.getViewport({scale:scale*_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS});_this164.viewer.style.setProperty("--scale-factor",viewport.scale);if(((_this164$pageColors=_this164.pageColors)===null||_this164$pageColors===void 0?void 0:_this164$pageColors.foreground)==="CanvasText"||((_this164$pageColors2=_this164.pageColors)===null||_this164$pageColors2===void 0?void 0:_this164$pageColors2.background)==="Canvas"){_this164.viewer.style.setProperty("--hcm-highligh-filter",pdfDocument.filterFactory.addHighlightHCMFilter("CanvasText","Canvas","HighlightText","Highlight"))}for(var pageNum=1;pageNum<=pagesCount;++pageNum){var pageView=new _pdf_page_view.PDFPageView({container:viewerElement,eventBus:_this164.eventBus,id:pageNum,scale:scale,defaultViewport:viewport.clone(),optionalContentConfigPromise:optionalContentConfigPromise,renderingQueue:_this164.renderingQueue,textLayerMode:textLayerMode,annotationMode:annotationMode,imageResourcesPath:_this164.imageResourcesPath,isOffscreenCanvasSupported:_this164.isOffscreenCanvasSupported,maxCanvasPixels:_this164.maxCanvasPixels,pageColors:_this164.pageColors,l10n:_this164.l10n,layerProperties:layerProperties});_this164._pages.push(pageView)}var firstPageView=_this164._pages[0];if(firstPageView){firstPageView.setPdfPage(firstPdfPage);_this164.linkService.cachePageRef(1,firstPdfPage.ref)}if(_this164._scrollMode===_ui_utils.ScrollMode.PAGE){_classPrivateMethodGet(_this164,_ensurePageViewVisible,_ensurePageViewVisible2).call(_this164)}else if(_this164._spreadMode!==_ui_utils.SpreadMode.NONE){_this164._updateSpreadMode()}_classPrivateMethodGet(_this164,_onePageRenderedOrForceFetch,_onePageRenderedOrForceFetch2).call(_this164).then(_asyncToGenerator(_regeneratorRuntime().mark(function _callee106(){var _this164$findControll,_this164$_scriptingMa;var getPagesLeft,_loop8,_pageNum;return _regeneratorRuntime().wrap(function _callee106$(_context108){while(1)switch(_context108.prev=_context108.next){case 0:(_this164$findControll=_this164.findController)===null||_this164$findControll===void 0||_this164$findControll.setDocument(pdfDocument);(_this164$_scriptingMa=_this164._scriptingManager)===null||_this164$_scriptingMa===void 0||_this164$_scriptingMa.setDocument(pdfDocument);if(_classPrivateFieldGet(_this164,_hiddenCopyElement)){_classPrivateFieldSet(_this164,_copyCallbackBound,_classPrivateMethodGet(_this164,_copyCallback,_copyCallback2).bind(_this164,textLayerMode));document.addEventListener("copy",_classPrivateFieldGet(_this164,_copyCallbackBound))}if(_classPrivateFieldGet(_this164,_annotationEditorUIManager)){_this164.eventBus.dispatch("annotationeditormodechanged",{source:_this164,mode:_classPrivateFieldGet(_this164,_annotationEditorMode)})}if(!(pdfDocument.loadingParams.disableAutoFetch||pagesCount>PagesCountLimit.FORCE_LAZY_PAGE_INIT)){_context108.next=7;break}_this164._pagesCapability.resolve();return _context108.abrupt("return");case 7:getPagesLeft=pagesCount-1;if(!(getPagesLeft<=0)){_context108.next=11;break}_this164._pagesCapability.resolve();return _context108.abrupt("return");case 11:_loop8=_regeneratorRuntime().mark(function _loop8(_pageNum){var promise;return _regeneratorRuntime().wrap(function _loop8$(_context107){while(1)switch(_context107.prev=_context107.next){case 0:promise=pdfDocument.getPage(_pageNum).then(function(pdfPage){var pageView=_this164._pages[_pageNum-1];if(!pageView.pdfPage){pageView.setPdfPage(pdfPage)}_this164.linkService.cachePageRef(_pageNum,pdfPage.ref);if(--getPagesLeft===0){_this164._pagesCapability.resolve()}},function(reason){console.error("Unable to get page ".concat(_pageNum," to initialize viewer"),reason);if(--getPagesLeft===0){_this164._pagesCapability.resolve()}});if(!(_pageNum%PagesCountLimit.PAUSE_EAGER_PAGE_INIT===0)){_context107.next=4;break}_context107.next=4;return promise;case 4:case"end":return _context107.stop()}},_loop8)});_pageNum=2;case 13:if(!(_pageNum<=pagesCount)){_context108.next=18;break}return _context108.delegateYield(_loop8(_pageNum),"t0",15);case 15:++_pageNum;_context108.next=13;break;case 18:case"end":return _context108.stop()}},_callee106)})));_this164.eventBus.dispatch("pagesinit",{source:_this164});pdfDocument.getMetadata().then(function(_ref146){var info=_ref146.info;if(pdfDocument!==_this164.pdfDocument){return}if(info.Language){_this164.viewer.lang=info.Language}});if(_this164.defaultRenderingQueue){_this164.update()}})["catch"](function(reason){console.error("Unable to initialize viewer",reason);_this164._pagesCapability.reject(reason)})}},{key:"setPageLabels",value:function setPageLabels(labels){if(!this.pdfDocument){return}if(!labels){this._pageLabels=null}else if(!(Array.isArray(labels)&&this.pdfDocument.numPages===labels.length)){this._pageLabels=null;console.error("setPageLabels: Invalid page labels.")}else{this._pageLabels=labels}for(var _i83=0,ii=this._pages.length;_i83<ii;_i83++){var _this$_pageLabels$_i,_this$_pageLabels5;this._pages[_i83].setPageLabel((_this$_pageLabels$_i=(_this$_pageLabels5=this._pageLabels)===null||_this$_pageLabels5===void 0?void 0:_this$_pageLabels5[_i83])!==null&&_this$_pageLabels$_i!==void 0?_this$_pageLabels$_i:null)}}},{key:"_resetView",value:function _resetView(){this._pages=[];this._currentPageNumber=1;this._currentScale=_ui_utils.UNKNOWN_SCALE;this._currentScaleValue=null;this._pageLabels=null;_classPrivateFieldSet(this,_buffer,new PDFPageViewBuffer(DEFAULT_CACHE_SIZE));this._location=null;this._pagesRotation=0;this._optionalContentConfigPromise=null;this._firstPageCapability=new _pdfjsLib.PromiseCapability;this._onePageRenderedCapability=new _pdfjsLib.PromiseCapability;this._pagesCapability=new _pdfjsLib.PromiseCapability;this._scrollMode=_ui_utils.ScrollMode.VERTICAL;this._previousScrollMode=_ui_utils.ScrollMode.UNKNOWN;this._spreadMode=_ui_utils.SpreadMode.NONE;_classPrivateFieldSet(this,_scrollModePageState,{previousPageNumber:1,scrollDown:true,pages:[]});if(this._onBeforeDraw){this.eventBus._off("pagerender",this._onBeforeDraw);this._onBeforeDraw=null}if(this._onAfterDraw){this.eventBus._off("pagerendered",this._onAfterDraw);this._onAfterDraw=null}if(_classPrivateFieldGet(this,_onVisibilityChange)){document.removeEventListener("visibilitychange",_classPrivateFieldGet(this,_onVisibilityChange));_classPrivateFieldSet(this,_onVisibilityChange,null)}this.viewer.textContent="";this._updateScrollMode();this.viewer.removeAttribute("lang");if(_classPrivateFieldGet(this,_hiddenCopyElement)){document.removeEventListener("copy",_classPrivateFieldGet(this,_copyCallbackBound));_classPrivateFieldSet(this,_copyCallbackBound,null);_classPrivateFieldGet(this,_hiddenCopyElement).remove();_classPrivateFieldSet(this,_hiddenCopyElement,null)}}},{key:"_scrollUpdate",value:function _scrollUpdate(){if(this.pagesCount===0){return}this.update()}},{key:"pageLabelToPageNumber",value:function pageLabelToPageNumber(label){if(!this._pageLabels){return null}var i=this._pageLabels.indexOf(label);if(i<0){return null}return i+1}},{key:"scrollPageIntoView",value:function scrollPageIntoView(_ref147){var pageNumber=_ref147.pageNumber,_ref147$destArray=_ref147.destArray,destArray=_ref147$destArray===void 0?null:_ref147$destArray,_ref147$allowNegative=_ref147.allowNegativeOffset,allowNegativeOffset=_ref147$allowNegative===void 0?false:_ref147$allowNegative,_ref147$ignoreDestina=_ref147.ignoreDestinationZoom,ignoreDestinationZoom=_ref147$ignoreDestina===void 0?false:_ref147$ignoreDestina;if(!this.pdfDocument){return}var pageView=Number.isInteger(pageNumber)&&this._pages[pageNumber-1];if(!pageView){console.error("scrollPageIntoView: \"".concat(pageNumber,"\" is not a valid pageNumber parameter."));return}if(this.isInPresentationMode||!destArray){this._setCurrentPageNumber(pageNumber,true);return}var x=0,y=0;var width=0,height=0,widthScale,heightScale;var changeOrientation=pageView.rotation%180!==0;var pageWidth=(changeOrientation?pageView.height:pageView.width)/pageView.scale/_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS;var pageHeight=(changeOrientation?pageView.width:pageView.height)/pageView.scale/_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS;var scale=0;switch(destArray[1].name){case"XYZ":x=destArray[2];y=destArray[3];scale=destArray[4];x=x!==null?x:0;y=y!==null?y:pageHeight;break;case"Fit":case"FitB":scale="page-fit";break;case"FitH":case"FitBH":y=destArray[2];scale="page-width";if(y===null&&this._location){x=this._location.left;y=this._location.top}else if(typeof y!=="number"||y<0){y=pageHeight}break;case"FitV":case"FitBV":x=destArray[2];width=pageWidth;height=pageHeight;scale="page-height";break;case"FitR":x=destArray[2];y=destArray[3];width=destArray[4]-x;height=destArray[5]-y;var hPadding=_ui_utils.SCROLLBAR_PADDING,vPadding=_ui_utils.VERTICAL_PADDING;if(this.removePageBorders){hPadding=vPadding=0}widthScale=(this.container.clientWidth-hPadding)/width/_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS;heightScale=(this.container.clientHeight-vPadding)/height/_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS;scale=Math.min(Math.abs(widthScale),Math.abs(heightScale));break;default:console.error("scrollPageIntoView: \"".concat(destArray[1].name,"\" is not a valid destination type."));return}if(!ignoreDestinationZoom){if(scale&&scale!==this._currentScale){this.currentScaleValue=scale}else if(this._currentScale===_ui_utils.UNKNOWN_SCALE){this.currentScaleValue=_ui_utils.DEFAULT_SCALE_VALUE}}if(scale==="page-fit"&&!destArray[4]){_classPrivateMethodGet(this,_scrollIntoView,_scrollIntoView2).call(this,pageView);return}var boundingRect=[pageView.viewport.convertToViewportPoint(x,y),pageView.viewport.convertToViewportPoint(x+width,y+height)];var left=Math.min(boundingRect[0][0],boundingRect[1][0]);var top=Math.min(boundingRect[0][1],boundingRect[1][1]);if(!allowNegativeOffset){left=Math.max(left,0);top=Math.max(top,0)}_classPrivateMethodGet(this,_scrollIntoView,_scrollIntoView2).call(this,pageView,{left:left,top:top})}},{key:"_updateLocation",value:function _updateLocation(firstPage){var currentScale=this._currentScale;var currentScaleValue=this._currentScaleValue;var normalizedScaleValue=parseFloat(currentScaleValue)===currentScale?Math.round(currentScale*10000)/100:currentScaleValue;var pageNumber=firstPage.id;var currentPageView=this._pages[pageNumber-1];var container=this.container;var topLeft=currentPageView.getPagePoint(container.scrollLeft-firstPage.x,container.scrollTop-firstPage.y);var intLeft=Math.round(topLeft[0]);var intTop=Math.round(topLeft[1]);var pdfOpenParams="#page=".concat(pageNumber);if(!this.isInPresentationMode){pdfOpenParams+="&zoom=".concat(normalizedScaleValue,",").concat(intLeft,",").concat(intTop)}this._location={pageNumber:pageNumber,scale:normalizedScaleValue,top:intTop,left:intLeft,rotation:this._pagesRotation,pdfOpenParams:pdfOpenParams}}},{key:"update",value:function update(){var visible=this._getVisiblePages();var visiblePages=visible.views,numVisiblePages=visiblePages.length;if(numVisiblePages===0){return}var newCacheSize=Math.max(DEFAULT_CACHE_SIZE,2*numVisiblePages+1);_classPrivateFieldGet(this,_buffer).resize(newCacheSize,visible.ids);this.renderingQueue.renderHighestPriority(visible);var isSimpleLayout=this._spreadMode===_ui_utils.SpreadMode.NONE&&(this._scrollMode===_ui_utils.ScrollMode.PAGE||this._scrollMode===_ui_utils.ScrollMode.VERTICAL);var currentId=this._currentPageNumber;var stillFullyVisible=false;var _iterator180=_createForOfIteratorHelper(visiblePages),_step180;try{for(_iterator180.s();!(_step180=_iterator180.n()).done;){var page=_step180.value;if(page.percent<100){break}if(page.id===currentId&&isSimpleLayout){stillFullyVisible=true;break}}}catch(err){_iterator180.e(err)}finally{_iterator180.f()}this._setCurrentPageNumber(stillFullyVisible?currentId:visiblePages[0].id);this._updateLocation(visible.first);this.eventBus.dispatch("updateviewarea",{source:this,location:this._location})}},{key:"containsElement",value:function containsElement(element){return this.container.contains(element)}},{key:"focus",value:function focus(){this.container.focus()}},{key:"_isContainerRtl",get:function get(){return getComputedStyle(this.container).direction==="rtl"}},{key:"isInPresentationMode",get:function get(){return this.presentationModeState===_ui_utils.PresentationModeState.FULLSCREEN}},{key:"isChangingPresentationMode",get:function get(){return this.presentationModeState===_ui_utils.PresentationModeState.CHANGING}},{key:"isHorizontalScrollbarEnabled",get:function get(){return this.isInPresentationMode?false:this.container.scrollWidth>this.container.clientWidth}},{key:"isVerticalScrollbarEnabled",get:function get(){return this.isInPresentationMode?false:this.container.scrollHeight>this.container.clientHeight}},{key:"_getVisiblePages",value:function _getVisiblePages(){var views=this._scrollMode===_ui_utils.ScrollMode.PAGE?_classPrivateFieldGet(this,_scrollModePageState).pages:this._pages,horizontal=this._scrollMode===_ui_utils.ScrollMode.HORIZONTAL,rtl=horizontal&&this._isContainerRtl;return(0,_ui_utils.getVisibleElements)({scrollEl:this.container,views:views,sortByVisibility:true,horizontal:horizontal,rtl:rtl})}},{key:"cleanup",value:function cleanup(){var _iterator181=_createForOfIteratorHelper(this._pages),_step181;try{for(_iterator181.s();!(_step181=_iterator181.n()).done;){var pageView=_step181.value;if(pageView.renderingState!==_ui_utils.RenderingStates.FINISHED){pageView.reset()}}}catch(err){_iterator181.e(err)}finally{_iterator181.f()}}},{key:"_cancelRendering",value:function _cancelRendering(){var _iterator182=_createForOfIteratorHelper(this._pages),_step182;try{for(_iterator182.s();!(_step182=_iterator182.n()).done;){var pageView=_step182.value;pageView.cancelRendering()}}catch(err){_iterator182.e(err)}finally{_iterator182.f()}}},{key:"forceRendering",value:function forceRendering(currentlyVisiblePages){var _this165=this;var visiblePages=currentlyVisiblePages||this._getVisiblePages();var scrollAhead=_classPrivateMethodGet(this,_getScrollAhead,_getScrollAhead2).call(this,visiblePages);var preRenderExtra=this._spreadMode!==_ui_utils.SpreadMode.NONE&&this._scrollMode!==_ui_utils.ScrollMode.HORIZONTAL;var pageView=this.renderingQueue.getHighestPriority(visiblePages,this._pages,scrollAhead,preRenderExtra);if(pageView){_classPrivateMethodGet(this,_ensurePdfPageLoaded,_ensurePdfPageLoaded2).call(this,pageView).then(function(){_this165.renderingQueue.renderView(pageView)});return true}return false}},{key:"hasEqualPageSizes",get:function get(){var firstPageView=this._pages[0];for(var _i84=1,ii=this._pages.length;_i84<ii;++_i84){var pageView=this._pages[_i84];if(pageView.width!==firstPageView.width||pageView.height!==firstPageView.height){return false}}return true}},{key:"getPagesOverview",value:function getPagesOverview(){var _this166=this;var initialOrientation;return this._pages.map(function(pageView){var viewport=pageView.pdfPage.getViewport({scale:1});var orientation=(0,_ui_utils.isPortraitOrientation)(viewport);if(initialOrientation===undefined){initialOrientation=orientation}else if(_this166.enablePrintAutoRotate&&orientation!==initialOrientation){return{width:viewport.height,height:viewport.width,rotation:(viewport.rotation-90)%360}}return{width:viewport.width,height:viewport.height,rotation:viewport.rotation}})}},{key:"optionalContentConfigPromise",get:function get(){if(!this.pdfDocument){return Promise.resolve(null)}if(!this._optionalContentConfigPromise){console.error("optionalContentConfigPromise: Not initialized yet.");return this.pdfDocument.getOptionalContentConfig()}return this._optionalContentConfigPromise},set:function set(promise){if(!(promise instanceof Promise)){throw new Error("Invalid optionalContentConfigPromise: ".concat(promise))}if(!this.pdfDocument){return}if(!this._optionalContentConfigPromise){return}this._optionalContentConfigPromise=promise;this.refresh(false,{optionalContentConfigPromise:promise});this.eventBus.dispatch("optionalcontentconfigchanged",{source:this,promise:promise})}},{key:"scrollMode",get:function get(){return this._scrollMode},set:function set(mode){if(this._scrollMode===mode){return}if(!(0,_ui_utils.isValidScrollMode)(mode)){throw new Error("Invalid scroll mode: ".concat(mode))}if(this.pagesCount>PagesCountLimit.FORCE_SCROLL_MODE_PAGE){return}this._previousScrollMode=this._scrollMode;this._scrollMode=mode;this.eventBus.dispatch("scrollmodechanged",{source:this,mode:mode});this._updateScrollMode(this._currentPageNumber)}},{key:"_updateScrollMode",value:function _updateScrollMode(){var pageNumber=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var scrollMode=this._scrollMode,viewer=this.viewer;viewer.classList.toggle("scrollHorizontal",scrollMode===_ui_utils.ScrollMode.HORIZONTAL);viewer.classList.toggle("scrollWrapped",scrollMode===_ui_utils.ScrollMode.WRAPPED);if(!this.pdfDocument||!pageNumber){return}if(scrollMode===_ui_utils.ScrollMode.PAGE){_classPrivateMethodGet(this,_ensurePageViewVisible,_ensurePageViewVisible2).call(this)}else if(this._previousScrollMode===_ui_utils.ScrollMode.PAGE){this._updateSpreadMode()}if(this._currentScaleValue&&isNaN(this._currentScaleValue)){_classPrivateMethodGet(this,_setScale,_setScale2).call(this,this._currentScaleValue,{noScroll:true})}this._setCurrentPageNumber(pageNumber,true);this.update()}},{key:"spreadMode",get:function get(){return this._spreadMode},set:function set(mode){if(this._spreadMode===mode){return}if(!(0,_ui_utils.isValidSpreadMode)(mode)){throw new Error("Invalid spread mode: ".concat(mode))}this._spreadMode=mode;this.eventBus.dispatch("spreadmodechanged",{source:this,mode:mode});this._updateSpreadMode(this._currentPageNumber)}},{key:"_updateSpreadMode",value:function _updateSpreadMode(){var pageNumber=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this.pdfDocument){return}var viewer=this.viewer,pages=this._pages;if(this._scrollMode===_ui_utils.ScrollMode.PAGE){_classPrivateMethodGet(this,_ensurePageViewVisible,_ensurePageViewVisible2).call(this)}else{viewer.textContent="";if(this._spreadMode===_ui_utils.SpreadMode.NONE){var _iterator183=_createForOfIteratorHelper(this._pages),_step183;try{for(_iterator183.s();!(_step183=_iterator183.n()).done;){var pageView=_step183.value;viewer.append(pageView.div)}}catch(err){_iterator183.e(err)}finally{_iterator183.f()}}else{var parity=this._spreadMode-1;var spread=null;for(var _i85=0,ii=pages.length;_i85<ii;++_i85){if(spread===null){spread=document.createElement("div");spread.className="spread";viewer.append(spread)}else if(_i85%2===parity){spread=spread.cloneNode(false);viewer.append(spread)}spread.append(pages[_i85].div)}}}if(!pageNumber){return}if(this._currentScaleValue&&isNaN(this._currentScaleValue)){_classPrivateMethodGet(this,_setScale,_setScale2).call(this,this._currentScaleValue,{noScroll:true})}this._setCurrentPageNumber(pageNumber,true);this.update()}},{key:"_getPageAdvance",value:function _getPageAdvance(currentPageNumber){var previous=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;switch(this._scrollMode){case _ui_utils.ScrollMode.WRAPPED:{var _this$_getVisiblePage=this._getVisiblePages(),views=_this$_getVisiblePage.views,pageLayout=new Map;var _iterator184=_createForOfIteratorHelper(views),_step184;try{for(_iterator184.s();!(_step184=_iterator184.n()).done;){var _step184$value=_step184.value,_id19=_step184$value.id,y=_step184$value.y,_percent3=_step184$value.percent,widthPercent=_step184$value.widthPercent;if(_percent3===0||widthPercent<100){continue}var yArray=pageLayout.get(y);if(!yArray){pageLayout.set(y,yArray||(yArray=[]))}yArray.push(_id19)}}catch(err){_iterator184.e(err)}finally{_iterator184.f()}var _iterator185=_createForOfIteratorHelper(pageLayout.values()),_step185;try{for(_iterator185.s();!(_step185=_iterator185.n()).done;){var _yArray=_step185.value;var currentIndex=_yArray.indexOf(currentPageNumber);if(currentIndex===-1){continue}var numPages=_yArray.length;if(numPages===1){break}if(previous){for(var _i86=currentIndex-1,ii=0;_i86>=ii;_i86--){var currentId=_yArray[_i86],expectedId=_yArray[_i86+1]-1;if(currentId<expectedId){return currentPageNumber-expectedId}}}else{for(var _i87=currentIndex+1,_ii8=numPages;_i87<_ii8;_i87++){var _currentId=_yArray[_i87],_expectedId=_yArray[_i87-1]+1;if(_currentId>_expectedId){return _expectedId-currentPageNumber}}}if(previous){var firstId=_yArray[0];if(firstId<currentPageNumber){return currentPageNumber-firstId+1}}else{var lastId=_yArray[numPages-1];if(lastId>currentPageNumber){return lastId-currentPageNumber+1}}break}}catch(err){_iterator185.e(err)}finally{_iterator185.f()}break}case _ui_utils.ScrollMode.HORIZONTAL:{break}case _ui_utils.ScrollMode.PAGE:case _ui_utils.ScrollMode.VERTICAL:{if(this._spreadMode===_ui_utils.SpreadMode.NONE){break}var parity=this._spreadMode-1;if(previous&&currentPageNumber%2!==parity){break}else if(!previous&&currentPageNumber%2===parity){break}var _this$_getVisiblePage2=this._getVisiblePages(),_views=_this$_getVisiblePage2.views,_expectedId2=previous?currentPageNumber-1:currentPageNumber+1;var _iterator186=_createForOfIteratorHelper(_views),_step186;try{for(_iterator186.s();!(_step186=_iterator186.n()).done;){var _step186$value=_step186.value,_id20=_step186$value.id,_percent4=_step186$value.percent,_widthPercent=_step186$value.widthPercent;if(_id20!==_expectedId2){continue}if(_percent4>0&&_widthPercent===100){return 2}break}}catch(err){_iterator186.e(err)}finally{_iterator186.f()}break}}return 1}},{key:"nextPage",value:function nextPage(){var currentPageNumber=this._currentPageNumber,pagesCount=this.pagesCount;if(currentPageNumber>=pagesCount){return false}var advance=this._getPageAdvance(currentPageNumber,false)||1;this.currentPageNumber=Math.min(currentPageNumber+advance,pagesCount);return true}},{key:"previousPage",value:function previousPage(){var currentPageNumber=this._currentPageNumber;if(currentPageNumber<=1){return false}var advance=this._getPageAdvance(currentPageNumber,true)||1;this.currentPageNumber=Math.max(currentPageNumber-advance,1);return true}},{key:"increaseScale",value:function increaseScale(){var _ref148=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},drawingDelay=_ref148.drawingDelay,scaleFactor=_ref148.scaleFactor,steps=_ref148.steps;if(!this.pdfDocument){return}var newScale=this._currentScale;if(scaleFactor>1){newScale=Math.round(newScale*scaleFactor*100)/100}else{var _steps;(_steps=steps)!==null&&_steps!==void 0?_steps:steps=1;do{newScale=Math.ceil((newScale*_ui_utils.DEFAULT_SCALE_DELTA).toFixed(2)*10)/10}while(--steps>0&&newScale<_ui_utils.MAX_SCALE)}_classPrivateMethodGet(this,_setScale,_setScale2).call(this,Math.min(_ui_utils.MAX_SCALE,newScale),{noScroll:false,drawingDelay:drawingDelay})}},{key:"decreaseScale",value:function decreaseScale(){var _ref149=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},drawingDelay=_ref149.drawingDelay,scaleFactor=_ref149.scaleFactor,steps=_ref149.steps;if(!this.pdfDocument){return}var newScale=this._currentScale;if(scaleFactor>0&&scaleFactor<1){newScale=Math.round(newScale*scaleFactor*100)/100}else{var _steps2;(_steps2=steps)!==null&&_steps2!==void 0?_steps2:steps=1;do{newScale=Math.floor((newScale/_ui_utils.DEFAULT_SCALE_DELTA).toFixed(2)*10)/10}while(--steps>0&&newScale>_ui_utils.MIN_SCALE)}_classPrivateMethodGet(this,_setScale,_setScale2).call(this,Math.max(_ui_utils.MIN_SCALE,newScale),{noScroll:false,drawingDelay:drawingDelay})}},{key:"containerTopLeft",get:function get(){return _classPrivateFieldGet(this,_containerTopLeft)||_classPrivateFieldSet(this,_containerTopLeft,[this.container.offsetTop,this.container.offsetLeft])}},{key:"annotationEditorMode",get:function get(){return _classPrivateFieldGet(this,_annotationEditorUIManager)?_classPrivateFieldGet(this,_annotationEditorMode):_pdfjsLib.AnnotationEditorType.DISABLE},set:function set(_ref150){var mode=_ref150.mode,_ref150$editId=_ref150.editId,editId=_ref150$editId===void 0?null:_ref150$editId;if(!_classPrivateFieldGet(this,_annotationEditorUIManager)){throw new Error("The AnnotationEditor is not enabled.")}if(_classPrivateFieldGet(this,_annotationEditorMode)===mode){return}if(!isValidAnnotationEditorMode(mode)){throw new Error("Invalid AnnotationEditor mode: ".concat(mode))}if(!this.pdfDocument){return}_classPrivateFieldSet(this,_annotationEditorMode,mode);this.eventBus.dispatch("annotationeditormodechanged",{source:this,mode:mode});_classPrivateFieldGet(this,_annotationEditorUIManager).updateMode(mode,editId)}},{key:"annotationEditorParams",set:function set(_ref151){var type=_ref151.type,value=_ref151.value;if(!_classPrivateFieldGet(this,_annotationEditorUIManager)){throw new Error("The AnnotationEditor is not enabled.")}_classPrivateFieldGet(this,_annotationEditorUIManager).updateParams(type,value)}},{key:"refresh",value:function refresh(){var noUpdate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var updateArgs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Object.create(null);if(!this.pdfDocument){return}var _iterator187=_createForOfIteratorHelper(this._pages),_step187;try{for(_iterator187.s();!(_step187=_iterator187.n()).done;){var pageView=_step187.value;pageView.update(updateArgs)}}catch(err){_iterator187.e(err)}finally{_iterator187.f()}if(_classPrivateFieldGet(this,_scaleTimeoutId)!==null){clearTimeout(_classPrivateFieldGet(this,_scaleTimeoutId));_classPrivateFieldSet(this,_scaleTimeoutId,null)}if(!noUpdate){this.update()}}}]);return PDFViewer}();function _layerProperties3(){var self=this;return{get annotationEditorUIManager(){return _classPrivateFieldGet(self,_annotationEditorUIManager)},get annotationStorage(){var _self$pdfDocument;return(_self$pdfDocument=self.pdfDocument)===null||_self$pdfDocument===void 0?void 0:_self$pdfDocument.annotationStorage},get downloadManager(){return self.downloadManager},get enableScripting(){return!!self._scriptingManager},get fieldObjectsPromise(){var _self$pdfDocument2;return(_self$pdfDocument2=self.pdfDocument)===null||_self$pdfDocument2===void 0?void 0:_self$pdfDocument2.getFieldObjects()},get findController(){return self.findController},get hasJSActionsPromise(){var _self$pdfDocument3;return(_self$pdfDocument3=self.pdfDocument)===null||_self$pdfDocument3===void 0?void 0:_self$pdfDocument3.hasJSActions()},get linkService(){return self.linkService}}}function _initializePermissions2(permissions){var params={annotationEditorMode:_classPrivateFieldGet(this,_annotationEditorMode),annotationMode:_classPrivateFieldGet(this,_annotationMode2),textLayerMode:_classPrivateFieldGet(this,_textLayerMode2)};if(!permissions){return params}if(!permissions.includes(_pdfjsLib.PermissionFlag.COPY)&&_classPrivateFieldGet(this,_textLayerMode2)===_ui_utils.TextLayerMode.ENABLE){params.textLayerMode=_ui_utils.TextLayerMode.ENABLE_PERMISSIONS}if(!permissions.includes(_pdfjsLib.PermissionFlag.MODIFY_CONTENTS)){params.annotationEditorMode=_pdfjsLib.AnnotationEditorType.DISABLE}if(!permissions.includes(_pdfjsLib.PermissionFlag.MODIFY_ANNOTATIONS)&&!permissions.includes(_pdfjsLib.PermissionFlag.FILL_INTERACTIVE_FORMS)&&_classPrivateFieldGet(this,_annotationMode2)===_pdfjsLib.AnnotationMode.ENABLE_FORMS){params.annotationMode=_pdfjsLib.AnnotationMode.ENABLE}return params}function _onePageRenderedOrForceFetch2(){var _this167=this;if(document.visibilityState==="hidden"||!this.container.offsetParent||this._getVisiblePages().views.length===0){return Promise.resolve()}var visibilityChangePromise=new Promise(function(resolve){_classPrivateFieldSet(_this167,_onVisibilityChange,function(){if(document.visibilityState!=="hidden"){return}resolve();document.removeEventListener("visibilitychange",_classPrivateFieldGet(_this167,_onVisibilityChange));_classPrivateFieldSet(_this167,_onVisibilityChange,null)});document.addEventListener("visibilitychange",_classPrivateFieldGet(_this167,_onVisibilityChange))});return Promise.race([this._onePageRenderedCapability.promise,visibilityChangePromise])}function _copyCallback2(textLayerMode,event){var _this168=this;var selection=document.getSelection();var focusNode=selection.focusNode,anchorNode=selection.anchorNode;if(anchorNode&&focusNode&&selection.containsNode(_classPrivateFieldGet(this,_hiddenCopyElement))){if(_classPrivateFieldGet(this,_getAllTextInProgress)||textLayerMode===_ui_utils.TextLayerMode.ENABLE_PERMISSIONS){event.preventDefault();event.stopPropagation();return}_classPrivateFieldSet(this,_getAllTextInProgress,true);var savedCursor=this.container.style.cursor;this.container.style.cursor="wait";var interruptCopy=function interruptCopy(ev){return _classPrivateFieldSet(_this168,_interruptCopyCondition,ev.key==="Escape")};window.addEventListener("keydown",interruptCopy);this.getAllText().then(function(){var _ref152=_asyncToGenerator(_regeneratorRuntime().mark(function _callee107(text){return _regeneratorRuntime().wrap(function _callee107$(_context109){while(1)switch(_context109.prev=_context109.next){case 0:if(!(text!==null)){_context109.next=3;break}_context109.next=3;return navigator.clipboard.writeText(text);case 3:case"end":return _context109.stop()}},_callee107)}));return function(_x83){return _ref152.apply(this,arguments)}}())["catch"](function(reason){console.warn("Something goes wrong when extracting the text: ".concat(reason.message))})["finally"](function(){_classPrivateFieldSet(_this168,_getAllTextInProgress,false);_classPrivateFieldSet(_this168,_interruptCopyCondition,false);window.removeEventListener("keydown",interruptCopy);_this168.container.style.cursor=savedCursor});event.preventDefault();event.stopPropagation()}}function _ensurePageViewVisible2(){if(this._scrollMode!==_ui_utils.ScrollMode.PAGE){throw new Error("#ensurePageViewVisible: Invalid scrollMode value.")}var pageNumber=this._currentPageNumber,state=_classPrivateFieldGet(this,_scrollModePageState),viewer=this.viewer;viewer.textContent="";state.pages.length=0;if(this._spreadMode===_ui_utils.SpreadMode.NONE&&!this.isInPresentationMode){var pageView=this._pages[pageNumber-1];viewer.append(pageView.div);state.pages.push(pageView)}else{var pageIndexSet=new Set,parity=this._spreadMode-1;if(parity===-1){pageIndexSet.add(pageNumber-1)}else if(pageNumber%2!==parity){pageIndexSet.add(pageNumber-1);pageIndexSet.add(pageNumber)}else{pageIndexSet.add(pageNumber-2);pageIndexSet.add(pageNumber-1)}var spread=document.createElement("div");spread.className="spread";if(this.isInPresentationMode){var dummyPage=document.createElement("div");dummyPage.className="dummyPage";spread.append(dummyPage)}var _iterator188=_createForOfIteratorHelper(pageIndexSet),_step188;try{for(_iterator188.s();!(_step188=_iterator188.n()).done;){var _i88=_step188.value;var _pageView=this._pages[_i88];if(!_pageView){continue}spread.append(_pageView.div);state.pages.push(_pageView)}}catch(err){_iterator188.e(err)}finally{_iterator188.f()}viewer.append(spread)}state.scrollDown=pageNumber>=state.previousPageNumber;state.previousPageNumber=pageNumber}function _scrollIntoView2(pageView){var pageSpot=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var div=pageView.div,id=pageView.id;if(this._currentPageNumber!==id){this._setCurrentPageNumber(id)}if(this._scrollMode===_ui_utils.ScrollMode.PAGE){_classPrivateMethodGet(this,_ensurePageViewVisible,_ensurePageViewVisible2).call(this);this.update()}if(!pageSpot&&!this.isInPresentationMode){var _left=div.offsetLeft+div.clientLeft,_right=_left+div.clientWidth;var _this$container2=this.container,scrollLeft=_this$container2.scrollLeft,clientWidth=_this$container2.clientWidth;if(this._scrollMode===_ui_utils.ScrollMode.HORIZONTAL||_left<scrollLeft||_right>scrollLeft+clientWidth){pageSpot={left:0,top:0}}}(0,_ui_utils.scrollIntoView)(div,pageSpot);if(!this._currentScaleValue&&this._location){this._location=null}}function _isSameScale2(newScale){return newScale===this._currentScale||Math.abs(newScale-this._currentScale)<1e-15}function _setScaleUpdatePages2(newScale,newValue,_ref153){var _this169=this;var _ref153$noScroll=_ref153.noScroll,noScroll=_ref153$noScroll===void 0?false:_ref153$noScroll,_ref153$preset=_ref153.preset,preset=_ref153$preset===void 0?false:_ref153$preset,_ref153$drawingDelay=_ref153.drawingDelay,drawingDelay=_ref153$drawingDelay===void 0?-1:_ref153$drawingDelay;this._currentScaleValue=newValue.toString();if(_classPrivateMethodGet(this,_isSameScale,_isSameScale2).call(this,newScale)){if(preset){this.eventBus.dispatch("scalechanging",{source:this,scale:newScale,presetValue:newValue})}return}this.viewer.style.setProperty("--scale-factor",newScale*_pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS);var postponeDrawing=drawingDelay>=0&&drawingDelay<1000;this.refresh(true,{scale:newScale,drawingDelay:postponeDrawing?drawingDelay:-1});if(postponeDrawing){_classPrivateFieldSet(this,_scaleTimeoutId,setTimeout(function(){_classPrivateFieldSet(_this169,_scaleTimeoutId,null);_this169.refresh()},drawingDelay))}this._currentScale=newScale;if(!noScroll){var page=this._currentPageNumber,dest;if(this._location&&!(this.isInPresentationMode||this.isChangingPresentationMode)){page=this._location.pageNumber;dest=[null,{name:"XYZ"},this._location.left,this._location.top,null]}this.scrollPageIntoView({pageNumber:page,destArray:dest,allowNegativeOffset:true})}this.eventBus.dispatch("scalechanging",{source:this,scale:newScale,presetValue:preset?newValue:undefined});if(this.defaultRenderingQueue){this.update()}}function _get_pageWidthScaleFactor(){if(this._spreadMode!==_ui_utils.SpreadMode.NONE&&this._scrollMode!==_ui_utils.ScrollMode.HORIZONTAL){return 2}return 1}function _setScale2(value,options){var scale=parseFloat(value);if(scale>0){options.preset=false;_classPrivateMethodGet(this,_setScaleUpdatePages,_setScaleUpdatePages2).call(this,scale,value,options)}else{var currentPage=this._pages[this._currentPageNumber-1];if(!currentPage){return}var hPadding=_ui_utils.SCROLLBAR_PADDING,vPadding=_ui_utils.VERTICAL_PADDING;if(this.isInPresentationMode){hPadding=vPadding=4;if(this._spreadMode!==_ui_utils.SpreadMode.NONE){hPadding*=2}}else if(this.removePageBorders){hPadding=vPadding=0}else if(this._scrollMode===_ui_utils.ScrollMode.HORIZONTAL){var _ref154=[vPadding,hPadding];hPadding=_ref154[0];vPadding=_ref154[1]}var pageWidthScale=(this.container.clientWidth-hPadding)/currentPage.width*currentPage.scale/_classPrivateFieldGet(this,_pageWidthScaleFactor);var pageHeightScale=(this.container.clientHeight-vPadding)/currentPage.height*currentPage.scale;switch(value){case"page-actual":scale=1;break;case"page-width":scale=pageWidthScale;break;case"page-height":scale=pageHeightScale;break;case"page-fit":scale=Math.min(pageWidthScale,pageHeightScale);break;case"auto":var horizontalScale=(0,_ui_utils.isPortraitOrientation)(currentPage)?pageWidthScale:Math.min(pageHeightScale,pageWidthScale);scale=Math.min(_ui_utils.MAX_AUTO_SCALE,horizontalScale);break;default:console.error("#setScale: \"".concat(value,"\" is an unknown zoom value."));return}options.preset=true;_classPrivateMethodGet(this,_setScaleUpdatePages,_setScaleUpdatePages2).call(this,scale,value,options)}}function _resetCurrentPageView2(){var pageView=this._pages[this._currentPageNumber-1];if(this.isInPresentationMode){_classPrivateMethodGet(this,_setScale,_setScale2).call(this,this._currentScaleValue,{noScroll:true})}_classPrivateMethodGet(this,_scrollIntoView,_scrollIntoView2).call(this,pageView)}function _ensurePdfPageLoaded2(_x84){return _ensurePdfPageLoaded3.apply(this,arguments)}function _ensurePdfPageLoaded3(){_ensurePdfPageLoaded3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee108(pageView){var _this$linkService$_ca,_this$linkService,pdfPage;return _regeneratorRuntime().wrap(function _callee108$(_context110){while(1)switch(_context110.prev=_context110.next){case 0:if(!pageView.pdfPage){_context110.next=2;break}return _context110.abrupt("return",pageView.pdfPage);case 2:_context110.prev=2;_context110.next=5;return this.pdfDocument.getPage(pageView.id);case 5:pdfPage=_context110.sent;if(!pageView.pdfPage){pageView.setPdfPage(pdfPage)}if(!((_this$linkService$_ca=(_this$linkService=this.linkService)._cachedPageNumber)!==null&&_this$linkService$_ca!==void 0&&_this$linkService$_ca.call(_this$linkService,pdfPage.ref))){this.linkService.cachePageRef(pageView.id,pdfPage.ref)}return _context110.abrupt("return",pdfPage);case 11:_context110.prev=11;_context110.t0=_context110["catch"](2);console.error("Unable to get page for page view",_context110.t0);return _context110.abrupt("return",null);case 15:case"end":return _context110.stop()}},_callee108,this,[[2,11]])}));return _ensurePdfPageLoaded3.apply(this,arguments)}function _getScrollAhead2(visible){var _visible$first,_visible$last;if(((_visible$first=visible.first)===null||_visible$first===void 0?void 0:_visible$first.id)===1){return true}else if(((_visible$last=visible.last)===null||_visible$last===void 0?void 0:_visible$last.id)===this.pagesCount){return false}switch(this._scrollMode){case _ui_utils.ScrollMode.PAGE:return _classPrivateFieldGet(this,_scrollModePageState).scrollDown;case _ui_utils.ScrollMode.HORIZONTAL:return this.scroll.right}return this.scroll.down}function _updateContainerHeightCss2(){var height=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.container.clientHeight;if(height!==_classPrivateFieldGet(this,_previousContainerHeight)){_classPrivateFieldSet(this,_previousContainerHeight,height);_ui_utils.docStyle.setProperty("--viewer-container-height","".concat(height,"px"))}}function _resizeObserverCallback2(entries){var _iterator189=_createForOfIteratorHelper(entries),_step189;try{for(_iterator189.s();!(_step189=_iterator189.n()).done;){var entry=_step189.value;if(entry.target===this.container){_classPrivateMethodGet(this,_updateContainerHeightCss,_updateContainerHeightCss2).call(this,Math.floor(entry.borderBoxSize[0].blockSize));_classPrivateFieldSet(this,_containerTopLeft,null);break}}}catch(err){_iterator189.e(err)}finally{_iterator189.f()}}exports.PDFViewer=PDFViewer}),(function(__unused_webpack_module,exports,__w_pdfjs_require__){Object.defineProperty(exports,"__esModule",{value:true});exports.PDFRenderingQueue=void 0;var _pdfjsLib=__w_pdfjs_require__(4);var _ui_utils=__w_pdfjs_require__(2);var CLEANUP_TIMEOUT=30000;var PDFRenderingQueue=function(){function PDFRenderingQueue(){var _this170=this;_classCallCheck2(this,PDFRenderingQueue);this.pdfViewer=null;this.pdfThumbnailViewer=null;this.onIdle=null;this.highestPriorityPage=null;this.idleTimeout=null;this.printing=false;this.isThumbnailViewEnabled=false;Object.defineProperty(this,"hasViewer",{value:function value(){return!!_this170.pdfViewer}})}_createClass2(PDFRenderingQueue,[{key:"setViewer",value:function setViewer(pdfViewer){this.pdfViewer=pdfViewer}},{key:"setThumbnailViewer",value:function setThumbnailViewer(pdfThumbnailViewer){this.pdfThumbnailViewer=pdfThumbnailViewer}},{key:"isHighestPriority",value:function isHighestPriority(view){return this.highestPriorityPage===view.renderingId}},{key:"renderHighestPriority",value:function renderHighestPriority(currentlyVisiblePages){var _this$pdfThumbnailVie;if(this.idleTimeout){clearTimeout(this.idleTimeout);this.idleTimeout=null}if(this.pdfViewer.forceRendering(currentlyVisiblePages)){return}if(this.isThumbnailViewEnabled&&(_this$pdfThumbnailVie=this.pdfThumbnailViewer)!==null&&_this$pdfThumbnailVie!==void 0&&_this$pdfThumbnailVie.forceRendering()){return}if(this.printing){return}if(this.onIdle){this.idleTimeout=setTimeout(this.onIdle.bind(this),CLEANUP_TIMEOUT)}}},{key:"getHighestPriority",value:function getHighestPriority(visible,views,scrolledDown){var preRenderExtra=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var visibleViews=visible.views,numVisible=visibleViews.length;if(numVisible===0){return null}for(var _i89=0;_i89<numVisible;_i89++){var view=visibleViews[_i89].view;if(!this.isViewFinished(view)){return view}}var firstId=visible.first.id,lastId=visible.last.id;if(lastId-firstId+1>numVisible){var visibleIds=visible.ids;for(var _i90=1,ii=lastId-firstId;_i90<ii;_i90++){var holeId=scrolledDown?firstId+_i90:lastId-_i90;if(visibleIds.has(holeId)){continue}var holeView=views[holeId-1];if(!this.isViewFinished(holeView)){return holeView}}}var preRenderIndex=scrolledDown?lastId:firstId-2;var preRenderView=views[preRenderIndex];if(preRenderView&&!this.isViewFinished(preRenderView)){return preRenderView}if(preRenderExtra){preRenderIndex+=scrolledDown?1:-1;preRenderView=views[preRenderIndex];if(preRenderView&&!this.isViewFinished(preRenderView)){return preRenderView}}return null}},{key:"isViewFinished",value:function isViewFinished(view){return view.renderingState===_ui_utils.RenderingStates.FINISHED}},{key:"renderView",value:function renderView(view){var _this171=this;switch(view.renderingState){case _ui_utils.RenderingStates.FINISHED:return false;case _ui_utils.RenderingStates.PAUSED:this.highestPriorityPage=view.renderingId;view.resume();break;case _ui_utils.RenderingStates.RUNNING:this.highestPriorityPage=view.renderingId;break;case _ui_utils.RenderingStates.INITIAL:this.highestPriorityPage=view.renderingId;view.draw()["finally"](function(){_this171.renderHighestPriority()})["catch"](function(reason){if(reason instanceof _pdfjsLib.RenderingCancelledException){return}console.error("renderView: \"".concat(reason,"\""))});break}return true}}]);return PDFRenderingQueue}();exports.PDFRenderingQueue=PDFRenderingQueue})];var __webpack_module_cache__={};function __w_pdfjs_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==undefined){return cachedModule.exports}var module=__webpack_module_cache__[moduleId]={exports:{}};__webpack_modules__[moduleId](module,module.exports,__w_pdfjs_require__);return module.exports}var __webpack_exports__={};(function(){var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"AnnotationLayerBuilder",{enumerable:true,get:function get(){return _annotation_layer_builder.AnnotationLayerBuilder}});Object.defineProperty(exports,"DownloadManager",{enumerable:true,get:function get(){return _download_manager.DownloadManager}});Object.defineProperty(exports,"EventBus",{enumerable:true,get:function get(){return _event_utils.EventBus}});Object.defineProperty(exports,"FindState",{enumerable:true,get:function get(){return _pdf_find_controller.FindState}});Object.defineProperty(exports,"GenericL10n",{enumerable:true,get:function get(){return _genericl10n.GenericL10n}});Object.defineProperty(exports,"LinkTarget",{enumerable:true,get:function get(){return _pdf_link_service.LinkTarget}});Object.defineProperty(exports,"NullL10n",{enumerable:true,get:function get(){return _l10n_utils.NullL10n}});Object.defineProperty(exports,"PDFFindController",{enumerable:true,get:function get(){return _pdf_find_controller.PDFFindController}});Object.defineProperty(exports,"PDFHistory",{enumerable:true,get:function get(){return _pdf_history.PDFHistory}});Object.defineProperty(exports,"PDFLinkService",{enumerable:true,get:function get(){return _pdf_link_service.PDFLinkService}});Object.defineProperty(exports,"PDFPageView",{enumerable:true,get:function get(){return _pdf_page_view.PDFPageView}});Object.defineProperty(exports,"PDFScriptingManager",{enumerable:true,get:function get(){return _pdf_scripting_managerComponent.PDFScriptingManager}});Object.defineProperty(exports,"PDFSinglePageViewer",{enumerable:true,get:function get(){return _pdf_single_page_viewer.PDFSinglePageViewer}});Object.defineProperty(exports,"PDFViewer",{enumerable:true,get:function get(){return _pdf_viewer.PDFViewer}});Object.defineProperty(exports,"ProgressBar",{enumerable:true,get:function get(){return _ui_utils.ProgressBar}});Object.defineProperty(exports,"RenderingStates",{enumerable:true,get:function get(){return _ui_utils.RenderingStates}});Object.defineProperty(exports,"ScrollMode",{enumerable:true,get:function get(){return _ui_utils.ScrollMode}});Object.defineProperty(exports,"SimpleLinkService",{enumerable:true,get:function get(){return _pdf_link_service.SimpleLinkService}});Object.defineProperty(exports,"SpreadMode",{enumerable:true,get:function get(){return _ui_utils.SpreadMode}});Object.defineProperty(exports,"StructTreeLayerBuilder",{enumerable:true,get:function get(){return _struct_tree_layer_builder.StructTreeLayerBuilder}});Object.defineProperty(exports,"TextLayerBuilder",{enumerable:true,get:function get(){return _text_layer_builder.TextLayerBuilder}});Object.defineProperty(exports,"XfaLayerBuilder",{enumerable:true,get:function get(){return _xfa_layer_builder.XfaLayerBuilder}});Object.defineProperty(exports,"parseQueryString",{enumerable:true,get:function get(){return _ui_utils.parseQueryString}});var _pdf_find_controller=__w_pdfjs_require__(1);var _pdf_link_service=__w_pdfjs_require__(5);var _ui_utils=__w_pdfjs_require__(2);var _annotation_layer_builder=__w_pdfjs_require__(6);var _download_manager=__w_pdfjs_require__(8);var _event_utils=__w_pdfjs_require__(9);var _genericl10n=__w_pdfjs_require__(10);var _l10n_utils=__w_pdfjs_require__(7);var _pdf_history=__w_pdfjs_require__(12);var _pdf_page_view=__w_pdfjs_require__(13);var _pdf_scripting_managerComponent=__w_pdfjs_require__(21);var _pdf_single_page_viewer=__w_pdfjs_require__(24);var _pdf_viewer=__w_pdfjs_require__(25);var _struct_tree_layer_builder=__w_pdfjs_require__(16);var _text_layer_builder=__w_pdfjs_require__(19);var _xfa_layer_builder=__w_pdfjs_require__(20)})();return __webpack_exports__}()})})(pdf_viewer);var pdf_viewerExports=pdf_viewer.exports;var PdfViewer=function PdfViewer(_ref155){var src=_ref155.src,pdfCMapsUrl=_ref155.pdfCMapsUrl,pdfWorkerUrl=_ref155.pdfWorkerUrl;var pageNumberRef=React.useRef(null);var totalPagesRef=React.useRef(null);var zoomLevelRef=React.useRef(null);var _React$useState5=React.useState(function(){return new pdf_viewerExports.EventBus}),_React$useState6=_slicedToArray2(_React$useState5,2),pdfEventBus=_React$useState6[0],setPdfEventBus=_React$useState6[1];var _React$useState7=React.useState(function(){return new pdf_viewerExports.PDFLinkService({eventBus:pdfEventBus})}),_React$useState8=_slicedToArray2(_React$useState7,2),pdfLinkService=_React$useState8[0],setPdfLinkService=_React$useState8[1];var _React$useState9=React.useState(function(){return new pdf_viewerExports.PDFFindController({eventBus:pdfEventBus,linkService:pdfLinkService})}),_React$useState10=_slicedToArray2(_React$useState9,2),pdfFindController=_React$useState10[0],setPdfFindController=_React$useState10[1];var _React$useState11=React.useState(),_React$useState12=_slicedToArray2(_React$useState11,2),pdfViewer=_React$useState12[0],setPdfViewer=_React$useState12[1];var DEFAULT_SCALE_DELTA=1.1;var MAX_SCALE=3;var MIN_SCALE=0.2;var ENABLE_XFA=true;var CMAP_URL=pdfCMapsUrl||"";var CMAP_PACKED=true;var WORKER_URL=pdfWorkerUrl||"";pdfjsLib.GlobalWorkerOptions.workerSrc=WORKER_URL;var _React$useState13=React.useState(),_React$useState14=_slicedToArray2(_React$useState13,2),viewerContainer=_React$useState14[0],setViewerContainer=_React$useState14[1];var viewerRef=React.useCallback(function(container){setViewerContainer(container)},[]);React.useEffect(function(){var viewer=pdfViewer;if(viewerContainer){if(!pdfViewer&&pdfEventBus){viewer=new pdf_viewerExports.PDFViewer({container:viewerContainer,eventBus:pdfEventBus,linkService:pdfLinkService,findController:pdfFindController});pdfLinkService.setViewer(viewer);setPdfViewer(viewer);pdfEventBus.on("scalechanging",function(){zoomLevelRef.current.value=Math.round(viewer.currentScale*100).toFixed(0)+"%"});pdfEventBus.on("pagechanging",function(){if(pageNumberRef.current){pageNumberRef.current.value=viewer.currentPageNumber.toFixed(0)}});pdfEventBus.on("pagesinit",function(){viewer.currentScaleValue="auto";pageNumberRef.current.value="1";totalPagesRef.current.innerText=viewer.pagesCount.toFixed(0)})}return function(){if(viewer){viewer.cleanup();setPdfViewer(null)}}}},[viewerContainer]);React.useEffect(function(){if(src&&pdfViewer){var loadingTask=pdfjsLib.getDocument({url:src,enableXfa:ENABLE_XFA,cMapUrl:CMAP_URL,cMapPacked:CMAP_PACKED});loadingTask.promise.then(function(doc){pdfViewer.setDocument(doc);pdfLinkService.setDocument(doc,null)});return function(){if(loadingTask){try{loadingTask===null||loadingTask===void 0?void 0:loadingTask.destroy()}catch(e){}try{pdfViewer.setDocument(null)}catch(e){}try{pdfLinkService.setDocument(null,null)}catch(e){}}}}},[src,pdfViewer]);function setScale(scale){if(pdfViewer){pdfViewer.currentScaleValue=typeof scale==="number"?scale.toFixed(2):scale}}function setPage(pageNumber){if(pdfViewer){pdfViewer.currentPageNumber=pageNumber}}function updatePage(){if(pdfViewer&&pageNumberRef.current){var pageNumber=parseInt(pageNumberRef.current.value);if(isNaN(pageNumber)){setPage(pdfViewer.currentPageNumber)}else if(pageNumber>pdfViewer.pagesCount){setPage(pdfViewer.pagesCount)}else if(pageNumber<=0){setPage(1)}else{setPage(pageNumber)}}}function select(e){e.target.setSelectionRange(0,e.target.value.length)}function fitToPage(){setScale("page-fit")}function fitToWidth(){setScale("page-width")}function zoomIn(){console.debug("zoomIn");if(pdfViewer){var newScale=pdfViewer.currentScale;var steps=1;do{newScale=newScale*DEFAULT_SCALE_DELTA;newScale=Math.floor(newScale*10)/10;newScale=Math.min(MAX_SCALE,newScale)}while(--steps>0&&newScale<MAX_SCALE);setScale(newScale)}}function zoomOut(){if(pdfViewer){var newScale=pdfViewer.currentScale;var steps=1;do{newScale=newScale/DEFAULT_SCALE_DELTA;newScale=Math.floor(newScale*10)/10;newScale=Math.max(MIN_SCALE,newScale)}while(--steps>0&&newScale>MIN_SCALE);setScale(newScale)}}function updateZoom(){if(pdfViewer&&zoomLevelRef.current){var zoomValue=parseFloat(zoomLevelRef.current.value.replace("%",""));if(isNaN(zoomValue)){setScale(pdfViewer.currentScale+0.0001)}else{setScale(zoomValue/100)}}}return React.createElement("div",{className:"wy-content-pdf","data-controller":"pdf","data-pdf-url-value":""},React.createElement("div",{className:"wy-toolbars-bottom"},React.createElement("nav",{className:"wy-toolbar wy-toolbar-center"},React.createElement("div",{className:"wy-toolbar-buttons"},React.createElement("input",{type:"text",className:"wy-input",ref:pageNumberRef,onChange:updatePage,onClick:select,"data-pdf-target":"pageNumber"}),React.createElement("span",{className:"wy-toolbar-text"},"/"),React.createElement("span",{className:"wy-toolbar-text",ref:totalPagesRef},"1")),React.createElement("div",{className:"wy-toolbar-buttons"},React.createElement("button",{className:"wy-button wy-button-icon btn-zoom-out",onClick:zoomOut,title:"Zoom out"},React.createElement(UIIcon.UI,{name:"minus"})),React.createElement("input",{type:"text",className:"wy-input",ref:zoomLevelRef,onChange:updateZoom,onClick:select,value:"100%","data-pdf-target":"zoomLevel"}),React.createElement("button",{className:"wy-button wy-button-icon btn-zoom-in",onClick:zoomIn,title:"Zoom in"},React.createElement(UIIcon.UI,{name:"plus"}))),React.createElement("div",{className:"wy-toolbar-buttons"},React.createElement("button",{className:"wy-button wy-button-icon btn-fit-page",onClick:fitToWidth,title:"Fit to width"},React.createElement(UIIcon.UI,{name:"fit-width"})),React.createElement("button",{className:"wy-button wy-button-icon",onClick:fitToPage,title:"Fit to screen"},React.createElement(UIIcon.UI,{name:"fit-screen"}))))),React.createElement("div",{ref:viewerRef,className:"wy-pdf-container"},React.createElement("div",{id:"viewer",className:"pdfViewer"})))};function checkImageLoad(img){var isLoaded=img.complete&&img.naturalHeight!==0;if(isLoaded){if(!img.classList.contains("wy-loading")){img.classList.add("wy-loading","wy-loaded")}else{img.decode().then(function(){img.classList.add("wy-loaded")})}}else{img.classList.add("wy-loading")}}function imageLoaded(event){var img=event.target;if(img.tagName==="IMG"&&img.classList.contains("wy-loading")&&!img.classList.contains("wy-loaded")){img.classList.add("wy-loaded")}}var Image$1=function Image$1(_ref156){var src=_ref156.src,previewSrc=_ref156.previewSrc,width=_ref156.width,height=_ref156.height,more=_ref156.more,_onClick=_ref156.onClick;var ratio=width/height||1;var baseSize=64;var maxScale=2;var flexRatio=ratio.toPrecision(5);var flexBasis=(ratio*baseSize).toPrecision(5)+"px";var padding=(100/ratio).toPrecision(5)+"%";var intrinsicWidth=width+"px";var maxWidth=width>0?maxScale*width+"px":"none";var imageRef=React.useCallback(function(element){if(element){checkImageLoad(element)}},[]);return React.createElement("a",{href:src,className:"wy-image",onClick:function onClick(e){return _onClick(e)},style:{flexBasis:flexBasis,flexGrow:flexRatio,flexShrink:flexRatio,width:intrinsicWidth,maxWidth:maxWidth}},React.createElement("div",{className:"wy-image-area",style:{paddingBottom:padding}},React.createElement("img",{ref:imageRef,src:previewSrc,onLoad:imageLoaded,alt:"",loading:"lazy",decoding:"async"}),!!more&&React.createElement("span",{className:"wy-more"},"+",more)))};var ImageGrid=function ImageGrid(_ref157){var children=_ref157.children,_ref157$limit=_ref157.limit,limit=_ref157$limit===void 0?3:_ref157$limit;var allImages=React.Children.toArray(children);var more=allImages.length>limit?allImages.length-limit:0;var firstImages=allImages.slice(0,limit);var lastChild=firstImages[firstImages.length-1];if(React.isValidElement(lastChild)){var lastChildProps={more:more};firstImages[firstImages.length-1]=React.cloneElement(lastChild,lastChildProps)}return React.createElement("div",{className:"wy-image-grid"},firstImages)};var getStream=function getStream(response){if(response&&response.ok&&response.body){var reader=response.body.getReader();return new ReadableStream({start:function start(controller){var pump=function pump(){return reader.read().then(function(_ref158){var done=_ref158.done,value=_ref158.value;if(done){controller.close();return}controller.enqueue(value);return pump()})};return pump()}})}};var PreviewImage=function PreviewImage(_ref159){var src=_ref159.src,width=_ref159.width,height=_ref159.height;var imageRef=React.useCallback(function(element){if(element){checkImageLoad(element)}},[]);return React.createElement(React.Fragment,null,width&&height?React.createElement("div",{className:"wy-content-image wy-responsive-image",style:_defineProperty2(_defineProperty2({},"--width",width),"--height",height)},React.createElement("img",{className:"wy-loading-transition",ref:imageRef,src:src,onLoad:imageLoaded,width:width,height:height,decoding:"async"}),React.createElement(UISpinner.UI,null)):React.createElement("div",{className:"wy-content-image wy-responsive-image wy-intrinsic-image"},React.createElement("img",{ref:imageRef,src:src,onLoad:imageLoaded,decoding:"async"})))};var PreviewDocument=function PreviewDocument(_ref160){var src=_ref160.src,client=_ref160.client;var pdfWorkerUrl=new URL("/js/pdf.worker.min.js",client.url).toString();var pdfCMapsUrl=new URL("/cmaps/",client.url).toString();return React.createElement(PdfViewer,{src:src,pdfWorkerUrl:pdfWorkerUrl,pdfCMapsUrl:pdfCMapsUrl})};function mediaFallback(media){if(media.classList.contains("wy-loading")){media.classList.add("wy-loaded")}media.classList.add("wy-error");media.outerHTML=media.outerHTML.replace(/<(video|audio)/,"<div").replace(/(video|audio)>/,"div>")}function mediaLoaded(event){var src=event.target;if(src.tagName==="VIDEO"||src.tagName==="AUDIO"){if(src.classList.contains("wy-loading")){src.classList.add("wy-loaded")}}}function mediaError(event){var src=event.target;var media;if(src.tagName==="SOURCE"){media=src.parentNode;media.dataset.errors=(media.dataset.errors||0)+1;if(media.querySelectorAll("source").length>=media.dataset.errors){console.warn(media.tagName.toLowerCase()+" source error, switching to fallback");mediaFallback(media)}}}function codecError(event){var src=event.target;if(src.tagName==="VIDEO"||src.tagName==="AUDIO"){if(src.tagName==="VIDEO"&&!src.videoWidth||src.tagName==="AUDIO"&&!src.duration){console.warn(src.tagName.toLowerCase()+" track not available, switching to fallback");mediaFallback(src)}}}var PreviewMedia=function PreviewMedia(_ref161){var format=_ref161.format,src=_ref161.src,name=_ref161.name,mediaType=_ref161.mediaType;var _React$useState15=React.useState(),_React$useState16=_slicedToArray2(_React$useState15,2),mediaElement=_React$useState16[0],setMediaElement=_React$useState16[1];var mediaRef=React.useCallback(function(element){if(element){element.classList.add("wy-loading");setMediaElement(element)}},[]);React.useEffect(function(){if(mediaElement){mediaElement.addEventListener("error",mediaError,true);mediaElement.addEventListener("loadedmetadata",mediaLoaded,true);mediaElement.addEventListener("loadedmetadata",codecError,true);return function(){mediaElement.pause();mediaElement.removeAttribute("autoplay");mediaElement.setAttribute("preload","none");mediaElement.removeEventListener("error",mediaError,true);mediaElement.removeEventListener("loadedmetadata",mediaLoaded,true);mediaElement.removeEventListener("loadedmetadata",codecError,true)}}},[mediaElement]);return format==="video"?React.createElement(React.Fragment,null,React.createElement("video",{ref:mediaRef,className:"wy-content-video",controls:true,crossOrigin:"use-credentials",autoPlay:true},React.createElement("source",{src:src,type:mediaType}),React.createElement(PreviewIcon,{src:src,icon:"file-video"})),React.createElement(UISpinner.UI,null)):React.createElement(React.Fragment,null,React.createElement("audio",{ref:mediaRef,className:"wy-content-audio",controls:true,crossOrigin:"use-credentials",autoPlay:true},React.createElement("source",{src:src,type:mediaType})))};var PreviewText=function PreviewText(_ref162){var src=_ref162.src,_ref162$html=_ref162.html,html=_ref162$html===void 0?false:_ref162$html,_ref162$code=_ref162.code,code=_ref162$code===void 0?false:_ref162$code;var _React$useState17=React.useState(""),_React$useState18=_slicedToArray2(_React$useState17,2),textContent=_React$useState18[0],setTextContent=_React$useState18[1];React.useEffect(function(){fetch(src).then(getStream).then(function(stream){return new Response(stream)}).then(function(response){return response.text()}).then(function(text){setTextContent(text)})},[src]);return React.createElement(React.Fragment,null,html?code?React.createElement("div",{className:"wy-content-code wy-code",dangerouslySetInnerHTML:{__html:textContent}}):React.createElement("div",{className:"wy-document wy-light"},React.createElement("div",{className:"wy-content-html",dangerouslySetInnerHTML:{__html:textContent}})):code?React.createElement("div",{className:"wy-content-code"},textContent):React.createElement("div",{className:"wy-document wy-light"},React.createElement("pre",{className:"wy-content-text"},textContent)))};var PreviewEmbed=function PreviewEmbed(_ref163){var src=_ref163.src,name=_ref163.name,icon=_ref163.icon,provider=_ref163.provider;var _React$useState19=React.useState(),_React$useState20=_slicedToArray2(_React$useState19,2),embedElement=_React$useState20[0],setEmbedElement=_React$useState20[1];var embedRef=React.useCallback(function(element){if(element){element.classList.add("wy-loading");setEmbedElement(element)}},[]);React.useEffect(function(){if(embedElement){var embedFallbackTimeout=setTimeout(function(){embedElement.classList.add("wy-fallback")},2500);var embedLoaded=function embedLoaded(event){var obj=event.target;if(obj.tagName==="OBJECT"&&obj.classList.contains("wy-loading")&&!obj.classList.contains("wy-loaded")){obj.classList.add("wy-loaded");clearTimeout(embedFallbackTimeout)}};embedElement.addEventListener("load",embedLoaded,true);return function(){embedElement.removeEventListener("load",embedLoaded,true);clearTimeout(embedFallbackTimeout)}}},[embedElement]);return React.createElement(React.Fragment,null,React.createElement("object",{ref:embedRef,className:"wy-content-iframe",data:src}),React.createElement(UISpinner.UI,null),React.createElement(PreviewIcon,{src:src,icon:icon,provider:provider,className:"wy-content-iframe-fallback"}))};var PreviewIcon=function PreviewIcon(_ref164){var children=_ref164.children,src=_ref164.src,icon=_ref164.icon,provider=_ref164.provider,className=_ref164.className;return React.createElement("div",{className:classNames("wy-content-icon",className)},React.createElement("div",{className:"wy-content-icon"},React.createElement(UIIcon.UI,{name:icon})),React.createElement("div",{className:"wy-content-name"},provider?React.createElement(React.Fragment,null,React.createElement("span",null,"No preview available. "),React.createElement("a",{href:src,target:"_blank"},"Open in ".concat(provider,"?"))):React.createElement("span",null,"No preview available :(")),children)};var Preview=function Preview(_ref165){var client=_ref165.client,src=_ref165.src,link=_ref165.link,format=_ref165.format,name=_ref165.name,icon=_ref165.icon,width=_ref165.width,height=_ref165.height,mediaType=_ref165.mediaType,provider=_ref165.provider;return React.createElement(React.Fragment,null,format==="image"&&React.createElement(PreviewImage,{key:src,src:src,width:width,height:height}),format==="pdf"&&React.createElement(PreviewDocument,{src:src,client:client}),(format==="video"||format==="audio")&&React.createElement(PreviewMedia,{key:src,format:format,src:src,name:name,mediaType:mediaType}),format==="text"&&React.createElement(PreviewText,{key:src,src:src}),format==="code"&&React.createElement(PreviewText,{key:src,src:src,html:!/^(?:blob:|data:)/.test(src),code:true}),format==="html"&&React.createElement(PreviewText,{key:src,src:src,html:true}),format==="embed"&&React.createElement(PreviewEmbed,{key:src,src:src,name:name,icon:icon,provider:provider}),format==="none"&&(link?React.createElement(PreviewIcon,{src:link,icon:icon,provider:provider}):React.createElement(PreviewIcon,{src:src,icon:icon})))};var fileSizeAsString=function fileSizeAsString(size){var significantDigits=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3;var s=size;var format=[" B"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"];var i=0;while(i<format.length-1&&s>=1024){s=100*s/1024/100;i++}return s.toLocaleString(undefined,{maximumSignificantDigits:significantDigits})+format[i]};function getExtension(name){return(name.substring(name.lastIndexOf("."),name.length)||name).toLowerCase()}function isAudio(ext){switch(ext){case".aac":case".aif":case".aiff":case".au":case".gsm":case".m4a":case".mid":case".midi":case".mka":case".mp3":case".oga":case".ogg":case".ra":case".ram":case".snd":case".spx":case".wav":case".wma":return true;default:return false}}function isImage(ext){switch(ext){case".ai":case".apng":case".bmp":case".emf":case".eps":case".gif":case".heic":case".ico":case".jpg":case".jpeg":case".png":case".psd":case".svg":case".tif":case".tiff":case".webp":case".wmf":return true;default:return false}}function isWebImage(path){var ext=getExtension(path);switch(ext){case".apng":case".bmp":case".gif":case".ico":case".jpg":case".jpeg":case".png":case".svg":case".webp":return true;default:return false}}function isVideo(ext){switch(ext){case".3g2":case".asx":case".asf":case".avi":case".flv":case".mk3d":case".mkv":case".mov":case".mp4":case".mpeg":case".mpg":case".ogm":case".ogv":case".ogx":case".qt":case".rm":case".rv":case".smi":case".smil":case".swf":case".webm":case".wmv":case".xaml":return true;default:return false}}function isMarkdown(ext){switch(ext){case".markdown":case".md":return true;default:return false}}function isMarkup(ext){switch(ext){case".htm":case".html":case".xhtml":case".xml":return true;default:return false}}function isCode(ext){if(isMarkup(ext)){return true}switch(ext){case".as":case".as3":case".asm":case".aspx":case".bat":case".c":case".cc":case".cmake":case".coffee":case".cpp":case".cs":case".css":case".cxx":case".diff":case".erb":case".erl":case".groovy":case".gvy":case".h":case".haml":case".hh":case".hpp":case".hxx":case".java":case".js":case".json":case".jsx":case".less":case".lst":case".m":case".make":case".ml":case".mm":case".out":case".patch":case".php":case".pl":case".plist":case".properties":case".py":case".rb":case".sass":case".scala":case".scm":case".script":case".scss":case".sh":case".sml":case".sql":case".vb":case".vi":case".vim":case".xsd":case".xsl":case".yaml":case".yml":return true;default:return false}}function isText(ext){if(isCode(ext)||isMarkdown(ext)){return true}switch(ext){case".txt":return true;default:return false}}function getIcon(name,mediaType){var ext=getExtension(name);if(ext==="")return{icon:"file"};if(isAudio(ext)){return{icon:"file-music",color:"indigo"}}else if(isImage(ext)){return{icon:"file-image",color:"cyan"}}else if(isVideo(ext)){return{icon:"file-video",color:"pink"}}else if(isMarkup(ext)){return{icon:"file-xml",color:"purple"}}else if(isCode(ext)){return{icon:"file-code",color:"purple"}}else if(isText(ext)){return{icon:"file-document"}}else{switch(ext){case".7z":case".zip":return{icon:"file-compressed",color:"orange"};case".doc":case".docm":case".docx":case".dotm":case".dotx":return{icon:"file-word",color:"native"};case".eml":case".msg":return{icon:"email",color:""};case".xls":case".xlsm":case".xlsx":case".xltx":return{icon:"file-excel",color:"native"};case".pdf":return{icon:"file-pdf",color:"native"};case".ppt":case".pptm":case".pptx":case".potx":return{icon:"file-powerpoint",color:"native"};case".pages":return{icon:"file",color:"orange"};case".numbers":return{icon:"file",color:"green"};case".keynote":return{icon:"file",color:"blue"}}}return{icon:"file"}}function getWebPreviewFormat(name){var ext=getExtension(name);if(ext==="")return"none";if(isWebImage(ext)){return"image"}else if(isCode(ext)){return"code"}else if(isText(ext)){return"text"}else if(isAudio(ext)){return"audio"}else if(isVideo(ext)){return"video"}return"none"}function getProvider(provider){switch(provider){case"Google Drive":return"google-drive";case"Dropbox":return"dropbox";case"OneDrive":return"onedrive";case"Box":return"box";default:return""}}function getKind(name){var kind="file";var ext=getExtension(name);switch(ext){case".7z":case".zip":kind="archive";break;case".aac":case".aif":case".aiff":case".au":case".gsm":case".m4a":case".mid":case".midi":case".mka":case".mp3":case".oga":case".ogg":case".ra":case".ram":case".snd":case".spx":case".wav":case".wma":kind="audio";break;case".c":case".cgi":case".cpp":case".cs":case".cshtml":case".css":case".html":case".java":case".js":case".json":case".less":case".php":case".pl":case".ps1":case".py":case".rb":case".rs":case".scss":case".sh":case".swift":case".sql":case".ts":case".xml":case".yaml":case".yml":kind="code";break;case".doc":case".docm":case".docx":case".dotm":case".dotx":case".gdoc":case".pages":case".pdf":kind="document";break;case".eml":case".msg":kind="email";break;case".gslides":case".keynote":case".ppt":case".pptm":case".pptx":case".potx":kind="presentation";break;case".gsheet":case".numbers":case".xls":case".xlsm":case".xlsx":case".xltx":kind="spreadsheet";break;case".ai":case".apng":case".bmp":case".emf":case".eps":case".gif":case".heic":case".ico":case".jpg":case".jpeg":case".png":case".psd":case".svg":case".tif":case".tiff":case".webp":case".wmf":kind="image";break;case".md":case".markdown":case".txt":kind="text";break;case".3g2":case".asx":case".asf":case".avi":case".flv":case".mk3d":case".mkv":case".mov":case".mp4":case".mpeg":case".mpg":case".ogm":case".ogv":case".ogx":case".qt":case".rm":case".rv":case".smi":case".smil":case".swf":case".webm":case".wmv":case".xaml":kind="video";break}return kind}function openUrl(){var url=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var target=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var name=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var download=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(url){var a=document.createElement("a");if(download){if(/^(data:|blob:)/.test(url)){a.download=name||"download"}else{url=url.includes("?d=1")||url.includes("&d=1")?url:url.includes("?")?url+"&d=1":url+"?d=1"}}if(target){a.target=target}a.href=url;document.body.appendChild(a);try{a.click()}catch(e){console.warn("Could not open link normally, trying fallback");if(!/^(?:blob:|data:)/.test(url)){try{window.open(url,target)}catch(e){console.error("Could not ".concat(download?"download":"open"," ").concat(name))}}else{console.error("Could not ".concat(download?"download":"open"," ").concat(name))}}document.body.removeChild(a)}}var PreviewContext=React.createContext({openPreview:Function,closePreview:Function,setPreviewFiles:Function});function allowedKeyTarget$1(e){var notInputField=!e.target.matches("input, textarea, select")&&!e.target.closest("[contenteditable=\"true\"]");return notInputField}var PreviewProvider=function PreviewProvider(_ref166){var client=_ref166.client,children=_ref166.children;var _React$useState21=React.useState(false),_React$useState22=_slicedToArray2(_React$useState21,2),modalPreviewOpen=_React$useState22[0],setModalPreviewOpen=_React$useState22[1];var _React$useState23=React.useState(),_React$useState24=_slicedToArray2(_React$useState23,2),files=_React$useState24[0],setFiles=_React$useState24[1];var _React$useState25=React.useState(),_React$useState26=_slicedToArray2(_React$useState25,2),activeFile=_React$useState26[0],setActiveFile=_React$useState26[1];var _React$useState27=React.useState(),_React$useState28=_slicedToArray2(_React$useState27,2),currentFileId=_React$useState28[0],setCurrentFileId=_React$useState28[1];var _React$useState29=React.useState(),_React$useState30=_slicedToArray2(_React$useState29,2),nextFileId=_React$useState30[0],setNextFileId=_React$useState30[1];var _React$useState31=React.useState(),_React$useState32=_slicedToArray2(_React$useState31,2),previousFileId=_React$useState32[0],setPreviousFileId=_React$useState32[1];React.useEffect(function(){if(currentFileId){if(files){var itemIndex=files.map(function(a){return a.id}).indexOf(currentFileId);setPreviousFileId(itemIndex>0?files[itemIndex-1].id:undefined);setNextFileId(itemIndex+1<files.length?files[itemIndex+1].id:undefined);setActiveFile(files.find(function(a){return a.id===currentFileId}))}}},[files,files===null||files===void 0?void 0:files.length,currentFileId]);var setPreviewFiles=function setPreviewFiles(fileList){setFiles(fileList)};var openPreview=function openPreview(id){setCurrentFileId(id);setModalPreviewOpen(true)};var closePreview=function closePreview(){setModalPreviewOpen(false)};var handlePrevious=function handlePrevious(){setCurrentFileId(previousFileId)};var handleNext=function handleNext(){setCurrentFileId(nextFileId)};var handleDownload=function handleDownload(){if(activeFile&&activeFile.download_url){openUrl(activeFile.download_url,"_top",activeFile.name,true)}};React.useEffect(function(){if(activeFile){var handleKey=function handleKey(e){if(modalPreviewOpen){if(e.which===27){e.stopImmediatePropagation();closePreview()}else if(e.which===37){if(allowedKeyTarget$1(e)){e.stopPropagation();setCurrentFileId(previousFileId)}}else if(e.which===39){if(allowedKeyTarget$1(e)){e.stopPropagation();setCurrentFileId(nextFileId)}}}};document.addEventListener("keyup",handleKey,true);return function(){document.removeEventListener("keyup",handleKey,true)}}},[activeFile,modalPreviewOpen]);getIcon((activeFile===null||activeFile===void 0?void 0:activeFile.name)||"").icon;var previewExt=getExtension((activeFile===null||activeFile===void 0?void 0:activeFile.name)||"");var previewIcon=getIcon((activeFile===null||activeFile===void 0?void 0:activeFile.name)||"").icon;var previewSrc=(activeFile===null||activeFile===void 0?void 0:activeFile.preview_url)||(activeFile===null||activeFile===void 0?void 0:activeFile.download_url)||"";var animatedImage=(activeFile===null||activeFile===void 0?void 0:activeFile.preview_format)==="image"&&(previewExt===".gif"||previewExt===".svg");if(animatedImage){previewSrc=(activeFile===null||activeFile===void 0?void 0:activeFile.download_url)||""}return React.createElement(React.Fragment,null,React.createElement(PreviewContext.Provider,{value:{openPreview:openPreview,closePreview:closePreview,setPreviewFiles:setPreviewFiles}},children),files&&React.createElement(UIOverlay.UI,{isOpen:modalPreviewOpen,className:"wy-dark",closeOnEsc:false,onClose:function onClose(){return setModalPreviewOpen(false)}},React.createElement("header",{className:"wy-appbars"},React.createElement("nav",{className:"wy-appbar"},React.createElement(UIButton.UI,{onClick:closePreview},React.createElement(UIIcon.UI,{name:"close"})),React.createElement("div",{className:classNames("wy-appbar-text",{"wy-appbar-text-trashed":activeFile===null||activeFile===void 0?void 0:activeFile.is_trashed})},activeFile&&React.createElement("span",null,activeFile.name)),React.createElement("div",{className:"wy-appbar-buttons"},activeFile&&React.createElement(UIButton.UI,{onClick:handleDownload},React.createElement(UIIcon.UI,{name:"download"}))))),React.createElement("div",{className:"wy-main"},React.createElement("div",{className:"wy-preview"},activeFile&&React.createElement(React.Fragment,null,previousFileId&&React.createElement("nav",{className:"wy-nav-prev"},React.createElement(UIButton.UI,{onClick:handlePrevious},React.createElement(UIIcon.UI,{name:"previous"}))),nextFileId&&React.createElement("nav",{className:"wy-nav-next"},React.createElement(UIButton.UI,{onClick:handleNext},React.createElement(UIIcon.UI,{name:"next"}))),React.createElement("div",{className:"wy-preview-area wy-scroll-y wy-scroll-x"},React.createElement(Preview,{client:client,src:previewSrc,link:activeFile.external_url,format:activeFile.is_trashed?"none":activeFile.preview_format,name:activeFile.name,icon:previewIcon,width:activeFile.width,height:activeFile.height,mediaType:activeFile.media_type,provider:activeFile.provider})))))))};var FUNC_ERROR_TEXT$1="Expected a function";var NAN$1=0/0;var symbolTag$1="[object Symbol]";var reTrim$1=/^\s+|\s+$/g;var reIsBadHex$1=/^[-+]0x[0-9a-f]+$/i;var reIsBinary$1=/^0b[01]+$/i;var reIsOctal$1=/^0o[0-7]+$/i;var freeParseInt$1=parseInt;var freeGlobal$1=_typeof2(commonjsGlobal)=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal;var freeSelf$1=(typeof self==="undefined"?"undefined":_typeof2(self))=="object"&&self&&self.Object===Object&&self;var root$1=freeGlobal$1||freeSelf$1||Function("return this")();var objectProto$1=Object.prototype;var objectToString$1=objectProto$1.toString;var nativeMax$1=Math.max,nativeMin$1=Math.min;var now$1=function now$1(){return root$1.Date.now()};function debounce$3(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT$1)}wait=toNumber$1(wait)||0;if(isObject$3(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax$1(toNumber$1(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin$1(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now$1();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now$1())}function debounced(){var time=now$1(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT$1)}if(isObject$3(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce$3(func,wait,{"leading":leading,"maxWait":wait,"trailing":trailing})}function isObject$3(value){var type=_typeof2(value);return!!value&&(type=="object"||type=="function")}function isObjectLike$1(value){return!!value&&_typeof2(value)=="object"}function isSymbol$1(value){return _typeof2(value)=="symbol"||isObjectLike$1(value)&&objectToString$1.call(value)==symbolTag$1}function toNumber$1(value){if(typeof value=="number"){return value}if(isSymbol$1(value)){return NAN$1}if(isObject$3(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject$3(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim$1,"");var isBinary=reIsBinary$1.test(value);return isBinary||reIsOctal$1.test(value)?freeParseInt$1(value.slice(2),isBinary?2:8):reIsBadHex$1.test(value)?NAN$1:+value}var lodash_throttle=throttle;var throttle$1=getDefaultExportFromCjs(lodash_throttle);var scrollbarClassnameTarget=document.documentElement;function checkScrollbar(entries){var element,overflowWidth;for(var entry in entries){element=entries[entry].target;try{overflowWidth=element===document.documentElement?window.innerWidth:element.clientWidth;if(overflowWidth!==element.offsetWidth){scrollbarClassnameTarget.classList.add("wy-scrollbars")}else{scrollbarClassnameTarget.classList.remove("wy-scrollbars")}}catch(e){console.warn("scrollbar detection failed",e)}}return scrollbarClassnameTarget.classList.contains("wy-scrollbars")}function detectScrollbars(){var scrollCheckElement=document.getElementById("wy-scrollbar-detection");if(!scrollCheckElement){scrollCheckElement=document.createElement("aside");scrollCheckElement.id="wy-scrollbar-detection";scrollCheckElement.className="wy-scrollbar-detection";document.documentElement.insertBefore(scrollCheckElement,document.body)}return new Promise(function(resolve){var scrollObserver=new ResizeObserver(function(entries){var hasScrollbars=checkScrollbar(entries);resolve(hasScrollbars)});scrollObserver.observe(scrollCheckElement)})}function checkScrollbarAdjust(entries){for(var entry in entries){var target=entries[entry].target;var targetStyle=getComputedStyle(target);if(target.dataset.adjustScrollbarTop!==undefined){scrollbarClassnameTarget.style.setProperty("--wy-scrollbar-adjust-top",targetStyle.height)}if(target.dataset.adjustScrollbarBottom!==undefined){scrollbarClassnameTarget.style.setProperty("--wy-scrollbar-adjust-bottom",targetStyle.height)}}}function detectScrollbarAdjustments(){var adjustRO=new ResizeObserver(checkScrollbarAdjust);var registerAdjustmentElements=function registerAdjustmentElements(){scrollbarClassnameTarget.style.removeProperty("--wy-scrollbar-adjust-top");scrollbarClassnameTarget.style.removeProperty("--wy-scrollbar-adjust-bottom");adjustRO.disconnect();if(scrollbarClassnameTarget.classList.contains("wy-scrollbars")){var scrollbarAdjustElements=document.querySelectorAll("[data-adjust-scrollbar-top], [data-adjust-scrollbar-bottom]");if(scrollbarAdjustElements){scrollbarAdjustElements.forEach(function(target){checkScrollbarAdjust([{target:target}]);adjustRO.observe(target)})}}};requestAnimationFrame(registerAdjustmentElements);setTimeout(registerAdjustmentElements,5000);var adjustMO=new MutationObserver(throttle$1(registerAdjustmentElements,100));adjustMO.observe(scrollbarClassnameTarget,{childList:true,subtree:true})}function useMutateExternalBlobs(client){if(!client){throw new Error("useMutateExternalBlobs must be used within an WeavyProvider")}var mutateExternalBlobs=function(){var _ref168=_asyncToGenerator(_regeneratorRuntime().mark(function _callee109(_ref167){var blob,response;return _regeneratorRuntime().wrap(function _callee109$(_context111){while(1)switch(_context111.prev=_context111.next){case 0:blob=_ref167.blob;_context111.next=3;return client.post("/api/blobs/external","POST",JSON.stringify(blob));case 3:response=_context111.sent;return _context111.abrupt("return",response.json());case 5:case"end":return _context111.stop()}},_callee109)}));return function mutateExternalBlobs(_x85){return _ref168.apply(this,arguments)}}();return useMutation(mutateExternalBlobs,{onSuccess:function onSuccess(variables){}})}function S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}function isObject$2(maybeObject){return Object.prototype.toString.call(maybeObject)==="[object Object]"}function isPlainObject(maybePlainObject){var ctor,prot;if(isObject$2(maybePlainObject)===false)return false;ctor=maybePlainObject.constructor;if(ctor===undefined)return true;prot=ctor.prototype;if(isObject$2(prot)===false)return false;if(Object.prototype.hasOwnProperty.call(prot,"isPrototypeOf")===false){return false}return true}function eqJQuery(a,b){return a&&b&&a.jquery&&b.jquery&&a.jquery===b.jquery&&a.length===b.length&&a.length===a.filter(b).length}function eqObjects(a,b,skipLength){if(!isPlainObject(a)||!isPlainObject(b)){return false}var aProps=Object.getOwnPropertyNames(a);var bProps=Object.getOwnPropertyNames(b);if(!skipLength&&aProps.length!==bProps.length){return false}for(var i=0;i<aProps.length;i++){var propName=aProps[i];var propA=a[propName];var propB=b[propName];if(propA!==propB&&!eqJQuery(propA,propB)&&!eqObjects(propA,propB,skipLength)){return false}}return true}function toKebabCase(str){if(str.length>0){return str.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/_|\s+/g,"-").toLowerCase()}else{return str}}window.addEventListener("unhandledrejection",function(e){if(e.promise.weavy){e.preventDefault()}});function WeavyPromiseWrapper(executor){var promise,state="pending";var WeavyPromise=function WeavyPromise(){return promise};WeavyPromise.promise=WeavyPromise.bind(WeavyPromise);WeavyPromise.state=function(){return state};(WeavyPromise.reset=function(){var resolve,reject;state="pending";promise=new Promise(function(_resolve,_reject){resolve=function resolve(){state="resolved";_resolve.apply(this,arguments)};reject=function reject(){state="rejected";_reject.apply(this,arguments)}});promise.weavy=true;WeavyPromise.resolve=function(){resolve.apply(promise,arguments);return WeavyPromise};WeavyPromise.reject=function(){reject.apply(promise,arguments);return WeavyPromise};if(typeof executor==="function"){executor(resolve,reject)}return WeavyPromise})();WeavyPromise.then=function(){promise=promise.then.apply(promise,arguments);promise.weavy=true;return WeavyPromise};WeavyPromise["catch"]=function(){promise=promise["catch"].apply(promise,arguments);promise.weavy=true;return WeavyPromise};WeavyPromise["finally"]=function(){promise=promise["finally"].apply(promise,arguments);promise.weavy=true;return WeavyPromise};return WeavyPromise}WeavyPromiseWrapper.resolve=function(value){var promise=WeavyPromiseWrapper();promise.resolve(value);return promise};WeavyPromiseWrapper.reject=function(value){var promise=WeavyPromiseWrapper();promise.reject(value);return promise};function WeavyPostal(options){var weavyPostal=this;this.timeout=options&&options.timeout||2000;var messageListeners=[];var contentWindows=new Set;var contentWindowsByWeavyId=new Map;var contentWindowOrigins=new WeakMap;var contentWindowNames=new WeakMap;var contentWindowWeavyIds=new WeakMap;var contentWindowDomain=new WeakMap;var _whenLeader=new WeavyPromiseWrapper;var _isLeader=null;var _origin=extractOrigin(window.location.href);function extractOrigin(url){var extractOrigin=null;try{extractOrigin=/^((?:https?:\/\/[^/]+)|(?:file:\/\/))\/?/.exec(url)[1]}catch(e){console.error("Unable to resolve location origin. Make sure you are using http, https or file protocol and have a valid location URL.")}return extractOrigin}function distributeMessage(e,fromFrame){var fromSelf=e.source===window&&e.origin===_origin;fromFrame||(fromFrame=contentWindowOrigins.has(e.source)&&e.origin===contentWindowOrigins.get(e.source));if(fromSelf||fromFrame){var genericDistribution=!e.data.weavyId||e.data.weavyId===true;if(fromFrame&&!e.data.windowName){e.data.windowName=contentWindowNames.get(e.source)}var messageName=e.data.name;if(messageName==="distribute"){if(_isLeader){return}e.data.name=e.data.distributeName}messageListeners.forEach(function(listener){var matchingName=listener.name===messageName||listener.name==="message";var genericListener=listener.selector===null;var matchingWeavyId=listener.selector===e.data.weavyId;var matchingDataSelector=isPlainObject(listener.selector)&&eqObjects(listener.selector,e.data,true);if(matchingName&&(genericDistribution||genericListener||matchingWeavyId||matchingDataSelector)){listener.handler(e,e.data);if(listener.once){off(listener.name,listener.selector,listener.handler)}}})}}window.addEventListener("message",function(e){if(e.data.name&&e.data.weavyId!==undefined){if(e.data.weavyMessageId&&e.data.name!=="message-receipt"&&e.data.name!=="unready"){console.debug("sending message receipt",e.data.weavyMessageId,e.data.name);try{e.source.postMessage({name:"message-receipt",weavyId:e.data.weavyId,weavyMessageId:e.data.weavyMessageId},e.origin)}catch(error){console.error("could not post back message-receipt to source")}}switch(e.data.name){case"register-child":if(!contentWindowWeavyIds.has(e.source)){console.warn("register-child: contentwindow not pre-registered")}if(contentWindowOrigins.get(e.source)!==e.origin){console.error("register-child: "+contentWindowNames.get(e.source)+" has invalid origin",e.origin);return}try{var weavyId=contentWindowWeavyIds.get(e.source);var contentWindowName=contentWindowNames.get(e.source);if(contentWindowName){e.source.postMessage({name:"register-window",windowName:contentWindowName,weavyId:weavyId||true},e.origin)}}catch(e){console.error("could not register frame window",weavyId,contentWindowName,e)}break;case"ready":if(contentWindowsByWeavyId.has(e.data.weavyId)&&contentWindowNames.has(e.source)&&contentWindowsByWeavyId.get(e.data.weavyId).get(contentWindowNames.get(e.source))){contentWindowDomain.set(e.source,e.origin);distributeMessage(e)}break;case"unready":if(contentWindowsByWeavyId.has(e.data.weavyId)){distributeMessage(e,true)}break;default:if(e.source===window||contentWindowsByWeavyId.size){distributeMessage(e)}break}}});function on(name,selector,handler){if(typeof arguments[1]==="function"){handler=arguments[1];selector=null}messageListeners.push({name:name,handler:handler,selector:selector})}function one(name,selector,handler){if(typeof arguments[1]==="function"){handler=arguments[1];selector=null}messageListeners.push({name:name,handler:handler,selector:selector,once:true})}function off(name,selector,handler){if(typeof arguments[1]==="function"){handler=arguments[1];selector=null}messageListeners=messageListeners.filter(function(listener){var nameMatch=name===listener.name;var handlerMatch=handler===listener.handler;var stringSelectorMatch=typeof selector==="string"&&selector===listener.selector;var plainObjectMatch=isPlainObject(selector)&&eqObjects(selector,listener.selector);var offMatch=nameMatch&&handlerMatch&&(selector===null||stringSelectorMatch||plainObjectMatch);return!offMatch})}function registerContentWindow(contentWindow,contentWindowName,weavyId,contentOrigin){try{if(!contentWindowName){console.error("registerContentWindow() No valid contentWindow to register, must be a window and have a name.");return}}catch(e){console.error("registerContentWindow() cannot access contentWindowName")}if(contentWindow.self){contentWindow=contentWindow.self}if(!weavyId||weavyId==="true"){weavyId=true}if(!contentWindowsByWeavyId.has(weavyId)){contentWindowsByWeavyId.set(weavyId,new Map)}contentWindowsByWeavyId.get(weavyId).set(contentWindowName,contentWindow);contentWindows.add(contentWindow);contentWindowNames.set(contentWindow,contentWindowName);contentWindowWeavyIds.set(contentWindow,weavyId);contentWindowOrigins.set(contentWindow,contentOrigin)}function unregisterWeavyId(weavyId){if(contentWindowsByWeavyId.has(weavyId)){contentWindowsByWeavyId.get(weavyId).forEach(function(contentWindow,contentWindowName){unregisterContentWindow(contentWindowName,weavyId)});contentWindowsByWeavyId.get(weavyId);contentWindowsByWeavyId["delete"](weavyId)}}function unregisterContentWindow(windowName,weavyId){if(contentWindowsByWeavyId.has(weavyId)){if(contentWindowsByWeavyId.get(weavyId).has(windowName)){var contentWindow=contentWindowsByWeavyId.get(weavyId).get(windowName);try{contentWindows["delete"](contentWindow);contentWindowNames["delete"](contentWindow);contentWindowWeavyIds["delete"](contentWindow);contentWindowOrigins["delete"](contentWindow)}catch(e){}}contentWindowsByWeavyId.get(weavyId)["delete"](windowName);if(contentWindowsByWeavyId.get(weavyId).size===0){try{contentWindowsByWeavyId["delete"](weavyId)}catch(e){}}}}function whenPostMessage(contentWindow,message,transfer){var whenReceipt=new WeavyPromiseWrapper;if(transfer===null){transfer=undefined}var toSelf=contentWindow===window.self;var origin=toSelf?extractOrigin(window.location.href):contentWindowOrigins.get(contentWindow);var validWindow=toSelf||contentWindow&&origin===contentWindowDomain.get(contentWindow);if(validWindow){if(!message.weavyMessageId){message.weavyMessageId=S4()+S4()}queueMicrotask(function(){console.debug("whenPostMessage",message.name,message.weavyMessageId);var messageWatchdog=setTimeout(function(){if(whenReceipt.state()==="pending"){whenReceipt.reject(new Error("postMessage() receipt timed out: "+message.weavyMessageId+", "+message.name))}},weavyPostal.timeout||2000);on("message-receipt",{weavyId:message.weavyId,weavyMessageId:message.weavyMessageId},function(){console.debug("message-receipt received",message.weavyMessageId,message.name);clearTimeout(messageWatchdog);whenReceipt.resolve()});try{contentWindow.postMessage(message,origin,transfer)}catch(e){whenReceipt.reject(e)}})}else{whenReceipt.reject(new Error("postMessage() Invalid window origin: "+origin+", "+message.name))}return whenReceipt()}function postToChildren(message,transfer){if(_typeof2(message)!=="object"||!message.name){console.error("postToChildren() Invalid message format",message);return}if(transfer===null){transfer=undefined}message.distributeName=message.name;message.name="distribute";message.weavyId=message.weavyId||true;contentWindows.forEach(function(contentWindow){if(contentWindowOrigins.get(contentWindow)===contentWindowDomain.get(contentWindow)){try{contentWindow.postMessage(message,contentWindowOrigins.get(contentWindow),transfer)}catch(e){console.warn("postToChildren() could not distribute message to "+contentWindowNames.get(contentWindow))}}})}function postToFrame(windowName,weavyId,message,transfer){if(_typeof2(message)!=="object"||!message.name){console.error("postToFrame() Invalid message format",message);return}var contentWindow;try{contentWindow=contentWindowsByWeavyId.get(weavyId).get(windowName)}catch(e){console.error("postToFrame() Window not registered",weavyId,windowName)}message.weavyId=weavyId;return whenPostMessage(contentWindow,message,transfer)}function postToSelf(message,transfer){if(_typeof2(message)!=="object"||!message.name){console.error("postToSelf() Invalid message format",message);return}message.weavyId=message.weavyId||true;return whenPostMessage(window.self,message,transfer)}function postToSource(e,message,transfer){if(e.source&&e.data.weavyId!==undefined){var fromSelf=e.source===window.self&&e.origin===_origin;var fromFrame=contentWindowOrigins.has(e.source)&&e.origin===contentWindowOrigins.get(e.source);if(transfer===null){transfer=undefined}if(fromSelf||fromFrame){message.weavyId=e.data.weavyId;try{e.source.postMessage(message,e.origin,transfer)}catch(e){console.error("postToSource() Could not post message back to source")}}}}function setLeader(){if(_whenLeader.state()==="pending"){_isLeader=true;_whenLeader.resolve(_isLeader)}}function init(){setLeader()}this.on=on;this.one=one;this.off=off;this.registerContentWindow=registerContentWindow;this.unregisterContentWindow=unregisterContentWindow;this.unregisterAll=unregisterWeavyId;this.postToFrame=postToFrame;this.postToSelf=postToSelf;this.postToSource=postToSource;this.postToChildren=postToChildren;this.whenLeader=function(){return _whenLeader()};Object.defineProperty(this,"isLeader",{get:function get(){return _isLeader}});init()}var WeavyPostal$1=new WeavyPostal;var CloudFilesContext=React.createContext({open:Function});var addFunc=function addFunc(_ref169){var _ref170=_slicedToArray2(_ref169,0)};var CloudFilesProvider=function CloudFilesProvider(_ref171){var children=_ref171.children,options=_ref171.options,client=_ref171.client;var _React$useState33=React.useState(false),_React$useState34=_slicedToArray2(_React$useState33,2),modalOpen=_React$useState34[0],setModalOpen=_React$useState34[1];var _React$useState35=React.useState(false),_React$useState36=_slicedToArray2(_React$useState35,2),visible=_React$useState36[0],setVisible=_React$useState36[1];var _React$useState37=React.useState(""),_React$useState38=_slicedToArray2(_React$useState37,2),frameSrc=_React$useState38[0],setFrameSrc=_React$useState38[1];var fileBrowserUrl=(options===null||options===void 0?void 0:options.filebrowserUrl)||"";var addExternalBlobs=useMutateExternalBlobs(client);var frameRef=React.useCallback(function(node){if(node!==null&&node.contentWindow!=null){WeavyPostal$1.registerContentWindow(node.contentWindow.self,"weavy-filebrowser","wy-filebrowser",new URL(fileBrowserUrl).origin)}},[]);React.useEffect(function(){var origin="";try{if(window.location.ancestorOrigins&&0<window.location.ancestorOrigins.length){origin=window.location.ancestorOrigins[window.location.ancestorOrigins.length-1]}else if(window.top){origin=window.top.document.location.origin}}catch(e){}if(!origin){try{origin=window.self.document.location.origin}catch(e){console.error("Filebrowser: Could not read current origin.")}}var filebrowserSrc=fileBrowserUrl+"?origin="+origin+"&v=X&t="+Date.now().toString()+"&weavyId=wy-filebrowser";setFrameSrc(filebrowserSrc);WeavyPostal$1.on("add-external-blobs",handleFiles);WeavyPostal$1.on("request:file-browser-close",handleClose);return function(){WeavyPostal$1.off("add-external-blobs",handleFiles);WeavyPostal$1.off("request:file-browser-close",handleClose)}},[]);var handleFiles=function(){var _ref172=_asyncToGenerator(_regeneratorRuntime().mark(function _callee110(e,message){var result,_i91,uploadResult;return _regeneratorRuntime().wrap(function _callee110$(_context112){while(1)switch(_context112.prev=_context112.next){case 0:result=[];_i91=0;case 2:if(!(_i91<message.blobs.length)){_context112.next=10;break}_context112.next=5;return addExternalBlobs.mutateAsync({blob:message.blobs[_i91]});case 5:uploadResult=_context112.sent;if(uploadResult.errors){console.error(uploadResult.errors)}else{result.push(uploadResult)}case 7:_i91++;_context112.next=2;break;case 10:addFunc(result);closeFilebrowser();case 12:case"end":return _context112.stop()}},_callee110)}));return function handleFiles(_x86,_x87){return _ref172.apply(this,arguments)}}();var handleOpen=function handleOpen(callback){addFunc=callback;setModalOpen(true)};var handleClose=function handleClose(){closeFilebrowser()};var closeFilebrowser=function closeFilebrowser(){setModalOpen(false);setVisible(false)};var handleFrameLoad=function handleFrameLoad(){setVisible(true)};return React.createElement(React.Fragment,null,React.createElement(CloudFilesContext.Provider,{value:{open:handleOpen}},children),React.createElement(UIOverlay.UI,{isOpen:modalOpen,className:"wy-modal wy-panel wy-loaded"},!visible&&React.createElement(UISpinner.UI,{overlay:true}),React.createElement("iframe",{ref:frameRef,onLoad:handleFrameLoad,src:frameSrc,className:"wy-panel-frame",id:"weavy-filebrowser",name:"weavy-filebrowser"})))};dayjs.extend(relativeTime);dayjs.extend(utc);dayjs.extend(timezone);dayjs.extend(localizedFormat);var WeavyContext=React.createContext({client:null,options:{}});var queryClient=new QueryClient({defaultOptions:{queries:{cacheTime:1000*60*60*24}}});var WeavyProvider=function WeavyProvider(_ref173){var children=_ref173.children,client=_ref173.client,options=_ref173.options;var defaultOptions={zoomAuthenticationUrl:undefined,teamsAuthenticationUrl:undefined,enableScrollbarDetection:true,filebrowserUrl:"https://filebrowser.weavy.io/v14/",reactions:["\uD83D\uDE0D","\uD83D\uDE0E","\uD83D\uDE09","\uD83D\uDE1C","\uD83D\uDC4D"]};var opts=Object.assign(Object.assign({},defaultOptions),options);if(opts.enableScrollbarDetection){detectScrollbars().then(function(){return detectScrollbarAdjustments()})}if(!client){queryClient.clear()}return React.createElement(React.Fragment,null,client&&React.createElement(QueryClientProvider,{client:queryClient},React.createElement(WeavyContext.Provider,{value:{client:client,options:opts}},React.createElement(UserProvider,{client:client},React.createElement(CloudFilesProvider,{options:opts,client:client},React.createElement(PreviewProvider,{client:client},children))))))};function usePresence(){var _React$useContext=React.useContext(WeavyContext),client=_React$useContext.client;if(!client){throw new Error("usePresence must be used within an WeavyProvider")}React.useEffect(function(){client.subscribe(null,"online",handlePresenceChange)},[]);var handlePresenceChange=function handlePresenceChange(data){if(Array.isArray(data)){document.querySelectorAll(".wy-presence").forEach(function(item){item.classList.remove("wy-presence-active")});data.forEach(function(id){document.querySelectorAll("[data-presence-id='"+id+"']").forEach(function(item){item.classList.add("wy-presence-active")})})}else{document.querySelectorAll("[data-presence-id='"+data+"']").forEach(function(item){item.classList.add("wy-presence-active")})}}}var MessengerContext=React.createContext({selectedConversationId:null,setSelectedConversationId:function setSelectedConversationId(id){}});var MessengerProvider=function MessengerProvider(_ref174){var children=_ref174.children;var _React$useState39=React.useState(null),_React$useState40=_slicedToArray2(_React$useState39,2),selectedConversationId=_React$useState40[0],setSelectedConversation=_React$useState40[1];usePresence();var setSelectedConversationId=function setSelectedConversationId(id){setSelectedConversation(id)};return React.createElement(React.Fragment,null,React.createElement(MessengerContext.Provider,{value:{selectedConversationId:selectedConversationId,setSelectedConversationId:setSelectedConversationId}},children))};function useMembers(id,options){var _React$useContext2=React.useContext(WeavyContext),client=_React$useContext2.client;if(!client){throw new Error("useMembers must be used within an WeavyProvider")}var getMembers=function(){var _ref175=_asyncToGenerator(_regeneratorRuntime().mark(function _callee111(){var response,data;return _regeneratorRuntime().wrap(function _callee111$(_context113){while(1)switch(_context113.prev=_context113.next){case 0:_context113.next=2;return client.get("/api/apps/".concat(id,"/members?top=1000"));case 2:response=_context113.sent;_context113.next=5;return response.json();case 5:data=_context113.sent;return _context113.abrupt("return",data);case 7:case"end":return _context113.stop()}},_callee111)}));return function getMembers(){return _ref175.apply(this,arguments)}}();return useQuery(["members",id],getMembers,options)}var Typing=function Typing(_ref176){var children=_ref176.children,id=_ref176.id,context=_ref176.context;var _React$useState41=React.useState([]),_React$useState42=_slicedToArray2(_React$useState41,2),activeTypers=_React$useState42[0],setActiveTypers=_React$useState42[1];var _React$useState43=React.useState(""),_React$useState44=_slicedToArray2(_React$useState43,2),text=_React$useState44[0],setText=_React$useState44[1];var typingTimeout=React.useRef(null);var _React$useContext3=React.useContext(WeavyContext),client=_React$useContext3.client;var _React$useContext4=React.useContext(UserContext),user=_React$useContext4.user;React.useEffect(function(){updateTyping();return function(){clearTimeout(typingTimeout.current)}},[activeTypers,id,context]);React.useEffect(function(){setActiveTypers([]);client===null||client===void 0?void 0:client.subscribe("a".concat(id),"typing",handleTyping);client===null||client===void 0?void 0:client.subscribe("a".concat(id),"message_created",handleStopTyping);return function(){client===null||client===void 0?void 0:client.unsubscribe("a".concat(id),"typing",handleTyping);client===null||client===void 0?void 0:client.unsubscribe("a".concat(id),"message_created",handleStopTyping)}},[id]);var updateTyping=function updateTyping(){var typers=activeTypers;if(typingTimeout.current){clearTimeout(typingTimeout.current);typingTimeout.current=null}var now=Date.now();typers.forEach(function(item,index){if(now-item.time>5*1000){typers.splice(index,1)}});if(typers.length){var dots=Math.round((now-Math.max.apply(null,typers.map(function(x){return x.time})))/1000)%3+1;var ellipsis=".".repeat(dots);var names=typers.map(function(item){return item.display_name}).sort();var typingText="";for(var _i92=0;_i92<names.length;_i92++){if(_i92>0){if(_i92===names.length-1){typingText+=" "+"and"+" "}else{typingText+=", "}}typingText+=names[_i92]}if(names.length===1){typingText+=" "+"is typing"}else{typingText+=" "+"are typing"}setText(typingText+ellipsis);typingTimeout.current=setTimeout(updateTyping,1000)}else{setText("")}};var setTypers=function setTypers(actor){activeTypers.forEach(function(item,index){if(item.member.id===actor.id){setActiveTypers(activeTypers.splice(index,1))}});actor.time=Date.now();setActiveTypers([].concat(_toConsumableArray2(activeTypers),[actor]))};var handleTyping=React.useCallback(function(realtimeEvent){if(realtimeEvent.entity.id===id&&realtimeEvent.actor.id!==user.id){setTypers(realtimeEvent.actor)}},[id,context,activeTypers]);var handleStopTyping=React.useCallback(function(realtimeEvent){if(realtimeEvent.message.app_id===id){setActiveTypers([])}},[id,context,activeTypers]);return React.createElement(React.Fragment,null,React.createElement("span",Object.assign({},text!==""?{}:{"hidden":true}),text),React.createElement("span",Object.assign({},text===""?{}:{"hidden":true}),children))};var Typing$1=React.memo(Typing);var fromEntries=function fromEntries(entries){return entries.reduce(function(acc,_ref){var key=_ref[0],value=_ref[1];acc[key]=value;return acc},{})};var useIsomorphicLayoutEffect=typeof window!=="undefined"&&window.document&&window.document.createElement?React__namespace.useLayoutEffect:React__namespace.useEffect;var top$1="top";var bottom="bottom";var right="right";var left="left";var auto="auto";var basePlacements=[top$1,bottom,right,left];var start="start";var end="end";var clippingParents="clippingParents";var viewport="viewport";var popper="popper";var reference="reference";var variationPlacements=basePlacements.reduce(function(acc,placement){return acc.concat([placement+"-"+start,placement+"-"+end])},[]);var placements=[].concat(basePlacements,[auto]).reduce(function(acc,placement){return acc.concat([placement,placement+"-"+start,placement+"-"+end])},[]);var beforeRead="beforeRead";var read="read";var afterRead="afterRead";var beforeMain="beforeMain";var main="main";var afterMain="afterMain";var beforeWrite="beforeWrite";var write="write";var afterWrite="afterWrite";var modifierPhases=[beforeRead,read,afterRead,beforeMain,main,afterMain,beforeWrite,write,afterWrite];function getNodeName(element){return element?(element.nodeName||"").toLowerCase():null}function getWindow(node){if(node==null){return window}if(node.toString()!=="[object Window]"){var ownerDocument=node.ownerDocument;return ownerDocument?ownerDocument.defaultView||window:window}return node}function isElement(node){var OwnElement=getWindow(node).Element;return node instanceof OwnElement||node instanceof Element}function isHTMLElement(node){var OwnElement=getWindow(node).HTMLElement;return node instanceof OwnElement||node instanceof HTMLElement}function isShadowRoot(node){if(typeof ShadowRoot==="undefined"){return false}var OwnElement=getWindow(node).ShadowRoot;return node instanceof OwnElement||node instanceof ShadowRoot}function applyStyles(_ref){var state=_ref.state;Object.keys(state.elements).forEach(function(name){var style=state.styles[name]||{};var attributes=state.attributes[name]||{};var element=state.elements[name];if(!isHTMLElement(element)||!getNodeName(element)){return}Object.assign(element.style,style);Object.keys(attributes).forEach(function(name){var value=attributes[name];if(value===false){element.removeAttribute(name)}else{element.setAttribute(name,value===true?"":value)}})})}function effect$2(_ref2){var state=_ref2.state;var initialStyles={popper:{position:state.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(state.elements.popper.style,initialStyles.popper);state.styles=initialStyles;if(state.elements.arrow){Object.assign(state.elements.arrow.style,initialStyles.arrow)}return function(){Object.keys(state.elements).forEach(function(name){var element=state.elements[name];var attributes=state.attributes[name]||{};var styleProperties=Object.keys(state.styles.hasOwnProperty(name)?state.styles[name]:initialStyles[name]);var style=styleProperties.reduce(function(style,property){style[property]="";return style},{});if(!isHTMLElement(element)||!getNodeName(element)){return}Object.assign(element.style,style);Object.keys(attributes).forEach(function(attribute){element.removeAttribute(attribute)})})}}var applyStyles$1={name:"applyStyles",enabled:true,phase:"write",fn:applyStyles,effect:effect$2,requires:["computeStyles"]};function getBasePlacement(placement){return placement.split("-")[0]}var max=Math.max;var min=Math.min;var round=Math.round;function getUAString(){var uaData=navigator.userAgentData;if(uaData!=null&&uaData.brands&&Array.isArray(uaData.brands)){return uaData.brands.map(function(item){return item.brand+"/"+item.version}).join(" ")}return navigator.userAgent}function isLayoutViewport(){return!/^((?!chrome|android).)*safari/i.test(getUAString())}function getBoundingClientRect(element,includeScale,isFixedStrategy){if(includeScale===void 0){includeScale=false}if(isFixedStrategy===void 0){isFixedStrategy=false}var clientRect=element.getBoundingClientRect();var scaleX=1;var scaleY=1;if(includeScale&&isHTMLElement(element)){scaleX=element.offsetWidth>0?round(clientRect.width)/element.offsetWidth||1:1;scaleY=element.offsetHeight>0?round(clientRect.height)/element.offsetHeight||1:1}var _ref=isElement(element)?getWindow(element):window,visualViewport=_ref.visualViewport;var addVisualOffsets=!isLayoutViewport()&&isFixedStrategy;var x=(clientRect.left+(addVisualOffsets&&visualViewport?visualViewport.offsetLeft:0))/scaleX;var y=(clientRect.top+(addVisualOffsets&&visualViewport?visualViewport.offsetTop:0))/scaleY;var width=clientRect.width/scaleX;var height=clientRect.height/scaleY;return{width:width,height:height,top:y,right:x+width,bottom:y+height,left:x,x:x,y:y}}function getLayoutRect(element){var clientRect=getBoundingClientRect(element);var width=element.offsetWidth;var height=element.offsetHeight;if(Math.abs(clientRect.width-width)<=1){width=clientRect.width}if(Math.abs(clientRect.height-height)<=1){height=clientRect.height}return{x:element.offsetLeft,y:element.offsetTop,width:width,height:height}}function contains$1(parent,child){var rootNode=child.getRootNode&&child.getRootNode();if(parent.contains(child)){return true}else if(rootNode&&isShadowRoot(rootNode)){var next=child;do{if(next&&parent.isSameNode(next)){return true}next=next.parentNode||next.host}while(next)}return false}function getComputedStyle$1(element){return getWindow(element).getComputedStyle(element)}function isTableElement(element){return["table","td","th"].indexOf(getNodeName(element))>=0}function getDocumentElement(element){return((isElement(element)?element.ownerDocument:element.document)||window.document).documentElement}function getParentNode(element){if(getNodeName(element)==="html"){return element}return element.assignedSlot||element.parentNode||(isShadowRoot(element)?element.host:null)||getDocumentElement(element)}function getTrueOffsetParent(element){if(!isHTMLElement(element)||getComputedStyle$1(element).position==="fixed"){return null}return element.offsetParent}function getContainingBlock(element){var isFirefox=/firefox/i.test(getUAString());var isIE=/Trident/i.test(getUAString());if(isIE&&isHTMLElement(element)){var elementCss=getComputedStyle$1(element);if(elementCss.position==="fixed"){return null}}var currentNode=getParentNode(element);if(isShadowRoot(currentNode)){currentNode=currentNode.host}while(isHTMLElement(currentNode)&&["html","body"].indexOf(getNodeName(currentNode))<0){var css=getComputedStyle$1(currentNode);if(css.transform!=="none"||css.perspective!=="none"||css.contain==="paint"||["transform","perspective"].indexOf(css.willChange)!==-1||isFirefox&&css.willChange==="filter"||isFirefox&&css.filter&&css.filter!=="none"){return currentNode}else{currentNode=currentNode.parentNode}}return null}function getOffsetParent(element){var window=getWindow(element);var offsetParent=getTrueOffsetParent(element);while(offsetParent&&isTableElement(offsetParent)&&getComputedStyle$1(offsetParent).position==="static"){offsetParent=getTrueOffsetParent(offsetParent)}if(offsetParent&&(getNodeName(offsetParent)==="html"||getNodeName(offsetParent)==="body"&&getComputedStyle$1(offsetParent).position==="static")){return window}return offsetParent||getContainingBlock(element)||window}function getMainAxisFromPlacement(placement){return["top","bottom"].indexOf(placement)>=0?"x":"y"}function within(min$1,value,max$1){return max(min$1,min(value,max$1))}function withinMaxClamp(min,value,max){var v=within(min,value,max);return v>max?max:v}function getFreshSideObject(){return{top:0,right:0,bottom:0,left:0}}function mergePaddingObject(paddingObject){return Object.assign({},getFreshSideObject(),paddingObject)}function expandToHashMap(value,keys){return keys.reduce(function(hashMap,key){hashMap[key]=value;return hashMap},{})}var toPaddingObject=function toPaddingObject(padding,state){padding=typeof padding==="function"?padding(Object.assign({},state.rects,{placement:state.placement})):padding;return mergePaddingObject(typeof padding!=="number"?padding:expandToHashMap(padding,basePlacements))};function arrow(_ref){var _state$modifiersData$;var state=_ref.state,name=_ref.name,options=_ref.options;var arrowElement=state.elements.arrow;var popperOffsets=state.modifiersData.popperOffsets;var basePlacement=getBasePlacement(state.placement);var axis=getMainAxisFromPlacement(basePlacement);var isVertical=[left,right].indexOf(basePlacement)>=0;var len=isVertical?"height":"width";if(!arrowElement||!popperOffsets){return}var paddingObject=toPaddingObject(options.padding,state);var arrowRect=getLayoutRect(arrowElement);var minProp=axis==="y"?top$1:left;var maxProp=axis==="y"?bottom:right;var endDiff=state.rects.reference[len]+state.rects.reference[axis]-popperOffsets[axis]-state.rects.popper[len];var startDiff=popperOffsets[axis]-state.rects.reference[axis];var arrowOffsetParent=getOffsetParent(arrowElement);var clientSize=arrowOffsetParent?axis==="y"?arrowOffsetParent.clientHeight||0:arrowOffsetParent.clientWidth||0:0;var centerToReference=endDiff/2-startDiff/2;var min=paddingObject[minProp];var max=clientSize-arrowRect[len]-paddingObject[maxProp];var center=clientSize/2-arrowRect[len]/2+centerToReference;var offset=within(min,center,max);var axisProp=axis;state.modifiersData[name]=(_state$modifiersData$={},_state$modifiersData$[axisProp]=offset,_state$modifiersData$.centerOffset=offset-center,_state$modifiersData$)}function effect$1(_ref2){var state=_ref2.state,options=_ref2.options;var _options$element=options.element,arrowElement=_options$element===void 0?"[data-popper-arrow]":_options$element;if(arrowElement==null){return}if(typeof arrowElement==="string"){arrowElement=state.elements.popper.querySelector(arrowElement);if(!arrowElement){return}}if(!contains$1(state.elements.popper,arrowElement)){return}state.elements.arrow=arrowElement}var arrow$1={name:"arrow",enabled:true,phase:"main",fn:arrow,effect:effect$1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function getVariation(placement){return placement.split("-")[1]}var unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function roundOffsetsByDPR(_ref,win){var x=_ref.x,y=_ref.y;var dpr=win.devicePixelRatio||1;return{x:round(x*dpr)/dpr||0,y:round(y*dpr)/dpr||0}}function mapToStyles(_ref2){var _Object$assign2;var popper=_ref2.popper,popperRect=_ref2.popperRect,placement=_ref2.placement,variation=_ref2.variation,offsets=_ref2.offsets,position=_ref2.position,gpuAcceleration=_ref2.gpuAcceleration,adaptive=_ref2.adaptive,roundOffsets=_ref2.roundOffsets,isFixed=_ref2.isFixed;var _offsets$x=offsets.x,x=_offsets$x===void 0?0:_offsets$x,_offsets$y=offsets.y,y=_offsets$y===void 0?0:_offsets$y;var _ref3=typeof roundOffsets==="function"?roundOffsets({x:x,y:y}):{x:x,y:y};x=_ref3.x;y=_ref3.y;var hasX=offsets.hasOwnProperty("x");var hasY=offsets.hasOwnProperty("y");var sideX=left;var sideY=top$1;var win=window;if(adaptive){var offsetParent=getOffsetParent(popper);var heightProp="clientHeight";var widthProp="clientWidth";if(offsetParent===getWindow(popper)){offsetParent=getDocumentElement(popper);if(getComputedStyle$1(offsetParent).position!=="static"&&position==="absolute"){heightProp="scrollHeight";widthProp="scrollWidth"}}offsetParent=offsetParent;if(placement===top$1||(placement===left||placement===right)&&variation===end){sideY=bottom;var offsetY=isFixed&&offsetParent===win&&win.visualViewport?win.visualViewport.height:offsetParent[heightProp];y-=offsetY-popperRect.height;y*=gpuAcceleration?1:-1}if(placement===left||(placement===top$1||placement===bottom)&&variation===end){sideX=right;var offsetX=isFixed&&offsetParent===win&&win.visualViewport?win.visualViewport.width:offsetParent[widthProp];x-=offsetX-popperRect.width;x*=gpuAcceleration?1:-1}}var commonStyles=Object.assign({position:position},adaptive&&unsetSides);var _ref4=roundOffsets===true?roundOffsetsByDPR({x:x,y:y},getWindow(popper)):{x:x,y:y};x=_ref4.x;y=_ref4.y;if(gpuAcceleration){var _Object$assign;return Object.assign({},commonStyles,(_Object$assign={},_Object$assign[sideY]=hasY?"0":"",_Object$assign[sideX]=hasX?"0":"",_Object$assign.transform=(win.devicePixelRatio||1)<=1?"translate("+x+"px, "+y+"px)":"translate3d("+x+"px, "+y+"px, 0)",_Object$assign))}return Object.assign({},commonStyles,(_Object$assign2={},_Object$assign2[sideY]=hasY?y+"px":"",_Object$assign2[sideX]=hasX?x+"px":"",_Object$assign2.transform="",_Object$assign2))}function computeStyles(_ref5){var state=_ref5.state,options=_ref5.options;var _options$gpuAccelerat=options.gpuAcceleration,gpuAcceleration=_options$gpuAccelerat===void 0?true:_options$gpuAccelerat,_options$adaptive=options.adaptive,adaptive=_options$adaptive===void 0?true:_options$adaptive,_options$roundOffsets=options.roundOffsets,roundOffsets=_options$roundOffsets===void 0?true:_options$roundOffsets;var commonStyles={placement:getBasePlacement(state.placement),variation:getVariation(state.placement),popper:state.elements.popper,popperRect:state.rects.popper,gpuAcceleration:gpuAcceleration,isFixed:state.options.strategy==="fixed"};if(state.modifiersData.popperOffsets!=null){state.styles.popper=Object.assign({},state.styles.popper,mapToStyles(Object.assign({},commonStyles,{offsets:state.modifiersData.popperOffsets,position:state.options.strategy,adaptive:adaptive,roundOffsets:roundOffsets})))}if(state.modifiersData.arrow!=null){state.styles.arrow=Object.assign({},state.styles.arrow,mapToStyles(Object.assign({},commonStyles,{offsets:state.modifiersData.arrow,position:"absolute",adaptive:false,roundOffsets:roundOffsets})))}state.attributes.popper=Object.assign({},state.attributes.popper,{"data-popper-placement":state.placement})}var computeStyles$1={name:"computeStyles",enabled:true,phase:"beforeWrite",fn:computeStyles,data:{}};var passive={passive:true};function effect(_ref){var state=_ref.state,instance=_ref.instance,options=_ref.options;var _options$scroll=options.scroll,scroll=_options$scroll===void 0?true:_options$scroll,_options$resize=options.resize,resize=_options$resize===void 0?true:_options$resize;var window=getWindow(state.elements.popper);var scrollParents=[].concat(state.scrollParents.reference,state.scrollParents.popper);if(scroll){scrollParents.forEach(function(scrollParent){scrollParent.addEventListener("scroll",instance.update,passive)})}if(resize){window.addEventListener("resize",instance.update,passive)}return function(){if(scroll){scrollParents.forEach(function(scrollParent){scrollParent.removeEventListener("scroll",instance.update,passive)})}if(resize){window.removeEventListener("resize",instance.update,passive)}}}var eventListeners={name:"eventListeners",enabled:true,phase:"write",fn:function fn(){},effect:effect,data:{}};var hash$2={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(placement){return placement.replace(/left|right|bottom|top/g,function(matched){return hash$2[matched]})}var hash$1={start:"end",end:"start"};function getOppositeVariationPlacement(placement){return placement.replace(/start|end/g,function(matched){return hash$1[matched]})}function getWindowScroll(node){var win=getWindow(node);var scrollLeft=win.pageXOffset;var scrollTop=win.pageYOffset;return{scrollLeft:scrollLeft,scrollTop:scrollTop}}function getWindowScrollBarX(element){return getBoundingClientRect(getDocumentElement(element)).left+getWindowScroll(element).scrollLeft}function getViewportRect(element,strategy){var win=getWindow(element);var html=getDocumentElement(element);var visualViewport=win.visualViewport;var width=html.clientWidth;var height=html.clientHeight;var x=0;var y=0;if(visualViewport){width=visualViewport.width;height=visualViewport.height;var layoutViewport=isLayoutViewport();if(layoutViewport||!layoutViewport&&strategy==="fixed"){x=visualViewport.offsetLeft;y=visualViewport.offsetTop}}return{width:width,height:height,x:x+getWindowScrollBarX(element),y:y}}function getDocumentRect(element){var _element$ownerDocumen;var html=getDocumentElement(element);var winScroll=getWindowScroll(element);var body=(_element$ownerDocumen=element.ownerDocument)==null?void 0:_element$ownerDocumen.body;var width=max(html.scrollWidth,html.clientWidth,body?body.scrollWidth:0,body?body.clientWidth:0);var height=max(html.scrollHeight,html.clientHeight,body?body.scrollHeight:0,body?body.clientHeight:0);var x=-winScroll.scrollLeft+getWindowScrollBarX(element);var y=-winScroll.scrollTop;if(getComputedStyle$1(body||html).direction==="rtl"){x+=max(html.clientWidth,body?body.clientWidth:0)-width}return{width:width,height:height,x:x,y:y}}function isScrollParent(element){var _getComputedStyle=getComputedStyle$1(element),overflow=_getComputedStyle.overflow,overflowX=_getComputedStyle.overflowX,overflowY=_getComputedStyle.overflowY;return /auto|scroll|overlay|hidden/.test(overflow+overflowY+overflowX)}function getScrollParent$1(node){if(["html","body","#document"].indexOf(getNodeName(node))>=0){return node.ownerDocument.body}if(isHTMLElement(node)&&isScrollParent(node)){return node}return getScrollParent$1(getParentNode(node))}function listScrollParents(element,list){var _element$ownerDocumen;if(list===void 0){list=[]}var scrollParent=getScrollParent$1(element);var isBody=scrollParent===((_element$ownerDocumen=element.ownerDocument)==null?void 0:_element$ownerDocumen.body);var win=getWindow(scrollParent);var target=isBody?[win].concat(win.visualViewport||[],isScrollParent(scrollParent)?scrollParent:[]):scrollParent;var updatedList=list.concat(target);return isBody?updatedList:updatedList.concat(listScrollParents(getParentNode(target)))}function rectToClientRect(rect){return Object.assign({},rect,{left:rect.x,top:rect.y,right:rect.x+rect.width,bottom:rect.y+rect.height})}function getInnerBoundingClientRect(element,strategy){var rect=getBoundingClientRect(element,false,strategy==="fixed");rect.top=rect.top+element.clientTop;rect.left=rect.left+element.clientLeft;rect.bottom=rect.top+element.clientHeight;rect.right=rect.left+element.clientWidth;rect.width=element.clientWidth;rect.height=element.clientHeight;rect.x=rect.left;rect.y=rect.top;return rect}function getClientRectFromMixedType(element,clippingParent,strategy){return clippingParent===viewport?rectToClientRect(getViewportRect(element,strategy)):isElement(clippingParent)?getInnerBoundingClientRect(clippingParent,strategy):rectToClientRect(getDocumentRect(getDocumentElement(element)))}function getClippingParents(element){var clippingParents=listScrollParents(getParentNode(element));var canEscapeClipping=["absolute","fixed"].indexOf(getComputedStyle$1(element).position)>=0;var clipperElement=canEscapeClipping&&isHTMLElement(element)?getOffsetParent(element):element;if(!isElement(clipperElement)){return[]}return clippingParents.filter(function(clippingParent){return isElement(clippingParent)&&contains$1(clippingParent,clipperElement)&&getNodeName(clippingParent)!=="body"})}function getClippingRect(element,boundary,rootBoundary,strategy){var mainClippingParents=boundary==="clippingParents"?getClippingParents(element):[].concat(boundary);var clippingParents=[].concat(mainClippingParents,[rootBoundary]);var firstClippingParent=clippingParents[0];var clippingRect=clippingParents.reduce(function(accRect,clippingParent){var rect=getClientRectFromMixedType(element,clippingParent,strategy);accRect.top=max(rect.top,accRect.top);accRect.right=min(rect.right,accRect.right);accRect.bottom=min(rect.bottom,accRect.bottom);accRect.left=max(rect.left,accRect.left);return accRect},getClientRectFromMixedType(element,firstClippingParent,strategy));clippingRect.width=clippingRect.right-clippingRect.left;clippingRect.height=clippingRect.bottom-clippingRect.top;clippingRect.x=clippingRect.left;clippingRect.y=clippingRect.top;return clippingRect}function computeOffsets(_ref){var reference=_ref.reference,element=_ref.element,placement=_ref.placement;var basePlacement=placement?getBasePlacement(placement):null;var variation=placement?getVariation(placement):null;var commonX=reference.x+reference.width/2-element.width/2;var commonY=reference.y+reference.height/2-element.height/2;var offsets;switch(basePlacement){case top$1:offsets={x:commonX,y:reference.y-element.height};break;case bottom:offsets={x:commonX,y:reference.y+reference.height};break;case right:offsets={x:reference.x+reference.width,y:commonY};break;case left:offsets={x:reference.x-element.width,y:commonY};break;default:offsets={x:reference.x,y:reference.y}}var mainAxis=basePlacement?getMainAxisFromPlacement(basePlacement):null;if(mainAxis!=null){var len=mainAxis==="y"?"height":"width";switch(variation){case start:offsets[mainAxis]=offsets[mainAxis]-(reference[len]/2-element[len]/2);break;case end:offsets[mainAxis]=offsets[mainAxis]+(reference[len]/2-element[len]/2);break}}return offsets}function detectOverflow(state,options){if(options===void 0){options={}}var _options=options,_options$placement=_options.placement,placement=_options$placement===void 0?state.placement:_options$placement,_options$strategy=_options.strategy,strategy=_options$strategy===void 0?state.strategy:_options$strategy,_options$boundary=_options.boundary,boundary=_options$boundary===void 0?clippingParents:_options$boundary,_options$rootBoundary=_options.rootBoundary,rootBoundary=_options$rootBoundary===void 0?viewport:_options$rootBoundary,_options$elementConte=_options.elementContext,elementContext=_options$elementConte===void 0?popper:_options$elementConte,_options$altBoundary=_options.altBoundary,altBoundary=_options$altBoundary===void 0?false:_options$altBoundary,_options$padding=_options.padding,padding=_options$padding===void 0?0:_options$padding;var paddingObject=mergePaddingObject(typeof padding!=="number"?padding:expandToHashMap(padding,basePlacements));var altContext=elementContext===popper?reference:popper;var popperRect=state.rects.popper;var element=state.elements[altBoundary?altContext:elementContext];var clippingClientRect=getClippingRect(isElement(element)?element:element.contextElement||getDocumentElement(state.elements.popper),boundary,rootBoundary,strategy);var referenceClientRect=getBoundingClientRect(state.elements.reference);var popperOffsets=computeOffsets({reference:referenceClientRect,element:popperRect,strategy:"absolute",placement:placement});var popperClientRect=rectToClientRect(Object.assign({},popperRect,popperOffsets));var elementClientRect=elementContext===popper?popperClientRect:referenceClientRect;var overflowOffsets={top:clippingClientRect.top-elementClientRect.top+paddingObject.top,bottom:elementClientRect.bottom-clippingClientRect.bottom+paddingObject.bottom,left:clippingClientRect.left-elementClientRect.left+paddingObject.left,right:elementClientRect.right-clippingClientRect.right+paddingObject.right};var offsetData=state.modifiersData.offset;if(elementContext===popper&&offsetData){var offset=offsetData[placement];Object.keys(overflowOffsets).forEach(function(key){var multiply=[right,bottom].indexOf(key)>=0?1:-1;var axis=[top$1,bottom].indexOf(key)>=0?"y":"x";overflowOffsets[key]+=offset[axis]*multiply})}return overflowOffsets}function computeAutoPlacement(state,options){if(options===void 0){options={}}var _options=options,placement=_options.placement,boundary=_options.boundary,rootBoundary=_options.rootBoundary,padding=_options.padding,flipVariations=_options.flipVariations,_options$allowedAutoP=_options.allowedAutoPlacements,allowedAutoPlacements=_options$allowedAutoP===void 0?placements:_options$allowedAutoP;var variation=getVariation(placement);var placements$1=variation?flipVariations?variationPlacements:variationPlacements.filter(function(placement){return getVariation(placement)===variation}):basePlacements;var allowedPlacements=placements$1.filter(function(placement){return allowedAutoPlacements.indexOf(placement)>=0});if(allowedPlacements.length===0){allowedPlacements=placements$1}var overflows=allowedPlacements.reduce(function(acc,placement){acc[placement]=detectOverflow(state,{placement:placement,boundary:boundary,rootBoundary:rootBoundary,padding:padding})[getBasePlacement(placement)];return acc},{});return Object.keys(overflows).sort(function(a,b){return overflows[a]-overflows[b]})}function getExpandedFallbackPlacements(placement){if(getBasePlacement(placement)===auto){return[]}var oppositePlacement=getOppositePlacement(placement);return[getOppositeVariationPlacement(placement),oppositePlacement,getOppositeVariationPlacement(oppositePlacement)]}function flip(_ref){var state=_ref.state,options=_ref.options,name=_ref.name;if(state.modifiersData[name]._skip){return}var _options$mainAxis=options.mainAxis,checkMainAxis=_options$mainAxis===void 0?true:_options$mainAxis,_options$altAxis=options.altAxis,checkAltAxis=_options$altAxis===void 0?true:_options$altAxis,specifiedFallbackPlacements=options.fallbackPlacements,padding=options.padding,boundary=options.boundary,rootBoundary=options.rootBoundary,altBoundary=options.altBoundary,_options$flipVariatio=options.flipVariations,flipVariations=_options$flipVariatio===void 0?true:_options$flipVariatio,allowedAutoPlacements=options.allowedAutoPlacements;var preferredPlacement=state.options.placement;var basePlacement=getBasePlacement(preferredPlacement);var isBasePlacement=basePlacement===preferredPlacement;var fallbackPlacements=specifiedFallbackPlacements||(isBasePlacement||!flipVariations?[getOppositePlacement(preferredPlacement)]:getExpandedFallbackPlacements(preferredPlacement));var placements=[preferredPlacement].concat(fallbackPlacements).reduce(function(acc,placement){return acc.concat(getBasePlacement(placement)===auto?computeAutoPlacement(state,{placement:placement,boundary:boundary,rootBoundary:rootBoundary,padding:padding,flipVariations:flipVariations,allowedAutoPlacements:allowedAutoPlacements}):placement)},[]);var referenceRect=state.rects.reference;var popperRect=state.rects.popper;var checksMap=new Map;var makeFallbackChecks=true;var firstFittingPlacement=placements[0];for(var i=0;i<placements.length;i++){var placement=placements[i];var _basePlacement=getBasePlacement(placement);var isStartVariation=getVariation(placement)===start;var isVertical=[top$1,bottom].indexOf(_basePlacement)>=0;var len=isVertical?"width":"height";var overflow=detectOverflow(state,{placement:placement,boundary:boundary,rootBoundary:rootBoundary,altBoundary:altBoundary,padding:padding});var mainVariationSide=isVertical?isStartVariation?right:left:isStartVariation?bottom:top$1;if(referenceRect[len]>popperRect[len]){mainVariationSide=getOppositePlacement(mainVariationSide)}var altVariationSide=getOppositePlacement(mainVariationSide);var checks=[];if(checkMainAxis){checks.push(overflow[_basePlacement]<=0)}if(checkAltAxis){checks.push(overflow[mainVariationSide]<=0,overflow[altVariationSide]<=0)}if(checks.every(function(check){return check})){firstFittingPlacement=placement;makeFallbackChecks=false;break}checksMap.set(placement,checks)}if(makeFallbackChecks){var numberOfChecks=flipVariations?3:1;var _loop=function _loop(_i){var fittingPlacement=placements.find(function(placement){var checks=checksMap.get(placement);if(checks){return checks.slice(0,_i).every(function(check){return check})}});if(fittingPlacement){firstFittingPlacement=fittingPlacement;return"break"}};for(var _i=numberOfChecks;_i>0;_i--){var _ret=_loop(_i);if(_ret==="break")break}}if(state.placement!==firstFittingPlacement){state.modifiersData[name]._skip=true;state.placement=firstFittingPlacement;state.reset=true}}var flip$1={name:"flip",enabled:true,phase:"main",fn:flip,requiresIfExists:["offset"],data:{_skip:false}};function getSideOffsets(overflow,rect,preventedOffsets){if(preventedOffsets===void 0){preventedOffsets={x:0,y:0}}return{top:overflow.top-rect.height-preventedOffsets.y,right:overflow.right-rect.width+preventedOffsets.x,bottom:overflow.bottom-rect.height+preventedOffsets.y,left:overflow.left-rect.width-preventedOffsets.x}}function isAnySideFullyClipped(overflow){return[top$1,right,bottom,left].some(function(side){return overflow[side]>=0})}function hide(_ref){var state=_ref.state,name=_ref.name;var referenceRect=state.rects.reference;var popperRect=state.rects.popper;var preventedOffsets=state.modifiersData.preventOverflow;var referenceOverflow=detectOverflow(state,{elementContext:"reference"});var popperAltOverflow=detectOverflow(state,{altBoundary:true});var referenceClippingOffsets=getSideOffsets(referenceOverflow,referenceRect);var popperEscapeOffsets=getSideOffsets(popperAltOverflow,popperRect,preventedOffsets);var isReferenceHidden=isAnySideFullyClipped(referenceClippingOffsets);var hasPopperEscaped=isAnySideFullyClipped(popperEscapeOffsets);state.modifiersData[name]={referenceClippingOffsets:referenceClippingOffsets,popperEscapeOffsets:popperEscapeOffsets,isReferenceHidden:isReferenceHidden,hasPopperEscaped:hasPopperEscaped};state.attributes.popper=Object.assign({},state.attributes.popper,{"data-popper-reference-hidden":isReferenceHidden,"data-popper-escaped":hasPopperEscaped})}var hide$1={name:"hide",enabled:true,phase:"main",requiresIfExists:["preventOverflow"],fn:hide};function distanceAndSkiddingToXY(placement,rects,offset){var basePlacement=getBasePlacement(placement);var invertDistance=[left,top$1].indexOf(basePlacement)>=0?-1:1;var _ref=typeof offset==="function"?offset(Object.assign({},rects,{placement:placement})):offset,skidding=_ref[0],distance=_ref[1];skidding=skidding||0;distance=(distance||0)*invertDistance;return[left,right].indexOf(basePlacement)>=0?{x:distance,y:skidding}:{x:skidding,y:distance}}function offset(_ref2){var state=_ref2.state,options=_ref2.options,name=_ref2.name;var _options$offset=options.offset,offset=_options$offset===void 0?[0,0]:_options$offset;var data=placements.reduce(function(acc,placement){acc[placement]=distanceAndSkiddingToXY(placement,state.rects,offset);return acc},{});var _data$state$placement=data[state.placement],x=_data$state$placement.x,y=_data$state$placement.y;if(state.modifiersData.popperOffsets!=null){state.modifiersData.popperOffsets.x+=x;state.modifiersData.popperOffsets.y+=y}state.modifiersData[name]=data}var offset$1={name:"offset",enabled:true,phase:"main",requires:["popperOffsets"],fn:offset};function popperOffsets(_ref){var state=_ref.state,name=_ref.name;state.modifiersData[name]=computeOffsets({reference:state.rects.reference,element:state.rects.popper,strategy:"absolute",placement:state.placement})}var popperOffsets$1={name:"popperOffsets",enabled:true,phase:"read",fn:popperOffsets,data:{}};function getAltAxis(axis){return axis==="x"?"y":"x"}function preventOverflow(_ref){var state=_ref.state,options=_ref.options,name=_ref.name;var _options$mainAxis=options.mainAxis,checkMainAxis=_options$mainAxis===void 0?true:_options$mainAxis,_options$altAxis=options.altAxis,checkAltAxis=_options$altAxis===void 0?false:_options$altAxis,boundary=options.boundary,rootBoundary=options.rootBoundary,altBoundary=options.altBoundary,padding=options.padding,_options$tether=options.tether,tether=_options$tether===void 0?true:_options$tether,_options$tetherOffset=options.tetherOffset,tetherOffset=_options$tetherOffset===void 0?0:_options$tetherOffset;var overflow=detectOverflow(state,{boundary:boundary,rootBoundary:rootBoundary,padding:padding,altBoundary:altBoundary});var basePlacement=getBasePlacement(state.placement);var variation=getVariation(state.placement);var isBasePlacement=!variation;var mainAxis=getMainAxisFromPlacement(basePlacement);var altAxis=getAltAxis(mainAxis);var popperOffsets=state.modifiersData.popperOffsets;var referenceRect=state.rects.reference;var popperRect=state.rects.popper;var tetherOffsetValue=typeof tetherOffset==="function"?tetherOffset(Object.assign({},state.rects,{placement:state.placement})):tetherOffset;var normalizedTetherOffsetValue=typeof tetherOffsetValue==="number"?{mainAxis:tetherOffsetValue,altAxis:tetherOffsetValue}:Object.assign({mainAxis:0,altAxis:0},tetherOffsetValue);var offsetModifierState=state.modifiersData.offset?state.modifiersData.offset[state.placement]:null;var data={x:0,y:0};if(!popperOffsets){return}if(checkMainAxis){var _offsetModifierState$;var mainSide=mainAxis==="y"?top$1:left;var altSide=mainAxis==="y"?bottom:right;var len=mainAxis==="y"?"height":"width";var offset=popperOffsets[mainAxis];var min$1=offset+overflow[mainSide];var max$1=offset-overflow[altSide];var additive=tether?-popperRect[len]/2:0;var minLen=variation===start?referenceRect[len]:popperRect[len];var maxLen=variation===start?-popperRect[len]:-referenceRect[len];var arrowElement=state.elements.arrow;var arrowRect=tether&&arrowElement?getLayoutRect(arrowElement):{width:0,height:0};var arrowPaddingObject=state.modifiersData["arrow#persistent"]?state.modifiersData["arrow#persistent"].padding:getFreshSideObject();var arrowPaddingMin=arrowPaddingObject[mainSide];var arrowPaddingMax=arrowPaddingObject[altSide];var arrowLen=within(0,referenceRect[len],arrowRect[len]);var minOffset=isBasePlacement?referenceRect[len]/2-additive-arrowLen-arrowPaddingMin-normalizedTetherOffsetValue.mainAxis:minLen-arrowLen-arrowPaddingMin-normalizedTetherOffsetValue.mainAxis;var maxOffset=isBasePlacement?-referenceRect[len]/2+additive+arrowLen+arrowPaddingMax+normalizedTetherOffsetValue.mainAxis:maxLen+arrowLen+arrowPaddingMax+normalizedTetherOffsetValue.mainAxis;var arrowOffsetParent=state.elements.arrow&&getOffsetParent(state.elements.arrow);var clientOffset=arrowOffsetParent?mainAxis==="y"?arrowOffsetParent.clientTop||0:arrowOffsetParent.clientLeft||0:0;var offsetModifierValue=(_offsetModifierState$=offsetModifierState==null?void 0:offsetModifierState[mainAxis])!=null?_offsetModifierState$:0;var tetherMin=offset+minOffset-offsetModifierValue-clientOffset;var tetherMax=offset+maxOffset-offsetModifierValue;var preventedOffset=within(tether?min(min$1,tetherMin):min$1,offset,tether?max(max$1,tetherMax):max$1);popperOffsets[mainAxis]=preventedOffset;data[mainAxis]=preventedOffset-offset}if(checkAltAxis){var _offsetModifierState$2;var _mainSide=mainAxis==="x"?top$1:left;var _altSide=mainAxis==="x"?bottom:right;var _offset=popperOffsets[altAxis];var _len=altAxis==="y"?"height":"width";var _min=_offset+overflow[_mainSide];var _max=_offset-overflow[_altSide];var isOriginSide=[top$1,left].indexOf(basePlacement)!==-1;var _offsetModifierValue=(_offsetModifierState$2=offsetModifierState==null?void 0:offsetModifierState[altAxis])!=null?_offsetModifierState$2:0;var _tetherMin=isOriginSide?_min:_offset-referenceRect[_len]-popperRect[_len]-_offsetModifierValue+normalizedTetherOffsetValue.altAxis;var _tetherMax=isOriginSide?_offset+referenceRect[_len]+popperRect[_len]-_offsetModifierValue-normalizedTetherOffsetValue.altAxis:_max;var _preventedOffset=tether&&isOriginSide?withinMaxClamp(_tetherMin,_offset,_tetherMax):within(tether?_tetherMin:_min,_offset,tether?_tetherMax:_max);popperOffsets[altAxis]=_preventedOffset;data[altAxis]=_preventedOffset-_offset}state.modifiersData[name]=data}var preventOverflow$1={name:"preventOverflow",enabled:true,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};function getHTMLElementScroll(element){return{scrollLeft:element.scrollLeft,scrollTop:element.scrollTop}}function getNodeScroll(node){if(node===getWindow(node)||!isHTMLElement(node)){return getWindowScroll(node)}else{return getHTMLElementScroll(node)}}function isElementScaled(element){var rect=element.getBoundingClientRect();var scaleX=round(rect.width)/element.offsetWidth||1;var scaleY=round(rect.height)/element.offsetHeight||1;return scaleX!==1||scaleY!==1}function getCompositeRect(elementOrVirtualElement,offsetParent,isFixed){if(isFixed===void 0){isFixed=false}var isOffsetParentAnElement=isHTMLElement(offsetParent);var offsetParentIsScaled=isHTMLElement(offsetParent)&&isElementScaled(offsetParent);var documentElement=getDocumentElement(offsetParent);var rect=getBoundingClientRect(elementOrVirtualElement,offsetParentIsScaled,isFixed);var scroll={scrollLeft:0,scrollTop:0};var offsets={x:0,y:0};if(isOffsetParentAnElement||!isOffsetParentAnElement&&!isFixed){if(getNodeName(offsetParent)!=="body"||isScrollParent(documentElement)){scroll=getNodeScroll(offsetParent)}if(isHTMLElement(offsetParent)){offsets=getBoundingClientRect(offsetParent,true);offsets.x+=offsetParent.clientLeft;offsets.y+=offsetParent.clientTop}else if(documentElement){offsets.x=getWindowScrollBarX(documentElement)}}return{x:rect.left+scroll.scrollLeft-offsets.x,y:rect.top+scroll.scrollTop-offsets.y,width:rect.width,height:rect.height}}function order(modifiers){var map=new Map;var visited=new Set;var result=[];modifiers.forEach(function(modifier){map.set(modifier.name,modifier)});function sort(modifier){visited.add(modifier.name);var requires=[].concat(modifier.requires||[],modifier.requiresIfExists||[]);requires.forEach(function(dep){if(!visited.has(dep)){var depModifier=map.get(dep);if(depModifier){sort(depModifier)}}});result.push(modifier)}modifiers.forEach(function(modifier){if(!visited.has(modifier.name)){sort(modifier)}});return result}function orderModifiers(modifiers){var orderedModifiers=order(modifiers);return modifierPhases.reduce(function(acc,phase){return acc.concat(orderedModifiers.filter(function(modifier){return modifier.phase===phase}))},[])}function debounce$2(fn){var pending;return function(){if(!pending){pending=new Promise(function(resolve){Promise.resolve().then(function(){pending=undefined;resolve(fn())})})}return pending}}function mergeByName(modifiers){var merged=modifiers.reduce(function(merged,current){var existing=merged[current.name];merged[current.name]=existing?Object.assign({},existing,current,{options:Object.assign({},existing.options,current.options),data:Object.assign({},existing.data,current.data)}):current;return merged},{});return Object.keys(merged).map(function(key){return merged[key]})}var DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return!args.some(function(element){return!(element&&typeof element.getBoundingClientRect==="function")})}function popperGenerator(generatorOptions){if(generatorOptions===void 0){generatorOptions={}}var _generatorOptions=generatorOptions,_generatorOptions$def=_generatorOptions.defaultModifiers,defaultModifiers=_generatorOptions$def===void 0?[]:_generatorOptions$def,_generatorOptions$def2=_generatorOptions.defaultOptions,defaultOptions=_generatorOptions$def2===void 0?DEFAULT_OPTIONS:_generatorOptions$def2;return function createPopper(reference,popper,options){if(options===void 0){options=defaultOptions}var state={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,defaultOptions),modifiersData:{},elements:{reference:reference,popper:popper},attributes:{},styles:{}};var effectCleanupFns=[];var isDestroyed=false;var instance={state:state,setOptions:function setOptions(setOptionsAction){var options=typeof setOptionsAction==="function"?setOptionsAction(state.options):setOptionsAction;cleanupModifierEffects();state.options=Object.assign({},defaultOptions,state.options,options);state.scrollParents={reference:isElement(reference)?listScrollParents(reference):reference.contextElement?listScrollParents(reference.contextElement):[],popper:listScrollParents(popper)};var orderedModifiers=orderModifiers(mergeByName([].concat(defaultModifiers,state.options.modifiers)));state.orderedModifiers=orderedModifiers.filter(function(m){return m.enabled});runModifierEffects();return instance.update()},forceUpdate:function forceUpdate(){if(isDestroyed){return}var _state$elements=state.elements,reference=_state$elements.reference,popper=_state$elements.popper;if(!areValidElements(reference,popper)){return}state.rects={reference:getCompositeRect(reference,getOffsetParent(popper),state.options.strategy==="fixed"),popper:getLayoutRect(popper)};state.reset=false;state.placement=state.options.placement;state.orderedModifiers.forEach(function(modifier){return state.modifiersData[modifier.name]=Object.assign({},modifier.data)});for(var index=0;index<state.orderedModifiers.length;index++){if(state.reset===true){state.reset=false;index=-1;continue}var _state$orderedModifie=state.orderedModifiers[index],fn=_state$orderedModifie.fn,_state$orderedModifie2=_state$orderedModifie.options,_options=_state$orderedModifie2===void 0?{}:_state$orderedModifie2,name=_state$orderedModifie.name;if(typeof fn==="function"){state=fn({state:state,options:_options,name:name,instance:instance})||state}}},update:debounce$2(function(){return new Promise(function(resolve){instance.forceUpdate();resolve(state)})}),destroy:function destroy(){cleanupModifierEffects();isDestroyed=true}};if(!areValidElements(reference,popper)){return instance}instance.setOptions(options).then(function(state){if(!isDestroyed&&options.onFirstUpdate){options.onFirstUpdate(state)}});function runModifierEffects(){state.orderedModifiers.forEach(function(_ref){var name=_ref.name,_ref$options=_ref.options,options=_ref$options===void 0?{}:_ref$options,effect=_ref.effect;if(typeof effect==="function"){var cleanupFn=effect({state:state,name:name,instance:instance,options:options});var noopFn=function noopFn(){};effectCleanupFns.push(cleanupFn||noopFn)}})}function cleanupModifierEffects(){effectCleanupFns.forEach(function(fn){return fn()});effectCleanupFns=[]}return instance}}var defaultModifiers=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1,offset$1,flip$1,preventOverflow$1,arrow$1,hide$1];var createPopper=popperGenerator({defaultModifiers:defaultModifiers});var hasElementType=typeof Element!=="undefined";var hasMap=typeof Map==="function";var hasSet=typeof Set==="function";var hasArrayBuffer=typeof ArrayBuffer==="function"&&!!ArrayBuffer.isView;function equal(a,b){if(a===b)return true;if(a&&b&&_typeof2(a)=="object"&&_typeof2(b)=="object"){if(a.constructor!==b.constructor)return false;var length,i,keys;if(Array.isArray(a)){length=a.length;if(length!=b.length)return false;for(i=length;i--!==0;)if(!equal(a[i],b[i]))return false;return true}var it;if(hasMap&&a instanceof Map&&b instanceof Map){if(a.size!==b.size)return false;it=a.entries();while(!(i=it.next()).done)if(!b.has(i.value[0]))return false;it=a.entries();while(!(i=it.next()).done)if(!equal(i.value[1],b.get(i.value[0])))return false;return true}if(hasSet&&a instanceof Set&&b instanceof Set){if(a.size!==b.size)return false;it=a.entries();while(!(i=it.next()).done)if(!b.has(i.value[0]))return false;return true}if(hasArrayBuffer&&ArrayBuffer.isView(a)&&ArrayBuffer.isView(b)){length=a.length;if(length!=b.length)return false;for(i=length;i--!==0;)if(a[i]!==b[i])return false;return true}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf&&typeof a.valueOf==="function"&&typeof b.valueOf==="function")return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString&&typeof a.toString==="function"&&typeof b.toString==="function")return a.toString()===b.toString();keys=Object.keys(a);length=keys.length;if(length!==Object.keys(b).length)return false;for(i=length;i--!==0;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return false;if(hasElementType&&a instanceof Element)return false;for(i=length;i--!==0;){if((keys[i]==="_owner"||keys[i]==="__v"||keys[i]==="__o")&&a.$$typeof){continue}if(!equal(a[keys[i]],b[keys[i]]))return false}return true}return a!==a&&b!==b}var reactFastCompare=function isEqual(a,b){try{return equal(a,b)}catch(error){if((error.message||"").match(/stack|recursion/i)){console.warn("react-fast-compare cannot handle circular refs");return false}throw error}};var isEqual=getDefaultExportFromCjs(reactFastCompare);var EMPTY_MODIFIERS=[];var usePopper=function usePopper(referenceElement,popperElement,options){if(options===void 0){options={}}var prevOptions=React__namespace.useRef(null);var optionsWithDefaults={onFirstUpdate:options.onFirstUpdate,placement:options.placement||"bottom",strategy:options.strategy||"absolute",modifiers:options.modifiers||EMPTY_MODIFIERS};var _React$useState=React__namespace.useState({styles:{popper:{position:optionsWithDefaults.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),state=_React$useState[0],setState=_React$useState[1];var updateStateModifier=React__namespace.useMemo(function(){return{name:"updateState",enabled:true,phase:"write",fn:function fn(_ref){var state=_ref.state;var elements=Object.keys(state.elements);ReactDOM__namespace.flushSync(function(){setState({styles:fromEntries(elements.map(function(element){return[element,state.styles[element]||{}]})),attributes:fromEntries(elements.map(function(element){return[element,state.attributes[element]]}))})})},requires:["computeStyles"]}},[]);var popperOptions=React__namespace.useMemo(function(){var newOptions={onFirstUpdate:optionsWithDefaults.onFirstUpdate,placement:optionsWithDefaults.placement,strategy:optionsWithDefaults.strategy,modifiers:[].concat(optionsWithDefaults.modifiers,[updateStateModifier,{name:"applyStyles",enabled:false}])};if(isEqual(prevOptions.current,newOptions)){return prevOptions.current||newOptions}else{prevOptions.current=newOptions;return newOptions}},[optionsWithDefaults.onFirstUpdate,optionsWithDefaults.placement,optionsWithDefaults.strategy,optionsWithDefaults.modifiers,updateStateModifier]);var popperInstanceRef=React__namespace.useRef();useIsomorphicLayoutEffect(function(){if(popperInstanceRef.current){popperInstanceRef.current.setOptions(popperOptions)}},[popperOptions]);useIsomorphicLayoutEffect(function(){if(referenceElement==null||popperElement==null){return}var createPopper$1=options.createPopper||createPopper;var popperInstance=createPopper$1(referenceElement,popperElement,popperOptions);popperInstanceRef.current=popperInstance;return function(){popperInstance.destroy();popperInstanceRef.current=null}},[referenceElement,popperElement,options.createPopper]);return{state:popperInstanceRef.current?popperInstanceRef.current.state:null,styles:state.styles,attributes:state.attributes,update:popperInstanceRef.current?popperInstanceRef.current.update:null,forceUpdate:popperInstanceRef.current?popperInstanceRef.current.forceUpdate:null}};var Dropdown=function Dropdown(_a){var _a$directionX=_a.directionX,directionX=_a$directionX===void 0?"right":_a$directionX,_a$directionY=_a.directionY,directionY=_a$directionY===void 0?"down":_a$directionY,_a$icon=_a.icon,icon=_a$icon===void 0?"dots-vertical":_a$icon,children=_a.children,_a$className2=_a.className,className=_a$className2===void 0?"":_a$className2,_a$title2=_a.title,title=_a$title2===void 0?"":_a$title2,buttonContent=_a.buttonContent,_a$disabled=_a.disabled,disabled=_a$disabled===void 0?false:_a$disabled,noWrapper=_a.noWrapper,props=__rest(_a,["directionX","directionY","icon","children","className","title","buttonContent","disabled","noWrapper"]);var _React$useState45=React.useState(false),_React$useState46=_slicedToArray2(_React$useState45,2),visible=_React$useState46[0],setVisible=_React$useState46[1];var placement=directionX==="right"&&directionY==="down"?"bottom-start":directionX==="left"&&directionY==="down"?"bottom-end":directionX==="right"&&directionY==="up"?"top-start":"top-end";var _React$useState47=React.useState(null),_React$useState48=_slicedToArray2(_React$useState47,2),referenceElement=_React$useState48[0],setReferenceElement=_React$useState48[1];var _React$useState49=React.useState(null),_React$useState50=_slicedToArray2(_React$useState49,2),popperElement=_React$useState50[0],setPopperElement=_React$useState50[1];var _usePopper=usePopper(visible?referenceElement:undefined,visible?popperElement:undefined,{placement:placement,modifiers:[{name:"offset",options:{offset:[0,5]}}]}),styles=_usePopper.styles,attributes=_usePopper.attributes,update=_usePopper.update;var documentClickHandler=function documentClickHandler(){setVisible(false)};React.useEffect(function(){update===null||update===void 0?void 0:update();setTimeout(function(){if(visible){document.addEventListener("click",documentClickHandler,{once:true})}else{document.removeEventListener("click",documentClickHandler)}})},[visible]);var handleMenuClick=function handleMenuClick(e){e.preventDefault();setVisible(!visible)};return React.createElement("span",Object.assign({className:classNames({"wy-dropdown":!noWrapper,"wy-dropup":!noWrapper&&directionY==="up"},className)},props),React.createElement(UIButton.UI,{ref:setReferenceElement,onClick:function onClick(e){return handleMenuClick(e)},className:classNames({"wy-active":visible}),title:title,disabled:disabled},buttonContent||React.createElement(UIIcon.UI,{name:icon})),React.createElement("div",Object.assign({ref:setPopperElement,className:classNames("wy-dropdown-menu",{"wy-dropdown-menu-end":directionX==="left"}),hidden:!visible,style:styles.popper},attributes.popper),children))};var DropdownItem=function DropdownItem(_a){var children=_a.children,_a$className3=_a.className,className=_a$className3===void 0?"":_a$className3,onClick=_a.onClick,active=_a.active,props=__rest(_a,["children","className","onClick","active"]);var onClickWrapper=function onClickWrapper(e){e.preventDefault();if(onClick){onClick(e)}};return React.createElement("div",Object.assign({className:classNames("wy-dropdown-item",{"wy-active":active},className),onClick:onClickWrapper},props),children)};var DropdownAnchorItem=function DropdownAnchorItem(_a){var children=_a.children,_a$className4=_a.className,className=_a$className4===void 0?"":_a$className4,link=_a.link,active=_a.active,download=_a.download,props=__rest(_a,["children","className","link","active","download"]);if(download){props=Object.assign(Object.assign({},props),{download:true})}return React.createElement("a",Object.assign({className:classNames("wy-dropdown-item",{"wy-active":active},className),href:link},props),children)};var DropdownDivider=function DropdownDivider(){return React.createElement("hr",{className:"wy-dropdown-divider"})};var UIDropdown={UI:Dropdown,Item:DropdownItem,Anchor:DropdownAnchorItem,Divider:DropdownDivider};var FUNC_ERROR_TEXT="Expected a function";var NAN=0/0;var symbolTag="[object Symbol]";var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var freeParseInt=parseInt;var freeGlobal=_typeof2(commonjsGlobal)=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal;var freeSelf=(typeof self==="undefined"?"undefined":_typeof2(self))=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var objectProto=Object.prototype;var objectToString=objectProto.toString;var nativeMax=Math.max,nativeMin=Math.min;var now=function now(){return root.Date.now()};function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject$1(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}function isObject$1(value){var type=_typeof2(value);return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&_typeof2(value)=="object"}function isSymbol(value){return _typeof2(value)=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject$1(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject$1(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}var lodash_debounce=debounce;var debounce$1=getDefaultExportFromCjs(lodash_debounce);function useDebounce(cb,delay){var inputsRef=React.useRef({cb:cb,delay:delay});React.useEffect(function(){inputsRef.current={cb:cb,delay:delay}});return React.useCallback(debounce$1(function(){var _inputsRef$current;if(inputsRef.current.delay===delay)(_inputsRef$current=inputsRef.current).cb.apply(_inputsRef$current,arguments)},delay,{leading:false,trailing:true}),[delay,debounce$1])}function useSearchUsers(text,options){var PAGE_SIZE=25;var _React$useContext5=React.useContext(WeavyContext),client=_React$useContext5.client;if(!client){throw new Error("useSearchUsers must be used within an WeavyProvider")}var getUsers=function(){var _ref177=_asyncToGenerator(_regeneratorRuntime().mark(function _callee112(){var response,data;return _regeneratorRuntime().wrap(function _callee112$(_context114){while(1)switch(_context114.prev=_context114.next){case 0:_context114.next=2;return client.get("/api/users/autocomplete?q=".concat(text,"&skip=0&top=").concat(PAGE_SIZE));case 2:response=_context114.sent;_context114.next=5;return response.json();case 5:data=_context114.sent;return _context114.abrupt("return",data);case 7:case"end":return _context114.stop()}},_callee112)}));return function getUsers(){return _ref177.apply(this,arguments)}}();return useQuery("users",getUsers,options)}var Presence=function Presence(_ref178){var id=_ref178.id,status=_ref178.status;return React.createElement("span",{className:classNames("wy-presence",{"wy-presence-active":status==="active"}),"data-presence-id":id})};var wordBoundary="\\s,.:;\"";var separateByWordBoundaryRegExp=new RegExp("^|[".concat(wordBoundary,"]|$"),"g");function getInitials(name){var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;if(!name){return null}var initials="";var words=name.split(separateByWordBoundaryRegExp).filter(function(w){return w});if(words.length==1){initials=words[0]}else{words.forEach(function(word){initials+=word.charAt(0)})}return initials.substring(0,length).toUpperCase()}var Avatar=function Avatar(_ref179){var id=_ref179.id,src=_ref179.src,name=_ref179.name,presence=_ref179.presence,_ref179$size=_ref179.size,size=_ref179$size===void 0?48:_ref179$size,className=_ref179.className;var remSize=size/16;var initials;if(!src&&name){initials=getInitials(name)}return React.createElement("div",{className:classNames("wy-avatar-presence",className)},src?React.createElement("img",{alt:"",title:name,className:"wy-avatar",height:size,width:size,src:src}):React.createElement("div",{className:"wy-avatar wy-avatar-initials",style:_defineProperty2({},"--wy-component-avatar-size","".concat(remSize,"rem")),title:name},React.createElement("span",null,initials)),presence&&id&&React.createElement(Presence,{id:id,status:presence}))};var AvatarGroup=function AvatarGroup(_ref180){var user=_ref180.user,members=_ref180.members,_ref180$name=_ref180.name,name=_ref180$name===void 0?"":_ref180$name,_ref180$size=_ref180.size,size=_ref180$size===void 0?48:_ref180$size;var remSize=size/16;var otherMembers=((members===null||members===void 0?void 0:members.data)||[]).filter(function(member){return member.id!==user.id}).slice(0,2).reverse();var frontMember=(otherMembers===null||otherMembers===void 0?void 0:otherMembers.shift())||user;var backMember=(otherMembers===null||otherMembers===void 0?void 0:otherMembers.shift())||(frontMember!==user?user:undefined);return React.createElement("div",{className:"wy-avatar-group",title:name,style:_defineProperty2({},"--wy-component-avatar-size","".concat(remSize,"rem"))},React.createElement(Avatar,{src:backMember===null||backMember===void 0?void 0:backMember.avatar_url,name:backMember===null||backMember===void 0?void 0:backMember.display_name,size:size*2/3}),React.createElement(Avatar,{src:frontMember.avatar_url,name:frontMember.display_name,size:size*2/3}))};var SearchUsers=function SearchUsers(_ref181){var existingMembers=_ref181.existingMembers,handleSubmit=_ref181.handleSubmit,buttonTitle=_ref181.buttonTitle;var _React$useState51=React.useState(""),_React$useState52=_slicedToArray2(_React$useState51,2),text=_React$useState52[0],setText=_React$useState52[1];var _React$useState53=React.useState([]),_React$useState54=_slicedToArray2(_React$useState53,2),selected=_React$useState54[0],setSelected=_React$useState54[1];var _useSearchUsers=useSearchUsers(text||"*",{enabled:false}),data=_useSearchUsers.data,refetch=_useSearchUsers.refetch;var throttledCb=useDebounce(function(){return refetch()},250);React.useEffect(throttledCb,[text]);var isChecked=function isChecked(memberId){return selected.find(function(m){return m.id===memberId})!=null};var handleSelected=function handleSelected(member,checked){if(checked){setSelected([].concat(_toConsumableArray2(selected),[member]))}else{setSelected(selected.filter(function(m){return m.id!==member.id}))}};var clear=function clear(){setText("")};return React.createElement("div",{className:"wy-search wy-scroll-y"},React.createElement("div",{className:"wy-pane-group"},React.createElement("div",{className:"wy-search-form wy-input-group"},React.createElement("input",{className:"wy-search-input wy-input wy-input-filled",value:text,onChange:function onChange(e){return setText(e.target.value)},name:"text",placeholder:"Search..."}),React.createElement(UIButton.UI,{type:"reset",onClick:function onClick(){return clear()}},React.createElement(UIIcon.UI,{name:"close-circle"})),React.createElement(UIButton.UI,null,React.createElement(UIIcon.UI,{name:"magnify"})))),React.createElement("div",{className:"wy-pane-group"},data&&(!data.data||data.data.filter(function(m){return(existingMembers===null||existingMembers===void 0?void 0:existingMembers.find(function(e){return e.id===m.id}))===undefined}).length===0)&&React.createElement("div",{className:"wy-table-no-result"},"Your search did not match any people."),selected&&selected.length>0&&React.createElement("div",{className:"wy-pane-group"},React.createElement("label",{className:"wy-input-label"},"Selected"),selected.map(function(member){return React.createElement("div",{className:"wy-item",key:member.id},React.createElement(Avatar,{src:member.avatar_url,size:32,id:member.id,presence:member.presence,name:member.display_name}),React.createElement("div",{className:"wy-item-body"},member.display_name),React.createElement(UIButton.UI,{onClick:function onClick(){return handleSelected(member,!isChecked(member.id))},title:"Remove"},React.createElement(UIIcon.UI,{name:"account-minus"})))}),React.createElement("hr",null)),React.createElement("div",{className:"wy-pane-group"},data&&data.data&&data.data.filter(function(m){return(existingMembers===null||existingMembers===void 0?void 0:existingMembers.find(function(e){return e.id===m.id}))===undefined&&selected.find(function(s){return s.id===m.id})===undefined}).map(function(member){return React.createElement("div",{className:"wy-item",key:member.id},React.createElement(Avatar,{src:member.avatar_url,size:32,id:member.id,presence:member.presence,name:member.display_name}),React.createElement("div",{className:"wy-item-body"},member.display_name),React.createElement(UIButton.UI,{onClick:function onClick(){return handleSelected(member,!isChecked(member.id))},title:"Add"},React.createElement(UIIcon.UI,{name:"account-plus"})))}))),React.createElement("div",{className:"wy-footerbars"},React.createElement("div",{className:"wy-footerbar"},React.createElement("div",{className:"wy-pane-group"},React.createElement("div",{className:"wy-buttons"},React.createElement("button",{className:"wy-button wy-button-primary",type:"button",onClick:function onClick(){handleSubmit(selected);clear()},disabled:selected.length===0},buttonTitle))))))};function useMutateMembers(){var _React$useContext6=React.useContext(WeavyContext),client=_React$useContext6.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateMembers must be used within an WeavyProvider")}var mutateMembers=function(){var _ref183=_asyncToGenerator(_regeneratorRuntime().mark(function _callee113(_ref182){var id,members,response;return _regeneratorRuntime().wrap(function _callee113$(_context115){while(1)switch(_context115.prev=_context115.next){case 0:id=_ref182.id,members=_ref182.members;_context115.next=3;return client.post("/api/apps/"+id+"/members/","POST",JSON.stringify(members));case 3:response=_context115.sent;return _context115.abrupt("return",response);case 5:case"end":return _context115.stop()}},_callee113)}));return function mutateMembers(_x88){return _ref183.apply(this,arguments)}}();return useMutation(mutateMembers,{onSuccess:function onSuccess(data,variables,context){queryClient.invalidateQueries("conversations");queryClient.invalidateQueries(["conversation",variables.id]);queryClient.invalidateQueries(["members",variables.id])}})}function useConversation(id,options){var _React$useContext7=React.useContext(WeavyContext),client=_React$useContext7.client;if(!client){throw new Error("useConversation must be used within an WeavyProvider")}var getConversation=function(){var _ref184=_asyncToGenerator(_regeneratorRuntime().mark(function _callee114(){var response,data;return _regeneratorRuntime().wrap(function _callee114$(_context116){while(1)switch(_context116.prev=_context116.next){case 0:_context116.next=2;return client.get("/api/conversations/"+id);case 2:response=_context116.sent;_context116.next=5;return response.json();case 5:data=_context116.sent;return _context116.abrupt("return",data);case 7:case"end":return _context116.stop()}},_callee114)}));return function getConversation(){return _ref184.apply(this,arguments)}}();return useQuery(["conversation",id],getConversation,options)}function useMutateConversationName(){var _React$useContext8=React.useContext(WeavyContext),client=_React$useContext8.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateConversationName must be used within an WeavyProvider")}var mutateConversationName=function(){var _ref186=_asyncToGenerator(_regeneratorRuntime().mark(function _callee115(_ref185){var id,name,response;return _regeneratorRuntime().wrap(function _callee115$(_context117){while(1)switch(_context117.prev=_context117.next){case 0:id=_ref185.id,name=_ref185.name;_context117.next=3;return client.post("/api/apps/"+id,"PATCH",JSON.stringify({type:"ChatRoom",name:name}));case 3:response=_context117.sent;return _context117.abrupt("return",response.json());case 5:case"end":return _context117.stop()}},_callee115)}));return function mutateConversationName(_x89){return _ref186.apply(this,arguments)}}();return useMutation(mutateConversationName,{onSuccess:function onSuccess(data,variables,context){queryClient.invalidateQueries("conversations");queryClient.invalidateQueries(["conversation",variables.id])}})}function useMutateRemoveMembers(){var _React$useContext9=React.useContext(WeavyContext),client=_React$useContext9.client;if(!client){throw new Error("useMutateRemoveMembers must be used within an WeavyProvider")}var mutateRemove=function(){var _ref188=_asyncToGenerator(_regeneratorRuntime().mark(function _callee116(_ref187){var id,members,response;return _regeneratorRuntime().wrap(function _callee116$(_context118){while(1)switch(_context118.prev=_context118.next){case 0:id=_ref187.id,members=_ref187.members;_context118.next=3;return client.post("/api/apps/"+id+"/members/"+members.join(","),"DELETE",JSON.stringify(members));case 3:response=_context118.sent;return _context118.abrupt("return",response);case 5:case"end":return _context118.stop()}},_callee116)}));return function mutateRemove(_x90){return _ref188.apply(this,arguments)}}();return useMutation(mutateRemove)}function useMessages(id,options){var PAGE_SIZE=25;var _React$useContext10=React.useContext(WeavyContext),client=_React$useContext10.client;if(!client){throw new Error("useMessages must be used within an WeavyProvider")}var getMessages=function(){var _ref189=_asyncToGenerator(_regeneratorRuntime().mark(function _callee117(opt){var _a,skip,response,result;return _regeneratorRuntime().wrap(function _callee117$(_context119){while(1)switch(_context119.prev=_context119.next){case 0:skip=opt.pageParam||0;_context119.next=3;return client.get("/api/apps/"+id+"/messages?orderby=createdat+desc&skip="+skip+"&top="+PAGE_SIZE);case 3:response=_context119.sent;_context119.next=6;return response.json();case 6:result=_context119.sent;result.data=((_a=result.data)===null||_a===void 0?void 0:_a.reverse())||[];return _context119.abrupt("return",result);case 9:case"end":return _context119.stop()}},_callee117)}));return function getMessages(_x91){return _ref189.apply(this,arguments)}}();var opts=Object.assign(Object.assign({},options),{getNextPageParam:function getNextPageParam(lastPage,pages){if((lastPage===null||lastPage===void 0?void 0:lastPage.end)<(lastPage===null||lastPage===void 0?void 0:lastPage.count)){return pages.length*PAGE_SIZE}},select:function select(data){return{pages:_toConsumableArray2(data.pages).reverse(),pageParams:_toConsumableArray2(data.pageParams).reverse()}}});return useInfiniteQuery(["messages",id],getMessages,opts)}var Attachment=function Attachment(_ref190){var url=_ref190.url,previewUrl=_ref190.previewUrl,name=_ref190.name,size=_ref190.size,provider=_ref190.provider,onClick=_ref190.onClick;var fileSize=size&&size>0?fileSizeAsString(size):null;var ext=getExtension(name);var _getIcon=getIcon(name),icon=_getIcon.icon;var kind=getKind(name);var prov=getProvider(provider);return React.createElement("a",{href:previewUrl||url,className:"wy-item wy-item-lg",target:"_blank",title:name,onClick:onClick?function(e){return onClick(e)}:undefined},React.createElement(UIIcon.UI,{name:icon+(prov?"+".concat(prov):""),size:48,className:classNames("wy-kind-"+toKebabCase(kind),"wy-ext-"+ext.substring(1))}),React.createElement("div",{className:"wy-item-body "},React.createElement("div",{className:"wy-item-title"},name),fileSize&&React.createElement("div",{className:"wy-item-text",title:fileSize},fileSize)))};function findAnyExistingItem(queryData,propertyName,value){var copy=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var existingItem;if(queryData&&queryData.pages){queryData.pages.some(function(page){var _a;return(_a=page.data)===null||_a===void 0?void 0:_a.some(function(item){if(item[propertyName]===value){existingItem=item;return true}})})}return existingItem&&copy?JSON.parse(JSON.stringify(existingItem)):existingItem}function addToQueryData(queryData,item){var sorting=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var tempId=arguments.length>3?arguments[3]:undefined;var _a;if(queryData){if(queryData.pages){var foundIndex=-1;var newPagesArray=(_a=queryData.pages.map(function(page,i){if(foundIndex>=0){return page}var pageData=page.data||[];pageData=pageData.filter(function(pageItem){return pageItem.id!==item.id&&(!tempId||pageItem.id!==tempId)});if(sorting&&sorting.by){foundIndex=pageData.findIndex(function(pageItem){var pageItemValue=pageItem[sorting.by];var itemValue=item[sorting.by];if(sorting.by==="modified_at"){pageItemValue!==null&&pageItemValue!==void 0?pageItemValue:pageItemValue=pageItem["created_at"];itemValue!==null&&itemValue!==void 0?itemValue:itemValue=item["created_at"]}if(typeof pageItemValue==="string"&&typeof itemValue==="string"){var sortCompare=pageItemValue.localeCompare(itemValue,undefined,{sensitivity:"base",numeric:true});return sorting.descending?sortCompare<0:sortCompare>0}return sorting.descending?pageItemValue<itemValue:pageItemValue>itemValue});if(foundIndex>=0){pageData.splice(foundIndex,0,item);page.data=_toConsumableArray2(pageData)}else if(i==queryData.pages.length-1&&page.end===page.count){page.data=[].concat(_toConsumableArray2(pageData),[item])}else{page.data=_toConsumableArray2(pageData)}}else{if(i===0){if(sorting.descending){page.data=[item].concat(_toConsumableArray2(pageData))}else{page.data=[].concat(_toConsumableArray2(pageData),[item])}}}return page}))!==null&&_a!==void 0?_a:[];return{pages:newPagesArray,pageParams:queryData.pageParams}}else if(queryData.length){var foundIndex=-1;var newData=_toConsumableArray2(queryData.filter(function(dataItem){return dataItem.id!==item.id&&(!tempId||dataItem.id!==tempId)}));if(sorting&&sorting.by){foundIndex=newData.findIndex(function(dataItem){var dataItemValue=dataItem[sorting.by];var itemValue=item[sorting.by];if(sorting.by==="modified_at"){dataItemValue!==null&&dataItemValue!==void 0?dataItemValue:dataItemValue=dataItem["created_at"];itemValue!==null&&itemValue!==void 0?itemValue:itemValue=item["created_at"]}if(typeof dataItemValue==="string"&&typeof itemValue==="string"){var sortCompare=dataItemValue.localeCompare(itemValue,undefined,{sensitivity:"base",numeric:true});return sorting.descending?sortCompare<0:sortCompare>0}return sorting.descending?dataItemValue<itemValue:dataItemValue>itemValue});if(foundIndex>=0){newData.splice(foundIndex,0,item)}else{newData.push(item)}}else{if(sorting.descending){newData.unshift(item)}else{newData.push(item)}}return newData}}return queryData}function updateQueryData(queryData,select,fnUpdater){var _a;if(select!==undefined){var predicate=select instanceof Function?select:function(item){return item.id===select};if(queryData){if(queryData.pages){var newPagesArray=(_a=queryData.pages.map(function(page,i){if(page.data){page.data=_toConsumableArray2(page.data.map(function(item){if(predicate(item)){item=JSON.parse(JSON.stringify(item));fnUpdater(item)}return item}))}return page}))!==null&&_a!==void 0?_a:[];return{pages:newPagesArray,pageParams:queryData.pageParams}}else if(queryData.length){return _toConsumableArray2(queryData.map(function(item){if(predicate(item)){item=JSON.parse(JSON.stringify(item));fnUpdater(item)}return item}))}}}return queryData}function removeQueryData(queryData,select){var _a;if(select!==undefined){var predicate=select instanceof Function?select:function(item){return item.id===select};if(queryData){if(queryData.pages){var newPagesArray=(_a=queryData.pages.map(function(page,i){page.data=_toConsumableArray2(page.data.filter(function(item){return!predicate(item)}));return page}))!==null&&_a!==void 0?_a:[];return{pages:newPagesArray,pageParams:queryData.pageParams}}else if(queryData.length){return _toConsumableArray2(queryData.filter(function(item){return!predicate(item)}))}}}return queryData}var addCacheItem=function addCacheItem(queryClient,key,item,tempId,sorting){queryClient.setQueryData(key,function(data){return addToQueryData(data,item,sorting,tempId)})};var updateCacheItem=function updateCacheItem(queryClient,key,select,fnUpdater){queryClient.setQueryData(key,function(data){return updateQueryData(data,select,fnUpdater)})};var removeCacheItem=function removeCacheItem(queryClient,key,select){queryClient.setQueryData(key,function(data){return removeQueryData(data,select)})};function useMutateReaction(){var _React$useContext11=React.useContext(WeavyContext),client=_React$useContext11.client;var _React$useContext12=React.useContext(UserContext),user=_React$useContext12.user;var queryClient=useQueryClient();if(!client){throw new Error("useMutateReaction must be used within an WeavyProvider")}var mutateReaction=function(){var _ref192=_asyncToGenerator(_regeneratorRuntime().mark(function _callee118(_ref191){var id,type,reaction,response;return _regeneratorRuntime().wrap(function _callee118$(_context120){while(1)switch(_context120.prev=_context120.next){case 0:id=_ref191.id,type=_ref191.type,reaction=_ref191.reaction;_context120.next=3;return client.post("/api/".concat(type,"/").concat(id,"/reactions"),"POST",JSON.stringify({content:reaction}));case 3:response=_context120.sent;return _context120.abrupt("return",response);case 5:case"end":return _context120.stop()}},_callee118)}));return function mutateReaction(_x92){return _ref192.apply(this,arguments)}}();return useMutation(mutateReaction,{onSuccess:function onSuccess(data,variables,context){},onMutate:function(){var _onMutate=_asyncToGenerator(_regeneratorRuntime().mark(function _callee119(variables){return _regeneratorRuntime().wrap(function _callee119$(_context121){while(1)switch(_context121.prev=_context121.next){case 0:updateCacheItem(queryClient,[variables.type,variables.parentId],variables.id,function(item){item.reactions=item.reactions||[];item.reactions=[].concat(_toConsumableArray2(item.reactions),[{content:variables.reaction,created_by_id:user.id}])});case 1:case"end":return _context121.stop()}},_callee119)}));function onMutate(_x93){return _onMutate.apply(this,arguments)}return onMutate}()})}var events=[];var callbacks={};function useForceUpdate(){var _React$useState55=React.useState({}),_React$useState56=_slicedToArray2(_React$useState55,2),setState=_React$useState56[1];return React.useCallback(function(){return setState({})},[])}function useEvents(){var forceUpdate=useForceUpdate();var runCallbacks=function runCallbacks(callbackList,data){if(callbackList){callbackList.forEach(function(cb){return cb(data)});forceUpdate()}};var dispatch=function dispatch(event,data){events.push({event:event,data:data,created:Date.now()});runCallbacks(callbacks[event],data)};var on=function on(event,cb){if(callbacks[event]){callbacks[event].push(cb)}else{callbacks[event]=[cb]}return function(){return callbacks[event]=callbacks[event].filter(function(i){return i!==cb})}};var off=function off(event,cb){if(callbacks[event]){callbacks[event]=callbacks[event].filter(function(i){return i!==cb})}};return{dispatch:dispatch,on:on,off:off,events:events}}function useMutateDeleteReaction(){var _React$useContext13=React.useContext(WeavyContext),client=_React$useContext13.client;var _React$useContext14=React.useContext(UserContext),user=_React$useContext14.user;var queryClient=useQueryClient();if(!client){throw new Error("useMutateDeleteReaction must be used within an WeavyProvider")}var mutateDeleteReaction=function(){var _ref194=_asyncToGenerator(_regeneratorRuntime().mark(function _callee120(_ref193){var id,type,response;return _regeneratorRuntime().wrap(function _callee120$(_context122){while(1)switch(_context122.prev=_context122.next){case 0:id=_ref193.id,type=_ref193.type;_context122.next=3;return client.post("/api/".concat(type,"/").concat(id,"/reactions"),"DELETE","");case 3:response=_context122.sent;return _context122.abrupt("return",response);case 5:case"end":return _context122.stop()}},_callee120)}));return function mutateDeleteReaction(_x94){return _ref194.apply(this,arguments)}}();return useMutation(mutateDeleteReaction,{onSuccess:function onSuccess(data,variables,context){},onMutate:function(){var _onMutate2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee121(variables){return _regeneratorRuntime().wrap(function _callee121$(_context123){while(1)switch(_context123.prev=_context123.next){case 0:updateCacheItem(queryClient,[variables.type,variables.parentId],variables.id,function(item){item.reactions=_toConsumableArray2(item.reactions.filter(function(r){return r.created_by_id!==user.id}))});case 1:case"end":return _context123.stop()}},_callee121)}));function onMutate(_x95){return _onMutate2.apply(this,arguments)}return onMutate}()})}var SheetImpl=function SheetImpl(_ref195){var children=_ref195.children,_ref195$className=_ref195.className,className=_ref195$className===void 0?"":_ref195$className,isOpen=_ref195.isOpen,style=_ref195.style,title=_ref195.title,onClose=_ref195.onClose;var _React$useState57=React.useState(false),_React$useState58=_slicedToArray2(_React$useState57,2),sheetShowing=_React$useState58[0],setSheetShowing=_React$useState58[1];var _useEvents=useEvents(),dispatch=_useEvents.dispatch,on=_useEvents.on,off=_useEvents.off;React.useEffect(function(){if(onClose){if(sheetShowing){on("close_sheet",onClose);return function(){off("close_sheet",onClose)}}else{off("close_sheet",onClose)}}},[sheetShowing]);React.useEffect(function(){if(!isOpen){setSheetShowing(false)}else{dispatch("close_sheet",{})}},[isOpen]);return React.createElement(Modal,{isOpen:isOpen,ariaHideApp:false,onAfterOpen:function onAfterOpen(){setSheetShowing(true)},onAfterClose:function onAfterClose(){setSheetShowing(false)},onRequestClose:onClose,closeTimeoutMS:201,className:classNames("wy-sheet",className,{"wy-show":sheetShowing}),overlayClassName:"wy-viewport",contentLabel:title,shouldCloseOnOverlayClick:false,style:style},React.createElement("div",{className:"wy-appbar"},React.createElement("div",null),React.createElement("div",{className:"wy-appbar-text"},title),React.createElement("div",{className:"wy-appbar-buttons"},onClose&&React.createElement(UIButton.UI,{onClick:function onClick(e){return onClose(e)},title:"Close"},React.createElement(UIIcon.UI,{name:"close"})))),React.createElement("div",{className:"wy-sheet-body wy-scroll-y"},children))};var UISheet={UI:SheetImpl};function useReactionList(id,type,options){var _React$useContext15=React.useContext(WeavyContext),client=_React$useContext15.client;if(!client){throw new Error("useReactionList must be used within an WeavyProvider")}var getReactions=function(){var _ref196=_asyncToGenerator(_regeneratorRuntime().mark(function _callee122(){var response,data;return _regeneratorRuntime().wrap(function _callee122$(_context124){while(1)switch(_context124.prev=_context124.next){case 0:_context124.next=2;return client.get("/api/".concat(type,"/").concat(id,"/reactions"));case 2:response=_context124.sent;_context124.next=5;return response.json();case 5:data=_context124.sent;return _context124.abrupt("return",data);case 7:case"end":return _context124.stop()}},_callee122)}));return function getReactions(){return _ref196.apply(this,arguments)}}();return useQuery(["reactions",id,type],getReactions,options)}function useMutateReplaceReaction(){var _React$useContext16=React.useContext(WeavyContext),client=_React$useContext16.client;var _React$useContext17=React.useContext(UserContext),user=_React$useContext17.user;var queryClient=useQueryClient();if(!client){throw new Error("useMutateReplaceReaction must be used within an WeavyProvider")}var mutateReplaceReaction=function(){var _ref198=_asyncToGenerator(_regeneratorRuntime().mark(function _callee123(_ref197){var id,type,reaction,response;return _regeneratorRuntime().wrap(function _callee123$(_context125){while(1)switch(_context125.prev=_context125.next){case 0:id=_ref197.id,type=_ref197.type,reaction=_ref197.reaction;_context125.next=3;return client.post("/api/".concat(type,"/").concat(id,"/reactions"),"DELETE","");case 3:_context125.next=5;return client.post("/api/".concat(type,"/").concat(id,"/reactions"),"POST",JSON.stringify({content:reaction}));case 5:response=_context125.sent;return _context125.abrupt("return",response);case 7:case"end":return _context125.stop()}},_callee123)}));return function mutateReplaceReaction(_x96){return _ref198.apply(this,arguments)}}();return useMutation(mutateReplaceReaction,{onSuccess:function onSuccess(data,variables,context){},onMutate:function(){var _onMutate3=_asyncToGenerator(_regeneratorRuntime().mark(function _callee124(variables){return _regeneratorRuntime().wrap(function _callee124$(_context126){while(1)switch(_context126.prev=_context126.next){case 0:updateCacheItem(queryClient,[variables.type,variables.parentId],variables.id,function(item){item.reactions=item.reactions.map(function(r){if(r.created_by_id!==user.id){return r}r.content=variables.reaction;return r})});case 1:case"end":return _context126.stop()}},_callee124)}));function onMutate(_x97){return _onMutate3.apply(this,arguments)}return onMutate}()})}var ReactionsLike=function ReactionsLike(_ref199){var id=_ref199.id,parentId=_ref199.parentId,type=_ref199.type,reactions=_ref199.reactions;var _React$useContext18=React.useContext(UserContext),user=_React$useContext18.user;var _React$useState59=React.useState(""),_React$useState60=_slicedToArray2(_React$useState59,2),reactedEmoji=_React$useState60[0],setReactedEmoji=_React$useState60[1];var react=useMutateReaction();var unreact=useMutateDeleteReaction();var replaceReact=useMutateReplaceReaction();var like="\uD83D\uDC4D";React.useEffect(function(){var filtered=reactions===null||reactions===void 0?void 0:reactions.find(function(e){return e.created_by_id===user.id});setReactedEmoji(filtered?filtered.content:"")},[reactions]);var handleReaction=function(){var _ref200=_asyncToGenerator(_regeneratorRuntime().mark(function _callee125(emoji){var existing;return _regeneratorRuntime().wrap(function _callee125$(_context127){while(1)switch(_context127.prev=_context127.next){case 0:existing=reactions===null||reactions===void 0?void 0:reactions.find(function(r){return r.created_by_id===user.id});if(!(existing&&existing.content!==emoji)){_context127.next=6;break}_context127.next=4;return replaceReact.mutateAsync({parentId:parentId,id:id,type:type,reaction:emoji});case 4:_context127.next=13;break;case 6:if(!existing){_context127.next=11;break}_context127.next=9;return unreact.mutateAsync({parentId:parentId,id:id,type:type,reaction:emoji});case 9:_context127.next=13;break;case 11:_context127.next=13;return react.mutateAsync({parentId:parentId,id:id,type:type,reaction:emoji});case 13:case"end":return _context127.stop()}},_callee125)}));return function handleReaction(_x98){return _ref200.apply(this,arguments)}}();return React.createElement(UIButton.UI,{className:"wy-like-button",onClick:function onClick(){return handleReaction(like)}},React.createElement(UIIcon.UI,{name:reactedEmoji===like?"thumb-up":"thumb-up-outline",size:20}))};var ReactionsMenu=function ReactionsMenu(_ref201){var id=_ref201.id,parentId=_ref201.parentId,type=_ref201.type,_ref201$placement=_ref201.placement,placement=_ref201$placement===void 0?"top":_ref201$placement,reactions=_ref201.reactions;var _React$useContext19=React.useContext(UserContext),user=_React$useContext19.user;var _React$useContext20=React.useContext(WeavyContext),options=_React$useContext20.options;var _React$useState61=React.useState(false),_React$useState62=_slicedToArray2(_React$useState61,2),visible=_React$useState62[0],setVisible=_React$useState62[1];var _React$useState63=React.useState(""),_React$useState64=_slicedToArray2(_React$useState63,2),reactedEmoji=_React$useState64[0],setReactedEmoji=_React$useState64[1];var emojis=options===null||options===void 0?void 0:options.reactions;var react=useMutateReaction();var unreact=useMutateDeleteReaction();var replaceReact=useMutateReplaceReaction();var _React$useState65=React.useState(null),_React$useState66=_slicedToArray2(_React$useState65,2),referenceElement=_React$useState66[0],setReferenceElement=_React$useState66[1];var _React$useState67=React.useState(null),_React$useState68=_slicedToArray2(_React$useState67,2),popperElement=_React$useState68[0],setPopperElement=_React$useState68[1];var _usePopper2=usePopper(visible?referenceElement:undefined,visible?popperElement:undefined,{placement:placement}),styles=_usePopper2.styles,attributes=_usePopper2.attributes,update=_usePopper2.update;React.useEffect(function(){update===null||update===void 0?void 0:update();if(visible){document.addEventListener("click",function(){setVisible(false)})}else{document.removeEventListener("click",function(){setVisible(false)})}},[visible]);React.useEffect(function(){var filtered=reactions===null||reactions===void 0?void 0:reactions.find(function(e){return e.created_by_id===user.id});setReactedEmoji(filtered?filtered.content:"")},[reactions]);var toggleReactionMenu=function toggleReactionMenu(e){e.stopPropagation();setVisible(!visible)};var handleReaction=function(){var _ref202=_asyncToGenerator(_regeneratorRuntime().mark(function _callee126(emoji){var existing;return _regeneratorRuntime().wrap(function _callee126$(_context128){while(1)switch(_context128.prev=_context128.next){case 0:existing=reactions===null||reactions===void 0?void 0:reactions.find(function(r){return r.created_by_id===user.id});if(!(existing&&existing.content!==emoji)){_context128.next=6;break}_context128.next=4;return replaceReact.mutateAsync({parentId:parentId,id:id,type:type,reaction:emoji});case 4:_context128.next=13;break;case 6:if(!existing){_context128.next=11;break}_context128.next=9;return unreact.mutateAsync({parentId:parentId,id:id,type:type,reaction:emoji});case 9:_context128.next=13;break;case 11:_context128.next=13;return react.mutateAsync({parentId:parentId,id:id,type:type,reaction:emoji});case 13:setVisible(false);case 14:case"end":return _context128.stop()}},_callee126)}));return function handleReaction(_x99){return _ref202.apply(this,arguments)}}();return React.createElement("div",{className:classNames({"wy-active":visible}),style:{position:"relative"}},React.createElement(UIButton.UI,{ref:setReferenceElement,className:"wy-reaction-menu-button",onClick:toggleReactionMenu},React.createElement(UIIcon.UI,{name:"emoticon-plus",size:20})),React.createElement("div",Object.assign({ref:setPopperElement,className:"wy-reaction-menu wy-dropdown-menu",hidden:!visible,style:styles.popper},attributes.popper),React.createElement("div",{className:"wy-reaction-picker"},emojis===null||emojis===void 0?void 0:emojis.map(function(r,i){return React.createElement(UIButton.UI,{key:i,onClick:function onClick(){return handleReaction(r)},className:classNames("wy-button-icon wy-reaction-button",{"wy-active":reactedEmoji===r}),"data-emoji":r},React.createElement("span",{className:"wy-emoji"},r))}))))};var ReactionsList=function ReactionsList(_ref203){var id=_ref203.id,type=_ref203.type,reactions=_ref203.reactions,_ref203$featureEnable=_ref203.featureEnabled,featureEnabled=_ref203$featureEnable===void 0?true:_ref203$featureEnable;var _a,_b;var _React$useContext21=React.useContext(UserContext),user=_React$useContext21.user;var _React$useState69=React.useState(),_React$useState70=_slicedToArray2(_React$useState69,2),reactionsList=_React$useState70[0],setReactionsList=_React$useState70[1];var _React$useState71=React.useState([]),_React$useState72=_slicedToArray2(_React$useState71,2),list=_React$useState72[0],setList=_React$useState72[1];var _React$useState73=React.useState(0),_React$useState74=_slicedToArray2(_React$useState73,2),count=_React$useState74[0],setCount=_React$useState74[1];var _useReactionList=useReactionList(id,type,{enabled:false}),data=_useReactionList.data,isLoading=_useReactionList.isLoading,refetch=_useReactionList.refetch;var _useEvents2=useEvents(),on=_useEvents2.on,off=_useEvents2.off;var _React$useState75=React.useState(false),_React$useState76=_slicedToArray2(_React$useState75,2),isOpen=_React$useState76[0],setIsOpen=_React$useState76[1];React.useEffect(function(){on("reaction_added_"+id,handleRealtimeReactionInserted);on("reaction_deleted_"+id,handleRealtimeReactionDeleted);return function(){off("reaction_added_"+id,handleRealtimeReactionInserted);off("reaction_deleted_"+id,handleRealtimeReactionDeleted)}},[id]);React.useEffect(function(){setReactionsList(reactions)},[reactions]);React.useEffect(function(){if(reactionsList){var group=_toConsumableArray2(new Map(reactionsList===null||reactionsList===void 0?void 0:reactionsList.map(function(item){return[item.content,item]})).values());var _list=group.map(function(item){return{content:item.content,count:reactionsList.filter(function(r){return r.content===item.content}).length,has_reacted:reactionsList.filter(function(r){return r.content===item.content&&r.created_by_id===user.id}).length>0}});var reactionCount=_list.reduce(function(previousValue,currentItem){return previousValue+currentItem.count},0);setList(_list);setCount(reactionCount);if(isOpen){setTimeout(function(){return refetch()},200)}}},[reactionsList,id,type]);var handleRealtimeReactionInserted=React.useCallback(function(reaction){if(reaction.entity.id===id&&reaction.actor.id!==user.id){setReactionsList(function(oldList){return[].concat(_toConsumableArray2(oldList||[]),[{content:reaction.reaction,created_by_id:reaction.actor.id}])})}},[id,reactionsList]);var handleRealtimeReactionDeleted=React.useCallback(function(reaction){if(reaction.entity.id===id&&reaction.actor.id!==user.id){setReactionsList(function(oldList){return oldList===null||oldList===void 0?void 0:oldList.filter(function(item){return item.created_by_id!==reaction.actor.id})})}},[id,reactionsList]);var handleOpen=function handleOpen(e){e.preventDefault();refetch();setIsOpen(true)};return React.createElement(React.Fragment,null,count>0&&featureEnabled&&React.createElement(React.Fragment,null,React.createElement(UIButton.UI,{className:"wy-reactions wy-button-icon",onClick:handleOpen},!!list&&list.map(function(r,i){return React.createElement("span",{key:i,className:"wy-emoji",title:r.count.toString()},r.content)}),count>1&&React.createElement("span",{className:"wy-reaction-count"},count)),React.createElement(UISheet.UI,{title:"Reactions",isOpen:isOpen,onClose:function onClose(){setIsOpen(false)}},isOpen&&React.createElement(React.Fragment,null,isLoading&&React.createElement(UISpinner.UI,{overlay:true}),!isLoading&&data&&((_a=data.data)===null||_a===void 0?void 0:_a.map(function(reaction,index){return React.createElement("div",{className:"wy-item",key:"r"+index},React.createElement(Avatar,{size:32,src:reaction.created_by.avatar_url,name:reaction.created_by.display_name}),React.createElement("div",{className:"wy-item-body"},reaction.created_by.display_name),React.createElement("span",{className:"wy-emoji"},reaction.content))}))))),count>0&&!featureEnabled&&React.createElement(React.Fragment,null,React.createElement("a",{href:"#",className:"wy-like-count",onClick:function onClick(e){return handleOpen(e)}},count," ",count===1?"like":"likes"),React.createElement(UISheet.UI,{title:"Reactions",isOpen:isOpen,onClose:function onClose(){setIsOpen(false)}},isOpen&&React.createElement(React.Fragment,null,isLoading&&React.createElement(UISpinner.UI,{overlay:true}),!isLoading&&data&&((_b=data.data)===null||_b===void 0?void 0:_b.map(function(reaction,index){return React.createElement("div",{className:"wy-item",key:"r"+index},React.createElement(Avatar,{size:32,src:reaction.created_by.avatar_url,name:reaction.created_by.display_name}),React.createElement("div",{className:"wy-item-body"},reaction.created_by.display_name),React.createElement("span",{className:"wy-emoji"},reaction.content))}))))))};var SeenBy=function SeenBy(_ref204){var seenBy=_ref204.seenBy;return React.createElement(React.Fragment,null,seenBy&&seenBy.length>0&&React.createElement("div",{className:"wy-readby-status"},seenBy.map(function(member){var date=dayjs.utc(member.marked_at).tz(dayjs.tz.guess());return React.createElement(Avatar,{name:"Seen by ".concat(member.display_name," at ").concat(date.format("LLLL")),src:member.avatar_url,size:16,key:member.id})})))};var MeetingCard=function MeetingCard(_ref205){var meeting=_ref205.meeting;return React.createElement("div",{className:"wy-list"},meeting.ended_at&&React.createElement("div",{className:"wy-item wy-meeting"},React.createElement(UIIcon.UI,{name:"zoom",size:96,color:"gray"}),React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},"Zoom meeting"),React.createElement("div",{className:"wy-item-body"},React.createElement("div",null,"Ended ",dayjs.utc(meeting.ended_at).tz(dayjs.tz.guess()).fromNow()),meeting.recording_url&&React.createElement("div",{className:"wy-meeting-actions"},React.createElement("a",{href:meeting.recording_url,target:"_blank",className:"wy-button wy-button-primary"},"Play recording"))))),!meeting.ended_at&&React.createElement("a",{className:"wy-item wy-meeting",href:meeting.join_url,target:"_blank"},React.createElement(UIIcon.UI,{name:"zoom",color:"native",size:96}),React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},"Zoom meeting"),React.createElement("div",{className:"wy-item-body"},React.createElement("div",null,"ID: ","".concat(meeting.provider_id.substring(0,3),"-").concat(meeting.provider_id.substring(3,6),"-").concat(meeting.provider_id.substring(6))),React.createElement("div",{className:"wy-meeting-actions"},React.createElement(UIButton.UI,{className:"wy-button-primary"},"Join meeting"))))))};function useMutateVote(){var queryClient=useQueryClient();var _React$useContext22=React.useContext(WeavyContext),client=_React$useContext22.client;if(!client){throw new Error("useMutateVote must be used within an WeavyProvider")}var mutateVote=function(){var _ref207=_asyncToGenerator(_regeneratorRuntime().mark(function _callee127(_ref206){var id,response;return _regeneratorRuntime().wrap(function _callee127$(_context129){while(1)switch(_context129.prev=_context129.next){case 0:id=_ref206.id;_context129.next=3;return client.post("/api/options/".concat(id,"/vote"),"POST","");case 3:response=_context129.sent;return _context129.abrupt("return",response.json());case 5:case"end":return _context129.stop()}},_callee127)}));return function mutateVote(_x100){return _ref207.apply(this,arguments)}}();return useMutation(mutateVote,{onSuccess:function(){var _onSuccess2=_asyncToGenerator(_regeneratorRuntime().mark(function _callee128(data,variables,context){var response,json;return _regeneratorRuntime().wrap(function _callee128$(_context130){while(1)switch(_context130.prev=_context130.next){case 0:_context130.next=2;return client.get("/api/"+variables.type+"/"+variables.parentId);case 2:response=_context130.sent;_context130.next=5;return response.json();case 5:json=_context130.sent;updateCacheItem(queryClient,[variables.type,variables.appId],variables.parentId,function(item){item.options=json.options});case 7:case"end":return _context130.stop()}},_callee128)}));function onSuccess(_x101,_x102,_x103){return _onSuccess2.apply(this,arguments)}return onSuccess}(),onMutate:function(){var _onMutate4=_asyncToGenerator(_regeneratorRuntime().mark(function _callee129(variables){return _regeneratorRuntime().wrap(function _callee129$(_context131){while(1)switch(_context131.prev=_context131.next){case 0:updateCacheItem(queryClient,[variables.type,variables.appId],variables.parentId,function(item){var _a;item.options=(_a=item.options)===null||_a===void 0?void 0:_a.map(function(o){if(o.has_voted){o.has_voted=false;var _count=o.vote_count||1;o.vote_count=_count-1}else if(!o.has_voted&&o.id===variables.id){o.has_voted=true;var _count2=o.vote_count||0;o.vote_count=_count2+1}return o})});case 1:case"end":return _context131.stop()}},_callee129)}));function onMutate(_x104){return _onMutate4.apply(this,arguments)}return onMutate}()})}function useVotes(id,options){var _React$useContext23=React.useContext(WeavyContext),client=_React$useContext23.client;if(!client){throw new Error("useVotes must be used within an WeavyProvider")}var getVotes=function(){var _ref208=_asyncToGenerator(_regeneratorRuntime().mark(function _callee130(){var response,data;return _regeneratorRuntime().wrap(function _callee130$(_context132){while(1)switch(_context132.prev=_context132.next){case 0:_context132.next=2;return client.get("/api/options/".concat(id,"/voters"));case 2:response=_context132.sent;_context132.next=5;return response.json();case 5:data=_context132.sent;return _context132.abrupt("return",data);case 7:case"end":return _context132.stop()}},_callee130)}));return function getVotes(){return _ref208.apply(this,arguments)}}();return useQuery(["votes",id],getVotes,options)}var PollOption=function PollOption(_ref209){var id=_ref209.id,text=_ref209.text,has_voted=_ref209.has_voted,ratio=_ref209.ratio,onVote=_ref209.onVote;var _React$useState77=React.useState(false),_React$useState78=_slicedToArray2(_React$useState77,2),isOpen=_React$useState78[0],setIsOpen=_React$useState78[1];var _useVotes=useVotes(id,{enabled:false}),data=_useVotes.data,isLoading=_useVotes.isLoading,refetch=_useVotes.refetch;var openSheet=function openSheet(e){e.preventDefault();e.stopPropagation();setIsOpen(true);refetch()};return React.createElement(React.Fragment,null,React.createElement("div",{className:"wy-item wy-poll-option",onClick:function onClick(){return onVote(id)}},React.createElement("div",{className:"wy-progress",style:{width:ratio+"%"}}),has_voted&&React.createElement(UIIcon.UI,{name:"check-circle"}),!has_voted&&React.createElement(UIIcon.UI,{name:"circle-outline"}),React.createElement("div",{className:"wy-item-body"},text),ratio>0&&React.createElement("a",{className:"wy-facepile",onClick:openSheet}," ",ratio+"%"," ")),React.createElement(UISheet.UI,{title:text,isOpen:isOpen,onClose:function onClose(){return setIsOpen(false)}},isLoading&&React.createElement(UISpinner.UI,null),!isLoading&&data&&data.map(function(user,index){return React.createElement("div",{className:"wy-item",key:"vote"+index},React.createElement(Avatar,{size:32,src:user.avatar_url,name:user.display_name}),React.createElement("div",{className:"wy-item-body"},user.display_name))})))};var Poll=function Poll(_ref210){var appId=_ref210.appId,parentId=_ref210.parentId,parentType=_ref210.parentType,options=_ref210.options;var _React$useState79=React.useState(options),_React$useState80=_slicedToArray2(_React$useState79,2),pollOptions=_React$useState80[0],setPollOptions=_React$useState80[1];var _React$useState81=React.useState(0),_React$useState82=_slicedToArray2(_React$useState81,2),totalVotes=_React$useState82[0],setTotalVotes=_React$useState82[1];var vote=useMutateVote();React.useEffect(function(){var total=pollOptions.reduce(function(prev,curr){return prev+(curr.vote_count||0)},0);setTotalVotes(total)},[pollOptions]);React.useEffect(function(){setPollOptions(options)},[options]);var handleVote=function(){var _ref211=_asyncToGenerator(_regeneratorRuntime().mark(function _callee131(optionId){return _regeneratorRuntime().wrap(function _callee131$(_context133){while(1)switch(_context133.prev=_context133.next){case 0:if(!optionId){_context133.next=3;break}_context133.next=3;return vote.mutateAsync({id:optionId,appId:appId,type:parentType,parentId:parentId});case 3:case"end":return _context133.stop()}},_callee131)}));return function handleVote(_x105){return _ref211.apply(this,arguments)}}();return React.createElement("div",{className:"wy-poll"},pollOptions.map(function(o){var ratio=totalVotes>0?Math.round((o.vote_count||0)/totalVotes*100):0;return React.createElement(PollOption,{key:"option"+o.id,id:o.id||-1,text:o.text,has_voted:o.has_voted,ratio:ratio,onVote:handleVote})}))};var Feature;(function(Feature){Feature["Attachments"]="Attachments";Feature["CloudFiles"]="CloudFiles";Feature["Embeds"]="Embeds";Feature["Meetings"]="Meetings";Feature["Mentions"]="Mentions";Feature["Polls"]="Polls";Feature["Previews"]="Previews";Feature["Reactions"]="Reactions";Feature["Receipts"]="Receipts";Feature["Thumbnails"]="Thumbnails";Feature["Typing"]="Typing";Feature["Webhooks"]="Webhooks";Feature["Comments"]="Comments";Feature["Versions"]="Versions";Feature["WebDAV"]="WebDAV"})(Feature||(Feature={}));var hasFeature=function hasFeature(features,feature){var enabled=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return features.indexOf(feature)!=-1&&enabled};var Message=function Message(_ref212){var id=_ref212.id,html=_ref212.html,temp=_ref212.temp,me=_ref212.me,avatar=_ref212.avatar,name=_ref212.name,created_at=_ref212.created_at,created_by=_ref212.created_by,attachments=_ref212.attachments,meeting=_ref212.meeting,options=_ref212.options,appId=_ref212.appId,reactions=_ref212.reactions,seenBy=_ref212.seenBy,chatRoom=_ref212.chatRoom,features=_ref212.features,appFeatures=_ref212.appFeatures;var _React$useContext24=React.useContext(PreviewContext),openPreview=_React$useContext24.openPreview,setPreviewFiles=_React$useContext24.setPreviewFiles;var images=attachments===null||attachments===void 0?void 0:attachments.filter(function(a){return a.kind==="image"&&a.thumbnail_url});var files=attachments===null||attachments===void 0?void 0:attachments.filter(function(a){return a.kind!=="image"||!a.thumbnail_url});var date=dayjs.utc(created_at).tz(dayjs.tz.guess());var handlePreviewClick=function handlePreviewClick(e,attachmentId){e.preventDefault();setPreviewFiles(attachments);openPreview(attachmentId)};return React.createElement(React.Fragment,null,React.createElement("div",{className:classNames("wy-message",{"wy-message-me":me})},!me&&React.createElement("div",{className:"wy-message-author"},avatar&&React.createElement(Avatar,{src:avatar,size:32,name:name})),React.createElement("div",{className:"wy-message-content"},React.createElement("div",{className:"wy-message-meta"},chatRoom&&!me&&React.createElement("span",null,created_by," \xB7 "),React.createElement("time",{dateTime:created_at,title:date.format("LLLL")},date.fromNow())),React.createElement("div",{className:"wy-message-bubble"},temp&&React.createElement("div",{className:"wy-content"},html),!temp&&React.createElement(React.Fragment,null,images&&!!images.length&&React.createElement(ImageGrid,null,images.map(function(a){return a.download_url&&React.createElement(Image$1,{onClick:function onClick(e){return handlePreviewClick(e,a.id)},key:a.id,src:a.download_url,previewSrc:a.preview_url,width:a.width,height:a.height})||null})),html&&React.createElement("div",{className:"wy-content",dangerouslySetInnerHTML:{__html:html||""}}),meeting&&React.createElement(MeetingCard,{meeting:meeting}),options&&options.length>0&&React.createElement(Poll,{appId:appId,parentId:id,parentType:"messages",options:options}),files&&!!files.length&&React.createElement("div",{className:"wy-list wy-list-bordered"},files.map(function(a){return React.createElement(Attachment,{key:a.id,onClick:function onClick(e){return handlePreviewClick(e,a.id)},name:a.name,previewFormat:a.kind,provider:a.provider,url:a.download_url,previewUrl:a.provider?a.external_url:a.preview_url,mediaType:a.media_type,kind:a.kind,size:a.size})})),React.createElement("div",{className:"wy-reactions-line"},hasFeature(features,Feature.Reactions,appFeatures===null||appFeatures===void 0?void 0:appFeatures.reactions)?React.createElement(React.Fragment,null,React.createElement(ReactionsList,{id:id,type:"messages",parentId:appId,reactions:reactions}),!temp&&React.createElement(ReactionsMenu,{parentId:appId,id:id,type:"messages",reactions:reactions,placement:me?"top-end":"top-start"})):React.createElement(React.Fragment,null,!temp&&React.createElement(ReactionsList,{id:id,type:"messages",parentId:appId,reactions:reactions,featureEnabled:false}),React.createElement(ReactionsLike,{id:id,type:"messages",parentId:appId,reactions:reactions}))))))),hasFeature(features,Feature.Receipts,appFeatures===null||appFeatures===void 0?void 0:appFeatures.receipts)&&React.createElement(SeenBy,{id:id,parentId:appId,seenBy:seenBy,createdAt:created_at}))};function getNextPositionedChild(el){while(el){el=el.nextElementSibling;if(/absolute|sticky|fixed/.test(getComputedStyle(el).position)===false){return el}}}function getScrollParent(element,includeHidden){if(element){var style=getComputedStyle(element);var excludeStaticParent=style.position==="absolute";var overflowRegex=includeHidden?/(auto|scroll|overlay|hidden)/:/(auto|overlay|scroll)/;if(style.position==="fixed"){return document.scrollingElement}for(var parent=element;parent=parent.parentElement;){style=getComputedStyle(parent);if(excludeStaticParent&&style.position==="static"){continue}if(overflowRegex.test(style.overflow+style.overflowY+style.overflowX)){return parent}}}return document.scrollingElement}function isParentAtBottom(element,bottomThreshold){if(element){var _bottomThreshold;(_bottomThreshold=bottomThreshold)!==null&&_bottomThreshold!==void 0?_bottomThreshold:bottomThreshold=128;var area=getScrollParent(element);return Math.abs(area.scrollTop+area.clientHeight-area.scrollHeight)<bottomThreshold}return false}function scrollParentToBottom(_x106,_x107){return _scrollParentToBottom.apply(this,arguments)}function _scrollParentToBottom(){_scrollParentToBottom=_asyncToGenerator(_regeneratorRuntime().mark(function _callee215(element,smooth){var area;return _regeneratorRuntime().wrap(function _callee215$(_context218){while(1)switch(_context218.prev=_context218.next){case 0:if(!element){_context218.next=5;break}area=getScrollParent(element);if(Math.abs(area.scrollTop+area.clientHeight-area.scrollHeight)>1){if(smooth){area.scrollTo({top:area.scrollHeight,left:0,behavior:"smooth"})}else{area.scrollTop=area.scrollHeight}}_context218.next=5;return new Promise(function(resolve){var lastScrollTop=area.scrollTop;var scrollCheck=function scrollCheck(){if(smooth&&area.scrollTop===lastScrollTop){area.scrollTop=area.scrollHeight}lastScrollTop=area.scrollTop;if(Math.abs(area.scrollTop+area.clientHeight-area.scrollHeight)>1){requestAnimationFrame(scrollCheck)}else{resolve()}};requestAnimationFrame(scrollCheck)});case 5:case"end":return _context218.stop()}},_callee215)}));return _scrollParentToBottom.apply(this,arguments)}var THRESHOLD=0;var ROOT_MARGIN="24px";function createScroller(observeElement,whenNext){var _whenNext;var reverse=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var prevSleep=false;var parent=getScrollParent(observeElement);parent.style.overflowAnchor="none";var intersectionParent=parent===document.documentElement?document:parent;(_whenNext=whenNext)!==null&&_whenNext!==void 0?_whenNext:whenNext=function whenNext(){return Promise.reject(new Error("No reverse scroller handler function defined"))};var scrollObserver=new IntersectionObserver(function(entries,observer){entries.forEach(function(entry){if(entry.isIntersecting&&!prevSleep){prevSleep=true;if(reverse){var nextPositionedChild=getNextPositionedChild(entry.target);var prevScrollHeight=parent.scrollHeight;var childOffsetBefore=nextPositionedChild.offsetTop}var afterNext=function afterNext(){queueMicrotask(function(){if(prevScrollHeight!==parent.scrollHeight){if(reverse){var diff=nextPositionedChild.offsetTop-childOffsetBefore;parent.scrollTop+=diff}requestAnimationFrame(function(){return prevSleep=false})}else{queueMicrotask(function(){if(prevScrollHeight!==parent.scrollHeight){if(reverse){var _diff=nextPositionedChild.offsetTop-childOffsetBefore;parent.scrollTop+=_diff}requestAnimationFrame(function(){return prevSleep=false})}else{requestAnimationFrame(function(){if(reverse){var _diff2=nextPositionedChild.offsetTop-childOffsetBefore;parent.scrollTop+=_diff2}requestAnimationFrame(function(){return prevSleep=false})})}})}})};var whenNextResult=whenNext();if(whenNextResult){whenNextResult.then(afterNext)}else{afterNext()}}})},{root:intersectionParent,threshold:THRESHOLD,rootMargin:ROOT_MARGIN});scrollObserver.observe(observeElement);return scrollObserver}function useInfinteScroll(infiniteQuery){var deps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var reverse=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var loadMoreRef=React.useRef();var _React$useState83=React.useState(),_React$useState84=_slicedToArray2(_React$useState83,2),resolveScrollerFetch=_React$useState84[0],setResolveScrollerFetch=_React$useState84[1];React.useLayoutEffect(function(){if(!infiniteQuery.isLoading){var scroller;requestAnimationFrame(function(){scroller=createScroller(loadMoreRef.current,function(){if(infiniteQuery.hasNextPage||infiniteQuery.isFetching){return infiniteQuery.fetchNextPage({cancelRefetch:false}).then(function(){if(reverse){return new Promise(function(resolve){setResolveScrollerFetch(function(){resolve()})})}})}},reverse)});return function(){scroller===null||scroller===void 0?void 0:scroller.disconnect()}}},[infiniteQuery.isLoading,infiniteQuery.dataUpdatedAt].concat(_toConsumableArray2(deps)));return loadMoreRef}function useReverseInfiniteScroll(infiniteQuery){var deps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return useInfinteScroll(infiniteQuery,deps,true)}function useMutateRead(){var _React$useContext25=React.useContext(WeavyContext),client=_React$useContext25.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateUnread must be used within an WeavyProvider")}var mutateRead=function(){var _ref214=_asyncToGenerator(_regeneratorRuntime().mark(function _callee132(_ref213){var id,read,messageId,url,response;return _regeneratorRuntime().wrap(function _callee132$(_context134){while(1)switch(_context134.prev=_context134.next){case 0:id=_ref213.id,read=_ref213.read,messageId=_ref213.messageId;url=read?"/api/conversations/".concat(id,"/mark?messageId=").concat(messageId):"/api/conversations/".concat(id,"/mark");_context134.next=4;return client.post(url,!read?"DELETE":"PUT","");case 4:response=_context134.sent;return _context134.abrupt("return",response.json());case 6:case"end":return _context134.stop()}},_callee132)}));return function mutateRead(_x108){return _ref214.apply(this,arguments)}}();return useMutation(mutateRead,{onSuccess:function onSuccess(){queryClient.invalidateQueries("conversations")},onMutate:function(){var _onMutate5=_asyncToGenerator(_regeneratorRuntime().mark(function _callee133(variables){return _regeneratorRuntime().wrap(function _callee133$(_context135){while(1)switch(_context135.prev=_context135.next){case 0:updateCacheItem(queryClient,"conversations",variables.id,function(item){item.is_unread=!variables.read});case 1:case"end":return _context135.stop()}},_callee133)}));function onMutate(_x109){return _onMutate5.apply(this,arguments)}return onMutate}()})}function useMutateMessage(){var _React$useContext26=React.useContext(WeavyContext),client=_React$useContext26.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateMessage must be used within an WeavyProvider")}var mutateMessage=function(){var _ref216=_asyncToGenerator(_regeneratorRuntime().mark(function _callee134(_ref215){var id,text,blobs,meeting,response;return _regeneratorRuntime().wrap(function _callee134$(_context136){while(1)switch(_context136.prev=_context136.next){case 0:id=_ref215.id,text=_ref215.text,blobs=_ref215.blobs,meeting=_ref215.meeting;_context136.next=3;return client.post("/api/apps/"+id+"/messages","POST",JSON.stringify({text:text,blobs:blobs.map(function(b){return b.id}),meeting_id:meeting}));case 3:response=_context136.sent;return _context136.abrupt("return",response.json());case 5:case"end":return _context136.stop()}},_callee134)}));return function mutateMessage(_x110){return _ref216.apply(this,arguments)}}();return useMutation(mutateMessage,{onSuccess:function onSuccess(data,variables,context){addCacheItem(queryClient,["messages",variables.id],data,context.tempId);queryClient.invalidateQueries("conversations")},onMutate:function(){var _onMutate6=_asyncToGenerator(_regeneratorRuntime().mark(function _callee135(variables){var tempId,tempData;return _regeneratorRuntime().wrap(function _callee135$(_context137){while(1)switch(_context137.prev=_context137.next){case 0:_context137.next=2;return queryClient.cancelQueries(["messages",variables.id]);case 2:tempId=Math.random();tempData={id:tempId,app_id:-1,attachment_ids:[],is_subscribed:true,is_trashed:false,text:variables.text,html:variables.text,plain:variables.text,temp:true,created_by_id:variables.userId,created_by:{id:variables.userId,avatar_url:"",display_name:"",presence:"",name:""},created_at:new Date().toUTCString(),attachments:[],reactions:[]};addCacheItem(queryClient,["messages",variables.id],tempData);variables.callback();return _context137.abrupt("return",{tempId:tempId});case 7:case"end":return _context137.stop()}},_callee135)}));function onMutate(_x111){return _onMutate6.apply(this,arguments)}return onMutate}()})}function _objectWithoutPropertiesLoose$1(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key]}return target}var Text=function(){function Text(){_classCallCheck2(this,Text)}_createClass2(Text,[{key:"lineAt",value:function lineAt(pos){if(pos<0||pos>this.length)throw new RangeError("Invalid position ".concat(pos," in document of length ").concat(this.length));return this.lineInner(pos,false,1,0)}},{key:"line",value:function line(n){if(n<1||n>this.lines)throw new RangeError("Invalid line number ".concat(n," in ").concat(this.lines,"-line document"));return this.lineInner(n,true,1,0)}},{key:"replace",value:function replace(from,to,text){var _clip=clip(this,from,to);var _clip2=_slicedToArray2(_clip,2);from=_clip2[0];to=_clip2[1];var parts=[];this.decompose(0,from,parts,2);if(text.length)text.decompose(0,text.length,parts,1|2);this.decompose(to,this.length,parts,1);return TextNode.from(parts,this.length-(to-from)+text.length)}},{key:"append",value:function append(other){return this.replace(this.length,this.length,other)}},{key:"slice",value:function slice(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.length;var _clip3=clip(this,from,to);var _clip4=_slicedToArray2(_clip3,2);from=_clip4[0];to=_clip4[1];var parts=[];this.decompose(from,to,parts,0);return TextNode.from(parts,to-from)}},{key:"eq",value:function eq(other){if(other==this)return true;if(other.length!=this.length||other.lines!=this.lines)return false;var start=this.scanIdentical(other,1),end=this.length-this.scanIdentical(other,-1);var a=new RawTextCursor(this),b=new RawTextCursor(other);for(var skip=start,pos=start;;){a.next(skip);b.next(skip);skip=0;if(a.lineBreak!=b.lineBreak||a.done!=b.done||a.value!=b.value)return false;pos+=a.value.length;if(a.done||pos>=end)return true}}},{key:"iter",value:function iter(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return new RawTextCursor(this,dir)}},{key:"iterRange",value:function iterRange(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.length;return new PartialTextCursor(this,from,to)}},{key:"iterLines",value:function iterLines(from,to){var inner;if(from==null){inner=this.iter()}else{if(to==null)to=this.lines+1;var _start4=this.line(from).from;inner=this.iterRange(_start4,Math.max(_start4,to==this.lines+1?this.length:to<=1?0:this.line(to-1).to))}return new LineCursor(inner)}},{key:"toString",value:function toString(){return this.sliceString(0)}},{key:"toJSON",value:function toJSON(){var lines=[];this.flatten(lines);return lines}}],[{key:"of",value:function of(text){if(text.length==0)throw new RangeError("A document must have at least one line");if(text.length==1&&!text[0])return Text.empty;return text.length<=32?new TextLeaf(text):TextNode.from(TextLeaf.split(text,[]))}}]);return Text}();var TextLeaf=function(_Text){_inherits2(TextLeaf,_Text);var _super69=_createSuper(TextLeaf);function TextLeaf(text){var _this172;var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:textLength(text);_classCallCheck2(this,TextLeaf);_this172=_super69.call(this);_this172.text=text;_this172.length=length;return _this172}_createClass2(TextLeaf,[{key:"lines",get:function get(){return this.text.length}},{key:"children",get:function get(){return null}},{key:"lineInner",value:function lineInner(target,isLine,line,offset){for(var _i93=0;;_i93++){var _string=this.text[_i93],_end6=offset+_string.length;if((isLine?line:_end6)>=target)return new Line$1(offset,_end6,line,_string);offset=_end6+1;line++}}},{key:"decompose",value:function decompose(from,to,target,open){var text=from<=0&&to>=this.length?this:new TextLeaf(sliceText(this.text,from,to),Math.min(to,this.length)-Math.max(0,from));if(open&1){var prev=target.pop();var joined=appendText(text.text,prev.text.slice(),0,text.length);if(joined.length<=32){target.push(new TextLeaf(joined,prev.length+text.length))}else{var mid=joined.length>>1;target.push(new TextLeaf(joined.slice(0,mid)),new TextLeaf(joined.slice(mid)))}}else{target.push(text)}}},{key:"replace",value:function replace(from,to,text){if(!(text instanceof TextLeaf))return _get5(_getPrototypeOf(TextLeaf.prototype),"replace",this).call(this,from,to,text);var _clip5=clip(this,from,to);var _clip6=_slicedToArray2(_clip5,2);from=_clip6[0];to=_clip6[1];var lines=appendText(this.text,appendText(text.text,sliceText(this.text,0,from)),to);var newLen=this.length+text.length-(to-from);if(lines.length<=32)return new TextLeaf(lines,newLen);return TextNode.from(TextLeaf.split(lines,[]),newLen)}},{key:"sliceString",value:function sliceString(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.length;var lineSep=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"\n";var _clip7=clip(this,from,to);var _clip8=_slicedToArray2(_clip7,2);from=_clip8[0];to=_clip8[1];var result="";for(var pos=0,_i94=0;pos<=to&&_i94<this.text.length;_i94++){var line=this.text[_i94],_end7=pos+line.length;if(pos>from&&_i94)result+=lineSep;if(from<_end7&&to>pos)result+=line.slice(Math.max(0,from-pos),to-pos);pos=_end7+1}return result}},{key:"flatten",value:function flatten(target){var _iterator190=_createForOfIteratorHelper(this.text),_step190;try{for(_iterator190.s();!(_step190=_iterator190.n()).done;){var line=_step190.value;target.push(line)}}catch(err){_iterator190.e(err)}finally{_iterator190.f()}}},{key:"scanIdentical",value:function scanIdentical(){return 0}}],[{key:"split",value:function split(text,target){var part=[],len=-1;var _iterator191=_createForOfIteratorHelper(text),_step191;try{for(_iterator191.s();!(_step191=_iterator191.n()).done;){var line=_step191.value;part.push(line);len+=line.length+1;if(part.length==32){target.push(new TextLeaf(part,len));part=[];len=-1}}}catch(err){_iterator191.e(err)}finally{_iterator191.f()}if(len>-1)target.push(new TextLeaf(part,len));return target}}]);return TextLeaf}(Text);var TextNode=function(_Text2){_inherits2(TextNode,_Text2);var _super70=_createSuper(TextNode);function TextNode(children,length){var _this173;_classCallCheck2(this,TextNode);_this173=_super70.call(this);_this173.children=children;_this173.length=length;_this173.lines=0;var _iterator192=_createForOfIteratorHelper(children),_step192;try{for(_iterator192.s();!(_step192=_iterator192.n()).done;){var child=_step192.value;_this173.lines+=child.lines}}catch(err){_iterator192.e(err)}finally{_iterator192.f()}return _this173}_createClass2(TextNode,[{key:"lineInner",value:function lineInner(target,isLine,line,offset){for(var _i95=0;;_i95++){var child=this.children[_i95],_end8=offset+child.length,endLine=line+child.lines-1;if((isLine?endLine:_end8)>=target)return child.lineInner(target,isLine,line,offset);offset=_end8+1;line=endLine+1}}},{key:"decompose",value:function decompose(from,to,target,open){for(var _i96=0,pos=0;pos<=to&&_i96<this.children.length;_i96++){var child=this.children[_i96],_end9=pos+child.length;if(from<=_end9&&to>=pos){var childOpen=open&((pos<=from?1:0)|(_end9>=to?2:0));if(pos>=from&&_end9<=to&&!childOpen)target.push(child);else child.decompose(from-pos,to-pos,target,childOpen)}pos=_end9+1}}},{key:"replace",value:function replace(from,to,text){var _clip9=clip(this,from,to);var _clip10=_slicedToArray2(_clip9,2);from=_clip10[0];to=_clip10[1];if(text.lines<this.lines)for(var _i97=0,pos=0;_i97<this.children.length;_i97++){var child=this.children[_i97],_end10=pos+child.length;if(from>=pos&&to<=_end10){var updated=child.replace(from-pos,to-pos,text);var totalLines=this.lines-child.lines+updated.lines;if(updated.lines<totalLines>>5-1&&updated.lines>totalLines>>5+1){var copy=this.children.slice();copy[_i97]=updated;return new TextNode(copy,this.length-(to-from)+text.length)}return _get5(_getPrototypeOf(TextNode.prototype),"replace",this).call(this,pos,_end10,updated)}pos=_end10+1}return _get5(_getPrototypeOf(TextNode.prototype),"replace",this).call(this,from,to,text)}},{key:"sliceString",value:function sliceString(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.length;var lineSep=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"\n";var _clip11=clip(this,from,to);var _clip12=_slicedToArray2(_clip11,2);from=_clip12[0];to=_clip12[1];var result="";for(var _i98=0,pos=0;_i98<this.children.length&&pos<=to;_i98++){var child=this.children[_i98],_end11=pos+child.length;if(pos>from&&_i98)result+=lineSep;if(from<_end11&&to>pos)result+=child.sliceString(from-pos,to-pos,lineSep);pos=_end11+1}return result}},{key:"flatten",value:function flatten(target){var _iterator193=_createForOfIteratorHelper(this.children),_step193;try{for(_iterator193.s();!(_step193=_iterator193.n()).done;){var child=_step193.value;child.flatten(target)}}catch(err){_iterator193.e(err)}finally{_iterator193.f()}}},{key:"scanIdentical",value:function scanIdentical(other,dir){if(!(other instanceof TextNode))return 0;var length=0;var _ref217=dir>0?[0,0,this.children.length,other.children.length]:[this.children.length-1,other.children.length-1,-1,-1],_ref218=_slicedToArray2(_ref217,4),iA=_ref218[0],iB=_ref218[1],eA=_ref218[2],eB=_ref218[3];for(;;iA+=dir,iB+=dir){if(iA==eA||iB==eB)return length;var chA=this.children[iA],chB=other.children[iB];if(chA!=chB)return length+chA.scanIdentical(chB,dir);length+=chA.length+1}}}],[{key:"from",value:function from(children){var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:children.reduce(function(l,ch){return l+ch.length+1},-1);var lines=0;var _iterator194=_createForOfIteratorHelper(children),_step194;try{for(_iterator194.s();!(_step194=_iterator194.n()).done;){var _ch=_step194.value;lines+=_ch.lines}}catch(err){_iterator194.e(err)}finally{_iterator194.f()}if(lines<32){var flat=[];var _iterator195=_createForOfIteratorHelper(children),_step195;try{for(_iterator195.s();!(_step195=_iterator195.n()).done;){var ch=_step195.value;ch.flatten(flat)}}catch(err){_iterator195.e(err)}finally{_iterator195.f()}return new TextLeaf(flat,length)}var chunk=Math.max(32,lines>>5),maxChunk=chunk<<1,minChunk=chunk>>1;var chunked=[],currentLines=0,currentLen=-1,currentChunk=[];function add(child){var last;if(child.lines>maxChunk&&child instanceof TextNode){var _iterator196=_createForOfIteratorHelper(child.children),_step196;try{for(_iterator196.s();!(_step196=_iterator196.n()).done;){var node=_step196.value;add(node)}}catch(err){_iterator196.e(err)}finally{_iterator196.f()}}else if(child.lines>minChunk&&(currentLines>minChunk||!currentLines)){flush();chunked.push(child)}else if(child instanceof TextLeaf&&currentLines&&(last=currentChunk[currentChunk.length-1])instanceof TextLeaf&&child.lines+last.lines<=32){currentLines+=child.lines;currentLen+=child.length+1;currentChunk[currentChunk.length-1]=new TextLeaf(last.text.concat(child.text),last.length+1+child.length)}else{if(currentLines+child.lines>chunk)flush();currentLines+=child.lines;currentLen+=child.length+1;currentChunk.push(child)}}function flush(){if(currentLines==0)return;chunked.push(currentChunk.length==1?currentChunk[0]:TextNode.from(currentChunk,currentLen));currentLen=-1;currentLines=currentChunk.length=0}var _iterator197=_createForOfIteratorHelper(children),_step197;try{for(_iterator197.s();!(_step197=_iterator197.n()).done;){var child=_step197.value;add(child)}}catch(err){_iterator197.e(err)}finally{_iterator197.f()}flush();return chunked.length==1?chunked[0]:new TextNode(chunked,length)}}]);return TextNode}(Text);Text.empty=new TextLeaf([""],0);function textLength(text){var length=-1;var _iterator198=_createForOfIteratorHelper(text),_step198;try{for(_iterator198.s();!(_step198=_iterator198.n()).done;){var line=_step198.value;length+=line.length+1}}catch(err){_iterator198.e(err)}finally{_iterator198.f()}return length}function appendText(text,target){var from=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var to=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1e9;for(var pos=0,_i99=0,first=true;_i99<text.length&&pos<=to;_i99++){var line=text[_i99],_end12=pos+line.length;if(_end12>=from){if(_end12>to)line=line.slice(0,to-pos);if(pos<from)line=line.slice(from-pos);if(first){target[target.length-1]+=line;first=false}else target.push(line)}pos=_end12+1}return target}function sliceText(text,from,to){return appendText(text,[""],from,to)}var RawTextCursor=function(){function RawTextCursor(text){var dir=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck2(this,RawTextCursor);this.dir=dir;this.done=false;this.lineBreak=false;this.value="";this.nodes=[text];this.offsets=[dir>0?1:(text instanceof TextLeaf?text.text.length:text.children.length)<<1]}_createClass2(RawTextCursor,[{key:"nextInner",value:function nextInner(skip,dir){this.done=this.lineBreak=false;for(;;){var last=this.nodes.length-1;var _top=this.nodes[last],offsetValue=this.offsets[last],_offset2=offsetValue>>1;var size=_top instanceof TextLeaf?_top.text.length:_top.children.length;if(_offset2==(dir>0?size:0)){if(last==0){this.done=true;this.value="";return this}if(dir>0)this.offsets[last-1]++;this.nodes.pop();this.offsets.pop()}else if((offsetValue&1)==(dir>0?0:1)){this.offsets[last]+=dir;if(skip==0){this.lineBreak=true;this.value="\n";return this}skip--}else if(_top instanceof TextLeaf){var next=_top.text[_offset2+(dir<0?-1:0)];this.offsets[last]+=dir;if(next.length>Math.max(0,skip)){this.value=skip==0?next:dir>0?next.slice(skip):next.slice(0,next.length-skip);return this}skip-=next.length}else{var _next3=_top.children[_offset2+(dir<0?-1:0)];if(skip>_next3.length){skip-=_next3.length;this.offsets[last]+=dir}else{if(dir<0)this.offsets[last]--;this.nodes.push(_next3);this.offsets.push(dir>0?1:(_next3 instanceof TextLeaf?_next3.text.length:_next3.children.length)<<1)}}}}},{key:"next",value:function next(){var skip=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(skip<0){this.nextInner(-skip,-this.dir);skip=this.value.length}return this.nextInner(skip,this.dir)}}]);return RawTextCursor}();var PartialTextCursor=function(){function PartialTextCursor(text,start,end){_classCallCheck2(this,PartialTextCursor);this.value="";this.done=false;this.cursor=new RawTextCursor(text,start>end?-1:1);this.pos=start>end?text.length:0;this.from=Math.min(start,end);this.to=Math.max(start,end)}_createClass2(PartialTextCursor,[{key:"nextInner",value:function nextInner(skip,dir){if(dir<0?this.pos<=this.from:this.pos>=this.to){this.value="";this.done=true;return this}skip+=Math.max(0,dir<0?this.pos-this.to:this.from-this.pos);var limit=dir<0?this.pos-this.from:this.to-this.pos;if(skip>limit)skip=limit;limit-=skip;var _this$cursor$next=this.cursor.next(skip),value=_this$cursor$next.value;this.pos+=(value.length+skip)*dir;this.value=value.length<=limit?value:dir<0?value.slice(value.length-limit):value.slice(0,limit);this.done=!this.value;return this}},{key:"next",value:function next(){var skip=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(skip<0)skip=Math.max(skip,this.from-this.pos);else if(skip>0)skip=Math.min(skip,this.to-this.pos);return this.nextInner(skip,this.cursor.dir)}},{key:"lineBreak",get:function get(){return this.cursor.lineBreak&&this.value!=""}}]);return PartialTextCursor}();var LineCursor=function(){function LineCursor(inner){_classCallCheck2(this,LineCursor);this.inner=inner;this.afterBreak=true;this.value="";this.done=false}_createClass2(LineCursor,[{key:"next",value:function next(){var skip=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var _this$inner$next=this.inner.next(skip),done=_this$inner$next.done,lineBreak=_this$inner$next.lineBreak,value=_this$inner$next.value;if(done&&this.afterBreak){this.value="";this.afterBreak=false}else if(done){this.done=true;this.value=""}else if(lineBreak){if(this.afterBreak){this.value=""}else{this.afterBreak=true;this.next()}}else{this.value=value;this.afterBreak=false}return this}},{key:"lineBreak",get:function get(){return false}}]);return LineCursor}();if(typeof Symbol!="undefined"){Text.prototype[Symbol.iterator]=function(){return this.iter()};RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this}}var Line$1=function(){function Line(from,to,number,text){_classCallCheck2(this,Line);this.from=from;this.to=to;this.number=number;this.text=text}_createClass2(Line,[{key:"length",get:function get(){return this.to-this.from}}]);return Line}();function clip(text,from,to){from=Math.max(0,Math.min(text.length,from));return[from,Math.max(from,Math.min(text.length,to))]}var extend="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(function(s){return s?parseInt(s,36):1});for(var _i100=1;_i100<extend.length;_i100++)extend[_i100]+=extend[_i100-1];function isExtendingChar(code){for(var _i101=1;_i101<extend.length;_i101+=2)if(extend[_i101]>code)return extend[_i101-1]<=code;return false}function isRegionalIndicator(code){return code>=127462&&code<=127487}var ZWJ=8205;function findClusterBreak(str,pos){var forward=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var includeExtending=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;return(forward?nextClusterBreak:prevClusterBreak)(str,pos,includeExtending)}function nextClusterBreak(str,pos,includeExtending){if(pos==str.length)return pos;if(pos&&surrogateLow(str.charCodeAt(pos))&&surrogateHigh(str.charCodeAt(pos-1)))pos--;var prev=codePointAt(str,pos);pos+=codePointSize(prev);while(pos<str.length){var next=codePointAt(str,pos);if(prev==ZWJ||next==ZWJ||includeExtending&&isExtendingChar(next)){pos+=codePointSize(next);prev=next}else if(isRegionalIndicator(next)){var countBefore=0,_i102=pos-2;while(_i102>=0&&isRegionalIndicator(codePointAt(str,_i102))){countBefore++;_i102-=2}if(countBefore%2==0)break;else pos+=2}else{break}}return pos}function prevClusterBreak(str,pos,includeExtending){while(pos>0){var found=nextClusterBreak(str,pos-2,includeExtending);if(found<pos)return found;pos--}return 0}function surrogateLow(ch){return ch>=56320&&ch<57344}function surrogateHigh(ch){return ch>=55296&&ch<56320}function codePointAt(str,pos){var code0=str.charCodeAt(pos);if(!surrogateHigh(code0)||pos+1==str.length)return code0;var code1=str.charCodeAt(pos+1);if(!surrogateLow(code1))return code0;return(code0-55296<<10)+(code1-56320)+65536}function fromCodePoint(code){if(code<=65535)return String.fromCharCode(code);code-=65536;return String.fromCharCode((code>>10)+55296,(code&1023)+56320)}function codePointSize(code){return code<65536?1:2}var DefaultSplit=/\r\n?|\n/;var MapMode=function(MapMode){MapMode[MapMode["Simple"]=0]="Simple";MapMode[MapMode["TrackDel"]=1]="TrackDel";MapMode[MapMode["TrackBefore"]=2]="TrackBefore";MapMode[MapMode["TrackAfter"]=3]="TrackAfter";return MapMode}(MapMode||(MapMode={}));var ChangeDesc=function(){function ChangeDesc(sections){_classCallCheck2(this,ChangeDesc);this.sections=sections}_createClass2(ChangeDesc,[{key:"length",get:function get(){var result=0;for(var _i103=0;_i103<this.sections.length;_i103+=2)result+=this.sections[_i103];return result}},{key:"newLength",get:function get(){var result=0;for(var _i104=0;_i104<this.sections.length;_i104+=2){var ins=this.sections[_i104+1];result+=ins<0?this.sections[_i104]:ins}return result}},{key:"empty",get:function get(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}},{key:"iterGaps",value:function iterGaps(f){for(var _i105=0,posA=0,posB=0;_i105<this.sections.length;){var len=this.sections[_i105++],ins=this.sections[_i105++];if(ins<0){f(posA,posB,len);posB+=len}else{posB+=ins}posA+=len}}},{key:"iterChangedRanges",value:function iterChangedRanges(f){var individual=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_iterChanges(this,f,individual)}},{key:"invertedDesc",get:function get(){var sections=[];for(var _i106=0;_i106<this.sections.length;){var len=this.sections[_i106++],ins=this.sections[_i106++];if(ins<0)sections.push(len,ins);else sections.push(ins,len)}return new ChangeDesc(sections)}},{key:"composeDesc",value:function composeDesc(other){return this.empty?other:other.empty?this:composeSets(this,other)}},{key:"mapDesc",value:function mapDesc(other){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return other.empty?this:mapSet(this,other,before)}},{key:"mapPos",value:function mapPos(pos){var assoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var mode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:MapMode.Simple;var posA=0,posB=0;for(var _i107=0;_i107<this.sections.length;){var len=this.sections[_i107++],ins=this.sections[_i107++],endA=posA+len;if(ins<0){if(endA>pos)return posB+(pos-posA);posB+=len}else{if(mode!=MapMode.Simple&&endA>=pos&&(mode==MapMode.TrackDel&&posA<pos&&endA>pos||mode==MapMode.TrackBefore&&posA<pos||mode==MapMode.TrackAfter&&endA>pos))return null;if(endA>pos||endA==pos&&assoc<0&&!len)return pos==posA||assoc<0?posB:posB+ins;posB+=ins}posA=endA}if(pos>posA)throw new RangeError("Position ".concat(pos," is out of range for changeset of length ").concat(posA));return posB}},{key:"touchesRange",value:function touchesRange(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;for(var _i108=0,pos=0;_i108<this.sections.length&&pos<=to;){var len=this.sections[_i108++],ins=this.sections[_i108++],_end13=pos+len;if(ins>=0&&pos<=to&&_end13>=from)return pos<from&&_end13>to?"cover":true;pos=_end13}return false}},{key:"toString",value:function toString(){var result="";for(var _i109=0;_i109<this.sections.length;){var len=this.sections[_i109++],ins=this.sections[_i109++];result+=(result?" ":"")+len+(ins>=0?":"+ins:"")}return result}},{key:"toJSON",value:function toJSON(){return this.sections}}],[{key:"fromJSON",value:function fromJSON(json){if(!Array.isArray(json)||json.length%2||json.some(function(a){return typeof a!="number"}))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(json)}},{key:"create",value:function create(sections){return new ChangeDesc(sections)}}]);return ChangeDesc}();var ChangeSet=function(_ChangeDesc){_inherits2(ChangeSet,_ChangeDesc);var _super71=_createSuper(ChangeSet);function ChangeSet(sections,inserted){var _this174;_classCallCheck2(this,ChangeSet);_this174=_super71.call(this,sections);_this174.inserted=inserted;return _this174}_createClass2(ChangeSet,[{key:"apply",value:function apply(doc){if(this.length!=doc.length)throw new RangeError("Applying change set to a document with the wrong length");_iterChanges(this,function(fromA,toA,fromB,_toB,text){return doc=doc.replace(fromB,fromB+(toA-fromA),text)},false);return doc}},{key:"mapDesc",value:function mapDesc(other){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return mapSet(this,other,before,true)}},{key:"invert",value:function invert(doc){var sections=this.sections.slice(),inserted=[];for(var _i110=0,pos=0;_i110<sections.length;_i110+=2){var len=sections[_i110],ins=sections[_i110+1];if(ins>=0){sections[_i110]=ins;sections[_i110+1]=len;var index=_i110>>1;while(inserted.length<index)inserted.push(Text.empty);inserted.push(len?doc.slice(pos,pos+len):Text.empty)}pos+=len}return new ChangeSet(sections,inserted)}},{key:"compose",value:function compose(other){return this.empty?other:other.empty?this:composeSets(this,other,true)}},{key:"map",value:function map(other){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return other.empty?this:mapSet(this,other,before,true)}},{key:"iterChanges",value:function iterChanges(f){var individual=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_iterChanges(this,f,individual)}},{key:"desc",get:function get(){return ChangeDesc.create(this.sections)}},{key:"filter",value:function filter(ranges){var resultSections=[],resultInserted=[],filteredSections=[];var iter=new SectionIter(this);done:for(var _i111=0,pos=0;;){var next=_i111==ranges.length?1e9:ranges[_i111++];while(pos<next||pos==next&&iter.len==0){if(iter.done)break done;var len=Math.min(iter.len,next-pos);addSection(filteredSections,len,-1);var ins=iter.ins==-1?-1:iter.off==0?iter.ins:0;addSection(resultSections,len,ins);if(ins>0)addInsert(resultInserted,resultSections,iter.text);iter.forward(len);pos+=len}var _end14=ranges[_i111++];while(pos<_end14){if(iter.done)break done;var _len10=Math.min(iter.len,_end14-pos);addSection(resultSections,_len10,-1);addSection(filteredSections,_len10,iter.ins==-1?-1:iter.off==0?iter.ins:0);iter.forward(_len10);pos+=_len10}}return{changes:new ChangeSet(resultSections,resultInserted),filtered:ChangeDesc.create(filteredSections)}}},{key:"toJSON",value:function toJSON(){var parts=[];for(var _i112=0;_i112<this.sections.length;_i112+=2){var len=this.sections[_i112],ins=this.sections[_i112+1];if(ins<0)parts.push(len);else if(ins==0)parts.push([len]);else parts.push([len].concat(this.inserted[_i112>>1].toJSON()))}return parts}}],[{key:"of",value:function of(changes,length,lineSep){var sections=[],inserted=[],pos=0;var total=null;function flush(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!force&&!sections.length)return;if(pos<length)addSection(sections,length-pos,-1);var set=new ChangeSet(sections,inserted);total=total?total.compose(set.map(total)):set;sections=[];inserted=[];pos=0}function process(spec){if(Array.isArray(spec)){var _iterator199=_createForOfIteratorHelper(spec),_step199;try{for(_iterator199.s();!(_step199=_iterator199.n()).done;){var sub=_step199.value;process(sub)}}catch(err){_iterator199.e(err)}finally{_iterator199.f()}}else if(spec instanceof ChangeSet){if(spec.length!=length)throw new RangeError("Mismatched change set length (got ".concat(spec.length,", expected ").concat(length,")"));flush();total=total?total.compose(spec.map(total)):spec}else{var from=spec.from,_spec$to=spec.to,to=_spec$to===void 0?from:_spec$to,_insert=spec.insert;if(from>to||from<0||to>length)throw new RangeError("Invalid change range ".concat(from," to ").concat(to," (in doc of length ").concat(length,")"));var insText=!_insert?Text.empty:typeof _insert=="string"?Text.of(_insert.split(lineSep||DefaultSplit)):_insert;var insLen=insText.length;if(from==to&&insLen==0)return;if(from<pos)flush();if(from>pos)addSection(sections,from-pos,-1);addSection(sections,to-from,insLen);addInsert(inserted,sections,insText);pos=to}}process(changes);flush(!total);return total}},{key:"empty",value:function empty(length){return new ChangeSet(length?[length,-1]:[],[])}},{key:"fromJSON",value:function fromJSON(json){if(!Array.isArray(json))throw new RangeError("Invalid JSON representation of ChangeSet");var sections=[],inserted=[];for(var _i113=0;_i113<json.length;_i113++){var part=json[_i113];if(typeof part=="number"){sections.push(part,-1)}else if(!Array.isArray(part)||typeof part[0]!="number"||part.some(function(e,i){return i&&typeof e!="string"})){throw new RangeError("Invalid JSON representation of ChangeSet")}else if(part.length==1){sections.push(part[0],0)}else{while(inserted.length<_i113)inserted.push(Text.empty);inserted[_i113]=Text.of(part.slice(1));sections.push(part[0],inserted[_i113].length)}}return new ChangeSet(sections,inserted)}},{key:"createSet",value:function createSet(sections,inserted){return new ChangeSet(sections,inserted)}}]);return ChangeSet}(ChangeDesc);function addSection(sections,len,ins){var forceJoin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(len==0&&ins<=0)return;var last=sections.length-2;if(last>=0&&ins<=0&&ins==sections[last+1])sections[last]+=len;else if(len==0&&sections[last]==0)sections[last+1]+=ins;else if(forceJoin){sections[last]+=len;sections[last+1]+=ins}else sections.push(len,ins)}function addInsert(values,sections,value){if(value.length==0)return;var index=sections.length-2>>1;if(index<values.length){values[values.length-1]=values[values.length-1].append(value)}else{while(values.length<index)values.push(Text.empty);values.push(value)}}function _iterChanges(desc,f,individual){var inserted=desc.inserted;for(var posA=0,posB=0,_i114=0;_i114<desc.sections.length;){var len=desc.sections[_i114++],ins=desc.sections[_i114++];if(ins<0){posA+=len;posB+=len}else{var endA=posA,endB=posB,_text=Text.empty;for(;;){endA+=len;endB+=ins;if(ins&&inserted)_text=_text.append(inserted[_i114-2>>1]);if(individual||_i114==desc.sections.length||desc.sections[_i114+1]<0)break;len=desc.sections[_i114++];ins=desc.sections[_i114++]}f(posA,endA,posB,endB,_text);posA=endA;posB=endB}}}function mapSet(setA,setB,before){var mkSet=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var sections=[],insert=mkSet?[]:null;var a=new SectionIter(setA),b=new SectionIter(setB);for(var inserted=-1;;){if(a.ins==-1&&b.ins==-1){var len=Math.min(a.len,b.len);addSection(sections,len,-1);a.forward(len);b.forward(len)}else if(b.ins>=0&&(a.ins<0||inserted==a.i||a.off==0&&(b.len<a.len||b.len==a.len&&!before))){var _len11=b.len;addSection(sections,b.ins,-1);while(_len11){var piece=Math.min(a.len,_len11);if(a.ins>=0&&inserted<a.i&&a.len<=piece){addSection(sections,0,a.ins);if(insert)addInsert(insert,sections,a.text);inserted=a.i}a.forward(piece);_len11-=piece}b.next()}else if(a.ins>=0){var _len12=0,_left2=a.len;while(_left2){if(b.ins==-1){var _piece=Math.min(_left2,b.len);_len12+=_piece;_left2-=_piece;b.forward(_piece)}else if(b.ins==0&&b.len<_left2){_left2-=b.len;b.next()}else{break}}addSection(sections,_len12,inserted<a.i?a.ins:0);if(insert&&inserted<a.i)addInsert(insert,sections,a.text);inserted=a.i;a.forward(a.len-_left2)}else if(a.done&&b.done){return insert?ChangeSet.createSet(sections,insert):ChangeDesc.create(sections)}else{throw new Error("Mismatched change set lengths")}}}function composeSets(setA,setB){var mkSet=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var sections=[];var insert=mkSet?[]:null;var a=new SectionIter(setA),b=new SectionIter(setB);for(var open=false;;){if(a.done&&b.done){return insert?ChangeSet.createSet(sections,insert):ChangeDesc.create(sections)}else if(a.ins==0){addSection(sections,a.len,0,open);a.next()}else if(b.len==0&&!b.done){addSection(sections,0,b.ins,open);if(insert)addInsert(insert,sections,b.text);b.next()}else if(a.done||b.done){throw new Error("Mismatched change set lengths")}else{var len=Math.min(a.len2,b.len),sectionLen=sections.length;if(a.ins==-1){var insB=b.ins==-1?-1:b.off?0:b.ins;addSection(sections,len,insB,open);if(insert&&insB)addInsert(insert,sections,b.text)}else if(b.ins==-1){addSection(sections,a.off?0:a.len,len,open);if(insert)addInsert(insert,sections,a.textBit(len))}else{addSection(sections,a.off?0:a.len,b.off?0:b.ins,open);if(insert&&!b.off)addInsert(insert,sections,b.text)}open=(a.ins>len||b.ins>=0&&b.len>len)&&(open||sections.length>sectionLen);a.forward2(len);b.forward(len)}}}var SectionIter=function(){function SectionIter(set){_classCallCheck2(this,SectionIter);this.set=set;this.i=0;this.next()}_createClass2(SectionIter,[{key:"next",value:function next(){var sections=this.set.sections;if(this.i<sections.length){this.len=sections[this.i++];this.ins=sections[this.i++]}else{this.len=0;this.ins=-2}this.off=0}},{key:"done",get:function get(){return this.ins==-2}},{key:"len2",get:function get(){return this.ins<0?this.len:this.ins}},{key:"text",get:function get(){var inserted=this.set.inserted,index=this.i-2>>1;return index>=inserted.length?Text.empty:inserted[index]}},{key:"textBit",value:function textBit(len){var inserted=this.set.inserted,index=this.i-2>>1;return index>=inserted.length&&!len?Text.empty:inserted[index].slice(this.off,len==null?undefined:this.off+len)}},{key:"forward",value:function forward(len){if(len==this.len)this.next();else{this.len-=len;this.off+=len}}},{key:"forward2",value:function forward2(len){if(this.ins==-1)this.forward(len);else if(len==this.ins)this.next();else{this.ins-=len;this.off+=len}}}]);return SectionIter}();var SelectionRange=function(){function SelectionRange(from,to,flags){_classCallCheck2(this,SelectionRange);this.from=from;this.to=to;this.flags=flags}_createClass2(SelectionRange,[{key:"anchor",get:function get(){return this.flags&32?this.to:this.from}},{key:"head",get:function get(){return this.flags&32?this.from:this.to}},{key:"empty",get:function get(){return this.from==this.to}},{key:"assoc",get:function get(){return this.flags&8?-1:this.flags&16?1:0}},{key:"bidiLevel",get:function get(){var level=this.flags&7;return level==7?null:level}},{key:"goalColumn",get:function get(){var value=this.flags>>6;return value==16777215?undefined:value}},{key:"map",value:function map(change){var assoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var from,to;if(this.empty){from=to=change.mapPos(this.from,assoc)}else{from=change.mapPos(this.from,1);to=change.mapPos(this.to,-1)}return from==this.from&&to==this.to?this:new SelectionRange(from,to,this.flags)}},{key:"extend",value:function extend(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(from<=this.anchor&&to>=this.anchor)return EditorSelection.range(from,to);var head=Math.abs(from-this.anchor)>Math.abs(to-this.anchor)?from:to;return EditorSelection.range(this.anchor,head)}},{key:"eq",value:function eq(other){var includeAssoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return this.anchor==other.anchor&&this.head==other.head&&(!includeAssoc||!this.empty||this.assoc==other.assoc)}},{key:"toJSON",value:function toJSON(){return{anchor:this.anchor,head:this.head}}}],[{key:"fromJSON",value:function fromJSON(json){if(!json||typeof json.anchor!="number"||typeof json.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(json.anchor,json.head)}},{key:"create",value:function create(from,to,flags){return new SelectionRange(from,to,flags)}}]);return SelectionRange}();var EditorSelection=function(){function EditorSelection(ranges,mainIndex){_classCallCheck2(this,EditorSelection);this.ranges=ranges;this.mainIndex=mainIndex}_createClass2(EditorSelection,[{key:"map",value:function map(change){var assoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;if(change.empty)return this;return EditorSelection.create(this.ranges.map(function(r){return r.map(change,assoc)}),this.mainIndex)}},{key:"eq",value:function eq(other){var includeAssoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.ranges.length!=other.ranges.length||this.mainIndex!=other.mainIndex)return false;for(var _i115=0;_i115<this.ranges.length;_i115++)if(!this.ranges[_i115].eq(other.ranges[_i115],includeAssoc))return false;return true}},{key:"main",get:function get(){return this.ranges[this.mainIndex]}},{key:"asSingle",value:function asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main],0)}},{key:"addRange",value:function addRange(range){var main=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return EditorSelection.create([range].concat(this.ranges),main?0:this.mainIndex+1)}},{key:"replaceRange",value:function replaceRange(range){var which=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.mainIndex;var ranges=this.ranges.slice();ranges[which]=range;return EditorSelection.create(ranges,this.mainIndex)}},{key:"toJSON",value:function toJSON(){return{ranges:this.ranges.map(function(r){return r.toJSON()}),main:this.mainIndex}}}],[{key:"fromJSON",value:function fromJSON(json){if(!json||!Array.isArray(json.ranges)||typeof json.main!="number"||json.main>=json.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(json.ranges.map(function(r){return SelectionRange.fromJSON(r)}),json.main)}},{key:"single",value:function single(anchor){var head=arguments.length>1&&arguments[1]!==undefined?arguments[1]:anchor;return new EditorSelection([EditorSelection.range(anchor,head)],0)}},{key:"create",value:function create(ranges){var mainIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(ranges.length==0)throw new RangeError("A selection needs at least one range");for(var pos=0,_i116=0;_i116<ranges.length;_i116++){var range=ranges[_i116];if(range.empty?range.from<=pos:range.from<pos)return EditorSelection.normalized(ranges.slice(),mainIndex);pos=range.to}return new EditorSelection(ranges,mainIndex)}},{key:"cursor",value:function cursor(pos){var assoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var bidiLevel=arguments.length>2?arguments[2]:undefined;var goalColumn=arguments.length>3?arguments[3]:undefined;return SelectionRange.create(pos,pos,(assoc==0?0:assoc<0?8:16)|(bidiLevel==null?7:Math.min(6,bidiLevel))|(goalColumn!==null&&goalColumn!==void 0?goalColumn:16777215)<<6)}},{key:"range",value:function range(anchor,head,goalColumn,bidiLevel){var flags=(goalColumn!==null&&goalColumn!==void 0?goalColumn:16777215)<<6|(bidiLevel==null?7:Math.min(6,bidiLevel));return head<anchor?SelectionRange.create(head,anchor,32|16|flags):SelectionRange.create(anchor,head,(head>anchor?8:0)|flags)}},{key:"normalized",value:function normalized(ranges){var mainIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var main=ranges[mainIndex];ranges.sort(function(a,b){return a.from-b.from});mainIndex=ranges.indexOf(main);for(var _i117=1;_i117<ranges.length;_i117++){var range=ranges[_i117],prev=ranges[_i117-1];if(range.empty?range.from<=prev.to:range.from<prev.to){var from=prev.from,to=Math.max(range.to,prev.to);if(_i117<=mainIndex)mainIndex--;ranges.splice(--_i117,2,range.anchor>range.head?EditorSelection.range(to,from):EditorSelection.range(from,to))}}return new EditorSelection(ranges,mainIndex)}}]);return EditorSelection}();function checkSelection(selection,docLength){var _iterator200=_createForOfIteratorHelper(selection.ranges),_step200;try{for(_iterator200.s();!(_step200=_iterator200.n()).done;){var range=_step200.value;if(range.to>docLength)throw new RangeError("Selection points outside of document")}}catch(err){_iterator200.e(err)}finally{_iterator200.f()}}var nextID=0;var Facet=function(){function Facet(combine,compareInput,compare,isStatic,enables){_classCallCheck2(this,Facet);this.combine=combine;this.compareInput=compareInput;this.compare=compare;this.isStatic=isStatic;this.id=nextID++;this["default"]=combine([]);this.extensions=typeof enables=="function"?enables(this):enables}_createClass2(Facet,[{key:"reader",get:function get(){return this}},{key:"of",value:function of(value){return new FacetProvider([],this,0,value)}},{key:"compute",value:function compute(deps,get){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(deps,this,1,get)}},{key:"computeN",value:function computeN(deps,get){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(deps,this,2,get)}},{key:"from",value:function from(field,get){if(!get)get=function get(x){return x};return this.compute([field],function(state){return get(state.field(field))})}}],[{key:"define",value:function define(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new Facet(config.combine||function(a){return a},config.compareInput||function(a,b){return a===b},config.compare||(!config.combine?sameArray$1:function(a,b){return a===b}),!!config["static"],config.enables)}}]);return Facet}();function sameArray$1(a,b){return a==b||a.length==b.length&&a.every(function(e,i){return e===b[i]})}var FacetProvider=function(){function FacetProvider(dependencies,facet,type,value){_classCallCheck2(this,FacetProvider);this.dependencies=dependencies;this.facet=facet;this.type=type;this.value=value;this.id=nextID++}_createClass2(FacetProvider,[{key:"dynamicSlot",value:function dynamicSlot(addresses){var _this175=this;var _a;var getter=this.value;var compare=this.facet.compareInput;var id=this.id,idx=addresses[id]>>1,multi=this.type==2;var depDoc=false,depSel=false,depAddrs=[];var _iterator201=_createForOfIteratorHelper(this.dependencies),_step201;try{for(_iterator201.s();!(_step201=_iterator201.n()).done;){var dep=_step201.value;if(dep=="doc")depDoc=true;else if(dep=="selection")depSel=true;else if((((_a=addresses[dep.id])!==null&&_a!==void 0?_a:1)&1)==0)depAddrs.push(addresses[dep.id])}}catch(err){_iterator201.e(err)}finally{_iterator201.f()}return{create:function create(state){state.values[idx]=getter(state);return 1},update:function update(state,tr){if(depDoc&&tr.docChanged||depSel&&(tr.docChanged||tr.selection)||ensureAll(state,depAddrs)){var newVal=getter(state);if(multi?!compareArray(newVal,state.values[idx],compare):!compare(newVal,state.values[idx])){state.values[idx]=newVal;return 1}}return 0},reconfigure:function reconfigure(state,oldState){var newVal,oldAddr=oldState.config.address[id];if(oldAddr!=null){var oldVal=getAddr(oldState,oldAddr);if(_this175.dependencies.every(function(dep){return dep instanceof Facet?oldState.facet(dep)===state.facet(dep):dep instanceof StateField?oldState.field(dep,false)==state.field(dep,false):true})||(multi?compareArray(newVal=getter(state),oldVal,compare):compare(newVal=getter(state),oldVal))){state.values[idx]=oldVal;return 0}}else{newVal=getter(state)}state.values[idx]=newVal;return 1}}}}]);return FacetProvider}();function compareArray(a,b,compare){if(a.length!=b.length)return false;for(var _i118=0;_i118<a.length;_i118++)if(!compare(a[_i118],b[_i118]))return false;return true}function ensureAll(state,addrs){var changed=false;var _iterator202=_createForOfIteratorHelper(addrs),_step202;try{for(_iterator202.s();!(_step202=_iterator202.n()).done;){var addr=_step202.value;if(ensureAddr(state,addr)&1)changed=true}}catch(err){_iterator202.e(err)}finally{_iterator202.f()}return changed}function dynamicFacetSlot(addresses,facet,providers){var providerAddrs=providers.map(function(p){return addresses[p.id]});var providerTypes=providers.map(function(p){return p.type});var dynamic=providerAddrs.filter(function(p){return!(p&1)});var idx=addresses[facet.id]>>1;function get(state){var values=[];for(var _i119=0;_i119<providerAddrs.length;_i119++){var value=getAddr(state,providerAddrs[_i119]);if(providerTypes[_i119]==2){var _iterator203=_createForOfIteratorHelper(value),_step203;try{for(_iterator203.s();!(_step203=_iterator203.n()).done;){var val=_step203.value;values.push(val)}}catch(err){_iterator203.e(err)}finally{_iterator203.f()}}else values.push(value)}return facet.combine(values)}return{create:function create(state){var _iterator204=_createForOfIteratorHelper(providerAddrs),_step204;try{for(_iterator204.s();!(_step204=_iterator204.n()).done;){var addr=_step204.value;ensureAddr(state,addr)}}catch(err){_iterator204.e(err)}finally{_iterator204.f()}state.values[idx]=get(state);return 1},update:function update(state,tr){if(!ensureAll(state,dynamic))return 0;var value=get(state);if(facet.compare(value,state.values[idx]))return 0;state.values[idx]=value;return 1},reconfigure:function reconfigure(state,oldState){var depChanged=ensureAll(state,providerAddrs);var oldProviders=oldState.config.facets[facet.id],oldValue=oldState.facet(facet);if(oldProviders&&!depChanged&&sameArray$1(providers,oldProviders)){state.values[idx]=oldValue;return 0}var value=get(state);if(facet.compare(value,oldValue)){state.values[idx]=oldValue;return 0}state.values[idx]=value;return 1}}}var initField=Facet.define({"static":true});var StateField=function(){function StateField(id,createF,updateF,compareF,spec){_classCallCheck2(this,StateField);this.id=id;this.createF=createF;this.updateF=updateF;this.compareF=compareF;this.spec=spec;this.provides=undefined}_createClass2(StateField,[{key:"create",value:function create(state){var _this176=this;var init=state.facet(initField).find(function(i){return i.field==_this176});return((init===null||init===void 0?void 0:init.create)||this.createF)(state)}},{key:"slot",value:function slot(addresses){var _this177=this;var idx=addresses[this.id]>>1;return{create:function create(state){state.values[idx]=_this177.create(state);return 1},update:function update(state,tr){var oldVal=state.values[idx];var value=_this177.updateF(oldVal,tr);if(_this177.compareF(oldVal,value))return 0;state.values[idx]=value;return 1},reconfigure:function reconfigure(state,oldState){if(oldState.config.address[_this177.id]!=null){state.values[idx]=oldState.field(_this177);return 0}state.values[idx]=_this177.create(state);return 1}}}},{key:"init",value:function init(create){return[this,initField.of({field:this,create:create})]}},{key:"extension",get:function get(){return this}}],[{key:"define",value:function define(config){var field=new StateField(nextID++,config.create,config.update,config.compare||function(a,b){return a===b},config);if(config.provide)field.provides=config.provide(field);return field}}]);return StateField}();var Prec_={lowest:4,low:3,"default":2,high:1,highest:0};function prec(value){return function(ext){return new PrecExtension(ext,value)}}var Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),"default":prec(Prec_["default"]),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};var PrecExtension=_createClass2(function PrecExtension(inner,prec){_classCallCheck2(this,PrecExtension);this.inner=inner;this.prec=prec});var Compartment=function(){function Compartment(){_classCallCheck2(this,Compartment)}_createClass2(Compartment,[{key:"of",value:function of(ext){return new CompartmentInstance(this,ext)}},{key:"reconfigure",value:function reconfigure(content){return Compartment.reconfigure.of({compartment:this,extension:content})}},{key:"get",value:function get(state){return state.config.compartments.get(this)}}]);return Compartment}();var CompartmentInstance=_createClass2(function CompartmentInstance(compartment,inner){_classCallCheck2(this,CompartmentInstance);this.compartment=compartment;this.inner=inner});var Configuration=function(){function Configuration(base,compartments,dynamicSlots,address,staticValues,facets){_classCallCheck2(this,Configuration);this.base=base;this.compartments=compartments;this.dynamicSlots=dynamicSlots;this.address=address;this.staticValues=staticValues;this.facets=facets;this.statusTemplate=[];while(this.statusTemplate.length<dynamicSlots.length)this.statusTemplate.push(0)}_createClass2(Configuration,[{key:"staticFacet",value:function staticFacet(facet){var addr=this.address[facet.id];return addr==null?facet["default"]:this.staticValues[addr>>1]}}],[{key:"resolve",value:function resolve(base,compartments,oldState){var fields=[];var facets=Object.create(null);var newCompartments=new Map;var _iterator205=_createForOfIteratorHelper(flatten$1(base,compartments,newCompartments)),_step205;try{for(_iterator205.s();!(_step205=_iterator205.n()).done;){var ext=_step205.value;if(ext instanceof StateField)fields.push(ext);else(facets[ext.facet.id]||(facets[ext.facet.id]=[])).push(ext)}}catch(err){_iterator205.e(err)}finally{_iterator205.f()}var address=Object.create(null);var staticValues=[];var dynamicSlots=[];var _loop9=function _loop9(){var field=_fields3[_i120];address[field.id]=dynamicSlots.length<<1;dynamicSlots.push(function(a){return field.slot(a)})};for(var _i120=0,_fields3=fields;_i120<_fields3.length;_i120++){_loop9()}var oldFacets=oldState===null||oldState===void 0?void 0:oldState.config.facets;var _loop10=function _loop10(){var providers=facets[_id21],facet=providers[0].facet;var oldProviders=oldFacets&&oldFacets[_id21]||[];if(providers.every(function(p){return p.type==0})){address[facet.id]=staticValues.length<<1|1;if(sameArray$1(oldProviders,providers)){staticValues.push(oldState.facet(facet))}else{var value=facet.combine(providers.map(function(p){return p.value}));staticValues.push(oldState&&facet.compare(value,oldState.facet(facet))?oldState.facet(facet):value)}}else{var _iterator206=_createForOfIteratorHelper(providers),_step206;try{var _loop11=function _loop11(){var p=_step206.value;if(p.type==0){address[p.id]=staticValues.length<<1|1;staticValues.push(p.value)}else{address[p.id]=dynamicSlots.length<<1;dynamicSlots.push(function(a){return p.dynamicSlot(a)})}};for(_iterator206.s();!(_step206=_iterator206.n()).done;){_loop11()}}catch(err){_iterator206.e(err)}finally{_iterator206.f()}address[facet.id]=dynamicSlots.length<<1;dynamicSlots.push(function(a){return dynamicFacetSlot(a,facet,providers)})}};for(var _id21 in facets){_loop10()}var dynamic=dynamicSlots.map(function(f){return f(address)});return new Configuration(base,newCompartments,dynamic,address,staticValues,facets)}}]);return Configuration}();function flatten$1(extension,compartments,newCompartments){var result=[[],[],[],[],[]];var seen=new Map;function inner(ext,prec){var known=seen.get(ext);if(known!=null){if(known<=prec)return;var found=result[known].indexOf(ext);if(found>-1)result[known].splice(found,1);if(ext instanceof CompartmentInstance)newCompartments["delete"](ext.compartment)}seen.set(ext,prec);if(Array.isArray(ext)){var _iterator207=_createForOfIteratorHelper(ext),_step207;try{for(_iterator207.s();!(_step207=_iterator207.n()).done;){var e=_step207.value;inner(e,prec)}}catch(err){_iterator207.e(err)}finally{_iterator207.f()}}else if(ext instanceof CompartmentInstance){if(newCompartments.has(ext.compartment))throw new RangeError("Duplicate use of compartment in extensions");var _content4=compartments.get(ext.compartment)||ext.inner;newCompartments.set(ext.compartment,_content4);inner(_content4,prec)}else if(ext instanceof PrecExtension){inner(ext.inner,ext.prec)}else if(ext instanceof StateField){result[prec].push(ext);if(ext.provides)inner(ext.provides,prec)}else if(ext instanceof FacetProvider){result[prec].push(ext);if(ext.facet.extensions)inner(ext.facet.extensions,Prec_["default"])}else{var _content5=ext.extension;if(!_content5)throw new Error("Unrecognized extension value in extension set (".concat(ext,"). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks."));inner(_content5,prec)}}inner(extension,Prec_["default"]);return result.reduce(function(a,b){return a.concat(b)})}function ensureAddr(state,addr){if(addr&1)return 2;var idx=addr>>1;var status=state.status[idx];if(status==4)throw new Error("Cyclic dependency between fields and/or facets");if(status&2)return status;state.status[idx]=4;var changed=state.computeSlot(state,state.config.dynamicSlots[idx]);return state.status[idx]=2|changed}function getAddr(state,addr){return addr&1?state.config.staticValues[addr>>1]:state.values[addr>>1]}var languageData=Facet.define();var allowMultipleSelections=Facet.define({combine:function combine(values){return values.some(function(v){return v})},"static":true});var lineSeparator=Facet.define({combine:function combine(values){return values.length?values[0]:undefined},"static":true});var changeFilter=Facet.define();var transactionFilter=Facet.define();var transactionExtender=Facet.define();var readOnly=Facet.define({combine:function combine(values){return values.length?values[0]:false}});var Annotation=function(){function Annotation(type,value){_classCallCheck2(this,Annotation);this.type=type;this.value=value}_createClass2(Annotation,null,[{key:"define",value:function define(){return new AnnotationType}}]);return Annotation}();var AnnotationType=function(){function AnnotationType(){_classCallCheck2(this,AnnotationType)}_createClass2(AnnotationType,[{key:"of",value:function of(value){return new Annotation(this,value)}}]);return AnnotationType}();var StateEffectType=function(){function StateEffectType(map){_classCallCheck2(this,StateEffectType);this.map=map}_createClass2(StateEffectType,[{key:"of",value:function of(value){return new StateEffect(this,value)}}]);return StateEffectType}();var StateEffect=function(){function StateEffect(type,value){_classCallCheck2(this,StateEffect);this.type=type;this.value=value}_createClass2(StateEffect,[{key:"map",value:function map(mapping){var mapped=this.type.map(this.value,mapping);return mapped===undefined?undefined:mapped==this.value?this:new StateEffect(this.type,mapped)}},{key:"is",value:function is(type){return this.type==type}}],[{key:"define",value:function define(){var spec=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new StateEffectType(spec.map||function(v){return v})}},{key:"mapEffects",value:function mapEffects(effects,mapping){if(!effects.length)return effects;var result=[];var _iterator208=_createForOfIteratorHelper(effects),_step208;try{for(_iterator208.s();!(_step208=_iterator208.n()).done;){var _effect=_step208.value;var mapped=_effect.map(mapping);if(mapped)result.push(mapped)}}catch(err){_iterator208.e(err)}finally{_iterator208.f()}return result}}]);return StateEffect}();StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();var Transaction=function(){function Transaction(startState,changes,selection,effects,annotations,scrollIntoView){_classCallCheck2(this,Transaction);this.startState=startState;this.changes=changes;this.selection=selection;this.effects=effects;this.annotations=annotations;this.scrollIntoView=scrollIntoView;this._doc=null;this._state=null;if(selection)checkSelection(selection,changes.newLength);if(!annotations.some(function(a){return a.type==Transaction.time}))this.annotations=annotations.concat(Transaction.time.of(Date.now()))}_createClass2(Transaction,[{key:"newDoc",get:function get(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}},{key:"newSelection",get:function get(){return this.selection||this.startState.selection.map(this.changes)}},{key:"state",get:function get(){if(!this._state)this.startState.applyTransaction(this);return this._state}},{key:"annotation",value:function annotation(type){var _iterator209=_createForOfIteratorHelper(this.annotations),_step209;try{for(_iterator209.s();!(_step209=_iterator209.n()).done;){var ann=_step209.value;if(ann.type==type)return ann.value}}catch(err){_iterator209.e(err)}finally{_iterator209.f()}return undefined}},{key:"docChanged",get:function get(){return!this.changes.empty}},{key:"reconfigured",get:function get(){return this.startState.config!=this.state.config}},{key:"isUserEvent",value:function isUserEvent(event){var e=this.annotation(Transaction.userEvent);return!!(e&&(e==event||e.length>event.length&&e.slice(0,event.length)==event&&e[event.length]=="."))}}],[{key:"create",value:function create(startState,changes,selection,effects,annotations,scrollIntoView){return new Transaction(startState,changes,selection,effects,annotations,scrollIntoView)}}]);return Transaction}();Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(a,b){var result=[];for(var iA=0,iB=0;;){var from=void 0,to=void 0;if(iA<a.length&&(iB==b.length||b[iB]>=a[iA])){from=a[iA++];to=a[iA++]}else if(iB<b.length){from=b[iB++];to=b[iB++]}else return result;if(!result.length||result[result.length-1]<from)result.push(from,to);else if(result[result.length-1]<to)result[result.length-1]=to}}function mergeTransaction(a,b,sequential){var _a;var mapForA,mapForB,changes;if(sequential){mapForA=b.changes;mapForB=ChangeSet.empty(b.changes.length);changes=a.changes.compose(b.changes)}else{mapForA=b.changes.map(a.changes);mapForB=a.changes.mapDesc(b.changes,true);changes=a.changes.compose(mapForA)}return{changes:changes,selection:b.selection?b.selection.map(mapForB):(_a=a.selection)===null||_a===void 0?void 0:_a.map(mapForA),effects:StateEffect.mapEffects(a.effects,mapForA).concat(StateEffect.mapEffects(b.effects,mapForB)),annotations:a.annotations.length?a.annotations.concat(b.annotations):b.annotations,scrollIntoView:a.scrollIntoView||b.scrollIntoView}}function resolveTransactionInner(state,spec,docSize){var sel=spec.selection,annotations=asArray$1(spec.annotations);if(spec.userEvent)annotations=annotations.concat(Transaction.userEvent.of(spec.userEvent));return{changes:spec.changes instanceof ChangeSet?spec.changes:ChangeSet.of(spec.changes||[],docSize,state.facet(lineSeparator)),selection:sel&&(sel instanceof EditorSelection?sel:EditorSelection.single(sel.anchor,sel.head)),effects:asArray$1(spec.effects),annotations:annotations,scrollIntoView:!!spec.scrollIntoView}}function resolveTransaction(state,specs,filter){var s=resolveTransactionInner(state,specs.length?specs[0]:{},state.doc.length);if(specs.length&&specs[0].filter===false)filter=false;for(var _i121=1;_i121<specs.length;_i121++){if(specs[_i121].filter===false)filter=false;var seq=!!specs[_i121].sequential;s=mergeTransaction(s,resolveTransactionInner(state,specs[_i121],seq?s.changes.newLength:state.doc.length),seq)}var tr=Transaction.create(state,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return extendTransaction(filter?filterTransaction(tr):tr)}function filterTransaction(tr){var state=tr.startState;var result=true;var _iterator210=_createForOfIteratorHelper(state.facet(changeFilter)),_step210;try{for(_iterator210.s();!(_step210=_iterator210.n()).done;){var filter=_step210.value;var value=filter(tr);if(value===false){result=false;break}if(Array.isArray(value))result=result===true?value:joinRanges(result,value)}}catch(err){_iterator210.e(err)}finally{_iterator210.f()}if(result!==true){var changes,back;if(result===false){back=tr.changes.invertedDesc;changes=ChangeSet.empty(state.doc.length)}else{var filtered=tr.changes.filter(result);changes=filtered.changes;back=filtered.filtered.mapDesc(filtered.changes).invertedDesc}tr=Transaction.create(state,changes,tr.selection&&tr.selection.map(back),StateEffect.mapEffects(tr.effects,back),tr.annotations,tr.scrollIntoView)}var filters=state.facet(transactionFilter);for(var _i122=filters.length-1;_i122>=0;_i122--){var _filtered=filters[_i122](tr);if(_filtered instanceof Transaction)tr=_filtered;else if(Array.isArray(_filtered)&&_filtered.length==1&&_filtered[0]instanceof Transaction)tr=_filtered[0];else tr=resolveTransaction(state,asArray$1(_filtered),false)}return tr}function extendTransaction(tr){var state=tr.startState,extenders=state.facet(transactionExtender),spec=tr;for(var _i123=extenders.length-1;_i123>=0;_i123--){var extension=extenders[_i123](tr);if(extension&&Object.keys(extension).length)spec=mergeTransaction(spec,resolveTransactionInner(state,extension,tr.changes.newLength),true)}return spec==tr?tr:Transaction.create(state,tr.changes,tr.selection,spec.effects,spec.annotations,spec.scrollIntoView)}var none$3=[];function asArray$1(value){return value==null?none$3:Array.isArray(value)?value:[value]}var CharCategory=function(CharCategory){CharCategory[CharCategory["Word"]=0]="Word";CharCategory[CharCategory["Space"]=1]="Space";CharCategory[CharCategory["Other"]=2]="Other";return CharCategory}(CharCategory||(CharCategory={}));var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;var wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(_){}function hasWordChar(str){if(wordChar)return wordChar.test(str);for(var _i124=0;_i124<str.length;_i124++){var ch=str[_i124];if(/\w/.test(ch)||ch>"\x80"&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch)))return true}return false}function makeCategorizer(wordChars){return function(_char2){if(!/\S/.test(_char2))return CharCategory.Space;if(hasWordChar(_char2))return CharCategory.Word;for(var _i125=0;_i125<wordChars.length;_i125++)if(_char2.indexOf(wordChars[_i125])>-1)return CharCategory.Word;return CharCategory.Other}}var EditorState=function(){function EditorState(config,doc,selection,values,computeSlot,tr){_classCallCheck2(this,EditorState);this.config=config;this.doc=doc;this.selection=selection;this.values=values;this.status=config.statusTemplate.slice();this.computeSlot=computeSlot;if(tr)tr._state=this;for(var _i126=0;_i126<this.config.dynamicSlots.length;_i126++)ensureAddr(this,_i126<<1);this.computeSlot=null}_createClass2(EditorState,[{key:"field",value:function field(_field2){var require=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var addr=this.config.address[_field2.id];if(addr==null){if(require)throw new RangeError("Field is not present in this state");return undefined}ensureAddr(this,addr);return getAddr(this,addr)}},{key:"update",value:function update(){for(var _len13=arguments.length,specs=new Array(_len13),_key7=0;_key7<_len13;_key7++){specs[_key7]=arguments[_key7]}return resolveTransaction(this,specs,true)}},{key:"applyTransaction",value:function applyTransaction(tr){var _this178=this;var conf=this.config,_conf=conf,base=_conf.base,compartments=_conf.compartments;var _iterator211=_createForOfIteratorHelper(tr.effects),_step211;try{for(_iterator211.s();!(_step211=_iterator211.n()).done;){var _effect2=_step211.value;if(_effect2.is(Compartment.reconfigure)){if(conf){compartments=new Map;conf.compartments.forEach(function(val,key){return compartments.set(key,val)});conf=null}compartments.set(_effect2.value.compartment,_effect2.value.extension)}else if(_effect2.is(StateEffect.reconfigure)){conf=null;base=_effect2.value}else if(_effect2.is(StateEffect.appendConfig)){conf=null;base=asArray$1(base).concat(_effect2.value)}}}catch(err){_iterator211.e(err)}finally{_iterator211.f()}var startValues;if(!conf){conf=Configuration.resolve(base,compartments,this);var intermediateState=new EditorState(conf,this.doc,this.selection,conf.dynamicSlots.map(function(){return null}),function(state,slot){return slot.reconfigure(state,_this178)},null);startValues=intermediateState.values}else{startValues=tr.startState.values.slice()}var selection=tr.startState.facet(allowMultipleSelections)?tr.newSelection:tr.newSelection.asSingle();new EditorState(conf,tr.newDoc,selection,startValues,function(state,slot){return slot.update(state,tr)},tr)}},{key:"replaceSelection",value:function replaceSelection(text){if(typeof text=="string")text=this.toText(text);return this.changeByRange(function(range){return{changes:{from:range.from,to:range.to,insert:text},range:EditorSelection.cursor(range.from+text.length)}})}},{key:"changeByRange",value:function changeByRange(f){var sel=this.selection;var result1=f(sel.ranges[0]);var changes=this.changes(result1.changes),ranges=[result1.range];var effects=asArray$1(result1.effects);for(var _i127=1;_i127<sel.ranges.length;_i127++){var result=f(sel.ranges[_i127]);var newChanges=this.changes(result.changes),newMapped=newChanges.map(changes);for(var j=0;j<_i127;j++)ranges[j]=ranges[j].map(newMapped);var mapBy=changes.mapDesc(newChanges,true);ranges.push(result.range.map(mapBy));changes=changes.compose(newMapped);effects=StateEffect.mapEffects(effects,newMapped).concat(StateEffect.mapEffects(asArray$1(result.effects),mapBy))}return{changes:changes,selection:EditorSelection.create(ranges,sel.mainIndex),effects:effects}}},{key:"changes",value:function changes(){var spec=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(spec instanceof ChangeSet)return spec;return ChangeSet.of(spec,this.doc.length,this.facet(EditorState.lineSeparator))}},{key:"toText",value:function toText(string){return Text.of(string.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}},{key:"sliceDoc",value:function sliceDoc(){var from=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.doc.length;return this.doc.sliceString(from,to,this.lineBreak)}},{key:"facet",value:function facet(_facet){var addr=this.config.address[_facet.id];if(addr==null)return _facet["default"];ensureAddr(this,addr);return getAddr(this,addr)}},{key:"toJSON",value:function toJSON(fields){var result={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(fields)for(var prop in fields){var value=fields[prop];if(value instanceof StateField&&this.config.address[value.id]!=null)result[prop]=value.spec.toJSON(this.field(fields[prop]),this)}return result}},{key:"tabSize",get:function get(){return this.facet(EditorState.tabSize)}},{key:"lineBreak",get:function get(){return this.facet(EditorState.lineSeparator)||"\n"}},{key:"readOnly",get:function get(){return this.facet(readOnly)}},{key:"phrase",value:function phrase(_phrase2){for(var _len14=arguments.length,insert=new Array(_len14>1?_len14-1:0),_key8=1;_key8<_len14;_key8++){insert[_key8-1]=arguments[_key8]}var _iterator212=_createForOfIteratorHelper(this.facet(EditorState.phrases)),_step212;try{for(_iterator212.s();!(_step212=_iterator212.n()).done;){var map=_step212.value;if(Object.prototype.hasOwnProperty.call(map,_phrase2)){_phrase2=map[_phrase2];break}}}catch(err){_iterator212.e(err)}finally{_iterator212.f()}if(insert.length)_phrase2=_phrase2.replace(/\$(\$|\d*)/g,function(m,i){if(i=="$")return"$";var n=+(i||1);return!n||n>insert.length?m:insert[n-1]});return _phrase2}},{key:"languageDataAt",value:function languageDataAt(name,pos){var side=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;var values=[];var _iterator213=_createForOfIteratorHelper(this.facet(languageData)),_step213;try{for(_iterator213.s();!(_step213=_iterator213.n()).done;){var provider=_step213.value;var _iterator214=_createForOfIteratorHelper(provider(this,pos,side)),_step214;try{for(_iterator214.s();!(_step214=_iterator214.n()).done;){var result=_step214.value;if(Object.prototype.hasOwnProperty.call(result,name))values.push(result[name])}}catch(err){_iterator214.e(err)}finally{_iterator214.f()}}}catch(err){_iterator213.e(err)}finally{_iterator213.f()}return values}},{key:"charCategorizer",value:function charCategorizer(at){return makeCategorizer(this.languageDataAt("wordChars",at).join(""))}},{key:"wordAt",value:function wordAt(pos){var _this$doc$lineAt=this.doc.lineAt(pos),text=_this$doc$lineAt.text,from=_this$doc$lineAt.from,length=_this$doc$lineAt.length;var cat=this.charCategorizer(pos);var start=pos-from,end=pos-from;while(start>0){var prev=findClusterBreak(text,start,false);if(cat(text.slice(prev,start))!=CharCategory.Word)break;start=prev}while(end<length){var next=findClusterBreak(text,end);if(cat(text.slice(end,next))!=CharCategory.Word)break;end=next}return start==end?null:EditorSelection.range(start+from,end+from)}}],[{key:"fromJSON",value:function fromJSON(json){var config=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var fields=arguments.length>2?arguments[2]:undefined;if(!json||typeof json.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");var fieldInit=[];if(fields){var _loop12=function _loop12(){if(Object.prototype.hasOwnProperty.call(json,prop)){var field=fields[prop],value=json[prop];fieldInit.push(field.init(function(state){return field.spec.fromJSON(value,state)}))}};for(var prop in fields){_loop12()}}return EditorState.create({doc:json.doc,selection:EditorSelection.fromJSON(json.selection),extensions:config.extensions?fieldInit.concat([config.extensions]):fieldInit})}},{key:"create",value:function create(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var configuration=Configuration.resolve(config.extensions||[],new Map);var doc=config.doc instanceof Text?config.doc:Text.of((config.doc||"").split(configuration.staticFacet(EditorState.lineSeparator)||DefaultSplit));var selection=!config.selection?EditorSelection.single(0):config.selection instanceof EditorSelection?config.selection:EditorSelection.single(config.selection.anchor,config.selection.head);checkSelection(selection,doc.length);if(!configuration.staticFacet(allowMultipleSelections))selection=selection.asSingle();return new EditorState(configuration,doc,selection,configuration.dynamicSlots.map(function(){return null}),function(state,slot){return slot.create(state)},null)}}]);return EditorState}();EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:function combine(values){return values.length?values[0]:4}});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=Facet.define({compare:function compare(a,b){var kA=Object.keys(a),kB=Object.keys(b);return kA.length==kB.length&&kA.every(function(k){return a[k]==b[k]})}});EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(configs,defaults){var combine=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var result={};var _iterator215=_createForOfIteratorHelper(configs),_step215;try{for(_iterator215.s();!(_step215=_iterator215.n()).done;){var _config=_step215.value;for(var _i128=0,_Object$keys3=Object.keys(_config);_i128<_Object$keys3.length;_i128++){var _key9=_Object$keys3[_i128];var value=_config[_key9],current=result[_key9];if(current===undefined)result[_key9]=value;else if(current===value||value===undefined);else if(Object.hasOwnProperty.call(combine,_key9))result[_key9]=combine[_key9](current,value);else throw new Error("Config merge conflict for field "+_key9)}}}catch(err){_iterator215.e(err)}finally{_iterator215.f()}for(var key in defaults)if(result[key]===undefined)result[key]=defaults[key];return result}var RangeValue=function(){function RangeValue(){_classCallCheck2(this,RangeValue)}_createClass2(RangeValue,[{key:"eq",value:function eq(other){return this==other}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;return Range$1.create(from,to,this)}}]);return RangeValue}();RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=false;RangeValue.prototype.mapMode=MapMode.TrackDel;var Range$1=function(){function Range(from,to,value){_classCallCheck2(this,Range);this.from=from;this.to=to;this.value=value}_createClass2(Range,null,[{key:"create",value:function create(from,to,value){return new Range(from,to,value)}}]);return Range}();function cmpRange(a,b){return a.from-b.from||a.value.startSide-b.value.startSide}var Chunk=function(){function Chunk(from,to,value,maxPoint){_classCallCheck2(this,Chunk);this.from=from;this.to=to;this.value=value;this.maxPoint=maxPoint}_createClass2(Chunk,[{key:"length",get:function get(){return this.to[this.to.length-1]}},{key:"findIndex",value:function findIndex(pos,side,end){var startAt=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var arr=end?this.to:this.from;for(var lo=startAt,hi=arr.length;;){if(lo==hi)return lo;var mid=lo+hi>>1;var diff=arr[mid]-pos||(end?this.value[mid].endSide:this.value[mid].startSide)-side;if(mid==lo)return diff>=0?lo:hi;if(diff>=0)hi=mid;else lo=mid+1}}},{key:"between",value:function between(offset,from,to,f){for(var _i129=this.findIndex(from,-1000000000,true),e=this.findIndex(to,1000000000,false,_i129);_i129<e;_i129++)if(f(this.from[_i129]+offset,this.to[_i129]+offset,this.value[_i129])===false)return false}},{key:"map",value:function map(offset,changes){var value=[],from=[],to=[],newPos=-1,maxPoint=-1;for(var _i130=0;_i130<this.value.length;_i130++){var val=this.value[_i130],curFrom=this.from[_i130]+offset,curTo=this.to[_i130]+offset,newFrom=void 0,newTo=void 0;if(curFrom==curTo){var mapped=changes.mapPos(curFrom,val.startSide,val.mapMode);if(mapped==null)continue;newFrom=newTo=mapped;if(val.startSide!=val.endSide){newTo=changes.mapPos(curFrom,val.endSide);if(newTo<newFrom)continue}}else{newFrom=changes.mapPos(curFrom,val.startSide);newTo=changes.mapPos(curTo,val.endSide);if(newFrom>newTo||newFrom==newTo&&val.startSide>0&&val.endSide<=0)continue}if((newTo-newFrom||val.endSide-val.startSide)<0)continue;if(newPos<0)newPos=newFrom;if(val.point)maxPoint=Math.max(maxPoint,newTo-newFrom);value.push(val);from.push(newFrom-newPos);to.push(newTo-newPos)}return{mapped:value.length?new Chunk(from,to,value,maxPoint):null,pos:newPos}}}]);return Chunk}();var RangeSet=function(){function RangeSet(chunkPos,chunk,nextLayer,maxPoint){_classCallCheck2(this,RangeSet);this.chunkPos=chunkPos;this.chunk=chunk;this.nextLayer=nextLayer;this.maxPoint=maxPoint}_createClass2(RangeSet,[{key:"length",get:function get(){var last=this.chunk.length-1;return last<0?0:Math.max(this.chunkEnd(last),this.nextLayer.length)}},{key:"size",get:function get(){if(this.isEmpty)return 0;var size=this.nextLayer.size;var _iterator216=_createForOfIteratorHelper(this.chunk),_step216;try{for(_iterator216.s();!(_step216=_iterator216.n()).done;){var chunk=_step216.value;size+=chunk.value.length}}catch(err){_iterator216.e(err)}finally{_iterator216.f()}return size}},{key:"chunkEnd",value:function chunkEnd(index){return this.chunkPos[index]+this.chunk[index].length}},{key:"update",value:function update(updateSpec){var _updateSpec$add=updateSpec.add,add=_updateSpec$add===void 0?[]:_updateSpec$add,_updateSpec$sort=updateSpec.sort,sort=_updateSpec$sort===void 0?false:_updateSpec$sort,_updateSpec$filterFro=updateSpec.filterFrom,filterFrom=_updateSpec$filterFro===void 0?0:_updateSpec$filterFro,_updateSpec$filterTo=updateSpec.filterTo,filterTo=_updateSpec$filterTo===void 0?this.length:_updateSpec$filterTo;var filter=updateSpec.filter;if(add.length==0&&!filter)return this;if(sort)add=add.slice().sort(cmpRange);if(this.isEmpty)return add.length?RangeSet.of(add):this;var cur=new LayerCursor(this,null,-1)["goto"](0),i=0,spill=[];var builder=new RangeSetBuilder;while(cur.value||i<add.length){if(i<add.length&&(cur.from-add[i].from||cur.startSide-add[i].value.startSide)>=0){var range=add[i++];if(!builder.addInner(range.from,range.to,range.value))spill.push(range)}else if(cur.rangeIndex==1&&cur.chunkIndex<this.chunk.length&&(i==add.length||this.chunkEnd(cur.chunkIndex)<add[i].from)&&(!filter||filterFrom>this.chunkEnd(cur.chunkIndex)||filterTo<this.chunkPos[cur.chunkIndex])&&builder.addChunk(this.chunkPos[cur.chunkIndex],this.chunk[cur.chunkIndex])){cur.nextChunk()}else{if(!filter||filterFrom>cur.to||filterTo<cur.from||filter(cur.from,cur.to,cur.value)){if(!builder.addInner(cur.from,cur.to,cur.value))spill.push(Range$1.create(cur.from,cur.to,cur.value))}cur.next()}}return builder.finishInner(this.nextLayer.isEmpty&&!spill.length?RangeSet.empty:this.nextLayer.update({add:spill,filter:filter,filterFrom:filterFrom,filterTo:filterTo}))}},{key:"map",value:function map(changes){if(changes.empty||this.isEmpty)return this;var chunks=[],chunkPos=[],maxPoint=-1;for(var _i131=0;_i131<this.chunk.length;_i131++){var _start5=this.chunkPos[_i131],chunk=this.chunk[_i131];var touch=changes.touchesRange(_start5,_start5+chunk.length);if(touch===false){maxPoint=Math.max(maxPoint,chunk.maxPoint);chunks.push(chunk);chunkPos.push(changes.mapPos(_start5))}else if(touch===true){var _chunk$map=chunk.map(_start5,changes),mapped=_chunk$map.mapped,pos=_chunk$map.pos;if(mapped){maxPoint=Math.max(maxPoint,mapped.maxPoint);chunks.push(mapped);chunkPos.push(pos)}}}var next=this.nextLayer.map(changes);return chunks.length==0?next:new RangeSet(chunkPos,chunks,next||RangeSet.empty,maxPoint)}},{key:"between",value:function between(from,to,f){if(this.isEmpty)return;for(var _i132=0;_i132<this.chunk.length;_i132++){var _start6=this.chunkPos[_i132],chunk=this.chunk[_i132];if(to>=_start6&&from<=_start6+chunk.length&&chunk.between(_start6,from-_start6,to-_start6,f)===false)return}this.nextLayer.between(from,to,f)}},{key:"iter",value:function iter(){var from=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return HeapCursor.from([this])["goto"](from)}},{key:"isEmpty",get:function get(){return this.nextLayer==this}}],[{key:"create",value:function create(chunkPos,chunk,nextLayer,maxPoint){return new RangeSet(chunkPos,chunk,nextLayer,maxPoint)}},{key:"iter",value:function iter(sets){var from=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return HeapCursor.from(sets)["goto"](from)}},{key:"compare",value:function compare(oldSets,newSets,textDiff,comparator){var minPointSize=arguments.length>4&&arguments[4]!==undefined?arguments[4]:-1;var a=oldSets.filter(function(set){return set.maxPoint>0||!set.isEmpty&&set.maxPoint>=minPointSize});var b=newSets.filter(function(set){return set.maxPoint>0||!set.isEmpty&&set.maxPoint>=minPointSize});var sharedChunks=findSharedChunks(a,b,textDiff);var sideA=new SpanCursor(a,sharedChunks,minPointSize);var sideB=new SpanCursor(b,sharedChunks,minPointSize);textDiff.iterGaps(function(fromA,fromB,length){return _compare(sideA,fromA,sideB,fromB,length,comparator)});if(textDiff.empty&&textDiff.length==0)_compare(sideA,0,sideB,0,0,comparator)}},{key:"eq",value:function eq(oldSets,newSets){var from=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var to=arguments.length>3?arguments[3]:undefined;if(to==null)to=1000000000-1;var a=oldSets.filter(function(set){return!set.isEmpty&&newSets.indexOf(set)<0});var b=newSets.filter(function(set){return!set.isEmpty&&oldSets.indexOf(set)<0});if(a.length!=b.length)return false;if(!a.length)return true;var sharedChunks=findSharedChunks(a,b);var sideA=new SpanCursor(a,sharedChunks,0)["goto"](from),sideB=new SpanCursor(b,sharedChunks,0)["goto"](from);for(;;){if(sideA.to!=sideB.to||!sameValues(sideA.active,sideB.active)||sideA.point&&(!sideB.point||!sideA.point.eq(sideB.point)))return false;if(sideA.to>to)return true;sideA.next();sideB.next()}}},{key:"spans",value:function spans(sets,from,to,iterator){var minPointSize=arguments.length>4&&arguments[4]!==undefined?arguments[4]:-1;var cursor=new SpanCursor(sets,null,minPointSize)["goto"](from),pos=from;var openRanges=cursor.openStart;for(;;){var curTo=Math.min(cursor.to,to);if(cursor.point){var active=cursor.activeForPoint(cursor.to);var openCount=cursor.pointFrom<from?active.length+1:Math.min(active.length,openRanges);iterator.point(pos,curTo,cursor.point,active,openCount,cursor.pointRank);openRanges=Math.min(cursor.openEnd(curTo),active.length)}else if(curTo>pos){iterator.span(pos,curTo,cursor.active,openRanges);openRanges=cursor.openEnd(curTo)}if(cursor.to>to)return openRanges+(cursor.point&&cursor.to>to?1:0);pos=cursor.to;cursor.next()}}},{key:"of",value:function of(ranges){var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var build=new RangeSetBuilder;var _iterator217=_createForOfIteratorHelper(ranges instanceof Range$1?[ranges]:sort?lazySort(ranges):ranges),_step217;try{for(_iterator217.s();!(_step217=_iterator217.n()).done;){var range=_step217.value;build.add(range.from,range.to,range.value)}}catch(err){_iterator217.e(err)}finally{_iterator217.f()}return build.finish()}},{key:"join",value:function join(sets){if(!sets.length)return RangeSet.empty;var result=sets[sets.length-1];for(var _i133=sets.length-2;_i133>=0;_i133--){for(var _layer7=sets[_i133];_layer7!=RangeSet.empty;_layer7=_layer7.nextLayer)result=new RangeSet(_layer7.chunkPos,_layer7.chunk,result,Math.max(_layer7.maxPoint,result.maxPoint))}return result}}]);return RangeSet}();RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(ranges){if(ranges.length>1)for(var prev=ranges[0],_i134=1;_i134<ranges.length;_i134++){var _cur=ranges[_i134];if(cmpRange(prev,_cur)>0)return ranges.slice().sort(cmpRange);prev=_cur}return ranges}RangeSet.empty.nextLayer=RangeSet.empty;var RangeSetBuilder=function(){function RangeSetBuilder(){_classCallCheck2(this,RangeSetBuilder);this.chunks=[];this.chunkPos=[];this.chunkStart=-1;this.last=null;this.lastFrom=-1000000000;this.lastTo=-1000000000;this.from=[];this.to=[];this.value=[];this.maxPoint=-1;this.setMaxPoint=-1;this.nextLayer=null}_createClass2(RangeSetBuilder,[{key:"finishChunk",value:function finishChunk(newArrays){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint));this.chunkPos.push(this.chunkStart);this.chunkStart=-1;this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint);this.maxPoint=-1;if(newArrays){this.from=[];this.to=[];this.value=[]}}},{key:"add",value:function add(from,to,value){if(!this.addInner(from,to,value))(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(from,to,value)}},{key:"addInner",value:function addInner(from,to,value){var diff=from-this.lastTo||value.startSide-this.last.endSide;if(diff<=0&&(from-this.lastFrom||value.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");if(diff<0)return false;if(this.from.length==250)this.finishChunk(true);if(this.chunkStart<0)this.chunkStart=from;this.from.push(from-this.chunkStart);this.to.push(to-this.chunkStart);this.last=value;this.lastFrom=from;this.lastTo=to;this.value.push(value);if(value.point)this.maxPoint=Math.max(this.maxPoint,to-from);return true}},{key:"addChunk",value:function addChunk(from,chunk){if((from-this.lastTo||chunk.value[0].startSide-this.last.endSide)<0)return false;if(this.from.length)this.finishChunk(true);this.setMaxPoint=Math.max(this.setMaxPoint,chunk.maxPoint);this.chunks.push(chunk);this.chunkPos.push(from);var last=chunk.value.length-1;this.last=chunk.value[last];this.lastFrom=chunk.from[last]+from;this.lastTo=chunk.to[last]+from;return true}},{key:"finish",value:function finish(){return this.finishInner(RangeSet.empty)}},{key:"finishInner",value:function finishInner(next){if(this.from.length)this.finishChunk(false);if(this.chunks.length==0)return next;var result=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(next):next,this.setMaxPoint);this.from=null;return result}}]);return RangeSetBuilder}();function findSharedChunks(a,b,textDiff){var inA=new Map;var _iterator218=_createForOfIteratorHelper(a),_step218;try{for(_iterator218.s();!(_step218=_iterator218.n()).done;){var set=_step218.value;for(var _i135=0;_i135<set.chunk.length;_i135++)if(set.chunk[_i135].maxPoint<=0)inA.set(set.chunk[_i135],set.chunkPos[_i135])}}catch(err){_iterator218.e(err)}finally{_iterator218.f()}var shared=new Set;var _iterator219=_createForOfIteratorHelper(b),_step219;try{for(_iterator219.s();!(_step219=_iterator219.n()).done;){var _set=_step219.value;for(var _i136=0;_i136<_set.chunk.length;_i136++){var known=inA.get(_set.chunk[_i136]);if(known!=null&&(textDiff?textDiff.mapPos(known):known)==_set.chunkPos[_i136]&&!(textDiff===null||textDiff===void 0?void 0:textDiff.touchesRange(known,known+_set.chunk[_i136].length)))shared.add(_set.chunk[_i136])}}}catch(err){_iterator219.e(err)}finally{_iterator219.f()}return shared}var LayerCursor=function(){function LayerCursor(layer,skip,minPoint){var rank=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck2(this,LayerCursor);this.layer=layer;this.skip=skip;this.minPoint=minPoint;this.rank=rank}_createClass2(LayerCursor,[{key:"startSide",get:function get(){return this.value?this.value.startSide:0}},{key:"endSide",get:function get(){return this.value?this.value.endSide:0}},{key:"goto",value:function goto(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1000000000;this.chunkIndex=this.rangeIndex=0;this.gotoInner(pos,side,false);return this}},{key:"gotoInner",value:function gotoInner(pos,side,forward){while(this.chunkIndex<this.layer.chunk.length){var next=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(next)||this.layer.chunkEnd(this.chunkIndex)<pos||next.maxPoint<this.minPoint))break;this.chunkIndex++;forward=false}if(this.chunkIndex<this.layer.chunk.length){var rangeIndex=this.layer.chunk[this.chunkIndex].findIndex(pos-this.layer.chunkPos[this.chunkIndex],side,true);if(!forward||this.rangeIndex<rangeIndex)this.setRangeIndex(rangeIndex)}this.next()}},{key:"forward",value:function forward(pos,side){if((this.to-pos||this.endSide-side)<0)this.gotoInner(pos,side,true)}},{key:"next",value:function next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1000000000;this.value=null;break}else{var chunkPos=this.layer.chunkPos[this.chunkIndex],chunk=this.layer.chunk[this.chunkIndex];var from=chunkPos+chunk.from[this.rangeIndex];this.from=from;this.to=chunkPos+chunk.to[this.rangeIndex];this.value=chunk.value[this.rangeIndex];this.setRangeIndex(this.rangeIndex+1);if(this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}},{key:"setRangeIndex",value:function setRangeIndex(index){if(index==this.layer.chunk[this.chunkIndex].value.length){this.chunkIndex++;if(this.skip){while(this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]))this.chunkIndex++}this.rangeIndex=0}else{this.rangeIndex=index}}},{key:"nextChunk",value:function nextChunk(){this.chunkIndex++;this.rangeIndex=0;this.next()}},{key:"compare",value:function compare(other){return this.from-other.from||this.startSide-other.startSide||this.rank-other.rank||this.to-other.to||this.endSide-other.endSide}}]);return LayerCursor}();var HeapCursor=function(){function HeapCursor(heap){_classCallCheck2(this,HeapCursor);this.heap=heap}_createClass2(HeapCursor,[{key:"startSide",get:function get(){return this.value?this.value.startSide:0}},{key:"goto",value:function goto(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1000000000;var _iterator220=_createForOfIteratorHelper(this.heap),_step220;try{for(_iterator220.s();!(_step220=_iterator220.n()).done;){var _cur2=_step220.value;_cur2["goto"](pos,side)}}catch(err){_iterator220.e(err)}finally{_iterator220.f()}for(var _i137=this.heap.length>>1;_i137>=0;_i137--)heapBubble(this.heap,_i137);this.next();return this}},{key:"forward",value:function forward(pos,side){var _iterator221=_createForOfIteratorHelper(this.heap),_step221;try{for(_iterator221.s();!(_step221=_iterator221.n()).done;){var _cur3=_step221.value;_cur3.forward(pos,side)}}catch(err){_iterator221.e(err)}finally{_iterator221.f()}for(var _i138=this.heap.length>>1;_i138>=0;_i138--)heapBubble(this.heap,_i138);if((this.to-pos||this.value.endSide-side)<0)this.next()}},{key:"next",value:function next(){if(this.heap.length==0){this.from=this.to=1000000000;this.value=null;this.rank=-1}else{var _top2=this.heap[0];this.from=_top2.from;this.to=_top2.to;this.value=_top2.value;this.rank=_top2.rank;if(_top2.value)_top2.next();heapBubble(this.heap,0)}}}],[{key:"from",value:function from(sets){var skip=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var minPoint=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;var heap=[];for(var _i139=0;_i139<sets.length;_i139++){for(var _cur4=sets[_i139];!_cur4.isEmpty;_cur4=_cur4.nextLayer){if(_cur4.maxPoint>=minPoint)heap.push(new LayerCursor(_cur4,skip,minPoint,_i139))}}return heap.length==1?heap[0]:new HeapCursor(heap)}}]);return HeapCursor}();function heapBubble(heap,index){for(var _cur5=heap[index];;){var childIndex=(index<<1)+1;if(childIndex>=heap.length)break;var child=heap[childIndex];if(childIndex+1<heap.length&&child.compare(heap[childIndex+1])>=0){child=heap[childIndex+1];childIndex++}if(_cur5.compare(child)<0)break;heap[childIndex]=_cur5;heap[index]=child;index=childIndex}}var SpanCursor=function(){function SpanCursor(sets,skip,minPoint){_classCallCheck2(this,SpanCursor);this.minPoint=minPoint;this.active=[];this.activeTo=[];this.activeRank=[];this.minActive=-1;this.point=null;this.pointFrom=0;this.pointRank=0;this.to=-1000000000;this.endSide=0;this.openStart=-1;this.cursor=HeapCursor.from(sets,skip,minPoint)}_createClass2(SpanCursor,[{key:"goto",value:function goto(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1000000000;this.cursor["goto"](pos,side);this.active.length=this.activeTo.length=this.activeRank.length=0;this.minActive=-1;this.to=pos;this.endSide=side;this.openStart=-1;this.next();return this}},{key:"forward",value:function forward(pos,side){while(this.minActive>-1&&(this.activeTo[this.minActive]-pos||this.active[this.minActive].endSide-side)<0)this.removeActive(this.minActive);this.cursor.forward(pos,side)}},{key:"removeActive",value:function removeActive(index){remove(this.active,index);remove(this.activeTo,index);remove(this.activeRank,index);this.minActive=findMinIndex(this.active,this.activeTo)}},{key:"addActive",value:function addActive(trackOpen){var i=0,_this$cursor=this.cursor,value=_this$cursor.value,to=_this$cursor.to,rank=_this$cursor.rank;while(i<this.activeRank.length&&(rank-this.activeRank[i]||to-this.activeTo[i])>0)i++;insert(this.active,i,value);insert(this.activeTo,i,to);insert(this.activeRank,i,rank);if(trackOpen)insert(trackOpen,i,this.cursor.from);this.minActive=findMinIndex(this.active,this.activeTo)}},{key:"next",value:function next(){var from=this.to,wasPoint=this.point;this.point=null;var trackOpen=this.openStart<0?[]:null;for(;;){var a=this.minActive;if(a>-1&&(this.activeTo[a]-this.cursor.from||this.active[a].endSide-this.cursor.startSide)<0){if(this.activeTo[a]>from){this.to=this.activeTo[a];this.endSide=this.active[a].endSide;break}this.removeActive(a);if(trackOpen)remove(trackOpen,a)}else if(!this.cursor.value){this.to=this.endSide=1000000000;break}else if(this.cursor.from>from){this.to=this.cursor.from;this.endSide=this.cursor.startSide;break}else{var nextVal=this.cursor.value;if(!nextVal.point){this.addActive(trackOpen);this.cursor.next()}else if(wasPoint&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to){this.cursor.next()}else{this.point=nextVal;this.pointFrom=this.cursor.from;this.pointRank=this.cursor.rank;this.to=this.cursor.to;this.endSide=nextVal.endSide;this.cursor.next();this.forward(this.to,this.endSide);break}}}if(trackOpen){this.openStart=0;for(var _i140=trackOpen.length-1;_i140>=0&&trackOpen[_i140]<from;_i140--)this.openStart++}}},{key:"activeForPoint",value:function activeForPoint(to){if(!this.active.length)return this.active;var active=[];for(var _i141=this.active.length-1;_i141>=0;_i141--){if(this.activeRank[_i141]<this.pointRank)break;if(this.activeTo[_i141]>to||this.activeTo[_i141]==to&&this.active[_i141].endSide>=this.point.endSide)active.push(this.active[_i141])}return active.reverse()}},{key:"openEnd",value:function openEnd(to){var open=0;for(var _i142=this.activeTo.length-1;_i142>=0&&this.activeTo[_i142]>to;_i142--)open++;return open}}]);return SpanCursor}();function _compare(a,startA,b,startB,length,comparator){a["goto"](startA);b["goto"](startB);var endB=startB+length;var pos=startB,dPos=startB-startA;for(;;){var diff=a.to+dPos-b.to||a.endSide-b.endSide;var _end15=diff<0?a.to+dPos:b.to,clipEnd=Math.min(_end15,endB);if(a.point||b.point){if(!(a.point&&b.point&&(a.point==b.point||a.point.eq(b.point))&&sameValues(a.activeForPoint(a.to),b.activeForPoint(b.to))))comparator.comparePoint(pos,clipEnd,a.point,b.point)}else{if(clipEnd>pos&&!sameValues(a.active,b.active))comparator.compareRange(pos,clipEnd,a.active,b.active)}if(_end15>endB)break;pos=_end15;if(diff<=0)a.next();if(diff>=0)b.next()}}function sameValues(a,b){if(a.length!=b.length)return false;for(var _i143=0;_i143<a.length;_i143++)if(a[_i143]!=b[_i143]&&!a[_i143].eq(b[_i143]))return false;return true}function remove(array,index){for(var _i144=index,e=array.length-1;_i144<e;_i144++)array[_i144]=array[_i144+1];array.pop()}function insert(array,index,value){for(var _i145=array.length-1;_i145>=index;_i145--)array[_i145+1]=array[_i145];array[index]=value}function findMinIndex(value,array){var found=-1,foundPos=1000000000;for(var _i146=0;_i146<array.length;_i146++)if((array[_i146]-foundPos||value[_i146].endSide-value[found].endSide)<0){found=_i146;foundPos=array[_i146]}return found}function _countColumn(string,tabSize){var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:string.length;var n=0;for(var _i147=0;_i147<to;){if(string.charCodeAt(_i147)==9){n+=tabSize-n%tabSize;_i147++}else{n++;_i147=findClusterBreak(string,_i147)}}return n}function findColumn(string,col,tabSize,strict){for(var _i148=0,n=0;;){if(n>=col)return _i148;if(_i148==string.length)break;n+=string.charCodeAt(_i148)==9?tabSize-n%tabSize:1;_i148=findClusterBreak(string,_i148)}return strict===true?-1:string.length}var C="\u037C";var COUNT=typeof Symbol=="undefined"?"__"+C:Symbol["for"](C);var SET=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet");var top=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};var StyleModule=function(){function StyleModule(spec,options){_classCallCheck2(this,StyleModule);this.rules=[];var _ref219=options||{},finish=_ref219.finish;function splitSelector(selector){return /^@/.test(selector)?[selector]:selector.split(/,\s*/)}function render(selectors,spec,target,isKeyframes){var local=[],isAt=/^@(\w+)\b/.exec(selectors[0]),keyframes=isAt&&isAt[1]=="keyframes";if(isAt&&spec==null)return target.push(selectors[0]+";");for(var prop in spec){var value=spec[prop];if(/&/.test(prop)){render(prop.split(/,\s*/).map(function(part){return selectors.map(function(sel){return part.replace(/&/,sel)})}).reduce(function(a,b){return a.concat(b)}),value,target)}else if(value&&_typeof2(value)=="object"){if(!isAt)throw new RangeError("The value of a property ("+prop+") should be a primitive value.");render(splitSelector(prop),value,local,keyframes)}else if(value!=null){local.push(prop.replace(/_.*/,"").replace(/[A-Z]/g,function(l){return"-"+l.toLowerCase()})+": "+value+";")}}if(local.length||keyframes){target.push((finish&&!isAt&&!isKeyframes?selectors.map(finish):selectors).join(", ")+" {"+local.join(" ")+"}")}}for(var prop in spec)render(splitSelector(prop),spec[prop],this.rules)}_createClass2(StyleModule,[{key:"getRules",value:function getRules(){return this.rules.join("\n")}}],[{key:"newName",value:function newName(){var id=top[COUNT]||1;top[COUNT]=id+1;return C+id.toString(36)}},{key:"mount",value:function mount(root,modules,options){var set=root[SET],nonce=options&&options.nonce;if(!set)set=new StyleSet(root,nonce);else if(nonce)set.setNonce(nonce);set.mount(Array.isArray(modules)?modules:[modules])}}]);return StyleModule}();var adoptedSet=new Map;var StyleSet=function(){function StyleSet(root,nonce){_classCallCheck2(this,StyleSet);var doc=root.ownerDocument||root,win=doc.defaultView;if(!root.head&&root.adoptedStyleSheets&&win.CSSStyleSheet){var adopted=adoptedSet.get(doc);if(adopted){root.adoptedStyleSheets=[adopted.sheet].concat(_toConsumableArray2(root.adoptedStyleSheets));return root[SET]=adopted}this.sheet=new win.CSSStyleSheet;root.adoptedStyleSheets=[this.sheet].concat(_toConsumableArray2(root.adoptedStyleSheets));adoptedSet.set(doc,this)}else{this.styleTag=doc.createElement("style");if(nonce)this.styleTag.setAttribute("nonce",nonce);var target=root.head||root;target.insertBefore(this.styleTag,target.firstChild)}this.modules=[];root[SET]=this}_createClass2(StyleSet,[{key:"mount",value:function mount(modules){var sheet=this.sheet;var pos=0,j=0;for(var _i149=0;_i149<modules.length;_i149++){var mod=modules[_i149],index=this.modules.indexOf(mod);if(index<j&&index>-1){this.modules.splice(index,1);j--;index=-1}if(index==-1){this.modules.splice(j++,0,mod);if(sheet)for(var k=0;k<mod.rules.length;k++)sheet.insertRule(mod.rules[k],pos++)}else{while(j<index)pos+=this.modules[j++].rules.length;pos+=mod.rules.length;j++}}if(!sheet){var _text2="";for(var _i150=0;_i150<this.modules.length;_i150++)_text2+=this.modules[_i150].getRules()+"\n";this.styleTag.textContent=_text2}}},{key:"setNonce",value:function setNonce(nonce){if(this.styleTag&&this.styleTag.getAttribute("nonce")!=nonce)this.styleTag.setAttribute("nonce",nonce)}}]);return StyleSet}();var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};var shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:"\""};var mac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);var ie$1=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++){base[i]=String.fromCharCode(i+32);shift[i]=String.fromCharCode(i)}for(var code in base)if(!shift.hasOwnProperty(code))shift[code]=base[code];function keyName(event){var ignoreKey=mac&&event.metaKey&&event.shiftKey&&!event.ctrlKey&&!event.altKey||ie$1&&event.shiftKey&&event.key&&event.key.length==1||event.key=="Unidentified";var name=!ignoreKey&&event.key||(event.shiftKey?shift:base)[event.keyCode]||event.key||"Unidentified";if(name=="Esc")name="Escape";if(name=="Del")name="Delete";if(name=="Left")name="ArrowLeft";if(name=="Up")name="ArrowUp";if(name=="Right")name="ArrowRight";if(name=="Down")name="ArrowDown";return name}function getSelection(root){var target;if(root.nodeType==11){target=root.getSelection?root:root.ownerDocument}else{target=root}return target.getSelection()}function contains(dom,node){return node?dom==node||dom.contains(node.nodeType!=1?node.parentNode:node):false}function deepActiveElement(doc){var elt=doc.activeElement;while(elt&&elt.shadowRoot)elt=elt.shadowRoot.activeElement;return elt}function hasSelection(dom,selection){if(!selection.anchorNode)return false;try{return contains(dom,selection.anchorNode)}catch(_){return false}}function clientRectsFor(dom){if(dom.nodeType==3)return textRange(dom,0,dom.nodeValue.length).getClientRects();else if(dom.nodeType==1)return dom.getClientRects();else return[]}function isEquivalentPosition(node,off,targetNode,targetOff){return targetNode?scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1):false}function domIndex(node){for(var index=0;;index++){node=node.previousSibling;if(!node)return index}}function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return true;if(off==(dir<0?0:maxOffset(node))){if(node.nodeName=="DIV")return false;var parent=node.parentNode;if(!parent||parent.nodeType!=1)return false;off=domIndex(node)+(dir<0?0:1);node=parent}else if(node.nodeType==1){node=node.childNodes[off+(dir<0?-1:0)];if(node.nodeType==1&&node.contentEditable=="false")return false;off=dir<0?maxOffset(node):0}else{return false}}}function maxOffset(node){return node.nodeType==3?node.nodeValue.length:node.childNodes.length}function flattenRect(rect,left){var x=left?rect.left:rect.right;return{left:x,right:x,top:rect.top,bottom:rect.bottom}}function windowRect(win){return{left:0,right:win.innerWidth,top:0,bottom:win.innerHeight}}function getScale(elt,rect){var scaleX=rect.width/elt.offsetWidth;var scaleY=rect.height/elt.offsetHeight;if(scaleX>0.995&&scaleX<1.005||!isFinite(scaleX)||Math.abs(rect.width-elt.offsetWidth)<1)scaleX=1;if(scaleY>0.995&&scaleY<1.005||!isFinite(scaleY)||Math.abs(rect.height-elt.offsetHeight)<1)scaleY=1;return{scaleX:scaleX,scaleY:scaleY}}function scrollRectIntoView(dom,rect,side,x,y,xMargin,yMargin,ltr){var doc=dom.ownerDocument,win=doc.defaultView||window;for(var _cur6=dom,stop=false;_cur6&&!stop;){if(_cur6.nodeType==1){var bounding=void 0,_top3=_cur6==doc.body;var scaleX=1,scaleY=1;if(_top3){bounding=windowRect(win)}else{if(/^(fixed|sticky)$/.test(getComputedStyle(_cur6).position))stop=true;if(_cur6.scrollHeight<=_cur6.clientHeight&&_cur6.scrollWidth<=_cur6.clientWidth){_cur6=_cur6.assignedSlot||_cur6.parentNode;continue}var _rect5=_cur6.getBoundingClientRect();var _getScale=getScale(_cur6,_rect5);scaleX=_getScale.scaleX;scaleY=_getScale.scaleY;bounding={left:_rect5.left,right:_rect5.left+_cur6.clientWidth*scaleX,top:_rect5.top,bottom:_rect5.top+_cur6.clientHeight*scaleY}}var moveX=0,moveY=0;if(y=="nearest"){if(rect.top<bounding.top){moveY=-(bounding.top-rect.top+yMargin);if(side>0&&rect.bottom>bounding.bottom+moveY)moveY=rect.bottom-bounding.bottom+moveY+yMargin}else if(rect.bottom>bounding.bottom){moveY=rect.bottom-bounding.bottom+yMargin;if(side<0&&rect.top-moveY<bounding.top)moveY=-(bounding.top+moveY-rect.top+yMargin)}}else{var rectHeight=rect.bottom-rect.top,boundingHeight=bounding.bottom-bounding.top;var targetTop=y=="center"&&rectHeight<=boundingHeight?rect.top+rectHeight/2-boundingHeight/2:y=="start"||y=="center"&&side<0?rect.top-yMargin:rect.bottom-boundingHeight+yMargin;moveY=targetTop-bounding.top}if(x=="nearest"){if(rect.left<bounding.left){moveX=-(bounding.left-rect.left+xMargin);if(side>0&&rect.right>bounding.right+moveX)moveX=rect.right-bounding.right+moveX+xMargin}else if(rect.right>bounding.right){moveX=rect.right-bounding.right+xMargin;if(side<0&&rect.left<bounding.left+moveX)moveX=-(bounding.left+moveX-rect.left+xMargin)}}else{var targetLeft=x=="center"?rect.left+(rect.right-rect.left)/2-(bounding.right-bounding.left)/2:x=="start"==ltr?rect.left-xMargin:rect.right-(bounding.right-bounding.left)+xMargin;moveX=targetLeft-bounding.left}if(moveX||moveY){if(_top3){win.scrollBy(moveX,moveY)}else{var movedX=0,movedY=0;if(moveY){var _start7=_cur6.scrollTop;_cur6.scrollTop+=moveY/scaleY;movedY=(_cur6.scrollTop-_start7)*scaleY}if(moveX){var _start8=_cur6.scrollLeft;_cur6.scrollLeft+=moveX/scaleX;movedX=(_cur6.scrollLeft-_start8)*scaleX}rect={left:rect.left-movedX,top:rect.top-movedY,right:rect.right-movedX,bottom:rect.bottom-movedY};if(movedX&&Math.abs(movedX-moveX)<1)x="nearest";if(movedY&&Math.abs(movedY-moveY)<1)y="nearest"}}if(_top3)break;_cur6=_cur6.assignedSlot||_cur6.parentNode}else if(_cur6.nodeType==11){_cur6=_cur6.host}else{break}}}function scrollableParent(dom){var doc=dom.ownerDocument;for(var _cur7=dom.parentNode;_cur7;){if(_cur7==doc.body){break}else if(_cur7.nodeType==1){if(_cur7.scrollHeight>_cur7.clientHeight||_cur7.scrollWidth>_cur7.clientWidth)return _cur7;_cur7=_cur7.assignedSlot||_cur7.parentNode}else if(_cur7.nodeType==11){_cur7=_cur7.host}else{break}}return null}var DOMSelectionState=function(){function DOMSelectionState(){_classCallCheck2(this,DOMSelectionState);this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0}_createClass2(DOMSelectionState,[{key:"eq",value:function eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==domSel.focusNode&&this.focusOffset==domSel.focusOffset}},{key:"setRange",value:function setRange(range){var anchorNode=range.anchorNode,focusNode=range.focusNode;this.set(anchorNode,Math.min(range.anchorOffset,anchorNode?maxOffset(anchorNode):0),focusNode,Math.min(range.focusOffset,focusNode?maxOffset(focusNode):0))}},{key:"set",value:function set(anchorNode,anchorOffset,focusNode,focusOffset){this.anchorNode=anchorNode;this.anchorOffset=anchorOffset;this.focusNode=focusNode;this.focusOffset=focusOffset}}]);return DOMSelectionState}();var preventScrollSupported=null;function focusPreventScroll(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);var stack=[];for(var _cur8=dom;_cur8;_cur8=_cur8.parentNode){stack.push(_cur8,_cur8.scrollTop,_cur8.scrollLeft);if(_cur8==_cur8.ownerDocument)break}dom.focus(preventScrollSupported==null?{get preventScroll(){preventScrollSupported={preventScroll:true};return true}}:undefined);if(!preventScrollSupported){preventScrollSupported=false;for(var _i151=0;_i151<stack.length;){var _elt=stack[_i151++],_top4=stack[_i151++],_left3=stack[_i151++];if(_elt.scrollTop!=_top4)_elt.scrollTop=_top4;if(_elt.scrollLeft!=_left3)_elt.scrollLeft=_left3}}}var scratchRange;function textRange(node,from){var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:from;var range=scratchRange||(scratchRange=document.createRange());range.setEnd(node,to);range.setStart(node,from);return range}function dispatchKey(elt,name,code){var options={key:name,code:name,keyCode:code,which:code,cancelable:true};var down=new KeyboardEvent("keydown",options);down.synthetic=true;elt.dispatchEvent(down);var up=new KeyboardEvent("keyup",options);up.synthetic=true;elt.dispatchEvent(up);return down.defaultPrevented||up.defaultPrevented}function getRoot(node){while(node){if(node&&(node.nodeType==9||node.nodeType==11&&node.host))return node;node=node.assignedSlot||node.parentNode}return null}function clearAttributes(node){while(node.attributes.length)node.removeAttributeNode(node.attributes[0])}function atElementStart(doc,selection){var node=selection.focusNode,offset=selection.focusOffset;if(!node||selection.anchorNode!=node||selection.anchorOffset!=offset)return false;offset=Math.min(offset,maxOffset(node));for(;;){if(offset){if(node.nodeType!=1)return false;var prev=node.childNodes[offset-1];if(prev.contentEditable=="false")offset--;else{node=prev;offset=maxOffset(node)}}else if(node==doc){return true}else{offset=domIndex(node);node=node.parentNode}}}function isScrolledToBottom(elt){return elt.scrollTop>Math.max(1,elt.scrollHeight-elt.clientHeight-4)}var DOMPos=function(){function DOMPos(node,offset){var precise=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck2(this,DOMPos);this.node=node;this.offset=offset;this.precise=precise}_createClass2(DOMPos,null,[{key:"before",value:function before(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom),precise)}},{key:"after",value:function after(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom)+1,precise)}}]);return DOMPos}();var noChildren=[];var ContentView=function(){function ContentView(){_classCallCheck2(this,ContentView);this.parent=null;this.dom=null;this.flags=2}_createClass2(ContentView,[{key:"overrideDOMText",get:function get(){return null}},{key:"posAtStart",get:function get(){return this.parent?this.parent.posBefore(this):0}},{key:"posAtEnd",get:function get(){return this.posAtStart+this.length}},{key:"posBefore",value:function posBefore(view){var pos=this.posAtStart;var _iterator222=_createForOfIteratorHelper(this.children),_step222;try{for(_iterator222.s();!(_step222=_iterator222.n()).done;){var child=_step222.value;if(child==view)return pos;pos+=child.length+child.breakAfter}}catch(err){_iterator222.e(err)}finally{_iterator222.f()}throw new RangeError("Invalid child in posBefore")}},{key:"posAfter",value:function posAfter(view){return this.posBefore(view)+view.length}},{key:"sync",value:function sync(view,track){if(this.flags&2){var parent=this.dom;var prev=null,next;var _iterator223=_createForOfIteratorHelper(this.children),_step223;try{for(_iterator223.s();!(_step223=_iterator223.n()).done;){var child=_step223.value;if(child.flags&7){if(!child.dom&&(next=prev?prev.nextSibling:parent.firstChild)){var contentView=ContentView.get(next);if(!contentView||!contentView.parent&&contentView.canReuseDOM(child))child.reuseDOM(next)}child.sync(view,track);child.flags&=~7}next=prev?prev.nextSibling:parent.firstChild;if(track&&!track.written&&track.node==parent&&next!=child.dom)track.written=true;if(child.dom.parentNode==parent){while(next&&next!=child.dom)next=rm$1(next)}else{parent.insertBefore(child.dom,next)}prev=child.dom}}catch(err){_iterator223.e(err)}finally{_iterator223.f()}next=prev?prev.nextSibling:parent.firstChild;if(next&&track&&track.node==parent)track.written=true;while(next)next=rm$1(next)}else if(this.flags&1){var _iterator224=_createForOfIteratorHelper(this.children),_step224;try{for(_iterator224.s();!(_step224=_iterator224.n()).done;){var _child=_step224.value;if(_child.flags&7){_child.sync(view,track);_child.flags&=~7}}}catch(err){_iterator224.e(err)}finally{_iterator224.f()}}}},{key:"reuseDOM",value:function reuseDOM(_dom){}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){var after;if(node==this.dom){after=this.dom.childNodes[offset]}else{var bias=maxOffset(node)==0?0:offset==0?-1:1;for(;;){var parent=node.parentNode;if(parent==this.dom)break;if(bias==0&&parent.firstChild!=parent.lastChild){if(node==parent.firstChild)bias=-1;else bias=1}node=parent}if(bias<0)after=node;else after=node.nextSibling}if(after==this.dom.firstChild)return 0;while(after&&!ContentView.get(after))after=after.nextSibling;if(!after)return this.length;for(var _i152=0,pos=0;;_i152++){var child=this.children[_i152];if(child.dom==after)return pos;pos+=child.length+child.breakAfter}}},{key:"domBoundsAround",value:function domBoundsAround(from,to){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(var _i153=0,pos=offset,prevEnd=offset;_i153<this.children.length;_i153++){var child=this.children[_i153],_end16=pos+child.length;if(pos<from&&_end16>to)return child.domBoundsAround(from,to,pos);if(_end16>=from&&fromI==-1){fromI=_i153;fromStart=pos}if(pos>to&&child.dom.parentNode==this.dom){toI=_i153;toEnd=prevEnd;break}prevEnd=_end16;pos=_end16+child.breakAfter}return{from:fromStart,to:toEnd<0?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&toI>=0?this.children[toI].dom:null}}},{key:"markDirty",value:function markDirty(){var andParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.flags|=2;this.markParentsDirty(andParent)}},{key:"markParentsDirty",value:function markParentsDirty(childList){for(var parent=this.parent;parent;parent=parent.parent){if(childList)parent.flags|=2;if(parent.flags&1)return;parent.flags|=1;childList=false}}},{key:"setParent",value:function setParent(parent){if(this.parent!=parent){this.parent=parent;if(this.flags&7)this.markParentsDirty(true)}}},{key:"setDOM",value:function setDOM(dom){if(this.dom==dom)return;if(this.dom)this.dom.cmView=null;this.dom=dom;dom.cmView=this}},{key:"rootView",get:function get(){for(var v=this;;){var parent=v.parent;if(!parent)return v;v=parent}}},{key:"replaceChildren",value:function replaceChildren(from,to){var _this$children;var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noChildren;this.markDirty();for(var _i154=from;_i154<to;_i154++){var child=this.children[_i154];if(child.parent==this&&children.indexOf(child)<0)child.destroy()}(_this$children=this.children).splice.apply(_this$children,[from,to-from].concat(_toConsumableArray2(children)));for(var _i155=0;_i155<children.length;_i155++)children[_i155].setParent(this)}},{key:"ignoreMutation",value:function ignoreMutation(_rec){return false}},{key:"ignoreEvent",value:function ignoreEvent(_event){return false}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;return new ChildCursor(this.children,pos,this.children.length)}},{key:"childPos",value:function childPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return this.childCursor().findPos(pos,bias)}},{key:"toString",value:function toString(){var name=this.constructor.name.replace("View","");return name+(this.children.length?"("+this.children.join()+")":this.length?"["+(name=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}},{key:"isEditable",get:function get(){return true}},{key:"isWidget",get:function get(){return false}},{key:"isHidden",get:function get(){return false}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){return false}},{key:"become",value:function become(other){return false}},{key:"canReuseDOM",value:function canReuseDOM(other){return other.constructor==this.constructor&&!((this.flags|other.flags)&8)}},{key:"getSide",value:function getSide(){return 0}},{key:"destroy",value:function destroy(){var _iterator225=_createForOfIteratorHelper(this.children),_step225;try{for(_iterator225.s();!(_step225=_iterator225.n()).done;){var child=_step225.value;if(child.parent==this)child.destroy()}}catch(err){_iterator225.e(err)}finally{_iterator225.f()}this.parent=null}}],[{key:"get",value:function get(node){return node.cmView}}]);return ContentView}();ContentView.prototype.breakAfter=0;function rm$1(dom){var next=dom.nextSibling;dom.parentNode.removeChild(dom);return next}var ChildCursor=function(){function ChildCursor(children,pos,i){_classCallCheck2(this,ChildCursor);this.children=children;this.pos=pos;this.i=i;this.off=0}_createClass2(ChildCursor,[{key:"findPos",value:function findPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;for(;;){if(pos>this.pos||pos==this.pos&&(bias>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=pos-this.pos;return this}var next=this.children[--this.i];this.pos-=next.length+next.breakAfter}}}]);return ChildCursor}();function replaceRange(parent,fromI,fromOff,toI,toOff,insert,breakAtStart,openStart,openEnd){var children=parent.children;var before=children.length?children[fromI]:null;var last=insert.length?insert[insert.length-1]:null;var breakAtEnd=last?last.breakAfter:breakAtStart;if(fromI==toI&&before&&!breakAtStart&&!breakAtEnd&&insert.length<2&&before.merge(fromOff,toOff,insert.length?last:null,fromOff==0,openStart,openEnd))return;if(toI<children.length){var _after=children[toI];if(_after&&(toOff<_after.length||_after.breakAfter&&(last===null||last===void 0?void 0:last.breakAfter))){if(fromI==toI){_after=_after.split(toOff);toOff=0}if(!breakAtEnd&&last&&_after.merge(0,toOff,last,true,0,openEnd)){insert[insert.length-1]=_after}else{if(toOff||_after.children.length&&!_after.children[0].length)_after.merge(0,toOff,null,false,0,openEnd);insert.push(_after)}}else if(_after===null||_after===void 0?void 0:_after.breakAfter){if(last)last.breakAfter=1;else breakAtStart=1}toI++}if(before){before.breakAfter=breakAtStart;if(fromOff>0){if(!breakAtStart&&insert.length&&before.merge(fromOff,before.length,insert[0],false,openStart,0)){before.breakAfter=insert.shift().breakAfter}else if(fromOff<before.length||before.children.length&&before.children[before.children.length-1].length==0){before.merge(fromOff,before.length,null,false,openStart,0)}fromI++}}while(fromI<toI&&insert.length){if(children[toI-1].become(insert[insert.length-1])){toI--;insert.pop();openEnd=insert.length?0:openStart}else if(children[fromI].become(insert[0])){fromI++;insert.shift();openStart=insert.length?0:openEnd}else{break}}if(!insert.length&&fromI&&toI<children.length&&!children[fromI-1].breakAfter&&children[toI].merge(0,0,children[fromI-1],false,openStart,openEnd))fromI--;if(fromI<toI||insert.length)parent.replaceChildren(fromI,toI,insert)}function mergeChildrenInto(parent,from,to,insert,openStart,openEnd){var cur=parent.childCursor();var _cur$findPos=cur.findPos(to,1),toI=_cur$findPos.i,toOff=_cur$findPos.off;var _cur$findPos2=cur.findPos(from,-1),fromI=_cur$findPos2.i,fromOff=_cur$findPos2.off;var dLen=from-to;var _iterator226=_createForOfIteratorHelper(insert),_step226;try{for(_iterator226.s();!(_step226=_iterator226.n()).done;){var view=_step226.value;dLen+=view.length}}catch(err){_iterator226.e(err)}finally{_iterator226.f()}parent.length+=dLen;replaceRange(parent,fromI,fromOff,toI,toOff,insert,0,openStart,openEnd)}var nav=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""};var doc=typeof document!="undefined"?document:{documentElement:{style:{}}};var ie_edge=/Edge\/(\d+)/.exec(nav.userAgent);var ie_upto10=/MSIE \d/.test(nav.userAgent);var ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent);var ie=!!(ie_upto10||ie_11up||ie_edge);var gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent);var chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent);var webkit=("webkitFontSmoothing"in doc.documentElement.style);var safari=!ie&&/Apple Computer/.test(nav.vendor);var ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie:ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko:gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios:ios,android:/Android\b/.test(nav.userAgent),webkit:webkit,safari:safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var MaxJoinLen=256;var TextView=function(_ContentView){_inherits2(TextView,_ContentView);var _super72=_createSuper(TextView);function TextView(text){var _this179;_classCallCheck2(this,TextView);_this179=_super72.call(this);_this179.text=text;return _this179}_createClass2(TextView,[{key:"length",get:function get(){return this.text.length}},{key:"createDOM",value:function createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text))}},{key:"sync",value:function sync(view,track){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(track&&track.node==this.dom)track.written=true;this.dom.nodeValue=this.text}}},{key:"reuseDOM",value:function reuseDOM(dom){if(dom.nodeType==3)this.createDOM(dom)}},{key:"merge",value:function merge(from,to,source){if(this.flags&8||source&&(!(source instanceof TextView)||this.length-(to-from)+source.length>MaxJoinLen||source.flags&8))return false;this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to);this.markDirty();return true}},{key:"split",value:function split(from){var result=new TextView(this.text.slice(from));this.text=this.text.slice(0,from);this.markDirty();result.flags|=this.flags&8;return result}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0}},{key:"domAtPos",value:function domAtPos(pos){return new DOMPos(this.dom,pos)}},{key:"domBoundsAround",value:function domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords(this.dom,pos,side)}}]);return TextView}(ContentView);var MarkView=function(_ContentView2){_inherits2(MarkView,_ContentView2);var _super73=_createSuper(MarkView);function MarkView(mark){var _this180;var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck2(this,MarkView);_this180=_super73.call(this);_this180.mark=mark;_this180.children=children;_this180.length=length;var _iterator227=_createForOfIteratorHelper(children),_step227;try{for(_iterator227.s();!(_step227=_iterator227.n()).done;){var ch=_step227.value;ch.setParent(_assertThisInitialized(_this180))}}catch(err){_iterator227.e(err)}finally{_iterator227.f()}return _this180}_createClass2(MarkView,[{key:"setAttrs",value:function setAttrs(dom){clearAttributes(dom);if(this.mark["class"])dom.className=this.mark["class"];if(this.mark.attrs)for(var _name18 in this.mark.attrs)dom.setAttribute(_name18,this.mark.attrs[_name18]);return dom}},{key:"canReuseDOM",value:function canReuseDOM(other){return _get5(_getPrototypeOf(MarkView.prototype),"canReuseDOM",this).call(this,other)&&!((this.flags|other.flags)&8)}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName==this.mark.tagName.toUpperCase()){this.setDOM(node);this.flags|=4|2}}},{key:"sync",value:function sync(view,track){if(!this.dom)this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));else if(this.flags&4)this.setAttrs(this.dom);_get5(_getPrototypeOf(MarkView.prototype),"sync",this).call(this,view,track)}},{key:"merge",value:function merge(from,to,source,_hasStart,openStart,openEnd){if(source&&(!(source instanceof MarkView&&source.mark.eq(this.mark))||from&&openStart<=0||to<this.length&&openEnd<=0))return false;mergeChildrenInto(this,from,to,source?source.children.slice():[],openStart-1,openEnd-1);this.markDirty();return true}},{key:"split",value:function split(from){var result=[],off=0,detachFrom=-1,i=0;var _iterator228=_createForOfIteratorHelper(this.children),_step228;try{for(_iterator228.s();!(_step228=_iterator228.n()).done;){var _elt2=_step228.value;var _end17=off+_elt2.length;if(_end17>from)result.push(off<from?_elt2.split(from-off):_elt2);if(detachFrom<0&&off>=from)detachFrom=i;off=_end17;i++}}catch(err){_iterator228.e(err)}finally{_iterator228.f()}var length=this.length-from;this.length=from;if(detachFrom>-1){this.children.length=detachFrom;this.markDirty()}return new MarkView(this.mark,result,length)}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos(this,pos)}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren(this,pos,side)}}]);return MarkView}(ContentView);function textCoords(text,pos,side){var length=text.nodeValue.length;if(pos>length)pos=length;var from=pos,to=pos,flatten=0;if(pos==0&&side<0||pos==length&&side>=0){if(!(browser.chrome||browser.gecko)){if(pos){from--;flatten=1}else if(to<length){to++;flatten=-1}}}else{if(side<0)from--;else if(to<length)to++}var rects=textRange(text,from,to).getClientRects();if(!rects.length)return null;var rect=rects[(flatten?flatten<0:side>=0)?0:rects.length-1];if(browser.safari&&!flatten&&rect.width==0)rect=Array.prototype.find.call(rects,function(r){return r.width})||rect;return flatten?flattenRect(rect,flatten<0):rect||null}var WidgetView=function(_ContentView3){_inherits2(WidgetView,_ContentView3);var _super74=_createSuper(WidgetView);function WidgetView(widget,length,side){var _this181;_classCallCheck2(this,WidgetView);_this181=_super74.call(this);_this181.widget=widget;_this181.length=length;_this181.side=side;_this181.prevWidget=null;return _this181}_createClass2(WidgetView,[{key:"split",value:function split(from){var result=WidgetView.create(this.widget,this.length-from,this.side);this.length-=from;return result}},{key:"sync",value:function sync(view){if(!this.dom||!this.widget.updateDOM(this.dom,view)){if(this.dom&&this.prevWidget)this.prevWidget.destroy(this.dom);this.prevWidget=null;this.setDOM(this.widget.toDOM(view));if(!this.widget.editable)this.dom.contentEditable="false"}}},{key:"getSide",value:function getSide(){return this.side}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source&&(!(source instanceof WidgetView)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true}},{key:"become",value:function become(other){if(other instanceof WidgetView&&other.side==this.side&&this.widget.constructor==other.widget.constructor){if(!this.widget.compare(other.widget))this.markDirty(true);if(this.dom&&!this.prevWidget)this.prevWidget=this.widget;this.widget=other.widget;this.length=other.length;return true}return false}},{key:"ignoreMutation",value:function ignoreMutation(){return true}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event)}},{key:"overrideDOMText",get:function get(){if(this.length==0)return Text.empty;var top=this;while(top.parent)top=top.parent;var _top5=top,view=_top5.view,text=view&&view.state.doc,start=this.posAtStart;return text?text.slice(start,start+this.length):Text.empty}},{key:"domAtPos",value:function domAtPos(pos){return(this.length?pos==0:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length)}},{key:"domBoundsAround",value:function domBoundsAround(){return null}},{key:"coordsAt",value:function coordsAt(pos,side){var custom=this.widget.coordsAt(this.dom,pos,side);if(custom)return custom;var rects=this.dom.getClientRects(),rect=null;if(!rects.length)return null;var fromBack=this.side?this.side<0:pos>0;for(var _i156=fromBack?rects.length-1:0;;_i156+=fromBack?-1:1){rect=rects[_i156];if(pos>0?_i156==0:_i156==rects.length-1||rect.top<rect.bottom)break}return flattenRect(rect,!fromBack)}},{key:"isEditable",get:function get(){return false}},{key:"isWidget",get:function get(){return true}},{key:"isHidden",get:function get(){return this.widget.isHidden}},{key:"destroy",value:function destroy(){_get5(_getPrototypeOf(WidgetView.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom)}}],[{key:"create",value:function create(widget,length,side){return new WidgetView(widget,length,side)}}]);return WidgetView}(ContentView);var WidgetBufferView=function(_ContentView4){_inherits2(WidgetBufferView,_ContentView4);var _super75=_createSuper(WidgetBufferView);function WidgetBufferView(side){var _this182;_classCallCheck2(this,WidgetBufferView);_this182=_super75.call(this);_this182.side=side;return _this182}_createClass2(WidgetBufferView,[{key:"length",get:function get(){return 0}},{key:"merge",value:function merge(){return false}},{key:"become",value:function become(other){return other instanceof WidgetBufferView&&other.side==this.side}},{key:"split",value:function split(){return new WidgetBufferView(this.side)}},{key:"sync",value:function sync(){if(!this.dom){var dom=document.createElement("img");dom.className="cm-widgetBuffer";dom.setAttribute("aria-hidden","true");this.setDOM(dom)}}},{key:"getSide",value:function getSide(){return this.side}},{key:"domAtPos",value:function domAtPos(pos){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}},{key:"localPosFromDOM",value:function localPosFromDOM(){return 0}},{key:"domBoundsAround",value:function domBoundsAround(){return null}},{key:"coordsAt",value:function coordsAt(pos){return this.dom.getBoundingClientRect()}},{key:"overrideDOMText",get:function get(){return Text.empty}},{key:"isHidden",get:function get(){return true}}]);return WidgetBufferView}(ContentView);TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;function inlineDOMAtPos(parent,pos){var dom=parent.dom,children=parent.children,i=0;for(var off=0;i<children.length;i++){var child=children[i],_end18=off+child.length;if(_end18==off&&child.getSide()<=0)continue;if(pos>off&&pos<_end18&&child.dom.parentNode==dom)return child.domAtPos(pos-off);if(pos<=off)break;off=_end18}for(var j=i;j>0;j--){var prev=children[j-1];if(prev.dom.parentNode==dom)return prev.domAtPos(prev.length)}for(var _j6=i;_j6<children.length;_j6++){var next=children[_j6];if(next.dom.parentNode==dom)return next.domAtPos(0)}return new DOMPos(dom,0)}function joinInlineInto(parent,view,open){var last,children=parent.children;if(open>0&&view instanceof MarkView&&children.length&&(last=children[children.length-1])instanceof MarkView&&last.mark.eq(view.mark)){joinInlineInto(last,view.children[0],open-1)}else{children.push(view);view.setParent(parent)}parent.length+=view.length}function coordsInChildren(view,pos,side){var before=null,beforePos=-1,after=null,afterPos=-1;function scan(view,pos){for(var _i157=0,off=0;_i157<view.children.length&&off<=pos;_i157++){var child=view.children[_i157],_end19=off+child.length;if(_end19>=pos){if(child.children.length){scan(child,pos-off)}else if((!after||after.isHidden&&side>0)&&(_end19>pos||off==_end19&&child.getSide()>0)){after=child;afterPos=pos-off}else if(off<pos||off==_end19&&child.getSide()<0&&!child.isHidden){before=child;beforePos=pos-off}}off=_end19}}scan(view,pos);var target=(side<0?before:after)||before||after;if(target)return target.coordsAt(Math.max(0,target==before?beforePos:afterPos),side);return fallbackRect(view)}function fallbackRect(view){var last=view.dom.lastChild;if(!last)return view.dom.getBoundingClientRect();var rects=clientRectsFor(last);return rects[rects.length-1]||null}function combineAttrs(source,target){for(var _name19 in source){if(_name19=="class"&&target["class"])target["class"]+=" "+source["class"];else if(_name19=="style"&&target.style)target.style+=";"+source.style;else target[_name19]=source[_name19]}return target}var noAttrs=Object.create(null);function attrsEq(a,b,ignore){if(a==b)return true;if(!a)a=noAttrs;if(!b)b=noAttrs;var keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length-(ignore&&keysA.indexOf(ignore)>-1?1:0)!=keysB.length-(ignore&&keysB.indexOf(ignore)>-1?1:0))return false;for(var _i158=0,_keysA=keysA;_i158<_keysA.length;_i158++){var key=_keysA[_i158];if(key!=ignore&&(keysB.indexOf(key)==-1||a[key]!==b[key]))return false}return true}function _updateAttrs(dom,prev,attrs){var changed=false;if(prev)for(var _name20 in prev)if(!(attrs&&_name20 in attrs)){changed=true;if(_name20=="style")dom.style.cssText="";else dom.removeAttribute(_name20)}if(attrs)for(var _name21 in attrs)if(!(prev&&prev[_name21]==attrs[_name21])){changed=true;if(_name21=="style")dom.style.cssText=attrs[_name21];else dom.setAttribute(_name21,attrs[_name21])}return changed}function getAttrs$1(dom){var attrs=Object.create(null);for(var _i159=0;_i159<dom.attributes.length;_i159++){var attr=dom.attributes[_i159];attrs[attr.name]=attr.value}return attrs}var LineView=function(_ContentView5){_inherits2(LineView,_ContentView5);var _super76=_createSuper(LineView);function LineView(){var _this183;_classCallCheck2(this,LineView);_this183=_super76.apply(this,arguments);_this183.children=[];_this183.length=0;_this183.prevAttrs=undefined;_this183.attrs=null;_this183.breakAfter=0;return _this183}_createClass2(LineView,[{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source){if(!(source instanceof LineView))return false;if(!this.dom)source.transferDOM(this)}if(hasStart)this.setDeco(source?source.attrs:null);mergeChildrenInto(this,from,to,source?source.children.slice():[],openStart,openEnd);return true}},{key:"split",value:function split(at){var end=new LineView;end.breakAfter=this.breakAfter;if(this.length==0)return end;var _this$childPos=this.childPos(at),i=_this$childPos.i,off=_this$childPos.off;if(off){end.append(this.children[i].split(off),0);this.children[i].merge(off,this.children[i].length,null,false,0,0);i++}for(var j=i;j<this.children.length;j++)end.append(this.children[j],0);while(i>0&&this.children[i-1].length==0)this.children[--i].destroy();this.children.length=i;this.markDirty();this.length=at;return end}},{key:"transferDOM",value:function transferDOM(other){if(!this.dom)return;this.markDirty();other.setDOM(this.dom);other.prevAttrs=this.prevAttrs===undefined?this.attrs:this.prevAttrs;this.prevAttrs=undefined;this.dom=null}},{key:"setDeco",value:function setDeco(attrs){if(!attrsEq(this.attrs,attrs)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty()}this.attrs=attrs}}},{key:"append",value:function append(child,openStart){joinInlineInto(this,child,openStart)}},{key:"addLineDeco",value:function addLineDeco(deco){var attrs=deco.spec.attributes,cls=deco.spec["class"];if(attrs)this.attrs=combineAttrs(attrs,this.attrs||{});if(cls)this.attrs=combineAttrs({"class":cls},this.attrs||{})}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos(this,pos)}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName=="DIV"){this.setDOM(node);this.flags|=4|2}}},{key:"sync",value:function sync(view,track){var _a;if(!this.dom){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:undefined}else if(this.flags&4){clearAttributes(this.dom);this.dom.className="cm-line";this.prevAttrs=this.attrs?null:undefined}if(this.prevAttrs!==undefined){_updateAttrs(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=undefined}_get5(_getPrototypeOf(LineView.prototype),"sync",this).call(this,view,track);var last=this.dom.lastChild;while(last&&ContentView.get(last)instanceof MarkView)last=last.lastChild;if(!last||!this.length||last.nodeName!="BR"&&((_a=ContentView.get(last))===null||_a===void 0?void 0:_a.isEditable)==false&&(!browser.ios||!this.children.some(function(ch){return ch instanceof TextView}))){var hack=document.createElement("BR");hack.cmIgnore=true;this.dom.appendChild(hack)}}},{key:"measureTextSize",value:function measureTextSize(){if(this.children.length==0||this.length>20)return null;var totalWidth=0,textHeight;var _iterator229=_createForOfIteratorHelper(this.children),_step229;try{for(_iterator229.s();!(_step229=_iterator229.n()).done;){var child=_step229.value;if(!(child instanceof TextView)||/[^ -~]/.test(child.text))return null;var rects=clientRectsFor(child.dom);if(rects.length!=1)return null;totalWidth+=rects[0].width;textHeight=rects[0].height}}catch(err){_iterator229.e(err)}finally{_iterator229.f()}return!totalWidth?null:{lineHeight:this.dom.getBoundingClientRect().height,charWidth:totalWidth/this.length,textHeight:textHeight}}},{key:"coordsAt",value:function coordsAt(pos,side){var rect=coordsInChildren(this,pos,side);if(!this.children.length&&rect&&this.parent){var heightOracle=this.parent.view.viewState.heightOracle,height=rect.bottom-rect.top;if(Math.abs(height-heightOracle.lineHeight)<2&&heightOracle.textHeight<height){var _dist=(height-heightOracle.textHeight)/2;return{top:rect.top+_dist,bottom:rect.bottom-_dist,left:rect.left,right:rect.left}}}return rect}},{key:"become",value:function become(_other){return false}},{key:"covers",value:function covers(){return true}}],[{key:"find",value:function find(docView,pos){for(var _i160=0,off=0;_i160<docView.children.length;_i160++){var block=docView.children[_i160],_end20=off+block.length;if(_end20>=pos){if(block instanceof LineView)return block;if(_end20>pos)break}off=_end20+block.breakAfter}return null}}]);return LineView}(ContentView);var BlockWidgetView=function(_ContentView6){_inherits2(BlockWidgetView,_ContentView6);var _super77=_createSuper(BlockWidgetView);function BlockWidgetView(widget,length,deco){var _this184;_classCallCheck2(this,BlockWidgetView);_this184=_super77.call(this);_this184.widget=widget;_this184.length=length;_this184.deco=deco;_this184.breakAfter=0;_this184.prevWidget=null;return _this184}_createClass2(BlockWidgetView,[{key:"merge",value:function merge(from,to,source,_takeDeco,openStart,openEnd){if(source&&(!(source instanceof BlockWidgetView)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length)}},{key:"split",value:function split(at){var len=this.length-at;this.length=at;var end=new BlockWidgetView(this.widget,len,this.deco);end.breakAfter=this.breakAfter;return end}},{key:"children",get:function get(){return noChildren}},{key:"sync",value:function sync(view){if(!this.dom||!this.widget.updateDOM(this.dom,view)){if(this.dom&&this.prevWidget)this.prevWidget.destroy(this.dom);this.prevWidget=null;this.setDOM(this.widget.toDOM(view));if(!this.widget.editable)this.dom.contentEditable="false"}}},{key:"overrideDOMText",get:function get(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}},{key:"domBoundsAround",value:function domBoundsAround(){return null}},{key:"become",value:function become(other){if(other instanceof BlockWidgetView&&other.widget.constructor==this.widget.constructor){if(!other.widget.compare(this.widget))this.markDirty(true);if(this.dom&&!this.prevWidget)this.prevWidget=this.widget;this.widget=other.widget;this.length=other.length;this.deco=other.deco;this.breakAfter=other.breakAfter;return true}return false}},{key:"ignoreMutation",value:function ignoreMutation(){return true}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event)}},{key:"isEditable",get:function get(){return false}},{key:"isWidget",get:function get(){return true}},{key:"coordsAt",value:function coordsAt(pos,side){return this.widget.coordsAt(this.dom,pos,side)}},{key:"destroy",value:function destroy(){_get5(_getPrototypeOf(BlockWidgetView.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom)}},{key:"covers",value:function covers(side){var _this$deco=this.deco,startSide=_this$deco.startSide,endSide=_this$deco.endSide;return startSide==endSide?false:side<0?startSide<0:endSide>0}}]);return BlockWidgetView}(ContentView);var WidgetType=function(){function WidgetType(){_classCallCheck2(this,WidgetType)}_createClass2(WidgetType,[{key:"eq",value:function eq(widget){return false}},{key:"updateDOM",value:function updateDOM(dom,view){return false}},{key:"compare",value:function compare(other){return this==other||this.constructor==other.constructor&&this.eq(other)}},{key:"estimatedHeight",get:function get(){return-1}},{key:"lineBreaks",get:function get(){return 0}},{key:"ignoreEvent",value:function ignoreEvent(event){return true}},{key:"coordsAt",value:function coordsAt(dom,pos,side){return null}},{key:"isHidden",get:function get(){return false}},{key:"editable",get:function get(){return false}},{key:"destroy",value:function destroy(dom){}}]);return WidgetType}();var BlockType=function(BlockType){BlockType[BlockType["Text"]=0]="Text";BlockType[BlockType["WidgetBefore"]=1]="WidgetBefore";BlockType[BlockType["WidgetAfter"]=2]="WidgetAfter";BlockType[BlockType["WidgetRange"]=3]="WidgetRange";return BlockType}(BlockType||(BlockType={}));var Decoration=function(_RangeValue){_inherits2(Decoration,_RangeValue);var _super78=_createSuper(Decoration);function Decoration(startSide,endSide,widget,spec){var _this185;_classCallCheck2(this,Decoration);_this185=_super78.call(this);_this185.startSide=startSide;_this185.endSide=endSide;_this185.widget=widget;_this185.spec=spec;return _this185}_createClass2(Decoration,[{key:"heightRelevant",get:function get(){return false}},{key:"hasHeight",value:function hasHeight(){return this.widget?this.widget.estimatedHeight>-1:false}}],[{key:"mark",value:function mark(spec){return new MarkDecoration(spec)}},{key:"widget",value:function widget(spec){var side=Math.max(-10000,Math.min(10000,spec.side||0)),block=!!spec.block;side+=block&&!spec.inlineOrder?side>0?300000000:-400000000:side>0?100000000:-100000000;return new PointDecoration(spec,side,side,block,spec.widget||null,false)}},{key:"replace",value:function replace(spec){var block=!!spec.block,startSide,endSide;if(spec.isBlockGap){startSide=-500000000;endSide=400000000}else{var _getInclusive=getInclusive(spec,block),_start9=_getInclusive.start,_end21=_getInclusive.end;startSide=(_start9?block?-300000000:-1:500000000)-1;endSide=(_end21?block?200000000:1:-600000000)+1}return new PointDecoration(spec,startSide,endSide,block,spec.widget||null,true)}},{key:"line",value:function line(spec){return new LineDecoration(spec)}},{key:"set",value:function set(of){var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return RangeSet.of(of,sort)}}]);return Decoration}(RangeValue);Decoration.none=RangeSet.empty;var MarkDecoration=function(_Decoration){_inherits2(MarkDecoration,_Decoration);var _super79=_createSuper(MarkDecoration);function MarkDecoration(spec){var _this186;_classCallCheck2(this,MarkDecoration);var _getInclusive2=getInclusive(spec),start=_getInclusive2.start,end=_getInclusive2.end;_this186=_super79.call(this,start?-1:500000000,end?1:-600000000,null,spec);_this186.tagName=spec.tagName||"span";_this186["class"]=spec["class"]||"";_this186.attrs=spec.attributes||null;return _this186}_createClass2(MarkDecoration,[{key:"eq",value:function eq(other){var _a,_b;return this==other||other instanceof MarkDecoration&&this.tagName==other.tagName&&(this["class"]||((_a=this.attrs)===null||_a===void 0?void 0:_a["class"]))==(other["class"]||((_b=other.attrs)===null||_b===void 0?void 0:_b["class"]))&&attrsEq(this.attrs,other.attrs,"class")}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(from>=to)throw new RangeError("Mark decorations may not be empty");return _get5(_getPrototypeOf(MarkDecoration.prototype),"range",this).call(this,from,to)}}]);return MarkDecoration}(Decoration);MarkDecoration.prototype.point=false;var LineDecoration=function(_Decoration2){_inherits2(LineDecoration,_Decoration2);var _super80=_createSuper(LineDecoration);function LineDecoration(spec){_classCallCheck2(this,LineDecoration);return _super80.call(this,-200000000,-200000000,null,spec)}_createClass2(LineDecoration,[{key:"eq",value:function eq(other){return other instanceof LineDecoration&&this.spec["class"]==other.spec["class"]&&attrsEq(this.spec.attributes,other.spec.attributes)}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return _get5(_getPrototypeOf(LineDecoration.prototype),"range",this).call(this,from,to)}}]);return LineDecoration}(Decoration);LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=true;var PointDecoration=function(_Decoration3){_inherits2(PointDecoration,_Decoration3);var _super81=_createSuper(PointDecoration);function PointDecoration(spec,startSide,endSide,block,widget,isReplace){var _this187;_classCallCheck2(this,PointDecoration);_this187=_super81.call(this,startSide,endSide,widget,spec);_this187.block=block;_this187.isReplace=isReplace;_this187.mapMode=!block?MapMode.TrackDel:startSide<=0?MapMode.TrackBefore:MapMode.TrackAfter;return _this187}_createClass2(PointDecoration,[{key:"type",get:function get(){return this.startSide!=this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}},{key:"heightRelevant",get:function get(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}},{key:"eq",value:function eq(other){return other instanceof PointDecoration&&widgetsEq(this.widget,other.widget)&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(this.isReplace&&(from>to||from==to&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return _get5(_getPrototypeOf(PointDecoration.prototype),"range",this).call(this,from,to)}}]);return PointDecoration}(Decoration);PointDecoration.prototype.point=true;function getInclusive(spec){var block=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var start=spec.inclusiveStart,end=spec.inclusiveEnd;if(start==null)start=spec.inclusive;if(end==null)end=spec.inclusive;return{start:start!==null&&start!==void 0?start:block,end:end!==null&&end!==void 0?end:block}}function widgetsEq(a,b){return a==b||!!(a&&b&&a.compare(b))}function addRange(from,to,ranges){var margin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var last=ranges.length-1;if(last>=0&&ranges[last]+margin>=from)ranges[last]=Math.max(ranges[last],to);else ranges.push(from,to)}var ContentBuilder=function(){function ContentBuilder(doc,pos,end,disallowBlockEffectsFor){_classCallCheck2(this,ContentBuilder);this.doc=doc;this.pos=pos;this.end=end;this.disallowBlockEffectsFor=disallowBlockEffectsFor;this.content=[];this.curLine=null;this.breakAtStart=0;this.pendingBuffer=0;this.bufferMarks=[];this.atCursorPos=true;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=doc.iter();this.skip=pos}_createClass2(ContentBuilder,[{key:"posCovered",value:function posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var last=this.content[this.content.length-1];return!(last.breakAfter||last instanceof BlockWidgetView&&last.deco.endSide<0)}},{key:"getLine",value:function getLine(){if(!this.curLine){this.content.push(this.curLine=new LineView);this.atCursorPos=true}return this.curLine}},{key:"flushBuffer",value:function flushBuffer(){var active=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.bufferMarks;if(this.pendingBuffer){this.curLine.append(wrapMarks(new WidgetBufferView(-1),active),active.length);this.pendingBuffer=0}}},{key:"addBlockWidget",value:function addBlockWidget(view){this.flushBuffer();this.curLine=null;this.content.push(view)}},{key:"finish",value:function finish(openEnd){if(this.pendingBuffer&&openEnd<=this.bufferMarks.length)this.flushBuffer();else this.pendingBuffer=0;if(!this.posCovered()&&!(openEnd&&this.content.length&&this.content[this.content.length-1]instanceof BlockWidgetView))this.getLine()}},{key:"buildText",value:function buildText(length,active,openStart){while(length>0){if(this.textOff==this.text.length){var _this$cursor$next2=this.cursor.next(this.skip),value=_this$cursor$next2.value,lineBreak=_this$cursor$next2.lineBreak,done=_this$cursor$next2.done;this.skip=0;if(done)throw new Error("Ran out of text content when drawing inline views");if(lineBreak){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.flushBuffer();this.curLine=null;this.atCursorPos=true;length--;continue}else{this.text=value;this.textOff=0}}var take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active.slice(active.length-openStart));this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+take)),active),openStart);this.atCursorPos=true;this.textOff+=take;length-=take;openStart=0}}},{key:"span",value:function span(from,to,active,openStart){this.buildText(to-from,active,openStart);this.pos=to;if(this.openStart<0)this.openStart=openStart}},{key:"point",value:function point(from,to,deco,active,openStart,index){if(this.disallowBlockEffectsFor[index]&&deco instanceof PointDecoration){if(deco.block)throw new RangeError("Block decorations may not be specified via plugins");if(to>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}var len=to-from;if(deco instanceof PointDecoration){if(deco.block){if(deco.startSide>0&&!this.posCovered())this.getLine();this.addBlockWidget(new BlockWidgetView(deco.widget||new NullWidget("div"),len,deco))}else{var view=WidgetView.create(deco.widget||new NullWidget("span"),len,len?0:deco.startSide);var cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||deco.startSide>0);var cursorAfter=!view.isEditable&&(from<to||openStart>active.length||deco.startSide<=0);var line=this.getLine();if(this.pendingBuffer==2&&!cursorBefore&&!view.isEditable)this.pendingBuffer=0;this.flushBuffer(active);if(cursorBefore){line.append(wrapMarks(new WidgetBufferView(1),active),openStart);openStart=active.length+Math.max(0,openStart-active.length)}line.append(wrapMarks(view,active),openStart);this.atCursorPos=cursorAfter;this.pendingBuffer=!cursorAfter?0:from<to||openStart>active.length?1:2;if(this.pendingBuffer)this.bufferMarks=active.slice()}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(deco)}if(len){if(this.textOff+len<=this.text.length){this.textOff+=len}else{this.skip+=len-(this.text.length-this.textOff);this.text="";this.textOff=0}this.pos=to}if(this.openStart<0)this.openStart=openStart}}],[{key:"build",value:function build(text,from,to,decorations,dynamicDecorationMap){var builder=new ContentBuilder(text,from,to,dynamicDecorationMap);builder.openEnd=RangeSet.spans(decorations,from,to,builder);if(builder.openStart<0)builder.openStart=builder.openEnd;builder.finish(builder.openEnd);return builder}}]);return ContentBuilder}();function wrapMarks(view,active){var _iterator230=_createForOfIteratorHelper(active),_step230;try{for(_iterator230.s();!(_step230=_iterator230.n()).done;){var mark=_step230.value;view=new MarkView(mark,[view],view.length)}}catch(err){_iterator230.e(err)}finally{_iterator230.f()}return view}var NullWidget=function(_WidgetType){_inherits2(NullWidget,_WidgetType);var _super82=_createSuper(NullWidget);function NullWidget(tag){var _this188;_classCallCheck2(this,NullWidget);_this188=_super82.call(this);_this188.tag=tag;return _this188}_createClass2(NullWidget,[{key:"eq",value:function eq(other){return other.tag==this.tag}},{key:"toDOM",value:function toDOM(){return document.createElement(this.tag)}},{key:"updateDOM",value:function updateDOM(elt){return elt.nodeName.toLowerCase()==this.tag}},{key:"isHidden",get:function get(){return true}}]);return NullWidget}(WidgetType);var Direction=function(Direction){Direction[Direction["LTR"]=0]="LTR";Direction[Direction["RTL"]=1]="RTL";return Direction}(Direction||(Direction={}));var LTR=Direction.LTR,RTL=Direction.RTL;function dec(str){var result=[];for(var _i161=0;_i161<str.length;_i161++)result.push(1<<+str[_i161]);return result}var LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var Brackets=Object.create(null),BracketStack=[];for(var _i162=0,_arr4=["()","[]","{}"];_i162<_arr4.length;_i162++){var p=_arr4[_i162];var l=p.charCodeAt(0),r=p.charCodeAt(1);Brackets[l]=r;Brackets[r]=-l}function charType(ch){return ch<=247?LowTypes[ch]:1424<=ch&&ch<=1524?2:1536<=ch&&ch<=1785?ArabicTypes[ch-1536]:1774<=ch&&ch<=2220?4:8192<=ch&&ch<=8204?256:64336<=ch&&ch<=65023?4:1}var BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;var BidiSpan=function(){function BidiSpan(from,to,level){_classCallCheck2(this,BidiSpan);this.from=from;this.to=to;this.level=level}_createClass2(BidiSpan,[{key:"dir",get:function get(){return this.level%2?RTL:LTR}},{key:"side",value:function side(end,dir){return this.dir==dir==end?this.to:this.from}},{key:"forward",value:function forward(_forward,dir){return _forward==(this.dir==dir)}}],[{key:"find",value:function find(order,index,level,assoc){var maybe=-1;for(var _i163=0;_i163<order.length;_i163++){var span=order[_i163];if(span.from<=index&&span.to>=index){if(span.level==level)return _i163;if(maybe<0||(assoc!=0?assoc<0?span.from<index:span.to>index:order[maybe].level>span.level))maybe=_i163}}if(maybe<0)throw new RangeError("Index out of range");return maybe}}]);return BidiSpan}();function isolatesEq(a,b){if(a.length!=b.length)return false;for(var _i164=0;_i164<a.length;_i164++){var iA=a[_i164],iB=b[_i164];if(iA.from!=iB.from||iA.to!=iB.to||iA.direction!=iB.direction||!isolatesEq(iA.inner,iB.inner))return false}return true}var types=[];function computeCharTypes(line,rFrom,rTo,isolates,outerType){for(var iI=0;iI<=isolates.length;iI++){var from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo;var prevType=iI?256:outerType;for(var _i165=from,prev=prevType,prevStrong=prevType;_i165<to;_i165++){var type=charType(line.charCodeAt(_i165));if(type==512)type=prev;else if(type==8&&prevStrong==4)type=16;types[_i165]=type==4?2:type;if(type&7)prevStrong=type;prev=type}for(var _i166=from,_prev=prevType,_prevStrong=prevType;_i166<to;_i166++){var _type2=types[_i166];if(_type2==128){if(_i166<to-1&&_prev==types[_i166+1]&&_prev&24)_type2=types[_i166]=_prev;else types[_i166]=256}else if(_type2==64){var _end22=_i166+1;while(_end22<to&&types[_end22]==64)_end22++;var replace=_i166&&_prev==8||_end22<rTo&&types[_end22]==8?_prevStrong==1?1:8:256;for(var j=_i166;j<_end22;j++)types[j]=replace;_i166=_end22-1}else if(_type2==8&&_prevStrong==1){types[_i166]=1}_prev=_type2;if(_type2&7)_prevStrong=_type2}}}function processBracketPairs(line,rFrom,rTo,isolates,outerType){var oppositeType=outerType==1?2:1;for(var iI=0,sI=0,context=0;iI<=isolates.length;iI++){var from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo;for(var _i167=from,ch,br,type;_i167<to;_i167++){if(br=Brackets[ch=line.charCodeAt(_i167)]){if(br<0){for(var sJ=sI-3;sJ>=0;sJ-=3){if(BracketStack[sJ+1]==-br){var flags=BracketStack[sJ+2];var _type3=flags&2?outerType:!(flags&4)?0:flags&1?oppositeType:outerType;if(_type3)types[_i167]=types[BracketStack[sJ]]=_type3;sI=sJ;break}}}else if(BracketStack.length==189){break}else{BracketStack[sI++]=_i167;BracketStack[sI++]=ch;BracketStack[sI++]=context}}else if((type=types[_i167])==2||type==1){var embed=type==outerType;context=embed?0:1;for(var _sJ=sI-3;_sJ>=0;_sJ-=3){var _cur9=BracketStack[_sJ+2];if(_cur9&2)break;if(embed){BracketStack[_sJ+2]|=2}else{if(_cur9&4)break;BracketStack[_sJ+2]|=4}}}}}}function processNeutrals(rFrom,rTo,isolates,outerType){for(var iI=0,prev=outerType;iI<=isolates.length;iI++){var from=iI?isolates[iI-1].to:rFrom,to=iI<isolates.length?isolates[iI].from:rTo;for(var _i168=from;_i168<to;){var type=types[_i168];if(type==256){var _end23=_i168+1;for(;;){if(_end23==to){if(iI==isolates.length)break;_end23=isolates[iI++].to;to=iI<isolates.length?isolates[iI].from:rTo}else if(types[_end23]==256){_end23++}else{break}}var beforeL=prev==1;var afterL=(_end23<rTo?types[_end23]:outerType)==1;var replace=beforeL==afterL?beforeL?1:2:outerType;for(var j=_end23,jI=iI,fromJ=jI?isolates[jI-1].to:rFrom;j>_i168;){if(j==fromJ){j=isolates[--jI].from;fromJ=jI?isolates[jI-1].to:rFrom}types[--j]=replace}_i168=_end23}else{prev=type;_i168++}}}}function emitSpans(line,from,to,level,baseLevel,isolates,order){var ourType=level%2?2:1;if(level%2==baseLevel%2){for(var iCh=from,iI=0;iCh<to;){var sameDir=true,isNum=false;if(iI==isolates.length||iCh<isolates[iI].from){var next=types[iCh];if(next!=ourType){sameDir=false;isNum=next==16}}var recurse=!sameDir&&ourType==1?[]:null;var localLevel=sameDir?level:level+1;var iScan=iCh;run:for(;;){if(iI<isolates.length&&iScan==isolates[iI].from){if(isNum)break run;var iso=isolates[iI];if(!sameDir)for(var upto=iso.to,jI=iI+1;;){if(upto==to)break run;if(jI<isolates.length&&isolates[jI].from==upto)upto=isolates[jI++].to;else if(types[upto]==ourType)break run;else break}iI++;if(recurse){recurse.push(iso)}else{if(iso.from>iCh)order.push(new BidiSpan(iCh,iso.from,localLevel));var dirSwap=iso.direction==LTR!=!(localLevel%2);computeSectionOrder(line,dirSwap?level+1:level,baseLevel,iso.inner,iso.from,iso.to,order);iCh=iso.to}iScan=iso.to}else if(iScan==to||(sameDir?types[iScan]!=ourType:types[iScan]==ourType)){break}else{iScan++}}if(recurse)emitSpans(line,iCh,iScan,level+1,baseLevel,recurse,order);else if(iCh<iScan)order.push(new BidiSpan(iCh,iScan,localLevel));iCh=iScan}}else{for(var _iCh=to,_iI=isolates.length;_iCh>from;){var _sameDir=true,_isNum=false;if(!_iI||_iCh>isolates[_iI-1].to){var _next4=types[_iCh-1];if(_next4!=ourType){_sameDir=false;_isNum=_next4==16}}var _recurse=!_sameDir&&ourType==1?[]:null;var _localLevel=_sameDir?level:level+1;var _iScan=_iCh;run:for(;;){if(_iI&&_iScan==isolates[_iI-1].to){if(_isNum)break run;var _iso=isolates[--_iI];if(!_sameDir)for(var _upto=_iso.from,_jI=_iI;;){if(_upto==from)break run;if(_jI&&isolates[_jI-1].to==_upto)_upto=isolates[--_jI].from;else if(types[_upto-1]==ourType)break run;else break}if(_recurse){_recurse.push(_iso)}else{if(_iso.to<_iCh)order.push(new BidiSpan(_iso.to,_iCh,_localLevel));var _dirSwap=_iso.direction==LTR!=!(_localLevel%2);computeSectionOrder(line,_dirSwap?level+1:level,baseLevel,_iso.inner,_iso.from,_iso.to,order);_iCh=_iso.from}_iScan=_iso.from}else if(_iScan==from||(_sameDir?types[_iScan-1]!=ourType:types[_iScan-1]==ourType)){break}else{_iScan--}}if(_recurse)emitSpans(line,_iScan,_iCh,level+1,baseLevel,_recurse,order);else if(_iScan<_iCh)order.push(new BidiSpan(_iScan,_iCh,_localLevel));_iCh=_iScan}}}function computeSectionOrder(line,level,baseLevel,isolates,from,to,order){var outerType=level%2?2:1;computeCharTypes(line,from,to,isolates,outerType);processBracketPairs(line,from,to,isolates,outerType);processNeutrals(from,to,isolates,outerType);emitSpans(line,from,to,level,baseLevel,isolates,order)}function computeOrder(line,direction,isolates){if(!line)return[new BidiSpan(0,0,direction==RTL?1:0)];if(direction==LTR&&!isolates.length&&!BidiRE.test(line))return trivialOrder(line.length);if(isolates.length)while(line.length>types.length)types[types.length]=256;var order=[],level=direction==LTR?0:1;computeSectionOrder(line,level,level,isolates,0,line.length,order);return order}function trivialOrder(length){return[new BidiSpan(0,length,0)]}var movedOver="";function moveVisually(line,order,dir,start,forward){var _a;var startIndex=start.head-line.from;var spanI=BidiSpan.find(order,startIndex,(_a=start.bidiLevel)!==null&&_a!==void 0?_a:-1,start.assoc);var span=order[spanI],spanEnd=span.side(forward,dir);if(startIndex==spanEnd){var nextI=spanI+=forward?1:-1;if(nextI<0||nextI>=order.length)return null;span=order[spanI=nextI];startIndex=span.side(!forward,dir);spanEnd=span.side(forward,dir)}var nextIndex=findClusterBreak(line.text,startIndex,span.forward(forward,dir));if(nextIndex<span.from||nextIndex>span.to)nextIndex=spanEnd;movedOver=line.text.slice(Math.min(startIndex,nextIndex),Math.max(startIndex,nextIndex));var nextSpan=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)];if(nextSpan&&nextIndex==spanEnd&&nextSpan.level+(forward?0:1)<span.level)return EditorSelection.cursor(nextSpan.side(!forward,dir)+line.from,nextSpan.forward(forward,dir)?1:-1,nextSpan.level);return EditorSelection.cursor(nextIndex+line.from,span.forward(forward,dir)?-1:1,span.level)}function autoDirection(text,from,to){for(var _i169=from;_i169<to;_i169++){var type=charType(text.charCodeAt(_i169));if(type==1)return LTR;if(type==2||type==4)return RTL}return LTR}var clickAddsSelectionRange=Facet.define();var dragMovesSelection$1=Facet.define();var mouseSelectionStyle=Facet.define();var exceptionSink=Facet.define();var updateListener=Facet.define();var inputHandler$1=Facet.define();var focusChangeEffect=Facet.define();var perLineTextDirection=Facet.define({combine:function combine(values){return values.some(function(x){return x})}});var nativeSelectionHidden=Facet.define({combine:function combine(values){return values.some(function(x){return x})}});var ScrollTarget=function(){function ScrollTarget(range){var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"nearest";var x=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"nearest";var yMargin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;var xMargin=arguments.length>4&&arguments[4]!==undefined?arguments[4]:5;var isSnapshot=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;_classCallCheck2(this,ScrollTarget);this.range=range;this.y=y;this.x=x;this.yMargin=yMargin;this.xMargin=xMargin;this.isSnapshot=isSnapshot}_createClass2(ScrollTarget,[{key:"map",value:function map(changes){return changes.empty?this:new ScrollTarget(this.range.map(changes),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}},{key:"clip",value:function clip(state){return this.range.to<=state.doc.length?this:new ScrollTarget(EditorSelection.cursor(state.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}]);return ScrollTarget}();var scrollIntoView$1=StateEffect.define({map:function map(t,ch){return t.map(ch)}});function logException(state,exception,context){var handler=state.facet(exceptionSink);if(handler.length)handler[0](exception);else if(window.onerror)window.onerror(String(exception),context,undefined,undefined,exception);else if(context)console.error(context+":",exception);else console.error(exception)}var editable=Facet.define({combine:function combine(values){return values.length?values[0]:true}});var nextPluginID=0;var viewPlugin=Facet.define();var ViewPlugin=function(){function ViewPlugin(id,create,domEventHandlers,domEventObservers,buildExtensions){_classCallCheck2(this,ViewPlugin);this.id=id;this.create=create;this.domEventHandlers=domEventHandlers;this.domEventObservers=domEventObservers;this.extension=buildExtensions(this)}_createClass2(ViewPlugin,null,[{key:"define",value:function define(create,spec){var _ref220=spec||{},eventHandlers=_ref220.eventHandlers,eventObservers=_ref220.eventObservers,provide=_ref220.provide,deco=_ref220.decorations;return new ViewPlugin(nextPluginID++,create,eventHandlers,eventObservers,function(plugin){var ext=[viewPlugin.of(plugin)];if(deco)ext.push(decorations.of(function(view){var pluginInst=view.plugin(plugin);return pluginInst?deco(pluginInst):Decoration.none}));if(provide)ext.push(provide(plugin));return ext})}},{key:"fromClass",value:function fromClass(cls,spec){return ViewPlugin.define(function(view){return new cls(view)},spec)}}]);return ViewPlugin}();var PluginInstance=function(){function PluginInstance(spec){_classCallCheck2(this,PluginInstance);this.spec=spec;this.mustUpdate=null;this.value=null}_createClass2(PluginInstance,[{key:"update",value:function update(view){if(!this.value){if(this.spec){try{this.value=this.spec.create(view)}catch(e){logException(view.state,e,"CodeMirror plugin crashed");this.deactivate()}}}else if(this.mustUpdate){var update=this.mustUpdate;this.mustUpdate=null;if(this.value.update){try{this.value.update(update)}catch(e){logException(update.state,e,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy()}catch(_){}this.deactivate()}}}return this}},{key:"destroy",value:function destroy(view){var _a;if((_a=this.value)===null||_a===void 0?void 0:_a.destroy){try{this.value.destroy()}catch(e){logException(view.state,e,"CodeMirror plugin crashed")}}}},{key:"deactivate",value:function deactivate(){this.spec=this.value=null}}]);return PluginInstance}();var editorAttributes=Facet.define();var contentAttributes=Facet.define();var decorations=Facet.define();var outerDecorations=Facet.define();var atomicRanges=Facet.define();var bidiIsolatedRanges=Facet.define();function getIsolatedRanges(view,line){var isolates=view.state.facet(bidiIsolatedRanges);if(!isolates.length)return isolates;var sets=isolates.map(function(i){return i instanceof Function?i(view):i});var result=[];RangeSet.spans(sets,line.from,line.to,{point:function point(){},span:function span(fromDoc,toDoc,active,open){var from=fromDoc-line.from,to=toDoc-line.from;var level=result;for(var _i170=active.length-1;_i170>=0;_i170--,open--){var direction=active[_i170].spec.bidiIsolate,update=void 0;if(direction==null)direction=autoDirection(line.text,from,to);if(open>0&&level.length&&(update=level[level.length-1]).to==from&&update.direction==direction){update.to=to;level=update.inner}else{var _add={from:from,to:to,direction:direction,inner:[]};level.push(_add);level=_add.inner}}}});return result}var scrollMargins=Facet.define();function getScrollMargins(view){var left=0,right=0,top=0,bottom=0;var _iterator231=_createForOfIteratorHelper(view.state.facet(scrollMargins)),_step231;try{for(_iterator231.s();!(_step231=_iterator231.n()).done;){var source=_step231.value;var m=source(view);if(m){if(m.left!=null)left=Math.max(left,m.left);if(m.right!=null)right=Math.max(right,m.right);if(m.top!=null)top=Math.max(top,m.top);if(m.bottom!=null)bottom=Math.max(bottom,m.bottom)}}}catch(err){_iterator231.e(err)}finally{_iterator231.f()}return{left:left,right:right,top:top,bottom:bottom}}var styleModule=Facet.define();var ChangedRange=function(){function ChangedRange(fromA,toA,fromB,toB){_classCallCheck2(this,ChangedRange);this.fromA=fromA;this.toA=toA;this.fromB=fromB;this.toB=toB}_createClass2(ChangedRange,[{key:"join",value:function join(other){return new ChangedRange(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB))}},{key:"addToSet",value:function addToSet(set){var i=set.length,me=this;for(;i>0;i--){var range=set[i-1];if(range.fromA>me.toA)continue;if(range.toA<me.fromA)break;me=me.join(range);set.splice(i-1,1)}set.splice(i,0,me);return set}}],[{key:"extendWithRanges",value:function extendWithRanges(diff,ranges){if(ranges.length==0)return diff;var result=[];for(var dI=0,rI=0,posA=0,posB=0;;dI++){var next=dI==diff.length?null:diff[dI],off=posA-posB;var _end24=next?next.fromB:1e9;while(rI<ranges.length&&ranges[rI]<_end24){var from=ranges[rI],to=ranges[rI+1];var fromB=Math.max(posB,from),toB=Math.min(_end24,to);if(fromB<=toB)new ChangedRange(fromB+off,toB+off,fromB,toB).addToSet(result);if(to>_end24)break;else rI+=2}if(!next)return result;new ChangedRange(next.fromA,next.toA,next.fromB,next.toB).addToSet(result);posA=next.toA;posB=next.toB}}}]);return ChangedRange}();var ViewUpdate=function(){function ViewUpdate(view,state,transactions){_classCallCheck2(this,ViewUpdate);this.view=view;this.state=state;this.transactions=transactions;this.flags=0;this.startState=view.state;this.changes=ChangeSet.empty(this.startState.doc.length);var _iterator232=_createForOfIteratorHelper(transactions),_step232;try{for(_iterator232.s();!(_step232=_iterator232.n()).done;){var tr=_step232.value;this.changes=this.changes.compose(tr.changes)}}catch(err){_iterator232.e(err)}finally{_iterator232.f()}var changedRanges=[];this.changes.iterChangedRanges(function(fromA,toA,fromB,toB){return changedRanges.push(new ChangedRange(fromA,toA,fromB,toB))});this.changedRanges=changedRanges}_createClass2(ViewUpdate,[{key:"viewportChanged",get:function get(){return(this.flags&4)>0}},{key:"heightChanged",get:function get(){return(this.flags&2)>0}},{key:"geometryChanged",get:function get(){return this.docChanged||(this.flags&(8|2))>0}},{key:"focusChanged",get:function get(){return(this.flags&1)>0}},{key:"docChanged",get:function get(){return!this.changes.empty}},{key:"selectionSet",get:function get(){return this.transactions.some(function(tr){return tr.selection})}},{key:"empty",get:function get(){return this.flags==0&&this.transactions.length==0}}],[{key:"create",value:function create(view,state,transactions){return new ViewUpdate(view,state,transactions)}}]);return ViewUpdate}();var DocView=function(_ContentView7){_inherits2(DocView,_ContentView7);var _super83=_createSuper(DocView);function DocView(view){var _this189;_classCallCheck2(this,DocView);_this189=_super83.call(this);_this189.view=view;_this189.decorations=[];_this189.dynamicDecorationMap=[];_this189.domChanged=null;_this189.hasComposition=null;_this189.markedForComposition=new Set;_this189.minWidth=0;_this189.minWidthFrom=0;_this189.minWidthTo=0;_this189.impreciseAnchor=null;_this189.impreciseHead=null;_this189.forceSelection=false;_this189.lastUpdate=Date.now();_this189.setDOM(view.contentDOM);_this189.children=[new LineView];_this189.children[0].setParent(_assertThisInitialized(_this189));_this189.updateDeco();_this189.updateInner([new ChangedRange(0,0,0,view.state.doc.length)],0,null);return _this189}_createClass2(DocView,[{key:"length",get:function get(){return this.view.state.doc.length}},{key:"update",value:function update(_update){var _this190=this;var _a;var changedRanges=_update.changedRanges;if(this.minWidth>0&&changedRanges.length){if(!changedRanges.every(function(_ref221){var fromA=_ref221.fromA,toA=_ref221.toA;return toA<_this190.minWidthFrom||fromA>_this190.minWidthTo})){this.minWidth=this.minWidthFrom=this.minWidthTo=0}else{this.minWidthFrom=_update.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=_update.changes.mapPos(this.minWidthTo,1)}}var readCompositionAt=-1;if(this.view.inputState.composing>=0){if((_a=this.domChanged)===null||_a===void 0?void 0:_a.newSel)readCompositionAt=this.domChanged.newSel.head;else if(!touchesComposition(_update.changes,this.hasComposition)&&!_update.selectionSet)readCompositionAt=_update.state.selection.main.head}var composition=readCompositionAt>-1?findCompositionRange(this.view,_update.changes,readCompositionAt):null;this.domChanged=null;if(this.hasComposition){this.markedForComposition.clear();var _this$hasComposition=this.hasComposition,from=_this$hasComposition.from,to=_this$hasComposition.to;changedRanges=new ChangedRange(from,to,_update.changes.mapPos(from,-1),_update.changes.mapPos(to,1)).addToSet(changedRanges.slice())}this.hasComposition=composition?{from:composition.range.fromB,to:composition.range.toB}:null;if((browser.ie||browser.chrome)&&!composition&&_update&&_update.state.doc.lines!=_update.startState.doc.lines)this.forceSelection=true;var prevDeco=this.decorations,deco=this.updateDeco();var decoDiff=findChangedDeco(prevDeco,deco,_update.changes);changedRanges=ChangedRange.extendWithRanges(changedRanges,decoDiff);if(!(this.flags&7)&&changedRanges.length==0){return false}else{this.updateInner(changedRanges,_update.startState.doc.length,composition);if(_update.transactions.length)this.lastUpdate=Date.now();return true}}},{key:"updateInner",value:function updateInner(changes,oldLength,composition){var _this191=this;this.view.viewState.mustMeasureContent=true;this.updateChildren(changes,oldLength,composition);var observer=this.view.observer;observer.ignore(function(){_this191.dom.style.height=_this191.view.viewState.contentHeight/_this191.view.scaleY+"px";_this191.dom.style.flexBasis=_this191.minWidth?_this191.minWidth+"px":"";var track=browser.chrome||browser.ios?{node:observer.selectionRange.focusNode,written:false}:undefined;_this191.sync(_this191.view,track);_this191.flags&=~7;if(track&&(track.written||observer.selectionRange.focusNode!=track.node))_this191.forceSelection=true;_this191.dom.style.height=""});this.markedForComposition.forEach(function(cView){return cView.flags&=~8});var gaps=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length){var _iterator233=_createForOfIteratorHelper(this.children),_step233;try{for(_iterator233.s();!(_step233=_iterator233.n()).done;){var child=_step233.value;if(child instanceof BlockWidgetView&&child.widget instanceof BlockGapWidget)gaps.push(child.dom)}}catch(err){_iterator233.e(err)}finally{_iterator233.f()}}observer.updateGaps(gaps)}},{key:"updateChildren",value:function updateChildren(changes,oldLength,composition){var ranges=composition?composition.range.addToSet(changes.slice()):changes;var cursor=this.childCursor(oldLength);for(var _i171=ranges.length-1;;_i171--){var next=_i171>=0?ranges[_i171]:null;if(!next)break;var fromA=next.fromA,toA=next.toA,fromB=next.fromB,toB=next.toB,_content6=void 0,breakAtStart=void 0,openStart=void 0,openEnd=void 0;if(composition&&composition.range.fromB<toB&&composition.range.toB>fromB){var _before=ContentBuilder.build(this.view.state.doc,fromB,composition.range.fromB,this.decorations,this.dynamicDecorationMap);var _after2=ContentBuilder.build(this.view.state.doc,composition.range.toB,toB,this.decorations,this.dynamicDecorationMap);breakAtStart=_before.breakAtStart;openStart=_before.openStart;openEnd=_after2.openEnd;var compLine=this.compositionView(composition);if(_after2.breakAtStart){compLine.breakAfter=1}else if(_after2.content.length&&compLine.merge(compLine.length,compLine.length,_after2.content[0],false,_after2.openStart,0)){compLine.breakAfter=_after2.content[0].breakAfter;_after2.content.shift()}if(_before.content.length&&compLine.merge(0,0,_before.content[_before.content.length-1],true,0,_before.openEnd)){_before.content.pop()}_content6=_before.content.concat(compLine).concat(_after2.content)}else{var _ContentBuilder$build=ContentBuilder.build(this.view.state.doc,fromB,toB,this.decorations,this.dynamicDecorationMap);_content6=_ContentBuilder$build.content;breakAtStart=_ContentBuilder$build.breakAtStart;openStart=_ContentBuilder$build.openStart;openEnd=_ContentBuilder$build.openEnd}var _cursor$findPos=cursor.findPos(toA,1),toI=_cursor$findPos.i,toOff=_cursor$findPos.off;var _cursor$findPos2=cursor.findPos(fromA,-1),fromI=_cursor$findPos2.i,fromOff=_cursor$findPos2.off;replaceRange(this,fromI,fromOff,toI,toOff,_content6,breakAtStart,openStart,openEnd)}if(composition)this.fixCompositionDOM(composition)}},{key:"compositionView",value:function compositionView(composition){var cur=new TextView(composition.text.nodeValue);cur.flags|=8;var _iterator234=_createForOfIteratorHelper(composition.marks),_step234;try{for(_iterator234.s();!(_step234=_iterator234.n()).done;){var deco=_step234.value.deco;cur=new MarkView(deco,[cur],cur.length)}}catch(err){_iterator234.e(err)}finally{_iterator234.f()}var line=new LineView;line.append(cur,0);return line}},{key:"fixCompositionDOM",value:function fixCompositionDOM(composition){var _this192=this;var fix=function fix(dom,cView){cView.flags|=8|(cView.children.some(function(c){return c.flags&7})?1:0);_this192.markedForComposition.add(cView);var prev=ContentView.get(dom);if(prev&&prev!=cView)prev.dom=null;cView.setDOM(dom)};var pos=this.childPos(composition.range.fromB,1);var cView=this.children[pos.i];fix(composition.line,cView);for(var _i172=composition.marks.length-1;_i172>=-1;_i172--){pos=cView.childPos(pos.off,1);cView=cView.children[pos.i];fix(_i172>=0?composition.marks[_i172].node:composition.text,cView)}}},{key:"updateSelection",value:function updateSelection(){var _this193=this;var mustRead=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var fromPointer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(mustRead||!this.view.observer.selectionRange.focusNode)this.view.observer.readSelectionRange();var activeElt=this.view.root.activeElement,focused=activeElt==this.dom;var selectionNotFocus=!focused&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(activeElt&&this.dom.contains(activeElt));if(!(focused||fromPointer||selectionNotFocus))return;var force=this.forceSelection;this.forceSelection=false;var main=this.view.state.selection.main;var anchor=this.moveToLine(this.domAtPos(main.anchor));var head=main.empty?anchor:this.moveToLine(this.domAtPos(main.head));if(browser.gecko&&main.empty&&!this.hasComposition&&betweenUneditable(anchor)){var dummy=document.createTextNode("");this.view.observer.ignore(function(){return anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null)});anchor=head=new DOMPos(dummy,0);force=true}var domSel=this.view.observer.selectionRange;if(force||!domSel.focusNode||(!isEquivalentPosition(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)||!isEquivalentPosition(head.node,head.offset,domSel.focusNode,domSel.focusOffset))&&!this.suppressWidgetCursorChange(domSel,main)){this.view.observer.ignore(function(){if(browser.android&&browser.chrome&&_this193.dom.contains(domSel.focusNode)&&inUneditable(domSel.focusNode,_this193.dom)){_this193.dom.blur();_this193.dom.focus({preventScroll:true})}var rawSel=getSelection(_this193.view.root);if(!rawSel);else if(main.empty){if(browser.gecko){var nextTo=nextToUneditable(anchor.node,anchor.offset);if(nextTo&&nextTo!=(1|2)){var _text3=nearbyTextNode(anchor.node,anchor.offset,nextTo==1?1:-1);if(_text3)anchor=new DOMPos(_text3.node,_text3.offset)}}rawSel.collapse(anchor.node,anchor.offset);if(main.bidiLevel!=null&&rawSel.caretBidiLevel!==undefined)rawSel.caretBidiLevel=main.bidiLevel}else if(rawSel.extend){rawSel.collapse(anchor.node,anchor.offset);try{rawSel.extend(head.node,head.offset)}catch(_){}}else{var range=document.createRange();if(main.anchor>main.head){var _ref222=[head,anchor];anchor=_ref222[0];head=_ref222[1]}range.setEnd(head.node,head.offset);range.setStart(anchor.node,anchor.offset);rawSel.removeAllRanges();rawSel.addRange(range)}if(selectionNotFocus&&_this193.view.root.activeElement==_this193.dom){_this193.dom.blur();if(activeElt)activeElt.focus()}});this.view.observer.setSelectionRange(anchor,head)}this.impreciseAnchor=anchor.precise?null:new DOMPos(domSel.anchorNode,domSel.anchorOffset);this.impreciseHead=head.precise?null:new DOMPos(domSel.focusNode,domSel.focusOffset)}},{key:"suppressWidgetCursorChange",value:function suppressWidgetCursorChange(sel,cursor){return this.hasComposition&&cursor.empty&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset)&&this.posFromDOM(sel.focusNode,sel.focusOffset)==cursor.head}},{key:"enforceCursorAssoc",value:function enforceCursorAssoc(){if(this.hasComposition)return;var view=this.view,cursor=view.state.selection.main;var sel=getSelection(view.root);var _view$observer$select=view.observer.selectionRange,anchorNode=_view$observer$select.anchorNode,anchorOffset=_view$observer$select.anchorOffset;if(!sel||!cursor.empty||!cursor.assoc||!sel.modify)return;var line=LineView.find(this,cursor.head);if(!line)return;var lineStart=line.posAtStart;if(cursor.head==lineStart||cursor.head==lineStart+line.length)return;var before=this.coordsAt(cursor.head,-1),after=this.coordsAt(cursor.head,1);if(!before||!after||before.bottom>after.top)return;var dom=this.domAtPos(cursor.head+cursor.assoc);sel.collapse(dom.node,dom.offset);sel.modify("move",cursor.assoc<0?"forward":"backward","lineboundary");view.observer.readSelectionRange();var newRange=view.observer.selectionRange;if(view.docView.posFromDOM(newRange.anchorNode,newRange.anchorOffset)!=cursor.from)sel.collapse(anchorNode,anchorOffset)}},{key:"moveToLine",value:function moveToLine(pos){var dom=this.dom,newPos;if(pos.node!=dom)return pos;for(var _i173=pos.offset;!newPos&&_i173<dom.childNodes.length;_i173++){var view=ContentView.get(dom.childNodes[_i173]);if(view instanceof LineView)newPos=view.domAtPos(0)}for(var _i174=pos.offset-1;!newPos&&_i174>=0;_i174--){var _view3=ContentView.get(dom.childNodes[_i174]);if(_view3 instanceof LineView)newPos=_view3.domAtPos(_view3.length)}return newPos?new DOMPos(newPos.node,newPos.offset,true):pos}},{key:"nearest",value:function nearest(dom){for(var _cur10=dom;_cur10;){var domView=ContentView.get(_cur10);if(domView&&domView.rootView==this)return domView;_cur10=_cur10.parentNode}return null}},{key:"posFromDOM",value:function posFromDOM(node,offset){var view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart}},{key:"domAtPos",value:function domAtPos(pos){var _this$childCursor$fin=this.childCursor().findPos(pos,-1),i=_this$childCursor$fin.i,off=_this$childCursor$fin.off;for(;i<this.children.length-1;){var child=this.children[i];if(off<child.length||child instanceof LineView)break;i++;off=0}return this.children[i].domAtPos(off)}},{key:"coordsAt",value:function coordsAt(pos,side){var best=null,bestPos=0;for(var off=this.length,_i175=this.children.length-1;_i175>=0;_i175--){var child=this.children[_i175],_end25=off-child.breakAfter,_start10=_end25-child.length;if(_end25<pos)break;if(_start10<=pos&&(_start10<pos||child.covers(-1))&&(_end25>pos||child.covers(1))&&(!best||child instanceof LineView&&!(best instanceof LineView&&side>=0))){best=child;bestPos=_start10}off=_start10}return best?best.coordsAt(pos-bestPos,side):null}},{key:"coordsForChar",value:function coordsForChar(pos){var _this$childPos2=this.childPos(pos,1),i=_this$childPos2.i,off=_this$childPos2.off,child=this.children[i];if(!(child instanceof LineView))return null;while(child.children.length){var _child$childPos=child.childPos(off,1),_i176=_child$childPos.i,childOff=_child$childPos.off;for(;;_i176++){if(_i176==child.children.length)return null;if((child=child.children[_i176]).length)break}off=childOff}if(!(child instanceof TextView))return null;var end=findClusterBreak(child.text,off);if(end==off)return null;var rects=textRange(child.dom,off,end).getClientRects();for(var _i177=0;_i177<rects.length;_i177++){var rect=rects[_i177];if(_i177==rects.length-1||rect.top<rect.bottom&&rect.left<rect.right)return rect}return null}},{key:"measureVisibleLineHeights",value:function measureVisibleLineHeights(viewport){var result=[],from=viewport.from,to=viewport.to;var contentWidth=this.view.contentDOM.clientWidth;var isWider=contentWidth>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;var widest=-1,ltr=this.view.textDirection==Direction.LTR;for(var pos=0,_i178=0;_i178<this.children.length;_i178++){var child=this.children[_i178],_end26=pos+child.length;if(_end26>to)break;if(pos>=from){var childRect=child.dom.getBoundingClientRect();result.push(childRect.height);if(isWider){var last=child.dom.lastChild;var rects=last?clientRectsFor(last):[];if(rects.length){var rect=rects[rects.length-1];var width=ltr?rect.right-childRect.left:childRect.right-rect.left;if(width>widest){widest=width;this.minWidth=contentWidth;this.minWidthFrom=pos;this.minWidthTo=_end26}}}}pos=_end26+child.breakAfter}return result}},{key:"textDirectionAt",value:function textDirectionAt(pos){var _this$childPos3=this.childPos(pos,1),i=_this$childPos3.i;return getComputedStyle(this.children[i].dom).direction=="rtl"?Direction.RTL:Direction.LTR}},{key:"measureTextSize",value:function measureTextSize(){var _this194=this;var _iterator235=_createForOfIteratorHelper(this.children),_step235;try{for(_iterator235.s();!(_step235=_iterator235.n()).done;){var child=_step235.value;if(child instanceof LineView){var measure=child.measureTextSize();if(measure)return measure}}}catch(err){_iterator235.e(err)}finally{_iterator235.f()}var dummy=document.createElement("div"),lineHeight,charWidth,textHeight;dummy.className="cm-line";dummy.style.width="99999px";dummy.style.position="absolute";dummy.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore(function(){_this194.dom.appendChild(dummy);var rect=clientRectsFor(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height;charWidth=rect?rect.width/27:7;textHeight=rect?rect.height:lineHeight;dummy.remove()});return{lineHeight:lineHeight,charWidth:charWidth,textHeight:textHeight}}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;var i=this.children.length;if(i)pos-=this.children[--i].length;return new ChildCursor(this.children,pos,i)}},{key:"computeBlockGapDeco",value:function computeBlockGapDeco(){var deco=[],vs=this.view.viewState;for(var pos=0,_i179=0;;_i179++){var next=_i179==vs.viewports.length?null:vs.viewports[_i179];var _end27=next?next.from-1:this.length;if(_end27>pos){var height=(vs.lineBlockAt(_end27).bottom-vs.lineBlockAt(pos).top)/this.view.scaleY;deco.push(Decoration.replace({widget:new BlockGapWidget(height),block:true,inclusive:true,isBlockGap:true}).range(pos,_end27))}if(!next)break;pos=next.to+1}return Decoration.set(deco)}},{key:"updateDeco",value:function updateDeco(){var _this195=this;var allDeco=this.view.state.facet(decorations).map(function(d,i){var dynamic=_this195.dynamicDecorationMap[i]=typeof d=="function";return dynamic?d(_this195.view):d});var dynamicOuter=false,outerDeco=this.view.state.facet(outerDecorations).map(function(d,i){var dynamic=typeof d=="function";if(dynamic)dynamicOuter=true;return dynamic?d(_this195.view):d});if(outerDeco.length){this.dynamicDecorationMap[allDeco.length]=dynamicOuter;allDeco.push(RangeSet.join(outerDeco))}for(var _i180=allDeco.length;_i180<allDeco.length+3;_i180++)this.dynamicDecorationMap[_i180]=false;return this.decorations=[].concat(_toConsumableArray2(allDeco),[this.computeBlockGapDeco(),this.view.viewState.lineGapDeco])}},{key:"scrollIntoView",value:function scrollIntoView(target){if(target.isSnapshot){var ref=this.view.viewState.lineBlockAt(target.range.head);this.view.scrollDOM.scrollTop=ref.top-target.yMargin;this.view.scrollDOM.scrollLeft=target.xMargin;return}var range=target.range;var rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1),other;if(!rect)return;if(!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1)))rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)};var margins=getScrollMargins(this.view);var targetRect={left:rect.left-margins.left,top:rect.top-margins.top,right:rect.right+margins.right,bottom:rect.bottom+margins.bottom};var _this$view$scrollDOM=this.view.scrollDOM,offsetWidth=_this$view$scrollDOM.offsetWidth,offsetHeight=_this$view$scrollDOM.offsetHeight;scrollRectIntoView(this.view.scrollDOM,targetRect,range.head<range.anchor?-1:1,target.x,target.y,Math.max(Math.min(target.xMargin,offsetWidth),-offsetWidth),Math.max(Math.min(target.yMargin,offsetHeight),-offsetHeight),this.view.textDirection==Direction.LTR)}}]);return DocView}(ContentView);function betweenUneditable(pos){return pos.node.nodeType==1&&pos.node.firstChild&&(pos.offset==0||pos.node.childNodes[pos.offset-1].contentEditable=="false")&&(pos.offset==pos.node.childNodes.length||pos.node.childNodes[pos.offset].contentEditable=="false")}var BlockGapWidget=function(_WidgetType2){_inherits2(BlockGapWidget,_WidgetType2);var _super84=_createSuper(BlockGapWidget);function BlockGapWidget(height){var _this196;_classCallCheck2(this,BlockGapWidget);_this196=_super84.call(this);_this196.height=height;return _this196}_createClass2(BlockGapWidget,[{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");elt.className="cm-gap";this.updateDOM(elt);return elt}},{key:"eq",value:function eq(other){return other.height==this.height}},{key:"updateDOM",value:function updateDOM(elt){elt.style.height=this.height+"px";return true}},{key:"editable",get:function get(){return true}},{key:"estimatedHeight",get:function get(){return this.height}}]);return BlockGapWidget}(WidgetType);function findCompositionNode(view,headPos){var sel=view.observer.selectionRange;var textNode=sel.focusNode&&nearbyTextNode(sel.focusNode,sel.focusOffset,0);if(!textNode)return null;var from=headPos-textNode.offset;return{from:from,to:from+textNode.node.nodeValue.length,node:textNode.node}}function findCompositionRange(view,changes,headPos){var found=findCompositionNode(view,headPos);if(!found)return null;var textNode=found.node,from=found.from,to=found.to,text=textNode.nodeValue;if(/[\n\r]/.test(text))return null;if(view.state.doc.sliceString(found.from,found.to)!=text)return null;var inv=changes.invertedDesc;var range=new ChangedRange(inv.mapPos(from),inv.mapPos(to),from,to);var marks=[];for(var parent=textNode.parentNode;;parent=parent.parentNode){var parentView=ContentView.get(parent);if(parentView instanceof MarkView)marks.push({node:parent,deco:parentView.mark});else if(parentView instanceof LineView||parent.nodeName=="DIV"&&parent.parentNode==view.contentDOM)return{range:range,text:textNode,marks:marks,line:parent};else if(parent!=view.contentDOM)marks.push({node:parent,deco:new MarkDecoration({inclusive:true,attributes:getAttrs$1(parent),tagName:parent.tagName.toLowerCase()})});else return null}}function nearbyTextNode(startNode,startOffset,side){if(side<=0)for(var node=startNode,_offset3=startOffset;;){if(node.nodeType==3)return{node:node,offset:_offset3};if(node.nodeType==1&&_offset3>0){node=node.childNodes[_offset3-1];_offset3=maxOffset(node)}else{break}}if(side>=0)for(var _node2=startNode,_offset4=startOffset;;){if(_node2.nodeType==3)return{node:_node2,offset:_offset4};if(_node2.nodeType==1&&_offset4<_node2.childNodes.length&&side>=0){_node2=_node2.childNodes[_offset4];_offset4=0}else{break}}return null}function nextToUneditable(node,offset){if(node.nodeType!=1)return 0;return(offset&&node.childNodes[offset-1].contentEditable=="false"?1:0)|(offset<node.childNodes.length&&node.childNodes[offset].contentEditable=="false"?2:0)}var DecorationComparator$1=function(){function DecorationComparator(){_classCallCheck2(this,DecorationComparator);this.changes=[]}_createClass2(DecorationComparator,[{key:"compareRange",value:function compareRange(from,to){addRange(from,to,this.changes)}},{key:"comparePoint",value:function comparePoint(from,to){addRange(from,to,this.changes)}}]);return DecorationComparator}();function findChangedDeco(a,b,diff){var comp=new DecorationComparator$1;RangeSet.compare(a,b,diff,comp);return comp.changes}function inUneditable(node,inside){for(var _cur11=node;_cur11&&_cur11!=inside;_cur11=_cur11.assignedSlot||_cur11.parentNode){if(_cur11.nodeType==1&&_cur11.contentEditable=="false"){return true}}return false}function touchesComposition(changes,composition){var touched=false;if(composition)changes.iterChangedRanges(function(from,to){if(from<composition.to&&to>composition.from)touched=true});return touched}function groupAt(state,pos){var bias=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var categorize=state.charCategorizer(pos);var line=state.doc.lineAt(pos),linePos=pos-line.from;if(line.length==0)return EditorSelection.cursor(pos);if(linePos==0)bias=1;else if(linePos==line.length)bias=-1;var from=linePos,to=linePos;if(bias<0)from=findClusterBreak(line.text,linePos,false);else to=findClusterBreak(line.text,linePos);var cat=categorize(line.text.slice(from,to));while(from>0){var prev=findClusterBreak(line.text,from,false);if(categorize(line.text.slice(prev,from))!=cat)break;from=prev}while(to<line.length){var next=findClusterBreak(line.text,to);if(categorize(line.text.slice(to,next))!=cat)break;to=next}return EditorSelection.range(from+line.from,to+line.from)}function getdx(x,rect){return rect.left>x?rect.left-x:Math.max(0,x-rect.right)}function getdy(y,rect){return rect.top>y?rect.top-y:Math.max(0,y-rect.bottom)}function yOverlap(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1}function upTop(rect,top){return top<rect.top?{top:top,left:rect.left,right:rect.right,bottom:rect.bottom}:rect}function upBot(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom:bottom}:rect}function domPosAtCoords(parent,x,y){var closest,closestRect,closestX,closestY,closestOverlap=false;var above,below,aboveRect,belowRect;for(var child=parent.firstChild;child;child=child.nextSibling){var rects=clientRectsFor(child);for(var _i181=0;_i181<rects.length;_i181++){var rect=rects[_i181];if(closestRect&&yOverlap(closestRect,rect))rect=upTop(upBot(rect,closestRect.bottom),closestRect.top);var dx=getdx(x,rect),dy=getdy(y,rect);if(dx==0&&dy==0)return child.nodeType==3?domPosInText(child,x,y):domPosAtCoords(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child;closestRect=rect;closestX=dx;closestY=dy;var side=dy?y<rect.top?-1:1:dx?x<rect.left?-1:1:0;closestOverlap=!side||(side>0?_i181<rects.length-1:_i181>0)}if(dx==0){if(y>rect.bottom&&(!aboveRect||aboveRect.bottom<rect.bottom)){above=child;aboveRect=rect}else if(y<rect.top&&(!belowRect||belowRect.top>rect.top)){below=child;belowRect=rect}}else if(aboveRect&&yOverlap(aboveRect,rect)){aboveRect=upBot(aboveRect,rect.bottom)}else if(belowRect&&yOverlap(belowRect,rect)){belowRect=upTop(belowRect,rect.top)}}}if(aboveRect&&aboveRect.bottom>=y){closest=above;closestRect=aboveRect}else if(belowRect&&belowRect.top<=y){closest=below;closestRect=belowRect}if(!closest)return{node:parent,offset:0};var clipX=Math.max(closestRect.left,Math.min(closestRect.right,x));if(closest.nodeType==3)return domPosInText(closest,clipX,y);if(closestOverlap&&closest.contentEditable!="false")return domPosAtCoords(closest,clipX,y);var offset=Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0);return{node:parent,offset:offset}}function domPosInText(node,x,y){var len=node.nodeValue.length;var closestOffset=-1,closestDY=1e9,generalSide=0;for(var _i182=0;_i182<len;_i182++){var rects=textRange(node,_i182,_i182+1).getClientRects();for(var j=0;j<rects.length;j++){var rect=rects[j];if(rect.top==rect.bottom)continue;if(!generalSide)generalSide=x-rect.left;var dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){var _right2=x>=(rect.left+rect.right)/2,_after3=_right2;if(browser.chrome||browser.gecko){var rectBefore=textRange(node,_i182).getBoundingClientRect();if(rectBefore.left==rect.right)_after3=!_right2}if(dy<=0)return{node:node,offset:_i182+(_after3?1:0)};closestOffset=_i182+(_after3?1:0);closestDY=dy}}}return{node:node,offset:closestOffset>-1?closestOffset:generalSide>0?node.nodeValue.length:0}}function _posAtCoords(view,coords,precise){var bias=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var _a,_b;var content=view.contentDOM.getBoundingClientRect(),docTop=content.top+view.viewState.paddingTop;var block,docHeight=view.viewState.docHeight;var x=coords.x,y=coords.y,yOffset=y-docTop;if(yOffset<0)return 0;if(yOffset>docHeight)return view.state.doc.length;for(var halfLine=view.viewState.heightOracle.textHeight/2,bounced=false;;){block=view.elementAtHeight(yOffset);if(block.type==BlockType.Text)break;for(;;){yOffset=bias>0?block.bottom+halfLine:block.top-halfLine;if(yOffset>=0&&yOffset<=docHeight)break;if(bounced)return precise?null:0;bounced=true;bias=-bias}}y=docTop+yOffset;var lineStart=block.from;if(lineStart<view.viewport.from)return view.viewport.from==0?0:precise?null:posAtCoordsImprecise(view,content,block,x,y);if(lineStart>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:precise?null:posAtCoordsImprecise(view,content,block,x,y);var doc=view.dom.ownerDocument;var root=view.root.elementFromPoint?view.root:doc;var element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;if(!element){x=Math.max(content.left+1,Math.min(content.right-1,x));element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null}var node,offset=-1;if(element&&((_a=view.docView.nearest(element))===null||_a===void 0?void 0:_a.isEditable)!=false){if(doc.caretPositionFromPoint){var pos=doc.caretPositionFromPoint(x,y);if(pos){node=pos.offsetNode;offset=pos.offset}}else if(doc.caretRangeFromPoint){var range=doc.caretRangeFromPoint(x,y);if(range){node=range.startContainer;offset=range.startOffset;if(!view.contentDOM.contains(node)||browser.safari&&isSuspiciousSafariCaretResult(node,offset,x)||browser.chrome&&isSuspiciousChromeCaretResult(node,offset,x))node=undefined}}}if(!node||!view.docView.dom.contains(node)){var line=LineView.find(view.docView,lineStart);if(!line)return yOffset>block.top+block.height/2?block.to:block.from;var _domPosAtCoords=domPosAtCoords(line.dom,x,y);node=_domPosAtCoords.node;offset=_domPosAtCoords.offset}var nearest=view.docView.nearest(node);if(!nearest)return null;if(nearest.isWidget&&((_b=nearest.dom)===null||_b===void 0?void 0:_b.nodeType)==1){var rect=nearest.dom.getBoundingClientRect();return coords.y<rect.top||coords.y<=rect.bottom&&coords.x<=(rect.left+rect.right)/2?nearest.posAtStart:nearest.posAtEnd}else{return nearest.localPosFromDOM(node,offset)+nearest.posAtStart}}function posAtCoordsImprecise(view,contentRect,block,x,y){var into=Math.round((x-contentRect.left)*view.defaultCharacterWidth);if(view.lineWrapping&&block.height>view.defaultLineHeight*1.5){var textHeight=view.viewState.heightOracle.textHeight;var line=Math.floor((y-block.top-(view.defaultLineHeight-textHeight)*0.5)/textHeight);into+=line*view.viewState.heightOracle.lineLength}var content=view.state.sliceDoc(block.from,block.to);return block.from+findColumn(content,into,view.state.tabSize)}function isSuspiciousSafariCaretResult(node,offset,x){var len;if(node.nodeType!=3||offset!=(len=node.nodeValue.length))return false;for(var next=node.nextSibling;next;next=next.nextSibling)if(next.nodeType!=1||next.nodeName!="BR")return false;return textRange(node,len-1,len).getBoundingClientRect().left>x}function isSuspiciousChromeCaretResult(node,offset,x){if(offset!=0)return false;for(var _cur12=node;;){var parent=_cur12.parentNode;if(!parent||parent.nodeType!=1||parent.firstChild!=_cur12)return false;if(parent.classList.contains("cm-line"))break;_cur12=parent}var rect=node.nodeType==1?node.getBoundingClientRect():textRange(node,0,Math.max(node.nodeValue.length,1)).getBoundingClientRect();return x-rect.left>5}function blockAt(view,pos){var line=view.lineBlockAt(pos);if(Array.isArray(line.type)){var _iterator236=_createForOfIteratorHelper(line.type),_step236;try{for(_iterator236.s();!(_step236=_iterator236.n()).done;){var _l2=_step236.value;if(_l2.to>pos||_l2.to==pos&&(_l2.to==line.to||_l2.type==BlockType.Text))return _l2}}catch(err){_iterator236.e(err)}finally{_iterator236.f()}}return line}function _moveToLineBoundary(view,start,forward,includeWrap){var line=blockAt(view,start.head);var coords=!includeWrap||line.type!=BlockType.Text||!(view.lineWrapping||line.widgetLineBreaks)?null:view.coordsAtPos(start.assoc<0&&start.head>line.from?start.head-1:start.head);if(coords){var editorRect=view.dom.getBoundingClientRect();var direction=view.textDirectionAt(line.from);var pos=view.posAtCoords({x:forward==(direction==Direction.LTR)?editorRect.right-1:editorRect.left+1,y:(coords.top+coords.bottom)/2});if(pos!=null)return EditorSelection.cursor(pos,forward?-1:1)}return EditorSelection.cursor(forward?line.to:line.from,forward?-1:1)}function _moveByChar(view,start,forward,by){var line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line);var direction=view.textDirectionAt(line.from);for(var _cur13=start,check=null;;){var next=moveVisually(line,spans,direction,_cur13,forward),_char3=movedOver;if(!next){if(line.number==(forward?view.state.doc.lines:1))return _cur13;_char3="\n";line=view.state.doc.line(line.number+(forward?1:-1));spans=view.bidiSpans(line);next=view.visualLineSide(line,!forward)}if(!check){if(!by)return next;check=by(_char3)}else if(!check(_char3)){return _cur13}_cur13=next}}function byGroup(view,pos,start){var categorize=view.state.charCategorizer(pos);var cat=categorize(start);return function(next){var nextCat=categorize(next);if(cat==CharCategory.Space)cat=nextCat;return cat==nextCat}}function _moveVertically(view,start,forward,distance){var startPos=start.head,dir=forward?1:-1;if(startPos==(forward?view.state.doc.length:0))return EditorSelection.cursor(startPos,start.assoc);var goal=start.goalColumn,startY;var rect=view.contentDOM.getBoundingClientRect();var startCoords=view.coordsAtPos(startPos,start.assoc||-1),docTop=view.documentTop;if(startCoords){if(goal==null)goal=startCoords.left-rect.left;startY=dir<0?startCoords.top:startCoords.bottom}else{var line=view.viewState.lineBlockAt(startPos);if(goal==null)goal=Math.min(rect.right-rect.left,view.defaultCharacterWidth*(startPos-line.from));startY=(dir<0?line.top:line.bottom)+docTop}var resolvedGoal=rect.left+goal;var dist=distance!==null&&distance!==void 0?distance:view.viewState.heightOracle.textHeight>>1;for(var extra=0;;extra+=10){var curY=startY+(dist+extra)*dir;var pos=_posAtCoords(view,{x:resolvedGoal,y:curY},false,dir);if(curY<rect.top||curY>rect.bottom||(dir<0?pos<startPos:pos>startPos)){var charRect=view.docView.coordsForChar(pos);var assoc=!charRect||curY<charRect.top?-1:1;return EditorSelection.cursor(pos,assoc,undefined,goal)}}}function skipAtomicRanges(atoms,pos,bias){var _loop13=function _loop13(){var moved=0;var _iterator237=_createForOfIteratorHelper(atoms),_step237;try{for(_iterator237.s();!(_step237=_iterator237.n()).done;){var set=_step237.value;set.between(pos-1,pos+1,function(from,to,value){if(pos>from&&pos<to){var side=moved||bias||(pos-from<to-pos?-1:1);pos=side<0?from:to;moved=side}})}}catch(err){_iterator237.e(err)}finally{_iterator237.f()}if(!moved)return{v:pos}},_ret2;for(;;){_ret2=_loop13();if(_ret2)return _ret2.v}}function skipAtoms(view,oldPos,pos){var newPos=skipAtomicRanges(view.state.facet(atomicRanges).map(function(f){return f(view)}),pos.from,oldPos.head>pos.from?-1:1);return newPos==pos.from?pos:EditorSelection.cursor(newPos,newPos<pos.from?1:-1)}var InputState=function(){function InputState(view){_classCallCheck2(this,InputState);this.view=view;this.lastKeyCode=0;this.lastKeyTime=0;this.lastTouchTime=0;this.lastFocusTime=0;this.lastScrollTop=0;this.lastScrollLeft=0;this.pendingIOSKey=undefined;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.handlers=Object.create(null);this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.compositionPendingKey=false;this.compositionPendingChange=false;this.mouseSelection=null;this.draggedContent=null;this.handleEvent=this.handleEvent.bind(this);this.notifiedFocused=view.hasFocus;if(browser.safari)view.contentDOM.addEventListener("input",function(){return null});if(browser.gecko)firefoxCopyCutHack(view.contentDOM.ownerDocument)}_createClass2(InputState,[{key:"setSelectionOrigin",value:function setSelectionOrigin(origin){this.lastSelectionOrigin=origin;this.lastSelectionTime=Date.now()}},{key:"handleEvent",value:function handleEvent(event){if(!eventBelongsToEditor(this.view,event)||this.ignoreDuringComposition(event))return;if(event.type=="keydown"&&this.keydown(event))return;this.runHandlers(event.type,event)}},{key:"runHandlers",value:function runHandlers(type,event){var handlers=this.handlers[type];if(handlers){var _iterator238=_createForOfIteratorHelper(handlers.observers),_step238;try{for(_iterator238.s();!(_step238=_iterator238.n()).done;){var observer=_step238.value;observer(this.view,event)}}catch(err){_iterator238.e(err)}finally{_iterator238.f()}var _iterator239=_createForOfIteratorHelper(handlers.handlers),_step239;try{for(_iterator239.s();!(_step239=_iterator239.n()).done;){var handler=_step239.value;if(event.defaultPrevented)break;if(handler(this.view,event)){event.preventDefault();break}}}catch(err){_iterator239.e(err)}finally{_iterator239.f()}}}},{key:"ensureHandlers",value:function ensureHandlers(plugins){var handlers=computeHandlers(plugins),prev=this.handlers,dom=this.view.contentDOM;for(var type in handlers)if(type!="scroll"){var _passive=!handlers[type].handlers.length;var exists=prev[type];if(exists&&_passive!=!exists.handlers.length){dom.removeEventListener(type,this.handleEvent);exists=null}if(!exists)dom.addEventListener(type,this.handleEvent,{passive:_passive})}for(var _type4 in prev)if(_type4!="scroll"&&!handlers[_type4])dom.removeEventListener(_type4,this.handleEvent);this.handlers=handlers}},{key:"keydown",value:function keydown(event){var _this197=this;this.lastKeyCode=event.keyCode;this.lastKeyTime=Date.now();if(event.keyCode==9&&Date.now()<this.lastEscPress+2000)return true;if(event.keyCode!=27&&modifierCodes.indexOf(event.keyCode)<0)this.view.inputState.lastEscPress=0;if(browser.android&&browser.chrome&&!event.synthetic&&(event.keyCode==13||event.keyCode==8)){this.view.observer.delayAndroidKey(event.key,event.keyCode);return true}var pending;if(browser.ios&&!event.synthetic&&!event.altKey&&!event.metaKey&&((pending=PendingKeys.find(function(key){return key.keyCode==event.keyCode}))&&!event.ctrlKey||EmacsyPendingKeys.indexOf(event.key)>-1&&event.ctrlKey&&!event.shiftKey)){this.pendingIOSKey=pending||event;setTimeout(function(){return _this197.flushIOSKey()},250);return true}if(event.keyCode!=229)this.view.observer.forceFlush();return false}},{key:"flushIOSKey",value:function flushIOSKey(){var key=this.pendingIOSKey;if(!key)return false;this.pendingIOSKey=undefined;return dispatchKey(this.view.contentDOM,key.key,key.keyCode)}},{key:"ignoreDuringComposition",value:function ignoreDuringComposition(event){if(!/^key/.test(event.type))return false;if(this.composing>0)return true;if(browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100){this.compositionPendingKey=false;return true}return false}},{key:"startMouseSelection",value:function startMouseSelection(mouseSelection){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=mouseSelection}},{key:"update",value:function update(_update2){if(this.mouseSelection)this.mouseSelection.update(_update2);if(this.draggedContent&&_update2.docChanged)this.draggedContent=this.draggedContent.map(_update2.changes);if(_update2.transactions.length)this.lastKeyCode=this.lastSelectionTime=0}},{key:"destroy",value:function destroy(){if(this.mouseSelection)this.mouseSelection.destroy()}}]);return InputState}();function bindHandler(plugin,handler){return function(view,event){try{return handler.call(plugin,event,view)}catch(e){logException(view.state,e)}}}function computeHandlers(plugins){var result=Object.create(null);function record(type){return result[type]||(result[type]={observers:[],handlers:[]})}var _iterator240=_createForOfIteratorHelper(plugins),_step240;try{for(_iterator240.s();!(_step240=_iterator240.n()).done;){var plugin=_step240.value;var spec=plugin.spec;if(spec&&spec.domEventHandlers)for(var _type6 in spec.domEventHandlers){var f=spec.domEventHandlers[_type6];if(f)record(_type6).handlers.push(bindHandler(plugin.value,f))}if(spec&&spec.domEventObservers)for(var _type7 in spec.domEventObservers){var _f2=spec.domEventObservers[_type7];if(_f2)record(_type7).observers.push(bindHandler(plugin.value,_f2))}}}catch(err){_iterator240.e(err)}finally{_iterator240.f()}for(var type in handlers)record(type).handlers.push(handlers[type]);for(var _type5 in observers)record(_type5).observers.push(observers[_type5]);return result}var PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}];var EmacsyPendingKeys="dthko";var modifierCodes=[16,17,18,20,91,92,224,225];var dragScrollMargin=6;function dragScrollSpeed(dist){return Math.max(0,dist)*0.7+8}function dist(a,b){return Math.max(Math.abs(a.clientX-b.clientX),Math.abs(a.clientY-b.clientY))}var MouseSelection=function(){function MouseSelection(view,startEvent,style,mustSelect){_classCallCheck2(this,MouseSelection);this.view=view;this.startEvent=startEvent;this.style=style;this.mustSelect=mustSelect;this.scrollSpeed={x:0,y:0};this.scrolling=-1;this.lastEvent=startEvent;this.scrollParent=scrollableParent(view.contentDOM);this.atoms=view.state.facet(atomicRanges).map(function(f){return f(view)});var doc=view.contentDOM.ownerDocument;doc.addEventListener("mousemove",this.move=this.move.bind(this));doc.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=startEvent.shiftKey;this.multiple=view.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(view,startEvent);this.dragging=isInPrimarySelection(view,startEvent)&&getClickType(startEvent)==1?null:false}_createClass2(MouseSelection,[{key:"start",value:function start(event){if(this.dragging===false)this.select(event)}},{key:"move",value:function move(event){var _a;if(event.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&dist(this.startEvent,event)<10)return;this.select(this.lastEvent=event);var sx=0,sy=0;var rect=((_a=this.scrollParent)===null||_a===void 0?void 0:_a.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight};var margins=getScrollMargins(this.view);if(event.clientX-margins.left<=rect.left+dragScrollMargin)sx=-dragScrollSpeed(rect.left-event.clientX);else if(event.clientX+margins.right>=rect.right-dragScrollMargin)sx=dragScrollSpeed(event.clientX-rect.right);if(event.clientY-margins.top<=rect.top+dragScrollMargin)sy=-dragScrollSpeed(rect.top-event.clientY);else if(event.clientY+margins.bottom>=rect.bottom-dragScrollMargin)sy=dragScrollSpeed(event.clientY-rect.bottom);this.setScrollSpeed(sx,sy)}},{key:"up",value:function up(event){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)event.preventDefault();this.destroy()}},{key:"destroy",value:function destroy(){this.setScrollSpeed(0,0);var doc=this.view.contentDOM.ownerDocument;doc.removeEventListener("mousemove",this.move);doc.removeEventListener("mouseup",this.up);this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}},{key:"setScrollSpeed",value:function setScrollSpeed(sx,sy){var _this198=this;this.scrollSpeed={x:sx,y:sy};if(sx||sy){if(this.scrolling<0)this.scrolling=setInterval(function(){return _this198.scroll()},50)}else if(this.scrolling>-1){clearInterval(this.scrolling);this.scrolling=-1}}},{key:"scroll",value:function scroll(){if(this.scrollParent){this.scrollParent.scrollLeft+=this.scrollSpeed.x;this.scrollParent.scrollTop+=this.scrollSpeed.y}else{this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y)}if(this.dragging===false)this.select(this.lastEvent)}},{key:"skipAtoms",value:function skipAtoms(sel){var ranges=null;for(var _i183=0;_i183<sel.ranges.length;_i183++){var range=sel.ranges[_i183],updated=null;if(range.empty){var pos=skipAtomicRanges(this.atoms,range.from,0);if(pos!=range.from)updated=EditorSelection.cursor(pos,-1)}else{var from=skipAtomicRanges(this.atoms,range.from,-1);var to=skipAtomicRanges(this.atoms,range.to,1);if(from!=range.from||to!=range.to)updated=EditorSelection.range(range.from==range.anchor?from:to,range.from==range.head?from:to)}if(updated){if(!ranges)ranges=sel.ranges.slice();ranges[_i183]=updated}}return ranges?EditorSelection.create(ranges,sel.mainIndex):sel}},{key:"select",value:function select(event){var view=this.view,selection=this.skipAtoms(this.style.get(event,this.extend,this.multiple));if(this.mustSelect||!selection.eq(view.state.selection,this.dragging===false))this.view.dispatch({selection:selection,userEvent:"select.pointer"});this.mustSelect=false}},{key:"update",value:function update(_update3){var _this199=this;if(this.style.update(_update3))setTimeout(function(){return _this199.select(_this199.lastEvent)},20)}}]);return MouseSelection}();function addsSelectionRange(view,event){var facet=view.state.facet(clickAddsSelectionRange);return facet.length?facet[0](event):browser.mac?event.metaKey:event.ctrlKey}function dragMovesSelection(view,event){var facet=view.state.facet(dragMovesSelection$1);return facet.length?facet[0](event):browser.mac?!event.altKey:!event.ctrlKey}function isInPrimarySelection(view,event){var main=view.state.selection.main;if(main.empty)return false;var sel=getSelection(view.root);if(!sel||sel.rangeCount==0)return true;var rects=sel.getRangeAt(0).getClientRects();for(var _i184=0;_i184<rects.length;_i184++){var rect=rects[_i184];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return true}return false}function eventBelongsToEditor(view,event){if(!event.bubbles)return true;if(event.defaultPrevented)return false;for(var node=event.target,cView;node!=view.contentDOM;node=node.parentNode)if(!node||node.nodeType==11||(cView=ContentView.get(node))&&cView.ignoreEvent(event))return false;return true}var handlers=Object.create(null);var observers=Object.create(null);var brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(view){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.focus();setTimeout(function(){view.focus();target.remove();doPaste(view,target.value)},50)}function doPaste(view,input){var state=view.state,changes,i=1,text=state.toText(input);var byLine=text.lines==state.selection.ranges.length;var linewise=lastLinewiseCopy!=null&&state.selection.ranges.every(function(r){return r.empty})&&lastLinewiseCopy==text.toString();if(linewise){var lastLine=-1;changes=state.changeByRange(function(range){var line=state.doc.lineAt(range.from);if(line.from==lastLine)return{range:range};lastLine=line.from;var insert=state.toText((byLine?text.line(i++).text:input)+state.lineBreak);return{changes:{from:line.from,insert:insert},range:EditorSelection.cursor(range.from+insert.length)}})}else if(byLine){changes=state.changeByRange(function(range){var line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:EditorSelection.cursor(range.from+line.length)}})}else{changes=state.replaceSelection(text)}view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:true})}observers.scroll=function(view){view.inputState.lastScrollTop=view.scrollDOM.scrollTop;view.inputState.lastScrollLeft=view.scrollDOM.scrollLeft};handlers.keydown=function(view,event){view.inputState.setSelectionOrigin("select");if(event.keyCode==27)view.inputState.lastEscPress=Date.now();return false};observers.touchstart=function(view,e){view.inputState.lastTouchTime=Date.now();view.inputState.setSelectionOrigin("select.pointer")};observers.touchmove=function(view){view.inputState.setSelectionOrigin("select.pointer")};handlers.mousedown=function(view,event){view.observer.flush();if(view.inputState.lastTouchTime>Date.now()-2000)return false;var style=null;var _iterator241=_createForOfIteratorHelper(view.state.facet(mouseSelectionStyle)),_step241;try{for(_iterator241.s();!(_step241=_iterator241.n()).done;){var makeStyle=_step241.value;style=makeStyle(view,event);if(style)break}}catch(err){_iterator241.e(err)}finally{_iterator241.f()}if(!style&&event.button==0)style=basicMouseSelection(view,event);if(style){var mustFocus=!view.hasFocus;view.inputState.startMouseSelection(new MouseSelection(view,event,style,mustFocus));if(mustFocus)view.observer.ignore(function(){return focusPreventScroll(view.contentDOM)});var mouseSel=view.inputState.mouseSelection;if(mouseSel){mouseSel.start(event);return mouseSel.dragging===false}}return false};function rangeForClick(view,pos,bias,type){if(type==1){return EditorSelection.cursor(pos,bias)}else if(type==2){return groupAt(view.state,pos,bias)}else{var visual=LineView.find(view.docView,pos),line=view.state.doc.lineAt(visual?visual.posAtEnd:pos);var from=visual?visual.posAtStart:line.from,to=visual?visual.posAtEnd:line.to;if(to<view.state.doc.length&&to==line.to)to++;return EditorSelection.range(from,to)}}var insideY=function insideY(y,rect){return y>=rect.top&&y<=rect.bottom};var inside=function inside(x,y,rect){return insideY(y,rect)&&x>=rect.left&&x<=rect.right};function findPositionSide(view,pos,x,y){var line=LineView.find(view.docView,pos);if(!line)return 1;var off=pos-line.posAtStart;if(off==0)return 1;if(off==line.length)return-1;var before=line.coordsAt(off,-1);if(before&&inside(x,y,before))return-1;var after=line.coordsAt(off,1);if(after&&inside(x,y,after))return 1;return before&&insideY(y,before)?-1:1}function queryPos(view,event){var pos=view.posAtCoords({x:event.clientX,y:event.clientY},false);return{pos:pos,bias:findPositionSide(view,pos,event.clientX,event.clientY)}}var BadMouseDetail=browser.ie&&browser.ie_version<=11;var lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(event){if(!BadMouseDetail)return event.detail;var last=lastMouseDown,lastTime=lastMouseDownTime;lastMouseDown=event;lastMouseDownTime=Date.now();return lastMouseDownCount=!last||lastTime>Date.now()-400&&Math.abs(last.clientX-event.clientX)<2&&Math.abs(last.clientY-event.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(view,event){var start=queryPos(view,event),type=getClickType(event);var startSel=view.state.selection;return{update:function update(_update4){if(_update4.docChanged){start.pos=_update4.changes.mapPos(start.pos);startSel=startSel.map(_update4.changes)}},get:function get(event,extend,multiple){var cur=queryPos(view,event),removed;var range=rangeForClick(view,cur.pos,cur.bias,type);if(start.pos!=cur.pos&&!extend){var startRange=rangeForClick(view,start.pos,start.bias,type);var from=Math.min(startRange.from,range.from),to=Math.max(startRange.to,range.to);range=from<range.from?EditorSelection.range(from,to):EditorSelection.range(to,from)}if(extend)return startSel.replaceRange(startSel.main.extend(range.from,range.to));else if(multiple&&type==1&&startSel.ranges.length>1&&(removed=removeRangeAround(startSel,cur.pos)))return removed;else if(multiple)return startSel.addRange(range);else return EditorSelection.create([range])}}}function removeRangeAround(sel,pos){for(var _i185=0;_i185<sel.ranges.length;_i185++){var _sel$ranges$_i=sel.ranges[_i185],from=_sel$ranges$_i.from,to=_sel$ranges$_i.to;if(from<=pos&&to>=pos)return EditorSelection.create(sel.ranges.slice(0,_i185).concat(sel.ranges.slice(_i185+1)),sel.mainIndex==_i185?0:sel.mainIndex-(sel.mainIndex>_i185?1:0))}return null}handlers.dragstart=function(view,event){var range=view.state.selection.main;if(event.target.draggable){var cView=view.docView.nearest(event.target);if(cView&&cView.isWidget){var from=cView.posAtStart,to=from+cView.length;if(from>=range.to||to<=range.from)range=EditorSelection.range(from,to)}}var inputState=view.inputState;if(inputState.mouseSelection)inputState.mouseSelection.dragging=true;inputState.draggedContent=range;if(event.dataTransfer){event.dataTransfer.setData("Text",view.state.sliceDoc(range.from,range.to));event.dataTransfer.effectAllowed="copyMove"}return false};handlers.dragend=function(view){view.inputState.draggedContent=null;return false};function dropText(view,event,text,direct){if(!text)return;var dropPos=view.posAtCoords({x:event.clientX,y:event.clientY},false);var draggedContent=view.inputState.draggedContent;var del=direct&&draggedContent&&dragMovesSelection(view,event)?{from:draggedContent.from,to:draggedContent.to}:null;var ins={from:dropPos,insert:text};var changes=view.state.changes(del?[del,ins]:ins);view.focus();view.dispatch({changes:changes,selection:{anchor:changes.mapPos(dropPos,-1),head:changes.mapPos(dropPos,1)},userEvent:del?"move.drop":"input.drop"});view.inputState.draggedContent=null}handlers.drop=function(view,event){if(!event.dataTransfer)return false;if(view.state.readOnly)return true;var files=event.dataTransfer.files;if(files&&files.length){var _text4=Array(files.length),_read9=0;var finishFile=function finishFile(){if(++_read9==files.length)dropText(view,event,_text4.filter(function(s){return s!=null}).join(view.state.lineBreak),false)};var _loop14=function _loop14(_i186){var reader=new FileReader;reader.onerror=finishFile;reader.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result))_text4[_i186]=reader.result;finishFile()};reader.readAsText(files[_i186])};for(var _i186=0;_i186<files.length;_i186++){_loop14(_i186)}return true}else{var _text5=event.dataTransfer.getData("Text");if(_text5){dropText(view,event,_text5,true);return true}}return false};handlers.paste=function(view,event){if(view.state.readOnly)return true;view.observer.flush();var data=brokenClipboardAPI?null:event.clipboardData;if(data){doPaste(view,data.getData("text/plain")||data.getData("text/uri-text"));return true}else{capturePaste(view);return false}};function captureCopy(view,text){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.value=text;target.focus();target.selectionEnd=text.length;target.selectionStart=0;setTimeout(function(){target.remove();view.focus()},50)}function copiedRange(state){var content=[],ranges=[],linewise=false;var _iterator242=_createForOfIteratorHelper(state.selection.ranges),_step242;try{for(_iterator242.s();!(_step242=_iterator242.n()).done;){var range=_step242.value;if(!range.empty){content.push(state.sliceDoc(range.from,range.to));ranges.push(range)}}}catch(err){_iterator242.e(err)}finally{_iterator242.f()}if(!content.length){var upto=-1;var _iterator243=_createForOfIteratorHelper(state.selection.ranges),_step243;try{for(_iterator243.s();!(_step243=_iterator243.n()).done;){var from=_step243.value.from;var line=state.doc.lineAt(from);if(line.number>upto){content.push(line.text);ranges.push({from:line.from,to:Math.min(state.doc.length,line.to+1)})}upto=line.number}}catch(err){_iterator243.e(err)}finally{_iterator243.f()}linewise=true}return{text:content.join(state.lineBreak),ranges:ranges,linewise:linewise}}var lastLinewiseCopy=null;handlers.copy=handlers.cut=function(view,event){var _copiedRange=copiedRange(view.state),text=_copiedRange.text,ranges=_copiedRange.ranges,linewise=_copiedRange.linewise;if(!text&&!linewise)return false;lastLinewiseCopy=linewise?text:null;if(event.type=="cut"&&!view.state.readOnly)view.dispatch({changes:ranges,scrollIntoView:true,userEvent:"delete.cut"});var data=brokenClipboardAPI?null:event.clipboardData;if(data){data.clearData();data.setData("text/plain",text);return true}else{captureCopy(view,text);return false}};var isFocusChange=Annotation.define();function focusChangeTransaction(state,focus){var effects=[];var _iterator244=_createForOfIteratorHelper(state.facet(focusChangeEffect)),_step244;try{for(_iterator244.s();!(_step244=_iterator244.n()).done;){var getEffect=_step244.value;var _effect3=getEffect(state,focus);if(_effect3)effects.push(_effect3)}}catch(err){_iterator244.e(err)}finally{_iterator244.f()}return effects?state.update({effects:effects,annotations:isFocusChange.of(true)}):null}function updateForFocusChange(view){setTimeout(function(){var focus=view.hasFocus;if(focus!=view.inputState.notifiedFocused){var tr=focusChangeTransaction(view.state,focus);if(tr)view.dispatch(tr);else view.update([])}},10)}observers.focus=function(view){view.inputState.lastFocusTime=Date.now();if(!view.scrollDOM.scrollTop&&(view.inputState.lastScrollTop||view.inputState.lastScrollLeft)){view.scrollDOM.scrollTop=view.inputState.lastScrollTop;view.scrollDOM.scrollLeft=view.inputState.lastScrollLeft}updateForFocusChange(view)};observers.blur=function(view){view.observer.clearSelectionRange();updateForFocusChange(view)};observers.compositionstart=observers.compositionupdate=function(view){if(view.inputState.compositionFirstChange==null)view.inputState.compositionFirstChange=true;if(view.inputState.composing<0){view.inputState.composing=0}};observers.compositionend=function(view){view.inputState.composing=-1;view.inputState.compositionEndedAt=Date.now();view.inputState.compositionPendingKey=true;view.inputState.compositionPendingChange=view.observer.pendingRecords().length>0;view.inputState.compositionFirstChange=null;if(browser.chrome&&browser.android){view.observer.flushSoon()}else if(view.inputState.compositionPendingChange){Promise.resolve().then(function(){return view.observer.flush()})}else{setTimeout(function(){if(view.inputState.composing<0&&view.docView.hasComposition)view.update([])},50)}};observers.contextmenu=function(view){view.inputState.lastContextMenu=Date.now()};handlers.beforeinput=function(view,event){var _a;var pending;if(browser.chrome&&browser.android&&(pending=PendingKeys.find(function(key){return key.inputType==event.inputType}))){view.observer.delayAndroidKey(pending.key,pending.keyCode);if(pending.key=="Backspace"||pending.key=="Delete"){var startViewHeight=((_a=window.visualViewport)===null||_a===void 0?void 0:_a.height)||0;setTimeout(function(){var _a;if((((_a=window.visualViewport)===null||_a===void 0?void 0:_a.height)||0)>startViewHeight+10&&view.hasFocus){view.contentDOM.blur();view.focus()}},100)}}return false};var appliedFirefoxHack=new Set;function firefoxCopyCutHack(doc){if(!appliedFirefoxHack.has(doc)){appliedFirefoxHack.add(doc);doc.addEventListener("copy",function(){});doc.addEventListener("cut",function(){})}}var wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];var HeightOracle=function(){function HeightOracle(lineWrapping){_classCallCheck2(this,HeightOracle);this.lineWrapping=lineWrapping;this.doc=Text.empty;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.textHeight=14;this.lineLength=30;this.heightChanged=false}_createClass2(HeightOracle,[{key:"heightForGap",value:function heightForGap(from,to){var lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+1;if(this.lineWrapping)lines+=Math.max(0,Math.ceil((to-from-lines*this.lineLength*0.5)/this.lineLength));return this.lineHeight*lines}},{key:"heightForLine",value:function heightForLine(length){if(!this.lineWrapping)return this.lineHeight;var lines=1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5)));return lines*this.lineHeight}},{key:"setDoc",value:function setDoc(doc){this.doc=doc;return this}},{key:"mustRefreshForWrapping",value:function mustRefreshForWrapping(whiteSpace){return wrappingWhiteSpace.indexOf(whiteSpace)>-1!=this.lineWrapping}},{key:"mustRefreshForHeights",value:function mustRefreshForHeights(lineHeights){var newHeight=false;for(var _i187=0;_i187<lineHeights.length;_i187++){var h=lineHeights[_i187];if(h<0){_i187++}else if(!this.heightSamples[Math.floor(h*10)]){newHeight=true;this.heightSamples[Math.floor(h*10)]=true}}return newHeight}},{key:"refresh",value:function refresh(whiteSpace,lineHeight,charWidth,textHeight,lineLength,knownHeights){var lineWrapping=wrappingWhiteSpace.indexOf(whiteSpace)>-1;var changed=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping;this.lineWrapping=lineWrapping;this.lineHeight=lineHeight;this.charWidth=charWidth;this.textHeight=textHeight;this.lineLength=lineLength;if(changed){this.heightSamples={};for(var _i188=0;_i188<knownHeights.length;_i188++){var h=knownHeights[_i188];if(h<0)_i188++;else this.heightSamples[Math.floor(h*10)]=true}}return changed}}]);return HeightOracle}();var MeasuredHeights=function(){function MeasuredHeights(from,heights){_classCallCheck2(this,MeasuredHeights);this.from=from;this.heights=heights;this.index=0}_createClass2(MeasuredHeights,[{key:"more",get:function get(){return this.index<this.heights.length}}]);return MeasuredHeights}();var BlockInfo=function(){function BlockInfo(from,length,top,height,_content){_classCallCheck2(this,BlockInfo);this.from=from;this.length=length;this.top=top;this.height=height;this._content=_content}_createClass2(BlockInfo,[{key:"type",get:function get(){return typeof this._content=="number"?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}},{key:"to",get:function get(){return this.from+this.length}},{key:"bottom",get:function get(){return this.top+this.height}},{key:"widget",get:function get(){return this._content instanceof PointDecoration?this._content.widget:null}},{key:"widgetLineBreaks",get:function get(){return typeof this._content=="number"?this._content:0}},{key:"join",value:function join(other){var content=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(other._content)?other._content:[other]);return new BlockInfo(this.from,this.length+other.length,this.top,this.height+other.height,content)}}]);return BlockInfo}();var QueryType$1=function(QueryType){QueryType[QueryType["ByPos"]=0]="ByPos";QueryType[QueryType["ByHeight"]=1]="ByHeight";QueryType[QueryType["ByPosNoHeight"]=2]="ByPosNoHeight";return QueryType}(QueryType$1||(QueryType$1={}));var Epsilon=1e-3;var HeightMap=function(){function HeightMap(length,height){var flags=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;_classCallCheck2(this,HeightMap);this.length=length;this.height=height;this.flags=flags}_createClass2(HeightMap,[{key:"outdated",get:function get(){return(this.flags&2)>0},set:function set(value){this.flags=(value?2:0)|this.flags&~2}},{key:"setHeight",value:function setHeight(oracle,height){if(this.height!=height){if(Math.abs(this.height-height)>Epsilon)oracle.heightChanged=true;this.height=height}}},{key:"replace",value:function replace(_from,_to,nodes){return HeightMap.of(nodes)}},{key:"decomposeLeft",value:function decomposeLeft(_to,result){result.push(this)}},{key:"decomposeRight",value:function decomposeRight(_from,result){result.push(this)}},{key:"applyChanges",value:function applyChanges(decorations,oldDoc,oracle,changes){var me=this,doc=oracle.doc;for(var _i189=changes.length-1;_i189>=0;_i189--){var _changes$_i=changes[_i189],fromA=_changes$_i.fromA,toA=_changes$_i.toA,fromB=_changes$_i.fromB,toB=_changes$_i.toB;var _start11=me.lineAt(fromA,QueryType$1.ByPosNoHeight,oracle.setDoc(oldDoc),0,0);var _end28=_start11.to>=toA?_start11:me.lineAt(toA,QueryType$1.ByPosNoHeight,oracle,0,0);toB+=_end28.to-toA;toA=_end28.to;while(_i189>0&&_start11.from<=changes[_i189-1].toA){fromA=changes[_i189-1].fromA;fromB=changes[_i189-1].fromB;_i189--;if(fromA<_start11.from)_start11=me.lineAt(fromA,QueryType$1.ByPosNoHeight,oracle,0,0)}fromB+=_start11.from-fromA;fromA=_start11.from;var nodes=NodeBuilder.build(oracle.setDoc(doc),decorations,fromB,toB);me=me.replace(fromA,toA,nodes)}return me.updateHeight(oracle,0)}}],[{key:"empty",value:function empty(){return new HeightMapText(0,0)}},{key:"of",value:function of(nodes){if(nodes.length==1)return nodes[0];var i=0,j=nodes.length,before=0,after=0;for(;;){if(i==j){if(before>after*2){var split=nodes[i-1];if(split["break"])nodes.splice(--i,1,split.left,null,split.right);else nodes.splice(--i,1,split.left,split.right);j+=1+split["break"];before-=split.size}else if(after>before*2){var _split=nodes[j];if(_split["break"])nodes.splice(j,1,_split.left,null,_split.right);else nodes.splice(j,1,_split.left,_split.right);j+=2+_split["break"];after-=_split.size}else{break}}else if(before<after){var next=nodes[i++];if(next)before+=next.size}else{var _next5=nodes[--j];if(_next5)after+=_next5.size}}var brk=0;if(nodes[i-1]==null){brk=1;i--}else if(nodes[i]==null){brk=1;j++}return new HeightMapBranch(HeightMap.of(nodes.slice(0,i)),brk,HeightMap.of(nodes.slice(j)))}}]);return HeightMap}();HeightMap.prototype.size=1;var HeightMapBlock=function(_HeightMap){_inherits2(HeightMapBlock,_HeightMap);var _super85=_createSuper(HeightMapBlock);function HeightMapBlock(length,height,deco){var _this200;_classCallCheck2(this,HeightMapBlock);_this200=_super85.call(this,length,height);_this200.deco=deco;return _this200}_createClass2(HeightMapBlock,[{key:"blockAt",value:function blockAt(_height,_oracle,top,offset){return new BlockInfo(offset,this.length,top,this.height,this.deco||0)}},{key:"lineAt",value:function lineAt(_value,_type,oracle,top,offset){return this.blockAt(0,oracle,top,offset)}},{key:"forEachLine",value:function forEachLine(from,to,oracle,top,offset,f){if(from<=offset+this.length&&to>=offset)f(this.blockAt(0,oracle,top,offset))}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);this.outdated=false;return this}},{key:"toString",value:function toString(){return"block(".concat(this.length,")")}}]);return HeightMapBlock}(HeightMap);var HeightMapText=function(_HeightMapBlock){_inherits2(HeightMapText,_HeightMapBlock);var _super86=_createSuper(HeightMapText);function HeightMapText(length,height){var _this201;_classCallCheck2(this,HeightMapText);_this201=_super86.call(this,length,height,null);_this201.collapsed=0;_this201.widgetHeight=0;_this201.breaks=0;return _this201}_createClass2(HeightMapText,[{key:"blockAt",value:function blockAt(_height,_oracle,top,offset){return new BlockInfo(offset,this.length,top,this.height,this.breaks)}},{key:"replace",value:function replace(_from,_to,nodes){var node=nodes[0];if(nodes.length==1&&(node instanceof HeightMapText||node instanceof HeightMapGap&&node.flags&4)&&Math.abs(this.length-node.length)<10){if(node instanceof HeightMapGap)node=new HeightMapText(node.length,this.height);else node.height=this.height;if(!this.outdated)node.outdated=false;return node}else{return HeightMap.of(nodes)}}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);else if(force||this.outdated)this.setHeight(oracle,Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed))+this.breaks*oracle.lineHeight);this.outdated=false;return this}},{key:"toString",value:function toString(){return"line(".concat(this.length).concat(this.collapsed?-this.collapsed:"").concat(this.widgetHeight?":"+this.widgetHeight:"",")")}}]);return HeightMapText}(HeightMapBlock);var HeightMapGap=function(_HeightMap2){_inherits2(HeightMapGap,_HeightMap2);var _super87=_createSuper(HeightMapGap);function HeightMapGap(length){_classCallCheck2(this,HeightMapGap);return _super87.call(this,length,0)}_createClass2(HeightMapGap,[{key:"heightMetrics",value:function heightMetrics(oracle,offset){var firstLine=oracle.doc.lineAt(offset).number,lastLine=oracle.doc.lineAt(offset+this.length).number;var lines=lastLine-firstLine+1;var perLine,perChar=0;if(oracle.lineWrapping){var totalPerLine=Math.min(this.height,oracle.lineHeight*lines);perLine=totalPerLine/lines;if(this.length>lines+1)perChar=(this.height-totalPerLine)/(this.length-lines-1)}else{perLine=this.height/lines}return{firstLine:firstLine,lastLine:lastLine,perLine:perLine,perChar:perChar}}},{key:"blockAt",value:function blockAt(height,oracle,top,offset){var _this$heightMetrics=this.heightMetrics(oracle,offset),firstLine=_this$heightMetrics.firstLine,lastLine=_this$heightMetrics.lastLine,perLine=_this$heightMetrics.perLine,perChar=_this$heightMetrics.perChar;if(oracle.lineWrapping){var guess=offset+Math.round(Math.max(0,Math.min(1,(height-top)/this.height))*this.length);var line=oracle.doc.lineAt(guess),lineHeight=perLine+line.length*perChar;var lineTop=Math.max(top,height-lineHeight/2);return new BlockInfo(line.from,line.length,lineTop,lineHeight,0)}else{var _line2=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top)/perLine)));var _oracle$doc$line=oracle.doc.line(firstLine+_line2),from=_oracle$doc$line.from,length=_oracle$doc$line.length;return new BlockInfo(from,length,top+perLine*_line2,perLine,0)}}},{key:"lineAt",value:function lineAt(value,type,oracle,top,offset){if(type==QueryType$1.ByHeight)return this.blockAt(value,oracle,top,offset);if(type==QueryType$1.ByPosNoHeight){var _oracle$doc$lineAt=oracle.doc.lineAt(value),from=_oracle$doc$lineAt.from,to=_oracle$doc$lineAt.to;return new BlockInfo(from,to-from,0,0,0)}var _this$heightMetrics2=this.heightMetrics(oracle,offset),firstLine=_this$heightMetrics2.firstLine,perLine=_this$heightMetrics2.perLine,perChar=_this$heightMetrics2.perChar;var line=oracle.doc.lineAt(value),lineHeight=perLine+line.length*perChar;var linesAbove=line.number-firstLine;var lineTop=top+perLine*linesAbove+perChar*(line.from-offset-linesAbove);return new BlockInfo(line.from,line.length,Math.max(top,Math.min(lineTop,top+this.height-lineHeight)),lineHeight,0)}},{key:"forEachLine",value:function forEachLine(from,to,oracle,top,offset,f){from=Math.max(from,offset);to=Math.min(to,offset+this.length);var _this$heightMetrics3=this.heightMetrics(oracle,offset),firstLine=_this$heightMetrics3.firstLine,perLine=_this$heightMetrics3.perLine,perChar=_this$heightMetrics3.perChar;for(var pos=from,lineTop=top;pos<=to;){var line=oracle.doc.lineAt(pos);if(pos==from){var linesAbove=line.number-firstLine;lineTop+=perLine*linesAbove+perChar*(from-offset-linesAbove)}var lineHeight=perLine+perChar*line.length;f(new BlockInfo(line.from,line.length,lineTop,lineHeight,0));lineTop+=lineHeight;pos=line.to+1}}},{key:"replace",value:function replace(from,to,nodes){var after=this.length-to;if(after>0){var last=nodes[nodes.length-1];if(last instanceof HeightMapGap)nodes[nodes.length-1]=new HeightMapGap(last.length+after);else nodes.push(null,new HeightMapGap(after-1))}if(from>0){var first=nodes[0];if(first instanceof HeightMapGap)nodes[0]=new HeightMapGap(from+first.length);else nodes.unshift(new HeightMapGap(from-1),null)}return HeightMap.of(nodes)}},{key:"decomposeLeft",value:function decomposeLeft(to,result){result.push(new HeightMapGap(to-1),null)}},{key:"decomposeRight",value:function decomposeRight(from,result){result.push(null,new HeightMapGap(this.length-from-1))}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){var nodes=[],pos=Math.max(offset,measured.from),singleHeight=-1;if(measured.from>offset)nodes.push(new HeightMapGap(measured.from-offset-1).updateHeight(oracle,offset));while(pos<=end&&measured.more){var len=oracle.doc.lineAt(pos).length;if(nodes.length)nodes.push(null);var height=measured.heights[measured.index++];if(singleHeight==-1)singleHeight=height;else if(Math.abs(height-singleHeight)>=Epsilon)singleHeight=-2;var line=new HeightMapText(len,height);line.outdated=false;nodes.push(line);pos+=len+1}if(pos<=end)nodes.push(null,new HeightMapGap(end-pos).updateHeight(oracle,pos));var result=HeightMap.of(nodes);if(singleHeight<0||Math.abs(result.height-this.height)>=Epsilon||Math.abs(singleHeight-this.heightMetrics(oracle,offset).perLine)>=Epsilon)oracle.heightChanged=true;return result}else if(force||this.outdated){this.setHeight(oracle,oracle.heightForGap(offset,offset+this.length));this.outdated=false}return this}},{key:"toString",value:function toString(){return"gap(".concat(this.length,")")}}]);return HeightMapGap}(HeightMap);var HeightMapBranch=function(_HeightMap3){_inherits2(HeightMapBranch,_HeightMap3);var _super88=_createSuper(HeightMapBranch);function HeightMapBranch(left,brk,right){var _this202;_classCallCheck2(this,HeightMapBranch);_this202=_super88.call(this,left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0));_this202.left=left;_this202.right=right;_this202.size=left.size+right.size;return _this202}_createClass2(HeightMapBranch,[{key:"break",get:function get(){return this.flags&1}},{key:"blockAt",value:function blockAt(height,oracle,top,offset){var mid=top+this.left.height;return height<mid?this.left.blockAt(height,oracle,top,offset):this.right.blockAt(height,oracle,mid,offset+this.left.length+this["break"])}},{key:"lineAt",value:function lineAt(value,type,oracle,top,offset){var rightTop=top+this.left.height,rightOffset=offset+this.left.length+this["break"];var left=type==QueryType$1.ByHeight?value<rightTop:value<rightOffset;var base=left?this.left.lineAt(value,type,oracle,top,offset):this.right.lineAt(value,type,oracle,rightTop,rightOffset);if(this["break"]||(left?base.to<rightOffset:base.from>rightOffset))return base;var subQuery=type==QueryType$1.ByPosNoHeight?QueryType$1.ByPosNoHeight:QueryType$1.ByPos;if(left)return base.join(this.right.lineAt(rightOffset,subQuery,oracle,rightTop,rightOffset));else return this.left.lineAt(rightOffset,subQuery,oracle,top,offset).join(base)}},{key:"forEachLine",value:function forEachLine(from,to,oracle,top,offset,f){var rightTop=top+this.left.height,rightOffset=offset+this.left.length+this["break"];if(this["break"]){if(from<rightOffset)this.left.forEachLine(from,to,oracle,top,offset,f);if(to>=rightOffset)this.right.forEachLine(from,to,oracle,rightTop,rightOffset,f)}else{var mid=this.lineAt(rightOffset,QueryType$1.ByPos,oracle,top,offset);if(from<mid.from)this.left.forEachLine(from,mid.from-1,oracle,top,offset,f);if(mid.to>=from&&mid.from<=to)f(mid);if(to>mid.to)this.right.forEachLine(mid.to+1,to,oracle,rightTop,rightOffset,f)}}},{key:"replace",value:function replace(from,to,nodes){var rightStart=this.left.length+this["break"];if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));var result=[];if(from>0)this.decomposeLeft(from,result);var left=result.length;var _iterator245=_createForOfIteratorHelper(nodes),_step245;try{for(_iterator245.s();!(_step245=_iterator245.n()).done;){var node=_step245.value;result.push(node)}}catch(err){_iterator245.e(err)}finally{_iterator245.f()}if(from>0)mergeGaps(result,left-1);if(to<this.length){var _right3=result.length;this.decomposeRight(to,result);mergeGaps(result,_right3)}return HeightMap.of(result)}},{key:"decomposeLeft",value:function decomposeLeft(to,result){var left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left);if(this["break"]){left++;if(to>=left)result.push(null)}if(to>left)this.right.decomposeLeft(to-left,result)}},{key:"decomposeRight",value:function decomposeRight(from,result){var left=this.left.length,right=left+this["break"];if(from>=right)return this.right.decomposeRight(from-right,result);if(from<left)this.left.decomposeRight(from,result);if(this["break"]&&from<right)result.push(null);result.push(this.right)}},{key:"balanced",value:function balanced(left,right){if(left.size>2*right.size||right.size>2*left.size)return HeightMap.of(this["break"]?[left,null,right]:[left,right]);this.left=left;this.right=right;this.height=left.height+right.height;this.outdated=left.outdated||right.outdated;this.size=left.size+right.size;this.length=left.length+this["break"]+right.length;return this}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var left=this.left,right=this.right,rightStart=offset+left.length+this["break"],rebalance=null;if(measured&&measured.from<=offset+left.length&&measured.more)rebalance=left=left.updateHeight(oracle,offset,force,measured);else left.updateHeight(oracle,offset,force);if(measured&&measured.from<=rightStart+right.length&&measured.more)rebalance=right=right.updateHeight(oracle,rightStart,force,measured);else right.updateHeight(oracle,rightStart,force);if(rebalance)return this.balanced(left,right);this.height=this.left.height+this.right.height;this.outdated=false;return this}},{key:"toString",value:function toString(){return this.left+(this["break"]?" ":"-")+this.right}}]);return HeightMapBranch}(HeightMap);function mergeGaps(nodes,around){var before,after;if(nodes[around]==null&&(before=nodes[around-1])instanceof HeightMapGap&&(after=nodes[around+1])instanceof HeightMapGap)nodes.splice(around-1,3,new HeightMapGap(before.length+1+after.length))}var relevantWidgetHeight=5;var NodeBuilder=function(){function NodeBuilder(pos,oracle){_classCallCheck2(this,NodeBuilder);this.pos=pos;this.oracle=oracle;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=pos}_createClass2(NodeBuilder,[{key:"isCovered",get:function get(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}},{key:"span",value:function span(_from,to){if(this.lineStart>-1){var _end29=Math.min(to,this.lineEnd),last=this.nodes[this.nodes.length-1];if(last instanceof HeightMapText)last.length+=_end29-this.pos;else if(_end29>this.pos||!this.isCovered)this.nodes.push(new HeightMapText(_end29-this.pos,-1));this.writtenTo=_end29;if(to>_end29){this.nodes.push(null);this.writtenTo++;this.lineStart=-1}}this.pos=to}},{key:"point",value:function point(from,to,deco){if(from<to||deco.heightRelevant){var height=deco.widget?deco.widget.estimatedHeight:0;var breaks=deco.widget?deco.widget.lineBreaks:0;if(height<0)height=this.oracle.lineHeight;var len=to-from;if(deco.block){this.addBlock(new HeightMapBlock(len,height,deco))}else if(len||breaks||height>=relevantWidgetHeight){this.addLineDeco(height,breaks,len)}}else if(to>from){this.span(from,to)}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to}},{key:"enterLine",value:function enterLine(){if(this.lineStart>-1)return;var _this$oracle$doc$line=this.oracle.doc.lineAt(this.pos),from=_this$oracle$doc$line.from,to=_this$oracle$doc$line.to;this.lineStart=from;this.lineEnd=to;if(this.writtenTo<from){if(this.writtenTo<from-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,from-1));this.nodes.push(null)}if(this.pos>from)this.nodes.push(new HeightMapText(this.pos-from,-1));this.writtenTo=this.pos}},{key:"blankContent",value:function blankContent(from,to){var gap=new HeightMapGap(to-from);if(this.oracle.doc.lineAt(from).to==to)gap.flags|=4;return gap}},{key:"ensureLine",value:function ensureLine(){this.enterLine();var last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText)return last;var line=new HeightMapText(0,-1);this.nodes.push(line);return line}},{key:"addBlock",value:function addBlock(block){this.enterLine();var deco=block.deco;if(deco&&deco.startSide>0&&!this.isCovered)this.ensureLine();this.nodes.push(block);this.writtenTo=this.pos=this.pos+block.length;if(deco&&deco.endSide>0)this.covering=block}},{key:"addLineDeco",value:function addLineDeco(height,breaks,length){var line=this.ensureLine();line.length+=length;line.collapsed+=length;line.widgetHeight=Math.max(line.widgetHeight,height);line.breaks+=breaks;this.writtenTo=this.pos=this.pos+length}},{key:"finish",value:function finish(from){var last=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(last instanceof HeightMapText)&&!this.isCovered)this.nodes.push(new HeightMapText(0,-1));else if(this.writtenTo<this.pos||last==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var pos=from;var _iterator246=_createForOfIteratorHelper(this.nodes),_step246;try{for(_iterator246.s();!(_step246=_iterator246.n()).done;){var node=_step246.value;if(node instanceof HeightMapText)node.updateHeight(this.oracle,pos);pos+=node?node.length:1}}catch(err){_iterator246.e(err)}finally{_iterator246.f()}return this.nodes}}],[{key:"build",value:function build(oracle,decorations,from,to){var builder=new NodeBuilder(from,oracle);RangeSet.spans(decorations,from,to,builder,0);return builder.finish(from)}}]);return NodeBuilder}();function heightRelevantDecoChanges(a,b,diff){var comp=new DecorationComparator;RangeSet.compare(a,b,diff,comp,0);return comp.changes}var DecorationComparator=function(){function DecorationComparator(){_classCallCheck2(this,DecorationComparator);this.changes=[]}_createClass2(DecorationComparator,[{key:"compareRange",value:function compareRange(){}},{key:"comparePoint",value:function comparePoint(from,to,a,b){if(from<to||a&&a.heightRelevant||b&&b.heightRelevant)addRange(from,to,this.changes,5)}}]);return DecorationComparator}();function visiblePixelRange(dom,paddingTop){var rect=dom.getBoundingClientRect();var doc=dom.ownerDocument,win=doc.defaultView||window;var left=Math.max(0,rect.left),right=Math.min(win.innerWidth,rect.right);var top=Math.max(0,rect.top),bottom=Math.min(win.innerHeight,rect.bottom);for(var parent=dom.parentNode;parent&&parent!=doc.body;){if(parent.nodeType==1){var _elt3=parent;var style=window.getComputedStyle(_elt3);if((_elt3.scrollHeight>_elt3.clientHeight||_elt3.scrollWidth>_elt3.clientWidth)&&style.overflow!="visible"){var parentRect=_elt3.getBoundingClientRect();left=Math.max(left,parentRect.left);right=Math.min(right,parentRect.right);top=Math.max(top,parentRect.top);bottom=parent==dom.parentNode?parentRect.bottom:Math.min(bottom,parentRect.bottom)}parent=style.position=="absolute"||style.position=="fixed"?_elt3.offsetParent:_elt3.parentNode}else if(parent.nodeType==11){parent=parent.host}else{break}}return{left:left-rect.left,right:Math.max(left,right)-rect.left,top:top-(rect.top+paddingTop),bottom:Math.max(top,bottom)-(rect.top+paddingTop)}}function fullPixelRange(dom,paddingTop){var rect=dom.getBoundingClientRect();return{left:0,right:rect.right-rect.left,top:paddingTop,bottom:rect.bottom-(rect.top+paddingTop)}}var LineGap=function(){function LineGap(from,to,size){_classCallCheck2(this,LineGap);this.from=from;this.to=to;this.size=size}_createClass2(LineGap,[{key:"draw",value:function draw(viewState,wrapping){return Decoration.replace({widget:new LineGapWidget(this.size*(wrapping?viewState.scaleY:viewState.scaleX),wrapping)}).range(this.from,this.to)}}],[{key:"same",value:function same(a,b){if(a.length!=b.length)return false;for(var _i190=0;_i190<a.length;_i190++){var gA=a[_i190],gB=b[_i190];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return false}return true}}]);return LineGap}();var LineGapWidget=function(_WidgetType3){_inherits2(LineGapWidget,_WidgetType3);var _super89=_createSuper(LineGapWidget);function LineGapWidget(size,vertical){var _this203;_classCallCheck2(this,LineGapWidget);_this203=_super89.call(this);_this203.size=size;_this203.vertical=vertical;return _this203}_createClass2(LineGapWidget,[{key:"eq",value:function eq(other){return other.size==this.size&&other.vertical==this.vertical}},{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");if(this.vertical){elt.style.height=this.size+"px"}else{elt.style.width=this.size+"px";elt.style.height="2px";elt.style.display="inline-block"}return elt}},{key:"estimatedHeight",get:function get(){return this.vertical?this.size:-1}}]);return LineGapWidget}(WidgetType);var ViewState=function(){function ViewState(state){var _this204=this;_classCallCheck2(this,ViewState);this.state=state;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentDOMWidth=0;this.contentDOMHeight=0;this.editorHeight=0;this.editorWidth=0;this.scrollTop=0;this.scrolledToBottom=true;this.scaleX=1;this.scaleY=1;this.scrollAnchorPos=0;this.scrollAnchorHeight=-1;this.scaler=IdScaler;this.scrollTarget=null;this.printing=false;this.mustMeasureContent=true;this.defaultTextDirection=Direction.LTR;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;var guessWrapping=state.facet(contentAttributes).some(function(v){return typeof v!="function"&&v["class"]=="cm-lineWrapping"});this.heightOracle=new HeightOracle(guessWrapping);this.stateDeco=state.facet(decorations).filter(function(d){return typeof d!="function"});this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(state.doc),[new ChangedRange(0,0,0,state.doc.length)]);this.viewport=this.getViewport(0,null);this.updateViewportLines();this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration.set(this.lineGaps.map(function(gap){return gap.draw(_this204,false)}));this.computeVisibleRanges()}_createClass2(ViewState,[{key:"updateForViewport",value:function updateForViewport(){var _this205=this;var viewports=[this.viewport],main=this.state.selection.main;var _loop15=function _loop15(){var pos=_i191?main.head:main.anchor;if(!viewports.some(function(_ref223){var from=_ref223.from,to=_ref223.to;return pos>=from&&pos<=to})){var _this205$lineBlockAt=_this205.lineBlockAt(pos),from=_this205$lineBlockAt.from,to=_this205$lineBlockAt.to;viewports.push(new Viewport(from,to))}};for(var _i191=0;_i191<=1;_i191++){_loop15()}this.viewports=viewports.sort(function(a,b){return a.from-b.from});this.scaler=this.heightMap.height<=7000000?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports)}},{key:"updateViewportLines",value:function updateViewportLines(){var _this206=this;this.viewportLines=[];this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,function(block){_this206.viewportLines.push(_this206.scaler.scale==1?block:scaleBlock(block,_this206.scaler))})}},{key:"update",value:function update(_update5){var scrollTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.state=_update5.state;var prevDeco=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(function(d){return typeof d!="function"});var contentChanges=_update5.changedRanges;var heightChanges=ChangedRange.extendWithRanges(contentChanges,heightRelevantDecoChanges(prevDeco,this.stateDeco,_update5?_update5.changes:ChangeSet.empty(this.state.doc.length)));var prevHeight=this.heightMap.height;var scrollAnchor=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,_update5.startState.doc,this.heightOracle.setDoc(this.state.doc),heightChanges);if(this.heightMap.height!=prevHeight)_update5.flags|=2;if(scrollAnchor){this.scrollAnchorPos=_update5.changes.mapPos(scrollAnchor.from,-1);this.scrollAnchorHeight=scrollAnchor.top}else{this.scrollAnchorPos=-1;this.scrollAnchorHeight=this.heightMap.height}var viewport=heightChanges.length?this.mapViewport(this.viewport,_update5.changes):this.viewport;if(scrollTarget&&(scrollTarget.range.head<viewport.from||scrollTarget.range.head>viewport.to)||!this.viewportIsAppropriate(viewport))viewport=this.getViewport(0,scrollTarget);var updateLines=!_update5.changes.empty||_update5.flags&2||viewport.from!=this.viewport.from||viewport.to!=this.viewport.to;this.viewport=viewport;this.updateForViewport();if(updateLines)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>2000<<1)this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,_update5.changes)));_update5.flags|=this.computeVisibleRanges();if(scrollTarget)this.scrollTarget=scrollTarget;if(!this.mustEnforceCursorAssoc&&_update5.selectionSet&&_update5.view.lineWrapping&&_update5.state.selection.main.empty&&_update5.state.selection.main.assoc&&!_update5.state.facet(nativeSelectionHidden))this.mustEnforceCursorAssoc=true}},{key:"measure",value:function measure(view){var dom=view.contentDOM,style=window.getComputedStyle(dom);var oracle=this.heightOracle;var whiteSpace=style.whiteSpace;this.defaultTextDirection=style.direction=="rtl"?Direction.RTL:Direction.LTR;var refresh=this.heightOracle.mustRefreshForWrapping(whiteSpace);var domRect=dom.getBoundingClientRect();var measureContent=refresh||this.mustMeasureContent||this.contentDOMHeight!=domRect.height;this.contentDOMHeight=domRect.height;this.mustMeasureContent=false;var result=0,bias=0;if(domRect.width&&domRect.height){var _getScale2=getScale(dom,domRect),scaleX=_getScale2.scaleX,scaleY=_getScale2.scaleY;if(this.scaleX!=scaleX||this.scaleY!=scaleY){this.scaleX=scaleX;this.scaleY=scaleY;result|=8;refresh=measureContent=true}}var paddingTop=(parseInt(style.paddingTop)||0)*this.scaleY;var paddingBottom=(parseInt(style.paddingBottom)||0)*this.scaleY;if(this.paddingTop!=paddingTop||this.paddingBottom!=paddingBottom){this.paddingTop=paddingTop;this.paddingBottom=paddingBottom;result|=8|2}if(this.editorWidth!=view.scrollDOM.clientWidth){if(oracle.lineWrapping)measureContent=true;this.editorWidth=view.scrollDOM.clientWidth;result|=8}var scrollTop=view.scrollDOM.scrollTop*this.scaleY;if(this.scrollTop!=scrollTop){this.scrollAnchorHeight=-1;this.scrollTop=scrollTop}this.scrolledToBottom=isScrolledToBottom(view.scrollDOM);var pixelViewport=(this.printing?fullPixelRange:visiblePixelRange)(dom,this.paddingTop);var dTop=pixelViewport.top-this.pixelViewport.top,dBottom=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;var inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(inView!=this.inView){this.inView=inView;if(inView)measureContent=true}if(!this.inView&&!this.scrollTarget)return 0;var contentWidth=domRect.width;if(this.contentDOMWidth!=contentWidth||this.editorHeight!=view.scrollDOM.clientHeight){this.contentDOMWidth=domRect.width;this.editorHeight=view.scrollDOM.clientHeight;result|=8}if(measureContent){var lineHeights=view.docView.measureVisibleLineHeights(this.viewport);if(oracle.mustRefreshForHeights(lineHeights))refresh=true;if(refresh||oracle.lineWrapping&&Math.abs(contentWidth-this.contentDOMWidth)>oracle.charWidth){var _view$docView$measure=view.docView.measureTextSize(),lineHeight=_view$docView$measure.lineHeight,charWidth=_view$docView$measure.charWidth,textHeight=_view$docView$measure.textHeight;refresh=lineHeight>0&&oracle.refresh(whiteSpace,lineHeight,charWidth,textHeight,contentWidth/charWidth,lineHeights);if(refresh){view.docView.minWidth=0;result|=8}}if(dTop>0&&dBottom>0)bias=Math.max(dTop,dBottom);else if(dTop<0&&dBottom<0)bias=Math.min(dTop,dBottom);oracle.heightChanged=false;var _iterator247=_createForOfIteratorHelper(this.viewports),_step247;try{for(_iterator247.s();!(_step247=_iterator247.n()).done;){var vp=_step247.value;var heights=vp.from==this.viewport.from?lineHeights:view.docView.measureVisibleLineHeights(vp);this.heightMap=(refresh?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,view.state.doc.length)]):this.heightMap).updateHeight(oracle,0,refresh,new MeasuredHeights(vp.from,heights))}}catch(err){_iterator247.e(err)}finally{_iterator247.f()}if(oracle.heightChanged)result|=2}var viewportChange=!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);if(viewportChange)this.viewport=this.getViewport(bias,this.scrollTarget);this.updateForViewport();if(result&2||viewportChange)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>2000<<1)this.updateLineGaps(this.ensureLineGaps(refresh?[]:this.lineGaps,view));result|=this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;view.docView.enforceCursorAssoc()}return result}},{key:"visibleTop",get:function get(){return this.scaler.fromDOM(this.pixelViewport.top)}},{key:"visibleBottom",get:function get(){return this.scaler.fromDOM(this.pixelViewport.bottom)}},{key:"getViewport",value:function getViewport(bias,scrollTarget){var marginTop=0.5-Math.max(-0.5,Math.min(0.5,bias/1000/2));var map=this.heightMap,oracle=this.heightOracle;var visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;var viewport=new Viewport(map.lineAt(visibleTop-marginTop*1000,QueryType$1.ByHeight,oracle,0,0).from,map.lineAt(visibleBottom+(1-marginTop)*1000,QueryType$1.ByHeight,oracle,0,0).to);if(scrollTarget){var head=scrollTarget.range.head;if(head<viewport.from||head>viewport.to){var viewHeight=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top);var block=map.lineAt(head,QueryType$1.ByPos,oracle,0,0),topPos;if(scrollTarget.y=="center")topPos=(block.top+block.bottom)/2-viewHeight/2;else if(scrollTarget.y=="start"||scrollTarget.y=="nearest"&&head<viewport.from)topPos=block.top;else topPos=block.bottom-viewHeight;viewport=new Viewport(map.lineAt(topPos-1000/2,QueryType$1.ByHeight,oracle,0,0).from,map.lineAt(topPos+viewHeight+1000/2,QueryType$1.ByHeight,oracle,0,0).to)}}return viewport}},{key:"mapViewport",value:function mapViewport(viewport,changes){var from=changes.mapPos(viewport.from,-1),to=changes.mapPos(viewport.to,1);return new Viewport(this.heightMap.lineAt(from,QueryType$1.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(to,QueryType$1.ByPos,this.heightOracle,0,0).to)}},{key:"viewportIsAppropriate",value:function viewportIsAppropriate(_ref224){var from=_ref224.from,to=_ref224.to;var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!this.inView)return true;var _this$heightMap$lineA=this.heightMap.lineAt(from,QueryType$1.ByPos,this.heightOracle,0,0),top=_this$heightMap$lineA.top;var _this$heightMap$lineA2=this.heightMap.lineAt(to,QueryType$1.ByPos,this.heightOracle,0,0),bottom=_this$heightMap$lineA2.bottom;var visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;return(from==0||top<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top>visibleTop-2*1000&&bottom<visibleBottom+2*1000}},{key:"mapLineGaps",value:function mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;var mapped=[];var _iterator248=_createForOfIteratorHelper(gaps),_step248;try{for(_iterator248.s();!(_step248=_iterator248.n()).done;){var gap=_step248.value;if(!changes.touchesRange(gap.from,gap.to))mapped.push(new LineGap(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size))}}catch(err){_iterator248.e(err)}finally{_iterator248.f()}return mapped}},{key:"ensureLineGaps",value:function ensureLineGaps(current,mayMeasure){var _this207=this;var wrapping=this.heightOracle.lineWrapping;var margin=wrapping?10000:2000,halfMargin=margin>>1,doubleMargin=margin<<1;if(this.defaultTextDirection!=Direction.LTR&&!wrapping)return[];var gaps=[];var addGap=function addGap(from,to,line,structure){if(to-from<halfMargin)return;var sel=_this207.state.selection.main,avoid=[sel.from];if(!sel.empty)avoid.push(sel.to);for(var _i192=0,_avoid=avoid;_i192<_avoid.length;_i192++){var pos=_avoid[_i192];if(pos>from&&pos<to){addGap(from,pos-10,line,structure);addGap(pos+10,to,line,structure);return}}var gap=find(current,function(gap){return gap.from>=line.from&&gap.to<=line.to&&Math.abs(gap.from-from)<halfMargin&&Math.abs(gap.to-to)<halfMargin&&!avoid.some(function(pos){return gap.from<pos&&gap.to>pos})});if(!gap){if(to<line.to&&mayMeasure&&wrapping&&mayMeasure.visibleRanges.some(function(r){return r.from<=to&&r.to>=to})){var lineStart=mayMeasure.moveToLineBoundary(EditorSelection.cursor(to),false,true).head;if(lineStart>from)to=lineStart}gap=new LineGap(from,to,_this207.gapSize(line,from,to,structure))}gaps.push(gap)};var _iterator249=_createForOfIteratorHelper(this.viewportLines),_step249;try{for(_iterator249.s();!(_step249=_iterator249.n()).done;){var line=_step249.value;if(line.length<doubleMargin)continue;var structure=lineStructure(line.from,line.to,this.stateDeco);if(structure.total<doubleMargin)continue;var target=this.scrollTarget?this.scrollTarget.range.head:null;var viewFrom=void 0,viewTo=void 0;if(wrapping){var marginHeight=margin/this.heightOracle.lineLength*this.heightOracle.lineHeight;var _top6=void 0,bot=void 0;if(target!=null){var targetFrac=findFraction(structure,target);var spaceFrac=((this.visibleBottom-this.visibleTop)/2+marginHeight)/line.height;_top6=targetFrac-spaceFrac;bot=targetFrac+spaceFrac}else{_top6=(this.visibleTop-line.top-marginHeight)/line.height;bot=(this.visibleBottom-line.top+marginHeight)/line.height}viewFrom=findPosition(structure,_top6);viewTo=findPosition(structure,bot)}else{var totalWidth=structure.total*this.heightOracle.charWidth;var marginWidth=margin*this.heightOracle.charWidth;var _left4=void 0,_right4=void 0;if(target!=null){var _targetFrac=findFraction(structure,target);var _spaceFrac=((this.pixelViewport.right-this.pixelViewport.left)/2+marginWidth)/totalWidth;_left4=_targetFrac-_spaceFrac;_right4=_targetFrac+_spaceFrac}else{_left4=(this.pixelViewport.left-marginWidth)/totalWidth;_right4=(this.pixelViewport.right+marginWidth)/totalWidth}viewFrom=findPosition(structure,_left4);viewTo=findPosition(structure,_right4)}if(viewFrom>line.from)addGap(line.from,viewFrom,line,structure);if(viewTo<line.to)addGap(viewTo,line.to,line,structure)}}catch(err){_iterator249.e(err)}finally{_iterator249.f()}return gaps}},{key:"gapSize",value:function gapSize(line,from,to,structure){var fraction=findFraction(structure,to)-findFraction(structure,from);if(this.heightOracle.lineWrapping){return line.height*fraction}else{return structure.total*this.heightOracle.charWidth*fraction}}},{key:"updateLineGaps",value:function updateLineGaps(gaps){var _this208=this;if(!LineGap.same(gaps,this.lineGaps)){this.lineGaps=gaps;this.lineGapDeco=Decoration.set(gaps.map(function(gap){return gap.draw(_this208,_this208.heightOracle.lineWrapping)}))}}},{key:"computeVisibleRanges",value:function computeVisibleRanges(){var deco=this.stateDeco;if(this.lineGaps.length)deco=deco.concat(this.lineGapDeco);var ranges=[];RangeSet.spans(deco,this.viewport.from,this.viewport.to,{span:function span(from,to){ranges.push({from:from,to:to})},point:function point(){}},20);var changed=ranges.length!=this.visibleRanges.length||this.visibleRanges.some(function(r,i){return r.from!=ranges[i].from||r.to!=ranges[i].to});this.visibleRanges=ranges;return changed?4:0}},{key:"lineBlockAt",value:function lineBlockAt(pos){return pos>=this.viewport.from&&pos<=this.viewport.to&&this.viewportLines.find(function(b){return b.from<=pos&&b.to>=pos})||scaleBlock(this.heightMap.lineAt(pos,QueryType$1.ByPos,this.heightOracle,0,0),this.scaler)}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(height),QueryType$1.ByHeight,this.heightOracle,0,0),this.scaler)}},{key:"scrollAnchorAt",value:function scrollAnchorAt(scrollTop){var block=this.lineBlockAtHeight(scrollTop+8);return block.from>=this.viewport.from||this.viewportLines[0].top-scrollTop>200?block:this.viewportLines[0]}},{key:"elementAtHeight",value:function elementAtHeight(height){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(height),this.heightOracle,0,0),this.scaler)}},{key:"docHeight",get:function get(){return this.scaler.toDOM(this.heightMap.height)}},{key:"contentHeight",get:function get(){return this.docHeight+this.paddingTop+this.paddingBottom}}]);return ViewState}();var Viewport=_createClass2(function Viewport(from,to){_classCallCheck2(this,Viewport);this.from=from;this.to=to});function lineStructure(from,to,stateDeco){var ranges=[],pos=from,total=0;RangeSet.spans(stateDeco,from,to,{span:function span(){},point:function point(from,to){if(from>pos){ranges.push({from:pos,to:from});total+=from-pos}pos=to}},20);if(pos<to){ranges.push({from:pos,to:to});total+=to-pos}return{total:total,ranges:ranges}}function findPosition(_ref225,ratio){var total=_ref225.total,ranges=_ref225.ranges;if(ratio<=0)return ranges[0].from;if(ratio>=1)return ranges[ranges.length-1].to;var dist=Math.floor(total*ratio);for(var _i193=0;;_i193++){var _ranges$_i=ranges[_i193],from=_ranges$_i.from,to=_ranges$_i.to,size=to-from;if(dist<=size)return from+dist;dist-=size}}function findFraction(structure,pos){var counted=0;var _iterator250=_createForOfIteratorHelper(structure.ranges),_step250;try{for(_iterator250.s();!(_step250=_iterator250.n()).done;){var _step250$value=_step250.value,from=_step250$value.from,to=_step250$value.to;if(pos<=to){counted+=pos-from;break}counted+=to-from}}catch(err){_iterator250.e(err)}finally{_iterator250.f()}return counted/structure.total}function find(array,f){var _iterator251=_createForOfIteratorHelper(array),_step251;try{for(_iterator251.s();!(_step251=_iterator251.n()).done;){var val=_step251.value;if(f(val))return val}}catch(err){_iterator251.e(err)}finally{_iterator251.f()}return undefined}var IdScaler={toDOM:function toDOM(n){return n},fromDOM:function fromDOM(n){return n},scale:1};var BigScaler=function(){function BigScaler(oracle,heightMap,viewports){_classCallCheck2(this,BigScaler);var vpHeight=0,base=0,domBase=0;this.viewports=viewports.map(function(_ref226){var from=_ref226.from,to=_ref226.to;var top=heightMap.lineAt(from,QueryType$1.ByPos,oracle,0,0).top;var bottom=heightMap.lineAt(to,QueryType$1.ByPos,oracle,0,0).bottom;vpHeight+=bottom-top;return{from:from,to:to,top:top,bottom:bottom,domTop:0,domBottom:0}});this.scale=(7000000-vpHeight)/(heightMap.height-vpHeight);var _iterator252=_createForOfIteratorHelper(this.viewports),_step252;try{for(_iterator252.s();!(_step252=_iterator252.n()).done;){var obj=_step252.value;obj.domTop=domBase+(obj.top-base)*this.scale;domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top);base=obj.bottom}}catch(err){_iterator252.e(err)}finally{_iterator252.f()}}_createClass2(BigScaler,[{key:"toDOM",value:function toDOM(n){for(var _i194=0,_base=0,domBase=0;;_i194++){var vp=_i194<this.viewports.length?this.viewports[_i194]:null;if(!vp||n<vp.top)return domBase+(n-_base)*this.scale;if(n<=vp.bottom)return vp.domTop+(n-vp.top);_base=vp.bottom;domBase=vp.domBottom}}},{key:"fromDOM",value:function fromDOM(n){for(var _i195=0,_base2=0,domBase=0;;_i195++){var vp=_i195<this.viewports.length?this.viewports[_i195]:null;if(!vp||n<vp.domTop)return _base2+(n-domBase)/this.scale;if(n<=vp.domBottom)return vp.top+(n-vp.domTop);_base2=vp.bottom;domBase=vp.domBottom}}}]);return BigScaler}();function scaleBlock(block,scaler){if(scaler.scale==1)return block;var bTop=scaler.toDOM(block.top),bBottom=scaler.toDOM(block.bottom);return new BlockInfo(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block._content)?block._content.map(function(b){return scaleBlock(b,scaler)}):block._content)}var _theme=Facet.define({combine:function combine(strs){return strs.join(" ")}});var darkTheme=Facet.define({combine:function combine(values){return values.indexOf(true)>-1}});var baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName();var lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(main,spec,scopes){return new StyleModule(spec,{finish:function finish(sel){return /&/.test(sel)?sel.replace(/&\w*/,function(m){if(m=="&")return main;if(!scopes||!scopes[m])throw new RangeError("Unsupported selector: ".concat(m));return scopes[m]}):main+" "+sel}})}var baseTheme$1$3=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:"url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"20\"><path stroke=\"%23888\" stroke-width=\"1\" fill=\"none\" d=\"M1 10H196L190 5M190 15L196 10M197 4L197 16\"/></svg>')",backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs);var LineBreakPlaceholder="\uFFFF";var DOMReader=function(){function DOMReader(points,state){_classCallCheck2(this,DOMReader);this.points=points;this.text="";this.lineSeparator=state.facet(EditorState.lineSeparator)}_createClass2(DOMReader,[{key:"append",value:function append(text){this.text+=text}},{key:"lineBreak",value:function lineBreak(){this.text+=LineBreakPlaceholder}},{key:"readRange",value:function readRange(start,end){if(!start)return this;var parent=start.parentNode;for(var _cur14=start;;){this.findPointBefore(parent,_cur14);var oldLen=this.text.length;this.readNode(_cur14);var next=_cur14.nextSibling;if(next==end)break;var view=ContentView.get(_cur14),nextView=ContentView.get(next);if(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement(_cur14))||isBlockElement(next)&&(_cur14.nodeName!="BR"||_cur14.cmIgnore)&&this.text.length>oldLen)this.lineBreak();_cur14=next}this.findPointBefore(parent,end);return this}},{key:"readTextNode",value:function readTextNode(node){var text=node.nodeValue;var _iterator253=_createForOfIteratorHelper(this.points),_step253;try{for(_iterator253.s();!(_step253=_iterator253.n()).done;){var _point=_step253.value;if(_point.node==node)_point.pos=this.text.length+Math.min(_point.offset,text.length)}}catch(err){_iterator253.e(err)}finally{_iterator253.f()}for(var off=0,re=this.lineSeparator?null:/\r\n?|\n/g;;){var nextBreak=-1,breakSize=1,m=void 0;if(this.lineSeparator){nextBreak=text.indexOf(this.lineSeparator,off);breakSize=this.lineSeparator.length}else if(m=re.exec(text)){nextBreak=m.index;breakSize=m[0].length}this.append(text.slice(off,nextBreak<0?text.length:nextBreak));if(nextBreak<0)break;this.lineBreak();if(breakSize>1){var _iterator254=_createForOfIteratorHelper(this.points),_step254;try{for(_iterator254.s();!(_step254=_iterator254.n()).done;){var point=_step254.value;if(point.node==node&&point.pos>this.text.length)point.pos-=breakSize-1}}catch(err){_iterator254.e(err)}finally{_iterator254.f()}}off=nextBreak+breakSize}}},{key:"readNode",value:function readNode(node){if(node.cmIgnore)return;var view=ContentView.get(node);var fromView=view&&view.overrideDOMText;if(fromView!=null){this.findPointInside(node,fromView.length);for(var _i196=fromView.iter();!_i196.next().done;){if(_i196.lineBreak)this.lineBreak();else this.append(_i196.value)}}else if(node.nodeType==3){this.readTextNode(node)}else if(node.nodeName=="BR"){if(node.nextSibling)this.lineBreak()}else if(node.nodeType==1){this.readRange(node.firstChild,null)}}},{key:"findPointBefore",value:function findPointBefore(node,next){var _iterator255=_createForOfIteratorHelper(this.points),_step255;try{for(_iterator255.s();!(_step255=_iterator255.n()).done;){var point=_step255.value;if(point.node==node&&node.childNodes[point.offset]==next)point.pos=this.text.length}}catch(err){_iterator255.e(err)}finally{_iterator255.f()}}},{key:"findPointInside",value:function findPointInside(node,length){var _iterator256=_createForOfIteratorHelper(this.points),_step256;try{for(_iterator256.s();!(_step256=_iterator256.n()).done;){var point=_step256.value;if(node.nodeType==3?point.node==node:node.contains(point.node))point.pos=this.text.length+(isAtEnd(node,point.node,point.offset)?length:0)}}catch(err){_iterator256.e(err)}finally{_iterator256.f()}}}]);return DOMReader}();function isAtEnd(parent,node,offset){for(;;){if(!node||offset<maxOffset(node))return false;if(node==parent)return true;offset=domIndex(node)+1;node=node.parentNode}}function isBlockElement(node){return node.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName)}var DOMPoint=_createClass2(function DOMPoint(node,offset){_classCallCheck2(this,DOMPoint);this.node=node;this.offset=offset;this.pos=-1});var DOMChange=_createClass2(function DOMChange(view,start,end,typeOver){_classCallCheck2(this,DOMChange);this.typeOver=typeOver;this.bounds=null;this.text="";var _view$docView=view.docView,iHead=_view$docView.impreciseHead,iAnchor=_view$docView.impreciseAnchor;if(view.state.readOnly&&start>-1){this.newSel=null}else if(start>-1&&(this.bounds=view.docView.domBoundsAround(start,end,0))){var selPoints=iHead||iAnchor?[]:selectionPoints(view);var reader=new DOMReader(selPoints,view.state);reader.readRange(this.bounds.startDOM,this.bounds.endDOM);this.text=reader.text;this.newSel=selectionFromPoints(selPoints,this.bounds.from)}else{var domSel=view.observer.selectionRange;var head=iHead&&iHead.node==domSel.focusNode&&iHead.offset==domSel.focusOffset||!contains(view.contentDOM,domSel.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset);var anchor=iAnchor&&iAnchor.node==domSel.anchorNode&&iAnchor.offset==domSel.anchorOffset||!contains(view.contentDOM,domSel.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset);var vp=view.viewport;if(browser.ios&&view.state.selection.main.empty&&head!=anchor&&(vp.from>0||vp.to<view.state.doc.length)){var offFrom=vp.from-Math.min(head,anchor),offTo=vp.to-Math.max(head,anchor);if((offFrom==0||offFrom==1)&&(offTo==0||offTo==-1)){head=0;anchor=view.state.doc.length}}this.newSel=EditorSelection.single(anchor,head)}});function applyDOMChange(view,domChange){var change;var newSel=domChange.newSel,sel=view.state.selection.main;var lastKey=view.inputState.lastKeyTime>Date.now()-100?view.inputState.lastKeyCode:-1;if(domChange.bounds){var _domChange$bounds=domChange.bounds,from=_domChange$bounds.from,to=_domChange$bounds.to;var preferredPos=sel.from,preferredSide=null;if(lastKey===8||browser.android&&domChange.text.length<to-from){preferredPos=sel.to;preferredSide="end"}var diff=findDiff(view.state.doc.sliceString(from,to,LineBreakPlaceholder),domChange.text,preferredPos-from,preferredSide);if(diff){if(browser.chrome&&lastKey==13&&diff.toB==diff.from+2&&domChange.text.slice(diff.from,diff.toB)==LineBreakPlaceholder+LineBreakPlaceholder)diff.toB--;change={from:from+diff.from,to:from+diff.toA,insert:Text.of(domChange.text.slice(diff.from,diff.toB).split(LineBreakPlaceholder))}}}else if(newSel&&(!view.hasFocus&&view.state.facet(editable)||newSel.main.eq(sel))){newSel=null}if(!change&&!newSel)return false;if(!change&&domChange.typeOver&&!sel.empty&&newSel&&newSel.main.empty){change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)}}else if(change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&sel.to-sel.from-(change.to-change.from)<=4){change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))}}else if((browser.mac||browser.android)&&change&&change.from==change.to&&change.from==sel.head-1&&/^\. ?$/.test(change.insert.toString())&&view.contentDOM.getAttribute("autocorrect")=="off"){if(newSel&&change.insert.length==2)newSel=EditorSelection.single(newSel.main.anchor-1,newSel.main.head-1);change={from:sel.from,to:sel.to,insert:Text.of([" "])}}else if(browser.chrome&&change&&change.from==change.to&&change.from==sel.head&&change.insert.toString()=="\n "&&view.lineWrapping){if(newSel)newSel=EditorSelection.single(newSel.main.anchor-1,newSel.main.head-1);change={from:sel.from,to:sel.to,insert:Text.of([" "])}}if(change){if(browser.ios&&view.inputState.flushIOSKey())return true;if(browser.android&&(change.from==sel.from&&change.to==sel.to&&change.insert.length==1&&change.insert.lines==2&&dispatchKey(view.contentDOM,"Enter",13)||(change.from==sel.from-1&&change.to==sel.to&&change.insert.length==0||lastKey==8&&change.insert.length<change.to-change.from&&change.to>sel.head)&&dispatchKey(view.contentDOM,"Backspace",8)||change.from==sel.from&&change.to==sel.to+1&&change.insert.length==0&&dispatchKey(view.contentDOM,"Delete",46)))return true;var _text6=change.insert.toString();if(view.inputState.composing>=0)view.inputState.composing++;var defaultTr;var defaultInsert=function defaultInsert(){return defaultTr||(defaultTr=applyDefaultInsert(view,change,newSel))};if(!view.state.facet(inputHandler$1).some(function(h){return h(view,change.from,change.to,_text6,defaultInsert)}))view.dispatch(defaultInsert());return true}else if(newSel&&!newSel.main.eq(sel)){var _scrollIntoView3=false,userEvent="select";if(view.inputState.lastSelectionTime>Date.now()-50){if(view.inputState.lastSelectionOrigin=="select")_scrollIntoView3=true;userEvent=view.inputState.lastSelectionOrigin}view.dispatch({selection:newSel,scrollIntoView:_scrollIntoView3,userEvent:userEvent});return true}else{return false}}function applyDefaultInsert(view,change,newSel){var tr,startState=view.state,sel=startState.selection.main;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)&&view.inputState.composing<0){var _before2=sel.from<change.from?startState.sliceDoc(sel.from,change.from):"";var _after4=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"";tr=startState.replaceSelection(view.state.toText(_before2+change.insert.sliceString(0,undefined,view.state.lineBreak)+_after4))}else{var changes=startState.changes(change);var mainSel=newSel&&newSel.main.to<=changes.newLength?newSel.main:undefined;if(startState.selection.ranges.length>1&&view.inputState.composing>=0&&change.to<=sel.to&&change.to>=sel.to-10){var replaced=view.state.sliceDoc(change.from,change.to);var compositionRange,composition=newSel&&findCompositionNode(view,newSel.main.head);if(composition){var dLen=change.insert.length-(change.to-change.from);compositionRange={from:composition.from,to:composition.to-dLen}}else{compositionRange=view.state.doc.lineAt(sel.head)}var _offset5=sel.to-change.to,size=sel.to-sel.from;tr=startState.changeByRange(function(range){if(range.from==sel.from&&range.to==sel.to)return{changes:changes,range:mainSel||range.map(changes)};var to=range.to-_offset5,from=to-replaced.length;if(range.to-range.from!=size||view.state.sliceDoc(from,to)!=replaced||range.to>=compositionRange.from&&range.from<=compositionRange.to)return{range:range};var rangeChanges=startState.changes({from:from,to:to,insert:change.insert}),selOff=range.to-sel.to;return{changes:rangeChanges,range:!mainSel?range.map(rangeChanges):EditorSelection.range(Math.max(0,mainSel.anchor+selOff),Math.max(0,mainSel.head+selOff))}})}else{tr={changes:changes,selection:mainSel&&startState.selection.replaceRange(mainSel)}}}var userEvent="input.type";if(view.composing||view.inputState.compositionPendingChange&&view.inputState.compositionEndedAt>Date.now()-50){view.inputState.compositionPendingChange=false;userEvent+=".compose";if(view.inputState.compositionFirstChange){userEvent+=".start";view.inputState.compositionFirstChange=false}}return startState.update(tr,{userEvent:userEvent,scrollIntoView:true})}function findDiff(a,b,preferredPos,preferredSide){var minLen=Math.min(a.length,b.length);var from=0;while(from<minLen&&a.charCodeAt(from)==b.charCodeAt(from))from++;if(from==minLen&&a.length==b.length)return null;var toA=a.length,toB=b.length;while(toA>0&&toB>0&&a.charCodeAt(toA-1)==b.charCodeAt(toB-1)){toA--;toB--}if(preferredSide=="end"){var adjust=Math.max(0,from-Math.min(toA,toB));preferredPos-=toA+adjust-from}if(toA<from&&a.length<b.length){var move=preferredPos<=from&&preferredPos>=toA?from-preferredPos:0;from-=move;toB=from+(toB-toA);toA=from}else if(toB<from){var _move=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0;from-=_move;toA=from+(toA-toB);toB=from}return{from:from,toA:toA,toB:toB}}function selectionPoints(view){var result=[];if(view.root.activeElement!=view.contentDOM)return result;var _view$observer$select2=view.observer.selectionRange,anchorNode=_view$observer$select2.anchorNode,anchorOffset=_view$observer$select2.anchorOffset,focusNode=_view$observer$select2.focusNode,focusOffset=_view$observer$select2.focusOffset;if(anchorNode){result.push(new DOMPoint(anchorNode,anchorOffset));if(focusNode!=anchorNode||focusOffset!=anchorOffset)result.push(new DOMPoint(focusNode,focusOffset))}return result}function selectionFromPoints(points,base){if(points.length==0)return null;var anchor=points[0].pos,head=points.length==2?points[1].pos:anchor;return anchor>-1&&head>-1?EditorSelection.single(anchor+base,head+base):null}var observeOptions={childList:true,characterData:true,subtree:true,attributes:true,characterDataOldValue:true};var useCharData=browser.ie&&browser.ie_version<=11;var DOMObserver=function(){function DOMObserver(view){var _this209=this;_classCallCheck2(this,DOMObserver);this.view=view;this.active=false;this.selectionRange=new DOMSelectionState;this.selectionChanged=false;this.delayedFlush=-1;this.resizeTimeout=-1;this.queue=[];this.delayedAndroidKey=null;this.flushingAndroidKey=-1;this.lastChange=0;this.scrollTargets=[];this.intersection=null;this.resizeScroll=null;this.intersecting=false;this.gapIntersection=null;this.gaps=[];this.parentCheck=-1;this.dom=view.contentDOM;this.observer=new MutationObserver(function(mutations){var _iterator257=_createForOfIteratorHelper(mutations),_step257;try{for(_iterator257.s();!(_step257=_iterator257.n()).done;){var mut=_step257.value;_this209.queue.push(mut)}}catch(err){_iterator257.e(err)}finally{_iterator257.f()}if((browser.ie&&browser.ie_version<=11||browser.ios&&view.composing)&&mutations.some(function(m){return m.type=="childList"&&m.removedNodes.length||m.type=="characterData"&&m.oldValue.length>m.target.nodeValue.length}))_this209.flushSoon();else _this209.flush()});if(useCharData)this.onCharData=function(event){_this209.queue.push({target:event.target,type:"characterData",oldValue:event.prevValue});_this209.flushSoon()};this.onSelectionChange=this.onSelectionChange.bind(this);this.onResize=this.onResize.bind(this);this.onPrint=this.onPrint.bind(this);this.onScroll=this.onScroll.bind(this);if(typeof ResizeObserver=="function"){this.resizeScroll=new ResizeObserver(function(){var _a;if(((_a=_this209.view.docView)===null||_a===void 0?void 0:_a.lastUpdate)<Date.now()-75)_this209.onResize()});this.resizeScroll.observe(view.scrollDOM)}this.addWindowListeners(this.win=view.win);this.start();if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver(function(entries){if(_this209.parentCheck<0)_this209.parentCheck=setTimeout(_this209.listenForScroll.bind(_this209),1000);if(entries.length>0&&entries[entries.length-1].intersectionRatio>0!=_this209.intersecting){_this209.intersecting=!_this209.intersecting;if(_this209.intersecting!=_this209.view.inView)_this209.onScrollChanged(document.createEvent("Event"))}},{threshold:[0,.001]});this.intersection.observe(this.dom);this.gapIntersection=new IntersectionObserver(function(entries){if(entries.length>0&&entries[entries.length-1].intersectionRatio>0)_this209.onScrollChanged(document.createEvent("Event"))},{})}this.listenForScroll();this.readSelectionRange()}_createClass2(DOMObserver,[{key:"onScrollChanged",value:function onScrollChanged(e){this.view.inputState.runHandlers("scroll",e);if(this.intersecting)this.view.measure()}},{key:"onScroll",value:function onScroll(e){if(this.intersecting)this.flush(false);this.onScrollChanged(e)}},{key:"onResize",value:function onResize(){var _this210=this;if(this.resizeTimeout<0)this.resizeTimeout=setTimeout(function(){_this210.resizeTimeout=-1;_this210.view.requestMeasure()},50)}},{key:"onPrint",value:function onPrint(){var _this211=this;this.view.viewState.printing=true;this.view.measure();setTimeout(function(){_this211.view.viewState.printing=false;_this211.view.requestMeasure()},500)}},{key:"updateGaps",value:function updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some(function(g,i){return g!=gaps[i]}))){this.gapIntersection.disconnect();var _iterator258=_createForOfIteratorHelper(gaps),_step258;try{for(_iterator258.s();!(_step258=_iterator258.n()).done;){var gap=_step258.value;this.gapIntersection.observe(gap)}}catch(err){_iterator258.e(err)}finally{_iterator258.f()}this.gaps=gaps}}},{key:"onSelectionChange",value:function onSelectionChange(event){var wasChanged=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;var view=this.view,sel=this.selectionRange;if(view.state.facet(editable)?view.root.activeElement!=this.dom:!hasSelection(view.dom,sel))return;var context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);if(context&&context.ignoreEvent(event)){if(!wasChanged)this.selectionChanged=false;return}if((browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))this.flushSoon();else this.flush(false)}},{key:"readSelectionRange",value:function readSelectionRange(){var view=this.view;var range=browser.safari&&view.root.nodeType==11&&deepActiveElement(this.dom.ownerDocument)==this.dom&&safariSelectionRangeHack(this.view)||getSelection(view.root);if(!range||this.selectionRange.eq(range))return false;var local=hasSelection(this.dom,range);if(local&&!this.selectionChanged&&view.inputState.lastFocusTime>Date.now()-200&&view.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,range)){this.view.inputState.lastFocusTime=0;view.docView.updateSelection();return false}this.selectionRange.setRange(range);if(local)this.selectionChanged=true;return true}},{key:"setSelectionRange",value:function setSelectionRange(anchor,head){this.selectionRange.set(anchor.node,anchor.offset,head.node,head.offset);this.selectionChanged=false}},{key:"clearSelectionRange",value:function clearSelectionRange(){this.selectionRange.set(null,0,null,0)}},{key:"listenForScroll",value:function listenForScroll(){this.parentCheck=-1;var i=0,changed=null;for(var dom=this.dom;dom;){if(dom.nodeType==1){if(!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom)i++;else if(!changed)changed=this.scrollTargets.slice(0,i);if(changed)changed.push(dom);dom=dom.assignedSlot||dom.parentNode}else if(dom.nodeType==11){dom=dom.host}else{break}}if(i<this.scrollTargets.length&&!changed)changed=this.scrollTargets.slice(0,i);if(changed){var _iterator259=_createForOfIteratorHelper(this.scrollTargets),_step259;try{for(_iterator259.s();!(_step259=_iterator259.n()).done;){var _dom2=_step259.value;_dom2.removeEventListener("scroll",this.onScroll)}}catch(err){_iterator259.e(err)}finally{_iterator259.f()}var _iterator260=_createForOfIteratorHelper(this.scrollTargets=changed),_step260;try{for(_iterator260.s();!(_step260=_iterator260.n()).done;){var _dom3=_step260.value;_dom3.addEventListener("scroll",this.onScroll)}}catch(err){_iterator260.e(err)}finally{_iterator260.f()}}}},{key:"ignore",value:function ignore(f){if(!this.active)return f();try{this.stop();return f()}finally{this.start();this.clear()}}},{key:"start",value:function start(){if(this.active)return;this.observer.observe(this.dom,observeOptions);if(useCharData)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true}},{key:"stop",value:function stop(){if(!this.active)return;this.active=false;this.observer.disconnect();if(useCharData)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData)}},{key:"clear",value:function clear(){this.processRecords();this.queue.length=0;this.selectionChanged=false}},{key:"delayAndroidKey",value:function delayAndroidKey(key,keyCode){var _this212=this;var _a;if(!this.delayedAndroidKey){var flush=function flush(){var key=_this212.delayedAndroidKey;if(key){_this212.clearDelayedAndroidKey();_this212.view.inputState.lastKeyCode=key.keyCode;_this212.view.inputState.lastKeyTime=Date.now();var flushed=_this212.flush();if(!flushed&&key.force)dispatchKey(_this212.dom,key.key,key.keyCode)}};this.flushingAndroidKey=this.view.win.requestAnimationFrame(flush)}if(!this.delayedAndroidKey||key=="Enter")this.delayedAndroidKey={key:key,keyCode:keyCode,force:this.lastChange<Date.now()-50||!!((_a=this.delayedAndroidKey)===null||_a===void 0?void 0:_a.force)}}},{key:"clearDelayedAndroidKey",value:function clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey);this.delayedAndroidKey=null;this.flushingAndroidKey=-1}},{key:"flushSoon",value:function flushSoon(){var _this213=this;if(this.delayedFlush<0)this.delayedFlush=this.view.win.requestAnimationFrame(function(){_this213.delayedFlush=-1;_this213.flush()})}},{key:"forceFlush",value:function forceFlush(){if(this.delayedFlush>=0){this.view.win.cancelAnimationFrame(this.delayedFlush);this.delayedFlush=-1}this.flush()}},{key:"pendingRecords",value:function pendingRecords(){var _iterator261=_createForOfIteratorHelper(this.observer.takeRecords()),_step261;try{for(_iterator261.s();!(_step261=_iterator261.n()).done;){var mut=_step261.value;this.queue.push(mut)}}catch(err){_iterator261.e(err)}finally{_iterator261.f()}return this.queue}},{key:"processRecords",value:function processRecords(){var records=this.pendingRecords();if(records.length)this.queue=[];var from=-1,to=-1,typeOver=false;var _iterator262=_createForOfIteratorHelper(records),_step262;try{for(_iterator262.s();!(_step262=_iterator262.n()).done;){var record=_step262.value;var range=this.readMutation(record);if(!range)continue;if(range.typeOver)typeOver=true;if(from==-1){from=range.from;to=range.to}else{from=Math.min(range.from,from);to=Math.max(range.to,to)}}}catch(err){_iterator262.e(err)}finally{_iterator262.f()}return{from:from,to:to,typeOver:typeOver}}},{key:"readChange",value:function readChange(){var _this$processRecords=this.processRecords(),from=_this$processRecords.from,to=_this$processRecords.to,typeOver=_this$processRecords.typeOver;var newSel=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(from<0&&!newSel)return null;if(from>-1)this.lastChange=Date.now();this.view.inputState.lastFocusTime=0;this.selectionChanged=false;var change=new DOMChange(this.view,from,to,typeOver);this.view.docView.domChanged={newSel:change.newSel?change.newSel.main:null};return change}},{key:"flush",value:function flush(){var readSelection=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.delayedFlush>=0||this.delayedAndroidKey)return false;if(readSelection)this.readSelectionRange();var domChange=this.readChange();if(!domChange){this.view.requestMeasure();return false}var startState=this.view.state;var handled=applyDOMChange(this.view,domChange);if(this.view.state==startState)this.view.update([]);return handled}},{key:"readMutation",value:function readMutation(rec){var cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;cView.markDirty(rec.type=="attributes");if(rec.type=="attributes")cView.flags|=4;if(rec.type=="childList"){var childBefore=findChild(cView,rec.previousSibling||rec.target.previousSibling,-1);var childAfter=findChild(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:childAfter?cView.posBefore(childAfter):cView.posAtEnd,typeOver:false}}else if(rec.type=="characterData"){return{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue}}else{return null}}},{key:"setWindow",value:function setWindow(win){if(win!=this.win){this.removeWindowListeners(this.win);this.win=win;this.addWindowListeners(this.win)}}},{key:"addWindowListeners",value:function addWindowListeners(win){win.addEventListener("resize",this.onResize);win.addEventListener("beforeprint",this.onPrint);win.addEventListener("scroll",this.onScroll);win.document.addEventListener("selectionchange",this.onSelectionChange)}},{key:"removeWindowListeners",value:function removeWindowListeners(win){win.removeEventListener("scroll",this.onScroll);win.removeEventListener("resize",this.onResize);win.removeEventListener("beforeprint",this.onPrint);win.document.removeEventListener("selectionchange",this.onSelectionChange)}},{key:"destroy",value:function destroy(){var _a,_b,_c;this.stop();(_a=this.intersection)===null||_a===void 0?void 0:_a.disconnect();(_b=this.gapIntersection)===null||_b===void 0?void 0:_b.disconnect();(_c=this.resizeScroll)===null||_c===void 0?void 0:_c.disconnect();var _iterator263=_createForOfIteratorHelper(this.scrollTargets),_step263;try{for(_iterator263.s();!(_step263=_iterator263.n()).done;){var dom=_step263.value;dom.removeEventListener("scroll",this.onScroll)}}catch(err){_iterator263.e(err)}finally{_iterator263.f()}this.removeWindowListeners(this.win);clearTimeout(this.parentCheck);clearTimeout(this.resizeTimeout);this.win.cancelAnimationFrame(this.delayedFlush);this.win.cancelAnimationFrame(this.flushingAndroidKey)}}]);return DOMObserver}();function findChild(cView,dom,dir){while(dom){var curView=ContentView.get(dom);if(curView&&curView.parent==cView)return curView;var parent=dom.parentNode;dom=parent!=cView.dom?parent:dir>0?dom.nextSibling:dom.previousSibling}return null}function safariSelectionRangeHack(view){var found=null;function read(event){event.preventDefault();event.stopImmediatePropagation();found=event.getTargetRanges()[0]}view.contentDOM.addEventListener("beforeinput",read,true);view.dom.ownerDocument.execCommand("indent");view.contentDOM.removeEventListener("beforeinput",read,true);if(!found)return null;var anchorNode=found.startContainer,anchorOffset=found.startOffset;var focusNode=found.endContainer,focusOffset=found.endOffset;var curAnchor=view.docView.domAtPos(view.state.selection.main.anchor);if(isEquivalentPosition(curAnchor.node,curAnchor.offset,focusNode,focusOffset)){var _ref227=[focusNode,focusOffset,anchorNode,anchorOffset];anchorNode=_ref227[0];anchorOffset=_ref227[1];focusNode=_ref227[2];focusOffset=_ref227[3]}return{anchorNode:anchorNode,anchorOffset:anchorOffset,focusNode:focusNode,focusOffset:focusOffset}}var EditorView=function(){function EditorView(){var _this214=this;var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck2(this,EditorView);this.plugins=[];this.pluginMap=new Map;this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=false;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.className="cm-announced";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);if(config.parent)config.parent.appendChild(this.dom);var dispatch=config.dispatch;this.dispatchTransactions=config.dispatchTransactions||dispatch&&function(trs){return trs.forEach(function(tr){return dispatch(tr,_this214)})}||function(trs){return _this214.update(trs)};this.dispatch=this.dispatch.bind(this);this._root=config.root||getRoot(config.parent)||document;this.viewState=new ViewState(config.state||EditorState.create(config));if(config.scrollTo&&config.scrollTo.is(scrollIntoView$1))this.viewState.scrollTarget=config.scrollTo.value.clip(this.viewState.state);this.plugins=this.state.facet(viewPlugin).map(function(spec){return new PluginInstance(spec)});var _iterator264=_createForOfIteratorHelper(this.plugins),_step264;try{for(_iterator264.s();!(_step264=_iterator264.n()).done;){var plugin=_step264.value;plugin.update(this)}}catch(err){_iterator264.e(err)}finally{_iterator264.f()}this.observer=new DOMObserver(this);this.inputState=new InputState(this);this.inputState.ensureHandlers(this.plugins);this.docView=new DocView(this);this.mountStyles();this.updateAttrs();this.updateState=0;this.requestMeasure()}_createClass2(EditorView,[{key:"state",get:function get(){return this.viewState.state}},{key:"viewport",get:function get(){return this.viewState.viewport}},{key:"visibleRanges",get:function get(){return this.viewState.visibleRanges}},{key:"inView",get:function get(){return this.viewState.inView}},{key:"composing",get:function get(){return this.inputState.composing>0}},{key:"compositionStarted",get:function get(){return this.inputState.composing>=0}},{key:"root",get:function get(){return this._root}},{key:"win",get:function get(){return this.dom.ownerDocument.defaultView||window}},{key:"dispatch",value:function dispatch(){var _this$state;for(var _len15=arguments.length,input=new Array(_len15),_key10=0;_key10<_len15;_key10++){input[_key10]=arguments[_key10]}var trs=input.length==1&&input[0]instanceof Transaction?input:input.length==1&&Array.isArray(input[0])?input[0]:[(_this$state=this.state).update.apply(_this$state,input)];this.dispatchTransactions(trs,this)}},{key:"update",value:function update(transactions){var _this215=this;if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var redrawn=false,attrsChanged=false,update;var state=this.state;var _iterator265=_createForOfIteratorHelper(transactions),_step265;try{for(_iterator265.s();!(_step265=_iterator265.n()).done;){var _tr=_step265.value;if(_tr.startState!=state)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");state=_tr.state}}catch(err){_iterator265.e(err)}finally{_iterator265.f()}if(this.destroyed){this.viewState.state=state;return}var focus=this.hasFocus,focusFlag=0,dispatchFocus=null;if(transactions.some(function(tr){return tr.annotation(isFocusChange)})){this.inputState.notifiedFocused=focus;focusFlag=1}else if(focus!=this.inputState.notifiedFocused){this.inputState.notifiedFocused=focus;dispatchFocus=focusChangeTransaction(state,focus);if(!dispatchFocus)focusFlag=1}var pendingKey=this.observer.delayedAndroidKey,domChange=null;if(pendingKey){this.observer.clearDelayedAndroidKey();domChange=this.observer.readChange();if(domChange&&!this.state.doc.eq(state.doc)||!this.state.selection.eq(state.selection))domChange=null}else{this.observer.clear()}if(state.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(state);update=ViewUpdate.create(this,state,transactions);update.flags|=focusFlag;var scrollTarget=this.viewState.scrollTarget;try{this.updateState=2;var _iterator266=_createForOfIteratorHelper(transactions),_step266;try{for(_iterator266.s();!(_step266=_iterator266.n()).done;){var tr=_step266.value;if(scrollTarget)scrollTarget=scrollTarget.map(tr.changes);if(tr.scrollIntoView){var _main=tr.state.selection.main;scrollTarget=new ScrollTarget(_main.empty?_main:EditorSelection.cursor(_main.head,_main.head>_main.anchor?-1:1))}var _iterator267=_createForOfIteratorHelper(tr.effects),_step267;try{for(_iterator267.s();!(_step267=_iterator267.n()).done;){var e=_step267.value;if(e.is(scrollIntoView$1))scrollTarget=e.value.clip(this.state)}}catch(err){_iterator267.e(err)}finally{_iterator267.f()}}}catch(err){_iterator266.e(err)}finally{_iterator266.f()}this.viewState.update(update,scrollTarget);this.bidiCache=CachedOrder.update(this.bidiCache,update.changes);if(!update.empty){this.updatePlugins(update);this.inputState.update(update)}redrawn=this.docView.update(update);if(this.state.facet(styleModule)!=this.styleModules)this.mountStyles();attrsChanged=this.updateAttrs();this.showAnnouncements(transactions);this.docView.updateSelection(redrawn,transactions.some(function(tr){return tr.isUserEvent("select.pointer")}))}finally{this.updateState=0}if(update.startState.facet(_theme)!=update.state.facet(_theme))this.viewState.mustMeasureContent=true;if(redrawn||attrsChanged||scrollTarget||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)this.requestMeasure();if(!update.empty){var _iterator268=_createForOfIteratorHelper(this.state.facet(updateListener)),_step268;try{for(_iterator268.s();!(_step268=_iterator268.n()).done;){var listener=_step268.value;try{listener(update)}catch(e){logException(this.state,e,"update listener")}}}catch(err){_iterator268.e(err)}finally{_iterator268.f()}}if(dispatchFocus||domChange)Promise.resolve().then(function(){if(dispatchFocus&&_this215.state==dispatchFocus.startState)_this215.dispatch(dispatchFocus);if(domChange){if(!applyDOMChange(_this215,domChange)&&pendingKey.force)dispatchKey(_this215.contentDOM,pendingKey.key,pendingKey.keyCode)}})}},{key:"setState",value:function setState(newState){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=newState;return}this.updateState=2;var hadFocus=this.hasFocus;try{var _iterator269=_createForOfIteratorHelper(this.plugins),_step269;try{for(_iterator269.s();!(_step269=_iterator269.n()).done;){var plugin=_step269.value;plugin.destroy(this)}}catch(err){_iterator269.e(err)}finally{_iterator269.f()}this.viewState=new ViewState(newState);this.plugins=newState.facet(viewPlugin).map(function(spec){return new PluginInstance(spec)});this.pluginMap.clear();var _iterator270=_createForOfIteratorHelper(this.plugins),_step270;try{for(_iterator270.s();!(_step270=_iterator270.n()).done;){var _plugin3=_step270.value;_plugin3.update(this)}}catch(err){_iterator270.e(err)}finally{_iterator270.f()}this.docView.destroy();this.docView=new DocView(this);this.inputState.ensureHandlers(this.plugins);this.mountStyles();this.updateAttrs();this.bidiCache=[]}finally{this.updateState=0}if(hadFocus)this.focus();this.requestMeasure()}},{key:"updatePlugins",value:function updatePlugins(update){var prevSpecs=update.startState.facet(viewPlugin),specs=update.state.facet(viewPlugin);if(prevSpecs!=specs){var newPlugins=[];var _iterator271=_createForOfIteratorHelper(specs),_step271;try{for(_iterator271.s();!(_step271=_iterator271.n()).done;){var spec=_step271.value;var found=prevSpecs.indexOf(spec);if(found<0){newPlugins.push(new PluginInstance(spec))}else{var plugin=this.plugins[found];plugin.mustUpdate=update;newPlugins.push(plugin)}}}catch(err){_iterator271.e(err)}finally{_iterator271.f()}var _iterator272=_createForOfIteratorHelper(this.plugins),_step272;try{for(_iterator272.s();!(_step272=_iterator272.n()).done;){var _plugin4=_step272.value;if(_plugin4.mustUpdate!=update)_plugin4.destroy(this)}}catch(err){_iterator272.e(err)}finally{_iterator272.f()}this.plugins=newPlugins;this.pluginMap.clear()}else{var _iterator273=_createForOfIteratorHelper(this.plugins),_step273;try{for(_iterator273.s();!(_step273=_iterator273.n()).done;){var _p=_step273.value;_p.mustUpdate=update}}catch(err){_iterator273.e(err)}finally{_iterator273.f()}}for(var _i197=0;_i197<this.plugins.length;_i197++)this.plugins[_i197].update(this);if(prevSpecs!=specs)this.inputState.ensureHandlers(this.plugins)}},{key:"measure",value:function measure(){var _this216=this;var flush=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.destroyed)return;if(this.measureScheduled>-1)this.win.cancelAnimationFrame(this.measureScheduled);if(this.observer.delayedAndroidKey){this.measureScheduled=-1;this.requestMeasure();return}this.measureScheduled=0;if(flush)this.observer.forceFlush();var updated=null;var sDOM=this.scrollDOM,scrollTop=sDOM.scrollTop*this.scaleY;var _this$viewState=this.viewState,scrollAnchorPos=_this$viewState.scrollAnchorPos,scrollAnchorHeight=_this$viewState.scrollAnchorHeight;if(Math.abs(scrollTop-this.viewState.scrollTop)>1)scrollAnchorHeight=-1;this.viewState.scrollAnchorHeight=-1;try{for(var _i198=0;;_i198++){if(scrollAnchorHeight<0){if(isScrolledToBottom(sDOM)){scrollAnchorPos=-1;scrollAnchorHeight=this.viewState.heightMap.height}else{var block=this.viewState.scrollAnchorAt(scrollTop);scrollAnchorPos=block.from;scrollAnchorHeight=block.top}}this.updateState=1;var changed=this.viewState.measure(this);if(!changed&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(_i198>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}var measuring=[];if(!(changed&4)){var _ref228=[measuring,this.measureRequests];this.measureRequests=_ref228[0];measuring=_ref228[1]}var measured=measuring.map(function(m){try{return m.read(_this216)}catch(e){logException(_this216.state,e);return BadMeasure}});var update=ViewUpdate.create(this,this.state,[]),redrawn=false;update.flags|=changed;if(!updated)updated=update;else updated.flags|=changed;this.updateState=2;if(!update.empty){this.updatePlugins(update);this.inputState.update(update);this.updateAttrs();redrawn=this.docView.update(update)}for(var _i199=0;_i199<measuring.length;_i199++)if(measured[_i199]!=BadMeasure){try{var m=measuring[_i199];if(m.write)m.write(measured[_i199],this)}catch(e){logException(this.state,e)}}if(redrawn)this.docView.updateSelection(true);if(!update.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight){if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget);this.viewState.scrollTarget=null;scrollAnchorHeight=-1;continue}else{var newAnchorHeight=scrollAnchorPos<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(scrollAnchorPos).top;var diff=newAnchorHeight-scrollAnchorHeight;if(diff>1||diff<-1){scrollTop=scrollTop+diff;sDOM.scrollTop=scrollTop/this.scaleY;scrollAnchorHeight=-1;continue}}}break}}}finally{this.updateState=0;this.measureScheduled=-1}if(updated&&!updated.empty){var _iterator274=_createForOfIteratorHelper(this.state.facet(updateListener)),_step274;try{for(_iterator274.s();!(_step274=_iterator274.n()).done;){var listener=_step274.value;listener(updated)}}catch(err){_iterator274.e(err)}finally{_iterator274.f()}}}},{key:"themeClasses",get:function get(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(_theme)}},{key:"updateAttrs",value:function updateAttrs(){var _this217=this;var editorAttrs=attrsFromFacet(this,editorAttributes,{"class":"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});var contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:!this.state.facet(editable)?"false":"true","class":"cm-content",style:"".concat(browser.tabSize,": ").concat(this.state.tabSize),role:"textbox","aria-multiline":"true"};if(this.state.readOnly)contentAttrs["aria-readonly"]="true";attrsFromFacet(this,contentAttributes,contentAttrs);var changed=this.observer.ignore(function(){var changedContent=_updateAttrs(_this217.contentDOM,_this217.contentAttrs,contentAttrs);var changedEditor=_updateAttrs(_this217.dom,_this217.editorAttrs,editorAttrs);return changedContent||changedEditor});this.editorAttrs=editorAttrs;this.contentAttrs=contentAttrs;return changed}},{key:"showAnnouncements",value:function showAnnouncements(trs){var first=true;var _iterator275=_createForOfIteratorHelper(trs),_step275;try{for(_iterator275.s();!(_step275=_iterator275.n()).done;){var tr=_step275.value;var _iterator276=_createForOfIteratorHelper(tr.effects),_step276;try{for(_iterator276.s();!(_step276=_iterator276.n()).done;){var _effect4=_step276.value;if(_effect4.is(EditorView.announce)){if(first)this.announceDOM.textContent="";first=false;var div=this.announceDOM.appendChild(document.createElement("div"));div.textContent=_effect4.value}}}catch(err){_iterator276.e(err)}finally{_iterator276.f()}}}catch(err){_iterator275.e(err)}finally{_iterator275.f()}}},{key:"mountStyles",value:function mountStyles(){this.styleModules=this.state.facet(styleModule);var nonce=this.state.facet(EditorView.cspNonce);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$3).reverse(),nonce?{nonce:nonce}:undefined)}},{key:"readMeasured",value:function readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure(false)}},{key:"requestMeasure",value:function requestMeasure(request){var _this218=this;if(this.measureScheduled<0)this.measureScheduled=this.win.requestAnimationFrame(function(){return _this218.measure()});if(request){if(this.measureRequests.indexOf(request)>-1)return;if(request.key!=null)for(var _i200=0;_i200<this.measureRequests.length;_i200++){if(this.measureRequests[_i200].key===request.key){this.measureRequests[_i200]=request;return}}this.measureRequests.push(request)}}},{key:"plugin",value:function plugin(_plugin2){var known=this.pluginMap.get(_plugin2);if(known===undefined||known&&known.spec!=_plugin2)this.pluginMap.set(_plugin2,known=this.plugins.find(function(p){return p.spec==_plugin2})||null);return known&&known.update(this).value}},{key:"documentTop",get:function get(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}},{key:"documentPadding",get:function get(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}},{key:"scaleX",get:function get(){return this.viewState.scaleX}},{key:"scaleY",get:function get(){return this.viewState.scaleY}},{key:"elementAtHeight",value:function elementAtHeight(height){this.readMeasured();return this.viewState.elementAtHeight(height)}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){this.readMeasured();return this.viewState.lineBlockAtHeight(height)}},{key:"viewportLineBlocks",get:function get(){return this.viewState.viewportLines}},{key:"lineBlockAt",value:function lineBlockAt(pos){return this.viewState.lineBlockAt(pos)}},{key:"contentHeight",get:function get(){return this.viewState.contentHeight}},{key:"moveByChar",value:function moveByChar(start,forward,by){return skipAtoms(this,start,_moveByChar(this,start,forward,by))}},{key:"moveByGroup",value:function moveByGroup(start,forward){var _this219=this;return skipAtoms(this,start,_moveByChar(this,start,forward,function(initial){return byGroup(_this219,start.head,initial)}))}},{key:"visualLineSide",value:function visualLineSide(line,end){var order=this.bidiSpans(line),dir=this.textDirectionAt(line.from);var span=order[end?order.length-1:0];return EditorSelection.cursor(span.side(end,dir)+line.from,span.forward(!end,dir)?1:-1)}},{key:"moveToLineBoundary",value:function moveToLineBoundary(start,forward){var includeWrap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return _moveToLineBoundary(this,start,forward,includeWrap)}},{key:"moveVertically",value:function moveVertically(start,forward,distance){return skipAtoms(this,start,_moveVertically(this,start,forward,distance))}},{key:"domAtPos",value:function domAtPos(pos){return this.docView.domAtPos(pos)}},{key:"posAtDOM",value:function posAtDOM(node){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.docView.posFromDOM(node,offset)}},{key:"posAtCoords",value:function posAtCoords(coords){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.readMeasured();return _posAtCoords(this,coords,precise)}},{key:"coordsAtPos",value:function coordsAtPos(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.readMeasured();var rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;var line=this.state.doc.lineAt(pos),order=this.bidiSpans(line);var span=order[BidiSpan.find(order,pos-line.from,-1,side)];return flattenRect(rect,span.dir==Direction.LTR==side>0)}},{key:"coordsForChar",value:function coordsForChar(pos){this.readMeasured();return this.docView.coordsForChar(pos)}},{key:"defaultCharacterWidth",get:function get(){return this.viewState.heightOracle.charWidth}},{key:"defaultLineHeight",get:function get(){return this.viewState.heightOracle.lineHeight}},{key:"textDirection",get:function get(){return this.viewState.defaultTextDirection}},{key:"textDirectionAt",value:function textDirectionAt(pos){var perLine=this.state.facet(perLineTextDirection);if(!perLine||pos<this.viewport.from||pos>this.viewport.to)return this.textDirection;this.readMeasured();return this.docView.textDirectionAt(pos)}},{key:"lineWrapping",get:function get(){return this.viewState.heightOracle.lineWrapping}},{key:"bidiSpans",value:function bidiSpans(line){if(line.length>MaxBidiLine)return trivialOrder(line.length);var dir=this.textDirectionAt(line.from),isolates;var _iterator277=_createForOfIteratorHelper(this.bidiCache),_step277;try{for(_iterator277.s();!(_step277=_iterator277.n()).done;){var entry=_step277.value;if(entry.from==line.from&&entry.dir==dir&&(entry.fresh||isolatesEq(entry.isolates,isolates=getIsolatedRanges(this,line))))return entry.order}}catch(err){_iterator277.e(err)}finally{_iterator277.f()}if(!isolates)isolates=getIsolatedRanges(this,line);var order=computeOrder(line.text,dir,isolates);this.bidiCache.push(new CachedOrder(line.from,line.to,dir,isolates,true,order));return order}},{key:"hasFocus",get:function get(){var _a;return(this.dom.ownerDocument.hasFocus()||browser.safari&&((_a=this.inputState)===null||_a===void 0?void 0:_a.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}},{key:"focus",value:function focus(){var _this220=this;this.observer.ignore(function(){focusPreventScroll(_this220.contentDOM);_this220.docView.updateSelection()})}},{key:"setRoot",value:function setRoot(root){if(this._root!=root){this._root=root;this.observer.setWindow((root.nodeType==9?root:root.ownerDocument).defaultView||window);this.mountStyles()}}},{key:"destroy",value:function destroy(){var _iterator278=_createForOfIteratorHelper(this.plugins),_step278;try{for(_iterator278.s();!(_step278=_iterator278.n()).done;){var plugin=_step278.value;plugin.destroy(this)}}catch(err){_iterator278.e(err)}finally{_iterator278.f()}this.plugins=[];this.inputState.destroy();this.docView.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)this.win.cancelAnimationFrame(this.measureScheduled);this.destroyed=true}},{key:"scrollSnapshot",value:function scrollSnapshot(){var _this$scrollDOM=this.scrollDOM,scrollTop=_this$scrollDOM.scrollTop,scrollLeft=_this$scrollDOM.scrollLeft;var ref=this.viewState.scrollAnchorAt(scrollTop);return scrollIntoView$1.of(new ScrollTarget(EditorSelection.cursor(ref.from),"start","start",ref.top-scrollTop,scrollLeft,true))}}],[{key:"scrollIntoView",value:function scrollIntoView(pos){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return scrollIntoView$1.of(new ScrollTarget(typeof pos=="number"?EditorSelection.cursor(pos):pos,options.y,options.x,options.yMargin,options.xMargin))}},{key:"domEventHandlers",value:function domEventHandlers(handlers){return ViewPlugin.define(function(){return{}},{eventHandlers:handlers})}},{key:"domEventObservers",value:function domEventObservers(observers){return ViewPlugin.define(function(){return{}},{eventObservers:observers})}},{key:"theme",value:function theme(spec,options){var prefix=StyleModule.newName();var result=[_theme.of(prefix),styleModule.of(buildTheme(".".concat(prefix),spec))];if(options&&options.dark)result.push(darkTheme.of(true));return result}},{key:"baseTheme",value:function baseTheme(spec){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,spec,lightDarkIDs)))}},{key:"findFromDOM",value:function findFromDOM(dom){var _a;var content=dom.querySelector(".cm-content");var cView=content&&ContentView.get(content)||ContentView.get(dom);return((_a=cView===null||cView===void 0?void 0:cView.rootView)===null||_a===void 0?void 0:_a.view)||null}}]);return EditorView}();EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler$1;EditorView.focusChangeEffect=focusChangeEffect;EditorView.perLineTextDirection=perLineTextDirection;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.outerDecorations=outerDecorations;EditorView.atomicRanges=atomicRanges;EditorView.bidiIsolatedRanges=bidiIsolatedRanges;EditorView.scrollMargins=scrollMargins;EditorView.darkTheme=darkTheme;EditorView.cspNonce=Facet.define({combine:function combine(values){return values.length?values[0]:""}});EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({"class":"cm-lineWrapping"});EditorView.announce=StateEffect.define();var MaxBidiLine=4096;var BadMeasure={};var CachedOrder=function(){function CachedOrder(from,to,dir,isolates,fresh,order){_classCallCheck2(this,CachedOrder);this.from=from;this.to=to;this.dir=dir;this.isolates=isolates;this.fresh=fresh;this.order=order}_createClass2(CachedOrder,null,[{key:"update",value:function update(cache,changes){if(changes.empty&&!cache.some(function(c){return c.fresh}))return cache;var result=[],lastDir=cache.length?cache[cache.length-1].dir:Direction.LTR;for(var _i201=Math.max(0,cache.length-10);_i201<cache.length;_i201++){var entry=cache[_i201];if(entry.dir==lastDir&&!changes.touchesRange(entry.from,entry.to))result.push(new CachedOrder(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.isolates,false,entry.order))}return result}}]);return CachedOrder}();function attrsFromFacet(view,facet,base){for(var sources=view.state.facet(facet),_i202=sources.length-1;_i202>=0;_i202--){var source=sources[_i202],value=typeof source=="function"?source(view):source;if(value)combineAttrs(value,base)}return base}var currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(name,platform){var parts=name.split(/-(?!$)/);var result=parts[parts.length-1];if(result=="Space")result=" ";var alt,ctrl,shift,meta;for(var _i203=0;_i203<parts.length-1;++_i203){var mod=parts[_i203];if(/^(cmd|meta|m)$/i.test(mod))meta=true;else if(/^a(lt)?$/i.test(mod))alt=true;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=true;else if(/^s(hift)?$/i.test(mod))shift=true;else if(/^mod$/i.test(mod)){if(platform=="mac")meta=true;else ctrl=true}else throw new Error("Unrecognized modifier name: "+mod)}if(alt)result="Alt-"+result;if(ctrl)result="Ctrl-"+result;if(meta)result="Meta-"+result;if(shift)result="Shift-"+result;return result}function modifiers(name,event,shift){if(event.altKey)name="Alt-"+name;if(event.ctrlKey)name="Ctrl-"+name;if(event.metaKey)name="Meta-"+name;if(shift!==false&&event.shiftKey)name="Shift-"+name;return name}var handleKeyEvents=Prec["default"](EditorView.domEventHandlers({keydown:function keydown(event,view){return runHandlers(getKeymap(view.state),event,view,"editor")}}));var keymap=Facet.define({enables:handleKeyEvents});var Keymaps=new WeakMap;function getKeymap(state){var bindings=state.facet(keymap);var map=Keymaps.get(bindings);if(!map)Keymaps.set(bindings,map=buildKeymap(bindings.reduce(function(a,b){return a.concat(b)},[])));return map}function runScopeHandlers(view,event,scope){return runHandlers(getKeymap(view.state),event,view,scope)}var storedPrefix=null;var PrefixTimeout=4000;function buildKeymap(bindings){var platform=arguments.length>1&&arguments[1]!==undefined?arguments[1]:currentPlatform;var bound=Object.create(null);var isPrefix=Object.create(null);var checkPrefix=function checkPrefix(name,is){var current=isPrefix[name];if(current==null)isPrefix[name]=is;else if(current!=is)throw new Error("Key binding "+name+" is used both as a regular binding and as a multi-stroke prefix")};var add=function add(scope,key,command,preventDefault,stopPropagation){var _a,_b;var scopeObj=bound[scope]||(bound[scope]=Object.create(null));var parts=key.split(/ (?!$)/).map(function(k){return normalizeKeyName(k,platform)});var _loop16=function _loop16(){var prefix=parts.slice(0,_i204).join(" ");checkPrefix(prefix,true);if(!scopeObj[prefix])scopeObj[prefix]={preventDefault:true,stopPropagation:false,run:[function(view){var ourObj=storedPrefix={view:view,prefix:prefix,scope:scope};setTimeout(function(){if(storedPrefix==ourObj)storedPrefix=null},PrefixTimeout);return true}]}};for(var _i204=1;_i204<parts.length;_i204++){_loop16()}var full=parts.join(" ");checkPrefix(full,false);var binding=scopeObj[full]||(scopeObj[full]={preventDefault:false,stopPropagation:false,run:((_b=(_a=scopeObj._any)===null||_a===void 0?void 0:_a.run)===null||_b===void 0?void 0:_b.slice())||[]});if(command)binding.run.push(command);if(preventDefault)binding.preventDefault=true;if(stopPropagation)binding.stopPropagation=true};var _iterator279=_createForOfIteratorHelper(bindings),_step279;try{for(_iterator279.s();!(_step279=_iterator279.n()).done;){var b=_step279.value;var scopes=b.scope?b.scope.split(" "):["editor"];if(b.any){var _iterator280=_createForOfIteratorHelper(scopes),_step280;try{for(_iterator280.s();!(_step280=_iterator280.n()).done;){var scope=_step280.value;var scopeObj=bound[scope]||(bound[scope]=Object.create(null));if(!scopeObj._any)scopeObj._any={preventDefault:false,stopPropagation:false,run:[]};for(var key in scopeObj)scopeObj[key].run.push(b.any)}}catch(err){_iterator280.e(err)}finally{_iterator280.f()}}var _name22=b[platform]||b.key;if(!_name22)continue;var _iterator281=_createForOfIteratorHelper(scopes),_step281;try{for(_iterator281.s();!(_step281=_iterator281.n()).done;){var _scope=_step281.value;add(_scope,_name22,b.run,b.preventDefault,b.stopPropagation);if(b.shift)add(_scope,"Shift-"+_name22,b.shift,b.preventDefault,b.stopPropagation)}}catch(err){_iterator281.e(err)}finally{_iterator281.f()}}}catch(err){_iterator279.e(err)}finally{_iterator279.f()}return bound}function runHandlers(map,event,view,scope){var name=keyName(event);var charCode=codePointAt(name,0),isChar=codePointSize(charCode)==name.length&&name!=" ";var prefix="",handled=false,prevented=false,stopPropagation=false;if(storedPrefix&&storedPrefix.view==view&&storedPrefix.scope==scope){prefix=storedPrefix.prefix+" ";if(modifierCodes.indexOf(event.keyCode)<0){prevented=true;storedPrefix=null}}var ran=new Set;var runFor=function runFor(binding){if(binding){var _iterator282=_createForOfIteratorHelper(binding.run),_step282;try{for(_iterator282.s();!(_step282=_iterator282.n()).done;){var _cmd2=_step282.value;if(!ran.has(_cmd2)){ran.add(_cmd2);if(_cmd2(view,event)){if(binding.stopPropagation)stopPropagation=true;return true}}}}catch(err){_iterator282.e(err)}finally{_iterator282.f()}if(binding.preventDefault){if(binding.stopPropagation)stopPropagation=true;prevented=true}}return false};var scopeObj=map[scope],baseName,shiftName;if(scopeObj){if(runFor(scopeObj[prefix+modifiers(name,event,!isChar)])){handled=true}else if(isChar&&(event.altKey||event.metaKey||event.ctrlKey)&&!(browser.windows&&event.ctrlKey&&event.altKey)&&(baseName=base[event.keyCode])&&baseName!=name){if(runFor(scopeObj[prefix+modifiers(baseName,event,true)])){handled=true}else if(event.shiftKey&&(shiftName=shift[event.keyCode])!=name&&shiftName!=baseName&&runFor(scopeObj[prefix+modifiers(shiftName,event,false)])){handled=true}}else if(isChar&&event.shiftKey&&runFor(scopeObj[prefix+modifiers(name,event,true)])){handled=true}if(!handled&&runFor(scopeObj._any))handled=true}if(prevented)handled=true;if(handled&&stopPropagation)event.stopPropagation();return handled}var RectangleMarker=function(){function RectangleMarker(className,left,top,width,height){_classCallCheck2(this,RectangleMarker);this.className=className;this.left=left;this.top=top;this.width=width;this.height=height}_createClass2(RectangleMarker,[{key:"draw",value:function draw(){var elt=document.createElement("div");elt.className=this.className;this.adjust(elt);return elt}},{key:"update",value:function update(elt,prev){if(prev.className!=this.className)return false;this.adjust(elt);return true}},{key:"adjust",value:function adjust(elt){elt.style.left=this.left+"px";elt.style.top=this.top+"px";if(this.width!=null)elt.style.width=this.width+"px";elt.style.height=this.height+"px"}},{key:"eq",value:function eq(p){return this.left==p.left&&this.top==p.top&&this.width==p.width&&this.height==p.height&&this.className==p.className}}],[{key:"forRange",value:function forRange(view,className,range){if(range.empty){var pos=view.coordsAtPos(range.head,range.assoc||1);if(!pos)return[];var _base3=getBase(view);return[new RectangleMarker(className,pos.left-_base3.left,pos.top-_base3.top,null,pos.bottom-pos.top)]}else{return rectanglesForRange(view,className,range)}}}]);return RectangleMarker}();function getBase(view){var rect=view.scrollDOM.getBoundingClientRect();var left=view.textDirection==Direction.LTR?rect.left:rect.right-view.scrollDOM.clientWidth*view.scaleX;return{left:left-view.scrollDOM.scrollLeft*view.scaleX,top:rect.top-view.scrollDOM.scrollTop*view.scaleY}}function wrappedLine(view,pos,inside){var range=EditorSelection.cursor(pos);return{from:Math.max(inside.from,view.moveToLineBoundary(range,false,true).from),to:Math.min(inside.to,view.moveToLineBoundary(range,true,true).from),type:BlockType.Text}}function rectanglesForRange(view,className,range){if(range.to<=view.viewport.from||range.from>=view.viewport.to)return[];var from=Math.max(range.from,view.viewport.from),to=Math.min(range.to,view.viewport.to);var ltr=view.textDirection==Direction.LTR;var content=view.contentDOM,contentRect=content.getBoundingClientRect(),base=getBase(view);var lineElt=content.querySelector(".cm-line"),lineStyle=lineElt&&window.getComputedStyle(lineElt);var leftSide=contentRect.left+(lineStyle?parseInt(lineStyle.paddingLeft)+Math.min(0,parseInt(lineStyle.textIndent)):0);var rightSide=contentRect.right-(lineStyle?parseInt(lineStyle.paddingRight):0);var startBlock=blockAt(view,from),endBlock=blockAt(view,to);var visualStart=startBlock.type==BlockType.Text?startBlock:null;var visualEnd=endBlock.type==BlockType.Text?endBlock:null;if(visualStart&&(view.lineWrapping||startBlock.widgetLineBreaks))visualStart=wrappedLine(view,from,visualStart);if(visualEnd&&(view.lineWrapping||endBlock.widgetLineBreaks))visualEnd=wrappedLine(view,to,visualEnd);if(visualStart&&visualEnd&&visualStart.from==visualEnd.from){return pieces(drawForLine(range.from,range.to,visualStart))}else{var _top7=visualStart?drawForLine(range.from,null,visualStart):drawForWidget(startBlock,false);var _bottom=visualEnd?drawForLine(null,range.to,visualEnd):drawForWidget(endBlock,true);var between=[];if((visualStart||startBlock).to<(visualEnd||endBlock).from-(visualStart&&visualEnd?1:0)||startBlock.widgetLineBreaks>1&&_top7.bottom+view.defaultLineHeight/2<_bottom.top)between.push(piece(leftSide,_top7.bottom,rightSide,_bottom.top));else if(_top7.bottom<_bottom.top&&view.elementAtHeight((_top7.bottom+_bottom.top)/2).type==BlockType.Text)_top7.bottom=_bottom.top=(_top7.bottom+_bottom.top)/2;return pieces(_top7).concat(between).concat(pieces(_bottom))}function piece(left,top,right,bottom){return new RectangleMarker(className,left-base.left,top-base.top-0.01,right-left,bottom-top+0.01)}function pieces(_ref229){var top=_ref229.top,bottom=_ref229.bottom,horizontal=_ref229.horizontal;var pieces=[];for(var _i205=0;_i205<horizontal.length;_i205+=2)pieces.push(piece(horizontal[_i205],top,horizontal[_i205+1],bottom));return pieces}function drawForLine(from,to,line){var top=1e9,bottom=-1e9,horizontal=[];function addSpan(from,fromOpen,to,toOpen,dir){var fromCoords=view.coordsAtPos(from,from==line.to?-2:2);var toCoords=view.coordsAtPos(to,to==line.from?2:-2);if(!fromCoords||!toCoords)return;top=Math.min(fromCoords.top,toCoords.top,top);bottom=Math.max(fromCoords.bottom,toCoords.bottom,bottom);if(dir==Direction.LTR)horizontal.push(ltr&&fromOpen?leftSide:fromCoords.left,ltr&&toOpen?rightSide:toCoords.right);else horizontal.push(!ltr&&toOpen?leftSide:toCoords.left,!ltr&&fromOpen?rightSide:fromCoords.right)}var start=from!==null&&from!==void 0?from:line.from,end=to!==null&&to!==void 0?to:line.to;var _iterator283=_createForOfIteratorHelper(view.visibleRanges),_step283;try{for(_iterator283.s();!(_step283=_iterator283.n()).done;){var _r=_step283.value;if(_r.to>start&&_r.from<end){for(var pos=Math.max(_r.from,start),endPos=Math.min(_r.to,end);;){var docLine=view.state.doc.lineAt(pos);var _iterator284=_createForOfIteratorHelper(view.bidiSpans(docLine)),_step284;try{for(_iterator284.s();!(_step284=_iterator284.n()).done;){var span=_step284.value;var spanFrom=span.from+docLine.from,spanTo=span.to+docLine.from;if(spanFrom>=endPos)break;if(spanTo>pos)addSpan(Math.max(spanFrom,pos),from==null&&spanFrom<=start,Math.min(spanTo,endPos),to==null&&spanTo>=end,span.dir)}}catch(err){_iterator284.e(err)}finally{_iterator284.f()}pos=docLine.to+1;if(pos>=endPos)break}}}}catch(err){_iterator283.e(err)}finally{_iterator283.f()}if(horizontal.length==0)addSpan(start,from==null,end,to==null,view.textDirection);return{top:top,bottom:bottom,horizontal:horizontal}}function drawForWidget(block,top){var y=contentRect.top+(top?block.top:block.bottom);return{top:y,bottom:y,horizontal:[]}}}function sameMarker(a,b){return a.constructor==b.constructor&&a.eq(b)}var LayerView=function(){function LayerView(view,layer){_classCallCheck2(this,LayerView);this.view=view;this.layer=layer;this.drawn=[];this.scaleX=1;this.scaleY=1;this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)};this.dom=view.scrollDOM.appendChild(document.createElement("div"));this.dom.classList.add("cm-layer");if(layer.above)this.dom.classList.add("cm-layer-above");if(layer["class"])this.dom.classList.add(layer["class"]);this.scale();this.dom.setAttribute("aria-hidden","true");this.setOrder(view.state);view.requestMeasure(this.measureReq);if(layer.mount)layer.mount(this.dom,view)}_createClass2(LayerView,[{key:"update",value:function update(_update6){if(_update6.startState.facet(layerOrder)!=_update6.state.facet(layerOrder))this.setOrder(_update6.state);if(this.layer.update(_update6,this.dom)||_update6.geometryChanged){this.scale();_update6.view.requestMeasure(this.measureReq)}}},{key:"setOrder",value:function setOrder(state){var pos=0,order=state.facet(layerOrder);while(pos<order.length&&order[pos]!=this.layer)pos++;this.dom.style.zIndex=String((this.layer.above?150:-1)-pos)}},{key:"measure",value:function measure(){return this.layer.markers(this.view)}},{key:"scale",value:function scale(){var _this$view=this.view,scaleX=_this$view.scaleX,scaleY=_this$view.scaleY;if(scaleX!=this.scaleX||scaleY!=this.scaleY){this.scaleX=scaleX;this.scaleY=scaleY;this.dom.style.transform="scale(".concat(1/scaleX,", ").concat(1/scaleY,")")}}},{key:"draw",value:function draw(markers){var _this221=this;if(markers.length!=this.drawn.length||markers.some(function(p,i){return!sameMarker(p,_this221.drawn[i])})){var old=this.dom.firstChild,oldI=0;var _iterator285=_createForOfIteratorHelper(markers),_step285;try{for(_iterator285.s();!(_step285=_iterator285.n()).done;){var marker=_step285.value;if(marker.update&&old&&marker.constructor&&this.drawn[oldI].constructor&&marker.update(old,this.drawn[oldI])){old=old.nextSibling;oldI++}else{this.dom.insertBefore(marker.draw(),old)}}}catch(err){_iterator285.e(err)}finally{_iterator285.f()}while(old){var next=old.nextSibling;old.remove();old=next}this.drawn=markers}}},{key:"destroy",value:function destroy(){if(this.layer.destroy)this.layer.destroy(this.dom,this.view);this.dom.remove()}}]);return LayerView}();var layerOrder=Facet.define();function layer(config){return[ViewPlugin.define(function(v){return new LayerView(v,config)}),layerOrder.of(config)]}var CanHidePrimary=!browser.ios;var selectionConfig=Facet.define({combine:function combine(configs){return combineConfig(configs,{cursorBlinkRate:1200,drawRangeCursor:true},{cursorBlinkRate:function cursorBlinkRate(a,b){return Math.min(a,b)},drawRangeCursor:function drawRangeCursor(a,b){return a||b}})}});function drawSelection(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[selectionConfig.of(config),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(true)]}function configChanged(update){return update.startState.facet(selectionConfig)!=update.state.facet(selectionConfig)}var cursorLayer=layer({above:true,markers:function markers(view){var state=view.state,conf=state.facet(selectionConfig);var cursors=[];var _iterator286=_createForOfIteratorHelper(state.selection.ranges),_step286;try{for(_iterator286.s();!(_step286=_iterator286.n()).done;){var _r2=_step286.value;var prim=_r2==state.selection.main;if(_r2.empty?!prim||CanHidePrimary:conf.drawRangeCursor){var className=prim?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary";var _cursor=_r2.empty?_r2:EditorSelection.cursor(_r2.head,_r2.head>_r2.anchor?-1:1);var _iterator287=_createForOfIteratorHelper(RectangleMarker.forRange(view,className,_cursor)),_step287;try{for(_iterator287.s();!(_step287=_iterator287.n()).done;){var piece=_step287.value;cursors.push(piece)}}catch(err){_iterator287.e(err)}finally{_iterator287.f()}}}}catch(err){_iterator286.e(err)}finally{_iterator286.f()}return cursors},update:function update(_update7,dom){if(_update7.transactions.some(function(tr){return tr.selection}))dom.style.animationName=dom.style.animationName=="cm-blink"?"cm-blink2":"cm-blink";var confChange=configChanged(_update7);if(confChange)setBlinkRate(_update7.state,dom);return _update7.docChanged||_update7.selectionSet||confChange},mount:function mount(dom,view){setBlinkRate(view.state,dom)},"class":"cm-cursorLayer"});function setBlinkRate(state,dom){dom.style.animationDuration=state.facet(selectionConfig).cursorBlinkRate+"ms"}var selectionLayer=layer({above:false,markers:function markers(view){return view.state.selection.ranges.map(function(r){return r.empty?[]:RectangleMarker.forRange(view,"cm-selectionBackground",r)}).reduce(function(a,b){return a.concat(b)})},update:function update(_update8,dom){return _update8.docChanged||_update8.selectionSet||_update8.viewportChanged||configChanged(_update8)},"class":"cm-selectionLayer"});var themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if(CanHidePrimary){themeSpec[".cm-line"].caretColor="transparent !important";themeSpec[".cm-content"]={caretColor:"transparent !important"}}var hideNativeSelection=Prec.highest(EditorView.theme(themeSpec));var setDropCursorPos=StateEffect.define({map:function map(pos,mapping){return pos==null?null:mapping.mapPos(pos)}});var dropCursorPos=StateField.define({create:function create(){return null},update:function update(pos,tr){if(pos!=null)pos=tr.changes.mapPos(pos);return tr.effects.reduce(function(pos,e){return e.is(setDropCursorPos)?e.value:pos},pos)}});var drawDropCursor=ViewPlugin.fromClass(function(){function _class57(view){_classCallCheck2(this,_class57);this.view=view;this.cursor=null;this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}_createClass2(_class57,[{key:"update",value:function update(_update9){var _a;var cursorPos=_update9.state.field(dropCursorPos);if(cursorPos==null){if(this.cursor!=null){(_a=this.cursor)===null||_a===void 0?void 0:_a.remove();this.cursor=null}}else{if(!this.cursor){this.cursor=this.view.scrollDOM.appendChild(document.createElement("div"));this.cursor.className="cm-dropCursor"}if(_update9.startState.field(dropCursorPos)!=cursorPos||_update9.docChanged||_update9.geometryChanged)this.view.requestMeasure(this.measureReq)}}},{key:"readPos",value:function readPos(){var view=this.view;var pos=view.state.field(dropCursorPos);var rect=pos!=null&&view.coordsAtPos(pos);if(!rect)return null;var outer=view.scrollDOM.getBoundingClientRect();return{left:rect.left-outer.left+view.scrollDOM.scrollLeft*view.scaleX,top:rect.top-outer.top+view.scrollDOM.scrollTop*view.scaleY,height:rect.bottom-rect.top}}},{key:"drawCursor",value:function drawCursor(pos){if(this.cursor){var _this$view2=this.view,scaleX=_this$view2.scaleX,scaleY=_this$view2.scaleY;if(pos){this.cursor.style.left=pos.left/scaleX+"px";this.cursor.style.top=pos.top/scaleY+"px";this.cursor.style.height=pos.height/scaleY+"px"}else{this.cursor.style.left="-100000px"}}}},{key:"destroy",value:function destroy(){if(this.cursor)this.cursor.remove()}},{key:"setDropPos",value:function setDropPos(pos){if(this.view.state.field(dropCursorPos)!=pos)this.view.dispatch({effects:setDropCursorPos.of(pos)})}}]);return _class57}(),{eventObservers:{dragover:function dragover(event){this.setDropPos(this.view.posAtCoords({x:event.clientX,y:event.clientY}))},dragleave:function dragleave(event){if(event.target==this.view.contentDOM||!this.view.contentDOM.contains(event.relatedTarget))this.setDropPos(null)},dragend:function dragend(){this.setDropPos(null)},drop:function drop(){this.setDropPos(null)}}});function dropCursor(){return[dropCursorPos,drawDropCursor]}function iterMatches(doc,re,from,to,f){re.lastIndex=0;for(var _cursor2=doc.iterRange(from,to),pos=from,m;!_cursor2.next().done;pos+=_cursor2.value.length){if(!_cursor2.lineBreak)while(m=re.exec(_cursor2.value))f(pos+m.index,m)}}function matchRanges(view,maxLength){var visible=view.visibleRanges;if(visible.length==1&&visible[0].from==view.viewport.from&&visible[0].to==view.viewport.to)return visible;var result=[];var _iterator288=_createForOfIteratorHelper(visible),_step288;try{for(_iterator288.s();!(_step288=_iterator288.n()).done;){var _step288$value=_step288.value,from=_step288$value.from,to=_step288$value.to;from=Math.max(view.state.doc.lineAt(from).from,from-maxLength);to=Math.min(view.state.doc.lineAt(to).to,to+maxLength);if(result.length&&result[result.length-1].to>=from)result[result.length-1].to=to;else result.push({from:from,to:to})}}catch(err){_iterator288.e(err)}finally{_iterator288.f()}return result}var MatchDecorator=function(){function MatchDecorator(config){_classCallCheck2(this,MatchDecorator);var regexp=config.regexp,decoration=config.decoration,decorate=config.decorate,boundary=config.boundary,_config$maxLength=config.maxLength,maxLength=_config$maxLength===void 0?1000:_config$maxLength;if(!regexp.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=regexp;if(decorate){this.addMatch=function(match,view,from,add){return decorate(add,from,from+match[0].length,match,view)}}else if(typeof decoration=="function"){this.addMatch=function(match,view,from,add){var deco=decoration(match,view,from);if(deco)add(from,from+match[0].length,deco)}}else if(decoration){this.addMatch=function(match,_view,from,add){return add(from,from+match[0].length,decoration)}}else{throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator")}this.boundary=boundary;this.maxLength=maxLength}_createClass2(MatchDecorator,[{key:"createDeco",value:function createDeco(view){var _this222=this;var build=new RangeSetBuilder,add=build.add.bind(build);var _iterator289=_createForOfIteratorHelper(matchRanges(view,this.maxLength)),_step289;try{for(_iterator289.s();!(_step289=_iterator289.n()).done;){var _step289$value=_step289.value,from=_step289$value.from,to=_step289$value.to;iterMatches(view.state.doc,this.regexp,from,to,function(from,m){return _this222.addMatch(m,view,from,add)})}}catch(err){_iterator289.e(err)}finally{_iterator289.f()}return build.finish()}},{key:"updateDeco",value:function updateDeco(update,deco){var changeFrom=1e9,changeTo=-1;if(update.docChanged)update.changes.iterChanges(function(_f,_t,from,to){if(to>update.view.viewport.from&&from<update.view.viewport.to){changeFrom=Math.min(from,changeFrom);changeTo=Math.max(to,changeTo)}});if(update.viewportChanged||changeTo-changeFrom>1000)return this.createDeco(update.view);if(changeTo>-1)return this.updateRange(update.view,deco.map(update.changes),changeFrom,changeTo);return deco}},{key:"updateRange",value:function updateRange(view,deco,updateFrom,updateTo){var _this223=this;var _iterator290=_createForOfIteratorHelper(view.visibleRanges),_step290;try{var _loop17=function _loop17(){var r=_step290.value;var from=Math.max(r.from,updateFrom),to=Math.min(r.to,updateTo);if(to>from){var fromLine=view.state.doc.lineAt(from),toLine=fromLine.to<to?view.state.doc.lineAt(to):fromLine;var _start12=Math.max(r.from,fromLine.from),_end30=Math.min(r.to,toLine.to);if(_this223.boundary){for(;from>fromLine.from;from--)if(_this223.boundary.test(fromLine.text[from-1-fromLine.from])){_start12=from;break}for(;to<toLine.to;to++)if(_this223.boundary.test(toLine.text[to-toLine.from])){_end30=to;break}}var ranges=[],m;var _add2=function _add2(from,to,deco){return ranges.push(deco.range(from,to))};if(fromLine==toLine){_this223.regexp.lastIndex=_start12-fromLine.from;while((m=_this223.regexp.exec(fromLine.text))&&m.index<_end30-fromLine.from)_this223.addMatch(m,view,m.index+fromLine.from,_add2)}else{iterMatches(view.state.doc,_this223.regexp,_start12,_end30,function(from,m){return _this223.addMatch(m,view,from,_add2)})}deco=deco.update({filterFrom:_start12,filterTo:_end30,filter:function filter(from,to){return from<_start12||to>_end30},add:ranges})}};for(_iterator290.s();!(_step290=_iterator290.n()).done;){_loop17()}}catch(err){_iterator290.e(err)}finally{_iterator290.f()}return deco}}]);return MatchDecorator}();var UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g";var Specials=new RegExp("[\0-\b\n-\x1F\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\u2066\u2067\u2069\uFEFF\uFFF9-\uFFFC]",UnicodeRegexpSupport);var Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};var _supportsTabSize=null;function supportsTabSize(){var _a;if(_supportsTabSize==null&&typeof document!="undefined"&&document.body){var styles=document.body.style;_supportsTabSize=((_a=styles.tabSize)!==null&&_a!==void 0?_a:styles.MozTabSize)!=null}return _supportsTabSize||false}var specialCharConfig=Facet.define({combine:function combine(configs){var config=combineConfig(configs,{render:null,specialChars:Specials,addSpecialChars:null});if(config.replaceTabs=!supportsTabSize())config.specialChars=new RegExp("\t|"+config.specialChars.source,UnicodeRegexpSupport);if(config.addSpecialChars)config.specialChars=new RegExp(config.specialChars.source+"|"+config.addSpecialChars.source,UnicodeRegexpSupport);return config}});function highlightSpecialChars(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[specialCharConfig.of(config),specialCharPlugin()]}var _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(function(){function _class58(view){_classCallCheck2(this,_class58);this.view=view;this.decorations=Decoration.none;this.decorationCache=Object.create(null);this.decorator=this.makeDecorator(view.state.facet(specialCharConfig));this.decorations=this.decorator.createDeco(view)}_createClass2(_class58,[{key:"makeDecorator",value:function makeDecorator(conf){var _this224=this;return new MatchDecorator({regexp:conf.specialChars,decoration:function decoration(m,view,pos){var doc=view.state.doc;var code=codePointAt(m[0],0);if(code==9){var line=doc.lineAt(pos);var size=view.state.tabSize,col=_countColumn(line.text,size,pos-line.from);return Decoration.replace({widget:new TabWidget((size-col%size)*_this224.view.defaultCharacterWidth/_this224.view.scaleX)})}return _this224.decorationCache[code]||(_this224.decorationCache[code]=Decoration.replace({widget:new SpecialCharWidget(conf,code)}))},boundary:conf.replaceTabs?undefined:/[^]/})}},{key:"update",value:function update(_update10){var conf=_update10.state.facet(specialCharConfig);if(_update10.startState.facet(specialCharConfig)!=conf){this.decorator=this.makeDecorator(conf);this.decorations=this.decorator.createDeco(_update10.view)}else{this.decorations=this.decorator.updateDeco(_update10,this.decorations)}}}]);return _class58}(),{decorations:function decorations(v){return v.decorations}}))}var DefaultPlaceholder="\u2022";function placeholder$1(code){if(code>=32)return DefaultPlaceholder;if(code==10)return"\u2424";return String.fromCharCode(9216+code)}var SpecialCharWidget=function(_WidgetType4){_inherits2(SpecialCharWidget,_WidgetType4);var _super90=_createSuper(SpecialCharWidget);function SpecialCharWidget(options,code){var _this225;_classCallCheck2(this,SpecialCharWidget);_this225=_super90.call(this);_this225.options=options;_this225.code=code;return _this225}_createClass2(SpecialCharWidget,[{key:"eq",value:function eq(other){return other.code==this.code}},{key:"toDOM",value:function toDOM(view){var ph=placeholder$1(this.code);var desc=view.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16));var custom=this.options.render&&this.options.render(this.code,desc,ph);if(custom)return custom;var span=document.createElement("span");span.textContent=ph;span.title=desc;span.setAttribute("aria-label",desc);span.className="cm-specialChar";return span}},{key:"ignoreEvent",value:function ignoreEvent(){return false}}]);return SpecialCharWidget}(WidgetType);var TabWidget=function(_WidgetType5){_inherits2(TabWidget,_WidgetType5);var _super91=_createSuper(TabWidget);function TabWidget(width){var _this226;_classCallCheck2(this,TabWidget);_this226=_super91.call(this);_this226.width=width;return _this226}_createClass2(TabWidget,[{key:"eq",value:function eq(other){return other.width==this.width}},{key:"toDOM",value:function toDOM(){var span=document.createElement("span");span.textContent="\t";span.className="cm-tab";span.style.width=this.width+"px";return span}},{key:"ignoreEvent",value:function ignoreEvent(){return false}}]);return TabWidget}(WidgetType);function highlightActiveLine(){return activeLineHighlighter}var lineDeco=Decoration.line({"class":"cm-activeLine"});var activeLineHighlighter=ViewPlugin.fromClass(function(){function _class59(view){_classCallCheck2(this,_class59);this.decorations=this.getDeco(view)}_createClass2(_class59,[{key:"update",value:function update(_update11){if(_update11.docChanged||_update11.selectionSet)this.decorations=this.getDeco(_update11.view)}},{key:"getDeco",value:function getDeco(view){var lastLineStart=-1,deco=[];var _iterator291=_createForOfIteratorHelper(view.state.selection.ranges),_step291;try{for(_iterator291.s();!(_step291=_iterator291.n()).done;){var _r3=_step291.value;var line=view.lineBlockAt(_r3.head);if(line.from>lastLineStart){deco.push(lineDeco.range(line.from));lastLineStart=line.from}}}catch(err){_iterator291.e(err)}finally{_iterator291.f()}return Decoration.set(deco)}}]);return _class59}(),{decorations:function decorations(v){return v.decorations}});var Placeholder=function(_WidgetType6){_inherits2(Placeholder,_WidgetType6);var _super92=_createSuper(Placeholder);function Placeholder(content){var _this227;_classCallCheck2(this,Placeholder);_this227=_super92.call(this);_this227.content=content;return _this227}_createClass2(Placeholder,[{key:"toDOM",value:function toDOM(){var wrap=document.createElement("span");wrap.className="cm-placeholder";wrap.style.pointerEvents="none";wrap.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content);if(typeof this.content=="string")wrap.setAttribute("aria-label","placeholder "+this.content);else wrap.setAttribute("aria-hidden","true");return wrap}},{key:"coordsAt",value:function coordsAt(dom){var rects=dom.firstChild?clientRectsFor(dom.firstChild):[];if(!rects.length)return null;var style=window.getComputedStyle(dom.parentNode);var rect=flattenRect(rects[0],style.direction!="rtl");var lineHeight=parseInt(style.lineHeight);if(rect.bottom-rect.top>lineHeight*1.5)return{left:rect.left,right:rect.right,top:rect.top,bottom:rect.top+lineHeight};return rect}},{key:"ignoreEvent",value:function ignoreEvent(){return false}}]);return Placeholder}(WidgetType);function placeholder(content){return ViewPlugin.fromClass(function(){function _class60(view){_classCallCheck2(this,_class60);this.view=view;this.placeholder=content?Decoration.set([Decoration.widget({widget:new Placeholder(content),side:1}).range(0)]):Decoration.none}_createClass2(_class60,[{key:"decorations",get:function get(){return this.view.state.doc.length?Decoration.none:this.placeholder}}]);return _class60}(),{decorations:function decorations(v){return v.decorations}})}var MaxOff=2000;function rectangleFor(state,a,b){var startLine=Math.min(a.line,b.line),endLine=Math.max(a.line,b.line);var ranges=[];if(a.off>MaxOff||b.off>MaxOff||a.col<0||b.col<0){var startOff=Math.min(a.off,b.off),endOff=Math.max(a.off,b.off);for(var _i206=startLine;_i206<=endLine;_i206++){var line=state.doc.line(_i206);if(line.length<=endOff)ranges.push(EditorSelection.range(line.from+startOff,line.to+endOff))}}else{var startCol=Math.min(a.col,b.col),endCol=Math.max(a.col,b.col);for(var _i207=startLine;_i207<=endLine;_i207++){var _line3=state.doc.line(_i207);var _start13=findColumn(_line3.text,startCol,state.tabSize,true);if(_start13<0){ranges.push(EditorSelection.cursor(_line3.to))}else{var _end31=findColumn(_line3.text,endCol,state.tabSize);ranges.push(EditorSelection.range(_line3.from+_start13,_line3.from+_end31))}}}return ranges}function absoluteColumn(view,x){var ref=view.coordsAtPos(view.viewport.from);return ref?Math.round(Math.abs((ref.left-x)/view.defaultCharacterWidth)):-1}function getPos(view,event){var offset=view.posAtCoords({x:event.clientX,y:event.clientY},false);var line=view.state.doc.lineAt(offset),off=offset-line.from;var col=off>MaxOff?-1:off==line.length?absoluteColumn(view,event.clientX):_countColumn(line.text,view.state.tabSize,offset-line.from);return{line:line.number,col:col,off:off}}function rectangleSelectionStyle(view,event){var start=getPos(view,event),startSel=view.state.selection;if(!start)return null;return{update:function update(_update12){if(_update12.docChanged){var newStart=_update12.changes.mapPos(_update12.startState.doc.line(start.line).from);var newLine=_update12.state.doc.lineAt(newStart);start={line:newLine.number,col:start.col,off:Math.min(start.off,newLine.length)};startSel=startSel.map(_update12.changes)}},get:function get(event,_extend,multiple){var cur=getPos(view,event);if(!cur)return startSel;var ranges=rectangleFor(view.state,start,cur);if(!ranges.length)return startSel;if(multiple)return EditorSelection.create(ranges.concat(startSel.ranges));else return EditorSelection.create(ranges)}}}function rectangularSelection(options){var filter=(options===null||options===void 0?void 0:options.eventFilter)||function(e){return e.altKey&&e.button==0};return EditorView.mouseSelectionStyle.of(function(view,event){return filter(event)?rectangleSelectionStyle(view,event):null})}var keys={Alt:[18,function(e){return!!e.altKey}],Control:[17,function(e){return!!e.ctrlKey}],Shift:[16,function(e){return!!e.shiftKey}],Meta:[91,function(e){return!!e.metaKey}]};var showCrosshair={style:"cursor: crosshair"};function crosshairCursor(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _keys2=_slicedToArray2(keys[options.key||"Alt"],2),code=_keys2[0],getter=_keys2[1];var plugin=ViewPlugin.fromClass(function(){function _class61(view){_classCallCheck2(this,_class61);this.view=view;this.isDown=false}_createClass2(_class61,[{key:"set",value:function set(isDown){if(this.isDown!=isDown){this.isDown=isDown;this.view.update([])}}}]);return _class61}(),{eventObservers:{keydown:function keydown(e){this.set(e.keyCode==code||getter(e))},keyup:function keyup(e){if(e.keyCode==code||!getter(e))this.set(false)},mousemove:function mousemove(e){this.set(getter(e))}}});return[plugin,EditorView.contentAttributes.of(function(view){var _a;return((_a=view.plugin(plugin))===null||_a===void 0?void 0:_a.isDown)?showCrosshair:null})]}var Outside="-10000px";var TooltipViewManager=function(){function TooltipViewManager(view,facet,createTooltipView){_classCallCheck2(this,TooltipViewManager);this.facet=facet;this.createTooltipView=createTooltipView;this.input=view.state.facet(facet);this.tooltips=this.input.filter(function(t){return t});this.tooltipViews=this.tooltips.map(createTooltipView)}_createClass2(TooltipViewManager,[{key:"update",value:function update(_update13,above){var _a;var input=_update13.state.facet(this.facet);var tooltips=input.filter(function(x){return x});if(input===this.input){var _iterator292=_createForOfIteratorHelper(this.tooltipViews),_step292;try{for(_iterator292.s();!(_step292=_iterator292.n()).done;){var _t2=_step292.value;if(_t2.update)_t2.update(_update13)}}catch(err){_iterator292.e(err)}finally{_iterator292.f()}return false}var tooltipViews=[],newAbove=above?[]:null;for(var _i208=0;_i208<tooltips.length;_i208++){var tip=tooltips[_i208],known=-1;if(!tip)continue;for(var _i209=0;_i209<this.tooltips.length;_i209++){var other=this.tooltips[_i209];if(other&&other.create==tip.create)known=_i209}if(known<0){tooltipViews[_i208]=this.createTooltipView(tip);if(newAbove)newAbove[_i208]=!!tip.above}else{var tooltipView=tooltipViews[_i208]=this.tooltipViews[known];if(newAbove)newAbove[_i208]=above[known];if(tooltipView.update)tooltipView.update(_update13)}}var _iterator293=_createForOfIteratorHelper(this.tooltipViews),_step293;try{for(_iterator293.s();!(_step293=_iterator293.n()).done;){var _t3=_step293.value;if(tooltipViews.indexOf(_t3)<0){_t3.dom.remove();(_a=_t3.destroy)===null||_a===void 0?void 0:_a.call(_t3)}}}catch(err){_iterator293.e(err)}finally{_iterator293.f()}if(above){newAbove.forEach(function(val,i){return above[i]=val});above.length=newAbove.length}this.input=input;this.tooltips=tooltips;this.tooltipViews=tooltipViews;return true}}]);return TooltipViewManager}();function windowSpace(view){var win=view.win;return{top:0,left:0,bottom:win.innerHeight,right:win.innerWidth}}var tooltipConfig=Facet.define({combine:function combine(values){var _a,_b,_c;return{position:browser.ios?"absolute":((_a=values.find(function(conf){return conf.position}))===null||_a===void 0?void 0:_a.position)||"fixed",parent:((_b=values.find(function(conf){return conf.parent}))===null||_b===void 0?void 0:_b.parent)||null,tooltipSpace:((_c=values.find(function(conf){return conf.tooltipSpace}))===null||_c===void 0?void 0:_c.tooltipSpace)||windowSpace}}});var knownHeight=new WeakMap;var tooltipPlugin=ViewPlugin.fromClass(function(){function _class62(view){var _this228=this;_classCallCheck2(this,_class62);this.view=view;this.above=[];this.inView=true;this.madeAbsolute=false;this.lastTransaction=0;this.measureTimeout=-1;var config=view.state.facet(tooltipConfig);this.position=config.position;this.parent=config.parent;this.classes=view.themeClasses;this.createContainer();this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this};this.manager=new TooltipViewManager(view,showTooltip,function(t){return _this228.createTooltip(t)});this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(function(entries){if(Date.now()>_this228.lastTransaction-50&&entries.length>0&&entries[entries.length-1].intersectionRatio<1)_this228.measureSoon()},{threshold:[1]}):null;this.observeIntersection();view.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this));this.maybeMeasure()}_createClass2(_class62,[{key:"createContainer",value:function createContainer(){if(this.parent){this.container=document.createElement("div");this.container.style.position="relative";this.container.className=this.view.themeClasses;this.parent.appendChild(this.container)}else{this.container=this.view.dom}}},{key:"observeIntersection",value:function observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();var _iterator294=_createForOfIteratorHelper(this.manager.tooltipViews),_step294;try{for(_iterator294.s();!(_step294=_iterator294.n()).done;){var tooltip=_step294.value;this.intersectionObserver.observe(tooltip.dom)}}catch(err){_iterator294.e(err)}finally{_iterator294.f()}}}},{key:"measureSoon",value:function measureSoon(){var _this229=this;if(this.measureTimeout<0)this.measureTimeout=setTimeout(function(){_this229.measureTimeout=-1;_this229.maybeMeasure()},50)}},{key:"update",value:function update(_update14){if(_update14.transactions.length)this.lastTransaction=Date.now();var updated=this.manager.update(_update14,this.above);if(updated)this.observeIntersection();var shouldMeasure=updated||_update14.geometryChanged;var newConfig=_update14.state.facet(tooltipConfig);if(newConfig.position!=this.position&&!this.madeAbsolute){this.position=newConfig.position;var _iterator295=_createForOfIteratorHelper(this.manager.tooltipViews),_step295;try{for(_iterator295.s();!(_step295=_iterator295.n()).done;){var _t4=_step295.value;_t4.dom.style.position=this.position}}catch(err){_iterator295.e(err)}finally{_iterator295.f()}shouldMeasure=true}if(newConfig.parent!=this.parent){if(this.parent)this.container.remove();this.parent=newConfig.parent;this.createContainer();var _iterator296=_createForOfIteratorHelper(this.manager.tooltipViews),_step296;try{for(_iterator296.s();!(_step296=_iterator296.n()).done;){var _t5=_step296.value;this.container.appendChild(_t5.dom)}}catch(err){_iterator296.e(err)}finally{_iterator296.f()}shouldMeasure=true}else if(this.parent&&this.view.themeClasses!=this.classes){this.classes=this.container.className=this.view.themeClasses}if(shouldMeasure)this.maybeMeasure()}},{key:"createTooltip",value:function createTooltip(tooltip){var tooltipView=tooltip.create(this.view);tooltipView.dom.classList.add("cm-tooltip");if(tooltip.arrow&&!tooltipView.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){var _arrow=document.createElement("div");_arrow.className="cm-tooltip-arrow";tooltipView.dom.appendChild(_arrow)}tooltipView.dom.style.position=this.position;tooltipView.dom.style.top=Outside;tooltipView.dom.style.left="0px";this.container.appendChild(tooltipView.dom);if(tooltipView.mount)tooltipView.mount(this.view);return tooltipView}},{key:"destroy",value:function destroy(){var _a,_b;this.view.win.removeEventListener("resize",this.measureSoon);var _iterator297=_createForOfIteratorHelper(this.manager.tooltipViews),_step297;try{for(_iterator297.s();!(_step297=_iterator297.n()).done;){var tooltipView=_step297.value;tooltipView.dom.remove();(_a=tooltipView.destroy)===null||_a===void 0?void 0:_a.call(tooltipView)}}catch(err){_iterator297.e(err)}finally{_iterator297.f()}if(this.parent)this.container.remove();(_b=this.intersectionObserver)===null||_b===void 0?void 0:_b.disconnect();clearTimeout(this.measureTimeout)}},{key:"readMeasure",value:function readMeasure(){var _this230=this;var editor=this.view.dom.getBoundingClientRect();var scaleX=1,scaleY=1,makeAbsolute=false;if(this.position=="fixed"&&this.manager.tooltipViews.length){var dom=this.manager.tooltipViews[0].dom;if(browser.gecko){makeAbsolute=dom.offsetParent!=this.container.ownerDocument.body}else if(dom.style.top==Outside&&dom.style.left=="0px"){var rect=dom.getBoundingClientRect();makeAbsolute=Math.abs(rect.top+10000)>1||Math.abs(rect.left)>1}}if(makeAbsolute||this.position=="absolute"){if(this.parent){var _rect6=this.parent.getBoundingClientRect();if(_rect6.width&&_rect6.height){scaleX=_rect6.width/this.parent.offsetWidth;scaleY=_rect6.height/this.parent.offsetHeight}}else{var _this$view$viewState=this.view.viewState;scaleX=_this$view$viewState.scaleX;scaleY=_this$view$viewState.scaleY}}return{editor:editor,parent:this.parent?this.container.getBoundingClientRect():editor,pos:this.manager.tooltips.map(function(t,i){var tv=_this230.manager.tooltipViews[i];return tv.getCoords?tv.getCoords(t.pos):_this230.view.coordsAtPos(t.pos)}),size:this.manager.tooltipViews.map(function(_ref230){var dom=_ref230.dom;return dom.getBoundingClientRect()}),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view),scaleX:scaleX,scaleY:scaleY,makeAbsolute:makeAbsolute}}},{key:"writeMeasure",value:function writeMeasure(measured){var _a;if(measured.makeAbsolute){this.madeAbsolute=true;this.position="absolute";var _iterator298=_createForOfIteratorHelper(this.manager.tooltipViews),_step298;try{for(_iterator298.s();!(_step298=_iterator298.n()).done;){var _t6=_step298.value;_t6.dom.style.position="absolute"}}catch(err){_iterator298.e(err)}finally{_iterator298.f()}}var editor=measured.editor,space=measured.space,scaleX=measured.scaleX,scaleY=measured.scaleY;var others=[];for(var _i210=0;_i210<this.manager.tooltips.length;_i210++){var tooltip=this.manager.tooltips[_i210],tView=this.manager.tooltipViews[_i210],dom=tView.dom;var pos=measured.pos[_i210],size=measured.size[_i210];if(!pos||pos.bottom<=Math.max(editor.top,space.top)||pos.top>=Math.min(editor.bottom,space.bottom)||pos.right<Math.max(editor.left,space.left)-.1||pos.left>Math.min(editor.right,space.right)+.1){dom.style.top=Outside;continue}var _arrow2=tooltip.arrow?tView.dom.querySelector(".cm-tooltip-arrow"):null;var arrowHeight=_arrow2?7:0;var width=size.right-size.left,height=(_a=knownHeight.get(tView))!==null&&_a!==void 0?_a:size.bottom-size.top;var _offset6=tView.offset||noOffset,ltr=this.view.textDirection==Direction.LTR;var _left5=size.width>space.right-space.left?ltr?space.left:space.right-size.width:ltr?Math.min(pos.left-(_arrow2?14:0)+_offset6.x,space.right-width):Math.max(space.left,pos.left-width+(_arrow2?14:0)-_offset6.x);var above=this.above[_i210];if(!tooltip.strictSide&&(above?pos.top-(size.bottom-size.top)-_offset6.y<space.top:pos.bottom+(size.bottom-size.top)+_offset6.y>space.bottom)&&above==space.bottom-pos.bottom>pos.top-space.top)above=this.above[_i210]=!above;var spaceVert=(above?pos.top-space.top:space.bottom-pos.bottom)-arrowHeight;if(spaceVert<height&&tView.resize!==false){if(spaceVert<this.view.defaultLineHeight){dom.style.top=Outside;continue}knownHeight.set(tView,height);dom.style.height=(height=spaceVert)/scaleY+"px"}else if(dom.style.height){dom.style.height=""}var _top8=above?pos.top-height-arrowHeight-_offset6.y:pos.bottom+arrowHeight+_offset6.y;var _right5=_left5+width;if(tView.overlap!==true){var _iterator299=_createForOfIteratorHelper(others),_step299;try{for(_iterator299.s();!(_step299=_iterator299.n()).done;){var _r4=_step299.value;if(_r4.left<_right5&&_r4.right>_left5&&_r4.top<_top8+height&&_r4.bottom>_top8)_top8=above?_r4.top-height-2-arrowHeight:_r4.bottom+arrowHeight+2}}catch(err){_iterator299.e(err)}finally{_iterator299.f()}}if(this.position=="absolute"){dom.style.top=(_top8-measured.parent.top)/scaleY+"px";dom.style.left=(_left5-measured.parent.left)/scaleX+"px"}else{dom.style.top=_top8/scaleY+"px";dom.style.left=_left5/scaleX+"px"}if(_arrow2){var arrowLeft=pos.left+(ltr?_offset6.x:-_offset6.x)-(_left5+14-7);_arrow2.style.left=arrowLeft/scaleX+"px"}if(tView.overlap!==true)others.push({left:_left5,top:_top8,right:_right5,bottom:_top8+height});dom.classList.toggle("cm-tooltip-above",above);dom.classList.toggle("cm-tooltip-below",!above);if(tView.positioned)tView.positioned(measured.space)}}},{key:"maybeMeasure",value:function maybeMeasure(){if(this.manager.tooltips.length){if(this.view.inView)this.view.requestMeasure(this.measureReq);if(this.inView!=this.view.inView){this.inView=this.view.inView;if(!this.inView){var _iterator300=_createForOfIteratorHelper(this.manager.tooltipViews),_step300;try{for(_iterator300.s();!(_step300=_iterator300.n()).done;){var tv=_step300.value;tv.dom.style.top=Outside}}catch(err){_iterator300.e(err)}finally{_iterator300.f()}}}}}}]);return _class62}(),{eventObservers:{scroll:function scroll(){this.maybeMeasure()}}});var baseTheme$4=EditorView.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"".concat(7,"px"),width:"".concat(7*2,"px"),position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"".concat(7,"px solid transparent"),borderRight:"".concat(7,"px solid transparent")},".cm-tooltip-above &":{bottom:"-".concat(7,"px"),"&:before":{borderTop:"".concat(7,"px solid #bbb")},"&:after":{borderTop:"".concat(7,"px solid #f5f5f5"),bottom:"1px"}},".cm-tooltip-below &":{top:"-".concat(7,"px"),"&:before":{borderBottom:"".concat(7,"px solid #bbb")},"&:after":{borderBottom:"".concat(7,"px solid #f5f5f5"),top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}});var noOffset={x:0,y:0};var showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$4]});var showHoverTooltip=Facet.define();var HoverTooltipHost=function(){function HoverTooltipHost(view){var _this231=this;_classCallCheck2(this,HoverTooltipHost);this.view=view;this.mounted=false;this.dom=document.createElement("div");this.dom.classList.add("cm-tooltip-hover");this.manager=new TooltipViewManager(view,showHoverTooltip,function(t){return _this231.createHostedView(t)})}_createClass2(HoverTooltipHost,[{key:"createHostedView",value:function createHostedView(tooltip){var hostedView=tooltip.create(this.view);hostedView.dom.classList.add("cm-tooltip-section");this.dom.appendChild(hostedView.dom);if(this.mounted&&hostedView.mount)hostedView.mount(this.view);return hostedView}},{key:"mount",value:function mount(view){var _iterator301=_createForOfIteratorHelper(this.manager.tooltipViews),_step301;try{for(_iterator301.s();!(_step301=_iterator301.n()).done;){var hostedView=_step301.value;if(hostedView.mount)hostedView.mount(view)}}catch(err){_iterator301.e(err)}finally{_iterator301.f()}this.mounted=true}},{key:"positioned",value:function positioned(space){var _iterator302=_createForOfIteratorHelper(this.manager.tooltipViews),_step302;try{for(_iterator302.s();!(_step302=_iterator302.n()).done;){var hostedView=_step302.value;if(hostedView.positioned)hostedView.positioned(space)}}catch(err){_iterator302.e(err)}finally{_iterator302.f()}}},{key:"update",value:function update(_update15){this.manager.update(_update15)}},{key:"destroy",value:function destroy(){var _a;var _iterator303=_createForOfIteratorHelper(this.manager.tooltipViews),_step303;try{for(_iterator303.s();!(_step303=_iterator303.n()).done;){var _t7=_step303.value;(_a=_t7.destroy)===null||_a===void 0?void 0:_a.call(_t7)}}catch(err){_iterator303.e(err)}finally{_iterator303.f()}}},{key:"passProp",value:function passProp(name){var value=undefined;var _iterator304=_createForOfIteratorHelper(this.manager.tooltipViews),_step304;try{for(_iterator304.s();!(_step304=_iterator304.n()).done;){var view=_step304.value;var given=view[name];if(given!==undefined){if(value===undefined)value=given;else if(value!==given)return undefined}}}catch(err){_iterator304.e(err)}finally{_iterator304.f()}return value}},{key:"offset",get:function get(){return this.passProp("offset")}},{key:"getCoords",get:function get(){return this.passProp("getCoords")}},{key:"overlap",get:function get(){return this.passProp("overlap")}},{key:"resize",get:function get(){return this.passProp("resize")}}],[{key:"create",value:function create(view){return new HoverTooltipHost(view)}}]);return HoverTooltipHost}();var showHoverTooltipHost=showTooltip.compute([showHoverTooltip],function(state){var tooltips=state.facet(showHoverTooltip).filter(function(t){return t});if(tooltips.length===0)return null;return{pos:Math.min.apply(Math,_toConsumableArray2(tooltips.map(function(t){return t.pos}))),end:Math.max.apply(Math,_toConsumableArray2(tooltips.map(function(t){var _a;return(_a=t.end)!==null&&_a!==void 0?_a:t.pos}))),create:HoverTooltipHost.create,above:tooltips[0].above,arrow:tooltips.some(function(t){return t.arrow})}});var HoverPlugin=function(){function HoverPlugin(view,source,field,setHover,hoverTime){_classCallCheck2(this,HoverPlugin);this.view=view;this.source=source;this.field=field;this.setHover=setHover;this.hoverTime=hoverTime;this.hoverTimeout=-1;this.restartTimeout=-1;this.pending=null;this.lastMove={x:0,y:0,target:view.dom,time:0};this.checkHover=this.checkHover.bind(this);view.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this));view.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}_createClass2(HoverPlugin,[{key:"update",value:function update(){var _this232=this;if(this.pending){this.pending=null;clearTimeout(this.restartTimeout);this.restartTimeout=setTimeout(function(){return _this232.startHover()},20)}}},{key:"active",get:function get(){return this.view.state.field(this.field)}},{key:"checkHover",value:function checkHover(){this.hoverTimeout=-1;if(this.active)return;var hovered=Date.now()-this.lastMove.time;if(hovered<this.hoverTime)this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-hovered);else this.startHover()}},{key:"startHover",value:function startHover(){var _this233=this;clearTimeout(this.restartTimeout);var view=this.view,lastMove=this.lastMove;var desc=view.docView.nearest(lastMove.target);if(!desc)return;var pos,side=1;if(desc instanceof WidgetView){pos=desc.posAtStart}else{pos=view.posAtCoords(lastMove);if(pos==null)return;var posCoords=view.coordsAtPos(pos);if(!posCoords||lastMove.y<posCoords.top||lastMove.y>posCoords.bottom||lastMove.x<posCoords.left-view.defaultCharacterWidth||lastMove.x>posCoords.right+view.defaultCharacterWidth)return;var bidi=view.bidiSpans(view.state.doc.lineAt(pos)).find(function(s){return s.from<=pos&&s.to>=pos});var rtl=bidi&&bidi.dir==Direction.RTL?-1:1;side=lastMove.x<posCoords.left?-rtl:rtl}var open=this.source(view,pos,side);if(open===null||open===void 0?void 0:open.then){var pending=this.pending={pos:pos};open.then(function(result){if(_this233.pending==pending){_this233.pending=null;if(result)view.dispatch({effects:_this233.setHover.of(result)})}},function(e){return logException(view.state,e,"hover tooltip")})}else if(open){view.dispatch({effects:this.setHover.of(open)})}}},{key:"tooltip",get:function get(){var plugin=this.view.plugin(tooltipPlugin);var index=plugin?plugin.manager.tooltips.findIndex(function(t){return t.create==HoverTooltipHost.create}):-1;return index>-1?plugin.manager.tooltipViews[index]:null}},{key:"mousemove",value:function mousemove(event){var _a;this.lastMove={x:event.clientX,y:event.clientY,target:event.target,time:Date.now()};if(this.hoverTimeout<0)this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime);var active=this.active,tooltip=this.tooltip;if(active&&tooltip&&!isInTooltip(tooltip.dom,event)||this.pending){var _ref231=active||this.pending,pos=_ref231.pos,_end32=(_a=active===null||active===void 0?void 0:active.end)!==null&&_a!==void 0?_a:pos;if(pos==_end32?this.view.posAtCoords(this.lastMove)!=pos:!isOverRange(this.view,pos,_end32,event.clientX,event.clientY)){this.view.dispatch({effects:this.setHover.of(null)});this.pending=null}}}},{key:"mouseleave",value:function mouseleave(event){clearTimeout(this.hoverTimeout);this.hoverTimeout=-1;var active=this.active;if(active){var tooltip=this.tooltip;var inTooltip=tooltip&&tooltip.dom.contains(event.relatedTarget);if(!inTooltip)this.view.dispatch({effects:this.setHover.of(null)});else this.watchTooltipLeave(tooltip.dom)}}},{key:"watchTooltipLeave",value:function watchTooltipLeave(tooltip){var _this234=this;var watch=function watch(event){tooltip.removeEventListener("mouseleave",watch);if(_this234.active&&!_this234.view.dom.contains(event.relatedTarget))_this234.view.dispatch({effects:_this234.setHover.of(null)})};tooltip.addEventListener("mouseleave",watch)}},{key:"destroy",value:function destroy(){clearTimeout(this.hoverTimeout);this.view.dom.removeEventListener("mouseleave",this.mouseleave);this.view.dom.removeEventListener("mousemove",this.mousemove)}}]);return HoverPlugin}();var tooltipMargin=4;function isInTooltip(tooltip,event){var rect=tooltip.getBoundingClientRect();return event.clientX>=rect.left-tooltipMargin&&event.clientX<=rect.right+tooltipMargin&&event.clientY>=rect.top-tooltipMargin&&event.clientY<=rect.bottom+tooltipMargin}function isOverRange(view,from,to,x,y,margin){var rect=view.scrollDOM.getBoundingClientRect();var docBottom=view.documentTop+view.documentPadding.top+view.contentHeight;if(rect.left>x||rect.right<x||rect.top>y||Math.min(rect.bottom,docBottom)<y)return false;var pos=view.posAtCoords({x:x,y:y},false);return pos>=from&&pos<=to}function hoverTooltip(source){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var setHover=StateEffect.define();var hoverState=StateField.define({create:function create(){return null},update:function update(value,tr){if(value&&(options.hideOnChange&&(tr.docChanged||tr.selection)||options.hideOn&&options.hideOn(tr,value)))return null;if(value&&tr.docChanged){var newPos=tr.changes.mapPos(value.pos,-1,MapMode.TrackDel);if(newPos==null)return null;var copy=Object.assign(Object.create(null),value);copy.pos=newPos;if(value.end!=null)copy.end=tr.changes.mapPos(value.end);value=copy}var _iterator305=_createForOfIteratorHelper(tr.effects),_step305;try{for(_iterator305.s();!(_step305=_iterator305.n()).done;){var _effect5=_step305.value;if(_effect5.is(setHover))value=_effect5.value;if(_effect5.is(closeHoverTooltipEffect))value=null}}catch(err){_iterator305.e(err)}finally{_iterator305.f()}return value},provide:function provide(f){return showHoverTooltip.from(f)}});return[hoverState,ViewPlugin.define(function(view){return new HoverPlugin(view,source,hoverState,setHover,options.hoverTime||300)}),showHoverTooltipHost]}function getTooltip(view,tooltip){var plugin=view.plugin(tooltipPlugin);if(!plugin)return null;var found=plugin.manager.tooltips.indexOf(tooltip);return found<0?null:plugin.manager.tooltipViews[found]}var closeHoverTooltipEffect=StateEffect.define();var panelConfig=Facet.define({combine:function combine(configs){var topContainer,bottomContainer;var _iterator306=_createForOfIteratorHelper(configs),_step306;try{for(_iterator306.s();!(_step306=_iterator306.n()).done;){var c=_step306.value;topContainer=topContainer||c.topContainer;bottomContainer=bottomContainer||c.bottomContainer}}catch(err){_iterator306.e(err)}finally{_iterator306.f()}return{topContainer:topContainer,bottomContainer:bottomContainer}}});function getPanel(view,panel){var plugin=view.plugin(panelPlugin);var index=plugin?plugin.specs.indexOf(panel):-1;return index>-1?plugin.panels[index]:null}var panelPlugin=ViewPlugin.fromClass(function(){function _class63(view){_classCallCheck2(this,_class63);this.input=view.state.facet(showPanel);this.specs=this.input.filter(function(s){return s});this.panels=this.specs.map(function(spec){return spec(view)});var conf=view.state.facet(panelConfig);this.top=new PanelGroup(view,true,conf.topContainer);this.bottom=new PanelGroup(view,false,conf.bottomContainer);this.top.sync(this.panels.filter(function(p){return p.top}));this.bottom.sync(this.panels.filter(function(p){return!p.top}));var _iterator307=_createForOfIteratorHelper(this.panels),_step307;try{for(_iterator307.s();!(_step307=_iterator307.n()).done;){var _p2=_step307.value;_p2.dom.classList.add("cm-panel");if(_p2.mount)_p2.mount()}}catch(err){_iterator307.e(err)}finally{_iterator307.f()}}_createClass2(_class63,[{key:"update",value:function update(_update16){var conf=_update16.state.facet(panelConfig);if(this.top.container!=conf.topContainer){this.top.sync([]);this.top=new PanelGroup(_update16.view,true,conf.topContainer)}if(this.bottom.container!=conf.bottomContainer){this.bottom.sync([]);this.bottom=new PanelGroup(_update16.view,false,conf.bottomContainer)}this.top.syncClasses();this.bottom.syncClasses();var input=_update16.state.facet(showPanel);if(input!=this.input){var specs=input.filter(function(x){return x});var panels=[],_top9=[],_bottom2=[],mount=[];var _iterator308=_createForOfIteratorHelper(specs),_step308;try{for(_iterator308.s();!(_step308=_iterator308.n()).done;){var spec=_step308.value;var known=this.specs.indexOf(spec),panel=void 0;if(known<0){panel=spec(_update16.view);mount.push(panel)}else{panel=this.panels[known];if(panel.update)panel.update(_update16)}panels.push(panel);(panel.top?_top9:_bottom2).push(panel)}}catch(err){_iterator308.e(err)}finally{_iterator308.f()}this.specs=specs;this.panels=panels;this.top.sync(_top9);this.bottom.sync(_bottom2);for(var _i211=0,_mount=mount;_i211<_mount.length;_i211++){var _p3=_mount[_i211];_p3.dom.classList.add("cm-panel");if(_p3.mount)_p3.mount()}}else{var _iterator309=_createForOfIteratorHelper(this.panels),_step309;try{for(_iterator309.s();!(_step309=_iterator309.n()).done;){var _p4=_step309.value;if(_p4.update)_p4.update(_update16)}}catch(err){_iterator309.e(err)}finally{_iterator309.f()}}}},{key:"destroy",value:function destroy(){this.top.sync([]);this.bottom.sync([])}}]);return _class63}(),{provide:function provide(plugin){return EditorView.scrollMargins.of(function(view){var value=view.plugin(plugin);return value&&{top:value.top.scrollMargin(),bottom:value.bottom.scrollMargin()}})}});var PanelGroup=function(){function PanelGroup(view,top,container){_classCallCheck2(this,PanelGroup);this.view=view;this.top=top;this.container=container;this.dom=undefined;this.classes="";this.panels=[];this.syncClasses()}_createClass2(PanelGroup,[{key:"sync",value:function sync(panels){var _iterator310=_createForOfIteratorHelper(this.panels),_step310;try{for(_iterator310.s();!(_step310=_iterator310.n()).done;){var _p5=_step310.value;if(_p5.destroy&&panels.indexOf(_p5)<0)_p5.destroy()}}catch(err){_iterator310.e(err)}finally{_iterator310.f()}this.panels=panels;this.syncDOM()}},{key:"syncDOM",value:function syncDOM(){if(this.panels.length==0){if(this.dom){this.dom.remove();this.dom=undefined}return}if(!this.dom){this.dom=document.createElement("div");this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom";this.dom.style[this.top?"top":"bottom"]="0";var parent=this.container||this.view.dom;parent.insertBefore(this.dom,this.top?parent.firstChild:null)}var curDOM=this.dom.firstChild;var _iterator311=_createForOfIteratorHelper(this.panels),_step311;try{for(_iterator311.s();!(_step311=_iterator311.n()).done;){var panel=_step311.value;if(panel.dom.parentNode==this.dom){while(curDOM!=panel.dom)curDOM=rm(curDOM);curDOM=curDOM.nextSibling}else{this.dom.insertBefore(panel.dom,curDOM)}}}catch(err){_iterator311.e(err)}finally{_iterator311.f()}while(curDOM)curDOM=rm(curDOM)}},{key:"scrollMargin",value:function scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}},{key:"syncClasses",value:function syncClasses(){if(!this.container||this.classes==this.view.themeClasses)return;var _iterator312=_createForOfIteratorHelper(this.classes.split(" ")),_step312;try{for(_iterator312.s();!(_step312=_iterator312.n()).done;){var cls=_step312.value;if(cls)this.container.classList.remove(cls)}}catch(err){_iterator312.e(err)}finally{_iterator312.f()}var _iterator313=_createForOfIteratorHelper((this.classes=this.view.themeClasses).split(" ")),_step313;try{for(_iterator313.s();!(_step313=_iterator313.n()).done;){var _cls2=_step313.value;if(_cls2)this.container.classList.add(_cls2)}}catch(err){_iterator313.e(err)}finally{_iterator313.f()}}}]);return PanelGroup}();function rm(node){var next=node.nextSibling;node.remove();return next}var showPanel=Facet.define({enables:panelPlugin});var GutterMarker=function(_RangeValue2){_inherits2(GutterMarker,_RangeValue2);var _super93=_createSuper(GutterMarker);function GutterMarker(){_classCallCheck2(this,GutterMarker);return _super93.apply(this,arguments)}_createClass2(GutterMarker,[{key:"compare",value:function compare(other){return this==other||this.constructor==other.constructor&&this.eq(other)}},{key:"eq",value:function eq(other){return false}},{key:"destroy",value:function destroy(dom){}}]);return GutterMarker}(RangeValue);GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=undefined;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=true;var gutterLineClass=Facet.define();var defaults$1={"class":"",renderEmptyElements:false,elementStyle:"",markers:function markers(){return RangeSet.empty},lineMarker:function lineMarker(){return null},widgetMarker:function widgetMarker(){return null},lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}};var activeGutters=Facet.define();function gutter(config){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults$1),config))]}var unfixGutters=Facet.define({combine:function combine(values){return values.some(function(x){return x})}});function gutters(config){var result=[gutterView];if(config&&config.fixed===false)result.push(unfixGutters.of(true));return result}var gutterView=ViewPlugin.fromClass(function(){function _class64(view){_classCallCheck2(this,_class64);this.view=view;this.prevViewport=view.viewport;this.dom=document.createElement("div");this.dom.className="cm-gutters";this.dom.setAttribute("aria-hidden","true");this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px";this.gutters=view.state.facet(activeGutters).map(function(conf){return new SingleGutterView(view,conf)});var _iterator314=_createForOfIteratorHelper(this.gutters),_step314;try{for(_iterator314.s();!(_step314=_iterator314.n()).done;){var _gutter=_step314.value;this.dom.appendChild(_gutter.dom)}}catch(err){_iterator314.e(err)}finally{_iterator314.f()}this.fixed=!view.state.facet(unfixGutters);if(this.fixed){this.dom.style.position="sticky"}this.syncGutters(false);view.scrollDOM.insertBefore(this.dom,view.contentDOM)}_createClass2(_class64,[{key:"update",value:function update(_update17){if(this.updateGutters(_update17)){var vpA=this.prevViewport,vpB=_update17.view.viewport;var vpOverlap=Math.min(vpA.to,vpB.to)-Math.max(vpA.from,vpB.from);this.syncGutters(vpOverlap<(vpB.to-vpB.from)*0.8)}if(_update17.geometryChanged)this.dom.style.minHeight=this.view.contentHeight+"px";if(this.view.state.facet(unfixGutters)!=!this.fixed){this.fixed=!this.fixed;this.dom.style.position=this.fixed?"sticky":""}this.prevViewport=_update17.view.viewport}},{key:"syncGutters",value:function syncGutters(detach){var _this235=this;var after=this.dom.nextSibling;if(detach)this.dom.remove();var lineClasses=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from);var classSet=[];var contexts=this.gutters.map(function(gutter){return new UpdateContext(gutter,_this235.view.viewport,-_this235.view.documentPadding.top)});var _iterator315=_createForOfIteratorHelper(this.view.viewportLineBlocks),_step315;try{for(_iterator315.s();!(_step315=_iterator315.n()).done;){var line=_step315.value;if(classSet.length)classSet=[];if(Array.isArray(line.type)){var first=true;var _iterator317=_createForOfIteratorHelper(line.type),_step317;try{for(_iterator317.s();!(_step317=_iterator317.n()).done;){var b=_step317.value;if(b.type==BlockType.Text&&first){advanceCursor(lineClasses,classSet,b.from);var _iterator318=_createForOfIteratorHelper(contexts),_step318;try{for(_iterator318.s();!(_step318=_iterator318.n()).done;){var cx=_step318.value;cx.line(this.view,b,classSet)}}catch(err){_iterator318.e(err)}finally{_iterator318.f()}first=false}else if(b.widget){var _iterator319=_createForOfIteratorHelper(contexts),_step319;try{for(_iterator319.s();!(_step319=_iterator319.n()).done;){var _cx2=_step319.value;_cx2.widget(this.view,b)}}catch(err){_iterator319.e(err)}finally{_iterator319.f()}}}}catch(err){_iterator317.e(err)}finally{_iterator317.f()}}else if(line.type==BlockType.Text){advanceCursor(lineClasses,classSet,line.from);var _iterator320=_createForOfIteratorHelper(contexts),_step320;try{for(_iterator320.s();!(_step320=_iterator320.n()).done;){var _cx3=_step320.value;_cx3.line(this.view,line,classSet)}}catch(err){_iterator320.e(err)}finally{_iterator320.f()}}else if(line.widget){var _iterator321=_createForOfIteratorHelper(contexts),_step321;try{for(_iterator321.s();!(_step321=_iterator321.n()).done;){var _cx4=_step321.value;_cx4.widget(this.view,line)}}catch(err){_iterator321.e(err)}finally{_iterator321.f()}}}}catch(err){_iterator315.e(err)}finally{_iterator315.f()}var _iterator316=_createForOfIteratorHelper(contexts),_step316;try{for(_iterator316.s();!(_step316=_iterator316.n()).done;){var _cx5=_step316.value;_cx5.finish()}}catch(err){_iterator316.e(err)}finally{_iterator316.f()}if(detach)this.view.scrollDOM.insertBefore(this.dom,after)}},{key:"updateGutters",value:function updateGutters(update){var prev=update.startState.facet(activeGutters),cur=update.state.facet(activeGutters);var change=update.docChanged||update.heightChanged||update.viewportChanged||!RangeSet.eq(update.startState.facet(gutterLineClass),update.state.facet(gutterLineClass),update.view.viewport.from,update.view.viewport.to);if(prev==cur){var _iterator322=_createForOfIteratorHelper(this.gutters),_step322;try{for(_iterator322.s();!(_step322=_iterator322.n()).done;){var _gutter2=_step322.value;if(_gutter2.update(update))change=true}}catch(err){_iterator322.e(err)}finally{_iterator322.f()}}else{change=true;var _gutters=[];var _iterator323=_createForOfIteratorHelper(cur),_step323;try{for(_iterator323.s();!(_step323=_iterator323.n()).done;){var conf=_step323.value;var known=prev.indexOf(conf);if(known<0){_gutters.push(new SingleGutterView(this.view,conf))}else{this.gutters[known].update(update);_gutters.push(this.gutters[known])}}}catch(err){_iterator323.e(err)}finally{_iterator323.f()}var _iterator324=_createForOfIteratorHelper(this.gutters),_step324;try{for(_iterator324.s();!(_step324=_iterator324.n()).done;){var _g2=_step324.value;_g2.dom.remove();if(_gutters.indexOf(_g2)<0)_g2.destroy()}}catch(err){_iterator324.e(err)}finally{_iterator324.f()}for(var _i212=0,_gutters2=_gutters;_i212<_gutters2.length;_i212++){var g=_gutters2[_i212];this.dom.appendChild(g.dom)}this.gutters=_gutters}return change}},{key:"destroy",value:function destroy(){var _iterator325=_createForOfIteratorHelper(this.gutters),_step325;try{for(_iterator325.s();!(_step325=_iterator325.n()).done;){var view=_step325.value;view.destroy()}}catch(err){_iterator325.e(err)}finally{_iterator325.f()}this.dom.remove()}}]);return _class64}(),{provide:function provide(plugin){return EditorView.scrollMargins.of(function(view){var value=view.plugin(plugin);if(!value||value.gutters.length==0||!value.fixed)return null;return view.textDirection==Direction.LTR?{left:value.dom.offsetWidth*view.scaleX}:{right:value.dom.offsetWidth*view.scaleX}})}});function asArray(val){return Array.isArray(val)?val:[val]}function advanceCursor(cursor,collect,pos){while(cursor.value&&cursor.from<=pos){if(cursor.from==pos)collect.push(cursor.value);cursor.next()}}var UpdateContext=function(){function UpdateContext(gutter,viewport,height){_classCallCheck2(this,UpdateContext);this.gutter=gutter;this.height=height;this.i=0;this.cursor=RangeSet.iter(gutter.markers,viewport.from)}_createClass2(UpdateContext,[{key:"addElement",value:function addElement(view,block,markers){var gutter=this.gutter,above=(block.top-this.height)/view.scaleY,height=block.height/view.scaleY;if(this.i==gutter.elements.length){var newElt=new GutterElement(view,height,above,markers);gutter.elements.push(newElt);gutter.dom.appendChild(newElt.dom)}else{gutter.elements[this.i].update(view,height,above,markers)}this.height=block.bottom;this.i++}},{key:"line",value:function line(view,_line4,extraMarkers){var localMarkers=[];advanceCursor(this.cursor,localMarkers,_line4.from);if(extraMarkers.length)localMarkers=localMarkers.concat(extraMarkers);var forLine=this.gutter.config.lineMarker(view,_line4,localMarkers);if(forLine)localMarkers.unshift(forLine);var gutter=this.gutter;if(localMarkers.length==0&&!gutter.config.renderEmptyElements)return;this.addElement(view,_line4,localMarkers)}},{key:"widget",value:function widget(view,block){var marker=this.gutter.config.widgetMarker(view,block.widget,block);if(marker)this.addElement(view,block,[marker])}},{key:"finish",value:function finish(){var gutter=this.gutter;while(gutter.elements.length>this.i){var last=gutter.elements.pop();gutter.dom.removeChild(last.dom);last.destroy()}}}]);return UpdateContext}();var SingleGutterView=function(){function SingleGutterView(view,config){var _this236=this;_classCallCheck2(this,SingleGutterView);this.view=view;this.config=config;this.elements=[];this.spacer=null;this.dom=document.createElement("div");this.dom.className="cm-gutter"+(this.config["class"]?" "+this.config["class"]:"");var _loop18=function _loop18(prop){_this236.dom.addEventListener(prop,function(event){var target=event.target,y;if(target!=_this236.dom&&_this236.dom.contains(target)){while(target.parentNode!=_this236.dom)target=target.parentNode;var rect=target.getBoundingClientRect();y=(rect.top+rect.bottom)/2}else{y=event.clientY}var line=view.lineBlockAtHeight(y-view.documentTop);if(config.domEventHandlers[prop](view,line,event))event.preventDefault()})};for(var prop in config.domEventHandlers){_loop18(prop)}this.markers=asArray(config.markers(view));if(config.initialSpacer){this.spacer=new GutterElement(view,0,0,[config.initialSpacer(view)]);this.dom.appendChild(this.spacer.dom);this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none"}}_createClass2(SingleGutterView,[{key:"update",value:function update(_update18){var prevMarkers=this.markers;this.markers=asArray(this.config.markers(_update18.view));if(this.spacer&&this.config.updateSpacer){var updated=this.config.updateSpacer(this.spacer.markers[0],_update18);if(updated!=this.spacer.markers[0])this.spacer.update(_update18.view,0,0,[updated])}var vp=_update18.view.viewport;return!RangeSet.eq(this.markers,prevMarkers,vp.from,vp.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(_update18):false)}},{key:"destroy",value:function destroy(){var _iterator326=_createForOfIteratorHelper(this.elements),_step326;try{for(_iterator326.s();!(_step326=_iterator326.n()).done;){var _elt4=_step326.value;_elt4.destroy()}}catch(err){_iterator326.e(err)}finally{_iterator326.f()}}}]);return SingleGutterView}();var GutterElement=function(){function GutterElement(view,height,above,markers){_classCallCheck2(this,GutterElement);this.height=-1;this.above=0;this.markers=[];this.dom=document.createElement("div");this.dom.className="cm-gutterElement";this.update(view,height,above,markers)}_createClass2(GutterElement,[{key:"update",value:function update(view,height,above,markers){if(this.height!=height){this.height=height;this.dom.style.height=height+"px"}if(this.above!=above)this.dom.style.marginTop=(this.above=above)?above+"px":"";if(!sameMarkers(this.markers,markers))this.setMarkers(view,markers)}},{key:"setMarkers",value:function setMarkers(view,markers){var cls="cm-gutterElement",domPos=this.dom.firstChild;for(var iNew=0,iOld=0;;){var skipTo=iOld,marker=iNew<markers.length?markers[iNew++]:null,matched=false;if(marker){var c=marker.elementClass;if(c)cls+=" "+c;for(var _i213=iOld;_i213<this.markers.length;_i213++)if(this.markers[_i213].compare(marker)){skipTo=_i213;matched=true;break}}else{skipTo=this.markers.length}while(iOld<skipTo){var next=this.markers[iOld++];if(next.toDOM){next.destroy(domPos);var _after5=domPos.nextSibling;domPos.remove();domPos=_after5}}if(!marker)break;if(marker.toDOM){if(matched)domPos=domPos.nextSibling;else this.dom.insertBefore(marker.toDOM(view),domPos)}if(matched)iOld++}this.dom.className=cls;this.markers=markers}},{key:"destroy",value:function destroy(){this.setMarkers(null,[])}}]);return GutterElement}();function sameMarkers(a,b){if(a.length!=b.length)return false;for(var _i214=0;_i214<a.length;_i214++)if(!a[_i214].compare(b[_i214]))return false;return true}var lineNumberMarkers=Facet.define();var lineNumberConfig=Facet.define({combine:function combine(values){return combineConfig(values,{formatNumber:String,domEventHandlers:{}},{domEventHandlers:function domEventHandlers(a,b){var result=Object.assign({},a);var _loop19=function _loop19(){var exists=result[event],add=b[event];result[event]=exists?function(view,line,event){return exists(view,line,event)||add(view,line,event)}:add};for(var event in b){_loop19()}return result}})}});var NumberMarker=function(_GutterMarker){_inherits2(NumberMarker,_GutterMarker);var _super94=_createSuper(NumberMarker);function NumberMarker(number){var _this237;_classCallCheck2(this,NumberMarker);_this237=_super94.call(this);_this237.number=number;return _this237}_createClass2(NumberMarker,[{key:"eq",value:function eq(other){return this.number==other.number}},{key:"toDOM",value:function toDOM(){return document.createTextNode(this.number)}}]);return NumberMarker}(GutterMarker);function formatNumber(view,number){return view.state.facet(lineNumberConfig).formatNumber(number,view.state)}var lineNumberGutter=activeGutters.compute([lineNumberConfig],function(state){return{"class":"cm-lineNumbers",renderEmptyElements:false,markers:function markers(view){return view.state.facet(lineNumberMarkers)},lineMarker:function lineMarker(view,line,others){if(others.some(function(m){return m.toDOM}))return null;return new NumberMarker(formatNumber(view,view.state.doc.lineAt(line.from).number))},widgetMarker:function widgetMarker(){return null},lineMarkerChange:function lineMarkerChange(update){return update.startState.facet(lineNumberConfig)!=update.state.facet(lineNumberConfig)},initialSpacer:function initialSpacer(view){return new NumberMarker(formatNumber(view,maxLineNumber(view.state.doc.lines)))},updateSpacer:function updateSpacer(spacer,update){var max=formatNumber(update.view,maxLineNumber(update.view.state.doc.lines));return max==spacer.number?spacer:new NumberMarker(max)},domEventHandlers:state.facet(lineNumberConfig).domEventHandlers}});function lineNumbers(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[lineNumberConfig.of(config),gutters(),lineNumberGutter]}function maxLineNumber(lines){var last=9;while(last<lines)last=last*10+9;return last}var activeLineGutterMarker=new(function(_GutterMarker2){_inherits2(_class65,_GutterMarker2);var _super95=_createSuper(_class65);function _class65(){var _this238;_classCallCheck2(this,_class65);_this238=_super95.apply(this,arguments);_this238.elementClass="cm-activeLineGutter";return _this238}return _createClass2(_class65)}(GutterMarker));var activeLineGutterHighlighter=gutterLineClass.compute(["selection"],function(state){var marks=[],last=-1;var _iterator327=_createForOfIteratorHelper(state.selection.ranges),_step327;try{for(_iterator327.s();!(_step327=_iterator327.n()).done;){var range=_step327.value;var linePos=state.doc.lineAt(range.head).from;if(linePos>last){last=linePos;marks.push(activeLineGutterMarker.range(linePos))}}}catch(err){_iterator327.e(err)}finally{_iterator327.f()}return RangeSet.of(marks)});function highlightActiveLineGutter(){return activeLineGutterHighlighter}var DefaultBufferLength=1024;var nextPropID=0;var Range=_createClass2(function Range(from,to){_classCallCheck2(this,Range);this.from=from;this.to=to});var NodeProp=function(){function NodeProp(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck2(this,NodeProp);this.id=nextPropID++;this.perNode=!!config.perNode;this.deserialize=config.deserialize||function(){throw new Error("This node type doesn't define a deserialize function")}}_createClass2(NodeProp,[{key:"add",value:function add(match){var _this239=this;if(this.perNode)throw new RangeError("Can't add per-node props to node types");if(typeof match!="function")match=NodeType.match(match);return function(type){var result=match(type);return result===undefined?null:[_this239,result]}}}]);return NodeProp}();NodeProp.closedBy=new NodeProp({deserialize:function deserialize(str){return str.split(" ")}});NodeProp.openedBy=new NodeProp({deserialize:function deserialize(str){return str.split(" ")}});NodeProp.group=new NodeProp({deserialize:function deserialize(str){return str.split(" ")}});NodeProp.isolate=new NodeProp({deserialize:function deserialize(value){if(value&&value!="rtl"&&value!="ltr"&&value!="auto")throw new RangeError("Invalid value for isolate: "+value);return value||"auto"}});NodeProp.contextHash=new NodeProp({perNode:true});NodeProp.lookAhead=new NodeProp({perNode:true});NodeProp.mounted=new NodeProp({perNode:true});var MountedTree=function(){function MountedTree(tree,overlay,parser){_classCallCheck2(this,MountedTree);this.tree=tree;this.overlay=overlay;this.parser=parser}_createClass2(MountedTree,null,[{key:"get",value:function get(tree){return tree&&tree.props&&tree.props[NodeProp.mounted.id]}}]);return MountedTree}();var noProps=Object.create(null);var NodeType=function(){function NodeType(name,props,id){var flags=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck2(this,NodeType);this.name=name;this.props=props;this.id=id;this.flags=flags}_createClass2(NodeType,[{key:"prop",value:function prop(_prop){return this.props[_prop.id]}},{key:"isTop",get:function get(){return(this.flags&1)>0}},{key:"isSkipped",get:function get(){return(this.flags&2)>0}},{key:"isError",get:function get(){return(this.flags&4)>0}},{key:"isAnonymous",get:function get(){return(this.flags&8)>0}},{key:"is",value:function is(name){if(typeof name=="string"){if(this.name==name)return true;var group=this.prop(NodeProp.group);return group?group.indexOf(name)>-1:false}return this.id==name}}],[{key:"define",value:function define(spec){var props=spec.props&&spec.props.length?Object.create(null):noProps;var flags=(spec.top?1:0)|(spec.skipped?2:0)|(spec.error?4:0)|(spec.name==null?8:0);var type=new NodeType(spec.name||"",props,spec.id,flags);if(spec.props){var _iterator328=_createForOfIteratorHelper(spec.props),_step328;try{for(_iterator328.s();!(_step328=_iterator328.n()).done;){var src=_step328.value;if(!Array.isArray(src))src=src(type);if(src){if(src[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");props[src[0].id]=src[1]}}}catch(err){_iterator328.e(err)}finally{_iterator328.f()}}return type}},{key:"match",value:function match(map){var direct=Object.create(null);for(var prop in map){var _iterator329=_createForOfIteratorHelper(prop.split(" ")),_step329;try{for(_iterator329.s();!(_step329=_iterator329.n()).done;){var _name23=_step329.value;direct[_name23]=map[prop]}}catch(err){_iterator329.e(err)}finally{_iterator329.f()}}return function(node){for(var groups=node.prop(NodeProp.group),_i215=-1;_i215<(groups?groups.length:0);_i215++){var found=direct[_i215<0?node.name:groups[_i215]];if(found)return found}}}}]);return NodeType}();NodeType.none=new NodeType("",Object.create(null),0,8);var NodeSet=function(){function NodeSet(types){_classCallCheck2(this,NodeSet);this.types=types;for(var _i216=0;_i216<types.length;_i216++)if(types[_i216].id!=_i216)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}_createClass2(NodeSet,[{key:"extend",value:function extend(){var newTypes=[];for(var _len16=arguments.length,props=new Array(_len16),_key11=0;_key11<_len16;_key11++){props[_key11]=arguments[_key11]}var _iterator330=_createForOfIteratorHelper(this.types),_step330;try{for(_iterator330.s();!(_step330=_iterator330.n()).done;){var type=_step330.value;var newProps=null;var _iterator331=_createForOfIteratorHelper(props),_step331;try{for(_iterator331.s();!(_step331=_iterator331.n()).done;){var source=_step331.value;var _add3=source(type);if(_add3){if(!newProps)newProps=Object.assign({},type.props);newProps[_add3[0].id]=_add3[1]}}}catch(err){_iterator331.e(err)}finally{_iterator331.f()}newTypes.push(newProps?new NodeType(type.name,newProps,type.id,type.flags):type)}}catch(err){_iterator330.e(err)}finally{_iterator330.f()}return new NodeSet(newTypes)}}]);return NodeSet}();var CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;(function(IterMode){IterMode[IterMode["ExcludeBuffers"]=1]="ExcludeBuffers";IterMode[IterMode["IncludeAnonymous"]=2]="IncludeAnonymous";IterMode[IterMode["IgnoreMounts"]=4]="IgnoreMounts";IterMode[IterMode["IgnoreOverlays"]=8]="IgnoreOverlays"})(IterMode||(IterMode={}));var Tree=function(){function Tree(type,children,positions,length,props){_classCallCheck2(this,Tree);this.type=type;this.children=children;this.positions=positions;this.length=length;this.props=null;if(props&&props.length){this.props=Object.create(null);var _iterator332=_createForOfIteratorHelper(props),_step332;try{for(_iterator332.s();!(_step332=_iterator332.n()).done;){var _step332$value=_slicedToArray2(_step332.value,2),prop=_step332$value[0],value=_step332$value[1];this.props[typeof prop=="number"?prop:prop.id]=value}}catch(err){_iterator332.e(err)}finally{_iterator332.f()}}}_createClass2(Tree,[{key:"toString",value:function toString(){var mounted=MountedTree.get(this);if(mounted&&!mounted.overlay)return mounted.tree.toString();var children="";var _iterator333=_createForOfIteratorHelper(this.children),_step333;try{for(_iterator333.s();!(_step333=_iterator333.n()).done;){var ch=_step333.value;var str=ch.toString();if(str){if(children)children+=",";children+=str}}}catch(err){_iterator333.e(err)}finally{_iterator333.f()}return!this.type.name?children:(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(children.length?"("+children+")":"")}},{key:"cursor",value:function cursor(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return new TreeCursor(this.topNode,mode)}},{key:"cursorAt",value:function cursorAt(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var mode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var scope=CachedNode.get(this)||this.topNode;var cursor=new TreeCursor(scope);cursor.moveTo(pos,side);CachedNode.set(this,cursor._tree);return cursor}},{key:"topNode",get:function get(){return new TreeNode(this,0,0,null)}},{key:"resolve",value:function resolve(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var node=resolveNode(CachedNode.get(this)||this.topNode,pos,side,false);CachedNode.set(this,node);return node}},{key:"resolveInner",value:function resolveInner(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var node=resolveNode(CachedInnerNode.get(this)||this.topNode,pos,side,true);CachedInnerNode.set(this,node);return node}},{key:"resolveStack",value:function resolveStack(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return stackIterator(this,pos,side)}},{key:"iterate",value:function iterate(spec){var enter=spec.enter,leave=spec.leave,_spec$from=spec.from,from=_spec$from===void 0?0:_spec$from,_spec$to2=spec.to,to=_spec$to2===void 0?this.length:_spec$to2;var mode=spec.mode||0,anon=(mode&IterMode.IncludeAnonymous)>0;for(var c=this.cursor(mode|IterMode.IncludeAnonymous);;){var entered=false;if(c.from<=to&&c.to>=from&&(!anon&&c.type.isAnonymous||enter(c)!==false)){if(c.firstChild())continue;entered=true}for(;;){if(entered&&leave&&(anon||!c.type.isAnonymous))leave(c);if(c.nextSibling())break;if(!c.parent())return;entered=true}}}},{key:"prop",value:function prop(_prop2){return!_prop2.perNode?this.type.prop(_prop2):this.props?this.props[_prop2.id]:undefined}},{key:"propValues",get:function get(){var result=[];if(this.props)for(var _id22 in this.props)result.push([+_id22,this.props[_id22]]);return result}},{key:"balance",value:function balance(){var _this240=this;var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,function(children,positions,length){return new Tree(_this240.type,children,positions,length,_this240.propValues)},config.makeTree||function(children,positions,length){return new Tree(NodeType.none,children,positions,length)})}}],[{key:"build",value:function build(data){return buildTree(data)}}]);return Tree}();Tree.empty=new Tree(NodeType.none,[],[],0);var FlatBufferCursor=function(){function FlatBufferCursor(buffer,index){_classCallCheck2(this,FlatBufferCursor);this.buffer=buffer;this.index=index}_createClass2(FlatBufferCursor,[{key:"id",get:function get(){return this.buffer[this.index-4]}},{key:"start",get:function get(){return this.buffer[this.index-3]}},{key:"end",get:function get(){return this.buffer[this.index-2]}},{key:"size",get:function get(){return this.buffer[this.index-1]}},{key:"pos",get:function get(){return this.index}},{key:"next",value:function next(){this.index-=4}},{key:"fork",value:function fork(){return new FlatBufferCursor(this.buffer,this.index)}}]);return FlatBufferCursor}();var TreeBuffer=function(){function TreeBuffer(buffer,length,set){_classCallCheck2(this,TreeBuffer);this.buffer=buffer;this.length=length;this.set=set}_createClass2(TreeBuffer,[{key:"type",get:function get(){return NodeType.none}},{key:"toString",value:function toString(){var result=[];for(var index=0;index<this.buffer.length;){result.push(this.childString(index));index=this.buffer[index+3]}return result.join(",")}},{key:"childString",value:function childString(index){var id=this.buffer[index],endIndex=this.buffer[index+3];var type=this.set.types[id],result=type.name;if(/\W/.test(result)&&!type.isError)result=JSON.stringify(result);index+=4;if(endIndex==index)return result;var children=[];while(index<endIndex){children.push(this.childString(index));index=this.buffer[index+3]}return result+"("+children.join(",")+")"}},{key:"findChild",value:function findChild(startIndex,endIndex,dir,pos,side){var buffer=this.buffer,pick=-1;for(var _i217=startIndex;_i217!=endIndex;_i217=buffer[_i217+3]){if(checkSide(side,pos,buffer[_i217+1],buffer[_i217+2])){pick=_i217;if(dir>0)break}}return pick}},{key:"slice",value:function slice(startI,endI,from){var b=this.buffer;var copy=new Uint16Array(endI-startI),len=0;for(var _i218=startI,j=0;_i218<endI;){copy[j++]=b[_i218++];copy[j++]=b[_i218++]-from;var to=copy[j++]=b[_i218++]-from;copy[j++]=b[_i218++]-startI;len=Math.max(len,to)}return new TreeBuffer(copy,len,this.set)}}]);return TreeBuffer}();function checkSide(side,pos,from,to){switch(side){case-2:return from<pos;case-1:return to>=pos&&from<pos;case 0:return from<pos&&to>pos;case 1:return from<=pos&&to>pos;case 2:return to>pos;case 4:return true}}function resolveNode(node,pos,side,overlays){var _a;while(node.from==node.to||(side<1?node.from>=pos:node.from>pos)||(side>-1?node.to<=pos:node.to<pos)){var parent=!overlays&&node instanceof TreeNode&&node.index<0?null:node.parent;if(!parent)return node;node=parent}var mode=overlays?0:IterMode.IgnoreOverlays;if(overlays)for(var scan=node,_parent3=scan.parent;_parent3;scan=_parent3,_parent3=scan.parent){if(scan instanceof TreeNode&&scan.index<0&&((_a=_parent3.enter(pos,side,mode))===null||_a===void 0?void 0:_a.from)!=scan.from)node=_parent3}for(;;){var inner=node.enter(pos,side,mode);if(!inner)return node;node=inner}}var BaseNode=function(){function BaseNode(){_classCallCheck2(this,BaseNode)}_createClass2(BaseNode,[{key:"cursor",value:function cursor(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return new TreeCursor(this,mode)}},{key:"getChild",value:function getChild(type){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var after=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var r=_getChildren(this,type,before,after);return r.length?r[0]:null}},{key:"getChildren",value:function getChildren(type){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var after=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return _getChildren(this,type,before,after)}},{key:"resolve",value:function resolve(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return resolveNode(this,pos,side,false)}},{key:"resolveInner",value:function resolveInner(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return resolveNode(this,pos,side,true)}},{key:"matchContext",value:function matchContext(context){return matchNodeContext(this,context)}},{key:"enterUnfinishedNodesBefore",value:function enterUnfinishedNodesBefore(pos){var scan=this.childBefore(pos),node=this;while(scan){var last=scan.lastChild;if(!last||last.to!=scan.to)break;if(last.type.isError&&last.from==last.to){node=scan;scan=last.prevSibling}else{scan=last}}return node}},{key:"node",get:function get(){return this}},{key:"next",get:function get(){return this.parent}}]);return BaseNode}();var TreeNode=function(_BaseNode){_inherits2(TreeNode,_BaseNode);var _super96=_createSuper(TreeNode);function TreeNode(_tree,from,index,_parent){var _this241;_classCallCheck2(this,TreeNode);_this241=_super96.call(this);_this241._tree=_tree;_this241.from=from;_this241.index=index;_this241._parent=_parent;return _this241}_createClass2(TreeNode,[{key:"type",get:function get(){return this._tree.type}},{key:"name",get:function get(){return this._tree.type.name}},{key:"to",get:function get(){return this.from+this._tree.length}},{key:"nextChild",value:function nextChild(i,dir,pos,side){var mode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;for(var parent=this;;){for(var _parent$_tree=parent._tree,children=_parent$_tree.children,positions=_parent$_tree.positions,e=dir>0?children.length:-1;i!=e;i+=dir){var next=children[i],_start14=positions[i]+parent.from;if(!checkSide(side,pos,_start14,_start14+next.length))continue;if(next instanceof TreeBuffer){if(mode&IterMode.ExcludeBuffers)continue;var index=next.findChild(0,next.buffer.length,dir,pos-_start14,side);if(index>-1)return new BufferNode(new BufferContext(parent,next,i,_start14),null,index)}else if(mode&IterMode.IncludeAnonymous||!next.type.isAnonymous||hasChild(next)){var mounted=void 0;if(!(mode&IterMode.IgnoreMounts)&&(mounted=MountedTree.get(next))&&!mounted.overlay)return new TreeNode(mounted.tree,_start14,i,parent);var inner=new TreeNode(next,_start14,i,parent);return mode&IterMode.IncludeAnonymous||!inner.type.isAnonymous?inner:inner.nextChild(dir<0?next.children.length-1:0,dir,pos,side)}}if(mode&IterMode.IncludeAnonymous||!parent.type.isAnonymous)return null;if(parent.index>=0)i=parent.index+dir;else i=dir<0?-1:parent._parent._tree.children.length;parent=parent._parent;if(!parent)return null}}},{key:"firstChild",get:function get(){return this.nextChild(0,1,0,4)}},{key:"lastChild",get:function get(){return this.nextChild(this._tree.children.length-1,-1,0,4)}},{key:"childAfter",value:function childAfter(pos){return this.nextChild(0,1,pos,2)}},{key:"childBefore",value:function childBefore(pos){return this.nextChild(this._tree.children.length-1,-1,pos,-2)}},{key:"enter",value:function enter(pos,side){var mode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var mounted;if(!(mode&IterMode.IgnoreOverlays)&&(mounted=MountedTree.get(this._tree))&&mounted.overlay){var rPos=pos-this.from;var _iterator334=_createForOfIteratorHelper(mounted.overlay),_step334;try{for(_iterator334.s();!(_step334=_iterator334.n()).done;){var _step334$value=_step334.value,from=_step334$value.from,to=_step334$value.to;if((side>0?from<=rPos:from<rPos)&&(side<0?to>=rPos:to>rPos))return new TreeNode(mounted.tree,mounted.overlay[0].from+this.from,-1,this)}}catch(err){_iterator334.e(err)}finally{_iterator334.f()}}return this.nextChild(0,1,pos,side,mode)}},{key:"nextSignificantParent",value:function nextSignificantParent(){var val=this;while(val.type.isAnonymous&&val._parent)val=val._parent;return val}},{key:"parent",get:function get(){return this._parent?this._parent.nextSignificantParent():null}},{key:"nextSibling",get:function get(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}},{key:"prevSibling",get:function get(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}},{key:"tree",get:function get(){return this._tree}},{key:"toTree",value:function toTree(){return this._tree}},{key:"toString",value:function toString(){return this._tree.toString()}}]);return TreeNode}(BaseNode);function _getChildren(node,type,before,after){var cur=node.cursor(),result=[];if(!cur.firstChild())return result;if(before!=null)while(!cur.type.is(before))if(!cur.nextSibling())return result;for(;;){if(after!=null&&cur.type.is(after))return result;if(cur.type.is(type))result.push(cur.node);if(!cur.nextSibling())return after==null?result:[]}}function matchNodeContext(node,context){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:context.length-1;for(var _p6=node.parent;i>=0;_p6=_p6.parent){if(!_p6)return false;if(!_p6.type.isAnonymous){if(context[i]&&context[i]!=_p6.name)return false;i--}}return true}var BufferContext=_createClass2(function BufferContext(parent,buffer,index,start){_classCallCheck2(this,BufferContext);this.parent=parent;this.buffer=buffer;this.index=index;this.start=start});var BufferNode=function(_BaseNode2){_inherits2(BufferNode,_BaseNode2);var _super97=_createSuper(BufferNode);function BufferNode(context,_parent,index){var _this242;_classCallCheck2(this,BufferNode);_this242=_super97.call(this);_this242.context=context;_this242._parent=_parent;_this242.index=index;_this242.type=context.buffer.set.types[context.buffer.buffer[index]];return _this242}_createClass2(BufferNode,[{key:"name",get:function get(){return this.type.name}},{key:"from",get:function get(){return this.context.start+this.context.buffer.buffer[this.index+1]}},{key:"to",get:function get(){return this.context.start+this.context.buffer.buffer[this.index+2]}},{key:"child",value:function child(dir,pos,side){var buffer=this.context.buffer;var index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],dir,pos-this.context.start,side);return index<0?null:new BufferNode(this.context,this,index)}},{key:"firstChild",get:function get(){return this.child(1,0,4)}},{key:"lastChild",get:function get(){return this.child(-1,0,4)}},{key:"childAfter",value:function childAfter(pos){return this.child(1,pos,2)}},{key:"childBefore",value:function childBefore(pos){return this.child(-1,pos,-2)}},{key:"enter",value:function enter(pos,side){var mode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(mode&IterMode.ExcludeBuffers)return null;var buffer=this.context.buffer;var index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],side>0?1:-1,pos-this.context.start,side);return index<0?null:new BufferNode(this.context,this,index)}},{key:"parent",get:function get(){return this._parent||this.context.parent.nextSignificantParent()}},{key:"externalSibling",value:function externalSibling(dir){return this._parent?null:this.context.parent.nextChild(this.context.index+dir,dir,0,4)}},{key:"nextSibling",get:function get(){var buffer=this.context.buffer;var after=buffer.buffer[this.index+3];if(after<(this._parent?buffer.buffer[this._parent.index+3]:buffer.buffer.length))return new BufferNode(this.context,this._parent,after);return this.externalSibling(1)}},{key:"prevSibling",get:function get(){var buffer=this.context.buffer;var parentStart=this._parent?this._parent.index+4:0;if(this.index==parentStart)return this.externalSibling(-1);return new BufferNode(this.context,this._parent,buffer.findChild(parentStart,this.index,-1,0,4))}},{key:"tree",get:function get(){return null}},{key:"toTree",value:function toTree(){var children=[],positions=[];var buffer=this.context.buffer;var startI=this.index+4,endI=buffer.buffer[this.index+3];if(endI>startI){var from=buffer.buffer[this.index+1];children.push(buffer.slice(startI,endI,from));positions.push(0)}return new Tree(this.type,children,positions,this.to-this.from)}},{key:"toString",value:function toString(){return this.context.buffer.childString(this.index)}}]);return BufferNode}(BaseNode);function iterStack(heads){if(!heads.length)return null;var pick=0,picked=heads[0];for(var _i219=1;_i219<heads.length;_i219++){var node=heads[_i219];if(node.from>picked.from||node.to<picked.to){picked=node;pick=_i219}}var next=picked instanceof TreeNode&&picked.index<0?null:picked.parent;var newHeads=heads.slice();if(next)newHeads[pick]=next;else newHeads.splice(pick,1);return new StackIterator(newHeads,picked)}var StackIterator=function(){function StackIterator(heads,node){_classCallCheck2(this,StackIterator);this.heads=heads;this.node=node}_createClass2(StackIterator,[{key:"next",get:function get(){return iterStack(this.heads)}}]);return StackIterator}();function stackIterator(tree,pos,side){var inner=tree.resolveInner(pos,side),layers=null;for(var scan=inner instanceof TreeNode?inner:inner.context.parent;scan;scan=scan.parent){if(scan.index<0){var parent=scan.parent;(layers||(layers=[inner])).push(parent.resolve(pos,side));scan=parent}else{var mount=MountedTree.get(scan.tree);if(mount&&mount.overlay&&mount.overlay[0].from<=pos&&mount.overlay[mount.overlay.length-1].to>=pos){var _root=new TreeNode(mount.tree,mount.overlay[0].from+scan.from,-1,scan);(layers||(layers=[inner])).push(resolveNode(_root,pos,side,false))}}}return layers?iterStack(layers):inner}var TreeCursor=function(){function TreeCursor(node){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck2(this,TreeCursor);this.mode=mode;this.buffer=null;this.stack=[];this.index=0;this.bufferNode=null;if(node instanceof TreeNode){this.yieldNode(node)}else{this._tree=node.context.parent;this.buffer=node.context;for(var n=node._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=node;this.yieldBuf(node.index)}}_createClass2(TreeCursor,[{key:"name",get:function get(){return this.type.name}},{key:"yieldNode",value:function yieldNode(node){if(!node)return false;this._tree=node;this.type=node.type;this.from=node.from;this.to=node.to;return true}},{key:"yieldBuf",value:function yieldBuf(index,type){this.index=index;var _this$buffer=this.buffer,start=_this$buffer.start,buffer=_this$buffer.buffer;this.type=type||buffer.set.types[buffer.buffer[index]];this.from=start+buffer.buffer[index+1];this.to=start+buffer.buffer[index+2];return true}},{key:"yield",value:function _yield(node){if(!node)return false;if(node instanceof TreeNode){this.buffer=null;return this.yieldNode(node)}this.buffer=node.context;return this.yieldBuf(node.index,node.type)}},{key:"toString",value:function toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}},{key:"enterChild",value:function enterChild(dir,pos,side){if(!this.buffer)return this["yield"](this._tree.nextChild(dir<0?this._tree._tree.children.length-1:0,dir,pos,side,this.mode));var buffer=this.buffer.buffer;var index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],dir,pos-this.buffer.start,side);if(index<0)return false;this.stack.push(this.index);return this.yieldBuf(index)}},{key:"firstChild",value:function firstChild(){return this.enterChild(1,0,4)}},{key:"lastChild",value:function lastChild(){return this.enterChild(-1,0,4)}},{key:"childAfter",value:function childAfter(pos){return this.enterChild(1,pos,2)}},{key:"childBefore",value:function childBefore(pos){return this.enterChild(-1,pos,-2)}},{key:"enter",value:function enter(pos,side){var mode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.mode;if(!this.buffer)return this["yield"](this._tree.enter(pos,side,mode));return mode&IterMode.ExcludeBuffers?false:this.enterChild(1,pos,side)}},{key:"parent",value:function parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());var parent=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();this.buffer=null;return this.yieldNode(parent)}},{key:"sibling",value:function sibling(dir){if(!this.buffer)return!this._tree._parent?false:this["yield"](this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+dir,dir,0,4,this.mode));var buffer=this.buffer.buffer,d=this.stack.length-1;if(dir<0){var parentStart=d<0?0:this.stack[d]+4;if(this.index!=parentStart)return this.yieldBuf(buffer.findChild(parentStart,this.index,-1,0,4))}else{var _after6=buffer.buffer[this.index+3];if(_after6<(d<0?buffer.buffer.length:buffer.buffer[this.stack[d]+3]))return this.yieldBuf(_after6)}return d<0?this["yield"](this.buffer.parent.nextChild(this.buffer.index+dir,dir,0,4,this.mode)):false}},{key:"nextSibling",value:function nextSibling(){return this.sibling(1)}},{key:"prevSibling",value:function prevSibling(){return this.sibling(-1)}},{key:"atLastNode",value:function atLastNode(dir){var index,parent,buffer=this.buffer;if(buffer){if(dir>0){if(this.index<buffer.buffer.buffer.length)return false}else{for(var _i220=0;_i220<this.index;_i220++)if(buffer.buffer.buffer[_i220+3]<this.index)return false}index=buffer.index;parent=buffer.parent}else{var _this$_tree=this._tree;index=_this$_tree.index;parent=_this$_tree._parent}for(;parent;_parent4=parent,index=_parent4.index,parent=_parent4._parent,_parent4){var _parent4;if(index>-1)for(var _i221=index+dir,e=dir<0?-1:parent._tree.children.length;_i221!=e;_i221+=dir){var child=parent._tree.children[_i221];if(this.mode&IterMode.IncludeAnonymous||child instanceof TreeBuffer||!child.type.isAnonymous||hasChild(child))return false}}return true}},{key:"move",value:function move(dir,enter){if(enter&&this.enterChild(dir,0,4))return true;for(;;){if(this.sibling(dir))return true;if(this.atLastNode(dir)||!this.parent())return false}}},{key:"next",value:function next(){var enter=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;return this.move(1,enter)}},{key:"prev",value:function prev(){var enter=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;return this.move(-1,enter)}},{key:"moveTo",value:function moveTo(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;while(this.from==this.to||(side<1?this.from>=pos:this.from>pos)||(side>-1?this.to<=pos:this.to<pos))if(!this.parent())break;while(this.enterChild(1,pos,side)){}return this}},{key:"node",get:function get(){if(!this.buffer)return this._tree;var cache=this.bufferNode,result=null,depth=0;if(cache&&cache.context==this.buffer){scan:for(var index=this.index,d=this.stack.length;d>=0;){for(var c=cache;c;c=c._parent)if(c.index==index){if(index==this.index)return c;result=c;depth=d+1;break scan}index=this.stack[--d]}}for(var _i222=depth;_i222<this.stack.length;_i222++)result=new BufferNode(this.buffer,result,this.stack[_i222]);return this.bufferNode=new BufferNode(this.buffer,result,this.index)}},{key:"tree",get:function get(){return this.buffer?null:this._tree._tree}},{key:"iterate",value:function iterate(enter,leave){for(var depth=0;;){var mustLeave=false;if(this.type.isAnonymous||enter(this)!==false){if(this.firstChild()){depth++;continue}if(!this.type.isAnonymous)mustLeave=true}for(;;){if(mustLeave&&leave)leave(this);mustLeave=this.type.isAnonymous;if(this.nextSibling())break;if(!depth)return;this.parent();depth--;mustLeave=true}}}},{key:"matchContext",value:function matchContext(context){if(!this.buffer)return matchNodeContext(this.node,context);var buffer=this.buffer.buffer,types=buffer.set.types;for(var _i223=context.length-1,d=this.stack.length-1;_i223>=0;d--){if(d<0)return matchNodeContext(this.node,context,_i223);var type=types[buffer.buffer[this.stack[d]]];if(!type.isAnonymous){if(context[_i223]&&context[_i223]!=type.name)return false;_i223--}}return true}}]);return TreeCursor}();function hasChild(tree){return tree.children.some(function(ch){return ch instanceof TreeBuffer||!ch.type.isAnonymous||hasChild(ch)})}function buildTree(data){var _a;var buffer=data.buffer,nodeSet=data.nodeSet,_data$maxBufferLength=data.maxBufferLength,maxBufferLength=_data$maxBufferLength===void 0?DefaultBufferLength:_data$maxBufferLength,_data$reused=data.reused,reused=_data$reused===void 0?[]:_data$reused,_data$minRepeatType=data.minRepeatType,minRepeatType=_data$minRepeatType===void 0?nodeSet.types.length:_data$minRepeatType;var cursor=Array.isArray(buffer)?new FlatBufferCursor(buffer,buffer.length):buffer;var types=nodeSet.types;var contextHash=0,lookAhead=0;function takeNode(parentStart,minPos,children,positions,inRepeat,depth){var id=cursor.id,start=cursor.start,end=cursor.end,size=cursor.size;var lookAheadAtStart=lookAhead;while(size<0){cursor.next();if(size==-1){var _node3=reused[id];children.push(_node3);positions.push(start-parentStart);return}else if(size==-3){contextHash=id;return}else if(size==-4){lookAhead=id;return}else{throw new RangeError("Unrecognized record size: ".concat(size))}}var type=types[id],node,buffer;var startPos=start-parentStart;if(end-start<=maxBufferLength&&(buffer=findBufferSize(cursor.pos-minPos,inRepeat))){var _data10=new Uint16Array(buffer.size-buffer.skip);var endPos=cursor.pos-buffer.size,index=_data10.length;while(cursor.pos>endPos)index=copyToBuffer(buffer.start,_data10,index);node=new TreeBuffer(_data10,end-buffer.start,nodeSet);startPos=buffer.start-parentStart}else{var _endPos=cursor.pos-size;cursor.next();var localChildren=[],localPositions=[];var localInRepeat=id>=minRepeatType?id:-1;var lastGroup=0,lastEnd=end;while(cursor.pos>_endPos){if(localInRepeat>=0&&cursor.id==localInRepeat&&cursor.size>=0){if(cursor.end<=lastEnd-maxBufferLength){makeRepeatLeaf(localChildren,localPositions,start,lastGroup,cursor.end,lastEnd,localInRepeat,lookAheadAtStart);lastGroup=localChildren.length;lastEnd=cursor.end}cursor.next()}else if(depth>2500){takeFlatNode(start,_endPos,localChildren,localPositions)}else{takeNode(start,_endPos,localChildren,localPositions,localInRepeat,depth+1)}}if(localInRepeat>=0&&lastGroup>0&&lastGroup<localChildren.length)makeRepeatLeaf(localChildren,localPositions,start,lastGroup,start,lastEnd,localInRepeat,lookAheadAtStart);localChildren.reverse();localPositions.reverse();if(localInRepeat>-1&&lastGroup>0){var make=makeBalanced(type);node=balanceRange(type,localChildren,localPositions,0,localChildren.length,0,end-start,make,make)}else{node=makeTree(type,localChildren,localPositions,end-start,lookAheadAtStart-end)}}children.push(node);positions.push(startPos)}function takeFlatNode(parentStart,minPos,children,positions){var nodes=[];var nodeCount=0,stopAt=-1;while(cursor.pos>minPos){var _id23=cursor.id,_start15=cursor.start,_end33=cursor.end,size=cursor.size;if(size>4){cursor.next()}else if(stopAt>-1&&_start15<stopAt){break}else{if(stopAt<0)stopAt=_end33-maxBufferLength;nodes.push(_id23,_start15,_end33);nodeCount++;cursor.next()}}if(nodeCount){var _buffer2=new Uint16Array(nodeCount*4);var _start16=nodes[nodes.length-2];for(var _i224=nodes.length-3,j=0;_i224>=0;_i224-=3){_buffer2[j++]=nodes[_i224];_buffer2[j++]=nodes[_i224+1]-_start16;_buffer2[j++]=nodes[_i224+2]-_start16;_buffer2[j++]=j}children.push(new TreeBuffer(_buffer2,nodes[2]-_start16,nodeSet));positions.push(_start16-parentStart)}}function makeBalanced(type){return function(children,positions,length){var lookAhead=0,lastI=children.length-1,last,lookAheadProp;if(lastI>=0&&(last=children[lastI])instanceof Tree){if(!lastI&&last.type==type&&last.length==length)return last;if(lookAheadProp=last.prop(NodeProp.lookAhead))lookAhead=positions[lastI]+last.length+lookAheadProp}return makeTree(type,children,positions,length,lookAhead)}}function makeRepeatLeaf(children,positions,base,i,from,to,type,lookAhead){var localChildren=[],localPositions=[];while(children.length>i){localChildren.push(children.pop());localPositions.push(positions.pop()+base-from)}children.push(makeTree(nodeSet.types[type],localChildren,localPositions,to-from,lookAhead-to));positions.push(from-base)}function makeTree(type,children,positions,length){var lookAhead=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var props=arguments.length>5?arguments[5]:undefined;if(contextHash){var _pair=[NodeProp.contextHash,contextHash];props=props?[_pair].concat(props):[_pair]}if(lookAhead>25){var _pair2=[NodeProp.lookAhead,lookAhead];props=props?[_pair2].concat(props):[_pair2]}return new Tree(type,children,positions,length,props)}function findBufferSize(maxSize,inRepeat){var fork=cursor.fork();var size=0,start=0,skip=0,minStart=fork.end-maxBufferLength;var result={size:0,start:0,skip:0};scan:for(var minPos=fork.pos-maxSize;fork.pos>minPos;){var _nodeSize=fork.size;if(fork.id==inRepeat&&_nodeSize>=0){result.size=size;result.start=start;result.skip=skip;skip+=4;size+=4;fork.next();continue}var startPos=fork.pos-_nodeSize;if(_nodeSize<0||startPos<minPos||fork.start<minStart)break;var localSkipped=fork.id>=minRepeatType?4:0;var _nodeStart=fork.start;fork.next();while(fork.pos>startPos){if(fork.size<0){if(fork.size==-3)localSkipped+=4;else break scan}else if(fork.id>=minRepeatType){localSkipped+=4}fork.next()}start=_nodeStart;size+=_nodeSize;skip+=localSkipped}if(inRepeat<0||size==maxSize){result.size=size;result.start=start;result.skip=skip}return result.size>4?result:undefined}function copyToBuffer(bufferStart,buffer,index){var id=cursor.id,start=cursor.start,end=cursor.end,size=cursor.size;cursor.next();if(size>=0&&id<minRepeatType){var startIndex=index;if(size>4){var endPos=cursor.pos-(size-4);while(cursor.pos>endPos)index=copyToBuffer(bufferStart,buffer,index)}buffer[--index]=startIndex;buffer[--index]=end-bufferStart;buffer[--index]=start-bufferStart;buffer[--index]=id}else if(size==-3){contextHash=id}else if(size==-4){lookAhead=id}return index}var children=[],positions=[];while(cursor.pos>0)takeNode(data.start||0,data.bufferStart||0,children,positions,-1,0);var length=(_a=data.length)!==null&&_a!==void 0?_a:children.length?positions[0]+children[0].length:0;return new Tree(types[data.topID],children.reverse(),positions.reverse(),length)}var nodeSizeCache=new WeakMap;function nodeSize(balanceType,node){if(!balanceType.isAnonymous||node instanceof TreeBuffer||node.type!=balanceType)return 1;var size=nodeSizeCache.get(node);if(size==null){size=1;var _iterator335=_createForOfIteratorHelper(node.children),_step335;try{for(_iterator335.s();!(_step335=_iterator335.n()).done;){var child=_step335.value;if(child.type!=balanceType||!(child instanceof Tree)){size=1;break}size+=nodeSize(balanceType,child)}}catch(err){_iterator335.e(err)}finally{_iterator335.f()}nodeSizeCache.set(node,size)}return size}function balanceRange(balanceType,children,positions,from,to,start,length,mkTop,mkTree){var total=0;for(var _i225=from;_i225<to;_i225++)total+=nodeSize(balanceType,children[_i225]);var maxChild=Math.ceil(total*1.5/8);var localChildren=[],localPositions=[];function divide(children,positions,from,to,offset){for(var _i226=from;_i226<to;){var groupFrom=_i226,groupStart=positions[_i226],groupSize=nodeSize(balanceType,children[_i226]);_i226++;for(;_i226<to;_i226++){var nextSize=nodeSize(balanceType,children[_i226]);if(groupSize+nextSize>=maxChild)break;groupSize+=nextSize}if(_i226==groupFrom+1){if(groupSize>maxChild){var only=children[groupFrom];divide(only.children,only.positions,0,only.children.length,positions[groupFrom]+offset);continue}localChildren.push(children[groupFrom])}else{var _length=positions[_i226-1]+children[_i226-1].length-groupStart;localChildren.push(balanceRange(balanceType,children,positions,groupFrom,_i226,groupStart,_length,null,mkTree))}localPositions.push(groupStart+offset-start)}}divide(children,positions,from,to,0);return(mkTop||mkTree)(localChildren,localPositions,length)}var NodeWeakMap=function(){function NodeWeakMap(){_classCallCheck2(this,NodeWeakMap);this.map=new WeakMap}_createClass2(NodeWeakMap,[{key:"setBuffer",value:function setBuffer(buffer,index,value){var inner=this.map.get(buffer);if(!inner)this.map.set(buffer,inner=new Map);inner.set(index,value)}},{key:"getBuffer",value:function getBuffer(buffer,index){var inner=this.map.get(buffer);return inner&&inner.get(index)}},{key:"set",value:function set(node,value){if(node instanceof BufferNode)this.setBuffer(node.context.buffer,node.index,value);else if(node instanceof TreeNode)this.map.set(node.tree,value)}},{key:"get",value:function get(node){return node instanceof BufferNode?this.getBuffer(node.context.buffer,node.index):node instanceof TreeNode?this.map.get(node.tree):undefined}},{key:"cursorSet",value:function cursorSet(cursor,value){if(cursor.buffer)this.setBuffer(cursor.buffer.buffer,cursor.index,value);else this.map.set(cursor.tree,value)}},{key:"cursorGet",value:function cursorGet(cursor){return cursor.buffer?this.getBuffer(cursor.buffer.buffer,cursor.index):this.map.get(cursor.tree)}}]);return NodeWeakMap}();var TreeFragment=function(){function TreeFragment(from,to,tree,offset){var openStart=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var openEnd=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;_classCallCheck2(this,TreeFragment);this.from=from;this.to=to;this.tree=tree;this.offset=offset;this.open=(openStart?1:0)|(openEnd?2:0)}_createClass2(TreeFragment,[{key:"openStart",get:function get(){return(this.open&1)>0}},{key:"openEnd",get:function get(){return(this.open&2)>0}}],[{key:"addTree",value:function addTree(tree){var fragments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var partial=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var result=[new TreeFragment(0,tree.length,tree,0,false,partial)];var _iterator336=_createForOfIteratorHelper(fragments),_step336;try{for(_iterator336.s();!(_step336=_iterator336.n()).done;){var f=_step336.value;if(f.to>tree.length)result.push(f)}}catch(err){_iterator336.e(err)}finally{_iterator336.f()}return result}},{key:"applyChanges",value:function applyChanges(fragments,changes){var minGap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:128;if(!changes.length)return fragments;var result=[];var fI=1,nextF=fragments.length?fragments[0]:null;for(var cI=0,pos=0,off=0;;cI++){var nextC=cI<changes.length?changes[cI]:null;var nextPos=nextC?nextC.fromA:1e9;if(nextPos-pos>=minGap)while(nextF&&nextF.from<nextPos){var cut=nextF;if(pos>=cut.from||nextPos<=cut.to||off){var fFrom=Math.max(cut.from,pos)-off,fTo=Math.min(cut.to,nextPos)-off;cut=fFrom>=fTo?null:new TreeFragment(fFrom,fTo,cut.tree,cut.offset+off,cI>0,!!nextC)}if(cut)result.push(cut);if(nextF.to>nextPos)break;nextF=fI<fragments.length?fragments[fI++]:null}if(!nextC)break;pos=nextC.toA;off=nextC.toA-nextC.toB}return result}}]);return TreeFragment}();var Parser=function(){function Parser(){_classCallCheck2(this,Parser)}_createClass2(Parser,[{key:"startParse",value:function startParse(input,fragments,ranges){if(typeof input=="string")input=new StringInput(input);ranges=!ranges?[new Range(0,input.length)]:ranges.length?ranges.map(function(r){return new Range(r.from,r.to)}):[new Range(0,0)];return this.createParse(input,fragments||[],ranges)}},{key:"parse",value:function parse(input,fragments,ranges){var parse=this.startParse(input,fragments,ranges);for(;;){var done=parse.advance();if(done)return done}}}]);return Parser}();var StringInput=function(){function StringInput(string){_classCallCheck2(this,StringInput);this.string=string}_createClass2(StringInput,[{key:"length",get:function get(){return this.string.length}},{key:"chunk",value:function chunk(from){return this.string.slice(from)}},{key:"lineChunks",get:function get(){return false}},{key:"read",value:function read(from,to){return this.string.slice(from,to)}}]);return StringInput}();function parseMixed(nest){return function(parse,input,fragments,ranges){return new MixedParse(parse,nest,input,fragments,ranges)}}var InnerParse=_createClass2(function InnerParse(parser,parse,overlay,target,from){_classCallCheck2(this,InnerParse);this.parser=parser;this.parse=parse;this.overlay=overlay;this.target=target;this.from=from});function checkRanges(ranges){if(!ranges.length||ranges.some(function(r){return r.from>=r.to}))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(ranges))}var ActiveOverlay=_createClass2(function ActiveOverlay(parser,predicate,mounts,index,start,target,prev){_classCallCheck2(this,ActiveOverlay);this.parser=parser;this.predicate=predicate;this.mounts=mounts;this.index=index;this.start=start;this.target=target;this.prev=prev;this.depth=0;this.ranges=[]});var stoppedInner=new NodeProp({perNode:true});var MixedParse=function(){function MixedParse(base,nest,input,fragments,ranges){_classCallCheck2(this,MixedParse);this.nest=nest;this.input=input;this.fragments=fragments;this.ranges=ranges;this.inner=[];this.innerDone=0;this.baseTree=null;this.stoppedAt=null;this.baseParse=base}_createClass2(MixedParse,[{key:"advance",value:function advance(){if(this.baseParse){var _done=this.baseParse.advance();if(!_done)return null;this.baseParse=null;this.baseTree=_done;this.startInner();if(this.stoppedAt!=null){var _iterator337=_createForOfIteratorHelper(this.inner),_step337;try{for(_iterator337.s();!(_step337=_iterator337.n()).done;){var _inner=_step337.value;_inner.parse.stopAt(this.stoppedAt)}}catch(err){_iterator337.e(err)}finally{_iterator337.f()}}}if(this.innerDone==this.inner.length){var result=this.baseTree;if(this.stoppedAt!=null)result=new Tree(result.type,result.children,result.positions,result.length,result.propValues.concat([[stoppedInner,this.stoppedAt]]));return result}var inner=this.inner[this.innerDone],done=inner.parse.advance();if(done){this.innerDone++;var props=Object.assign(Object.create(null),inner.target.props);props[NodeProp.mounted.id]=new MountedTree(done,inner.overlay,inner.parser);inner.target.props=props}return null}},{key:"parsedPos",get:function get(){if(this.baseParse)return 0;var pos=this.input.length;for(var _i227=this.innerDone;_i227<this.inner.length;_i227++){if(this.inner[_i227].from<pos)pos=Math.min(pos,this.inner[_i227].parse.parsedPos)}return pos}},{key:"stopAt",value:function stopAt(pos){this.stoppedAt=pos;if(this.baseParse)this.baseParse.stopAt(pos);else for(var _i228=this.innerDone;_i228<this.inner.length;_i228++)this.inner[_i228].parse.stopAt(pos)}},{key:"startInner",value:function startInner(){var fragmentCursor=new FragmentCursor$2(this.fragments);var overlay=null;var covered=null;var cursor=new TreeCursor(new TreeNode(this.baseTree,this.ranges[0].from,0,null),IterMode.IncludeAnonymous|IterMode.IgnoreMounts);scan:for(var nest,isCovered;;){var enter=true,range=void 0;if(this.stoppedAt!=null&&cursor.from>=this.stoppedAt){enter=false}else if(fragmentCursor.hasNode(cursor)){if(overlay){var match=overlay.mounts.find(function(m){return m.frag.from<=cursor.from&&m.frag.to>=cursor.to&&m.mount.overlay});if(match){var _iterator338=_createForOfIteratorHelper(match.mount.overlay),_step338;try{var _loop20=function _loop20(){var r=_step338.value;var from=r.from+match.pos,to=r.to+match.pos;if(from>=cursor.from&&to<=cursor.to&&!overlay.ranges.some(function(r){return r.from<to&&r.to>from}))overlay.ranges.push({from:from,to:to})};for(_iterator338.s();!(_step338=_iterator338.n()).done;){_loop20()}}catch(err){_iterator338.e(err)}finally{_iterator338.f()}}}enter=false}else if(covered&&(isCovered=checkCover(covered.ranges,cursor.from,cursor.to))){enter=isCovered!=2}else if(!cursor.type.isAnonymous&&(nest=this.nest(cursor,this.input))&&(cursor.from<cursor.to||!nest.overlay)){if(!cursor.tree)materialize(cursor);var oldMounts=fragmentCursor.findMounts(cursor.from,nest.parser);if(typeof nest.overlay=="function"){overlay=new ActiveOverlay(nest.parser,nest.overlay,oldMounts,this.inner.length,cursor.from,cursor.tree,overlay)}else{var ranges=punchRanges(this.ranges,nest.overlay||(cursor.from<cursor.to?[new Range(cursor.from,cursor.to)]:[]));if(ranges.length)checkRanges(ranges);if(ranges.length||!nest.overlay)this.inner.push(new InnerParse(nest.parser,ranges.length?nest.parser.startParse(this.input,enterFragments(oldMounts,ranges),ranges):nest.parser.startParse(""),nest.overlay?nest.overlay.map(function(r){return new Range(r.from-cursor.from,r.to-cursor.from)}):null,cursor.tree,ranges.length?ranges[0].from:cursor.from));if(!nest.overlay)enter=false;else if(ranges.length)covered={ranges:ranges,depth:0,prev:covered}}}else if(overlay&&(range=overlay.predicate(cursor))){if(range===true)range=new Range(cursor.from,cursor.to);if(range.from<range.to)overlay.ranges.push(range)}if(enter&&cursor.firstChild()){if(overlay)overlay.depth++;if(covered)covered.depth++}else{for(;;){if(cursor.nextSibling())break;if(!cursor.parent())break scan;if(overlay&&! --overlay.depth){var _ranges=punchRanges(this.ranges,overlay.ranges);if(_ranges.length){checkRanges(_ranges);this.inner.splice(overlay.index,0,new InnerParse(overlay.parser,overlay.parser.startParse(this.input,enterFragments(overlay.mounts,_ranges),_ranges),overlay.ranges.map(function(r){return new Range(r.from-overlay.start,r.to-overlay.start)}),overlay.target,_ranges[0].from))}overlay=overlay.prev}if(covered&&! --covered.depth)covered=covered.prev}}}}}]);return MixedParse}();function checkCover(covered,from,to){var _iterator339=_createForOfIteratorHelper(covered),_step339;try{for(_iterator339.s();!(_step339=_iterator339.n()).done;){var range=_step339.value;if(range.from>=to)break;if(range.to>from)return range.from<=from&&range.to>=to?2:1}}catch(err){_iterator339.e(err)}finally{_iterator339.f()}return 0}function sliceBuf(buf,startI,endI,nodes,positions,off){if(startI<endI){var from=buf.buffer[startI+1];nodes.push(buf.slice(startI,endI,from));positions.push(from-off)}}function materialize(cursor){var node=cursor.node,stack=[];var buffer=node.context.buffer;do{stack.push(cursor.index);cursor.parent()}while(!cursor.tree);var base=cursor.tree,i=base.children.indexOf(buffer);var buf=base.children[i],b=buf.buffer,newStack=[i];function split(startI,endI,type,innerOffset,length,stackPos){var targetI=stack[stackPos];var children=[],positions=[];sliceBuf(buf,startI,targetI,children,positions,innerOffset);var from=b[targetI+1],to=b[targetI+2];newStack.push(children.length);var child=stackPos?split(targetI+4,b[targetI+3],buf.set.types[b[targetI]],from,to-from,stackPos-1):node.toTree();children.push(child);positions.push(from-innerOffset);sliceBuf(buf,b[targetI+3],endI,children,positions,innerOffset);return new Tree(type,children,positions,length)}base.children[i]=split(0,b.length,NodeType.none,0,buf.length,stack.length-1);for(var _i229=0,_newStack=newStack;_i229<_newStack.length;_i229++){var index=_newStack[_i229];var tree=cursor.tree.children[index],pos=cursor.tree.positions[index];cursor["yield"](new TreeNode(tree,pos+cursor.from,index,cursor._tree))}}var StructureCursor=function(){function StructureCursor(root,offset){_classCallCheck2(this,StructureCursor);this.offset=offset;this.done=false;this.cursor=root.cursor(IterMode.IncludeAnonymous|IterMode.IgnoreMounts)}_createClass2(StructureCursor,[{key:"moveTo",value:function moveTo(pos){var cursor=this.cursor,p=pos-this.offset;while(!this.done&&cursor.from<p){if(cursor.to>=pos&&cursor.enter(p,1,IterMode.IgnoreOverlays|IterMode.ExcludeBuffers));else if(!cursor.next(false))this.done=true}}},{key:"hasNode",value:function hasNode(cursor){this.moveTo(cursor.from);if(!this.done&&this.cursor.from+this.offset==cursor.from&&this.cursor.tree){for(var tree=this.cursor.tree;;){if(tree==cursor.tree)return true;if(tree.children.length&&tree.positions[0]==0&&tree.children[0]instanceof Tree)tree=tree.children[0];else break}}return false}}]);return StructureCursor}();var FragmentCursor$2=function(){function FragmentCursor(fragments){_classCallCheck2(this,FragmentCursor);var _a;this.fragments=fragments;this.curTo=0;this.fragI=0;if(fragments.length){var first=this.curFrag=fragments[0];this.curTo=(_a=first.tree.prop(stoppedInner))!==null&&_a!==void 0?_a:first.to;this.inner=new StructureCursor(first.tree,-first.offset)}else{this.curFrag=this.inner=null}}_createClass2(FragmentCursor,[{key:"hasNode",value:function hasNode(node){while(this.curFrag&&node.from>=this.curTo)this.nextFrag();return this.curFrag&&this.curFrag.from<=node.from&&this.curTo>=node.to&&this.inner.hasNode(node)}},{key:"nextFrag",value:function nextFrag(){var _a;this.fragI++;if(this.fragI==this.fragments.length){this.curFrag=this.inner=null}else{var frag=this.curFrag=this.fragments[this.fragI];this.curTo=(_a=frag.tree.prop(stoppedInner))!==null&&_a!==void 0?_a:frag.to;this.inner=new StructureCursor(frag.tree,-frag.offset)}}},{key:"findMounts",value:function findMounts(pos,parser){var _a;var result=[];if(this.inner){this.inner.cursor.moveTo(pos,1);for(var _pos2=this.inner.cursor.node;_pos2;_pos2=_pos2.parent){var mount=(_a=_pos2.tree)===null||_a===void 0?void 0:_a.prop(NodeProp.mounted);if(mount&&mount.parser==parser){for(var _i230=this.fragI;_i230<this.fragments.length;_i230++){var frag=this.fragments[_i230];if(frag.from>=_pos2.to)break;if(frag.tree==this.curFrag.tree)result.push({frag:frag,pos:_pos2.from-frag.offset,mount:mount})}}}}return result}}]);return FragmentCursor}();function punchRanges(outer,ranges){var copy=null,current=ranges;for(var _i231=1,j=0;_i231<outer.length;_i231++){var gapFrom=outer[_i231-1].to,gapTo=outer[_i231].from;for(;j<current.length;j++){var _r5=current[j];if(_r5.from>=gapTo)break;if(_r5.to<=gapFrom)continue;if(!copy)current=copy=ranges.slice();if(_r5.from<gapFrom){copy[j]=new Range(_r5.from,gapFrom);if(_r5.to>gapTo)copy.splice(j+1,0,new Range(gapTo,_r5.to))}else if(_r5.to>gapTo){copy[j--]=new Range(gapTo,_r5.to)}else{copy.splice(j--,1)}}}return current}function findCoverChanges(a,b,from,to){var iA=0,iB=0,inA=false,inB=false,pos=-1e9;var result=[];for(;;){var nextA=iA==a.length?1e9:inA?a[iA].to:a[iA].from;var nextB=iB==b.length?1e9:inB?b[iB].to:b[iB].from;if(inA!=inB){var _start17=Math.max(pos,from),_end34=Math.min(nextA,nextB,to);if(_start17<_end34)result.push(new Range(_start17,_end34))}pos=Math.min(nextA,nextB);if(pos==1e9)break;if(nextA==pos){if(!inA)inA=true;else{inA=false;iA++}}if(nextB==pos){if(!inB)inB=true;else{inB=false;iB++}}}return result}function enterFragments(mounts,ranges){var result=[];var _iterator340=_createForOfIteratorHelper(mounts),_step340;try{var _loop21=function _loop21(){var _step340$value=_step340.value,pos=_step340$value.pos,mount=_step340$value.mount,frag=_step340$value.frag;var startPos=pos+(mount.overlay?mount.overlay[0].from:0),endPos=startPos+mount.tree.length;var from=Math.max(frag.from,startPos),to=Math.min(frag.to,endPos);if(mount.overlay){var overlay=mount.overlay.map(function(r){return new Range(r.from+pos,r.to+pos)});var changes=findCoverChanges(ranges,overlay,from,to);for(var _i232=0,_pos3=from;;_i232++){var last=_i232==changes.length,_end35=last?to:changes[_i232].from;if(_end35>_pos3)result.push(new TreeFragment(_pos3,_end35,mount.tree,-startPos,frag.from>=_pos3||frag.openStart,frag.to<=_end35||frag.openEnd));if(last)break;_pos3=changes[_i232].to}}else{result.push(new TreeFragment(from,to,mount.tree,-startPos,frag.from>=startPos||frag.openStart,frag.to<=endPos||frag.openEnd))}};for(_iterator340.s();!(_step340=_iterator340.n()).done;){_loop21()}}catch(err){_iterator340.e(err)}finally{_iterator340.f()}return result}var nextTagID=0;var Tag=function(){function Tag(set,base,modified){_classCallCheck2(this,Tag);this.set=set;this.base=base;this.modified=modified;this.id=nextTagID++}_createClass2(Tag,null,[{key:"define",value:function define(parent){if(parent===null||parent===void 0?void 0:parent.base)throw new Error("Can not derive from a modified tag");var tag=new Tag([],null,[]);tag.set.push(tag);if(parent){var _iterator341=_createForOfIteratorHelper(parent.set),_step341;try{for(_iterator341.s();!(_step341=_iterator341.n()).done;){var _t8=_step341.value;tag.set.push(_t8)}}catch(err){_iterator341.e(err)}finally{_iterator341.f()}}return tag}},{key:"defineModifier",value:function defineModifier(){var mod=new Modifier;return function(tag){if(tag.modified.indexOf(mod)>-1)return tag;return Modifier.get(tag.base||tag,tag.modified.concat(mod).sort(function(a,b){return a.id-b.id}))}}}]);return Tag}();var nextModifierID=0;var Modifier=function(){function Modifier(){_classCallCheck2(this,Modifier);this.instances=[];this.id=nextModifierID++}_createClass2(Modifier,null,[{key:"get",value:function get(base,mods){if(!mods.length)return base;var exists=mods[0].instances.find(function(t){return t.base==base&&sameArray(mods,t.modified)});if(exists)return exists;var set=[],tag=new Tag(set,base,mods);var _iterator342=_createForOfIteratorHelper(mods),_step342;try{for(_iterator342.s();!(_step342=_iterator342.n()).done;){var m=_step342.value;m.instances.push(tag)}}catch(err){_iterator342.e(err)}finally{_iterator342.f()}var configs=powerSet(mods);var _iterator343=_createForOfIteratorHelper(base.set),_step343;try{for(_iterator343.s();!(_step343=_iterator343.n()).done;){var parent=_step343.value;if(!parent.modified.length){var _iterator344=_createForOfIteratorHelper(configs),_step344;try{for(_iterator344.s();!(_step344=_iterator344.n()).done;){var _config2=_step344.value;set.push(Modifier.get(parent,_config2))}}catch(err){_iterator344.e(err)}finally{_iterator344.f()}}}}catch(err){_iterator343.e(err)}finally{_iterator343.f()}return tag}}]);return Modifier}();function sameArray(a,b){return a.length==b.length&&a.every(function(x,i){return x==b[i]})}function powerSet(array){var sets=[[]];for(var _i233=0;_i233<array.length;_i233++){for(var j=0,e=sets.length;j<e;j++){sets.push(sets[j].concat(array[_i233]))}}return sets.sort(function(a,b){return b.length-a.length})}function styleTags(spec){var byName=Object.create(null);for(var prop in spec){var _tags=spec[prop];if(!Array.isArray(_tags))_tags=[_tags];var _iterator345=_createForOfIteratorHelper(prop.split(" ")),_step345;try{for(_iterator345.s();!(_step345=_iterator345.n()).done;){var part=_step345.value;if(part){var pieces=[],mode=2,rest=part;for(var pos=0;;){if(rest=="..."&&pos>0&&pos+3==part.length){mode=1;break}var m=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(rest);if(!m)throw new RangeError("Invalid path: "+part);pieces.push(m[0]=="*"?"":m[0][0]=="\""?JSON.parse(m[0]):m[0]);pos+=m[0].length;if(pos==part.length)break;var next=part[pos++];if(pos==part.length&&next=="!"){mode=0;break}if(next!="/")throw new RangeError("Invalid path: "+part);rest=part.slice(pos)}var last=pieces.length-1,inner=pieces[last];if(!inner)throw new RangeError("Invalid path: "+part);var rule=new Rule(_tags,mode,last>0?pieces.slice(0,last):null);byName[inner]=rule.sort(byName[inner])}}}catch(err){_iterator345.e(err)}finally{_iterator345.f()}}return ruleNodeProp.add(byName)}var ruleNodeProp=new NodeProp;var Rule=function(){function Rule(tags,mode,context,next){_classCallCheck2(this,Rule);this.tags=tags;this.mode=mode;this.context=context;this.next=next}_createClass2(Rule,[{key:"opaque",get:function get(){return this.mode==0}},{key:"inherit",get:function get(){return this.mode==1}},{key:"sort",value:function sort(other){if(!other||other.depth<this.depth){this.next=other;return this}other.next=this.sort(other.next);return other}},{key:"depth",get:function get(){return this.context?this.context.length:0}}]);return Rule}();Rule.empty=new Rule([],2,null);function tagHighlighter(tags,options){var map=Object.create(null);var _iterator346=_createForOfIteratorHelper(tags),_step346;try{for(_iterator346.s();!(_step346=_iterator346.n()).done;){var style=_step346.value;if(!Array.isArray(style.tag))map[style.tag.id]=style["class"];else{var _iterator349=_createForOfIteratorHelper(style.tag),_step349;try{for(_iterator349.s();!(_step349=_iterator349.n()).done;){var tag=_step349.value;map[tag.id]=style["class"]}}catch(err){_iterator349.e(err)}finally{_iterator349.f()}}}}catch(err){_iterator346.e(err)}finally{_iterator346.f()}var _ref232=options||{},scope=_ref232.scope,_ref232$all=_ref232.all,all=_ref232$all===void 0?null:_ref232$all;return{style:function style(tags){var cls=all;var _iterator347=_createForOfIteratorHelper(tags),_step347;try{for(_iterator347.s();!(_step347=_iterator347.n()).done;){var tag=_step347.value;var _iterator348=_createForOfIteratorHelper(tag.set),_step348;try{for(_iterator348.s();!(_step348=_iterator348.n()).done;){var sub=_step348.value;var tagClass=map[sub.id];if(tagClass){cls=cls?cls+" "+tagClass:tagClass;break}}}catch(err){_iterator348.e(err)}finally{_iterator348.f()}}}catch(err){_iterator347.e(err)}finally{_iterator347.f()}return cls},scope:scope}}function highlightTags(highlighters,tags){var result=null;var _iterator350=_createForOfIteratorHelper(highlighters),_step350;try{for(_iterator350.s();!(_step350=_iterator350.n()).done;){var highlighter=_step350.value;var value=highlighter.style(tags);if(value)result=result?result+" "+value:value}}catch(err){_iterator350.e(err)}finally{_iterator350.f()}return result}function highlightTree(tree,highlighter,putStyle){var from=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var to=arguments.length>4&&arguments[4]!==undefined?arguments[4]:tree.length;var builder=new HighlightBuilder(from,Array.isArray(highlighter)?highlighter:[highlighter],putStyle);builder.highlightRange(tree.cursor(),from,to,"",builder.highlighters);builder.flush(to)}var HighlightBuilder=function(){function HighlightBuilder(at,highlighters,span){_classCallCheck2(this,HighlightBuilder);this.at=at;this.highlighters=highlighters;this.span=span;this["class"]=""}_createClass2(HighlightBuilder,[{key:"startSpan",value:function startSpan(at,cls){if(cls!=this["class"]){this.flush(at);if(at>this.at)this.at=at;this["class"]=cls}}},{key:"flush",value:function flush(to){if(to>this.at&&this["class"])this.span(this.at,to,this["class"])}},{key:"highlightRange",value:function highlightRange(cursor,from,to,inheritedClass,highlighters){var type=cursor.type,start=cursor.from,end=cursor.to;if(start>=to||end<=from)return;if(type.isTop)highlighters=this.highlighters.filter(function(h){return!h.scope||h.scope(type)});var cls=inheritedClass;var rule=getStyleTags(cursor)||Rule.empty;var tagCls=highlightTags(highlighters,rule.tags);if(tagCls){if(cls)cls+=" ";cls+=tagCls;if(rule.mode==1)inheritedClass+=(inheritedClass?" ":"")+tagCls}this.startSpan(Math.max(from,start),cls);if(rule.opaque)return;var mounted=cursor.tree&&cursor.tree.prop(NodeProp.mounted);if(mounted&&mounted.overlay){var inner=cursor.node.enter(mounted.overlay[0].from+start,1);var innerHighlighters=this.highlighters.filter(function(h){return!h.scope||h.scope(mounted.tree.type)});var _hasChild=cursor.firstChild();for(var _i234=0,pos=start;;_i234++){var next=_i234<mounted.overlay.length?mounted.overlay[_i234]:null;var nextPos=next?next.from+start:end;var rangeFrom=Math.max(from,pos),rangeTo=Math.min(to,nextPos);if(rangeFrom<rangeTo&&_hasChild){while(cursor.from<rangeTo){this.highlightRange(cursor,rangeFrom,rangeTo,inheritedClass,highlighters);this.startSpan(Math.min(rangeTo,cursor.to),cls);if(cursor.to>=nextPos||!cursor.nextSibling())break}}if(!next||nextPos>to)break;pos=next.to+start;if(pos>from){this.highlightRange(inner.cursor(),Math.max(from,next.from+start),Math.min(to,pos),"",innerHighlighters);this.startSpan(Math.min(to,pos),cls)}}if(_hasChild)cursor.parent()}else if(cursor.firstChild()){if(mounted)inheritedClass="";do{if(cursor.to<=from)continue;if(cursor.from>=to)break;this.highlightRange(cursor,from,to,inheritedClass,highlighters);this.startSpan(Math.min(to,cursor.to),cls)}while(cursor.nextSibling());cursor.parent()}}}]);return HighlightBuilder}();function getStyleTags(node){var rule=node.type.prop(ruleNodeProp);while(rule&&rule.context&&!node.matchContext(rule.context))rule=rule.next;return rule||null}var t=Tag.define;var comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t();var tags$1={comment:comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name:name,variableName:t(name),typeName:typeName,tagName:t(typeName),propertyName:propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal:literal,string:string,docString:t(string),character:t(string),attributeValue:t(string),number:number,integer:t(number),"float":t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword:keyword,self:t(keyword),"null":t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator:operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation:punctuation,separator:t(punctuation),bracket:bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content:content,heading:heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta:meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier(),constant:Tag.defineModifier(),"function":Tag.defineModifier(),standard:Tag.defineModifier(),local:Tag.defineModifier(),special:Tag.defineModifier()};tagHighlighter([{tag:tags$1.link,"class":"tok-link"},{tag:tags$1.heading,"class":"tok-heading"},{tag:tags$1.emphasis,"class":"tok-emphasis"},{tag:tags$1.strong,"class":"tok-strong"},{tag:tags$1.keyword,"class":"tok-keyword"},{tag:tags$1.atom,"class":"tok-atom"},{tag:tags$1.bool,"class":"tok-bool"},{tag:tags$1.url,"class":"tok-url"},{tag:tags$1.labelName,"class":"tok-labelName"},{tag:tags$1.inserted,"class":"tok-inserted"},{tag:tags$1.deleted,"class":"tok-deleted"},{tag:tags$1.literal,"class":"tok-literal"},{tag:tags$1.string,"class":"tok-string"},{tag:tags$1.number,"class":"tok-number"},{tag:[tags$1.regexp,tags$1.escape,tags$1.special(tags$1.string)],"class":"tok-string2"},{tag:tags$1.variableName,"class":"tok-variableName"},{tag:tags$1.local(tags$1.variableName),"class":"tok-variableName tok-local"},{tag:tags$1.definition(tags$1.variableName),"class":"tok-variableName tok-definition"},{tag:tags$1.special(tags$1.variableName),"class":"tok-variableName2"},{tag:tags$1.definition(tags$1.propertyName),"class":"tok-propertyName tok-definition"},{tag:tags$1.typeName,"class":"tok-typeName"},{tag:tags$1.namespace,"class":"tok-namespace"},{tag:tags$1.className,"class":"tok-className"},{tag:tags$1.macroName,"class":"tok-macroName"},{tag:tags$1.propertyName,"class":"tok-propertyName"},{tag:tags$1.operator,"class":"tok-operator"},{tag:tags$1.comment,"class":"tok-comment"},{tag:tags$1.meta,"class":"tok-meta"},{tag:tags$1.invalid,"class":"tok-invalid"},{tag:tags$1.punctuation,"class":"tok-punctuation"}]);var _a;var languageDataProp=new NodeProp;function defineLanguageFacet(baseData){return Facet.define({combine:baseData?function(values){return values.concat(baseData)}:undefined})}var sublanguageProp=new NodeProp;var Language=function(){function Language(data,parser){var extraExtensions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var name=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";_classCallCheck2(this,Language);this.data=data;this.name=name;if(!EditorState.prototype.hasOwnProperty("tree"))Object.defineProperty(EditorState.prototype,"tree",{get:function get(){return syntaxTree(this)}});this.parser=parser;this.extension=[language.of(this),EditorState.languageData.of(function(state,pos,side){var top=topNodeAt(state,pos,side),data=top.type.prop(languageDataProp);if(!data)return[];var base=state.facet(data),sub=top.type.prop(sublanguageProp);if(sub){var innerNode=top.resolve(pos-top.from,side);var _iterator351=_createForOfIteratorHelper(sub),_step351;try{for(_iterator351.s();!(_step351=_iterator351.n()).done;){var sublang=_step351.value;if(sublang.test(innerNode,state)){var _data11=state.facet(sublang.facet);return sublang.type=="replace"?_data11:_data11.concat(base)}}}catch(err){_iterator351.e(err)}finally{_iterator351.f()}}return base})].concat(extraExtensions)}_createClass2(Language,[{key:"isActiveAt",value:function isActiveAt(state,pos){var side=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;return topNodeAt(state,pos,side).type.prop(languageDataProp)==this.data}},{key:"findRegions",value:function findRegions(state){var _this243=this;var lang=state.facet(language);if((lang===null||lang===void 0?void 0:lang.data)==this.data)return[{from:0,to:state.doc.length}];if(!lang||!lang.allowsNesting)return[];var result=[];var explore=function explore(tree,from){if(tree.prop(languageDataProp)==_this243.data){result.push({from:from,to:from+tree.length});return}var mount=tree.prop(NodeProp.mounted);if(mount){if(mount.tree.prop(languageDataProp)==_this243.data){if(mount.overlay){var _iterator352=_createForOfIteratorHelper(mount.overlay),_step352;try{for(_iterator352.s();!(_step352=_iterator352.n()).done;){var _r6=_step352.value;result.push({from:_r6.from+from,to:_r6.to+from})}}catch(err){_iterator352.e(err)}finally{_iterator352.f()}}else result.push({from:from,to:from+tree.length});return}else if(mount.overlay){var size=result.length;explore(mount.tree,mount.overlay[0].from+from);if(result.length>size)return}}for(var _i235=0;_i235<tree.children.length;_i235++){var ch=tree.children[_i235];if(ch instanceof Tree)explore(ch,tree.positions[_i235]+from)}};explore(syntaxTree(state),0);return result}},{key:"allowsNesting",get:function get(){return true}}]);return Language}();Language.setState=StateEffect.define();function topNodeAt(state,pos,side){var topLang=state.facet(language),tree=syntaxTree(state).topNode;if(!topLang||topLang.allowsNesting){for(var node=tree;node;node=node.enter(pos,side,IterMode.ExcludeBuffers))if(node.type.isTop)tree=node}return tree}var LRLanguage=function(_Language){_inherits2(LRLanguage,_Language);var _super98=_createSuper(LRLanguage);function LRLanguage(data,parser,name){var _this244;_classCallCheck2(this,LRLanguage);_this244=_super98.call(this,data,parser,[],name);_this244.parser=parser;return _this244}_createClass2(LRLanguage,[{key:"configure",value:function configure(options,name){return new LRLanguage(this.data,this.parser.configure(options),name||this.name)}},{key:"allowsNesting",get:function get(){return this.parser.hasWrappers()}}],[{key:"define",value:function define(spec){var data=defineLanguageFacet(spec.languageData);return new LRLanguage(data,spec.parser.configure({props:[languageDataProp.add(function(type){return type.isTop?data:undefined})]}),spec.name)}}]);return LRLanguage}(Language);function syntaxTree(state){var field=state.field(Language.state,false);return field?field.tree:Tree.empty}var DocInput=function(){function DocInput(doc){_classCallCheck2(this,DocInput);this.doc=doc;this.cursorPos=0;this.string="";this.cursor=doc.iter()}_createClass2(DocInput,[{key:"length",get:function get(){return this.doc.length}},{key:"syncTo",value:function syncTo(pos){this.string=this.cursor.next(pos-this.cursorPos).value;this.cursorPos=pos+this.string.length;return this.cursorPos-this.string.length}},{key:"chunk",value:function chunk(pos){this.syncTo(pos);return this.string}},{key:"lineChunks",get:function get(){return true}},{key:"read",value:function read(from,to){var stringStart=this.cursorPos-this.string.length;if(from<stringStart||to>=this.cursorPos)return this.doc.sliceString(from,to);else return this.string.slice(from-stringStart,to-stringStart)}}]);return DocInput}();var currentContext=null;var ParseContext=function(){function ParseContext(parser,state){var fragments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var tree=arguments.length>3?arguments[3]:undefined;var treeLen=arguments.length>4?arguments[4]:undefined;var viewport=arguments.length>5?arguments[5]:undefined;var skipped=arguments.length>6?arguments[6]:undefined;var scheduleOn=arguments.length>7?arguments[7]:undefined;_classCallCheck2(this,ParseContext);this.parser=parser;this.state=state;this.fragments=fragments;this.tree=tree;this.treeLen=treeLen;this.viewport=viewport;this.skipped=skipped;this.scheduleOn=scheduleOn;this.parse=null;this.tempSkipped=[]}_createClass2(ParseContext,[{key:"startParse",value:function startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}},{key:"work",value:function work(until,upto){var _this245=this;if(upto!=null&&upto>=this.state.doc.length)upto=undefined;if(this.tree!=Tree.empty&&this.isDone(upto!==null&&upto!==void 0?upto:this.state.doc.length)){this.takeTree();return true}return this.withContext(function(){var _a;if(typeof until=="number"){var endTime=Date.now()+until;until=function until(){return Date.now()>endTime}}if(!_this245.parse)_this245.parse=_this245.startParse();if(upto!=null&&(_this245.parse.stoppedAt==null||_this245.parse.stoppedAt>upto)&&upto<_this245.state.doc.length)_this245.parse.stopAt(upto);for(;;){var done=_this245.parse.advance();if(done){_this245.fragments=_this245.withoutTempSkipped(TreeFragment.addTree(done,_this245.fragments,_this245.parse.stoppedAt!=null));_this245.treeLen=(_a=_this245.parse.stoppedAt)!==null&&_a!==void 0?_a:_this245.state.doc.length;_this245.tree=done;_this245.parse=null;if(_this245.treeLen<(upto!==null&&upto!==void 0?upto:_this245.state.doc.length))_this245.parse=_this245.startParse();else return true}if(until())return false}})}},{key:"takeTree",value:function takeTree(){var _this246=this;var pos,tree;if(this.parse&&(pos=this.parse.parsedPos)>=this.treeLen){if(this.parse.stoppedAt==null||this.parse.stoppedAt>pos)this.parse.stopAt(pos);this.withContext(function(){while(!(tree=_this246.parse.advance())){}});this.treeLen=pos;this.tree=tree;this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,true));this.parse=null}}},{key:"withContext",value:function withContext(f){var prev=currentContext;currentContext=this;try{return f()}finally{currentContext=prev}}},{key:"withoutTempSkipped",value:function withoutTempSkipped(fragments){for(var _r7;_r7=this.tempSkipped.pop();)fragments=cutFragments(fragments,_r7.from,_r7.to);return fragments}},{key:"changes",value:function changes(_changes,newState){var fragments=this.fragments,tree=this.tree,treeLen=this.treeLen,viewport=this.viewport,skipped=this.skipped;this.takeTree();if(!_changes.empty){var ranges=[];_changes.iterChangedRanges(function(fromA,toA,fromB,toB){return ranges.push({fromA:fromA,toA:toA,fromB:fromB,toB:toB})});fragments=TreeFragment.applyChanges(fragments,ranges);tree=Tree.empty;treeLen=0;viewport={from:_changes.mapPos(viewport.from,-1),to:_changes.mapPos(viewport.to,1)};if(this.skipped.length){skipped=[];var _iterator353=_createForOfIteratorHelper(this.skipped),_step353;try{for(_iterator353.s();!(_step353=_iterator353.n()).done;){var _r8=_step353.value;var from=_changes.mapPos(_r8.from,1),to=_changes.mapPos(_r8.to,-1);if(from<to)skipped.push({from:from,to:to})}}catch(err){_iterator353.e(err)}finally{_iterator353.f()}}}return new ParseContext(this.parser,newState,fragments,tree,treeLen,viewport,skipped,this.scheduleOn)}},{key:"updateViewport",value:function updateViewport(viewport){if(this.viewport.from==viewport.from&&this.viewport.to==viewport.to)return false;this.viewport=viewport;var startLen=this.skipped.length;for(var _i236=0;_i236<this.skipped.length;_i236++){var _this$skipped$_i=this.skipped[_i236],from=_this$skipped$_i.from,to=_this$skipped$_i.to;if(from<viewport.to&&to>viewport.from){this.fragments=cutFragments(this.fragments,from,to);this.skipped.splice(_i236--,1)}}if(this.skipped.length>=startLen)return false;this.reset();return true}},{key:"reset",value:function reset(){if(this.parse){this.takeTree();this.parse=null}}},{key:"skipUntilInView",value:function skipUntilInView(from,to){this.skipped.push({from:from,to:to})}},{key:"isDone",value:function isDone(upto){upto=Math.min(upto,this.state.doc.length);var frags=this.fragments;return this.treeLen>=upto&&frags.length&&frags[0].from==0&&frags[0].to>=upto}}],[{key:"create",value:function create(parser,state,viewport){return new ParseContext(parser,state,[],Tree.empty,0,viewport,[],null)}},{key:"getSkippingParser",value:function getSkippingParser(until){return new(function(_Parser){_inherits2(_class66,_Parser);var _super99=_createSuper(_class66);function _class66(){_classCallCheck2(this,_class66);return _super99.apply(this,arguments)}_createClass2(_class66,[{key:"createParse",value:function createParse(input,fragments,ranges){var from=ranges[0].from,to=ranges[ranges.length-1].to;var parser={parsedPos:from,advance:function advance(){var cx=currentContext;if(cx){var _iterator354=_createForOfIteratorHelper(ranges),_step354;try{for(_iterator354.s();!(_step354=_iterator354.n()).done;){var _r9=_step354.value;cx.tempSkipped.push(_r9)}}catch(err){_iterator354.e(err)}finally{_iterator354.f()}if(until)cx.scheduleOn=cx.scheduleOn?Promise.all([cx.scheduleOn,until]):until}this.parsedPos=to;return new Tree(NodeType.none,[],[],to-from)},stoppedAt:null,stopAt:function stopAt(){}};return parser}}]);return _class66}(Parser))}},{key:"get",value:function get(){return currentContext}}]);return ParseContext}();function cutFragments(fragments,from,to){return TreeFragment.applyChanges(fragments,[{fromA:from,toA:to,fromB:from,toB:to}])}var LanguageState=function(){function LanguageState(context){_classCallCheck2(this,LanguageState);this.context=context;this.tree=context.tree}_createClass2(LanguageState,[{key:"apply",value:function apply(tr){if(!tr.docChanged&&this.tree==this.context.tree)return this;var newCx=this.context.changes(tr.changes,tr.state);var upto=this.context.treeLen==tr.startState.doc.length?undefined:Math.max(tr.changes.mapPos(this.context.treeLen),newCx.viewport.to);if(!newCx.work(20,upto))newCx.takeTree();return new LanguageState(newCx)}}],[{key:"init",value:function init(state){var vpTo=Math.min(3000,state.doc.length);var parseState=ParseContext.create(state.facet(language).parser,state,{from:0,to:vpTo});if(!parseState.work(20,vpTo))parseState.takeTree();return new LanguageState(parseState)}}]);return LanguageState}();Language.state=StateField.define({create:LanguageState.init,update:function update(value,tr){var _iterator355=_createForOfIteratorHelper(tr.effects),_step355;try{for(_iterator355.s();!(_step355=_iterator355.n()).done;){var e=_step355.value;if(e.is(Language.setState))return e.value}}catch(err){_iterator355.e(err)}finally{_iterator355.f()}if(tr.startState.facet(language)!=tr.state.facet(language))return LanguageState.init(tr.state);return value.apply(tr)}});var requestIdle=function requestIdle(callback){var timeout=setTimeout(function(){return callback()},500);return function(){return clearTimeout(timeout)}};if(typeof requestIdleCallback!="undefined")requestIdle=function requestIdle(callback){var idle=-1,timeout=setTimeout(function(){idle=requestIdleCallback(callback,{timeout:500-100})},100);return function(){return idle<0?clearTimeout(timeout):cancelIdleCallback(idle)}};var isInputPending=typeof navigator!="undefined"&&((_a=navigator.scheduling)===null||_a===void 0?void 0:_a.isInputPending)?function(){return navigator.scheduling.isInputPending()}:null;var parseWorker=ViewPlugin.fromClass(function(){function ParseWorker(view){_classCallCheck2(this,ParseWorker);this.view=view;this.working=null;this.workScheduled=0;this.chunkEnd=-1;this.chunkBudget=-1;this.work=this.work.bind(this);this.scheduleWork()}_createClass2(ParseWorker,[{key:"update",value:function update(_update19){var cx=this.view.state.field(Language.state).context;if(cx.updateViewport(_update19.view.viewport)||this.view.viewport.to>cx.treeLen)this.scheduleWork();if(_update19.docChanged||_update19.selectionSet){if(this.view.hasFocus)this.chunkBudget+=50;this.scheduleWork()}this.checkAsyncSchedule(cx)}},{key:"scheduleWork",value:function scheduleWork(){if(this.working)return;var state=this.view.state,field=state.field(Language.state);if(field.tree!=field.context.tree||!field.context.isDone(state.doc.length))this.working=requestIdle(this.work)}},{key:"work",value:function work(deadline){this.working=null;var now=Date.now();if(this.chunkEnd<now&&(this.chunkEnd<0||this.view.hasFocus)){this.chunkEnd=now+30000;this.chunkBudget=3000}if(this.chunkBudget<=0)return;var _this$view3=this.view,state=_this$view3.state,vpTo=_this$view3.viewport.to,field=state.field(Language.state);if(field.tree==field.context.tree&&field.context.isDone(vpTo+100000))return;var endTime=Date.now()+Math.min(this.chunkBudget,100,deadline&&!isInputPending?Math.max(25,deadline.timeRemaining()-5):1e9);var viewportFirst=field.context.treeLen<vpTo&&state.doc.length>vpTo+1000;var done=field.context.work(function(){return isInputPending&&isInputPending()||Date.now()>endTime},vpTo+(viewportFirst?0:100000));this.chunkBudget-=Date.now()-now;if(done||this.chunkBudget<=0){field.context.takeTree();this.view.dispatch({effects:Language.setState.of(new LanguageState(field.context))})}if(this.chunkBudget>0&&!(done&&!viewportFirst))this.scheduleWork();this.checkAsyncSchedule(field.context)}},{key:"checkAsyncSchedule",value:function checkAsyncSchedule(cx){var _this247=this;if(cx.scheduleOn){this.workScheduled++;cx.scheduleOn.then(function(){return _this247.scheduleWork()})["catch"](function(err){return logException(_this247.view.state,err)}).then(function(){return _this247.workScheduled--});cx.scheduleOn=null}}},{key:"destroy",value:function destroy(){if(this.working)this.working()}},{key:"isWorking",value:function isWorking(){return!!(this.working||this.workScheduled>0)}}]);return ParseWorker}(),{eventHandlers:{focus:function focus(){this.scheduleWork()}}});var language=Facet.define({combine:function combine(languages){return languages.length?languages[0]:null},enables:function enables(language){return[Language.state,parseWorker,EditorView.contentAttributes.compute([language],function(state){var lang=state.facet(language);return lang&&lang.name?{"data-language":lang.name}:{}})]}});var LanguageSupport=_createClass2(function LanguageSupport(language){var support=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];_classCallCheck2(this,LanguageSupport);this.language=language;this.support=support;this.extension=[language,support]});var LanguageDescription=function(){function LanguageDescription(name,alias,extensions,filename,loadFunc){var support=arguments.length>5&&arguments[5]!==undefined?arguments[5]:undefined;_classCallCheck2(this,LanguageDescription);this.name=name;this.alias=alias;this.extensions=extensions;this.filename=filename;this.loadFunc=loadFunc;this.support=support;this.loading=null}_createClass2(LanguageDescription,[{key:"load",value:function load(){var _this248=this;return this.loading||(this.loading=this.loadFunc().then(function(support){return _this248.support=support},function(err){_this248.loading=null;throw err}))}}],[{key:"of",value:function of(spec){var load=spec.load,support=spec.support;if(!load){if(!support)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");load=function load(){return Promise.resolve(support)}}return new LanguageDescription(spec.name,(spec.alias||[]).concat(spec.name).map(function(s){return s.toLowerCase()}),spec.extensions||[],spec.filename,load,support)}},{key:"matchFilename",value:function matchFilename(descs,filename){var _iterator356=_createForOfIteratorHelper(descs),_step356;try{for(_iterator356.s();!(_step356=_iterator356.n()).done;){var _d2=_step356.value;if(_d2.filename&&_d2.filename.test(filename))return _d2}}catch(err){_iterator356.e(err)}finally{_iterator356.f()}var ext=/\.([^.]+)$/.exec(filename);if(ext){var _iterator357=_createForOfIteratorHelper(descs),_step357;try{for(_iterator357.s();!(_step357=_iterator357.n()).done;){var d=_step357.value;if(d.extensions.indexOf(ext[1])>-1)return d}}catch(err){_iterator357.e(err)}finally{_iterator357.f()}}return null}},{key:"matchLanguageName",value:function matchLanguageName(descs,name){var fuzzy=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;name=name.toLowerCase();var _iterator358=_createForOfIteratorHelper(descs),_step358;try{for(_iterator358.s();!(_step358=_iterator358.n()).done;){var _d3=_step358.value;if(_d3.alias.some(function(a){return a==name}))return _d3}}catch(err){_iterator358.e(err)}finally{_iterator358.f()}if(fuzzy){var _iterator359=_createForOfIteratorHelper(descs),_step359;try{for(_iterator359.s();!(_step359=_iterator359.n()).done;){var d=_step359.value;var _iterator360=_createForOfIteratorHelper(d.alias),_step360;try{for(_iterator360.s();!(_step360=_iterator360.n()).done;){var a=_step360.value;var found=name.indexOf(a);if(found>-1&&(a.length>2||!/\w/.test(name[found-1])&&!/\w/.test(name[found+a.length])))return d}}catch(err){_iterator360.e(err)}finally{_iterator360.f()}}}catch(err){_iterator359.e(err)}finally{_iterator359.f()}}return null}}]);return LanguageDescription}();var indentService=Facet.define();var indentUnit=Facet.define({combine:function combine(values){if(!values.length)return"  ";var unit=values[0];if(!unit||/\S/.test(unit)||Array.from(unit).some(function(e){return e!=unit[0]}))throw new Error("Invalid indent unit: "+JSON.stringify(values[0]));return unit}});function getIndentUnit(state){var unit=state.facet(indentUnit);return unit.charCodeAt(0)==9?state.tabSize*unit.length:unit.length}function indentString(state,cols){var result="",ts=state.tabSize,ch=state.facet(indentUnit)[0];if(ch=="\t"){while(cols>=ts){result+="\t";cols-=ts}ch=" "}for(var _i237=0;_i237<cols;_i237++)result+=ch;return result}function getIndentation(context,pos){if(context instanceof EditorState)context=new IndentContext(context);var _iterator361=_createForOfIteratorHelper(context.state.facet(indentService)),_step361;try{for(_iterator361.s();!(_step361=_iterator361.n()).done;){var service=_step361.value;var result=service(context,pos);if(result!==undefined)return result}}catch(err){_iterator361.e(err)}finally{_iterator361.f()}var tree=syntaxTree(context.state);return tree.length>=pos?syntaxIndentation(context,tree,pos):null}var IndentContext=function(){function IndentContext(state){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck2(this,IndentContext);this.state=state;this.options=options;this.unit=getIndentUnit(state)}_createClass2(IndentContext,[{key:"lineAt",value:function lineAt(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var line=this.state.doc.lineAt(pos);var _this$options2=this.options,simulateBreak=_this$options2.simulateBreak,simulateDoubleBreak=_this$options2.simulateDoubleBreak;if(simulateBreak!=null&&simulateBreak>=line.from&&simulateBreak<=line.to){if(simulateDoubleBreak&&simulateBreak==pos)return{text:"",from:pos};else if(bias<0?simulateBreak<pos:simulateBreak<=pos)return{text:line.text.slice(simulateBreak-line.from),from:simulateBreak};else return{text:line.text.slice(0,simulateBreak-line.from),from:line.from}}return line}},{key:"textAfterPos",value:function textAfterPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(this.options.simulateDoubleBreak&&pos==this.options.simulateBreak)return"";var _this$lineAt=this.lineAt(pos,bias),text=_this$lineAt.text,from=_this$lineAt.from;return text.slice(pos-from,Math.min(text.length,pos+100-from))}},{key:"column",value:function column(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var _this$lineAt2=this.lineAt(pos,bias),text=_this$lineAt2.text,from=_this$lineAt2.from;var result=this.countColumn(text,pos-from);var override=this.options.overrideIndentation?this.options.overrideIndentation(from):-1;if(override>-1)result+=override-this.countColumn(text,text.search(/\S|$/));return result}},{key:"countColumn",value:function countColumn(line){var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:line.length;return _countColumn(line,this.state.tabSize,pos)}},{key:"lineIndent",value:function lineIndent(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var _this$lineAt3=this.lineAt(pos,bias),text=_this$lineAt3.text,from=_this$lineAt3.from;var override=this.options.overrideIndentation;if(override){var overriden=override(from);if(overriden>-1)return overriden}return this.countColumn(text,text.search(/\S|$/))}},{key:"simulatedBreak",get:function get(){return this.options.simulateBreak||null}}]);return IndentContext}();var indentNodeProp=new NodeProp;function syntaxIndentation(cx,ast,pos){var stack=ast.resolveStack(pos);var inner=stack.node.enterUnfinishedNodesBefore(pos);if(inner!=stack.node){var _add4=[];for(var _cur15=inner;_cur15!=stack.node;_cur15=_cur15.parent)_add4.push(_cur15);for(var _i238=_add4.length-1;_i238>=0;_i238--)stack={node:_add4[_i238],next:stack}}return indentFor(stack,cx,pos)}function indentFor(stack,cx,pos){for(var _cur16=stack;_cur16;_cur16=_cur16.next){var strategy=indentStrategy(_cur16.node);if(strategy)return strategy(TreeIndentContext.create(cx,pos,_cur16))}return 0}function ignoreClosed(cx){return cx.pos==cx.options.simulateBreak&&cx.options.simulateDoubleBreak}function indentStrategy(tree){var strategy=tree.type.prop(indentNodeProp);if(strategy)return strategy;var first=tree.firstChild,close;if(first&&(close=first.type.prop(NodeProp.closedBy))){var last=tree.lastChild,closed=last&&close.indexOf(last.name)>-1;return function(cx){return delimitedStrategy(cx,true,1,undefined,closed&&!ignoreClosed(cx)?last.from:undefined)}}return tree.parent==null?topIndent:null}function topIndent(){return 0}var TreeIndentContext=function(_IndentContext){_inherits2(TreeIndentContext,_IndentContext);var _super100=_createSuper(TreeIndentContext);function TreeIndentContext(base,pos,context){var _this249;_classCallCheck2(this,TreeIndentContext);_this249=_super100.call(this,base.state,base.options);_this249.base=base;_this249.pos=pos;_this249.context=context;return _this249}_createClass2(TreeIndentContext,[{key:"node",get:function get(){return this.context.node}},{key:"textAfter",get:function get(){return this.textAfterPos(this.pos)}},{key:"baseIndent",get:function get(){return this.baseIndentFor(this.node)}},{key:"baseIndentFor",value:function baseIndentFor(node){var line=this.state.doc.lineAt(node.from);for(;;){var atBreak=node.resolve(line.from);while(atBreak.parent&&atBreak.parent.from==atBreak.from)atBreak=atBreak.parent;if(isParent(atBreak,node))break;line=this.state.doc.lineAt(atBreak.from)}return this.lineIndent(line.from)}},{key:"continue",value:function _continue(){return indentFor(this.context.next,this.base,this.pos)}}],[{key:"create",value:function create(base,pos,context){return new TreeIndentContext(base,pos,context)}}]);return TreeIndentContext}(IndentContext);function isParent(parent,of){for(var _cur17=of;_cur17;_cur17=_cur17.parent)if(parent==_cur17)return true;return false}function bracketedAligned(context){var tree=context.node;var openToken=tree.childAfter(tree.from),last=tree.lastChild;if(!openToken)return null;var sim=context.options.simulateBreak;var openLine=context.state.doc.lineAt(openToken.from);var lineEnd=sim==null||sim<=openLine.from?openLine.to:Math.min(openLine.to,sim);for(var pos=openToken.to;;){var next=tree.childAfter(pos);if(!next||next==last)return null;if(!next.type.isSkipped)return next.from<lineEnd?openToken:null;pos=next.to}}function delimitedIndent(_ref233){var closing=_ref233.closing,_ref233$align=_ref233.align,align=_ref233$align===void 0?true:_ref233$align,_ref233$units=_ref233.units,units=_ref233$units===void 0?1:_ref233$units;return function(context){return delimitedStrategy(context,align,units,closing)}}function delimitedStrategy(context,align,units,closing,closedAt){var after=context.textAfter,space=after.match(/^\s*/)[0].length;var closed=closing&&after.slice(space,space+closing.length)==closing||closedAt==context.pos+space;var aligned=align?bracketedAligned(context):null;if(aligned)return closed?context.column(aligned.from):context.column(aligned.to);return context.baseIndent+(closed?0:context.unit*units)}var flatIndent=function flatIndent(context){return context.baseIndent};function continuedIndent(){var _ref234=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},except=_ref234.except,_ref234$units=_ref234.units,units=_ref234$units===void 0?1:_ref234$units;return function(context){var matchExcept=except&&except.test(context.textAfter);return context.baseIndent+(matchExcept?0:units*context.unit)}}var DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of(function(tr){if(!tr.docChanged||!tr.isUserEvent("input.type")&&!tr.isUserEvent("input.complete"))return tr;var rules=tr.startState.languageDataAt("indentOnInput",tr.startState.selection.main.head);if(!rules.length)return tr;var doc=tr.newDoc,head=tr.newSelection.main.head,line=doc.lineAt(head);if(head>line.from+DontIndentBeyond)return tr;var lineStart=doc.sliceString(line.from,head);if(!rules.some(function(r){return r.test(lineStart)}))return tr;var state=tr.state,last=-1,changes=[];var _iterator362=_createForOfIteratorHelper(state.selection.ranges),_step362;try{for(_iterator362.s();!(_step362=_iterator362.n()).done;){var _head=_step362.value.head;var _line5=state.doc.lineAt(_head);if(_line5.from==last)continue;last=_line5.from;var indent=getIndentation(state,_line5.from);if(indent==null)continue;var _cur18=/^\s*/.exec(_line5.text)[0];var norm=indentString(state,indent);if(_cur18!=norm)changes.push({from:_line5.from,to:_line5.from+_cur18.length,insert:norm})}}catch(err){_iterator362.e(err)}finally{_iterator362.f()}return changes.length?[tr,{changes:changes,sequential:true}]:tr})}var foldService=Facet.define();var foldNodeProp=new NodeProp;function foldInside(node){var first=node.firstChild,last=node.lastChild;return first&&first.to<last.from?{from:first.to,to:last.type.isError?node.to:last.from}:null}function syntaxFolding(state,start,end){var tree=syntaxTree(state);if(tree.length<end)return null;var stack=tree.resolveStack(end,1);var found=null;for(var iter=stack;iter;iter=iter.next){var _cur19=iter.node;if(_cur19.to<=end||_cur19.from>end)continue;if(found&&_cur19.from<start)break;var prop=_cur19.type.prop(foldNodeProp);if(prop&&(_cur19.to<tree.length-50||tree.length==state.doc.length||!isUnfinished(_cur19))){var value=prop(_cur19,state);if(value&&value.from<=end&&value.from>=start&&value.to>end)found=value}}return found}function isUnfinished(node){var ch=node.lastChild;return ch&&ch.to==node.to&&ch.type.isError}function foldable(state,lineStart,lineEnd){var _iterator363=_createForOfIteratorHelper(state.facet(foldService)),_step363;try{for(_iterator363.s();!(_step363=_iterator363.n()).done;){var service=_step363.value;var result=service(state,lineStart,lineEnd);if(result)return result}}catch(err){_iterator363.e(err)}finally{_iterator363.f()}return syntaxFolding(state,lineStart,lineEnd)}function mapRange(range,mapping){var from=mapping.mapPos(range.from,1),to=mapping.mapPos(range.to,-1);return from>=to?undefined:{from:from,to:to}}var foldEffect=StateEffect.define({map:mapRange});var unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(view){var lines=[];var _iterator364=_createForOfIteratorHelper(view.state.selection.ranges),_step364;try{var _loop22=function _loop22(){var head=_step364.value.head;if(lines.some(function(l){return l.from<=head&&l.to>=head}))return 1;lines.push(view.lineBlockAt(head))};for(_iterator364.s();!(_step364=_iterator364.n()).done;){if(_loop22())continue}}catch(err){_iterator364.e(err)}finally{_iterator364.f()}return lines}var foldState=StateField.define({create:function create(){return Decoration.none},update:function update(folded,tr){folded=folded.map(tr.changes);var _iterator365=_createForOfIteratorHelper(tr.effects),_step365;try{var _loop23=function _loop23(){var e=_step365.value;if(e.is(foldEffect)&&!foldExists(folded,e.value.from,e.value.to)){var _tr$state$facet=tr.state.facet(foldConfig),preparePlaceholder=_tr$state$facet.preparePlaceholder;var widget=!preparePlaceholder?foldWidget:Decoration.replace({widget:new PreparedFoldWidget(preparePlaceholder(tr.state,e.value))});folded=folded.update({add:[widget.range(e.value.from,e.value.to)]})}else if(e.is(unfoldEffect)){folded=folded.update({filter:function filter(from,to){return e.value.from!=from||e.value.to!=to},filterFrom:e.value.from,filterTo:e.value.to})}};for(_iterator365.s();!(_step365=_iterator365.n()).done;){_loop23()}}catch(err){_iterator365.e(err)}finally{_iterator365.f()}if(tr.selection){var onSelection=false,head=tr.selection.main.head;folded.between(head,head,function(a,b){if(a<head&&b>head)onSelection=true});if(onSelection)folded=folded.update({filterFrom:head,filterTo:head,filter:function filter(a,b){return b<=head||a>=head}})}return folded},provide:function provide(f){return EditorView.decorations.from(f)},toJSON:function toJSON(folded,state){var ranges=[];folded.between(0,state.doc.length,function(from,to){ranges.push(from,to)});return ranges},fromJSON:function fromJSON(value){if(!Array.isArray(value)||value.length%2)throw new RangeError("Invalid JSON for fold state");var ranges=[];for(var _i239=0;_i239<value.length;){var from=value[_i239++],to=value[_i239++];if(typeof from!="number"||typeof to!="number")throw new RangeError("Invalid JSON for fold state");ranges.push(foldWidget.range(from,to))}return Decoration.set(ranges,true)}});function findFold(state,from,to){var _a;var found=null;(_a=state.field(foldState,false))===null||_a===void 0?void 0:_a.between(from,to,function(from,to){if(!found||found.from>from)found={from:from,to:to}});return found}function foldExists(folded,from,to){var found=false;folded.between(from,from,function(a,b){if(a==from&&b==to)found=true});return found}function maybeEnable(state,other){return state.field(foldState,false)?other:other.concat(StateEffect.appendConfig.of(codeFolding()))}var foldCode=function foldCode(view){var _iterator366=_createForOfIteratorHelper(selectedLines(view)),_step366;try{for(_iterator366.s();!(_step366=_iterator366.n()).done;){var line=_step366.value;var range=foldable(view.state,line.from,line.to);if(range){view.dispatch({effects:maybeEnable(view.state,[foldEffect.of(range),announceFold(view,range)])});return true}}}catch(err){_iterator366.e(err)}finally{_iterator366.f()}return false};var unfoldCode=function unfoldCode(view){if(!view.state.field(foldState,false))return false;var effects=[];var _iterator367=_createForOfIteratorHelper(selectedLines(view)),_step367;try{for(_iterator367.s();!(_step367=_iterator367.n()).done;){var line=_step367.value;var folded=findFold(view.state,line.from,line.to);if(folded)effects.push(unfoldEffect.of(folded),announceFold(view,folded,false))}}catch(err){_iterator367.e(err)}finally{_iterator367.f()}if(effects.length)view.dispatch({effects:effects});return effects.length>0};function announceFold(view,range){var fold=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var lineFrom=view.state.doc.lineAt(range.from).number,lineTo=view.state.doc.lineAt(range.to).number;return EditorView.announce.of("".concat(view.state.phrase(fold?"Folded lines":"Unfolded lines")," ").concat(lineFrom," ").concat(view.state.phrase("to")," ").concat(lineTo,"."))}var foldAll=function foldAll(view){var state=view.state,effects=[];for(var pos=0;pos<state.doc.length;){var line=view.lineBlockAt(pos),range=foldable(state,line.from,line.to);if(range)effects.push(foldEffect.of(range));pos=(range?view.lineBlockAt(range.to):line).to+1}if(effects.length)view.dispatch({effects:maybeEnable(view.state,effects)});return!!effects.length};var unfoldAll=function unfoldAll(view){var field=view.state.field(foldState,false);if(!field||!field.size)return false;var effects=[];field.between(0,view.state.doc.length,function(from,to){effects.push(unfoldEffect.of({from:from,to:to}))});view.dispatch({effects:effects});return true};var foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}];var defaultConfig={placeholderDOM:null,preparePlaceholder:null,placeholderText:"\u2026"};var foldConfig=Facet.define({combine:function combine(values){return combineConfig(values,defaultConfig)}});function codeFolding(config){var result=[foldState,baseTheme$1$2];if(config)result.push(foldConfig.of(config));return result}function widgetToDOM(view,prepared){var state=view.state,conf=state.facet(foldConfig);var onclick=function onclick(event){var line=view.lineBlockAt(view.posAtDOM(event.target));var folded=findFold(view.state,line.from,line.to);if(folded)view.dispatch({effects:unfoldEffect.of(folded)});event.preventDefault()};if(conf.placeholderDOM)return conf.placeholderDOM(view,onclick,prepared);var element=document.createElement("span");element.textContent=conf.placeholderText;element.setAttribute("aria-label",state.phrase("folded code"));element.title=state.phrase("unfold");element.className="cm-foldPlaceholder";element.onclick=onclick;return element}var foldWidget=Decoration.replace({widget:new(function(_WidgetType7){_inherits2(_class67,_WidgetType7);var _super101=_createSuper(_class67);function _class67(){_classCallCheck2(this,_class67);return _super101.apply(this,arguments)}_createClass2(_class67,[{key:"toDOM",value:function toDOM(view){return widgetToDOM(view,null)}}]);return _class67}(WidgetType))});var PreparedFoldWidget=function(_WidgetType8){_inherits2(PreparedFoldWidget,_WidgetType8);var _super102=_createSuper(PreparedFoldWidget);function PreparedFoldWidget(value){var _this250;_classCallCheck2(this,PreparedFoldWidget);_this250=_super102.call(this);_this250.value=value;return _this250}_createClass2(PreparedFoldWidget,[{key:"eq",value:function eq(other){return this.value==other.value}},{key:"toDOM",value:function toDOM(view){return widgetToDOM(view,this.value)}}]);return PreparedFoldWidget}(WidgetType);var foldGutterDefaults={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{},foldingChanged:function foldingChanged(){return false}};var FoldMarker=function(_GutterMarker3){_inherits2(FoldMarker,_GutterMarker3);var _super103=_createSuper(FoldMarker);function FoldMarker(config,open){var _this251;_classCallCheck2(this,FoldMarker);_this251=_super103.call(this);_this251.config=config;_this251.open=open;return _this251}_createClass2(FoldMarker,[{key:"eq",value:function eq(other){return this.config==other.config&&this.open==other.open}},{key:"toDOM",value:function toDOM(view){if(this.config.markerDOM)return this.config.markerDOM(this.open);var span=document.createElement("span");span.textContent=this.open?this.config.openText:this.config.closedText;span.title=view.state.phrase(this.open?"Fold line":"Unfold line");return span}}]);return FoldMarker}(GutterMarker);function foldGutter(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var fullConfig=Object.assign(Object.assign({},foldGutterDefaults),config);var canFold=new FoldMarker(fullConfig,true),canUnfold=new FoldMarker(fullConfig,false);var _markers=ViewPlugin.fromClass(function(){function _class68(view){_classCallCheck2(this,_class68);this.from=view.viewport.from;this.markers=this.buildMarkers(view)}_createClass2(_class68,[{key:"update",value:function update(_update20){if(_update20.docChanged||_update20.viewportChanged||_update20.startState.facet(language)!=_update20.state.facet(language)||_update20.startState.field(foldState,false)!=_update20.state.field(foldState,false)||syntaxTree(_update20.startState)!=syntaxTree(_update20.state)||fullConfig.foldingChanged(_update20))this.markers=this.buildMarkers(_update20.view)}},{key:"buildMarkers",value:function buildMarkers(view){var builder=new RangeSetBuilder;var _iterator368=_createForOfIteratorHelper(view.viewportLineBlocks),_step368;try{for(_iterator368.s();!(_step368=_iterator368.n()).done;){var line=_step368.value;var mark=findFold(view.state,line.from,line.to)?canUnfold:foldable(view.state,line.from,line.to)?canFold:null;if(mark)builder.add(line.from,line.from,mark)}}catch(err){_iterator368.e(err)}finally{_iterator368.f()}return builder.finish()}}]);return _class68}());var domEventHandlers=fullConfig.domEventHandlers;return[_markers,gutter({"class":"cm-foldGutter",markers:function markers(view){var _a;return((_a=view.plugin(_markers))===null||_a===void 0?void 0:_a.markers)||RangeSet.empty},initialSpacer:function initialSpacer(){return new FoldMarker(fullConfig,false)},domEventHandlers:Object.assign(Object.assign({},domEventHandlers),{click:function click(view,line,event){if(domEventHandlers.click&&domEventHandlers.click(view,line,event))return true;var folded=findFold(view.state,line.from,line.to);if(folded){view.dispatch({effects:unfoldEffect.of(folded)});return true}var range=foldable(view.state,line.from,line.to);if(range){view.dispatch({effects:foldEffect.of(range)});return true}return false}})}),codeFolding()]}var baseTheme$1$2=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});var HighlightStyle=function(){function HighlightStyle(specs,options){_classCallCheck2(this,HighlightStyle);this.specs=specs;var modSpec;function def(spec){var cls=StyleModule.newName();(modSpec||(modSpec=Object.create(null)))["."+cls]=spec;return cls}var all=typeof options.all=="string"?options.all:options.all?def(options.all):undefined;var scopeOpt=options.scope;this.scope=scopeOpt instanceof Language?function(type){return type.prop(languageDataProp)==scopeOpt.data}:scopeOpt?function(type){return type==scopeOpt}:undefined;this.style=tagHighlighter(specs.map(function(style){return{tag:style.tag,"class":style["class"]||def(Object.assign({},style,{tag:null}))}}),{all:all}).style;this.module=modSpec?new StyleModule(modSpec):null;this.themeType=options.themeType}_createClass2(HighlightStyle,null,[{key:"define",value:function define(specs,options){return new HighlightStyle(specs,options||{})}}]);return HighlightStyle}();var highlighterFacet=Facet.define();var fallbackHighlighter=Facet.define({combine:function combine(values){return values.length?[values[0]]:null}});function getHighlighters(state){var main=state.facet(highlighterFacet);return main.length?main:state.facet(fallbackHighlighter)}function syntaxHighlighting(highlighter,options){var ext=[treeHighlighter],themeType;if(highlighter instanceof HighlightStyle){if(highlighter.module)ext.push(EditorView.styleModule.of(highlighter.module));themeType=highlighter.themeType}if(options===null||options===void 0?void 0:options.fallback)ext.push(fallbackHighlighter.of(highlighter));else if(themeType)ext.push(highlighterFacet.computeN([EditorView.darkTheme],function(state){return state.facet(EditorView.darkTheme)==(themeType=="dark")?[highlighter]:[]}));else ext.push(highlighterFacet.of(highlighter));return ext}var TreeHighlighter=function(){function TreeHighlighter(view){_classCallCheck2(this,TreeHighlighter);this.markCache=Object.create(null);this.tree=syntaxTree(view.state);this.decorations=this.buildDeco(view,getHighlighters(view.state))}_createClass2(TreeHighlighter,[{key:"update",value:function update(_update21){var tree=syntaxTree(_update21.state),highlighters=getHighlighters(_update21.state);var styleChange=highlighters!=getHighlighters(_update21.startState);if(tree.length<_update21.view.viewport.to&&!styleChange&&tree.type==this.tree.type){this.decorations=this.decorations.map(_update21.changes)}else if(tree!=this.tree||_update21.viewportChanged||styleChange){this.tree=tree;this.decorations=this.buildDeco(_update21.view,highlighters)}}},{key:"buildDeco",value:function buildDeco(view,highlighters){var _this252=this;if(!highlighters||!this.tree.length)return Decoration.none;var builder=new RangeSetBuilder;var _iterator369=_createForOfIteratorHelper(view.visibleRanges),_step369;try{for(_iterator369.s();!(_step369=_iterator369.n()).done;){var _step369$value=_step369.value,from=_step369$value.from,to=_step369$value.to;highlightTree(this.tree,highlighters,function(from,to,style){builder.add(from,to,_this252.markCache[style]||(_this252.markCache[style]=Decoration.mark({"class":style})))},from,to)}}catch(err){_iterator369.e(err)}finally{_iterator369.f()}return builder.finish()}}]);return TreeHighlighter}();var treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:function decorations(v){return v.decorations}}));var defaultHighlightStyle=HighlightStyle.define([{tag:tags$1.meta,color:"#404740"},{tag:tags$1.link,textDecoration:"underline"},{tag:tags$1.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags$1.emphasis,fontStyle:"italic"},{tag:tags$1.strong,fontWeight:"bold"},{tag:tags$1.strikethrough,textDecoration:"line-through"},{tag:tags$1.keyword,color:"#708"},{tag:[tags$1.atom,tags$1.bool,tags$1.url,tags$1.contentSeparator,tags$1.labelName],color:"#219"},{tag:[tags$1.literal,tags$1.inserted],color:"#164"},{tag:[tags$1.string,tags$1.deleted],color:"#a11"},{tag:[tags$1.regexp,tags$1.escape,tags$1.special(tags$1.string)],color:"#e40"},{tag:tags$1.definition(tags$1.variableName),color:"#00f"},{tag:tags$1.local(tags$1.variableName),color:"#30a"},{tag:[tags$1.typeName,tags$1.namespace],color:"#085"},{tag:tags$1.className,color:"#167"},{tag:[tags$1.special(tags$1.variableName),tags$1.macroName],color:"#256"},{tag:tags$1.definition(tags$1.propertyName),color:"#00c"},{tag:tags$1.comment,color:"#940"},{tag:tags$1.invalid,color:"#f00"}]);var baseTheme$3=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}});var DefaultScanDist=10000,DefaultBrackets="()[]{}";var bracketMatchingConfig=Facet.define({combine:function combine(configs){return combineConfig(configs,{afterCursor:true,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}});var matchingMark=Decoration.mark({"class":"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({"class":"cm-nonmatchingBracket"});function defaultRenderMatch(match){var decorations=[];var mark=match.matched?matchingMark:nonmatchingMark;decorations.push(mark.range(match.start.from,match.start.to));if(match.end)decorations.push(mark.range(match.end.from,match.end.to));return decorations}var bracketMatchingState=StateField.define({create:function create(){return Decoration.none},update:function update(deco,tr){if(!tr.docChanged&&!tr.selection)return deco;var decorations=[];var config=tr.state.facet(bracketMatchingConfig);var _iterator370=_createForOfIteratorHelper(tr.state.selection.ranges),_step370;try{for(_iterator370.s();!(_step370=_iterator370.n()).done;){var range=_step370.value;if(!range.empty)continue;var match=matchBrackets(tr.state,range.head,-1,config)||range.head>0&&matchBrackets(tr.state,range.head-1,1,config)||config.afterCursor&&(matchBrackets(tr.state,range.head,1,config)||range.head<tr.state.doc.length&&matchBrackets(tr.state,range.head+1,-1,config));if(match)decorations=decorations.concat(config.renderMatch(match,tr.state))}}catch(err){_iterator370.e(err)}finally{_iterator370.f()}return Decoration.set(decorations,true)},provide:function provide(f){return EditorView.decorations.from(f)}});var bracketMatchingUnique=[bracketMatchingState,baseTheme$3];function bracketMatching(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[bracketMatchingConfig.of(config),bracketMatchingUnique]}var bracketMatchingHandle=new NodeProp;function matchingNodes(node,dir,brackets){var byProp=node.prop(dir<0?NodeProp.openedBy:NodeProp.closedBy);if(byProp)return byProp;if(node.name.length==1){var index=brackets.indexOf(node.name);if(index>-1&&index%2==(dir<0?1:0))return[brackets[index+dir]]}return null}function findHandle(node){var hasHandle=node.type.prop(bracketMatchingHandle);return hasHandle?hasHandle(node.node):node}function matchBrackets(state,pos,dir){var config=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var maxScanDistance=config.maxScanDistance||DefaultScanDist,brackets=config.brackets||DefaultBrackets;var tree=syntaxTree(state),node=tree.resolveInner(pos,dir);for(var _cur20=node;_cur20;_cur20=_cur20.parent){var matches=matchingNodes(_cur20.type,dir,brackets);if(matches&&_cur20.from<_cur20.to){var handle=findHandle(_cur20);if(handle&&(dir>0?pos>=handle.from&&pos<handle.to:pos>handle.from&&pos<=handle.to))return matchMarkedBrackets(state,pos,dir,_cur20,handle,matches,brackets)}}return matchPlainBrackets(state,pos,dir,tree,node.type,maxScanDistance,brackets)}function matchMarkedBrackets(_state,_pos,dir,token,handle,matching,brackets){var parent=token.parent,firstToken={from:handle.from,to:handle.to};var depth=0,cursor=parent===null||parent===void 0?void 0:parent.cursor();if(cursor&&(dir<0?cursor.childBefore(token.from):cursor.childAfter(token.to)))do{if(dir<0?cursor.to<=token.from:cursor.from>=token.to){if(depth==0&&matching.indexOf(cursor.type.name)>-1&&cursor.from<cursor.to){var endHandle=findHandle(cursor);return{start:firstToken,end:endHandle?{from:endHandle.from,to:endHandle.to}:undefined,matched:true}}else if(matchingNodes(cursor.type,dir,brackets)){depth++}else if(matchingNodes(cursor.type,-dir,brackets)){if(depth==0){var _endHandle=findHandle(cursor);return{start:firstToken,end:_endHandle&&_endHandle.from<_endHandle.to?{from:_endHandle.from,to:_endHandle.to}:undefined,matched:false}}depth--}}}while(dir<0?cursor.prevSibling():cursor.nextSibling());return{start:firstToken,matched:false}}function matchPlainBrackets(state,pos,dir,tree,tokenType,maxScanDistance,brackets){var startCh=dir<0?state.sliceDoc(pos-1,pos):state.sliceDoc(pos,pos+1);var bracket=brackets.indexOf(startCh);if(bracket<0||bracket%2==0!=dir>0)return null;var startToken={from:dir<0?pos-1:pos,to:dir>0?pos+1:pos};var iter=state.doc.iterRange(pos,dir>0?state.doc.length:0),depth=0;for(var distance=0;!iter.next().done&&distance<=maxScanDistance;){var _text7=iter.value;if(dir<0)distance+=_text7.length;var basePos=pos+distance*dir;for(var _pos4=dir>0?0:_text7.length-1,_end36=dir>0?_text7.length:-1;_pos4!=_end36;_pos4+=dir){var found=brackets.indexOf(_text7[_pos4]);if(found<0||tree.resolveInner(basePos+_pos4,1).type!=tokenType)continue;if(found%2==0==dir>0){depth++}else if(depth==1){return{start:startToken,end:{from:basePos+_pos4,to:basePos+_pos4+1},matched:found>>1==bracket>>1}}else{depth--}}if(dir>0)distance+=_text7.length}return iter.done?{start:startToken,matched:false}:null}var noTokens=Object.create(null);var typeArray=[NodeType.none];var warned=[];var byTag=Object.create(null);var defaultTable=Object.create(null);for(var _i240=0,_arr5=[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]];_i240<_arr5.length;_i240++){var _arr5$_i=_slicedToArray2(_arr5[_i240],2),legacyName=_arr5$_i[0],_name24=_arr5$_i[1];defaultTable[legacyName]=createTokenType(noTokens,_name24)}function warnForPart(part,msg){if(warned.indexOf(part)>-1)return;warned.push(part);console.warn(msg)}function createTokenType(extra,tagStr){var tags$1$1=[];var _iterator371=_createForOfIteratorHelper(tagStr.split(" ")),_step371;try{for(_iterator371.s();!(_step371=_iterator371.n()).done;){var _name25=_step371.value;var found=[];var _iterator372=_createForOfIteratorHelper(_name25.split(".")),_step372;try{for(_iterator372.s();!(_step372=_iterator372.n()).done;){var part=_step372.value;var value=extra[part]||tags$1[part];if(!value){warnForPart(part,"Unknown highlighting tag ".concat(part))}else if(typeof value=="function"){if(!found.length)warnForPart(part,"Modifier ".concat(part," used at start of tag"));else found=found.map(value)}else{if(found.length)warnForPart(part,"Tag ".concat(part," used as modifier"));else found=Array.isArray(value)?value:[value]}}}catch(err){_iterator372.e(err)}finally{_iterator372.f()}var _iterator373=_createForOfIteratorHelper(found),_step373;try{for(_iterator373.s();!(_step373=_iterator373.n()).done;){var tag=_step373.value;tags$1$1.push(tag)}}catch(err){_iterator373.e(err)}finally{_iterator373.f()}}}catch(err){_iterator371.e(err)}finally{_iterator371.f()}if(!tags$1$1.length)return 0;var name=tagStr.replace(/ /g,"_"),key=name+" "+tags$1$1.map(function(t){return t.id});var known=byTag[key];if(known)return known.id;var type=byTag[key]=NodeType.define({id:typeArray.length,name:name,props:[styleTags(_defineProperty2({},name,tags$1$1))]});typeArray.push(type);return type.id}({rtl:Decoration.mark({"class":"cm-iso",inclusive:true,attributes:{dir:"rtl"},bidiIsolate:Direction.RTL}),ltr:Decoration.mark({"class":"cm-iso",inclusive:true,attributes:{dir:"ltr"},bidiIsolate:Direction.LTR}),auto:Decoration.mark({"class":"cm-iso",inclusive:true,attributes:{dir:"auto"},bidiIsolate:null})});var toggleComment=function toggleComment(target){var state=target.state,line=state.doc.lineAt(state.selection.main.from),config=getConfig(target.state,line.from);return config.line?toggleLineComment(target):config.block?toggleBlockCommentByLine(target):false};function command(f,option){return function(_ref235){var state=_ref235.state,dispatch=_ref235.dispatch;if(state.readOnly)return false;var tr=f(option,state);if(!tr)return false;dispatch(state.update(tr));return true}}var toggleLineComment=command(changeLineComment,0);var toggleBlockComment=command(changeBlockComment,0);var toggleBlockCommentByLine=command(function(o,s){return changeBlockComment(o,s,selectedLineRanges(s))},0);function getConfig(state,pos){var data=state.languageDataAt("commentTokens",pos);return data.length?data[0]:{}}var SearchMargin=50;function findBlockComment(state,_ref236,from,to){var open=_ref236.open,close=_ref236.close;var textBefore=state.sliceDoc(from-SearchMargin,from);var textAfter=state.sliceDoc(to,to+SearchMargin);var spaceBefore=/\s*$/.exec(textBefore)[0].length,spaceAfter=/^\s*/.exec(textAfter)[0].length;var beforeOff=textBefore.length-spaceBefore;if(textBefore.slice(beforeOff-open.length,beforeOff)==open&&textAfter.slice(spaceAfter,spaceAfter+close.length)==close){return{open:{pos:from-spaceBefore,margin:spaceBefore&&1},close:{pos:to+spaceAfter,margin:spaceAfter&&1}}}var startText,endText;if(to-from<=2*SearchMargin){startText=endText=state.sliceDoc(from,to)}else{startText=state.sliceDoc(from,from+SearchMargin);endText=state.sliceDoc(to-SearchMargin,to)}var startSpace=/^\s*/.exec(startText)[0].length,endSpace=/\s*$/.exec(endText)[0].length;var endOff=endText.length-endSpace-close.length;if(startText.slice(startSpace,startSpace+open.length)==open&&endText.slice(endOff,endOff+close.length)==close){return{open:{pos:from+startSpace+open.length,margin:/\s/.test(startText.charAt(startSpace+open.length))?1:0},close:{pos:to-endSpace-close.length,margin:/\s/.test(endText.charAt(endOff-1))?1:0}}}return null}function selectedLineRanges(state){var ranges=[];var _iterator374=_createForOfIteratorHelper(state.selection.ranges),_step374;try{for(_iterator374.s();!(_step374=_iterator374.n()).done;){var _r10=_step374.value;var fromLine=state.doc.lineAt(_r10.from);var toLine=_r10.to<=fromLine.to?fromLine:state.doc.lineAt(_r10.to);var last=ranges.length-1;if(last>=0&&ranges[last].to>fromLine.from)ranges[last].to=toLine.to;else ranges.push({from:fromLine.from+/^\s*/.exec(fromLine.text)[0].length,to:toLine.to})}}catch(err){_iterator374.e(err)}finally{_iterator374.f()}return ranges}function changeBlockComment(option,state){var ranges=arguments.length>2&&arguments[2]!==undefined?arguments[2]:state.selection.ranges;var tokens=ranges.map(function(r){return getConfig(state,r.from).block});if(!tokens.every(function(c){return c}))return null;var comments=ranges.map(function(r,i){return findBlockComment(state,tokens[i],r.from,r.to)});if(option!=2&&!comments.every(function(c){return c})){return{changes:state.changes(ranges.map(function(range,i){if(comments[i])return[];return[{from:range.from,insert:tokens[i].open+" "},{from:range.to,insert:" "+tokens[i].close}]}))}}else if(option!=1&&comments.some(function(c){return c})){var changes=[];for(var _i241=0,_comment;_i241<comments.length;_i241++)if(_comment=comments[_i241]){var token=tokens[_i241],_comment2=_comment,open=_comment2.open,close=_comment2.close;changes.push({from:open.pos-token.open.length,to:open.pos+open.margin},{from:close.pos-close.margin,to:close.pos+token.close.length})}return{changes:changes}}return null}function changeLineComment(option,state){var ranges=arguments.length>2&&arguments[2]!==undefined?arguments[2]:state.selection.ranges;var lines=[];var prevLine=-1;var _iterator375=_createForOfIteratorHelper(ranges),_step375;try{for(_iterator375.s();!(_step375=_iterator375.n()).done;){var _step375$value=_step375.value,_from2=_step375$value.from,_to2=_step375$value.to;var startI=lines.length,minIndent=1e9;var _token3=getConfig(state,_from2).line;if(!_token3)continue;for(var pos=_from2;pos<=_to2;){var _line7=state.doc.lineAt(pos);if(_line7.from>prevLine&&(_from2==_to2||_to2>_line7.from)){prevLine=_line7.from;var _indent=/^\s*/.exec(_line7.text)[0].length;var _empty2=_indent==_line7.length;var _comment4=_line7.text.slice(_indent,_indent+_token3.length)==_token3?_indent:-1;if(_indent<_line7.text.length&&_indent<minIndent)minIndent=_indent;lines.push({line:_line7,comment:_comment4,token:_token3,indent:_indent,empty:_empty2,single:false})}pos=_line7.to+1}if(minIndent<1e9)for(var _i242=startI;_i242<lines.length;_i242++)if(lines[_i242].indent<lines[_i242].line.text.length)lines[_i242].indent=minIndent;if(lines.length==startI+1)lines[startI].single=true}}catch(err){_iterator375.e(err)}finally{_iterator375.f()}if(option!=2&&lines.some(function(l){return l.comment<0&&(!l.empty||l.single)})){var changes=[];var _iterator376=_createForOfIteratorHelper(lines),_step376;try{for(_iterator376.s();!(_step376=_iterator376.n()).done;){var _step376$value=_step376.value,line=_step376$value.line,token=_step376$value.token,indent=_step376$value.indent,_empty=_step376$value.empty,single=_step376$value.single;if(single||!_empty)changes.push({from:line.from+indent,insert:token+" "})}}catch(err){_iterator376.e(err)}finally{_iterator376.f()}var changeSet=state.changes(changes);return{changes:changeSet,selection:state.selection.map(changeSet,1)}}else if(option!=1&&lines.some(function(l){return l.comment>=0})){var _changes2=[];var _iterator377=_createForOfIteratorHelper(lines),_step377;try{for(_iterator377.s();!(_step377=_iterator377.n()).done;){var _step377$value=_step377.value,_line6=_step377$value.line,_comment3=_step377$value.comment,_token2=_step377$value.token;if(_comment3>=0){var from=_line6.from+_comment3,to=from+_token2.length;if(_line6.text[to-_line6.from]==" ")to++;_changes2.push({from:from,to:to})}}}catch(err){_iterator377.e(err)}finally{_iterator377.f()}return{changes:_changes2}}return null}var fromHistory=Annotation.define();var isolateHistory=Annotation.define();var invertedEffects=Facet.define();var historyConfig=Facet.define({combine:function combine(configs){return combineConfig(configs,{minDepth:100,newGroupDelay:500,joinToEvent:function joinToEvent(_t,isAdjacent){return isAdjacent}},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:function joinToEvent(a,b){return function(tr,adj){return a(tr,adj)||b(tr,adj)}}})}});var historyField_=StateField.define({create:function create(){return HistoryState.empty},update:function update(state,tr){var config=tr.state.facet(historyConfig);var fromHist=tr.annotation(fromHistory);if(fromHist){var item=HistEvent.fromTransaction(tr,fromHist.selection),from=fromHist.side;var other=from==0?state.undone:state.done;if(item)other=updateBranch(other,other.length,config.minDepth,item);else other=_addSelection(other,tr.startState.selection);return new HistoryState(from==0?fromHist.rest:other,from==0?other:fromHist.rest)}var isolate=tr.annotation(isolateHistory);if(isolate=="full"||isolate=="before")state=state.isolate();if(tr.annotation(Transaction.addToHistory)===false)return!tr.changes.empty?state.addMapping(tr.changes.desc):state;var event=HistEvent.fromTransaction(tr);var time=tr.annotation(Transaction.time),userEvent=tr.annotation(Transaction.userEvent);if(event)state=state.addChanges(event,time,userEvent,config,tr);else if(tr.selection)state=state.addSelection(tr.startState.selection,time,userEvent,config.newGroupDelay);if(isolate=="full"||isolate=="after")state=state.isolate();return state},toJSON:function toJSON(value){return{done:value.done.map(function(e){return e.toJSON()}),undone:value.undone.map(function(e){return e.toJSON()})}},fromJSON:function fromJSON(json){return new HistoryState(json.done.map(HistEvent.fromJSON),json.undone.map(HistEvent.fromJSON))}});function history(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[historyField_,historyConfig.of(config),EditorView.domEventHandlers({beforeinput:function beforeinput(e,view){var command=e.inputType=="historyUndo"?undo:e.inputType=="historyRedo"?redo:null;if(!command)return false;e.preventDefault();return command(view)}})]}function cmd(side,selection){return function(_ref237){var state=_ref237.state,dispatch=_ref237.dispatch;if(!selection&&state.readOnly)return false;var historyState=state.field(historyField_,false);if(!historyState)return false;var tr=historyState.pop(side,state,selection);if(!tr)return false;dispatch(tr);return true}}var undo=cmd(0,false);var redo=cmd(1,false);var undoSelection=cmd(0,true);var redoSelection=cmd(1,true);var HistEvent=function(){function HistEvent(changes,effects,mapped,startSelection,selectionsAfter){_classCallCheck2(this,HistEvent);this.changes=changes;this.effects=effects;this.mapped=mapped;this.startSelection=startSelection;this.selectionsAfter=selectionsAfter}_createClass2(HistEvent,[{key:"setSelAfter",value:function setSelAfter(after){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,after)}},{key:"toJSON",value:function toJSON(){var _a,_b,_c;return{changes:(_a=this.changes)===null||_a===void 0?void 0:_a.toJSON(),mapped:(_b=this.mapped)===null||_b===void 0?void 0:_b.toJSON(),startSelection:(_c=this.startSelection)===null||_c===void 0?void 0:_c.toJSON(),selectionsAfter:this.selectionsAfter.map(function(s){return s.toJSON()})}}}],[{key:"fromJSON",value:function fromJSON(json){return new HistEvent(json.changes&&ChangeSet.fromJSON(json.changes),[],json.mapped&&ChangeDesc.fromJSON(json.mapped),json.startSelection&&EditorSelection.fromJSON(json.startSelection),json.selectionsAfter.map(EditorSelection.fromJSON))}},{key:"fromTransaction",value:function fromTransaction(tr,selection){var effects=none$2;var _iterator378=_createForOfIteratorHelper(tr.startState.facet(invertedEffects)),_step378;try{for(_iterator378.s();!(_step378=_iterator378.n()).done;){var invert=_step378.value;var result=invert(tr);if(result.length)effects=effects.concat(result)}}catch(err){_iterator378.e(err)}finally{_iterator378.f()}if(!effects.length&&tr.changes.empty)return null;return new HistEvent(tr.changes.invert(tr.startState.doc),effects,undefined,selection||tr.startState.selection,none$2)}},{key:"selection",value:function selection(selections){return new HistEvent(undefined,none$2,undefined,undefined,selections)}}]);return HistEvent}();function updateBranch(branch,to,maxLen,newEvent){var start=to+1>maxLen+20?to-maxLen-1:0;var newBranch=branch.slice(start,to);newBranch.push(newEvent);return newBranch}function isAdjacent(a,b){var ranges=[],isAdjacent=false;a.iterChangedRanges(function(f,t){return ranges.push(f,t)});b.iterChangedRanges(function(_f,_t,f,t){for(var _i243=0;_i243<ranges.length;){var from=ranges[_i243++],to=ranges[_i243++];if(t>=from&&f<=to)isAdjacent=true}});return isAdjacent}function eqSelectionShape(a,b){return a.ranges.length==b.ranges.length&&a.ranges.filter(function(r,i){return r.empty!=b.ranges[i].empty}).length===0}function conc(a,b){return!a.length?b:!b.length?a:a.concat(b)}var none$2=[];var MaxSelectionsPerEvent=200;function _addSelection(branch,selection){if(!branch.length){return[HistEvent.selection([selection])]}else{var lastEvent=branch[branch.length-1];var sels=lastEvent.selectionsAfter.slice(Math.max(0,lastEvent.selectionsAfter.length-MaxSelectionsPerEvent));if(sels.length&&sels[sels.length-1].eq(selection))return branch;sels.push(selection);return updateBranch(branch,branch.length-1,1e9,lastEvent.setSelAfter(sels))}}function popSelection(branch){var last=branch[branch.length-1];var newBranch=branch.slice();newBranch[branch.length-1]=last.setSelAfter(last.selectionsAfter.slice(0,last.selectionsAfter.length-1));return newBranch}function addMappingToBranch(branch,mapping){if(!branch.length)return branch;var length=branch.length,selections=none$2;while(length){var event=mapEvent(branch[length-1],mapping,selections);if(event.changes&&!event.changes.empty||event.effects.length){var result=branch.slice(0,length);result[length-1]=event;return result}else{mapping=event.mapped;length--;selections=event.selectionsAfter}}return selections.length?[HistEvent.selection(selections)]:none$2}function mapEvent(event,mapping,extraSelections){var selections=conc(event.selectionsAfter.length?event.selectionsAfter.map(function(s){return s.map(mapping)}):none$2,extraSelections);if(!event.changes)return HistEvent.selection(selections);var mappedChanges=event.changes.map(mapping),before=mapping.mapDesc(event.changes,true);var fullMapping=event.mapped?event.mapped.composeDesc(before):before;return new HistEvent(mappedChanges,StateEffect.mapEffects(event.effects,mapping),fullMapping,event.startSelection.map(before),selections)}var joinableUserEvent=/^(input\.type|delete)($|\.)/;var HistoryState=function(){function HistoryState(done,undone){var prevTime=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var prevUserEvent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:undefined;_classCallCheck2(this,HistoryState);this.done=done;this.undone=undone;this.prevTime=prevTime;this.prevUserEvent=prevUserEvent}_createClass2(HistoryState,[{key:"isolate",value:function isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}},{key:"addChanges",value:function addChanges(event,time,userEvent,config,tr){var done=this.done,lastEvent=done[done.length-1];if(lastEvent&&lastEvent.changes&&!lastEvent.changes.empty&&event.changes&&(!userEvent||joinableUserEvent.test(userEvent))&&(!lastEvent.selectionsAfter.length&&time-this.prevTime<config.newGroupDelay&&config.joinToEvent(tr,isAdjacent(lastEvent.changes,event.changes))||userEvent=="input.type.compose")){done=updateBranch(done,done.length-1,config.minDepth,new HistEvent(event.changes.compose(lastEvent.changes),conc(event.effects,lastEvent.effects),lastEvent.mapped,lastEvent.startSelection,none$2))}else{done=updateBranch(done,done.length,config.minDepth,event)}return new HistoryState(done,none$2,time,userEvent)}},{key:"addSelection",value:function addSelection(selection,time,userEvent,newGroupDelay){var last=this.done.length?this.done[this.done.length-1].selectionsAfter:none$2;if(last.length>0&&time-this.prevTime<newGroupDelay&&userEvent==this.prevUserEvent&&userEvent&&/^select($|\.)/.test(userEvent)&&eqSelectionShape(last[last.length-1],selection))return this;return new HistoryState(_addSelection(this.done,selection),this.undone,time,userEvent)}},{key:"addMapping",value:function addMapping(mapping){return new HistoryState(addMappingToBranch(this.done,mapping),addMappingToBranch(this.undone,mapping),this.prevTime,this.prevUserEvent)}},{key:"pop",value:function pop(side,state,onlySelection){var branch=side==0?this.done:this.undone;if(branch.length==0)return null;var event=branch[branch.length-1],selection=event.selectionsAfter[0]||state.selection;if(onlySelection&&event.selectionsAfter.length){return state.update({selection:event.selectionsAfter[event.selectionsAfter.length-1],annotations:fromHistory.of({side:side,rest:popSelection(branch),selection:selection}),userEvent:side==0?"select.undo":"select.redo",scrollIntoView:true})}else if(!event.changes){return null}else{var rest=branch.length==1?none$2:branch.slice(0,branch.length-1);if(event.mapped)rest=addMappingToBranch(rest,event.mapped);return state.update({changes:event.changes,selection:event.startSelection,effects:event.effects,annotations:fromHistory.of({side:side,rest:rest,selection:selection}),filter:false,userEvent:side==0?"undo":"redo",scrollIntoView:true})}}}]);return HistoryState}();HistoryState.empty=new HistoryState(none$2,none$2);var historyKeymap=[{key:"Mod-z",run:undo,preventDefault:true},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:true},{linux:"Ctrl-Shift-z",run:redo,preventDefault:true},{key:"Mod-u",run:undoSelection,preventDefault:true},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:true}];function updateSel(sel,by){return EditorSelection.create(sel.ranges.map(by),sel.mainIndex)}function setSel(state,selection){return state.update({selection:selection,scrollIntoView:true,userEvent:"select"})}function moveSel(_ref238,how){var state=_ref238.state,dispatch=_ref238.dispatch;var selection=updateSel(state.selection,how);if(selection.eq(state.selection,true))return false;dispatch(setSel(state,selection));return true}function rangeEnd(range,forward){return EditorSelection.cursor(forward?range.to:range.from)}function cursorByChar(view,forward){return moveSel(view,function(range){return range.empty?view.moveByChar(range,forward):rangeEnd(range,forward)})}function ltrAtCursor(view){return view.textDirectionAt(view.state.selection.main.head)==Direction.LTR}var cursorCharLeft=function cursorCharLeft(view){return cursorByChar(view,!ltrAtCursor(view))};var cursorCharRight=function cursorCharRight(view){return cursorByChar(view,ltrAtCursor(view))};function cursorByGroup(view,forward){return moveSel(view,function(range){return range.empty?view.moveByGroup(range,forward):rangeEnd(range,forward)})}var cursorGroupLeft=function cursorGroupLeft(view){return cursorByGroup(view,!ltrAtCursor(view))};var cursorGroupRight=function cursorGroupRight(view){return cursorByGroup(view,ltrAtCursor(view))};function interestingNode(state,node,bracketProp){if(node.type.prop(bracketProp))return true;var len=node.to-node.from;return len&&(len>2||/[^\s,.;:]/.test(state.sliceDoc(node.from,node.to)))||node.firstChild}function moveBySyntax(state,start,forward){var pos=syntaxTree(state).resolveInner(start.head);var bracketProp=forward?NodeProp.closedBy:NodeProp.openedBy;for(var at=start.head;;){var next=forward?pos.childAfter(at):pos.childBefore(at);if(!next)break;if(interestingNode(state,next,bracketProp))pos=next;else at=forward?next.to:next.from}var bracket=pos.type.prop(bracketProp),match,newPos;if(bracket&&(match=forward?matchBrackets(state,pos.from,1):matchBrackets(state,pos.to,-1))&&match.matched)newPos=forward?match.end.to:match.end.from;else newPos=forward?pos.to:pos.from;return EditorSelection.cursor(newPos,forward?-1:1)}var cursorSyntaxLeft=function cursorSyntaxLeft(view){return moveSel(view,function(range){return moveBySyntax(view.state,range,!ltrAtCursor(view))})};var cursorSyntaxRight=function cursorSyntaxRight(view){return moveSel(view,function(range){return moveBySyntax(view.state,range,ltrAtCursor(view))})};function cursorByLine(view,forward){return moveSel(view,function(range){if(!range.empty)return rangeEnd(range,forward);var moved=view.moveVertically(range,forward);return moved.head!=range.head?moved:view.moveToLineBoundary(range,forward)})}var cursorLineUp=function cursorLineUp(view){return cursorByLine(view,false)};var cursorLineDown=function cursorLineDown(view){return cursorByLine(view,true)};function pageInfo(view){var selfScroll=view.scrollDOM.clientHeight<view.scrollDOM.scrollHeight-2;var marginTop=0,marginBottom=0,height;if(selfScroll){var _iterator379=_createForOfIteratorHelper(view.state.facet(EditorView.scrollMargins)),_step379;try{for(_iterator379.s();!(_step379=_iterator379.n()).done;){var source=_step379.value;var margins=source(view);if(margins===null||margins===void 0?void 0:margins.top)marginTop=Math.max(margins===null||margins===void 0?void 0:margins.top,marginTop);if(margins===null||margins===void 0?void 0:margins.bottom)marginBottom=Math.max(margins===null||margins===void 0?void 0:margins.bottom,marginBottom)}}catch(err){_iterator379.e(err)}finally{_iterator379.f()}height=view.scrollDOM.clientHeight-marginTop-marginBottom}else{height=(view.dom.ownerDocument.defaultView||window).innerHeight}return{marginTop:marginTop,marginBottom:marginBottom,selfScroll:selfScroll,height:Math.max(view.defaultLineHeight,height-5)}}function cursorByPage(view,forward){var page=pageInfo(view);var state=view.state,selection=updateSel(state.selection,function(range){return range.empty?view.moveVertically(range,forward,page.height):rangeEnd(range,forward)});if(selection.eq(state.selection))return false;var effect;if(page.selfScroll){var startPos=view.coordsAtPos(state.selection.main.head);var scrollRect=view.scrollDOM.getBoundingClientRect();var scrollTop=scrollRect.top+page.marginTop,scrollBottom=scrollRect.bottom-page.marginBottom;if(startPos&&startPos.top>scrollTop&&startPos.bottom<scrollBottom)effect=EditorView.scrollIntoView(selection.main.head,{y:"start",yMargin:startPos.top-scrollTop})}view.dispatch(setSel(state,selection),{effects:effect});return true}var cursorPageUp=function cursorPageUp(view){return cursorByPage(view,false)};var cursorPageDown=function cursorPageDown(view){return cursorByPage(view,true)};function moveByLineBoundary(view,start,forward){var line=view.lineBlockAt(start.head),moved=view.moveToLineBoundary(start,forward);if(moved.head==start.head&&moved.head!=(forward?line.to:line.from))moved=view.moveToLineBoundary(start,forward,false);if(!forward&&moved.head==line.from&&line.length){var _space=/^\s*/.exec(view.state.sliceDoc(line.from,Math.min(line.from+100,line.to)))[0].length;if(_space&&start.head!=line.from+_space)moved=EditorSelection.cursor(line.from+_space)}return moved}var cursorLineBoundaryForward=function cursorLineBoundaryForward(view){return moveSel(view,function(range){return moveByLineBoundary(view,range,true)})};var cursorLineBoundaryBackward=function cursorLineBoundaryBackward(view){return moveSel(view,function(range){return moveByLineBoundary(view,range,false)})};var cursorLineBoundaryLeft=function cursorLineBoundaryLeft(view){return moveSel(view,function(range){return moveByLineBoundary(view,range,!ltrAtCursor(view))})};var cursorLineBoundaryRight=function cursorLineBoundaryRight(view){return moveSel(view,function(range){return moveByLineBoundary(view,range,ltrAtCursor(view))})};var cursorLineStart=function cursorLineStart(view){return moveSel(view,function(range){return EditorSelection.cursor(view.lineBlockAt(range.head).from,1)})};var cursorLineEnd=function cursorLineEnd(view){return moveSel(view,function(range){return EditorSelection.cursor(view.lineBlockAt(range.head).to,-1)})};function toMatchingBracket(state,dispatch,extend){var found=false,selection=updateSel(state.selection,function(range){var matching=matchBrackets(state,range.head,-1)||matchBrackets(state,range.head,1)||range.head>0&&matchBrackets(state,range.head-1,1)||range.head<state.doc.length&&matchBrackets(state,range.head+1,-1);if(!matching||!matching.end)return range;found=true;var head=matching.start.from==range.head?matching.end.to:matching.end.from;return extend?EditorSelection.range(range.anchor,head):EditorSelection.cursor(head)});if(!found)return false;dispatch(setSel(state,selection));return true}var cursorMatchingBracket=function cursorMatchingBracket(_ref239){var state=_ref239.state,dispatch=_ref239.dispatch;return toMatchingBracket(state,dispatch,false)};function extendSel(view,how){var selection=updateSel(view.state.selection,function(range){var head=how(range);return EditorSelection.range(range.anchor,head.head,head.goalColumn,head.bidiLevel||undefined)});if(selection.eq(view.state.selection))return false;view.dispatch(setSel(view.state,selection));return true}function selectByChar(view,forward){return extendSel(view,function(range){return view.moveByChar(range,forward)})}var selectCharLeft=function selectCharLeft(view){return selectByChar(view,!ltrAtCursor(view))};var selectCharRight=function selectCharRight(view){return selectByChar(view,ltrAtCursor(view))};function selectByGroup(view,forward){return extendSel(view,function(range){return view.moveByGroup(range,forward)})}var selectGroupLeft=function selectGroupLeft(view){return selectByGroup(view,!ltrAtCursor(view))};var selectGroupRight=function selectGroupRight(view){return selectByGroup(view,ltrAtCursor(view))};var selectSyntaxLeft=function selectSyntaxLeft(view){return extendSel(view,function(range){return moveBySyntax(view.state,range,!ltrAtCursor(view))})};var selectSyntaxRight=function selectSyntaxRight(view){return extendSel(view,function(range){return moveBySyntax(view.state,range,ltrAtCursor(view))})};function selectByLine(view,forward){return extendSel(view,function(range){return view.moveVertically(range,forward)})}var selectLineUp=function selectLineUp(view){return selectByLine(view,false)};var selectLineDown=function selectLineDown(view){return selectByLine(view,true)};function selectByPage(view,forward){return extendSel(view,function(range){return view.moveVertically(range,forward,pageInfo(view).height)})}var selectPageUp=function selectPageUp(view){return selectByPage(view,false)};var selectPageDown=function selectPageDown(view){return selectByPage(view,true)};var selectLineBoundaryForward=function selectLineBoundaryForward(view){return extendSel(view,function(range){return moveByLineBoundary(view,range,true)})};var selectLineBoundaryBackward=function selectLineBoundaryBackward(view){return extendSel(view,function(range){return moveByLineBoundary(view,range,false)})};var selectLineBoundaryLeft=function selectLineBoundaryLeft(view){return extendSel(view,function(range){return moveByLineBoundary(view,range,!ltrAtCursor(view))})};var selectLineBoundaryRight=function selectLineBoundaryRight(view){return extendSel(view,function(range){return moveByLineBoundary(view,range,ltrAtCursor(view))})};var selectLineStart=function selectLineStart(view){return extendSel(view,function(range){return EditorSelection.cursor(view.lineBlockAt(range.head).from)})};var selectLineEnd=function selectLineEnd(view){return extendSel(view,function(range){return EditorSelection.cursor(view.lineBlockAt(range.head).to)})};var cursorDocStart=function cursorDocStart(_ref240){var state=_ref240.state,dispatch=_ref240.dispatch;dispatch(setSel(state,{anchor:0}));return true};var cursorDocEnd=function cursorDocEnd(_ref241){var state=_ref241.state,dispatch=_ref241.dispatch;dispatch(setSel(state,{anchor:state.doc.length}));return true};var selectDocStart=function selectDocStart(_ref242){var state=_ref242.state,dispatch=_ref242.dispatch;dispatch(setSel(state,{anchor:state.selection.main.anchor,head:0}));return true};var selectDocEnd=function selectDocEnd(_ref243){var state=_ref243.state,dispatch=_ref243.dispatch;dispatch(setSel(state,{anchor:state.selection.main.anchor,head:state.doc.length}));return true};var selectAll=function selectAll(_ref244){var state=_ref244.state,dispatch=_ref244.dispatch;dispatch(state.update({selection:{anchor:0,head:state.doc.length},userEvent:"select"}));return true};var selectLine=function selectLine(_ref245){var state=_ref245.state,dispatch=_ref245.dispatch;var ranges=selectedLineBlocks(state).map(function(_ref246){var from=_ref246.from,to=_ref246.to;return EditorSelection.range(from,Math.min(to+1,state.doc.length))});dispatch(state.update({selection:EditorSelection.create(ranges),userEvent:"select"}));return true};var selectParentSyntax=function selectParentSyntax(_ref247){var state=_ref247.state,dispatch=_ref247.dispatch;var selection=updateSel(state.selection,function(range){var _a;var stack=syntaxTree(state).resolveStack(range.from,1);for(var _cur21=stack;_cur21;_cur21=_cur21.next){var _cur22=_cur21,node=_cur22.node;if((node.from<range.from&&node.to>=range.to||node.to>range.to&&node.from<=range.from)&&((_a=node.parent)===null||_a===void 0?void 0:_a.parent))return EditorSelection.range(node.to,node.from)}return range});dispatch(setSel(state,selection));return true};var simplifySelection=function simplifySelection(_ref248){var state=_ref248.state,dispatch=_ref248.dispatch;var cur=state.selection,selection=null;if(cur.ranges.length>1)selection=EditorSelection.create([cur.main]);else if(!cur.main.empty)selection=EditorSelection.create([EditorSelection.cursor(cur.main.head)]);if(!selection)return false;dispatch(setSel(state,selection));return true};function deleteBy(target,by){if(target.state.readOnly)return false;var event="delete.selection",state=target.state;var changes=state.changeByRange(function(range){var from=range.from,to=range.to;if(from==to){var towards=by(range);if(towards<from){event="delete.backward";towards=skipAtomic(target,towards,false)}else if(towards>from){event="delete.forward";towards=skipAtomic(target,towards,true)}from=Math.min(from,towards);to=Math.max(to,towards)}else{from=skipAtomic(target,from,false);to=skipAtomic(target,to,true)}return from==to?{range:range}:{changes:{from:from,to:to},range:EditorSelection.cursor(from,from<range.head?-1:1)}});if(changes.changes.empty)return false;target.dispatch(state.update(changes,{scrollIntoView:true,userEvent:event,effects:event=="delete.selection"?EditorView.announce.of(state.phrase("Selection deleted")):undefined}));return true}function skipAtomic(target,pos,forward){if(target instanceof EditorView){var _iterator380=_createForOfIteratorHelper(target.state.facet(EditorView.atomicRanges).map(function(f){return f(target)})),_step380;try{for(_iterator380.s();!(_step380=_iterator380.n()).done;){var ranges=_step380.value;ranges.between(pos,pos,function(from,to){if(from<pos&&to>pos)pos=forward?to:from})}}catch(err){_iterator380.e(err)}finally{_iterator380.f()}}return pos}var deleteByChar=function deleteByChar(target,forward){return deleteBy(target,function(range){var pos=range.from,state=target.state,line=state.doc.lineAt(pos),before,targetPos;if(!forward&&pos>line.from&&pos<line.from+200&&!/[^ \t]/.test(before=line.text.slice(0,pos-line.from))){if(before[before.length-1]=="\t")return pos-1;var col=_countColumn(before,state.tabSize),drop=col%getIndentUnit(state)||getIndentUnit(state);for(var _i244=0;_i244<drop&&before[before.length-1-_i244]==" ";_i244++)pos--;targetPos=pos}else{targetPos=findClusterBreak(line.text,pos-line.from,forward,forward)+line.from;if(targetPos==pos&&line.number!=(forward?state.doc.lines:1))targetPos+=forward?1:-1;else if(!forward&&/[\ufe00-\ufe0f]/.test(line.text.slice(targetPos-line.from,pos-line.from)))targetPos=findClusterBreak(line.text,targetPos-line.from,false,false)+line.from}return targetPos})};var deleteCharBackward=function deleteCharBackward(view){return deleteByChar(view,false)};var deleteCharForward=function deleteCharForward(view){return deleteByChar(view,true)};var deleteByGroup=function deleteByGroup(target,forward){return deleteBy(target,function(range){var pos=range.head,state=target.state,line=state.doc.lineAt(pos);var categorize=state.charCategorizer(pos);for(var cat=null;;){if(pos==(forward?line.to:line.from)){if(pos==range.head&&line.number!=(forward?state.doc.lines:1))pos+=forward?1:-1;break}var next=findClusterBreak(line.text,pos-line.from,forward)+line.from;var _nextChar=line.text.slice(Math.min(pos,next)-line.from,Math.max(pos,next)-line.from);var nextCat=categorize(_nextChar);if(cat!=null&&nextCat!=cat)break;if(_nextChar!=" "||pos!=range.head)cat=nextCat;pos=next}return pos})};var deleteGroupBackward=function deleteGroupBackward(target){return deleteByGroup(target,false)};var deleteGroupForward=function deleteGroupForward(target){return deleteByGroup(target,true)};var deleteToLineEnd=function deleteToLineEnd(view){return deleteBy(view,function(range){var lineEnd=view.lineBlockAt(range.head).to;return range.head<lineEnd?lineEnd:Math.min(view.state.doc.length,range.head+1)})};var deleteLineBoundaryBackward=function deleteLineBoundaryBackward(view){return deleteBy(view,function(range){var lineStart=view.moveToLineBoundary(range,false).head;return range.head>lineStart?lineStart:Math.max(0,range.head-1)})};var deleteLineBoundaryForward=function deleteLineBoundaryForward(view){return deleteBy(view,function(range){var lineStart=view.moveToLineBoundary(range,true).head;return range.head<lineStart?lineStart:Math.min(view.state.doc.length,range.head+1)})};var splitLine=function splitLine(_ref249){var state=_ref249.state,dispatch=_ref249.dispatch;if(state.readOnly)return false;var changes=state.changeByRange(function(range){return{changes:{from:range.from,to:range.to,insert:Text.of(["",""])},range:EditorSelection.cursor(range.from)}});dispatch(state.update(changes,{scrollIntoView:true,userEvent:"input"}));return true};var transposeChars=function transposeChars(_ref250){var state=_ref250.state,dispatch=_ref250.dispatch;if(state.readOnly)return false;var changes=state.changeByRange(function(range){if(!range.empty||range.from==0||range.from==state.doc.length)return{range:range};var pos=range.from,line=state.doc.lineAt(pos);var from=pos==line.from?pos-1:findClusterBreak(line.text,pos-line.from,false)+line.from;var to=pos==line.to?pos+1:findClusterBreak(line.text,pos-line.from,true)+line.from;return{changes:{from:from,to:to,insert:state.doc.slice(pos,to).append(state.doc.slice(from,pos))},range:EditorSelection.cursor(to)}});if(changes.changes.empty)return false;dispatch(state.update(changes,{scrollIntoView:true,userEvent:"move.character"}));return true};function selectedLineBlocks(state){var blocks=[],upto=-1;var _iterator381=_createForOfIteratorHelper(state.selection.ranges),_step381;try{for(_iterator381.s();!(_step381=_iterator381.n()).done;){var range=_step381.value;var startLine=state.doc.lineAt(range.from),endLine=state.doc.lineAt(range.to);if(!range.empty&&range.to==endLine.from)endLine=state.doc.lineAt(range.to-1);if(upto>=startLine.number){var prev=blocks[blocks.length-1];prev.to=endLine.to;prev.ranges.push(range)}else{blocks.push({from:startLine.from,to:endLine.to,ranges:[range]})}upto=endLine.number+1}}catch(err){_iterator381.e(err)}finally{_iterator381.f()}return blocks}function moveLine(state,dispatch,forward){if(state.readOnly)return false;var changes=[],ranges=[];var _iterator382=_createForOfIteratorHelper(selectedLineBlocks(state)),_step382;try{for(_iterator382.s();!(_step382=_iterator382.n()).done;){var block=_step382.value;if(forward?block.to==state.doc.length:block.from==0)continue;var nextLine=state.doc.lineAt(forward?block.to+1:block.from-1);var size=nextLine.length+1;if(forward){changes.push({from:block.to,to:nextLine.to},{from:block.from,insert:nextLine.text+state.lineBreak});var _iterator383=_createForOfIteratorHelper(block.ranges),_step383;try{for(_iterator383.s();!(_step383=_iterator383.n()).done;){var _r11=_step383.value;ranges.push(EditorSelection.range(Math.min(state.doc.length,_r11.anchor+size),Math.min(state.doc.length,_r11.head+size)))}}catch(err){_iterator383.e(err)}finally{_iterator383.f()}}else{changes.push({from:nextLine.from,to:block.from},{from:block.to,insert:state.lineBreak+nextLine.text});var _iterator384=_createForOfIteratorHelper(block.ranges),_step384;try{for(_iterator384.s();!(_step384=_iterator384.n()).done;){var _r12=_step384.value;ranges.push(EditorSelection.range(_r12.anchor-size,_r12.head-size))}}catch(err){_iterator384.e(err)}finally{_iterator384.f()}}}}catch(err){_iterator382.e(err)}finally{_iterator382.f()}if(!changes.length)return false;dispatch(state.update({changes:changes,scrollIntoView:true,selection:EditorSelection.create(ranges,state.selection.mainIndex),userEvent:"move.line"}));return true}var moveLineUp=function moveLineUp(_ref251){var state=_ref251.state,dispatch=_ref251.dispatch;return moveLine(state,dispatch,false)};var moveLineDown=function moveLineDown(_ref252){var state=_ref252.state,dispatch=_ref252.dispatch;return moveLine(state,dispatch,true)};function copyLine(state,dispatch,forward){if(state.readOnly)return false;var changes=[];var _iterator385=_createForOfIteratorHelper(selectedLineBlocks(state)),_step385;try{for(_iterator385.s();!(_step385=_iterator385.n()).done;){var block=_step385.value;if(forward)changes.push({from:block.from,insert:state.doc.slice(block.from,block.to)+state.lineBreak});else changes.push({from:block.to,insert:state.lineBreak+state.doc.slice(block.from,block.to)})}}catch(err){_iterator385.e(err)}finally{_iterator385.f()}dispatch(state.update({changes:changes,scrollIntoView:true,userEvent:"input.copyline"}));return true}var copyLineUp=function copyLineUp(_ref253){var state=_ref253.state,dispatch=_ref253.dispatch;return copyLine(state,dispatch,false)};var copyLineDown=function copyLineDown(_ref254){var state=_ref254.state,dispatch=_ref254.dispatch;return copyLine(state,dispatch,true)};var deleteLine=function deleteLine(view){if(view.state.readOnly)return false;var state=view.state,changes=state.changes(selectedLineBlocks(state).map(function(_ref255){var from=_ref255.from,to=_ref255.to;if(from>0)from--;else if(to<state.doc.length)to++;return{from:from,to:to}}));var selection=updateSel(state.selection,function(range){return view.moveVertically(range,true)}).map(changes);view.dispatch({changes:changes,selection:selection,scrollIntoView:true,userEvent:"delete.line"});return true};function isBetweenBrackets(state,pos){if(/\(\)|\[\]|\{\}/.test(state.sliceDoc(pos-1,pos+1)))return{from:pos,to:pos};var context=syntaxTree(state).resolveInner(pos);var before=context.childBefore(pos),after=context.childAfter(pos),closedBy;if(before&&after&&before.to<=pos&&after.from>=pos&&(closedBy=before.type.prop(NodeProp.closedBy))&&closedBy.indexOf(after.name)>-1&&state.doc.lineAt(before.to).from==state.doc.lineAt(after.from).from&&!/\S/.test(state.sliceDoc(before.to,after.from)))return{from:before.to,to:after.from};return null}var insertNewlineAndIndent=newlineAndIndent(false);var insertBlankLine=newlineAndIndent(true);function newlineAndIndent(atEof){return function(_ref256){var state=_ref256.state,dispatch=_ref256.dispatch;if(state.readOnly)return false;var changes=state.changeByRange(function(range){var from=range.from,to=range.to,line=state.doc.lineAt(from);var explode=!atEof&&from==to&&isBetweenBrackets(state,from);if(atEof)from=to=(to<=line.to?line:state.doc.lineAt(to)).to;var cx=new IndentContext(state,{simulateBreak:from,simulateDoubleBreak:!!explode});var indent=getIndentation(cx,from);if(indent==null)indent=_countColumn(/^\s*/.exec(state.doc.lineAt(from).text)[0],state.tabSize);while(to<line.to&&/\s/.test(line.text[to-line.from]))to++;if(explode){from=explode.from;to=explode.to}else if(from>line.from&&from<line.from+100&&!/\S/.test(line.text.slice(0,from)))from=line.from;var insert=["",indentString(state,indent)];if(explode)insert.push(indentString(state,cx.lineIndent(line.from,-1)));return{changes:{from:from,to:to,insert:Text.of(insert)},range:EditorSelection.cursor(from+1+insert[1].length)}});dispatch(state.update(changes,{scrollIntoView:true,userEvent:"input"}));return true}}function changeBySelectedLine(state,f){var atLine=-1;return state.changeByRange(function(range){var changes=[];for(var pos=range.from;pos<=range.to;){var line=state.doc.lineAt(pos);if(line.number>atLine&&(range.empty||range.to>line.from)){f(line,changes,range);atLine=line.number}pos=line.to+1}var changeSet=state.changes(changes);return{changes:changes,range:EditorSelection.range(changeSet.mapPos(range.anchor,1),changeSet.mapPos(range.head,1))}})}var indentSelection=function indentSelection(_ref257){var state=_ref257.state,dispatch=_ref257.dispatch;if(state.readOnly)return false;var updated=Object.create(null);var context=new IndentContext(state,{overrideIndentation:function overrideIndentation(start){var found=updated[start];return found==null?-1:found}});var changes=changeBySelectedLine(state,function(line,changes,range){var indent=getIndentation(context,line.from);if(indent==null)return;if(!/\S/.test(line.text))indent=0;var cur=/^\s*/.exec(line.text)[0];var norm=indentString(state,indent);if(cur!=norm||range.from<line.from+cur.length){updated[line.from]=indent;changes.push({from:line.from,to:line.from+cur.length,insert:norm})}});if(!changes.changes.empty)dispatch(state.update(changes,{userEvent:"indent"}));return true};var indentMore=function indentMore(_ref258){var state=_ref258.state,dispatch=_ref258.dispatch;if(state.readOnly)return false;dispatch(state.update(changeBySelectedLine(state,function(line,changes){changes.push({from:line.from,insert:state.facet(indentUnit)})}),{userEvent:"input.indent"}));return true};var indentLess=function indentLess(_ref259){var state=_ref259.state,dispatch=_ref259.dispatch;if(state.readOnly)return false;dispatch(state.update(changeBySelectedLine(state,function(line,changes){var space=/^\s*/.exec(line.text)[0];if(!space)return;var col=_countColumn(space,state.tabSize),keep=0;var insert=indentString(state,Math.max(0,col-getIndentUnit(state)));while(keep<space.length&&keep<insert.length&&space.charCodeAt(keep)==insert.charCodeAt(keep))keep++;changes.push({from:line.from+keep,to:line.from+space.length,insert:insert.slice(keep)})}),{userEvent:"delete.dedent"}));return true};var emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:true},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}];var standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:true},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:true},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:true},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:true},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:true},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:true},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:true},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:true},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:true},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:true},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteLineBoundaryBackward},{mac:"Mod-Delete",run:deleteLineBoundaryForward}].concat(emacsStyleKeymap.map(function(b){return{mac:b.key,run:b.run,shift:b.shift}}));var defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:true},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment}].concat(standardKeymap);var indentWithTab={key:"Tab",run:indentMore,shift:indentLess};function crelt(){var elt=arguments[0];if(typeof elt=="string")elt=document.createElement(elt);var i=1,next=arguments[1];if(next&&_typeof2(next)=="object"&&next.nodeType==null&&!Array.isArray(next)){for(var name in next)if(Object.prototype.hasOwnProperty.call(next,name)){var value=next[name];if(typeof value=="string")elt.setAttribute(name,value);else if(value!=null)elt[name]=value}i++}for(;i<arguments.length;i++)add(elt,arguments[i]);return elt}function add(elt,child){if(typeof child=="string"){elt.appendChild(document.createTextNode(child))}else if(child==null);else if(child.nodeType!=null){elt.appendChild(child)}else if(Array.isArray(child)){for(var i=0;i<child.length;i++)add(elt,child[i])}else{throw new RangeError("Unsupported child node: "+child)}}var basicNormalize=typeof String.prototype.normalize=="function"?function(x){return x.normalize("NFKD")}:function(x){return x};var SearchCursor=function(){function SearchCursor(text,query){var from=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var to=arguments.length>3&&arguments[3]!==undefined?arguments[3]:text.length;var normalize=arguments.length>4?arguments[4]:undefined;var test=arguments.length>5?arguments[5]:undefined;_classCallCheck2(this,SearchCursor);this.test=test;this.value={from:0,to:0};this.done=false;this.matches=[];this.buffer="";this.bufferPos=0;this.iter=text.iterRange(from,to);this.bufferStart=from;this.normalize=normalize?function(x){return normalize(basicNormalize(x))}:basicNormalize;this.query=this.normalize(query)}_createClass2(SearchCursor,[{key:"peek",value:function peek(){if(this.bufferPos==this.buffer.length){this.bufferStart+=this.buffer.length;this.iter.next();if(this.iter.done)return-1;this.bufferPos=0;this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)}},{key:"next",value:function next(){while(this.matches.length)this.matches.pop();return this.nextOverlapping()}},{key:"nextOverlapping",value:function nextOverlapping(){for(;;){var next=this.peek();if(next<0){this.done=true;return this}var str=fromCodePoint(next),_start18=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(next);var norm=this.normalize(str);for(var _i245=0,pos=_start18;;_i245++){var _code3=norm.charCodeAt(_i245);var match=this.match(_code3,pos);if(_i245==norm.length-1){if(match){this.value=match;return this}break}if(pos==_start18&&_i245<str.length&&str.charCodeAt(_i245)==_code3)pos++}}}},{key:"match",value:function match(code,pos){var match=null;for(var _i246=0;_i246<this.matches.length;_i246+=2){var index=this.matches[_i246],keep=false;if(this.query.charCodeAt(index)==code){if(index==this.query.length-1){match={from:this.matches[_i246+1],to:pos+1}}else{this.matches[_i246]++;keep=true}}if(!keep){this.matches.splice(_i246,2);_i246-=2}}if(this.query.charCodeAt(0)==code){if(this.query.length==1)match={from:pos,to:pos+1};else this.matches.push(1,pos)}if(match&&this.test&&!this.test(match.from,match.to,this.buffer,this.bufferStart))match=null;return match}}]);return SearchCursor}();if(typeof Symbol!="undefined")SearchCursor.prototype[Symbol.iterator]=function(){return this};var empty={from:-1,to:-1,match:/.*/.exec("")};var baseFlags="gm"+(/x/.unicode==null?"":"u");var RegExpCursor=function(){function RegExpCursor(text,query,options){var from=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var to=arguments.length>4&&arguments[4]!==undefined?arguments[4]:text.length;_classCallCheck2(this,RegExpCursor);this.text=text;this.to=to;this.curLine="";this.done=false;this.value=empty;if(/\\[sWDnr]|\n|\r|\[\^/.test(query))return new MultilineRegExpCursor(text,query,options,from,to);this.re=new RegExp(query,baseFlags+((options===null||options===void 0?void 0:options.ignoreCase)?"i":""));this.test=options===null||options===void 0?void 0:options.test;this.iter=text.iter();var startLine=text.lineAt(from);this.curLineStart=startLine.from;this.matchPos=toCharEnd(text,from);this.getLine(this.curLineStart)}_createClass2(RegExpCursor,[{key:"getLine",value:function getLine(skip){this.iter.next(skip);if(this.iter.lineBreak){this.curLine=""}else{this.curLine=this.iter.value;if(this.curLineStart+this.curLine.length>this.to)this.curLine=this.curLine.slice(0,this.to-this.curLineStart);this.iter.next()}}},{key:"nextLine",value:function nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1;if(this.curLineStart>this.to)this.curLine="";else this.getLine(0)}},{key:"next",value:function next(){for(var off=this.matchPos-this.curLineStart;;){this.re.lastIndex=off;var match=this.matchPos<=this.to&&this.re.exec(this.curLine);if(match){var from=this.curLineStart+match.index,to=from+match[0].length;this.matchPos=toCharEnd(this.text,to+(from==to?1:0));if(from==this.curLineStart+this.curLine.length)this.nextLine();if((from<to||from>this.value.to)&&(!this.test||this.test(from,to,match))){this.value={from:from,to:to,match:match};return this}off=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to){this.nextLine();off=0}else{this.done=true;return this}}}}]);return RegExpCursor}();var flattened=new WeakMap;var FlattenedDoc=function(){function FlattenedDoc(from,text){_classCallCheck2(this,FlattenedDoc);this.from=from;this.text=text}_createClass2(FlattenedDoc,[{key:"to",get:function get(){return this.from+this.text.length}}],[{key:"get",value:function get(doc,from,to){var cached=flattened.get(doc);if(!cached||cached.from>=to||cached.to<=from){var flat=new FlattenedDoc(from,doc.sliceString(from,to));flattened.set(doc,flat);return flat}if(cached.from==from&&cached.to==to)return cached;var text=cached.text,cachedFrom=cached.from;if(cachedFrom>from){text=doc.sliceString(from,cachedFrom)+text;cachedFrom=from}if(cached.to<to)text+=doc.sliceString(cached.to,to);flattened.set(doc,new FlattenedDoc(cachedFrom,text));return new FlattenedDoc(from,text.slice(from-cachedFrom,to-cachedFrom))}}]);return FlattenedDoc}();var MultilineRegExpCursor=function(){function MultilineRegExpCursor(text,query,options,from,to){_classCallCheck2(this,MultilineRegExpCursor);this.text=text;this.to=to;this.done=false;this.value=empty;this.matchPos=toCharEnd(text,from);this.re=new RegExp(query,baseFlags+((options===null||options===void 0?void 0:options.ignoreCase)?"i":""));this.test=options===null||options===void 0?void 0:options.test;this.flat=FlattenedDoc.get(text,from,this.chunkEnd(from+5000))}_createClass2(MultilineRegExpCursor,[{key:"chunkEnd",value:function chunkEnd(pos){return pos>=this.to?this.to:this.text.lineAt(pos).to}},{key:"next",value:function next(){for(;;){var off=this.re.lastIndex=this.matchPos-this.flat.from;var match=this.re.exec(this.flat.text);if(match&&!match[0]&&match.index==off){this.re.lastIndex=off+1;match=this.re.exec(this.flat.text)}if(match){var from=this.flat.from+match.index,to=from+match[0].length;if((this.flat.to>=this.to||match.index+match[0].length<=this.flat.text.length-10)&&(!this.test||this.test(from,to,match))){this.value={from:from,to:to,match:match};this.matchPos=toCharEnd(this.text,to+(from==to?1:0));return this}}if(this.flat.to==this.to){this.done=true;return this}this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}]);return MultilineRegExpCursor}();if(typeof Symbol!="undefined"){RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this}}function validRegExp(source){try{new RegExp(source,baseFlags);return true}catch(_a){return false}}function toCharEnd(text,pos){if(pos>=text.length)return pos;var line=text.lineAt(pos),next;while(pos<line.to&&(next=line.text.charCodeAt(pos-line.from))>=56320&&next<57344)pos++;return pos}function createLineDialog(view){var line=String(view.state.doc.lineAt(view.state.selection.main.head).number);var input=crelt("input",{"class":"cm-textfield",name:"line",value:line});var dom=crelt("form",{"class":"cm-gotoLine",onkeydown:function onkeydown(event){if(event.keyCode==27){event.preventDefault();view.dispatch({effects:dialogEffect.of(false)});view.focus()}else if(event.keyCode==13){event.preventDefault();go()}},onsubmit:function onsubmit(event){event.preventDefault();go()}},crelt("label",view.state.phrase("Go to line"),": ",input)," ",crelt("button",{"class":"cm-button",type:"submit"},view.state.phrase("go")));function go(){var match=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(input.value);if(!match)return;var state=view.state,startLine=state.doc.lineAt(state.selection.main.head);var _match4=_slicedToArray2(match,5),sign=_match4[1],ln=_match4[2],cl=_match4[3],percent=_match4[4];var col=cl?+cl.slice(1):0;var line=ln?+ln:startLine.number;if(ln&&percent){var pc=line/100;if(sign)pc=pc*(sign=="-"?-1:1)+startLine.number/state.doc.lines;line=Math.round(state.doc.lines*pc)}else if(ln&&sign){line=line*(sign=="-"?-1:1)+startLine.number}var docLine=state.doc.line(Math.max(1,Math.min(state.doc.lines,line)));var selection=EditorSelection.cursor(docLine.from+Math.max(0,Math.min(col,docLine.length)));view.dispatch({effects:[dialogEffect.of(false),EditorView.scrollIntoView(selection.from,{y:"center"})],selection:selection});view.focus()}return{dom:dom}}var dialogEffect=StateEffect.define();var dialogField=StateField.define({create:function create(){return true},update:function update(value,tr){var _iterator386=_createForOfIteratorHelper(tr.effects),_step386;try{for(_iterator386.s();!(_step386=_iterator386.n()).done;){var e=_step386.value;if(e.is(dialogEffect))value=e.value}}catch(err){_iterator386.e(err)}finally{_iterator386.f()}return value},provide:function provide(f){return showPanel.from(f,function(val){return val?createLineDialog:null})}});var gotoLine=function gotoLine(view){var panel=getPanel(view,createLineDialog);if(!panel){var effects=[dialogEffect.of(true)];if(view.state.field(dialogField,false)==null)effects.push(StateEffect.appendConfig.of([dialogField,baseTheme$1$1]));view.dispatch({effects:effects});panel=getPanel(view,createLineDialog)}if(panel)panel.dom.querySelector("input").select();return true};var baseTheme$1$1=EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}});var defaultHighlightOptions={highlightWordAroundCursor:false,minSelectionLength:1,maxMatches:100,wholeWords:false};var highlightConfig=Facet.define({combine:function combine(options){return combineConfig(options,defaultHighlightOptions,{highlightWordAroundCursor:function highlightWordAroundCursor(a,b){return a||b},minSelectionLength:Math.min,maxMatches:Math.min})}});function highlightSelectionMatches(options){var ext=[defaultTheme,matchHighlighter];if(options)ext.push(highlightConfig.of(options));return ext}var matchDeco=Decoration.mark({"class":"cm-selectionMatch"});var mainMatchDeco=Decoration.mark({"class":"cm-selectionMatch cm-selectionMatch-main"});function insideWordBoundaries(check,state,from,to){return(from==0||check(state.sliceDoc(from-1,from))!=CharCategory.Word)&&(to==state.doc.length||check(state.sliceDoc(to,to+1))!=CharCategory.Word)}function insideWord(check,state,from,to){return check(state.sliceDoc(from,from+1))==CharCategory.Word&&check(state.sliceDoc(to-1,to))==CharCategory.Word}var matchHighlighter=ViewPlugin.fromClass(function(){function _class69(view){_classCallCheck2(this,_class69);this.decorations=this.getDeco(view)}_createClass2(_class69,[{key:"update",value:function update(_update22){if(_update22.selectionSet||_update22.docChanged||_update22.viewportChanged)this.decorations=this.getDeco(_update22.view)}},{key:"getDeco",value:function getDeco(view){var conf=view.state.facet(highlightConfig);var state=view.state,sel=state.selection;if(sel.ranges.length>1)return Decoration.none;var range=sel.main,query,check=null;if(range.empty){if(!conf.highlightWordAroundCursor)return Decoration.none;var word=state.wordAt(range.head);if(!word)return Decoration.none;check=state.charCategorizer(range.head);query=state.sliceDoc(word.from,word.to)}else{var len=range.to-range.from;if(len<conf.minSelectionLength||len>200)return Decoration.none;if(conf.wholeWords){query=state.sliceDoc(range.from,range.to);check=state.charCategorizer(range.head);if(!(insideWordBoundaries(check,state,range.from,range.to)&&insideWord(check,state,range.from,range.to)))return Decoration.none}else{query=state.sliceDoc(range.from,range.to).trim();if(!query)return Decoration.none}}var deco=[];var _iterator387=_createForOfIteratorHelper(view.visibleRanges),_step387;try{for(_iterator387.s();!(_step387=_iterator387.n()).done;){var part=_step387.value;var _cursor3=new SearchCursor(state.doc,query,part.from,part.to);while(!_cursor3.next().done){var _cursor3$value=_cursor3.value,from=_cursor3$value.from,to=_cursor3$value.to;if(!check||insideWordBoundaries(check,state,from,to)){if(range.empty&&from<=range.from&&to>=range.to)deco.push(mainMatchDeco.range(from,to));else if(from>=range.to||to<=range.from)deco.push(matchDeco.range(from,to));if(deco.length>conf.maxMatches)return Decoration.none}}}}catch(err){_iterator387.e(err)}finally{_iterator387.f()}return Decoration.set(deco)}}]);return _class69}(),{decorations:function decorations(v){return v.decorations}});var defaultTheme=EditorView.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}});var selectWord=function selectWord(_ref260){var state=_ref260.state,dispatch=_ref260.dispatch;var selection=state.selection;var newSel=EditorSelection.create(selection.ranges.map(function(range){return state.wordAt(range.head)||EditorSelection.cursor(range.head)}),selection.mainIndex);if(newSel.eq(selection))return false;dispatch(state.update({selection:newSel}));return true};function findNextOccurrence(state,query){var _state$selection=state.selection,main=_state$selection.main,ranges=_state$selection.ranges;var word=state.wordAt(main.head),fullWord=word&&word.from==main.from&&word.to==main.to;var _loop24=function _loop24(_cycled,_cursor5){_cursor5.next();if(_cursor5.done){if(_cycled)return{v:null};_cursor5=new SearchCursor(state.doc,query,0,Math.max(0,ranges[ranges.length-1].from-1));_cycled=true}else{if(_cycled&&ranges.some(function(r){return r.from==_cursor5.value.from})){cycled=_cycled,_cursor4=_cursor5;return 0}if(fullWord){var _word=state.wordAt(_cursor5.value.from);if(!_word||_word.from!=_cursor5.value.from||_word.to!=_cursor5.value.to){cycled=_cycled,_cursor4=_cursor5;return 0}}return{v:_cursor5.value}}cycled=_cycled,_cursor4=_cursor5},_ret3;for(var cycled=false,_cursor4=new SearchCursor(state.doc,query,ranges[ranges.length-1].to);;){_ret3=_loop24(cycled,_cursor4);if(_ret3===0)continue;if(_ret3)return _ret3.v}}var selectNextOccurrence=function selectNextOccurrence(_ref261){var state=_ref261.state,dispatch=_ref261.dispatch;var ranges=state.selection.ranges;if(ranges.some(function(sel){return sel.from===sel.to}))return selectWord({state:state,dispatch:dispatch});var searchedText=state.sliceDoc(ranges[0].from,ranges[0].to);if(state.selection.ranges.some(function(r){return state.sliceDoc(r.from,r.to)!=searchedText}))return false;var range=findNextOccurrence(state,searchedText);if(!range)return false;dispatch(state.update({selection:state.selection.addRange(EditorSelection.range(range.from,range.to),false),effects:EditorView.scrollIntoView(range.to)}));return true};var searchConfigFacet=Facet.define({combine:function combine(configs){return combineConfig(configs,{top:false,caseSensitive:false,literal:false,regexp:false,wholeWord:false,createPanel:function createPanel(view){return new SearchPanel(view)},scrollToMatch:function scrollToMatch(range){return EditorView.scrollIntoView(range)}})}});var SearchQuery=function(){function SearchQuery(config){_classCallCheck2(this,SearchQuery);this.search=config.search;this.caseSensitive=!!config.caseSensitive;this.literal=!!config.literal;this.regexp=!!config.regexp;this.replace=config.replace||"";this.valid=!!this.search&&(!this.regexp||validRegExp(this.search));this.unquoted=this.unquote(this.search);this.wholeWord=!!config.wholeWord}_createClass2(SearchQuery,[{key:"unquote",value:function unquote(text){return this.literal?text:text.replace(/\\([nrt\\])/g,function(_,ch){return ch=="n"?"\n":ch=="r"?"\r":ch=="t"?"\t":"\\"})}},{key:"eq",value:function eq(other){return this.search==other.search&&this.replace==other.replace&&this.caseSensitive==other.caseSensitive&&this.regexp==other.regexp&&this.wholeWord==other.wholeWord}},{key:"create",value:function create(){return this.regexp?new RegExpQuery(this):new StringQuery(this)}},{key:"getCursor",value:function getCursor(state){var from=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var to=arguments.length>2?arguments[2]:undefined;var st=state.doc?state:EditorState.create({doc:state});if(to==null)to=st.doc.length;return this.regexp?regexpCursor(this,st,from,to):stringCursor(this,st,from,to)}}]);return SearchQuery}();var QueryType=_createClass2(function QueryType(spec){_classCallCheck2(this,QueryType);this.spec=spec});function stringCursor(spec,state,from,to){return new SearchCursor(state.doc,spec.unquoted,from,to,spec.caseSensitive?undefined:function(x){return x.toLowerCase()},spec.wholeWord?stringWordTest(state.doc,state.charCategorizer(state.selection.main.head)):undefined)}function stringWordTest(doc,categorizer){return function(from,to,buf,bufPos){if(bufPos>from||bufPos+buf.length<to){bufPos=Math.max(0,from-2);buf=doc.sliceString(bufPos,Math.min(doc.length,to+2))}return(categorizer(charBefore(buf,from-bufPos))!=CharCategory.Word||categorizer(charAfter(buf,from-bufPos))!=CharCategory.Word)&&(categorizer(charAfter(buf,to-bufPos))!=CharCategory.Word||categorizer(charBefore(buf,to-bufPos))!=CharCategory.Word)}}var StringQuery=function(_QueryType){_inherits2(StringQuery,_QueryType);var _super104=_createSuper(StringQuery);function StringQuery(spec){_classCallCheck2(this,StringQuery);return _super104.call(this,spec)}_createClass2(StringQuery,[{key:"nextMatch",value:function nextMatch(state,curFrom,curTo){var cursor=stringCursor(this.spec,state,curTo,state.doc.length).nextOverlapping();if(cursor.done)cursor=stringCursor(this.spec,state,0,curFrom).nextOverlapping();return cursor.done?null:cursor.value}},{key:"prevMatchInRange",value:function prevMatchInRange(state,from,to){for(var pos=to;;){var _start19=Math.max(from,pos-10000-this.spec.unquoted.length);var _cursor6=stringCursor(this.spec,state,_start19,pos),range=null;while(!_cursor6.nextOverlapping().done)range=_cursor6.value;if(range)return range;if(_start19==from)return null;pos-=10000}}},{key:"prevMatch",value:function prevMatch(state,curFrom,curTo){return this.prevMatchInRange(state,0,curFrom)||this.prevMatchInRange(state,curTo,state.doc.length)}},{key:"getReplacement",value:function getReplacement(_result){return this.spec.unquote(this.spec.replace)}},{key:"matchAll",value:function matchAll(state,limit){var cursor=stringCursor(this.spec,state,0,state.doc.length),ranges=[];while(!cursor.next().done){if(ranges.length>=limit)return null;ranges.push(cursor.value)}return ranges}},{key:"highlight",value:function highlight(state,from,to,add){var cursor=stringCursor(this.spec,state,Math.max(0,from-this.spec.unquoted.length),Math.min(to+this.spec.unquoted.length,state.doc.length));while(!cursor.next().done)add(cursor.value.from,cursor.value.to)}}]);return StringQuery}(QueryType);function regexpCursor(spec,state,from,to){return new RegExpCursor(state.doc,spec.search,{ignoreCase:!spec.caseSensitive,test:spec.wholeWord?regexpWordTest(state.charCategorizer(state.selection.main.head)):undefined},from,to)}function charBefore(str,index){return str.slice(findClusterBreak(str,index,false),index)}function charAfter(str,index){return str.slice(index,findClusterBreak(str,index))}function regexpWordTest(categorizer){return function(_from,_to,match){return!match[0].length||(categorizer(charBefore(match.input,match.index))!=CharCategory.Word||categorizer(charAfter(match.input,match.index))!=CharCategory.Word)&&(categorizer(charAfter(match.input,match.index+match[0].length))!=CharCategory.Word||categorizer(charBefore(match.input,match.index+match[0].length))!=CharCategory.Word)}}var RegExpQuery=function(_QueryType2){_inherits2(RegExpQuery,_QueryType2);var _super105=_createSuper(RegExpQuery);function RegExpQuery(){_classCallCheck2(this,RegExpQuery);return _super105.apply(this,arguments)}_createClass2(RegExpQuery,[{key:"nextMatch",value:function nextMatch(state,curFrom,curTo){var cursor=regexpCursor(this.spec,state,curTo,state.doc.length).next();if(cursor.done)cursor=regexpCursor(this.spec,state,0,curFrom).next();return cursor.done?null:cursor.value}},{key:"prevMatchInRange",value:function prevMatchInRange(state,from,to){for(var size=1;;size++){var _start20=Math.max(from,to-size*10000);var _cursor7=regexpCursor(this.spec,state,_start20,to),range=null;while(!_cursor7.next().done)range=_cursor7.value;if(range&&(_start20==from||range.from>_start20+10))return range;if(_start20==from)return null}}},{key:"prevMatch",value:function prevMatch(state,curFrom,curTo){return this.prevMatchInRange(state,0,curFrom)||this.prevMatchInRange(state,curTo,state.doc.length)}},{key:"getReplacement",value:function getReplacement(result){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,function(m,i){return i=="$"?"$":i=="&"?result.match[0]:i!="0"&&+i<result.match.length?result.match[i]:m})}},{key:"matchAll",value:function matchAll(state,limit){var cursor=regexpCursor(this.spec,state,0,state.doc.length),ranges=[];while(!cursor.next().done){if(ranges.length>=limit)return null;ranges.push(cursor.value)}return ranges}},{key:"highlight",value:function highlight(state,from,to,add){var cursor=regexpCursor(this.spec,state,Math.max(0,from-250),Math.min(to+250,state.doc.length));while(!cursor.next().done)add(cursor.value.from,cursor.value.to)}}]);return RegExpQuery}(QueryType);var setSearchQuery=StateEffect.define();var togglePanel$1=StateEffect.define();var searchState=StateField.define({create:function create(state){return new SearchState(defaultQuery(state).create(),null)},update:function update(value,tr){var _iterator388=_createForOfIteratorHelper(tr.effects),_step388;try{for(_iterator388.s();!(_step388=_iterator388.n()).done;){var _effect6=_step388.value;if(_effect6.is(setSearchQuery))value=new SearchState(_effect6.value.create(),value.panel);else if(_effect6.is(togglePanel$1))value=new SearchState(value.query,_effect6.value?createSearchPanel:null)}}catch(err){_iterator388.e(err)}finally{_iterator388.f()}return value},provide:function provide(f){return showPanel.from(f,function(val){return val.panel})}});var SearchState=_createClass2(function SearchState(query,panel){_classCallCheck2(this,SearchState);this.query=query;this.panel=panel});var matchMark=Decoration.mark({"class":"cm-searchMatch"}),selectedMatchMark=Decoration.mark({"class":"cm-searchMatch cm-searchMatch-selected"});var searchHighlighter=ViewPlugin.fromClass(function(){function _class70(view){_classCallCheck2(this,_class70);this.view=view;this.decorations=this.highlight(view.state.field(searchState))}_createClass2(_class70,[{key:"update",value:function update(_update23){var state=_update23.state.field(searchState);if(state!=_update23.startState.field(searchState)||_update23.docChanged||_update23.selectionSet||_update23.viewportChanged)this.decorations=this.highlight(state)}},{key:"highlight",value:function highlight(_ref262){var query=_ref262.query,panel=_ref262.panel;if(!panel||!query.spec.valid)return Decoration.none;var view=this.view;var builder=new RangeSetBuilder;for(var _i247=0,ranges=view.visibleRanges,_l3=ranges.length;_i247<_l3;_i247++){var _ranges$_i2=ranges[_i247],from=_ranges$_i2.from,to=_ranges$_i2.to;while(_i247<_l3-1&&to>ranges[_i247+1].from-2*250)to=ranges[++_i247].to;query.highlight(view.state,from,to,function(from,to){var selected=view.state.selection.ranges.some(function(r){return r.from==from&&r.to==to});builder.add(from,to,selected?selectedMatchMark:matchMark)})}return builder.finish()}}]);return _class70}(),{decorations:function decorations(v){return v.decorations}});function searchCommand(f){return function(view){var state=view.state.field(searchState,false);return state&&state.query.spec.valid?f(view,state):openSearchPanel(view)}}var findNext=searchCommand(function(view,_ref263){var query=_ref263.query;var to=view.state.selection.main.to;var next=query.nextMatch(view.state,to,to);if(!next)return false;var selection=EditorSelection.single(next.from,next.to);var config=view.state.facet(searchConfigFacet);view.dispatch({selection:selection,effects:[announceMatch(view,next),config.scrollToMatch(selection.main,view)],userEvent:"select.search"});selectSearchInput(view);return true});var findPrevious=searchCommand(function(view,_ref264){var query=_ref264.query;var state=view.state,from=state.selection.main.from;var prev=query.prevMatch(state,from,from);if(!prev)return false;var selection=EditorSelection.single(prev.from,prev.to);var config=view.state.facet(searchConfigFacet);view.dispatch({selection:selection,effects:[announceMatch(view,prev),config.scrollToMatch(selection.main,view)],userEvent:"select.search"});selectSearchInput(view);return true});var selectMatches=searchCommand(function(view,_ref265){var query=_ref265.query;var ranges=query.matchAll(view.state,1000);if(!ranges||!ranges.length)return false;view.dispatch({selection:EditorSelection.create(ranges.map(function(r){return EditorSelection.range(r.from,r.to)})),userEvent:"select.search.matches"});return true});var selectSelectionMatches=function selectSelectionMatches(_ref266){var state=_ref266.state,dispatch=_ref266.dispatch;var sel=state.selection;if(sel.ranges.length>1||sel.main.empty)return false;var _sel$main=sel.main,from=_sel$main.from,to=_sel$main.to;var ranges=[],main=0;for(var _cur23=new SearchCursor(state.doc,state.sliceDoc(from,to));!_cur23.next().done;){if(ranges.length>1000)return false;if(_cur23.value.from==from)main=ranges.length;ranges.push(EditorSelection.range(_cur23.value.from,_cur23.value.to))}dispatch(state.update({selection:EditorSelection.create(ranges,main),userEvent:"select.search.matches"}));return true};var replaceNext=searchCommand(function(view,_ref267){var query=_ref267.query;var state=view.state,_state$selection$main=state.selection.main,from=_state$selection$main.from,to=_state$selection$main.to;if(state.readOnly)return false;var next=query.nextMatch(state,from,from);if(!next)return false;var changes=[],selection,replacement;var effects=[];if(next.from==from&&next.to==to){replacement=state.toText(query.getReplacement(next));changes.push({from:next.from,to:next.to,insert:replacement});next=query.nextMatch(state,next.from,next.to);effects.push(EditorView.announce.of(state.phrase("replaced match on line $",state.doc.lineAt(from).number)+"."))}if(next){var off=changes.length==0||changes[0].from>=next.to?0:next.to-next.from-replacement.length;selection=EditorSelection.single(next.from-off,next.to-off);effects.push(announceMatch(view,next));effects.push(state.facet(searchConfigFacet).scrollToMatch(selection.main,view))}view.dispatch({changes:changes,selection:selection,effects:effects,userEvent:"input.replace"});return true});var replaceAll=searchCommand(function(view,_ref268){var query=_ref268.query;if(view.state.readOnly)return false;var changes=query.matchAll(view.state,1e9).map(function(match){var from=match.from,to=match.to;return{from:from,to:to,insert:query.getReplacement(match)}});if(!changes.length)return false;var announceText=view.state.phrase("replaced $ matches",changes.length)+".";view.dispatch({changes:changes,effects:EditorView.announce.of(announceText),userEvent:"input.replace.all"});return true});function createSearchPanel(view){return view.state.facet(searchConfigFacet).createPanel(view)}function defaultQuery(state,fallback){var _a,_b,_c,_d,_e;var sel=state.selection.main;var selText=sel.empty||sel.to>sel.from+100?"":state.sliceDoc(sel.from,sel.to);if(fallback&&!selText)return fallback;var config=state.facet(searchConfigFacet);return new SearchQuery({search:((_a=fallback===null||fallback===void 0?void 0:fallback.literal)!==null&&_a!==void 0?_a:config.literal)?selText:selText.replace(/\n/g,"\\n"),caseSensitive:(_b=fallback===null||fallback===void 0?void 0:fallback.caseSensitive)!==null&&_b!==void 0?_b:config.caseSensitive,literal:(_c=fallback===null||fallback===void 0?void 0:fallback.literal)!==null&&_c!==void 0?_c:config.literal,regexp:(_d=fallback===null||fallback===void 0?void 0:fallback.regexp)!==null&&_d!==void 0?_d:config.regexp,wholeWord:(_e=fallback===null||fallback===void 0?void 0:fallback.wholeWord)!==null&&_e!==void 0?_e:config.wholeWord})}function getSearchInput(view){var panel=getPanel(view,createSearchPanel);return panel&&panel.dom.querySelector("[main-field]")}function selectSearchInput(view){var input=getSearchInput(view);if(input&&input==view.root.activeElement)input.select()}var openSearchPanel=function openSearchPanel(view){var state=view.state.field(searchState,false);if(state&&state.panel){var searchInput=getSearchInput(view);if(searchInput&&searchInput!=view.root.activeElement){var query=defaultQuery(view.state,state.query.spec);if(query.valid)view.dispatch({effects:setSearchQuery.of(query)});searchInput.focus();searchInput.select()}}else{view.dispatch({effects:[togglePanel$1.of(true),state?setSearchQuery.of(defaultQuery(view.state,state.query.spec)):StateEffect.appendConfig.of(searchExtensions)]})}return true};var closeSearchPanel=function closeSearchPanel(view){var state=view.state.field(searchState,false);if(!state||!state.panel)return false;var panel=getPanel(view,createSearchPanel);if(panel&&panel.dom.contains(view.root.activeElement))view.focus();view.dispatch({effects:togglePanel$1.of(false)});return true};var searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:true},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:true},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Mod-Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:true}];var SearchPanel=function(){function SearchPanel(view){var _this253=this;_classCallCheck2(this,SearchPanel);this.view=view;var query=this.query=view.state.field(searchState).query.spec;this.commit=this.commit.bind(this);this.searchField=crelt("input",{value:query.search,placeholder:phrase(view,"Find"),"aria-label":phrase(view,"Find"),"class":"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit});this.replaceField=crelt("input",{value:query.replace,placeholder:phrase(view,"Replace"),"aria-label":phrase(view,"Replace"),"class":"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit});this.caseField=crelt("input",{type:"checkbox",name:"case",form:"",checked:query.caseSensitive,onchange:this.commit});this.reField=crelt("input",{type:"checkbox",name:"re",form:"",checked:query.regexp,onchange:this.commit});this.wordField=crelt("input",{type:"checkbox",name:"word",form:"",checked:query.wholeWord,onchange:this.commit});function button(name,onclick,content){return crelt("button",{"class":"cm-button",name:name,onclick:onclick,type:"button"},content)}this.dom=crelt("div",{onkeydown:function onkeydown(e){return _this253.keydown(e)},"class":"cm-search"},[this.searchField,button("next",function(){return findNext(view)},[phrase(view,"next")]),button("prev",function(){return findPrevious(view)},[phrase(view,"previous")]),button("select",function(){return selectMatches(view)},[phrase(view,"all")]),crelt("label",null,[this.caseField,phrase(view,"match case")]),crelt("label",null,[this.reField,phrase(view,"regexp")]),crelt("label",null,[this.wordField,phrase(view,"by word")])].concat(_toConsumableArray2(view.state.readOnly?[]:[crelt("br"),this.replaceField,button("replace",function(){return replaceNext(view)},[phrase(view,"replace")]),button("replaceAll",function(){return replaceAll(view)},[phrase(view,"replace all")])]),[crelt("button",{name:"close",onclick:function onclick(){return closeSearchPanel(view)},"aria-label":phrase(view,"close"),type:"button"},["\xD7"])]))}_createClass2(SearchPanel,[{key:"commit",value:function commit(){var query=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});if(!query.eq(this.query)){this.query=query;this.view.dispatch({effects:setSearchQuery.of(query)})}}},{key:"keydown",value:function keydown(e){if(runScopeHandlers(this.view,e,"search-panel")){e.preventDefault()}else if(e.keyCode==13&&e.target==this.searchField){e.preventDefault();(e.shiftKey?findPrevious:findNext)(this.view)}else if(e.keyCode==13&&e.target==this.replaceField){e.preventDefault();replaceNext(this.view)}}},{key:"update",value:function update(_update24){var _iterator389=_createForOfIteratorHelper(_update24.transactions),_step389;try{for(_iterator389.s();!(_step389=_iterator389.n()).done;){var tr=_step389.value;var _iterator390=_createForOfIteratorHelper(tr.effects),_step390;try{for(_iterator390.s();!(_step390=_iterator390.n()).done;){var _effect7=_step390.value;if(_effect7.is(setSearchQuery)&&!_effect7.value.eq(this.query))this.setQuery(_effect7.value)}}catch(err){_iterator390.e(err)}finally{_iterator390.f()}}}catch(err){_iterator389.e(err)}finally{_iterator389.f()}}},{key:"setQuery",value:function setQuery(query){this.query=query;this.searchField.value=query.search;this.replaceField.value=query.replace;this.caseField.checked=query.caseSensitive;this.reField.checked=query.regexp;this.wordField.checked=query.wholeWord}},{key:"mount",value:function mount(){this.searchField.select()}},{key:"pos",get:function get(){return 80}},{key:"top",get:function get(){return this.view.state.facet(searchConfigFacet).top}}]);return SearchPanel}();function phrase(view,phrase){return view.state.phrase(phrase)}var AnnounceMargin=30;var Break=/[\s\.,:;?!]/;function announceMatch(view,_ref269){var from=_ref269.from,to=_ref269.to;var line=view.state.doc.lineAt(from),lineEnd=view.state.doc.lineAt(to).to;var start=Math.max(line.from,from-AnnounceMargin),end=Math.min(lineEnd,to+AnnounceMargin);var text=view.state.sliceDoc(start,end);if(start!=line.from){for(var _i248=0;_i248<AnnounceMargin;_i248++)if(!Break.test(text[_i248+1])&&Break.test(text[_i248])){text=text.slice(_i248);break}}if(end!=lineEnd){for(var _i249=text.length-1;_i249>text.length-AnnounceMargin;_i249--)if(!Break.test(text[_i249-1])&&Break.test(text[_i249])){text=text.slice(0,_i249);break}}return EditorView.announce.of("".concat(view.state.phrase("current match"),". ").concat(text," ").concat(view.state.phrase("on line")," ").concat(line.number,"."))}var baseTheme$2=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}});var searchExtensions=[searchState,Prec.low(searchHighlighter),baseTheme$2];var CompletionContext=function(){function CompletionContext(state,pos,explicit){_classCallCheck2(this,CompletionContext);this.state=state;this.pos=pos;this.explicit=explicit;this.abortListeners=[]}_createClass2(CompletionContext,[{key:"tokenBefore",value:function tokenBefore(types){var token=syntaxTree(this.state).resolveInner(this.pos,-1);while(token&&types.indexOf(token.name)<0)token=token.parent;return token?{from:token.from,to:this.pos,text:this.state.sliceDoc(token.from,this.pos),type:token.type}:null}},{key:"matchBefore",value:function matchBefore(expr){var line=this.state.doc.lineAt(this.pos);var start=Math.max(line.from,this.pos-250);var str=line.text.slice(start-line.from,this.pos-line.from);var found=str.search(ensureAnchor(expr,false));return found<0?null:{from:start+found,to:this.pos,text:str.slice(found)}}},{key:"aborted",get:function get(){return this.abortListeners==null}},{key:"addEventListener",value:function addEventListener(type,listener){if(type=="abort"&&this.abortListeners)this.abortListeners.push(listener)}}]);return CompletionContext}();function toSet(chars){var flat=Object.keys(chars).join("");var words=/\w/.test(flat);if(words)flat=flat.replace(/\w/g,"");return"[".concat(words?"\\w":"").concat(flat.replace(/[^\w\s]/g,"\\$&"),"]")}function prefixMatch(options){var first=Object.create(null),rest=Object.create(null);var _iterator391=_createForOfIteratorHelper(options),_step391;try{for(_iterator391.s();!(_step391=_iterator391.n()).done;){var label=_step391.value.label;first[label[0]]=true;for(var _i250=1;_i250<label.length;_i250++)rest[label[_i250]]=true}}catch(err){_iterator391.e(err)}finally{_iterator391.f()}var source=toSet(first)+toSet(rest)+"*$";return[new RegExp("^"+source),new RegExp(source)]}function completeFromList(list){var options=list.map(function(o){return typeof o=="string"?{label:o}:o});var _ref270=options.every(function(o){return /^\w+$/.test(o.label)})?[/\w*$/,/\w+$/]:prefixMatch(options),_ref271=_slicedToArray2(_ref270,2),validFor=_ref271[0],match=_ref271[1];return function(context){var token=context.matchBefore(match);return token||context.explicit?{from:token?token.from:context.pos,options:options,validFor:validFor}:null}}function ifNotIn(nodes,source){return function(context){for(var pos=syntaxTree(context.state).resolveInner(context.pos,-1);pos;pos=pos.parent){if(nodes.indexOf(pos.name)>-1)return null;if(pos.type.isTop)break}return source(context)}}var Option=_createClass2(function Option(completion,source,match,score){_classCallCheck2(this,Option);this.completion=completion;this.source=source;this.match=match;this.score=score});function cur(state){return state.selection.main.from}function ensureAnchor(expr,start){var _a;var source=expr.source;var addStart=start&&source[0]!="^",addEnd=source[source.length-1]!="$";if(!addStart&&!addEnd)return expr;return new RegExp("".concat(addStart?"^":"","(?:").concat(source,")").concat(addEnd?"$":""),(_a=expr.flags)!==null&&_a!==void 0?_a:expr.ignoreCase?"i":"")}var pickedCompletion=Annotation.define();function insertCompletionText(state,text,from,to){var main=state.selection.main,fromOff=from-main.from,toOff=to-main.from;return Object.assign(Object.assign({},state.changeByRange(function(range){if(range!=main&&from!=to&&state.sliceDoc(range.from+fromOff,range.from+toOff)!=state.sliceDoc(from,to))return{range:range};return{changes:{from:range.from+fromOff,to:to==main.from?range.to:range.from+toOff,insert:text},range:EditorSelection.cursor(range.from+fromOff+text.length)}})),{scrollIntoView:true,userEvent:"input.complete"})}var SourceCache=new WeakMap;function asSource(source){if(!Array.isArray(source))return source;var known=SourceCache.get(source);if(!known)SourceCache.set(source,known=completeFromList(source));return known}var startCompletionEffect=StateEffect.define();var closeCompletionEffect=StateEffect.define();var FuzzyMatcher=function(){function FuzzyMatcher(pattern){_classCallCheck2(this,FuzzyMatcher);this.pattern=pattern;this.chars=[];this.folded=[];this.any=[];this.precise=[];this.byWord=[];this.score=0;this.matched=[];for(var _p7=0;_p7<pattern.length;){var _char4=codePointAt(pattern,_p7),size=codePointSize(_char4);this.chars.push(_char4);var part=pattern.slice(_p7,_p7+size),upper=part.toUpperCase();this.folded.push(codePointAt(upper==part?part.toLowerCase():upper,0));_p7+=size}this.astral=pattern.length!=this.chars.length}_createClass2(FuzzyMatcher,[{key:"ret",value:function ret(score,matched){this.score=score;this.matched=matched;return true}},{key:"match",value:function match(word){if(this.pattern.length==0)return this.ret(-100,[]);if(word.length<this.pattern.length)return false;var chars=this.chars,folded=this.folded,any=this.any,precise=this.precise,byWord=this.byWord;if(chars.length==1){var first=codePointAt(word,0),firstSize=codePointSize(first);var _score=firstSize==word.length?0:-100;if(first==chars[0]);else if(first==folded[0])_score+=-200;else return false;return this.ret(_score,[0,firstSize])}var direct=word.indexOf(this.pattern);if(direct==0)return this.ret(word.length==this.pattern.length?0:-100,[0,this.pattern.length]);var len=chars.length,anyTo=0;if(direct<0){for(var _i251=0,e=Math.min(word.length,200);_i251<e&&anyTo<len;){var next=codePointAt(word,_i251);if(next==chars[anyTo]||next==folded[anyTo])any[anyTo++]=_i251;_i251+=codePointSize(next)}if(anyTo<len)return false}var preciseTo=0;var byWordTo=0,byWordFolded=false;var adjacentTo=0,adjacentStart=-1,adjacentEnd=-1;var hasLower=/[a-z]/.test(word),wordAdjacent=true;for(var _i252=0,_e2=Math.min(word.length,200),prevType=0;_i252<_e2&&byWordTo<len;){var _next6=codePointAt(word,_i252);if(direct<0){if(preciseTo<len&&_next6==chars[preciseTo])precise[preciseTo++]=_i252;if(adjacentTo<len){if(_next6==chars[adjacentTo]||_next6==folded[adjacentTo]){if(adjacentTo==0)adjacentStart=_i252;adjacentEnd=_i252+1;adjacentTo++}else{adjacentTo=0}}}var ch=void 0,type=_next6<255?_next6>=48&&_next6<=57||_next6>=97&&_next6<=122?2:_next6>=65&&_next6<=90?1:0:(ch=fromCodePoint(_next6))!=ch.toLowerCase()?1:ch!=ch.toUpperCase()?2:0;if(!_i252||type==1&&hasLower||prevType==0&&type!=0){if(chars[byWordTo]==_next6||folded[byWordTo]==_next6&&(byWordFolded=true))byWord[byWordTo++]=_i252;else if(byWord.length)wordAdjacent=false}prevType=type;_i252+=codePointSize(_next6)}if(byWordTo==len&&byWord[0]==0&&wordAdjacent)return this.result(-100+(byWordFolded?-200:0),byWord,word);if(adjacentTo==len&&adjacentStart==0)return this.ret(-200-word.length+(adjacentEnd==word.length?0:-100),[0,adjacentEnd]);if(direct>-1)return this.ret(-700-word.length,[direct,direct+this.pattern.length]);if(adjacentTo==len)return this.ret(-200+-700-word.length,[adjacentStart,adjacentEnd]);if(byWordTo==len)return this.result(-100+(byWordFolded?-200:0)+-700+(wordAdjacent?0:-1100),byWord,word);return chars.length==2?false:this.result((any[0]?-700:0)+-200+-1100,any,word)}},{key:"result",value:function result(score,positions,word){var result=[],i=0;var _iterator392=_createForOfIteratorHelper(positions),_step392;try{for(_iterator392.s();!(_step392=_iterator392.n()).done;){var pos=_step392.value;var to=pos+(this.astral?codePointSize(codePointAt(word,pos)):1);if(i&&result[i-1]==pos)result[i-1]=to;else{result[i++]=pos;result[i++]=to}}}catch(err){_iterator392.e(err)}finally{_iterator392.f()}return this.ret(score-word.length,result)}}]);return FuzzyMatcher}();var completionConfig=Facet.define({combine:function combine(configs){return combineConfig(configs,{activateOnTyping:true,selectOnOpen:true,override:null,closeOnBlur:true,maxRenderedOptions:100,defaultKeymap:true,tooltipClass:function tooltipClass(){return""},optionClass:function optionClass(){return""},aboveCursor:false,icons:true,addToOptions:[],positionInfo:defaultPositionInfo,compareCompletions:function compareCompletions(a,b){return a.label.localeCompare(b.label)},interactionDelay:75,updateSyncTime:100},{defaultKeymap:function defaultKeymap(a,b){return a&&b},closeOnBlur:function closeOnBlur(a,b){return a&&b},icons:function icons(a,b){return a&&b},tooltipClass:function tooltipClass(a,b){return function(c){return joinClass(a(c),b(c))}},optionClass:function optionClass(a,b){return function(c){return joinClass(a(c),b(c))}},addToOptions:function addToOptions(a,b){return a.concat(b)}})}});function joinClass(a,b){return a?b?a+" "+b:a:b}function defaultPositionInfo(view,list,option,info,space,tooltip){var rtl=view.textDirection==Direction.RTL,left=rtl,narrow=false;var side="top",offset,maxWidth;var spaceLeft=list.left-space.left,spaceRight=space.right-list.right;var infoWidth=info.right-info.left,infoHeight=info.bottom-info.top;if(left&&spaceLeft<Math.min(infoWidth,spaceRight))left=false;else if(!left&&spaceRight<Math.min(infoWidth,spaceLeft))left=true;if(infoWidth<=(left?spaceLeft:spaceRight)){offset=Math.max(space.top,Math.min(option.top,space.bottom-infoHeight))-list.top;maxWidth=Math.min(400,left?spaceLeft:spaceRight)}else{narrow=true;maxWidth=Math.min(400,(rtl?list.right:space.right-list.left)-30);var spaceBelow=space.bottom-list.bottom;if(spaceBelow>=infoHeight||spaceBelow>list.top){offset=option.bottom-list.top}else{side="bottom";offset=list.bottom-option.top}}var scaleY=(list.bottom-list.top)/tooltip.offsetHeight;var scaleX=(list.right-list.left)/tooltip.offsetWidth;return{style:"".concat(side,": ").concat(offset/scaleY,"px; max-width: ").concat(maxWidth/scaleX,"px"),"class":"cm-completionInfo-"+(narrow?rtl?"left-narrow":"right-narrow":left?"left":"right")}}function optionContent(config){var content=config.addToOptions.slice();if(config.icons)content.push({render:function render(completion){var _icon$classList;var icon=document.createElement("div");icon.classList.add("cm-completionIcon");if(completion.type)(_icon$classList=icon.classList).add.apply(_icon$classList,_toConsumableArray2(completion.type.split(/\s+/g).map(function(cls){return"cm-completionIcon-"+cls})));icon.setAttribute("aria-hidden","true");return icon},position:20});content.push({render:function render(completion,_s,_v,match){var labelElt=document.createElement("span");labelElt.className="cm-completionLabel";var label=completion.displayLabel||completion.label,off=0;for(var j=0;j<match.length;){var from=match[j++],to=match[j++];if(from>off)labelElt.appendChild(document.createTextNode(label.slice(off,from)));var span=labelElt.appendChild(document.createElement("span"));span.appendChild(document.createTextNode(label.slice(from,to)));span.className="cm-completionMatchedText";off=to}if(off<label.length)labelElt.appendChild(document.createTextNode(label.slice(off)));return labelElt},position:50},{render:function render(completion){if(!completion.detail)return null;var detailElt=document.createElement("span");detailElt.className="cm-completionDetail";detailElt.textContent=completion.detail;return detailElt},position:80});return content.sort(function(a,b){return a.position-b.position}).map(function(a){return a.render})}function rangeAroundSelected(total,selected,max){if(total<=max)return{from:0,to:total};if(selected<0)selected=0;if(selected<=total>>1){var _off2=Math.floor(selected/max);return{from:_off2*max,to:(_off2+1)*max}}var off=Math.floor((total-selected)/max);return{from:total-(off+1)*max,to:total-off*max}}var CompletionTooltip=function(){function CompletionTooltip(view,stateField,applyCompletion){var _this254=this;_classCallCheck2(this,CompletionTooltip);this.view=view;this.stateField=stateField;this.applyCompletion=applyCompletion;this.info=null;this.infoDestroy=null;this.placeInfoReq={read:function read(){return _this254.measureInfo()},write:function write(pos){return _this254.placeInfo(pos)},key:this};this.space=null;this.currentClass="";var cState=view.state.field(stateField);var _cState$open=cState.open,options=_cState$open.options,selected=_cState$open.selected;var config=view.state.facet(completionConfig);this.optionContent=optionContent(config);this.optionClass=config.optionClass;this.tooltipClass=config.tooltipClass;this.range=rangeAroundSelected(options.length,selected,config.maxRenderedOptions);this.dom=document.createElement("div");this.dom.className="cm-tooltip-autocomplete";this.updateTooltipClass(view.state);this.dom.addEventListener("mousedown",function(e){var options=view.state.field(stateField).open.options;for(var dom=e.target,match;dom&&dom!=_this254.dom;dom=dom.parentNode){if(dom.nodeName=="LI"&&(match=/-(\d+)$/.exec(dom.id))&&+match[1]<options.length){_this254.applyCompletion(view,options[+match[1]]);e.preventDefault();return}}});this.dom.addEventListener("focusout",function(e){var state=view.state.field(_this254.stateField,false);if(state&&state.tooltip&&view.state.facet(completionConfig).closeOnBlur&&e.relatedTarget!=view.contentDOM)view.dispatch({effects:closeCompletionEffect.of(null)})});this.showOptions(options,cState.id)}_createClass2(CompletionTooltip,[{key:"mount",value:function mount(){this.updateSel()}},{key:"showOptions",value:function showOptions(options,id){var _this255=this;if(this.list)this.list.remove();this.list=this.dom.appendChild(this.createListBox(options,id,this.range));this.list.addEventListener("scroll",function(){if(_this255.info)_this255.view.requestMeasure(_this255.placeInfoReq)})}},{key:"update",value:function update(_update25){var _a;var cState=_update25.state.field(this.stateField);var prevState=_update25.startState.field(this.stateField);this.updateTooltipClass(_update25.state);if(cState!=prevState){var _cState$open2=cState.open,options=_cState$open2.options,selected=_cState$open2.selected,disabled=_cState$open2.disabled;if(!prevState.open||prevState.open.options!=options){this.range=rangeAroundSelected(options.length,selected,_update25.state.facet(completionConfig).maxRenderedOptions);this.showOptions(options,cState.id)}this.updateSel();if(disabled!=((_a=prevState.open)===null||_a===void 0?void 0:_a.disabled))this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!disabled)}}},{key:"updateTooltipClass",value:function updateTooltipClass(state){var cls=this.tooltipClass(state);if(cls!=this.currentClass){var _iterator393=_createForOfIteratorHelper(this.currentClass.split(" ")),_step393;try{for(_iterator393.s();!(_step393=_iterator393.n()).done;){var c=_step393.value;if(c)this.dom.classList.remove(c)}}catch(err){_iterator393.e(err)}finally{_iterator393.f()}var _iterator394=_createForOfIteratorHelper(cls.split(" ")),_step394;try{for(_iterator394.s();!(_step394=_iterator394.n()).done;){var _c2=_step394.value;if(_c2)this.dom.classList.add(_c2)}}catch(err){_iterator394.e(err)}finally{_iterator394.f()}this.currentClass=cls}}},{key:"positioned",value:function positioned(space){this.space=space;if(this.info)this.view.requestMeasure(this.placeInfoReq)}},{key:"updateSel",value:function updateSel(){var _this256=this;var cState=this.view.state.field(this.stateField),open=cState.open;if(open.selected>-1&&open.selected<this.range.from||open.selected>=this.range.to){this.range=rangeAroundSelected(open.options.length,open.selected,this.view.state.facet(completionConfig).maxRenderedOptions);this.showOptions(open.options,cState.id)}if(this.updateSelectedOption(open.selected)){this.destroyInfo();var completion=open.options[open.selected].completion;var info=completion.info;if(!info)return;var infoResult=typeof info==="string"?document.createTextNode(info):info(completion);if(!infoResult)return;if("then"in infoResult){infoResult.then(function(obj){if(obj&&_this256.view.state.field(_this256.stateField,false)==cState)_this256.addInfoPane(obj,completion)})["catch"](function(e){return logException(_this256.view.state,e,"completion info")})}else{this.addInfoPane(infoResult,completion)}}}},{key:"addInfoPane",value:function addInfoPane(content,completion){this.destroyInfo();var wrap=this.info=document.createElement("div");wrap.className="cm-tooltip cm-completionInfo";if(content.nodeType!=null){wrap.appendChild(content);this.infoDestroy=null}else{var dom=content.dom,destroy=content.destroy;wrap.appendChild(dom);this.infoDestroy=destroy||null}this.dom.appendChild(wrap);this.view.requestMeasure(this.placeInfoReq)}},{key:"updateSelectedOption",value:function updateSelectedOption(selected){var set=null;for(var opt=this.list.firstChild,_i253=this.range.from;opt;opt=opt.nextSibling,_i253++){if(opt.nodeName!="LI"||!opt.id){_i253--}else if(_i253==selected){if(!opt.hasAttribute("aria-selected")){opt.setAttribute("aria-selected","true");set=opt}}else{if(opt.hasAttribute("aria-selected"))opt.removeAttribute("aria-selected")}}if(set)scrollIntoView(this.list,set);return set}},{key:"measureInfo",value:function measureInfo(){var sel=this.dom.querySelector("[aria-selected]");if(!sel||!this.info)return null;var listRect=this.dom.getBoundingClientRect();var infoRect=this.info.getBoundingClientRect();var selRect=sel.getBoundingClientRect();var space=this.space;if(!space){var win=this.dom.ownerDocument.defaultView||window;space={left:0,top:0,right:win.innerWidth,bottom:win.innerHeight}}if(selRect.top>Math.min(space.bottom,listRect.bottom)-10||selRect.bottom<Math.max(space.top,listRect.top)+10)return null;return this.view.state.facet(completionConfig).positionInfo(this.view,listRect,selRect,infoRect,space,this.dom)}},{key:"placeInfo",value:function placeInfo(pos){if(this.info){if(pos){if(pos.style)this.info.style.cssText=pos.style;this.info.className="cm-tooltip cm-completionInfo "+(pos["class"]||"")}else{this.info.style.cssText="top: -1e6px"}}}},{key:"createListBox",value:function createListBox(options,id,range){var ul=document.createElement("ul");ul.id=id;ul.setAttribute("role","listbox");ul.setAttribute("aria-expanded","true");ul.setAttribute("aria-label",this.view.state.phrase("Completions"));var curSection=null;for(var _i254=range.from;_i254<range.to;_i254++){var _options$_i=options[_i254],completion=_options$_i.completion,match=_options$_i.match,section=completion.section;if(section){var _name26=typeof section=="string"?section:section.name;if(_name26!=curSection&&(_i254>range.from||range.from==0)){curSection=_name26;if(typeof section!="string"&&section.header){ul.appendChild(section.header(section))}else{var header=ul.appendChild(document.createElement("completion-section"));header.textContent=_name26}}}var li=ul.appendChild(document.createElement("li"));li.id=id+"-"+_i254;li.setAttribute("role","option");var cls=this.optionClass(completion);if(cls)li.className=cls;var _iterator395=_createForOfIteratorHelper(this.optionContent),_step395;try{for(_iterator395.s();!(_step395=_iterator395.n()).done;){var source=_step395.value;var node=source(completion,this.view.state,this.view,match);if(node)li.appendChild(node)}}catch(err){_iterator395.e(err)}finally{_iterator395.f()}}if(range.from)ul.classList.add("cm-completionListIncompleteTop");if(range.to<options.length)ul.classList.add("cm-completionListIncompleteBottom");return ul}},{key:"destroyInfo",value:function destroyInfo(){if(this.info){if(this.infoDestroy)this.infoDestroy();this.info.remove();this.info=null}}},{key:"destroy",value:function destroy(){this.destroyInfo()}}]);return CompletionTooltip}();function completionTooltip(stateField,applyCompletion){return function(view){return new CompletionTooltip(view,stateField,applyCompletion)}}function scrollIntoView(container,element){var parent=container.getBoundingClientRect();var self=element.getBoundingClientRect();var scaleY=parent.height/container.offsetHeight;if(self.top<parent.top)container.scrollTop-=(parent.top-self.top)/scaleY;else if(self.bottom>parent.bottom)container.scrollTop+=(self.bottom-parent.bottom)/scaleY}function score(option){return(option.boost||0)*100+(option.apply?10:0)+(option.info?5:0)+(option.type?1:0)}function sortOptions(active,state){var options=[];var sections=null;var addOption=function addOption(option){options.push(option);var section=option.completion.section;if(section){if(!sections)sections=[];var _name27=typeof section=="string"?section:section.name;if(!sections.some(function(s){return s.name==_name27}))sections.push(typeof section=="string"?{name:_name27}:section)}};var _iterator396=_createForOfIteratorHelper(active),_step396;try{for(_iterator396.s();!(_step396=_iterator396.n()).done;){var a=_step396.value;if(a.hasResult()){var getMatch=a.result.getMatch;if(a.result.filter===false){var _iterator400=_createForOfIteratorHelper(a.result.options),_step400;try{for(_iterator400.s();!(_step400=_iterator400.n()).done;){var _option=_step400.value;addOption(new Option(_option,a.source,getMatch?getMatch(_option):[],1e9-options.length))}}catch(err){_iterator400.e(err)}finally{_iterator400.f()}}else{var matcher=new FuzzyMatcher(state.sliceDoc(a.from,a.to));var _iterator401=_createForOfIteratorHelper(a.result.options),_step401;try{for(_iterator401.s();!(_step401=_iterator401.n()).done;){var _option2=_step401.value;if(matcher.match(_option2.label)){var matched=!_option2.displayLabel?matcher.matched:getMatch?getMatch(_option2,matcher.matched):[];addOption(new Option(_option2,a.source,matched,matcher.score+(_option2.boost||0)))}}}catch(err){_iterator401.e(err)}finally{_iterator401.f()}}}}}catch(err){_iterator396.e(err)}finally{_iterator396.f()}if(sections){var sectionOrder=Object.create(null),pos=0;var cmp=function cmp(a,b){var _a,_b;return((_a=a.rank)!==null&&_a!==void 0?_a:1e9)-((_b=b.rank)!==null&&_b!==void 0?_b:1e9)||(a.name<b.name?-1:1)};var _iterator397=_createForOfIteratorHelper(sections.sort(cmp)),_step397;try{for(_iterator397.s();!(_step397=_iterator397.n()).done;){var s=_step397.value;pos-=1e5;sectionOrder[s.name]=pos}}catch(err){_iterator397.e(err)}finally{_iterator397.f()}var _iterator398=_createForOfIteratorHelper(options),_step398;try{for(_iterator398.s();!(_step398=_iterator398.n()).done;){var option=_step398.value;var section=option.completion.section;if(section)option.score+=sectionOrder[typeof section=="string"?section:section.name]}}catch(err){_iterator398.e(err)}finally{_iterator398.f()}}var result=[],prev=null;var compare=state.facet(completionConfig).compareCompletions;var _iterator399=_createForOfIteratorHelper(options.sort(function(a,b){return b.score-a.score||compare(a.completion,b.completion)})),_step399;try{for(_iterator399.s();!(_step399=_iterator399.n()).done;){var opt=_step399.value;var _cur24=opt.completion;if(!prev||prev.label!=_cur24.label||prev.detail!=_cur24.detail||prev.type!=null&&_cur24.type!=null&&prev.type!=_cur24.type||prev.apply!=_cur24.apply||prev.boost!=_cur24.boost)result.push(opt);else if(score(opt.completion)>score(prev))result[result.length-1]=opt;prev=opt.completion}}catch(err){_iterator399.e(err)}finally{_iterator399.f()}return result}var CompletionDialog=function(){function CompletionDialog(options,attrs,tooltip,timestamp,selected,disabled){_classCallCheck2(this,CompletionDialog);this.options=options;this.attrs=attrs;this.tooltip=tooltip;this.timestamp=timestamp;this.selected=selected;this.disabled=disabled}_createClass2(CompletionDialog,[{key:"setSelected",value:function setSelected(selected,id){return selected==this.selected||selected>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(id,selected),this.tooltip,this.timestamp,selected,this.disabled)}},{key:"map",value:function map(changes){return new CompletionDialog(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:changes.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}],[{key:"build",value:function build(active,state,id,prev,conf){var options=sortOptions(active,state);if(!options.length){return prev&&active.some(function(a){return a.state==1})?new CompletionDialog(prev.options,prev.attrs,prev.tooltip,prev.timestamp,prev.selected,true):null}var selected=state.facet(completionConfig).selectOnOpen?0:-1;if(prev&&prev.selected!=selected&&prev.selected!=-1){var selectedValue=prev.options[prev.selected].completion;for(var _i255=0;_i255<options.length;_i255++)if(options[_i255].completion==selectedValue){selected=_i255;break}}return new CompletionDialog(options,makeAttrs(id,selected),{pos:active.reduce(function(a,b){return b.hasResult()?Math.min(a,b.from):a},1e8),create:createTooltip,above:conf.aboveCursor},prev?prev.timestamp:Date.now(),selected,false)}}]);return CompletionDialog}();var CompletionState=function(){function CompletionState(active,id,open){_classCallCheck2(this,CompletionState);this.active=active;this.id=id;this.open=open}_createClass2(CompletionState,[{key:"update",value:function update(tr){var _this257=this;var state=tr.state,conf=state.facet(completionConfig);var sources=conf.override||state.languageDataAt("autocomplete",cur(state)).map(asSource);var active=sources.map(function(source){var value=_this257.active.find(function(s){return s.source==source})||new ActiveSource(source,_this257.active.some(function(a){return a.state!=0})?1:0);return value.update(tr,conf)});if(active.length==this.active.length&&active.every(function(a,i){return a==_this257.active[i]}))active=this.active;var open=this.open;if(open&&tr.docChanged)open=open.map(tr.changes);if(tr.selection||active.some(function(a){return a.hasResult()&&tr.changes.touchesRange(a.from,a.to)})||!sameResults(active,this.active))open=CompletionDialog.build(active,state,this.id,open,conf);else if(open&&open.disabled&&!active.some(function(a){return a.state==1}))open=null;if(!open&&active.every(function(a){return a.state!=1})&&active.some(function(a){return a.hasResult()}))active=active.map(function(a){return a.hasResult()?new ActiveSource(a.source,0):a});var _iterator402=_createForOfIteratorHelper(tr.effects),_step402;try{for(_iterator402.s();!(_step402=_iterator402.n()).done;){var _effect8=_step402.value;if(_effect8.is(setSelectedEffect))open=open&&open.setSelected(_effect8.value,this.id)}}catch(err){_iterator402.e(err)}finally{_iterator402.f()}return active==this.active&&open==this.open?this:new CompletionState(active,this.id,open)}},{key:"tooltip",get:function get(){return this.open?this.open.tooltip:null}},{key:"attrs",get:function get(){return this.open?this.open.attrs:baseAttrs}}],[{key:"start",value:function start(){return new CompletionState(none$1,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}}]);return CompletionState}();function sameResults(a,b){if(a==b)return true;for(var iA=0,iB=0;;){while(iA<a.length&&!a[iA].hasResult)iA++;while(iB<b.length&&!b[iB].hasResult)iB++;var endA=iA==a.length,endB=iB==b.length;if(endA||endB)return endA==endB;if(a[iA++].result!=b[iB++].result)return false}}var baseAttrs={"aria-autocomplete":"list"};function makeAttrs(id,selected){var result={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":id};if(selected>-1)result["aria-activedescendant"]=id+"-"+selected;return result}var none$1=[];function getUserEvent(tr){return tr.isUserEvent("input.type")?"input":tr.isUserEvent("delete.backward")?"delete":null}var ActiveSource=function(){function ActiveSource(source,state){var explicitPos=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;_classCallCheck2(this,ActiveSource);this.source=source;this.state=state;this.explicitPos=explicitPos}_createClass2(ActiveSource,[{key:"hasResult",value:function hasResult(){return false}},{key:"update",value:function update(tr,conf){var event=getUserEvent(tr),value=this;if(event)value=value.handleUserEvent(tr,event,conf);else if(tr.docChanged)value=value.handleChange(tr);else if(tr.selection&&value.state!=0)value=new ActiveSource(value.source,0);var _iterator403=_createForOfIteratorHelper(tr.effects),_step403;try{for(_iterator403.s();!(_step403=_iterator403.n()).done;){var _effect9=_step403.value;if(_effect9.is(startCompletionEffect))value=new ActiveSource(value.source,1,_effect9.value?cur(tr.state):-1);else if(_effect9.is(closeCompletionEffect))value=new ActiveSource(value.source,0);else if(_effect9.is(setActiveEffect)){var _iterator404=_createForOfIteratorHelper(_effect9.value),_step404;try{for(_iterator404.s();!(_step404=_iterator404.n()).done;){var active=_step404.value;if(active.source==value.source)value=active}}catch(err){_iterator404.e(err)}finally{_iterator404.f()}}}}catch(err){_iterator403.e(err)}finally{_iterator403.f()}return value}},{key:"handleUserEvent",value:function handleUserEvent(tr,type,conf){return type=="delete"||!conf.activateOnTyping?this.map(tr.changes):new ActiveSource(this.source,1)}},{key:"handleChange",value:function handleChange(tr){return tr.changes.touchesRange(cur(tr.startState))?new ActiveSource(this.source,0):this.map(tr.changes)}},{key:"map",value:function map(changes){return changes.empty||this.explicitPos<0?this:new ActiveSource(this.source,this.state,changes.mapPos(this.explicitPos))}}]);return ActiveSource}();var ActiveResult=function(_ActiveSource){_inherits2(ActiveResult,_ActiveSource);var _super106=_createSuper(ActiveResult);function ActiveResult(source,explicitPos,result,from,to){var _this258;_classCallCheck2(this,ActiveResult);_this258=_super106.call(this,source,2,explicitPos);_this258.result=result;_this258.from=from;_this258.to=to;return _this258}_createClass2(ActiveResult,[{key:"hasResult",value:function hasResult(){return true}},{key:"handleUserEvent",value:function handleUserEvent(tr,type,conf){var _a;var from=tr.changes.mapPos(this.from),to=tr.changes.mapPos(this.to,1);var pos=cur(tr.state);if((this.explicitPos<0?pos<=from:pos<this.from)||pos>to||type=="delete"&&cur(tr.startState)==this.from)return new ActiveSource(this.source,type=="input"&&conf.activateOnTyping?1:0);var explicitPos=this.explicitPos<0?-1:tr.changes.mapPos(this.explicitPos),updated;if(checkValid(this.result.validFor,tr.state,from,to))return new ActiveResult(this.source,explicitPos,this.result,from,to);if(this.result.update&&(updated=this.result.update(this.result,from,to,new CompletionContext(tr.state,pos,explicitPos>=0))))return new ActiveResult(this.source,explicitPos,updated,updated.from,(_a=updated.to)!==null&&_a!==void 0?_a:cur(tr.state));return new ActiveSource(this.source,1,explicitPos)}},{key:"handleChange",value:function handleChange(tr){return tr.changes.touchesRange(this.from,this.to)?new ActiveSource(this.source,0):this.map(tr.changes)}},{key:"map",value:function map(mapping){return mapping.empty?this:new ActiveResult(this.source,this.explicitPos<0?-1:mapping.mapPos(this.explicitPos),this.result,mapping.mapPos(this.from),mapping.mapPos(this.to,1))}}]);return ActiveResult}(ActiveSource);function checkValid(validFor,state,from,to){if(!validFor)return false;var text=state.sliceDoc(from,to);return typeof validFor=="function"?validFor(text,from,to,state):ensureAnchor(validFor,true).test(text)}var setActiveEffect=StateEffect.define({map:function map(sources,mapping){return sources.map(function(s){return s.map(mapping)})}});var setSelectedEffect=StateEffect.define();var completionState=StateField.define({create:function create(){return CompletionState.start()},update:function update(value,tr){return value.update(tr)},provide:function provide(f){return[showTooltip.from(f,function(val){return val.tooltip}),EditorView.contentAttributes.from(f,function(state){return state.attrs})]}});function applyCompletion(view,option){var apply=option.completion.apply||option.completion.label;var result=view.state.field(completionState).active.find(function(a){return a.source==option.source});if(!(result instanceof ActiveResult))return false;if(typeof apply=="string")view.dispatch(Object.assign(Object.assign({},insertCompletionText(view.state,apply,result.from,result.to)),{annotations:pickedCompletion.of(option.completion)}));else apply(view,option.completion,result.from,result.to);return true}var createTooltip=completionTooltip(completionState,applyCompletion);function moveCompletionSelection(forward){var by=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"option";return function(view){var cState=view.state.field(completionState,false);if(!cState||!cState.open||cState.open.disabled||Date.now()-cState.open.timestamp<view.state.facet(completionConfig).interactionDelay)return false;var step=1,tooltip;if(by=="page"&&(tooltip=getTooltip(view,cState.open.tooltip)))step=Math.max(2,Math.floor(tooltip.dom.offsetHeight/tooltip.dom.querySelector("li").offsetHeight)-1);var length=cState.open.options.length;var selected=cState.open.selected>-1?cState.open.selected+step*(forward?1:-1):forward?0:length-1;if(selected<0)selected=by=="page"?0:length-1;else if(selected>=length)selected=by=="page"?length-1:0;view.dispatch({effects:setSelectedEffect.of(selected)});return true}}var acceptCompletion=function acceptCompletion(view){var cState=view.state.field(completionState,false);if(view.state.readOnly||!cState||!cState.open||cState.open.selected<0||cState.open.disabled||Date.now()-cState.open.timestamp<view.state.facet(completionConfig).interactionDelay)return false;return applyCompletion(view,cState.open.options[cState.open.selected])};var startCompletion=function startCompletion(view){var cState=view.state.field(completionState,false);if(!cState)return false;view.dispatch({effects:startCompletionEffect.of(true)});return true};var closeCompletion=function closeCompletion(view){var cState=view.state.field(completionState,false);if(!cState||!cState.active.some(function(a){return a.state!=0}))return false;view.dispatch({effects:closeCompletionEffect.of(null)});return true};var RunningQuery=_createClass2(function RunningQuery(active,context){_classCallCheck2(this,RunningQuery);this.active=active;this.context=context;this.time=Date.now();this.updates=[];this.done=undefined});var MaxUpdateCount=50,MinAbortTime=1000;var completionPlugin=ViewPlugin.fromClass(function(){function _class71(view){_classCallCheck2(this,_class71);this.view=view;this.debounceUpdate=-1;this.running=[];this.debounceAccept=-1;this.composing=0;var _iterator405=_createForOfIteratorHelper(view.state.field(completionState).active),_step405;try{for(_iterator405.s();!(_step405=_iterator405.n()).done;){var active=_step405.value;if(active.state==1)this.startQuery(active)}}catch(err){_iterator405.e(err)}finally{_iterator405.f()}}_createClass2(_class71,[{key:"update",value:function update(_update26){var _this259=this;var cState=_update26.state.field(completionState);if(!_update26.selectionSet&&!_update26.docChanged&&_update26.startState.field(completionState)==cState)return;var doesReset=_update26.transactions.some(function(tr){return(tr.selection||tr.docChanged)&&!getUserEvent(tr)});for(var _i256=0;_i256<this.running.length;_i256++){var query=this.running[_i256];if(doesReset||query.updates.length+_update26.transactions.length>MaxUpdateCount&&Date.now()-query.time>MinAbortTime){var _iterator406=_createForOfIteratorHelper(query.context.abortListeners),_step406;try{for(_iterator406.s();!(_step406=_iterator406.n()).done;){var handler=_step406.value;try{handler()}catch(e){logException(this.view.state,e)}}}catch(err){_iterator406.e(err)}finally{_iterator406.f()}query.context.abortListeners=null;this.running.splice(_i256--,1)}else{var _query$updates;(_query$updates=query.updates).push.apply(_query$updates,_toConsumableArray2(_update26.transactions))}}if(this.debounceUpdate>-1)clearTimeout(this.debounceUpdate);this.debounceUpdate=cState.active.some(function(a){return a.state==1&&!_this259.running.some(function(q){return q.active.source==a.source})})?setTimeout(function(){return _this259.startUpdate()},50):-1;if(this.composing!=0){var _iterator407=_createForOfIteratorHelper(_update26.transactions),_step407;try{for(_iterator407.s();!(_step407=_iterator407.n()).done;){var tr=_step407.value;if(getUserEvent(tr)=="input")this.composing=2;else if(this.composing==2&&tr.selection)this.composing=3}}catch(err){_iterator407.e(err)}finally{_iterator407.f()}}}},{key:"startUpdate",value:function startUpdate(){var _this260=this;this.debounceUpdate=-1;var state=this.view.state,cState=state.field(completionState);var _iterator408=_createForOfIteratorHelper(cState.active),_step408;try{var _loop25=function _loop25(){var active=_step408.value;if(active.state==1&&!_this260.running.some(function(r){return r.active.source==active.source}))_this260.startQuery(active)};for(_iterator408.s();!(_step408=_iterator408.n()).done;){_loop25()}}catch(err){_iterator408.e(err)}finally{_iterator408.f()}}},{key:"startQuery",value:function startQuery(active){var _this261=this;var state=this.view.state,pos=cur(state);var context=new CompletionContext(state,pos,active.explicitPos==pos);var pending=new RunningQuery(active,context);this.running.push(pending);Promise.resolve(active.source(context)).then(function(result){if(!pending.context.aborted){pending.done=result||null;_this261.scheduleAccept()}},function(err){_this261.view.dispatch({effects:closeCompletionEffect.of(null)});logException(_this261.view.state,err)})}},{key:"scheduleAccept",value:function scheduleAccept(){var _this262=this;if(this.running.every(function(q){return q.done!==undefined}))this.accept();else if(this.debounceAccept<0)this.debounceAccept=setTimeout(function(){return _this262.accept()},this.view.state.facet(completionConfig).updateSyncTime)}},{key:"accept",value:function accept(){var _this263=this;var _a;if(this.debounceAccept>-1)clearTimeout(this.debounceAccept);this.debounceAccept=-1;var updated=[];var conf=this.view.state.facet(completionConfig);var _loop26=function _loop26(_i258){var query=_this263.running[_i258];if(query.done===undefined){_i257=_i258;return 0}_this263.running.splice(_i258--,1);if(query.done){var active=new ActiveResult(query.active.source,query.active.explicitPos,query.done,query.done.from,(_a=query.done.to)!==null&&_a!==void 0?_a:cur(query.updates.length?query.updates[0].startState:_this263.view.state));var _iterator409=_createForOfIteratorHelper(query.updates),_step409;try{for(_iterator409.s();!(_step409=_iterator409.n()).done;){var tr=_step409.value;active=active.update(tr,conf)}}catch(err){_iterator409.e(err)}finally{_iterator409.f()}if(active.hasResult()){updated.push(active);_i257=_i258;return 0}}var current=_this263.view.state.field(completionState).active.find(function(a){return a.source==query.active.source});if(current&&current.state==1){if(query.done==null){var _active=new ActiveSource(query.active.source,0);var _iterator410=_createForOfIteratorHelper(query.updates),_step410;try{for(_iterator410.s();!(_step410=_iterator410.n()).done;){var _tr2=_step410.value;_active=_active.update(_tr2,conf)}}catch(err){_iterator410.e(err)}finally{_iterator410.f()}if(_active.state!=1)updated.push(_active)}else{_this263.startQuery(current)}}_i257=_i258},_ret4;for(var _i257=0;_i257<this.running.length;_i257++){_ret4=_loop26(_i257);if(_ret4===0)continue}if(updated.length)this.view.dispatch({effects:setActiveEffect.of(updated)})}}]);return _class71}(),{eventHandlers:{blur:function blur(event){var state=this.view.state.field(completionState,false);if(state&&state.tooltip&&this.view.state.facet(completionConfig).closeOnBlur){var dialog=state.open&&getTooltip(this.view,state.open.tooltip);if(!dialog||!dialog.dom.contains(event.relatedTarget))this.view.dispatch({effects:closeCompletionEffect.of(null)})}},compositionstart:function compositionstart(){this.composing=1},compositionend:function compositionend(){var _this264=this;if(this.composing==3){setTimeout(function(){return _this264.view.dispatch({effects:startCompletionEffect.of(false)})},20)}this.composing=0}}});var baseTheme$1=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:0.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:"\"\xB7\xB7\xB7\"",opacity:0.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"".concat(400,"px"),boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"".concat(30,"px")},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"".concat(30,"px")},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\uD835\uDC65'"}},".cm-completionIcon-constant":{"&:after":{content:"'\uD835\uDC36'"}},".cm-completionIcon-type":{"&:after":{content:"'\uD835\uDC61'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\uD83D\uDD11\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});var FieldPos=_createClass2(function FieldPos(field,line,from,to){_classCallCheck2(this,FieldPos);this.field=field;this.line=line;this.from=from;this.to=to});var FieldRange=function(){function FieldRange(field,from,to){_classCallCheck2(this,FieldRange);this.field=field;this.from=from;this.to=to}_createClass2(FieldRange,[{key:"map",value:function map(changes){var from=changes.mapPos(this.from,-1,MapMode.TrackDel);var to=changes.mapPos(this.to,1,MapMode.TrackDel);return from==null||to==null?null:new FieldRange(this.field,from,to)}}]);return FieldRange}();var Snippet=function(){function Snippet(lines,fieldPositions){_classCallCheck2(this,Snippet);this.lines=lines;this.fieldPositions=fieldPositions}_createClass2(Snippet,[{key:"instantiate",value:function instantiate(state,pos){var text=[],lineStart=[pos];var lineObj=state.doc.lineAt(pos),baseIndent=/^\s*/.exec(lineObj.text)[0];var _iterator411=_createForOfIteratorHelper(this.lines),_step411;try{for(_iterator411.s();!(_step411=_iterator411.n()).done;){var line=_step411.value;if(text.length){var indent=baseIndent,tabs=/^\t*/.exec(line)[0].length;for(var _i259=0;_i259<tabs;_i259++)indent+=state.facet(indentUnit);lineStart.push(pos+indent.length-tabs);line=indent+line.slice(tabs)}text.push(line);pos+=line.length+1}}catch(err){_iterator411.e(err)}finally{_iterator411.f()}var ranges=this.fieldPositions.map(function(pos){return new FieldRange(pos.field,lineStart[pos.line]+pos.from,lineStart[pos.line]+pos.to)});return{text:text,ranges:ranges}}}],[{key:"parse",value:function parse(template){var fields=[];var lines=[],positions=[],m;var _iterator412=_createForOfIteratorHelper(template.split(/\r\n?|\n/)),_step412;try{for(_iterator412.s();!(_step412=_iterator412.n()).done;){var line=_step412.value;while(m=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(line)){var seq=m[1]?+m[1]:null,_name28=m[2]||m[3]||"",found=-1;for(var _i260=0;_i260<fields.length;_i260++){if(seq!=null?fields[_i260].seq==seq:_name28?fields[_i260].name==_name28:false)found=_i260}if(found<0){var _i261=0;while(_i261<fields.length&&(seq==null||fields[_i261].seq!=null&&fields[_i261].seq<seq))_i261++;fields.splice(_i261,0,{seq:seq,name:_name28});found=_i261;var _iterator413=_createForOfIteratorHelper(positions),_step413;try{for(_iterator413.s();!(_step413=_iterator413.n()).done;){var pos=_step413.value;if(pos.field>=found)pos.field++}}catch(err){_iterator413.e(err)}finally{_iterator413.f()}}positions.push(new FieldPos(found,lines.length,m.index,m.index+_name28.length));line=line.slice(0,m.index)+_name28+line.slice(m.index+m[0].length)}for(var esc;esc=/\\([{}])/.exec(line);){line=line.slice(0,esc.index)+esc[1]+line.slice(esc.index+esc[0].length);var _iterator414=_createForOfIteratorHelper(positions),_step414;try{for(_iterator414.s();!(_step414=_iterator414.n()).done;){var _pos5=_step414.value;if(_pos5.line==lines.length&&_pos5.from>esc.index){_pos5.from--;_pos5.to--}}}catch(err){_iterator414.e(err)}finally{_iterator414.f()}}lines.push(line)}}catch(err){_iterator412.e(err)}finally{_iterator412.f()}return new Snippet(lines,positions)}}]);return Snippet}();var fieldMarker=Decoration.widget({widget:new(function(_WidgetType9){_inherits2(_class72,_WidgetType9);var _super107=_createSuper(_class72);function _class72(){_classCallCheck2(this,_class72);return _super107.apply(this,arguments)}_createClass2(_class72,[{key:"toDOM",value:function toDOM(){var span=document.createElement("span");span.className="cm-snippetFieldPosition";return span}},{key:"ignoreEvent",value:function ignoreEvent(){return false}}]);return _class72}(WidgetType))});var fieldRange=Decoration.mark({"class":"cm-snippetField"});var ActiveSnippet=function(){function ActiveSnippet(ranges,active){_classCallCheck2(this,ActiveSnippet);this.ranges=ranges;this.active=active;this.deco=Decoration.set(ranges.map(function(r){return(r.from==r.to?fieldMarker:fieldRange).range(r.from,r.to)}))}_createClass2(ActiveSnippet,[{key:"map",value:function map(changes){var ranges=[];var _iterator415=_createForOfIteratorHelper(this.ranges),_step415;try{for(_iterator415.s();!(_step415=_iterator415.n()).done;){var _r13=_step415.value;var mapped=_r13.map(changes);if(!mapped)return null;ranges.push(mapped)}}catch(err){_iterator415.e(err)}finally{_iterator415.f()}return new ActiveSnippet(ranges,this.active)}},{key:"selectionInsideField",value:function selectionInsideField(sel){var _this265=this;return sel.ranges.every(function(range){return _this265.ranges.some(function(r){return r.field==_this265.active&&r.from<=range.from&&r.to>=range.to})})}}]);return ActiveSnippet}();var setActive=StateEffect.define({map:function map(value,changes){return value&&value.map(changes)}});var moveToField=StateEffect.define();var snippetState=StateField.define({create:function create(){return null},update:function update(value,tr){var _iterator416=_createForOfIteratorHelper(tr.effects),_step416;try{for(_iterator416.s();!(_step416=_iterator416.n()).done;){var _effect10=_step416.value;if(_effect10.is(setActive))return _effect10.value;if(_effect10.is(moveToField)&&value)return new ActiveSnippet(value.ranges,_effect10.value)}}catch(err){_iterator416.e(err)}finally{_iterator416.f()}if(value&&tr.docChanged)value=value.map(tr.changes);if(value&&tr.selection&&!value.selectionInsideField(tr.selection))value=null;return value},provide:function provide(f){return EditorView.decorations.from(f,function(val){return val?val.deco:Decoration.none})}});function fieldSelection(ranges,field){return EditorSelection.create(ranges.filter(function(r){return r.field==field}).map(function(r){return EditorSelection.range(r.from,r.to)}))}function snippet(template){var snippet=Snippet.parse(template);return function(editor,completion,from,to){var _snippet$instantiate=snippet.instantiate(editor.state,from),text=_snippet$instantiate.text,ranges=_snippet$instantiate.ranges;var spec={changes:{from:from,to:to,insert:Text.of(text)},scrollIntoView:true,annotations:completion?pickedCompletion.of(completion):undefined};if(ranges.length)spec.selection=fieldSelection(ranges,0);if(ranges.length>1){var active=new ActiveSnippet(ranges,0);var effects=spec.effects=[setActive.of(active)];if(editor.state.field(snippetState,false)===undefined)effects.push(StateEffect.appendConfig.of([snippetState,addSnippetKeymap,snippetPointerHandler,baseTheme$1]))}editor.dispatch(editor.state.update(spec))}}function moveField(dir){return function(_ref272){var state=_ref272.state,dispatch=_ref272.dispatch;var active=state.field(snippetState,false);if(!active||dir<0&&active.active==0)return false;var next=active.active+dir,last=dir>0&&!active.ranges.some(function(r){return r.field==next+dir});dispatch(state.update({selection:fieldSelection(active.ranges,next),effects:setActive.of(last?null:new ActiveSnippet(active.ranges,next)),scrollIntoView:true}));return true}}var clearSnippet=function clearSnippet(_ref273){var state=_ref273.state,dispatch=_ref273.dispatch;var active=state.field(snippetState,false);if(!active)return false;dispatch(state.update({effects:setActive.of(null)}));return true};var nextSnippetField=moveField(1);var prevSnippetField=moveField(-1);var defaultSnippetKeymap=[{key:"Tab",run:nextSnippetField,shift:prevSnippetField},{key:"Escape",run:clearSnippet}];var snippetKeymap=Facet.define({combine:function combine(maps){return maps.length?maps[0]:defaultSnippetKeymap}});var addSnippetKeymap=Prec.highest(keymap.compute([snippetKeymap],function(state){return state.facet(snippetKeymap)}));function snippetCompletion(template,completion){return Object.assign(Object.assign({},completion),{apply:snippet(template)})}var snippetPointerHandler=EditorView.domEventHandlers({mousedown:function mousedown(event,view){var active=view.state.field(snippetState,false),pos;if(!active||(pos=view.posAtCoords({x:event.clientX,y:event.clientY}))==null)return false;var match=active.ranges.find(function(r){return r.from<=pos&&r.to>=pos});if(!match||match.field==active.active)return false;view.dispatch({selection:fieldSelection(active.ranges,match.field),effects:setActive.of(active.ranges.some(function(r){return r.field>match.field})?new ActiveSnippet(active.ranges,match.field):null),scrollIntoView:true});return true}});var defaults={brackets:["(","[","{","'","\""],before:")]}:;>",stringPrefixes:[]};var closeBracketEffect=StateEffect.define({map:function map(value,mapping){var mapped=mapping.mapPos(value,-1,MapMode.TrackAfter);return mapped==null?undefined:mapped}});var closedBracket=new(function(_RangeValue3){_inherits2(_class73,_RangeValue3);var _super108=_createSuper(_class73);function _class73(){_classCallCheck2(this,_class73);return _super108.apply(this,arguments)}return _createClass2(_class73)}(RangeValue));closedBracket.startSide=1;closedBracket.endSide=-1;var bracketState=StateField.define({create:function create(){return RangeSet.empty},update:function update(value,tr){value=value.map(tr.changes);if(tr.selection){var line=tr.state.doc.lineAt(tr.selection.main.head);value=value.update({filter:function filter(from){return from>=line.from&&from<=line.to}})}var _iterator417=_createForOfIteratorHelper(tr.effects),_step417;try{for(_iterator417.s();!(_step417=_iterator417.n()).done;){var _effect11=_step417.value;if(_effect11.is(closeBracketEffect))value=value.update({add:[closedBracket.range(_effect11.value,_effect11.value+1)]})}}catch(err){_iterator417.e(err)}finally{_iterator417.f()}return value}});function closeBrackets(){return[inputHandler,bracketState]}var definedClosing="()[]{}<>";function closing(ch){for(var _i262=0;_i262<definedClosing.length;_i262+=2)if(definedClosing.charCodeAt(_i262)==ch)return definedClosing.charAt(_i262+1);return fromCodePoint(ch<128?ch:ch+1)}function config(state,pos){return state.languageDataAt("closeBrackets",pos)[0]||defaults}var android$1=(typeof navigator==="undefined"?"undefined":_typeof2(navigator))=="object"&&/Android\b/.test(navigator.userAgent);var inputHandler=EditorView.inputHandler.of(function(view,from,to,insert){if((android$1?view.composing:view.compositionStarted)||view.state.readOnly)return false;var sel=view.state.selection.main;if(insert.length>2||insert.length==2&&codePointSize(codePointAt(insert,0))==1||from!=sel.from||to!=sel.to)return false;var tr=insertBracket(view.state,insert);if(!tr)return false;view.dispatch(tr);return true});var deleteBracketPair=function deleteBracketPair(_ref274){var state=_ref274.state,dispatch=_ref274.dispatch;if(state.readOnly)return false;var conf=config(state,state.selection.main.head);var tokens=conf.brackets||defaults.brackets;var dont=null,changes=state.changeByRange(function(range){if(range.empty){var _before3=prevChar(state.doc,range.head);var _iterator418=_createForOfIteratorHelper(tokens),_step418;try{for(_iterator418.s();!(_step418=_iterator418.n()).done;){var token=_step418.value;if(token==_before3&&nextChar(state.doc,range.head)==closing(codePointAt(token,0)))return{changes:{from:range.head-token.length,to:range.head+token.length},range:EditorSelection.cursor(range.head-token.length)}}}catch(err){_iterator418.e(err)}finally{_iterator418.f()}}return{range:dont=range}});if(!dont)dispatch(state.update(changes,{scrollIntoView:true,userEvent:"delete.backward"}));return!dont};var closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(state,bracket){var conf=config(state,state.selection.main.head);var tokens=conf.brackets||defaults.brackets;var _iterator419=_createForOfIteratorHelper(tokens),_step419;try{for(_iterator419.s();!(_step419=_iterator419.n()).done;){var tok=_step419.value;var closed=closing(codePointAt(tok,0));if(bracket==tok)return closed==tok?handleSame(state,tok,tokens.indexOf(tok+tok+tok)>-1,conf):handleOpen(state,tok,closed,conf.before||defaults.before);if(bracket==closed&&closedBracketAt(state,state.selection.main.from))return handleClose(state,tok,closed)}}catch(err){_iterator419.e(err)}finally{_iterator419.f()}return null}function closedBracketAt(state,pos){var found=false;state.field(bracketState).between(0,state.doc.length,function(from){if(from==pos)found=true});return found}function nextChar(doc,pos){var next=doc.sliceString(pos,pos+2);return next.slice(0,codePointSize(codePointAt(next,0)))}function prevChar(doc,pos){var prev=doc.sliceString(pos-2,pos);return codePointSize(codePointAt(prev,0))==prev.length?prev:prev.slice(1)}function handleOpen(state,open,close,closeBefore){var dont=null,changes=state.changeByRange(function(range){if(!range.empty)return{changes:[{insert:open,from:range.from},{insert:close,from:range.to}],effects:closeBracketEffect.of(range.to+open.length),range:EditorSelection.range(range.anchor+open.length,range.head+open.length)};var next=nextChar(state.doc,range.head);if(!next||/\s/.test(next)||closeBefore.indexOf(next)>-1)return{changes:{insert:open+close,from:range.head},effects:closeBracketEffect.of(range.head+open.length),range:EditorSelection.cursor(range.head+open.length)};return{range:dont=range}});return dont?null:state.update(changes,{scrollIntoView:true,userEvent:"input.type"})}function handleClose(state,_open,close){var dont=null,changes=state.changeByRange(function(range){if(range.empty&&nextChar(state.doc,range.head)==close)return{changes:{from:range.head,to:range.head+close.length,insert:close},range:EditorSelection.cursor(range.head+close.length)};return dont={range:range}});return dont?null:state.update(changes,{scrollIntoView:true,userEvent:"input.type"})}function handleSame(state,token,allowTriple,config){var stringPrefixes=config.stringPrefixes||defaults.stringPrefixes;var dont=null,changes=state.changeByRange(function(range){if(!range.empty)return{changes:[{insert:token,from:range.from},{insert:token,from:range.to}],effects:closeBracketEffect.of(range.to+token.length),range:EditorSelection.range(range.anchor+token.length,range.head+token.length)};var pos=range.head,next=nextChar(state.doc,pos),start;if(next==token){if(nodeStart(state,pos)){return{changes:{insert:token+token,from:pos},effects:closeBracketEffect.of(pos+token.length),range:EditorSelection.cursor(pos+token.length)}}else if(closedBracketAt(state,pos)){var isTriple=allowTriple&&state.sliceDoc(pos,pos+token.length*3)==token+token+token;var _content7=isTriple?token+token+token:token;return{changes:{from:pos,to:pos+_content7.length,insert:_content7},range:EditorSelection.cursor(pos+_content7.length)}}}else if(allowTriple&&state.sliceDoc(pos-2*token.length,pos)==token+token&&(start=canStartStringAt(state,pos-2*token.length,stringPrefixes))>-1&&nodeStart(state,start)){return{changes:{insert:token+token+token+token,from:pos},effects:closeBracketEffect.of(pos+token.length),range:EditorSelection.cursor(pos+token.length)}}else if(state.charCategorizer(pos)(next)!=CharCategory.Word){if(canStartStringAt(state,pos,stringPrefixes)>-1&&!probablyInString(state,pos,token,stringPrefixes))return{changes:{insert:token+token,from:pos},effects:closeBracketEffect.of(pos+token.length),range:EditorSelection.cursor(pos+token.length)}}return{range:dont=range}});return dont?null:state.update(changes,{scrollIntoView:true,userEvent:"input.type"})}function nodeStart(state,pos){var tree=syntaxTree(state).resolveInner(pos+1);return tree.parent&&tree.from==pos}function probablyInString(state,pos,quoteToken,prefixes){var node=syntaxTree(state).resolveInner(pos,-1);var maxPrefix=prefixes.reduce(function(m,p){return Math.max(m,p.length)},0);for(var _i263=0;_i263<5;_i263++){var _start21=state.sliceDoc(node.from,Math.min(node.to,node.from+quoteToken.length+maxPrefix));var quotePos=_start21.indexOf(quoteToken);if(!quotePos||quotePos>-1&&prefixes.indexOf(_start21.slice(0,quotePos))>-1){var first=node.firstChild;while(first&&first.from==node.from&&first.to-first.from>quoteToken.length+quotePos){if(state.sliceDoc(first.to-quoteToken.length,first.to)==quoteToken)return false;first=first.firstChild}return true}var parent=node.to==pos&&node.parent;if(!parent)break;node=parent}return false}function canStartStringAt(state,pos,prefixes){var charCat=state.charCategorizer(pos);if(charCat(state.sliceDoc(pos-1,pos))!=CharCategory.Word)return pos;var _iterator420=_createForOfIteratorHelper(prefixes),_step420;try{for(_iterator420.s();!(_step420=_iterator420.n()).done;){var _prefix=_step420.value;var _start22=pos-_prefix.length;if(state.sliceDoc(_start22,pos)==_prefix&&charCat(state.sliceDoc(_start22-1,_start22))!=CharCategory.Word)return _start22}}catch(err){_iterator420.e(err)}finally{_iterator420.f()}return-1}function autocompletion(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[completionState,completionConfig.of(config),completionPlugin,completionKeymapExt,baseTheme$1]}var completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(true)},{key:"ArrowUp",run:moveCompletionSelection(false)},{key:"PageDown",run:moveCompletionSelection(true,"page")},{key:"PageUp",run:moveCompletionSelection(false,"page")},{key:"Enter",run:acceptCompletion}];var completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],function(state){return state.facet(completionConfig).defaultKeymap?[completionKeymap]:[]}));var SelectedDiagnostic=_createClass2(function SelectedDiagnostic(from,to,diagnostic){_classCallCheck2(this,SelectedDiagnostic);this.from=from;this.to=to;this.diagnostic=diagnostic});var LintState=function(){function LintState(diagnostics,panel,selected){_classCallCheck2(this,LintState);this.diagnostics=diagnostics;this.panel=panel;this.selected=selected}_createClass2(LintState,null,[{key:"init",value:function init(diagnostics,panel,state){var markedDiagnostics=diagnostics;var diagnosticFilter=state.facet(lintConfig).markerFilter;if(diagnosticFilter)markedDiagnostics=diagnosticFilter(markedDiagnostics);var ranges=Decoration.set(markedDiagnostics.map(function(d){return d.from==d.to||d.from==d.to-1&&state.doc.lineAt(d.from).to==d.from?Decoration.widget({widget:new DiagnosticWidget(d),diagnostic:d}).range(d.from):Decoration.mark({attributes:{"class":"cm-lintRange cm-lintRange-"+d.severity+(d.markClass?" "+d.markClass:"")},diagnostic:d}).range(d.from,d.to)}),true);return new LintState(ranges,panel,findDiagnostic(ranges))}}]);return LintState}();function findDiagnostic(diagnostics){var diagnostic=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var after=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var found=null;diagnostics.between(after,1e9,function(from,to,_ref275){var spec=_ref275.spec;if(diagnostic&&spec.diagnostic!=diagnostic)return;found=new SelectedDiagnostic(from,to,spec.diagnostic);return false});return found}function hideTooltip(tr,tooltip){var line=tr.startState.doc.lineAt(tooltip.pos);return!!(tr.effects.some(function(e){return e.is(setDiagnosticsEffect)})||tr.changes.touchesRange(line.from,line.to))}function maybeEnableLint(state,effects){return state.field(lintState,false)?effects:effects.concat(StateEffect.appendConfig.of(lintExtensions))}var setDiagnosticsEffect=StateEffect.define();var togglePanel=StateEffect.define();var movePanelSelection=StateEffect.define();var lintState=StateField.define({create:function create(){return new LintState(Decoration.none,null,null)},update:function update(value,tr){if(tr.docChanged){var mapped=value.diagnostics.map(tr.changes),selected=null;if(value.selected){var selPos=tr.changes.mapPos(value.selected.from,1);selected=findDiagnostic(mapped,value.selected.diagnostic,selPos)||findDiagnostic(mapped,null,selPos)}value=new LintState(mapped,value.panel,selected)}var _iterator421=_createForOfIteratorHelper(tr.effects),_step421;try{for(_iterator421.s();!(_step421=_iterator421.n()).done;){var _effect12=_step421.value;if(_effect12.is(setDiagnosticsEffect)){value=LintState.init(_effect12.value,value.panel,tr.state)}else if(_effect12.is(togglePanel)){value=new LintState(value.diagnostics,_effect12.value?LintPanel.open:null,value.selected)}else if(_effect12.is(movePanelSelection)){value=new LintState(value.diagnostics,value.panel,_effect12.value)}}}catch(err){_iterator421.e(err)}finally{_iterator421.f()}return value},provide:function provide(f){return[showPanel.from(f,function(val){return val.panel}),EditorView.decorations.from(f,function(s){return s.diagnostics})]}});var activeMark=Decoration.mark({"class":"cm-lintRange cm-lintRange-active"});function lintTooltip(view,pos,side){var _view$state$field=view.state.field(lintState),diagnostics=_view$state$field.diagnostics;var found=[],stackStart=2e8,stackEnd=0;diagnostics.between(pos-(side<0?1:0),pos+(side>0?1:0),function(from,to,_ref276){var spec=_ref276.spec;if(pos>=from&&pos<=to&&(from==to||(pos>from||side>0)&&(pos<to||side<0))){found.push(spec.diagnostic);stackStart=Math.min(from,stackStart);stackEnd=Math.max(to,stackEnd)}});var diagnosticFilter=view.state.facet(lintConfig).tooltipFilter;if(diagnosticFilter)found=diagnosticFilter(found);if(!found.length)return null;return{pos:stackStart,end:stackEnd,above:view.state.doc.lineAt(stackStart).to<stackEnd,create:function create(){return{dom:diagnosticsTooltip(view,found)}}}}function diagnosticsTooltip(view,diagnostics){return crelt("ul",{"class":"cm-tooltip-lint"},diagnostics.map(function(d){return renderDiagnostic(view,d,false)}))}var openLintPanel=function openLintPanel(view){var field=view.state.field(lintState,false);if(!field||!field.panel)view.dispatch({effects:maybeEnableLint(view.state,[togglePanel.of(true)])});var panel=getPanel(view,LintPanel.open);if(panel)panel.dom.querySelector(".cm-panel-lint ul").focus();return true};var closeLintPanel=function closeLintPanel(view){var field=view.state.field(lintState,false);if(!field||!field.panel)return false;view.dispatch({effects:togglePanel.of(false)});return true};var nextDiagnostic=function nextDiagnostic(view){var field=view.state.field(lintState,false);if(!field)return false;var sel=view.state.selection.main,next=field.diagnostics.iter(sel.to+1);if(!next.value){next=field.diagnostics.iter(0);if(!next.value||next.from==sel.from&&next.to==sel.to)return false}view.dispatch({selection:{anchor:next.from,head:next.to},scrollIntoView:true});return true};var lintKeymap=[{key:"Mod-Shift-m",run:openLintPanel,preventDefault:true},{key:"F8",run:nextDiagnostic}];var lintConfig=Facet.define({combine:function combine(input){return Object.assign({sources:input.map(function(i){return i.source})},combineConfig(input.map(function(i){return i.config}),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:function needsRefresh(a,b){return!a?b:!b?a:function(u){return a(u)||b(u)}}}))}});function assignKeys(actions){var assigned=[];if(actions){var _iterator422=_createForOfIteratorHelper(actions),_step422;try{actions:for(_iterator422.s();!(_step422=_iterator422.n()).done;){var _name29=_step422.value.name;var _loop27=function _loop27(){var ch=_name29[_i264];if(/[a-zA-Z]/.test(ch)&&!assigned.some(function(c){return c.toLowerCase()==ch.toLowerCase()})){assigned.push(ch);return 1}};for(var _i264=0;_i264<_name29.length;_i264++){if(_loop27())continue actions}assigned.push("")}}catch(err){_iterator422.e(err)}finally{_iterator422.f()}}return assigned}function renderDiagnostic(view,diagnostic,inPanel){var _a;var keys=inPanel?assignKeys(diagnostic.actions):[];return crelt("li",{"class":"cm-diagnostic cm-diagnostic-"+diagnostic.severity},crelt("span",{"class":"cm-diagnosticText"},diagnostic.renderMessage?diagnostic.renderMessage():diagnostic.message),(_a=diagnostic.actions)===null||_a===void 0?void 0:_a.map(function(action,i){var fired=false,click=function click(e){e.preventDefault();if(fired)return;fired=true;var found=findDiagnostic(view.state.field(lintState).diagnostics,diagnostic);if(found)action.apply(view,found.from,found.to)};var name=action.name,keyIndex=keys[i]?name.indexOf(keys[i]):-1;var nameElt=keyIndex<0?name:[name.slice(0,keyIndex),crelt("u",name.slice(keyIndex,keyIndex+1)),name.slice(keyIndex+1)];return crelt("button",{type:"button","class":"cm-diagnosticAction",onclick:click,onmousedown:click,"aria-label":" Action: ".concat(name).concat(keyIndex<0?"":" (access key \"".concat(keys[i],")\""),".")},nameElt)}),diagnostic.source&&crelt("div",{"class":"cm-diagnosticSource"},diagnostic.source))}var DiagnosticWidget=function(_WidgetType10){_inherits2(DiagnosticWidget,_WidgetType10);var _super109=_createSuper(DiagnosticWidget);function DiagnosticWidget(diagnostic){var _this266;_classCallCheck2(this,DiagnosticWidget);_this266=_super109.call(this);_this266.diagnostic=diagnostic;return _this266}_createClass2(DiagnosticWidget,[{key:"eq",value:function eq(other){return other.diagnostic==this.diagnostic}},{key:"toDOM",value:function toDOM(){return crelt("span",{"class":"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}]);return DiagnosticWidget}(WidgetType);var PanelItem=_createClass2(function PanelItem(view,diagnostic){_classCallCheck2(this,PanelItem);this.diagnostic=diagnostic;this.id="item_"+Math.floor(Math.random()*4294967295).toString(16);this.dom=renderDiagnostic(view,diagnostic,true);this.dom.id=this.id;this.dom.setAttribute("role","option")});var LintPanel=function(){function LintPanel(view){var _this267=this;_classCallCheck2(this,LintPanel);this.view=view;this.items=[];var onkeydown=function onkeydown(event){if(event.keyCode==27){closeLintPanel(_this267.view);_this267.view.focus()}else if(event.keyCode==38||event.keyCode==33){_this267.moveSelection((_this267.selectedIndex-1+_this267.items.length)%_this267.items.length)}else if(event.keyCode==40||event.keyCode==34){_this267.moveSelection((_this267.selectedIndex+1)%_this267.items.length)}else if(event.keyCode==36){_this267.moveSelection(0)}else if(event.keyCode==35){_this267.moveSelection(_this267.items.length-1)}else if(event.keyCode==13){_this267.view.focus()}else if(event.keyCode>=65&&event.keyCode<=90&&_this267.selectedIndex>=0){var diagnostic=_this267.items[_this267.selectedIndex].diagnostic,_keys3=assignKeys(diagnostic.actions);for(var _i265=0;_i265<_keys3.length;_i265++)if(_keys3[_i265].toUpperCase().charCodeAt(0)==event.keyCode){var found=findDiagnostic(_this267.view.state.field(lintState).diagnostics,diagnostic);if(found)diagnostic.actions[_i265].apply(view,found.from,found.to)}}else{return}event.preventDefault()};var onclick=function onclick(event){for(var _i266=0;_i266<_this267.items.length;_i266++){if(_this267.items[_i266].dom.contains(event.target))_this267.moveSelection(_i266)}};this.list=crelt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:onkeydown,onclick:onclick});this.dom=crelt("div",{"class":"cm-panel-lint"},this.list,crelt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:function onclick(){return closeLintPanel(_this267.view)}},"\xD7"));this.update()}_createClass2(LintPanel,[{key:"selectedIndex",get:function get(){var selected=this.view.state.field(lintState).selected;if(!selected)return-1;for(var _i267=0;_i267<this.items.length;_i267++)if(this.items[_i267].diagnostic==selected.diagnostic)return _i267;return-1}},{key:"update",value:function update(){var _this268=this;var _this$view$state$fiel=this.view.state.field(lintState),diagnostics=_this$view$state$fiel.diagnostics,selected=_this$view$state$fiel.selected;var i=0,needsSync=false,newSelectedItem=null;diagnostics.between(0,this.view.state.doc.length,function(_start,_end,_ref277){var spec=_ref277.spec;var found=-1,item;for(var j=i;j<_this268.items.length;j++)if(_this268.items[j].diagnostic==spec.diagnostic){found=j;break}if(found<0){item=new PanelItem(_this268.view,spec.diagnostic);_this268.items.splice(i,0,item);needsSync=true}else{item=_this268.items[found];if(found>i){_this268.items.splice(i,found-i);needsSync=true}}if(selected&&item.diagnostic==selected.diagnostic){if(!item.dom.hasAttribute("aria-selected")){item.dom.setAttribute("aria-selected","true");newSelectedItem=item}}else if(item.dom.hasAttribute("aria-selected")){item.dom.removeAttribute("aria-selected")}i++});while(i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0)){needsSync=true;this.items.pop()}if(this.items.length==0){this.items.push(new PanelItem(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")}));needsSync=true}if(newSelectedItem){this.list.setAttribute("aria-activedescendant",newSelectedItem.id);this.view.requestMeasure({key:this,read:function read(){return{sel:newSelectedItem.dom.getBoundingClientRect(),panel:_this268.list.getBoundingClientRect()}},write:function write(_ref278){var sel=_ref278.sel,panel=_ref278.panel;var scaleY=panel.height/_this268.list.offsetHeight;if(sel.top<panel.top)_this268.list.scrollTop-=(panel.top-sel.top)/scaleY;else if(sel.bottom>panel.bottom)_this268.list.scrollTop+=(sel.bottom-panel.bottom)/scaleY}})}else if(this.selectedIndex<0){this.list.removeAttribute("aria-activedescendant")}if(needsSync)this.sync()}},{key:"sync",value:function sync(){var domPos=this.list.firstChild;function rm(){var prev=domPos;domPos=prev.nextSibling;prev.remove()}var _iterator423=_createForOfIteratorHelper(this.items),_step423;try{for(_iterator423.s();!(_step423=_iterator423.n()).done;){var item=_step423.value;if(item.dom.parentNode==this.list){while(domPos!=item.dom)rm();domPos=item.dom.nextSibling}else{this.list.insertBefore(item.dom,domPos)}}}catch(err){_iterator423.e(err)}finally{_iterator423.f()}while(domPos)rm()}},{key:"moveSelection",value:function moveSelection(selectedIndex){if(this.selectedIndex<0)return;var field=this.view.state.field(lintState);var selection=findDiagnostic(field.diagnostics,this.items[selectedIndex].diagnostic);if(!selection)return;this.view.dispatch({selection:{anchor:selection.from,head:selection.to},scrollIntoView:true,effects:movePanelSelection.of(selection)})}}],[{key:"open",value:function open(view){return new LintPanel(view)}}]);return LintPanel}();function svg(content){var attrs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"viewBox=\"0 0 40 40\"";return"url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" ".concat(attrs,">").concat(encodeURIComponent(content),"</svg>')")}function underline(color){return svg("<path d=\"m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0\" stroke=\"".concat(color,"\" fill=\"none\" stroke-width=\".7\"/>"),"width=\"6\" height=\"3\"")}var baseTheme=EditorView.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:underline("#d11")},".cm-lintRange-warning":{backgroundImage:underline("orange")},".cm-lintRange-info":{backgroundImage:underline("#999")},".cm-lintRange-hint":{backgroundImage:underline("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:"\"\"",position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});var lintExtensions=[lintState,EditorView.decorations.compute([lintState],function(state){var _state$field=state.field(lintState),selected=_state$field.selected,panel=_state$field.panel;return!selected||!panel||selected.from==selected.to?Decoration.none:Decoration.set([activeMark.range(selected.from,selected.to)])}),hoverTooltip(lintTooltip,{hideOn:hideTooltip}),baseTheme];var basicSetup=function basicSetup(options){if(options===void 0){options={}}var _options3=options,_options3$crosshairCu=_options3.crosshairCursor,initCrosshairCursor=_options3$crosshairCu===void 0?false:_options3$crosshairCu;var keymaps=[];if(options.closeBracketsKeymap!==false){keymaps=keymaps.concat(closeBracketsKeymap)}if(options.defaultKeymap!==false){keymaps=keymaps.concat(defaultKeymap)}if(options.searchKeymap!==false){keymaps=keymaps.concat(searchKeymap)}if(options.historyKeymap!==false){keymaps=keymaps.concat(historyKeymap)}if(options.foldKeymap!==false){keymaps=keymaps.concat(foldKeymap)}if(options.completionKeymap!==false){keymaps=keymaps.concat(completionKeymap)}if(options.lintKeymap!==false){keymaps=keymaps.concat(lintKeymap)}var extensions=[];if(options.lineNumbers!==false)extensions.push(lineNumbers());if(options.highlightActiveLineGutter!==false)extensions.push(highlightActiveLineGutter());if(options.highlightSpecialChars!==false)extensions.push(highlightSpecialChars());if(options.history!==false)extensions.push(history());if(options.foldGutter!==false)extensions.push(foldGutter());if(options.drawSelection!==false)extensions.push(drawSelection());if(options.dropCursor!==false)extensions.push(dropCursor());if(options.allowMultipleSelections!==false)extensions.push(EditorState.allowMultipleSelections.of(true));if(options.indentOnInput!==false)extensions.push(indentOnInput());if(options.syntaxHighlighting!==false)extensions.push(syntaxHighlighting(defaultHighlightStyle,{fallback:true}));if(options.bracketMatching!==false)extensions.push(bracketMatching());if(options.closeBrackets!==false)extensions.push(closeBrackets());if(options.autocompletion!==false)extensions.push(autocompletion());if(options.rectangularSelection!==false)extensions.push(rectangularSelection());if(initCrosshairCursor!==false)extensions.push(crosshairCursor());if(options.highlightActiveLine!==false)extensions.push(highlightActiveLine());if(options.highlightSelectionMatches!==false)extensions.push(highlightSelectionMatches());if(options.tabSize&&typeof options.tabSize==="number")extensions.push(indentUnit.of(" ".repeat(options.tabSize)));return extensions.concat([keymap.of(keymaps.flat())]).filter(Boolean)};var chalky="#e5c07b",coral="#e06c75",cyan="#56b6c2",invalid="#ffffff",ivory="#abb2bf",stone="#7d8799",malibu="#61afef",sage="#98c379",whiskey="#d19a66",violet="#c678dd",darkBackground="#21252b",highlightBackground="#2c313a",background="#282c34",tooltipBackground="#353a42",selection="#3E4451",cursor="#528bff";var oneDarkTheme=EditorView.theme({"&":{color:ivory,backgroundColor:background},".cm-content":{caretColor:cursor},".cm-cursor, .cm-dropCursor":{borderLeftColor:cursor},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:selection},".cm-panels":{backgroundColor:darkBackground,color:ivory},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:background,color:stone,border:"none"},".cm-activeLineGutter":{backgroundColor:highlightBackground},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:tooltipBackground},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:tooltipBackground,borderBottomColor:tooltipBackground},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:highlightBackground,color:ivory}}},{dark:true});var oneDarkHighlightStyle=HighlightStyle.define([{tag:tags$1.keyword,color:violet},{tag:[tags$1.name,tags$1.deleted,tags$1.character,tags$1.propertyName,tags$1.macroName],color:coral},{tag:[tags$1["function"](tags$1.variableName),tags$1.labelName],color:malibu},{tag:[tags$1.color,tags$1.constant(tags$1.name),tags$1.standard(tags$1.name)],color:whiskey},{tag:[tags$1.definition(tags$1.name),tags$1.separator],color:ivory},{tag:[tags$1.typeName,tags$1.className,tags$1.number,tags$1.changed,tags$1.annotation,tags$1.modifier,tags$1.self,tags$1.namespace],color:chalky},{tag:[tags$1.operator,tags$1.operatorKeyword,tags$1.url,tags$1.escape,tags$1.regexp,tags$1.link,tags$1.special(tags$1.string)],color:cyan},{tag:[tags$1.meta,tags$1.comment],color:stone},{tag:tags$1.strong,fontWeight:"bold"},{tag:tags$1.emphasis,fontStyle:"italic"},{tag:tags$1.strikethrough,textDecoration:"line-through"},{tag:tags$1.link,color:stone,textDecoration:"underline"},{tag:tags$1.heading,fontWeight:"bold",color:coral},{tag:[tags$1.atom,tags$1.bool,tags$1.special(tags$1.variableName)],color:whiskey},{tag:[tags$1.processingInstruction,tags$1.string,tags$1.inserted],color:sage},{tag:tags$1.invalid,color:invalid}]);var oneDark=[oneDarkTheme,syntaxHighlighting(oneDarkHighlightStyle)];var defaultLightThemeOption=EditorView.theme({"&":{backgroundColor:"#fff"}},{dark:false});var getDefaultExtensions=function getDefaultExtensions(optios){if(optios===void 0){optios={}}var _optios=optios,_optios$indentWithTab=_optios.indentWithTab,defaultIndentWithTab=_optios$indentWithTab===void 0?true:_optios$indentWithTab,_optios$editable=_optios.editable,editable=_optios$editable===void 0?true:_optios$editable,_optios$readOnly=_optios.readOnly,readOnly=_optios$readOnly===void 0?false:_optios$readOnly,_optios$theme=_optios.theme,theme=_optios$theme===void 0?"light":_optios$theme,_optios$placeholder=_optios.placeholder,placeholderStr=_optios$placeholder===void 0?"":_optios$placeholder,_optios$basicSetup=_optios.basicSetup,defaultBasicSetup=_optios$basicSetup===void 0?true:_optios$basicSetup;var getExtensions=[];if(defaultIndentWithTab){getExtensions.unshift(keymap.of([indentWithTab]))}if(defaultBasicSetup){if(typeof defaultBasicSetup==="boolean"){getExtensions.unshift(basicSetup())}else{getExtensions.unshift(basicSetup(defaultBasicSetup))}}if(placeholderStr){getExtensions.unshift(placeholder(placeholderStr))}switch(theme){case"light":getExtensions.push(defaultLightThemeOption);break;case"dark":getExtensions.push(oneDark);break;case"none":break;default:getExtensions.push(theme);break}if(editable===false){getExtensions.push(EditorView.editable.of(false))}if(readOnly){getExtensions.push(EditorState.readOnly.of(true))}return[].concat(getExtensions)};var getStatistics=function getStatistics(view){return{line:view.state.doc.lineAt(view.state.selection.main.from),lineCount:view.state.doc.lines,lineBreak:view.state.lineBreak,length:view.state.doc.length,readOnly:view.state.readOnly,tabSize:view.state.tabSize,selection:view.state.selection,selectionAsSingle:view.state.selection.asSingle().main,ranges:view.state.selection.ranges,selectionCode:view.state.sliceDoc(view.state.selection.main.from,view.state.selection.main.to),selections:view.state.selection.ranges.map(function(r){return view.state.sliceDoc(r.from,r.to)}),selectedText:view.state.selection.ranges.some(function(r){return!r.empty})}};var External=Annotation.define();var emptyExtensions=[];function useCodeMirror(props){var value=props.value,selection=props.selection,onChange=props.onChange,onStatistics=props.onStatistics,onCreateEditor=props.onCreateEditor,onUpdate=props.onUpdate,_props$extensions=props.extensions,extensions=_props$extensions===void 0?emptyExtensions:_props$extensions,autoFocus=props.autoFocus,_props$theme=props.theme,theme=_props$theme===void 0?"light":_props$theme,_props$height=props.height,height=_props$height===void 0?null:_props$height,_props$minHeight=props.minHeight,minHeight=_props$minHeight===void 0?null:_props$minHeight,_props$maxHeight=props.maxHeight,maxHeight=_props$maxHeight===void 0?null:_props$maxHeight,_props$width=props.width,width=_props$width===void 0?null:_props$width,_props$minWidth=props.minWidth,minWidth=_props$minWidth===void 0?null:_props$minWidth,_props$maxWidth=props.maxWidth,maxWidth=_props$maxWidth===void 0?null:_props$maxWidth,_props$placeholder=props.placeholder,placeholderStr=_props$placeholder===void 0?"":_props$placeholder,_props$editable=props.editable,editable=_props$editable===void 0?true:_props$editable,_props$readOnly=props.readOnly,readOnly=_props$readOnly===void 0?false:_props$readOnly,_props$indentWithTab=props.indentWithTab,defaultIndentWithTab=_props$indentWithTab===void 0?true:_props$indentWithTab,_props$basicSetup=props.basicSetup,defaultBasicSetup=_props$basicSetup===void 0?true:_props$basicSetup,root=props.root,initialState=props.initialState;var _React$useState85=React.useState(),_React$useState86=_slicedToArray2(_React$useState85,2),container=_React$useState86[0],setContainer=_React$useState86[1];var _React$useState87=React.useState(),_React$useState88=_slicedToArray2(_React$useState87,2),view=_React$useState88[0],setView=_React$useState88[1];var _React$useState89=React.useState(),_React$useState90=_slicedToArray2(_React$useState89,2),state=_React$useState90[0],setState=_React$useState90[1];var defaultThemeOption=EditorView.theme({"&":{height:height,minHeight:minHeight,maxHeight:maxHeight,width:width,minWidth:minWidth,maxWidth:maxWidth},"& .cm-scroller":{height:"100% !important"}});var updateListener=EditorView.updateListener.of(function(vu){if(vu.docChanged&&typeof onChange==="function"&&!vu.transactions.some(function(tr){return tr.annotation(External)})){var doc=vu.state.doc;var _value=doc.toString();onChange(_value,vu)}onStatistics&&onStatistics(getStatistics(vu))});var defaultExtensions=getDefaultExtensions({theme:theme,editable:editable,readOnly:readOnly,placeholder:placeholderStr,indentWithTab:defaultIndentWithTab,basicSetup:defaultBasicSetup});var getExtensions=[updateListener,defaultThemeOption].concat(_toConsumableArray2(defaultExtensions));if(onUpdate&&typeof onUpdate==="function"){getExtensions.push(EditorView.updateListener.of(onUpdate))}getExtensions=getExtensions.concat(extensions);React.useEffect(function(){if(container&&!state){var config={doc:value,selection:selection,extensions:getExtensions};var stateCurrent=initialState?EditorState.fromJSON(initialState.json,config,initialState.fields):EditorState.create(config);setState(stateCurrent);if(!view){var viewCurrent=new EditorView({state:stateCurrent,parent:container,root:root});setView(viewCurrent);onCreateEditor&&onCreateEditor(viewCurrent,stateCurrent)}}return function(){if(view){setState(undefined);setView(undefined)}}},[container,state]);React.useEffect(function(){return setContainer(props.container)},[props.container]);React.useEffect(function(){return function(){if(view){view.destroy();setView(undefined)}}},[view]);React.useEffect(function(){if(autoFocus&&view){view.focus()}},[autoFocus,view]);React.useEffect(function(){if(view){view.dispatch({effects:StateEffect.reconfigure.of(getExtensions)})}},[theme,extensions,height,minHeight,maxHeight,width,minWidth,maxWidth,placeholderStr,editable,readOnly,defaultIndentWithTab,defaultBasicSetup,onChange,onUpdate]);React.useEffect(function(){if(value===undefined){return}var currentValue=view?view.state.doc.toString():"";if(view&&value!==currentValue){view.dispatch({changes:{from:0,to:currentValue.length,insert:value||""},annotations:[External.of(true)]})}},[value,view]);return{state:state,setState:setState,view:view,setView:setView,container:container,setContainer:setContainer}}var _excluded$1=["className","value","selection","extensions","onChange","onStatistics","onCreateEditor","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root","initialState"];var ReactCodeMirror=React.forwardRef(function(props,ref){var className=props.className,_props$value=props.value,value=_props$value===void 0?"":_props$value,selection=props.selection,_props$extensions2=props.extensions,extensions=_props$extensions2===void 0?[]:_props$extensions2,onChange=props.onChange,onStatistics=props.onStatistics,onCreateEditor=props.onCreateEditor,onUpdate=props.onUpdate,autoFocus=props.autoFocus,_props$theme2=props.theme,theme=_props$theme2===void 0?"light":_props$theme2,height=props.height,minHeight=props.minHeight,maxHeight=props.maxHeight,width=props.width,minWidth=props.minWidth,maxWidth=props.maxWidth,basicSetup=props.basicSetup,placeholder=props.placeholder,indentWithTab=props.indentWithTab,editable=props.editable,readOnly=props.readOnly,root=props.root,initialState=props.initialState,other=_objectWithoutPropertiesLoose$1(props,_excluded$1);var editor=React.useRef(null);var _useCodeMirror=useCodeMirror({container:editor.current,root:root,value:value,autoFocus:autoFocus,theme:theme,height:height,minHeight:minHeight,maxHeight:maxHeight,width:width,minWidth:minWidth,maxWidth:maxWidth,basicSetup:basicSetup,placeholder:placeholder,indentWithTab:indentWithTab,editable:editable,readOnly:readOnly,selection:selection,onChange:onChange,onStatistics:onStatistics,onCreateEditor:onCreateEditor,onUpdate:onUpdate,extensions:extensions,initialState:initialState}),state=_useCodeMirror.state,view=_useCodeMirror.view,container=_useCodeMirror.container;React.useImperativeHandle(ref,function(){return{editor:editor.current,state:state,view:view}},[editor,container,state,view]);if(typeof value!=="string"){throw new Error("value must be typeof string but got "+_typeof2(value))}var defaultClassNames=typeof theme==="string"?"cm-theme-"+theme:"cm-theme";return jsxRuntime.jsx("div",_extends$1({ref:editor,className:""+defaultClassNames+(className?" "+className:"")},other))});ReactCodeMirror.displayName="CodeMirror";var CompositeBlock=function(){function CompositeBlock(type,value,from,hash,end,children,positions){_classCallCheck2(this,CompositeBlock);this.type=type;this.value=value;this.from=from;this.hash=hash;this.end=end;this.children=children;this.positions=positions;this.hashProp=[[NodeProp.contextHash,hash]]}_createClass2(CompositeBlock,[{key:"addChild",value:function addChild(child,pos){if(child.prop(NodeProp.contextHash)!=this.hash)child=new Tree(child.type,child.children,child.positions,child.length,this.hashProp);this.children.push(child);this.positions.push(pos)}},{key:"toTree",value:function toTree(nodeSet){var _this269=this;var end=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.end;var last=this.children.length-1;if(last>=0)end=Math.max(end,this.positions[last]+this.children[last].length+this.from);return new Tree(nodeSet.types[this.type],this.children,this.positions,end-this.from).balance({makeTree:function makeTree(children,positions,length){return new Tree(NodeType.none,children,positions,length,_this269.hashProp)}})}}],[{key:"create",value:function create(type,value,from,parentHash,end){var hash=parentHash+(parentHash<<8)+type+(value<<4)|0;return new CompositeBlock(type,value,from,hash,end,[],[])}}]);return CompositeBlock}();var Type;(function(Type){Type[Type["Document"]=1]="Document";Type[Type["CodeBlock"]=2]="CodeBlock";Type[Type["FencedCode"]=3]="FencedCode";Type[Type["Blockquote"]=4]="Blockquote";Type[Type["HorizontalRule"]=5]="HorizontalRule";Type[Type["BulletList"]=6]="BulletList";Type[Type["OrderedList"]=7]="OrderedList";Type[Type["ListItem"]=8]="ListItem";Type[Type["ATXHeading1"]=9]="ATXHeading1";Type[Type["ATXHeading2"]=10]="ATXHeading2";Type[Type["ATXHeading3"]=11]="ATXHeading3";Type[Type["ATXHeading4"]=12]="ATXHeading4";Type[Type["ATXHeading5"]=13]="ATXHeading5";Type[Type["ATXHeading6"]=14]="ATXHeading6";Type[Type["SetextHeading1"]=15]="SetextHeading1";Type[Type["SetextHeading2"]=16]="SetextHeading2";Type[Type["HTMLBlock"]=17]="HTMLBlock";Type[Type["LinkReference"]=18]="LinkReference";Type[Type["Paragraph"]=19]="Paragraph";Type[Type["CommentBlock"]=20]="CommentBlock";Type[Type["ProcessingInstructionBlock"]=21]="ProcessingInstructionBlock";Type[Type["Escape"]=22]="Escape";Type[Type["Entity"]=23]="Entity";Type[Type["HardBreak"]=24]="HardBreak";Type[Type["Emphasis"]=25]="Emphasis";Type[Type["StrongEmphasis"]=26]="StrongEmphasis";Type[Type["Link"]=27]="Link";Type[Type["Image"]=28]="Image";Type[Type["InlineCode"]=29]="InlineCode";Type[Type["HTMLTag"]=30]="HTMLTag";Type[Type["Comment"]=31]="Comment";Type[Type["ProcessingInstruction"]=32]="ProcessingInstruction";Type[Type["Autolink"]=33]="Autolink";Type[Type["HeaderMark"]=34]="HeaderMark";Type[Type["QuoteMark"]=35]="QuoteMark";Type[Type["ListMark"]=36]="ListMark";Type[Type["LinkMark"]=37]="LinkMark";Type[Type["EmphasisMark"]=38]="EmphasisMark";Type[Type["CodeMark"]=39]="CodeMark";Type[Type["CodeText"]=40]="CodeText";Type[Type["CodeInfo"]=41]="CodeInfo";Type[Type["LinkTitle"]=42]="LinkTitle";Type[Type["LinkLabel"]=43]="LinkLabel";Type[Type["URL"]=44]="URL"})(Type||(Type={}));var LeafBlock=_createClass2(function LeafBlock(start,content){_classCallCheck2(this,LeafBlock);this.start=start;this.content=content;this.marks=[];this.parsers=[]});var Line=function(){function Line(){_classCallCheck2(this,Line);this.text="";this.baseIndent=0;this.basePos=0;this.depth=0;this.markers=[];this.pos=0;this.indent=0;this.next=-1}_createClass2(Line,[{key:"forward",value:function forward(){if(this.basePos>this.pos)this.forwardInner()}},{key:"forwardInner",value:function forwardInner(){var newPos=this.skipSpace(this.basePos);this.indent=this.countIndent(newPos,this.pos,this.indent);this.pos=newPos;this.next=newPos==this.text.length?-1:this.text.charCodeAt(newPos)}},{key:"skipSpace",value:function skipSpace(from){return _skipSpace(this.text,from)}},{key:"reset",value:function reset(text){this.text=text;this.baseIndent=this.basePos=this.pos=this.indent=0;this.forwardInner();this.depth=1;while(this.markers.length)this.markers.pop()}},{key:"moveBase",value:function moveBase(to){this.basePos=to;this.baseIndent=this.countIndent(to,this.pos,this.indent)}},{key:"moveBaseColumn",value:function moveBaseColumn(indent){this.baseIndent=indent;this.basePos=this.findColumn(indent)}},{key:"addMarker",value:function addMarker(elt){this.markers.push(elt)}},{key:"countIndent",value:function countIndent(to){var from=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var indent=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;for(var _i268=from;_i268<to;_i268++)indent+=this.text.charCodeAt(_i268)==9?4-indent%4:1;return indent}},{key:"findColumn",value:function findColumn(goal){var i=0;for(var indent=0;i<this.text.length&&indent<goal;i++)indent+=this.text.charCodeAt(i)==9?4-indent%4:1;return i}},{key:"scrub",value:function scrub(){if(!this.baseIndent)return this.text;var result="";for(var _i269=0;_i269<this.basePos;_i269++)result+=" ";return result+this.text.slice(this.basePos)}}]);return Line}();function skipForList(bl,cx,line){if(line.pos==line.text.length||bl!=cx.block&&line.indent>=cx.stack[line.depth+1].value+line.baseIndent)return true;if(line.indent>=line.baseIndent+4)return false;var size=(bl.type==Type.OrderedList?isOrderedList:isBulletList)(line,cx,false);return size>0&&(bl.type!=Type.BulletList||isHorizontalRule(line,cx,false)<0)&&line.text.charCodeAt(line.pos+size-1)==bl.value}var DefaultSkipMarkup=_defineProperty2(_defineProperty2(_defineProperty2(_defineProperty2(_defineProperty2({},Type.Blockquote,function(bl,cx,line){if(line.next!=62)return false;line.markers.push(_elt5(Type.QuoteMark,cx.lineStart+line.pos,cx.lineStart+line.pos+1));line.moveBase(line.pos+(space$2(line.text.charCodeAt(line.pos+1))?2:1));bl.end=cx.lineStart+line.text.length;return true}),Type.ListItem,function(bl,_cx,line){if(line.indent<line.baseIndent+bl.value&&line.next>-1)return false;line.moveBaseColumn(line.baseIndent+bl.value);return true}),Type.OrderedList,skipForList),Type.BulletList,skipForList),Type.Document,function(){return true});function space$2(ch){return ch==32||ch==9||ch==10||ch==13}function _skipSpace(line){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;while(i<line.length&&space$2(line.charCodeAt(i)))i++;return i}function skipSpaceBack(line,i,to){while(i>to&&space$2(line.charCodeAt(i-1)))i--;return i}function isFencedCode(line){if(line.next!=96&&line.next!=126)return-1;var pos=line.pos+1;while(pos<line.text.length&&line.text.charCodeAt(pos)==line.next)pos++;if(pos<line.pos+3)return-1;if(line.next==96)for(var _i270=pos;_i270<line.text.length;_i270++)if(line.text.charCodeAt(_i270)==96)return-1;return pos}function isBlockquote(line){return line.next!=62?-1:line.text.charCodeAt(line.pos+1)==32?2:1}function isHorizontalRule(line,cx,breaking){if(line.next!=42&&line.next!=45&&line.next!=95)return-1;var count=1;for(var pos=line.pos+1;pos<line.text.length;pos++){var ch=line.text.charCodeAt(pos);if(ch==line.next)count++;else if(!space$2(ch))return-1}if(breaking&&line.next==45&&isSetextUnderline(line)>-1&&line.depth==cx.stack.length)return-1;return count<3?-1:1}function inList(cx,type){for(var _i271=cx.stack.length-1;_i271>=0;_i271--)if(cx.stack[_i271].type==type)return true;return false}function isBulletList(line,cx,breaking){return(line.next==45||line.next==43||line.next==42)&&(line.pos==line.text.length-1||space$2(line.text.charCodeAt(line.pos+1)))&&(!breaking||inList(cx,Type.BulletList)||line.skipSpace(line.pos+2)<line.text.length)?1:-1}function isOrderedList(line,cx,breaking){var pos=line.pos,next=line.next;for(;;){if(next>=48&&next<=57)pos++;else break;if(pos==line.text.length)return-1;next=line.text.charCodeAt(pos)}if(pos==line.pos||pos>line.pos+9||next!=46&&next!=41||pos<line.text.length-1&&!space$2(line.text.charCodeAt(pos+1))||breaking&&!inList(cx,Type.OrderedList)&&(line.skipSpace(pos+1)==line.text.length||pos>line.pos+1||line.next!=49))return-1;return pos+1-line.pos}function isAtxHeading(line){if(line.next!=35)return-1;var pos=line.pos+1;while(pos<line.text.length&&line.text.charCodeAt(pos)==35)pos++;if(pos<line.text.length&&line.text.charCodeAt(pos)!=32)return-1;var size=pos-line.pos;return size>6?-1:size}function isSetextUnderline(line){if(line.next!=45&&line.next!=61||line.indent>=line.baseIndent+4)return-1;var pos=line.pos+1;while(pos<line.text.length&&line.text.charCodeAt(pos)==line.next)pos++;var end=pos;while(pos<line.text.length&&space$2(line.text.charCodeAt(pos)))pos++;return pos==line.text.length?end:-1}var EmptyLine=/^[ \t]*$/,CommentEnd=/-->/,ProcessingEnd=/\?>/;var HTMLBlockStyle=[[/^<(?:script|pre|style)(?:\s|>|$)/i,/<\/(?:script|pre|style)>/i],[/^\s*<!--/,CommentEnd],[/^\s*<\?/,ProcessingEnd],[/^\s*<![A-Z]/,/>/],[/^\s*<!\[CDATA\[/,/\]\]>/],[/^\s*<\/?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|\/?>|$)/i,EmptyLine],[/^\s*(?:<\/[a-z][\w-]*\s*>|<[a-z][\w-]*(\s+[a-z:_][\w-.]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*>)\s*$/i,EmptyLine]];function isHTMLBlock(line,_cx,breaking){if(line.next!=60)return-1;var rest=line.text.slice(line.pos);for(var _i272=0,e=HTMLBlockStyle.length-(breaking?1:0);_i272<e;_i272++)if(HTMLBlockStyle[_i272][0].test(rest))return _i272;return-1}function getListIndent(line,pos){var indentAfter=line.countIndent(pos,line.pos,line.indent);var indented=line.countIndent(line.skipSpace(pos),pos,indentAfter);return indented>=indentAfter+5?indentAfter+1:indented}function addCodeText(marks,from,to){var last=marks.length-1;if(last>=0&&marks[last].to==from&&marks[last].type==Type.CodeText)marks[last].to=to;else marks.push(_elt5(Type.CodeText,from,to))}var DefaultBlockParsers={LinkReference:undefined,IndentedCode:function IndentedCode(cx,line){var base=line.baseIndent+4;if(line.indent<base)return false;var start=line.findColumn(base);var from=cx.lineStart+start,to=cx.lineStart+line.text.length;var marks=[],pendingMarks=[];addCodeText(marks,from,to);while(cx.nextLine()&&line.depth>=cx.stack.length){if(line.pos==line.text.length){addCodeText(pendingMarks,cx.lineStart-1,cx.lineStart);var _iterator424=_createForOfIteratorHelper(line.markers),_step424;try{for(_iterator424.s();!(_step424=_iterator424.n()).done;){var m=_step424.value;pendingMarks.push(m)}}catch(err){_iterator424.e(err)}finally{_iterator424.f()}}else if(line.indent<base){break}else{if(pendingMarks.length){var _iterator425=_createForOfIteratorHelper(pendingMarks),_step425;try{for(_iterator425.s();!(_step425=_iterator425.n()).done;){var _m2=_step425.value;if(_m2.type==Type.CodeText)addCodeText(marks,_m2.from,_m2.to);else marks.push(_m2)}}catch(err){_iterator425.e(err)}finally{_iterator425.f()}pendingMarks=[]}addCodeText(marks,cx.lineStart-1,cx.lineStart);var _iterator426=_createForOfIteratorHelper(line.markers),_step426;try{for(_iterator426.s();!(_step426=_iterator426.n()).done;){var _m3=_step426.value;marks.push(_m3)}}catch(err){_iterator426.e(err)}finally{_iterator426.f()}to=cx.lineStart+line.text.length;var codeStart=cx.lineStart+line.findColumn(line.baseIndent+4);if(codeStart<to)addCodeText(marks,codeStart,to)}}if(pendingMarks.length){pendingMarks=pendingMarks.filter(function(m){return m.type!=Type.CodeText});if(pendingMarks.length)line.markers=pendingMarks.concat(line.markers)}cx.addNode(cx.buffer.writeElements(marks,-from).finish(Type.CodeBlock,to-from),from);return true},FencedCode:function FencedCode(cx,line){var fenceEnd=isFencedCode(line);if(fenceEnd<0)return false;var from=cx.lineStart+line.pos,ch=line.next,len=fenceEnd-line.pos;var infoFrom=line.skipSpace(fenceEnd),infoTo=skipSpaceBack(line.text,line.text.length,infoFrom);var marks=[_elt5(Type.CodeMark,from,from+len)];if(infoFrom<infoTo)marks.push(_elt5(Type.CodeInfo,cx.lineStart+infoFrom,cx.lineStart+infoTo));for(var first=true;cx.nextLine()&&line.depth>=cx.stack.length;first=false){var _i273=line.pos;if(line.indent-line.baseIndent<4)while(_i273<line.text.length&&line.text.charCodeAt(_i273)==ch)_i273++;if(_i273-line.pos>=len&&line.skipSpace(_i273)==line.text.length){var _iterator427=_createForOfIteratorHelper(line.markers),_step427;try{for(_iterator427.s();!(_step427=_iterator427.n()).done;){var m=_step427.value;marks.push(m)}}catch(err){_iterator427.e(err)}finally{_iterator427.f()}marks.push(_elt5(Type.CodeMark,cx.lineStart+line.pos,cx.lineStart+_i273));cx.nextLine();break}else{if(!first)addCodeText(marks,cx.lineStart-1,cx.lineStart);var _iterator428=_createForOfIteratorHelper(line.markers),_step428;try{for(_iterator428.s();!(_step428=_iterator428.n()).done;){var _m4=_step428.value;marks.push(_m4)}}catch(err){_iterator428.e(err)}finally{_iterator428.f()}var textStart=cx.lineStart+line.basePos,textEnd=cx.lineStart+line.text.length;if(textStart<textEnd)addCodeText(marks,textStart,textEnd)}}cx.addNode(cx.buffer.writeElements(marks,-from).finish(Type.FencedCode,cx.prevLineEnd()-from),from);return true},Blockquote:function Blockquote(cx,line){var size=isBlockquote(line);if(size<0)return false;cx.startContext(Type.Blockquote,line.pos);cx.addNode(Type.QuoteMark,cx.lineStart+line.pos,cx.lineStart+line.pos+1);line.moveBase(line.pos+size);return null},HorizontalRule:function HorizontalRule(cx,line){if(isHorizontalRule(line,cx,false)<0)return false;var from=cx.lineStart+line.pos;cx.nextLine();cx.addNode(Type.HorizontalRule,from);return true},BulletList:function BulletList(cx,line){var size=isBulletList(line,cx,false);if(size<0)return false;if(cx.block.type!=Type.BulletList)cx.startContext(Type.BulletList,line.basePos,line.next);var newBase=getListIndent(line,line.pos+1);cx.startContext(Type.ListItem,line.basePos,newBase-line.baseIndent);cx.addNode(Type.ListMark,cx.lineStart+line.pos,cx.lineStart+line.pos+size);line.moveBaseColumn(newBase);return null},OrderedList:function OrderedList(cx,line){var size=isOrderedList(line,cx,false);if(size<0)return false;if(cx.block.type!=Type.OrderedList)cx.startContext(Type.OrderedList,line.basePos,line.text.charCodeAt(line.pos+size-1));var newBase=getListIndent(line,line.pos+size);cx.startContext(Type.ListItem,line.basePos,newBase-line.baseIndent);cx.addNode(Type.ListMark,cx.lineStart+line.pos,cx.lineStart+line.pos+size);line.moveBaseColumn(newBase);return null},ATXHeading:function ATXHeading(cx,line){var size=isAtxHeading(line);if(size<0)return false;var off=line.pos,from=cx.lineStart+off;var endOfSpace=skipSpaceBack(line.text,line.text.length,off),after=endOfSpace;while(after>off&&line.text.charCodeAt(after-1)==line.next)after--;if(after==endOfSpace||after==off||!space$2(line.text.charCodeAt(after-1)))after=line.text.length;var buf=cx.buffer.write(Type.HeaderMark,0,size).writeElements(cx.parser.parseInline(line.text.slice(off+size+1,after),from+size+1),-from);if(after<line.text.length)buf.write(Type.HeaderMark,after-off,endOfSpace-off);var node=buf.finish(Type.ATXHeading1-1+size,line.text.length-off);cx.nextLine();cx.addNode(node,from);return true},HTMLBlock:function HTMLBlock(cx,line){var type=isHTMLBlock(line,cx,false);if(type<0)return false;var from=cx.lineStart+line.pos,end=HTMLBlockStyle[type][1];var marks=[],trailing=end!=EmptyLine;while(!end.test(line.text)&&cx.nextLine()){if(line.depth<cx.stack.length){trailing=false;break}var _iterator429=_createForOfIteratorHelper(line.markers),_step429;try{for(_iterator429.s();!(_step429=_iterator429.n()).done;){var m=_step429.value;marks.push(m)}}catch(err){_iterator429.e(err)}finally{_iterator429.f()}}if(trailing)cx.nextLine();var nodeType=end==CommentEnd?Type.CommentBlock:end==ProcessingEnd?Type.ProcessingInstructionBlock:Type.HTMLBlock;var to=cx.prevLineEnd();cx.addNode(cx.buffer.writeElements(marks,-from).finish(nodeType,to-from),from);return true},SetextHeading:undefined};var LinkReferenceParser=function(){function LinkReferenceParser(leaf){_classCallCheck2(this,LinkReferenceParser);this.stage=0;this.elts=[];this.pos=0;this.start=leaf.start;this.advance(leaf.content)}_createClass2(LinkReferenceParser,[{key:"nextLine",value:function nextLine(cx,line,leaf){if(this.stage==-1)return false;var content=leaf.content+"\n"+line.scrub();var finish=this.advance(content);if(finish>-1&&finish<content.length)return this.complete(cx,leaf,finish);return false}},{key:"finish",value:function finish(cx,leaf){if((this.stage==2||this.stage==3)&&_skipSpace(leaf.content,this.pos)==leaf.content.length)return this.complete(cx,leaf,leaf.content.length);return false}},{key:"complete",value:function complete(cx,leaf,len){cx.addLeafElement(leaf,_elt5(Type.LinkReference,this.start,this.start+len,this.elts));return true}},{key:"nextStage",value:function nextStage(elt){if(elt){this.pos=elt.to-this.start;this.elts.push(elt);this.stage++;return true}if(elt===false)this.stage=-1;return false}},{key:"advance",value:function advance(content){for(;;){if(this.stage==-1){return-1}else if(this.stage==0){if(!this.nextStage(parseLinkLabel(content,this.pos,this.start,true)))return-1;if(content.charCodeAt(this.pos)!=58)return this.stage=-1;this.elts.push(_elt5(Type.LinkMark,this.pos+this.start,this.pos+this.start+1));this.pos++}else if(this.stage==1){if(!this.nextStage(parseURL(content,_skipSpace(content,this.pos),this.start)))return-1}else if(this.stage==2){var skip=_skipSpace(content,this.pos),_end37=0;if(skip>this.pos){var title=parseLinkTitle(content,skip,this.start);if(title){var titleEnd=lineEnd(content,title.to-this.start);if(titleEnd>0){this.nextStage(title);_end37=titleEnd}}}if(!_end37)_end37=lineEnd(content,this.pos);return _end37>0&&_end37<content.length?_end37:-1}else{return lineEnd(content,this.pos)}}}}]);return LinkReferenceParser}();function lineEnd(text,pos){for(;pos<text.length;pos++){var next=text.charCodeAt(pos);if(next==10)break;if(!space$2(next))return-1}return pos}var SetextHeadingParser=function(){function SetextHeadingParser(){_classCallCheck2(this,SetextHeadingParser)}_createClass2(SetextHeadingParser,[{key:"nextLine",value:function nextLine(cx,line,leaf){var underline=line.depth<cx.stack.length?-1:isSetextUnderline(line);var next=line.next;if(underline<0)return false;var underlineMark=_elt5(Type.HeaderMark,cx.lineStart+line.pos,cx.lineStart+underline);cx.nextLine();cx.addLeafElement(leaf,_elt5(next==61?Type.SetextHeading1:Type.SetextHeading2,leaf.start,cx.prevLineEnd(),[].concat(_toConsumableArray2(cx.parser.parseInline(leaf.content,leaf.start)),[underlineMark])));return true}},{key:"finish",value:function finish(){return false}}]);return SetextHeadingParser}();var DefaultLeafBlocks={LinkReference:function LinkReference(_,leaf){return leaf.content.charCodeAt(0)==91?new LinkReferenceParser(leaf):null},SetextHeading:function SetextHeading(){return new SetextHeadingParser}};var DefaultEndLeaf=[function(_,line){return isAtxHeading(line)>=0},function(_,line){return isFencedCode(line)>=0},function(_,line){return isBlockquote(line)>=0},function(p,line){return isBulletList(line,p,true)>=0},function(p,line){return isOrderedList(line,p,true)>=0},function(p,line){return isHorizontalRule(line,p,true)>=0},function(p,line){return isHTMLBlock(line,p,true)>=0}];var scanLineResult={text:"",end:0};var BlockContext=function(){function BlockContext(parser,input,fragments,ranges){_classCallCheck2(this,BlockContext);this.parser=parser;this.input=input;this.ranges=ranges;this.line=new Line;this.atEnd=false;this.reusePlaceholders=new Map;this.stoppedAt=null;this.rangeI=0;this.to=ranges[ranges.length-1].to;this.lineStart=this.absoluteLineStart=this.absoluteLineEnd=ranges[0].from;this.block=CompositeBlock.create(Type.Document,0,this.lineStart,0,0);this.stack=[this.block];this.fragments=fragments.length?new FragmentCursor$1(fragments,input):null;this.readLine()}_createClass2(BlockContext,[{key:"parsedPos",get:function get(){return this.absoluteLineStart}},{key:"advance",value:function advance(){if(this.stoppedAt!=null&&this.absoluteLineStart>this.stoppedAt)return this.finish();var line=this.line;for(;;){for(var markI=0;;){var next=line.depth<this.stack.length?this.stack[this.stack.length-1]:null;while(markI<line.markers.length&&(!next||line.markers[markI].from<next.end)){var mark=line.markers[markI++];this.addNode(mark.type,mark.from,mark.to)}if(!next)break;this.finishContext()}if(line.pos<line.text.length)break;if(!this.nextLine())return this.finish()}if(this.fragments&&this.reuseFragment(line.basePos))return null;start:for(;;){var _iterator430=_createForOfIteratorHelper(this.parser.blockParsers),_step430;try{for(_iterator430.s();!(_step430=_iterator430.n()).done;){var type=_step430.value;if(type){var result=type(this,line);if(result!=false){if(result==true)return null;line.forward();continue start}}}}catch(err){_iterator430.e(err)}finally{_iterator430.f()}break}var leaf=new LeafBlock(this.lineStart+line.pos,line.text.slice(line.pos));var _iterator431=_createForOfIteratorHelper(this.parser.leafBlockParsers),_step431;try{for(_iterator431.s();!(_step431=_iterator431.n()).done;){var parse=_step431.value;if(parse){var _parser2=parse(this,leaf);if(_parser2)leaf.parsers.push(_parser2)}}}catch(err){_iterator431.e(err)}finally{_iterator431.f()}lines:while(this.nextLine()){if(line.pos==line.text.length)break;if(line.indent<line.baseIndent+4){var _iterator432=_createForOfIteratorHelper(this.parser.endLeafBlock),_step432;try{for(_iterator432.s();!(_step432=_iterator432.n()).done;){var stop=_step432.value;if(stop(this,line,leaf))break lines}}catch(err){_iterator432.e(err)}finally{_iterator432.f()}}var _iterator433=_createForOfIteratorHelper(leaf.parsers),_step433;try{for(_iterator433.s();!(_step433=_iterator433.n()).done;){var _parser=_step433.value;if(_parser.nextLine(this,line,leaf))return null}}catch(err){_iterator433.e(err)}finally{_iterator433.f()}leaf.content+="\n"+line.scrub();var _iterator434=_createForOfIteratorHelper(line.markers),_step434;try{for(_iterator434.s();!(_step434=_iterator434.n()).done;){var m=_step434.value;leaf.marks.push(m)}}catch(err){_iterator434.e(err)}finally{_iterator434.f()}}this.finishLeaf(leaf);return null}},{key:"stopAt",value:function stopAt(pos){if(this.stoppedAt!=null&&this.stoppedAt<pos)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=pos}},{key:"reuseFragment",value:function reuseFragment(start){if(!this.fragments.moveTo(this.absoluteLineStart+start,this.absoluteLineStart)||!this.fragments.matches(this.block.hash))return false;var taken=this.fragments.takeNodes(this);if(!taken)return false;this.absoluteLineStart+=taken;this.lineStart=toRelative(this.absoluteLineStart,this.ranges);this.moveRangeI();if(this.absoluteLineStart<this.to){this.lineStart++;this.absoluteLineStart++;this.readLine()}else{this.atEnd=true;this.readLine()}return true}},{key:"depth",get:function get(){return this.stack.length}},{key:"parentType",value:function parentType(){var depth=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.depth-1;return this.parser.nodeSet.types[this.stack[depth].type]}},{key:"nextLine",value:function nextLine(){this.lineStart+=this.line.text.length;if(this.absoluteLineEnd>=this.to){this.absoluteLineStart=this.absoluteLineEnd;this.atEnd=true;this.readLine();return false}else{this.lineStart++;this.absoluteLineStart=this.absoluteLineEnd+1;this.moveRangeI();this.readLine();return true}}},{key:"moveRangeI",value:function moveRangeI(){while(this.rangeI<this.ranges.length-1&&this.absoluteLineStart>=this.ranges[this.rangeI].to){this.rangeI++;this.absoluteLineStart=Math.max(this.absoluteLineStart,this.ranges[this.rangeI].from)}}},{key:"scanLine",value:function scanLine(start){var r=scanLineResult;r.end=start;if(start>=this.to){r.text=""}else{r.text=this.lineChunkAt(start);r.end+=r.text.length;if(this.ranges.length>1){var textOffset=this.absoluteLineStart,rangeI=this.rangeI;while(this.ranges[rangeI].to<r.end){rangeI++;var nextFrom=this.ranges[rangeI].from;var _after7=this.lineChunkAt(nextFrom);r.end=nextFrom+_after7.length;r.text=r.text.slice(0,this.ranges[rangeI-1].to-textOffset)+_after7;textOffset=r.end-r.text.length}}}return r}},{key:"readLine",value:function readLine(){var line=this.line,_this$scanLine=this.scanLine(this.absoluteLineStart),text=_this$scanLine.text,end=_this$scanLine.end;this.absoluteLineEnd=end;line.reset(text);for(;line.depth<this.stack.length;line.depth++){var cx=this.stack[line.depth],handler=this.parser.skipContextMarkup[cx.type];if(!handler)throw new Error("Unhandled block context "+Type[cx.type]);if(!handler(cx,this,line))break;line.forward()}}},{key:"lineChunkAt",value:function lineChunkAt(pos){var next=this.input.chunk(pos),text;if(!this.input.lineChunks){var eol=next.indexOf("\n");text=eol<0?next:next.slice(0,eol)}else{text=next=="\n"?"":next}return pos+text.length>this.to?text.slice(0,this.to-pos):text}},{key:"prevLineEnd",value:function prevLineEnd(){return this.atEnd?this.lineStart:this.lineStart-1}},{key:"startContext",value:function startContext(type,start){var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this.block=CompositeBlock.create(type,value,this.lineStart+start,this.block.hash,this.lineStart+this.line.text.length);this.stack.push(this.block)}},{key:"startComposite",value:function startComposite(type,start){var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this.startContext(this.parser.getNodeType(type),start,value)}},{key:"addNode",value:function addNode(block,from,to){if(typeof block=="number")block=new Tree(this.parser.nodeSet.types[block],none,none,(to!==null&&to!==void 0?to:this.prevLineEnd())-from);this.block.addChild(block,from-this.block.from)}},{key:"addElement",value:function addElement(elt){this.block.addChild(elt.toTree(this.parser.nodeSet),elt.from-this.block.from)}},{key:"addLeafElement",value:function addLeafElement(leaf,elt){this.addNode(this.buffer.writeElements(injectMarks(elt.children,leaf.marks),-elt.from).finish(elt.type,elt.to-elt.from),elt.from)}},{key:"finishContext",value:function finishContext(){var cx=this.stack.pop();var top=this.stack[this.stack.length-1];top.addChild(cx.toTree(this.parser.nodeSet),cx.from-top.from);this.block=top}},{key:"finish",value:function finish(){while(this.stack.length>1)this.finishContext();return this.addGaps(this.block.toTree(this.parser.nodeSet,this.lineStart))}},{key:"addGaps",value:function addGaps(tree){return this.ranges.length>1?injectGaps(this.ranges,0,tree.topNode,this.ranges[0].from,this.reusePlaceholders):tree}},{key:"finishLeaf",value:function finishLeaf(leaf){var _iterator435=_createForOfIteratorHelper(leaf.parsers),_step435;try{for(_iterator435.s();!(_step435=_iterator435.n()).done;){var _parser3=_step435.value;if(_parser3.finish(this,leaf))return}}catch(err){_iterator435.e(err)}finally{_iterator435.f()}var inline=injectMarks(this.parser.parseInline(leaf.content,leaf.start),leaf.marks);this.addNode(this.buffer.writeElements(inline,-leaf.start).finish(Type.Paragraph,leaf.content.length),leaf.start)}},{key:"elt",value:function elt(type,from,to,children){if(typeof type=="string")return _elt5(this.parser.getNodeType(type),from,to,children);return new TreeElement(type,from)}},{key:"buffer",get:function get(){return new Buffer$1(this.parser.nodeSet)}}]);return BlockContext}();function injectGaps(ranges,rangeI,tree,offset,dummies){var rangeEnd=ranges[rangeI].to;var children=[],positions=[],start=tree.from+offset;function movePastNext(upto,inclusive){while(inclusive?upto>=rangeEnd:upto>rangeEnd){var size=ranges[rangeI+1].from-rangeEnd;offset+=size;upto+=size;rangeI++;rangeEnd=ranges[rangeI].to}}for(var ch=tree.firstChild;ch;ch=ch.nextSibling){movePastNext(ch.from+offset,true);var from=ch.from+offset,node=void 0,reuse=dummies.get(ch.tree);if(reuse){node=reuse}else if(ch.to+offset>rangeEnd){node=injectGaps(ranges,rangeI,ch,offset,dummies);movePastNext(ch.to+offset,false)}else{node=ch.toTree()}children.push(node);positions.push(from-start)}movePastNext(tree.to+offset,false);return new Tree(tree.type,children,positions,tree.to+offset-start,tree.tree?tree.tree.propValues:undefined)}var MarkdownParser=function(_Parser2){_inherits2(MarkdownParser,_Parser2);var _super110=_createSuper(MarkdownParser);function MarkdownParser(nodeSet,blockParsers,leafBlockParsers,blockNames,endLeafBlock,skipContextMarkup,inlineParsers,inlineNames,wrappers){var _this270;_classCallCheck2(this,MarkdownParser);_this270=_super110.call(this);_this270.nodeSet=nodeSet;_this270.blockParsers=blockParsers;_this270.leafBlockParsers=leafBlockParsers;_this270.blockNames=blockNames;_this270.endLeafBlock=endLeafBlock;_this270.skipContextMarkup=skipContextMarkup;_this270.inlineParsers=inlineParsers;_this270.inlineNames=inlineNames;_this270.wrappers=wrappers;_this270.nodeTypes=Object.create(null);var _iterator436=_createForOfIteratorHelper(nodeSet.types),_step436;try{for(_iterator436.s();!(_step436=_iterator436.n()).done;){var _t9=_step436.value;_this270.nodeTypes[_t9.name]=_t9.id}}catch(err){_iterator436.e(err)}finally{_iterator436.f()}return _this270}_createClass2(MarkdownParser,[{key:"createParse",value:function createParse(input,fragments,ranges){var parse=new BlockContext(this,input,fragments,ranges);var _iterator437=_createForOfIteratorHelper(this.wrappers),_step437;try{for(_iterator437.s();!(_step437=_iterator437.n()).done;){var w=_step437.value;parse=w(parse,input,fragments,ranges)}}catch(err){_iterator437.e(err)}finally{_iterator437.f()}return parse}},{key:"configure",value:function configure(spec){var _nodeSet;var config=resolveConfig(spec);if(!config)return this;var nodeSet=this.nodeSet,skipContextMarkup=this.skipContextMarkup;var blockParsers=this.blockParsers.slice(),leafBlockParsers=this.leafBlockParsers.slice(),blockNames=this.blockNames.slice(),inlineParsers=this.inlineParsers.slice(),inlineNames=this.inlineNames.slice(),endLeafBlock=this.endLeafBlock.slice(),wrappers=this.wrappers;if(nonEmpty(config.defineNodes)){skipContextMarkup=Object.assign({},skipContextMarkup);var _nodeTypes=nodeSet.types.slice(),styles;var _iterator438=_createForOfIteratorHelper(config.defineNodes),_step438;try{var _loop28=function _loop28(){var s=_step438.value;var _ref279=typeof s=="string"?{name:s}:s,name=_ref279.name,block=_ref279.block,composite=_ref279.composite,style=_ref279.style;if(_nodeTypes.some(function(t){return t.name==name}))return 1;if(composite)skipContextMarkup[_nodeTypes.length]=function(bl,cx,line){return composite(cx,line,bl.value)};var id=_nodeTypes.length;var group=composite?["Block","BlockContext"]:!block?undefined:id>=Type.ATXHeading1&&id<=Type.SetextHeading2?["Block","LeafBlock","Heading"]:["Block","LeafBlock"];_nodeTypes.push(NodeType.define({id:id,name:name,props:group&&[[NodeProp.group,group]]}));if(style){if(!styles)styles={};if(Array.isArray(style)||style instanceof Tag)styles[name]=style;else Object.assign(styles,style)}};for(_iterator438.s();!(_step438=_iterator438.n()).done;){if(_loop28())continue}}catch(err){_iterator438.e(err)}finally{_iterator438.f()}nodeSet=new NodeSet(_nodeTypes);if(styles)nodeSet=nodeSet.extend(styleTags(styles))}if(nonEmpty(config.props))nodeSet=(_nodeSet=nodeSet).extend.apply(_nodeSet,_toConsumableArray2(config.props));if(nonEmpty(config.remove)){var _iterator439=_createForOfIteratorHelper(config.remove),_step439;try{for(_iterator439.s();!(_step439=_iterator439.n()).done;){var _rm=_step439.value;var block=this.blockNames.indexOf(_rm),inline=this.inlineNames.indexOf(_rm);if(block>-1)blockParsers[block]=leafBlockParsers[block]=undefined;if(inline>-1)inlineParsers[inline]=undefined}}catch(err){_iterator439.e(err)}finally{_iterator439.f()}}if(nonEmpty(config.parseBlock)){var _iterator440=_createForOfIteratorHelper(config.parseBlock),_step440;try{for(_iterator440.s();!(_step440=_iterator440.n()).done;){var _spec=_step440.value;var found=blockNames.indexOf(_spec.name);if(found>-1){blockParsers[found]=_spec.parse;leafBlockParsers[found]=_spec.leaf}else{var pos=_spec.before?findName(blockNames,_spec.before):_spec.after?findName(blockNames,_spec.after)+1:blockNames.length-1;blockParsers.splice(pos,0,_spec.parse);leafBlockParsers.splice(pos,0,_spec.leaf);blockNames.splice(pos,0,_spec.name)}if(_spec.endLeaf)endLeafBlock.push(_spec.endLeaf)}}catch(err){_iterator440.e(err)}finally{_iterator440.f()}}if(nonEmpty(config.parseInline)){var _iterator441=_createForOfIteratorHelper(config.parseInline),_step441;try{for(_iterator441.s();!(_step441=_iterator441.n()).done;){var _spec2=_step441.value;var _found=inlineNames.indexOf(_spec2.name);if(_found>-1){inlineParsers[_found]=_spec2.parse}else{var _pos6=_spec2.before?findName(inlineNames,_spec2.before):_spec2.after?findName(inlineNames,_spec2.after)+1:inlineNames.length-1;inlineParsers.splice(_pos6,0,_spec2.parse);inlineNames.splice(_pos6,0,_spec2.name)}}}catch(err){_iterator441.e(err)}finally{_iterator441.f()}}if(config.wrap)wrappers=wrappers.concat(config.wrap);return new MarkdownParser(nodeSet,blockParsers,leafBlockParsers,blockNames,endLeafBlock,skipContextMarkup,inlineParsers,inlineNames,wrappers)}},{key:"getNodeType",value:function getNodeType(name){var found=this.nodeTypes[name];if(found==null)throw new RangeError("Unknown node type '".concat(name,"'"));return found}},{key:"parseInline",value:function parseInline(text,offset){var cx=new InlineContext(this,text,offset);outer:for(var pos=offset;pos<cx.end;){var next=cx["char"](pos);var _iterator442=_createForOfIteratorHelper(this.inlineParsers),_step442;try{for(_iterator442.s();!(_step442=_iterator442.n()).done;){var token=_step442.value;if(token){var result=token(cx,next,pos);if(result>=0){pos=result;continue outer}}}}catch(err){_iterator442.e(err)}finally{_iterator442.f()}pos++}return cx.resolveMarkers(0)}}]);return MarkdownParser}(Parser);function nonEmpty(a){return a!=null&&a.length>0}function resolveConfig(spec){if(!Array.isArray(spec))return spec;if(spec.length==0)return null;var conf=resolveConfig(spec[0]);if(spec.length==1)return conf;var rest=resolveConfig(spec.slice(1));if(!rest||!conf)return conf||rest;var conc=function conc(a,b){return(a||none).concat(b||none)};var wrapA=conf.wrap,wrapB=rest.wrap;return{props:conc(conf.props,rest.props),defineNodes:conc(conf.defineNodes,rest.defineNodes),parseBlock:conc(conf.parseBlock,rest.parseBlock),parseInline:conc(conf.parseInline,rest.parseInline),remove:conc(conf.remove,rest.remove),wrap:!wrapA?wrapB:!wrapB?wrapA:function(inner,input,fragments,ranges){return wrapA(wrapB(inner,input,fragments,ranges),input,fragments,ranges)}}}function findName(names,name){var found=names.indexOf(name);if(found<0)throw new RangeError("Position specified relative to unknown parser ".concat(name));return found}var nodeTypes=[NodeType.none];for(var _i274=1,_name30;_name30=Type[_i274];_i274++){nodeTypes[_i274]=NodeType.define({id:_i274,name:_name30,props:_i274>=Type.Escape?[]:[[NodeProp.group,_i274 in DefaultSkipMarkup?["Block","BlockContext"]:["Block","LeafBlock"]]],top:_name30=="Document"})}var none=[];var Buffer$1=function(){function Buffer(nodeSet){_classCallCheck2(this,Buffer);this.nodeSet=nodeSet;this.content=[];this.nodes=[]}_createClass2(Buffer,[{key:"write",value:function write(type,from,to){var children=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;this.content.push(type,from,to,4+children*4);return this}},{key:"writeElements",value:function writeElements(elts){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _iterator443=_createForOfIteratorHelper(elts),_step443;try{for(_iterator443.s();!(_step443=_iterator443.n()).done;){var e=_step443.value;e.writeTo(this,offset)}}catch(err){_iterator443.e(err)}finally{_iterator443.f()}return this}},{key:"finish",value:function finish(type,length){return Tree.build({buffer:this.content,nodeSet:this.nodeSet,reused:this.nodes,topID:type,length:length})}}]);return Buffer}();var Element$2=function(){function Element(type,from,to){var children=arguments.length>3&&arguments[3]!==undefined?arguments[3]:none;_classCallCheck2(this,Element);this.type=type;this.from=from;this.to=to;this.children=children}_createClass2(Element,[{key:"writeTo",value:function writeTo(buf,offset){var startOff=buf.content.length;buf.writeElements(this.children,offset);buf.content.push(this.type,this.from+offset,this.to+offset,buf.content.length+4-startOff)}},{key:"toTree",value:function toTree(nodeSet){return new Buffer$1(nodeSet).writeElements(this.children,-this.from).finish(this.type,this.to-this.from)}}]);return Element}();var TreeElement=function(){function TreeElement(tree,from){_classCallCheck2(this,TreeElement);this.tree=tree;this.from=from}_createClass2(TreeElement,[{key:"to",get:function get(){return this.from+this.tree.length}},{key:"type",get:function get(){return this.tree.type.id}},{key:"children",get:function get(){return none}},{key:"writeTo",value:function writeTo(buf,offset){buf.nodes.push(this.tree);buf.content.push(buf.nodes.length-1,this.from+offset,this.to+offset,-1)}},{key:"toTree",value:function toTree(){return this.tree}}]);return TreeElement}();function _elt5(type,from,to,children){return new Element$2(type,from,to,children)}var EmphasisUnderscore={resolve:"Emphasis",mark:"EmphasisMark"};var EmphasisAsterisk={resolve:"Emphasis",mark:"EmphasisMark"};var LinkStart={},ImageStart={};var InlineDelimiter=_createClass2(function InlineDelimiter(type,from,to,side){_classCallCheck2(this,InlineDelimiter);this.type=type;this.from=from;this.to=to;this.side=side});var Escapable="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";var Punctuation=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\u2010-\u2027]/;try{Punctuation=new RegExp("[\\p{Pc}|\\p{Pd}|\\p{Pe}|\\p{Pf}|\\p{Pi}|\\p{Po}|\\p{Ps}]","u")}catch(_){}var DefaultInline={Escape:function Escape(cx,next,start){if(next!=92||start==cx.end-1)return-1;var escaped=cx["char"](start+1);for(var _i275=0;_i275<Escapable.length;_i275++)if(Escapable.charCodeAt(_i275)==escaped)return cx.append(_elt5(Type.Escape,start,start+2));return-1},Entity:function Entity(cx,next,start){if(next!=38)return-1;var m=/^(?:#\d+|#x[a-f\d]+|\w+);/i.exec(cx.slice(start+1,start+31));return m?cx.append(_elt5(Type.Entity,start,start+1+m[0].length)):-1},InlineCode:function InlineCode(cx,next,start){if(next!=96||start&&cx["char"](start-1)==96)return-1;var pos=start+1;while(pos<cx.end&&cx["char"](pos)==96)pos++;var size=pos-start,curSize=0;for(;pos<cx.end;pos++){if(cx["char"](pos)==96){curSize++;if(curSize==size&&cx["char"](pos+1)!=96)return cx.append(_elt5(Type.InlineCode,start,pos+1,[_elt5(Type.CodeMark,start,start+size),_elt5(Type.CodeMark,pos+1-size,pos+1)]))}else{curSize=0}}return-1},HTMLTag:function HTMLTag(cx,next,start){if(next!=60||start==cx.end-1)return-1;var after=cx.slice(start+1,cx.end);var url=/^(?:[a-z][-\w+.]+:[^\s>]+|[a-z\d.!#$%&'*+/=?^_`{|}~-]+@[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?(?:\.[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?)*)>/i.exec(after);if(url){return cx.append(_elt5(Type.Autolink,start,start+1+url[0].length,[_elt5(Type.LinkMark,start,start+1),_elt5(Type.URL,start+1,start+url[0].length),_elt5(Type.LinkMark,start+url[0].length,start+1+url[0].length)]))}var comment=/^!--[^>](?:-[^-]|[^-])*?-->/i.exec(after);if(comment)return cx.append(_elt5(Type.Comment,start,start+1+comment[0].length));var procInst=/^\?[^]*?\?>/.exec(after);if(procInst)return cx.append(_elt5(Type.ProcessingInstruction,start,start+1+procInst[0].length));var m=/^(?:![A-Z][^]*?>|!\[CDATA\[[^]*?\]\]>|\/\s*[a-zA-Z][\w-]*\s*>|\s*[a-zA-Z][\w-]*(\s+[a-zA-Z:_][\w-.:]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*(\/\s*)?>)/.exec(after);if(!m)return-1;return cx.append(_elt5(Type.HTMLTag,start,start+1+m[0].length))},Emphasis:function Emphasis(cx,next,start){if(next!=95&&next!=42)return-1;var pos=start+1;while(cx["char"](pos)==next)pos++;var before=cx.slice(start-1,start),after=cx.slice(pos,pos+1);var pBefore=Punctuation.test(before),pAfter=Punctuation.test(after);var sBefore=/\s|^$/.test(before),sAfter=/\s|^$/.test(after);var leftFlanking=!sAfter&&(!pAfter||sBefore||pBefore);var rightFlanking=!sBefore&&(!pBefore||sAfter||pAfter);var canOpen=leftFlanking&&(next==42||!rightFlanking||pBefore);var canClose=rightFlanking&&(next==42||!leftFlanking||pAfter);return cx.append(new InlineDelimiter(next==95?EmphasisUnderscore:EmphasisAsterisk,start,pos,(canOpen?1:0)|(canClose?2:0)))},HardBreak:function HardBreak(cx,next,start){if(next==92&&cx["char"](start+1)==10)return cx.append(_elt5(Type.HardBreak,start,start+2));if(next==32){var pos=start+1;while(cx["char"](pos)==32)pos++;if(cx["char"](pos)==10&&pos>=start+2)return cx.append(_elt5(Type.HardBreak,start,pos+1))}return-1},Link:function Link(cx,next,start){return next==91?cx.append(new InlineDelimiter(LinkStart,start,start+1,1)):-1},Image:function Image(cx,next,start){return next==33&&cx["char"](start+1)==91?cx.append(new InlineDelimiter(ImageStart,start,start+2,1)):-1},LinkEnd:function LinkEnd(cx,next,start){if(next!=93)return-1;for(var _i276=cx.parts.length-1;_i276>=0;_i276--){var part=cx.parts[_i276];if(part instanceof InlineDelimiter&&(part.type==LinkStart||part.type==ImageStart)){if(!part.side||cx.skipSpace(part.to)==start&&!/[(\[]/.test(cx.slice(start+1,start+2))){cx.parts[_i276]=null;return-1}var _content8=cx.takeContent(_i276);var link=cx.parts[_i276]=finishLink(cx,_content8,part.type==LinkStart?Type.Link:Type.Image,part.from,start+1);if(part.type==LinkStart)for(var j=0;j<_i276;j++){var _p8=cx.parts[j];if(_p8 instanceof InlineDelimiter&&_p8.type==LinkStart)_p8.side=0}return link.to}}return-1}};function finishLink(cx,content,type,start,startPos){var text=cx.text,next=cx["char"](startPos),endPos=startPos;content.unshift(_elt5(Type.LinkMark,start,start+(type==Type.Image?2:1)));content.push(_elt5(Type.LinkMark,startPos-1,startPos));if(next==40){var pos=cx.skipSpace(startPos+1);var dest=parseURL(text,pos-cx.offset,cx.offset),title;if(dest){pos=cx.skipSpace(dest.to);if(pos!=dest.to){title=parseLinkTitle(text,pos-cx.offset,cx.offset);if(title)pos=cx.skipSpace(title.to)}}if(cx["char"](pos)==41){content.push(_elt5(Type.LinkMark,startPos,startPos+1));endPos=pos+1;if(dest)content.push(dest);if(title)content.push(title);content.push(_elt5(Type.LinkMark,pos,endPos))}}else if(next==91){var label=parseLinkLabel(text,startPos-cx.offset,cx.offset,false);if(label){content.push(label);endPos=label.to}}return _elt5(type,start,endPos,content)}function parseURL(text,start,offset){var next=text.charCodeAt(start);if(next==60){for(var pos=start+1;pos<text.length;pos++){var ch=text.charCodeAt(pos);if(ch==62)return _elt5(Type.URL,start+offset,pos+1+offset);if(ch==60||ch==10)return false}return null}else{var depth=0,_pos7=start;for(var escaped=false;_pos7<text.length;_pos7++){var _ch2=text.charCodeAt(_pos7);if(space$2(_ch2)){break}else if(escaped){escaped=false}else if(_ch2==40){depth++}else if(_ch2==41){if(!depth)break;depth--}else if(_ch2==92){escaped=true}}return _pos7>start?_elt5(Type.URL,start+offset,_pos7+offset):_pos7==text.length?null:false}}function parseLinkTitle(text,start,offset){var next=text.charCodeAt(start);if(next!=39&&next!=34&&next!=40)return false;var end=next==40?41:next;for(var pos=start+1,escaped=false;pos<text.length;pos++){var ch=text.charCodeAt(pos);if(escaped)escaped=false;else if(ch==end)return _elt5(Type.LinkTitle,start+offset,pos+1+offset);else if(ch==92)escaped=true}return null}function parseLinkLabel(text,start,offset,requireNonWS){for(var escaped=false,pos=start+1,_end38=Math.min(text.length,pos+999);pos<_end38;pos++){var ch=text.charCodeAt(pos);if(escaped)escaped=false;else if(ch==93)return requireNonWS?false:_elt5(Type.LinkLabel,start+offset,pos+1+offset);else{if(requireNonWS&&!space$2(ch))requireNonWS=false;if(ch==91)return false;else if(ch==92)escaped=true}}return null}var InlineContext=function(){function InlineContext(parser,text,offset){_classCallCheck2(this,InlineContext);this.parser=parser;this.text=text;this.offset=offset;this.parts=[]}_createClass2(InlineContext,[{key:"char",value:function char(pos){return pos>=this.end?-1:this.text.charCodeAt(pos-this.offset)}},{key:"end",get:function get(){return this.offset+this.text.length}},{key:"slice",value:function slice(from,to){return this.text.slice(from-this.offset,to-this.offset)}},{key:"append",value:function append(elt){this.parts.push(elt);return elt.to}},{key:"addDelimiter",value:function addDelimiter(type,from,to,open,close){return this.append(new InlineDelimiter(type,from,to,(open?1:0)|(close?2:0)))}},{key:"addElement",value:function addElement(elt){return this.append(elt)}},{key:"resolveMarkers",value:function resolveMarkers(from){for(var _i277=from;_i277<this.parts.length;_i277++){var close=this.parts[_i277];if(!(close instanceof InlineDelimiter&&close.type.resolve&&close.side&2))continue;var emp=close.type==EmphasisUnderscore||close.type==EmphasisAsterisk;var closeSize=close.to-close.from;var open=void 0,j=_i277-1;for(;j>=from;j--){var part=this.parts[j];if(part instanceof InlineDelimiter&&part.side&1&&part.type==close.type&&!(emp&&(close.side&1||part.side&2)&&(part.to-part.from+closeSize)%3==0&&((part.to-part.from)%3||closeSize%3))){open=part;break}}if(!open)continue;var type=close.type.resolve,_content9=[];var _start23=open.from,_end39=close.to;if(emp){var size=Math.min(2,open.to-open.from,closeSize);_start23=open.to-size;_end39=close.from+size;type=size==1?"Emphasis":"StrongEmphasis"}if(open.type.mark)_content9.push(this.elt(open.type.mark,_start23,open.to));for(var k=j+1;k<_i277;k++){if(this.parts[k]instanceof Element$2)_content9.push(this.parts[k]);this.parts[k]=null}if(close.type.mark)_content9.push(this.elt(close.type.mark,close.from,_end39));var element=this.elt(type,_start23,_end39,_content9);this.parts[j]=emp&&open.from!=_start23?new InlineDelimiter(open.type,open.from,_start23,open.side):null;var keep=this.parts[_i277]=emp&&close.to!=_end39?new InlineDelimiter(close.type,_end39,close.to,close.side):null;if(keep)this.parts.splice(_i277,0,element);else this.parts[_i277]=element}var result=[];for(var _i278=from;_i278<this.parts.length;_i278++){var _part2=this.parts[_i278];if(_part2 instanceof Element$2)result.push(_part2)}return result}},{key:"findOpeningDelimiter",value:function findOpeningDelimiter(type){for(var _i279=this.parts.length-1;_i279>=0;_i279--){var part=this.parts[_i279];if(part instanceof InlineDelimiter&&part.type==type)return _i279}return null}},{key:"takeContent",value:function takeContent(startIndex){var content=this.resolveMarkers(startIndex);this.parts.length=startIndex;return content}},{key:"skipSpace",value:function skipSpace(from){return _skipSpace(this.text,from-this.offset)+this.offset}},{key:"elt",value:function elt(type,from,to,children){if(typeof type=="string")return _elt5(this.parser.getNodeType(type),from,to,children);return new TreeElement(type,from)}}]);return InlineContext}();function injectMarks(elements,marks){if(!marks.length)return elements;if(!elements.length)return marks;var elts=elements.slice(),eI=0;var _iterator444=_createForOfIteratorHelper(marks),_step444;try{for(_iterator444.s();!(_step444=_iterator444.n()).done;){var mark=_step444.value;while(eI<elts.length&&elts[eI].to<mark.to)eI++;if(eI<elts.length&&elts[eI].from<mark.from){var e=elts[eI];if(e instanceof Element$2)elts[eI]=new Element$2(e.type,e.from,e.to,injectMarks(e.children,[mark]))}else{elts.splice(eI++,0,mark)}}}catch(err){_iterator444.e(err)}finally{_iterator444.f()}return elts}var NotLast=[Type.CodeBlock,Type.ListItem,Type.OrderedList,Type.BulletList];var FragmentCursor$1=function(){function FragmentCursor(fragments,input){_classCallCheck2(this,FragmentCursor);this.fragments=fragments;this.input=input;this.i=0;this.fragment=null;this.fragmentEnd=-1;this.cursor=null;if(fragments.length)this.fragment=fragments[this.i++]}_createClass2(FragmentCursor,[{key:"nextFragment",value:function nextFragment(){this.fragment=this.i<this.fragments.length?this.fragments[this.i++]:null;this.cursor=null;this.fragmentEnd=-1}},{key:"moveTo",value:function moveTo(pos,lineStart){while(this.fragment&&this.fragment.to<=pos)this.nextFragment();if(!this.fragment||this.fragment.from>(pos?pos-1:0))return false;if(this.fragmentEnd<0){var _end40=this.fragment.to;while(_end40>0&&this.input.read(_end40-1,_end40)!="\n")_end40--;this.fragmentEnd=_end40?_end40-1:0}var c=this.cursor;if(!c){c=this.cursor=this.fragment.tree.cursor();c.firstChild()}var rPos=pos+this.fragment.offset;while(c.to<=rPos)if(!c.parent())return false;for(;;){if(c.from>=rPos)return this.fragment.from<=lineStart;if(!c.childAfter(rPos))return false}}},{key:"matches",value:function matches(hash){var tree=this.cursor.tree;return tree&&tree.prop(NodeProp.contextHash)==hash}},{key:"takeNodes",value:function takeNodes(cx){var cur=this.cursor,off=this.fragment.offset,fragEnd=this.fragmentEnd-(this.fragment.openEnd?1:0);var start=cx.absoluteLineStart,end=start,blockI=cx.block.children.length;var prevEnd=end,prevI=blockI;for(;;){if(cur.to-off>fragEnd){if(cur.type.isAnonymous&&cur.firstChild())continue;break}var pos=toRelative(cur.from-off,cx.ranges);if(cur.to-off<=cx.ranges[cx.rangeI].to){cx.addNode(cur.tree,pos)}else{var dummy=new Tree(cx.parser.nodeSet.types[Type.Paragraph],[],[],0,cx.block.hashProp);cx.reusePlaceholders.set(dummy,cur.tree);cx.addNode(dummy,pos)}if(cur.type.is("Block")){if(NotLast.indexOf(cur.type.id)<0){end=cur.to-off;blockI=cx.block.children.length}else{end=prevEnd;blockI=prevI;prevEnd=cur.to-off;prevI=cx.block.children.length}}if(!cur.nextSibling())break}while(cx.block.children.length>blockI){cx.block.children.pop();cx.block.positions.pop()}return end-start}}]);return FragmentCursor}();function toRelative(abs,ranges){var pos=abs;for(var _i280=1;_i280<ranges.length;_i280++){var gapFrom=ranges[_i280-1].to,gapTo=ranges[_i280].from;if(gapFrom<abs)pos-=gapTo-gapFrom}return pos}var markdownHighlighting=styleTags({"Blockquote/...":tags$1.quote,HorizontalRule:tags$1.contentSeparator,"ATXHeading1/... SetextHeading1/...":tags$1.heading1,"ATXHeading2/... SetextHeading2/...":tags$1.heading2,"ATXHeading3/...":tags$1.heading3,"ATXHeading4/...":tags$1.heading4,"ATXHeading5/...":tags$1.heading5,"ATXHeading6/...":tags$1.heading6,"Comment CommentBlock":tags$1.comment,Escape:tags$1.escape,Entity:tags$1.character,"Emphasis/...":tags$1.emphasis,"StrongEmphasis/...":tags$1.strong,"Link/... Image/...":tags$1.link,"OrderedList/... BulletList/...":tags$1.list,"BlockQuote/...":tags$1.quote,"InlineCode CodeText":tags$1.monospace,"URL Autolink":tags$1.url,"HeaderMark HardBreak QuoteMark ListMark LinkMark EmphasisMark CodeMark":tags$1.processingInstruction,"CodeInfo LinkLabel":tags$1.labelName,LinkTitle:tags$1.string,Paragraph:tags$1.content});var parser$3=new MarkdownParser(new NodeSet(nodeTypes).extend(markdownHighlighting),Object.keys(DefaultBlockParsers).map(function(n){return DefaultBlockParsers[n]}),Object.keys(DefaultBlockParsers).map(function(n){return DefaultLeafBlocks[n]}),Object.keys(DefaultBlockParsers),DefaultEndLeaf,DefaultSkipMarkup,Object.keys(DefaultInline).map(function(n){return DefaultInline[n]}),Object.keys(DefaultInline),[]);function leftOverSpace(node,from,to){var ranges=[];for(var n=node.firstChild,pos=from;;n=n.nextSibling){var nextPos=n?n.from:to;if(nextPos>pos)ranges.push({from:pos,to:nextPos});if(!n)break;pos=n.to}return ranges}function parseCode(config){var codeParser=config.codeParser,htmlParser=config.htmlParser;var wrap=parseMixed(function(node,input){var id=node.type.id;if(codeParser&&(id==Type.CodeBlock||id==Type.FencedCode)){var info="";if(id==Type.FencedCode){var infoNode=node.node.getChild(Type.CodeInfo);if(infoNode)info=input.read(infoNode.from,infoNode.to)}var _parser4=codeParser(info);if(_parser4)return{parser:_parser4,overlay:function overlay(node){return node.type.id==Type.CodeText}}}else if(htmlParser&&(id==Type.HTMLBlock||id==Type.HTMLTag)){return{parser:htmlParser,overlay:leftOverSpace(node.node,node.from,node.to)}}return null});return{wrap:wrap}}var StrikethroughDelim={resolve:"Strikethrough",mark:"StrikethroughMark"};var Strikethrough={defineNodes:[{name:"Strikethrough",style:{"Strikethrough/...":tags$1.strikethrough}},{name:"StrikethroughMark",style:tags$1.processingInstruction}],parseInline:[{name:"Strikethrough",parse:function parse(cx,next,pos){if(next!=126||cx["char"](pos+1)!=126||cx["char"](pos+2)==126)return-1;var before=cx.slice(pos-1,pos),after=cx.slice(pos+2,pos+3);var sBefore=/\s|^$/.test(before),sAfter=/\s|^$/.test(after);var pBefore=Punctuation.test(before),pAfter=Punctuation.test(after);return cx.addDelimiter(StrikethroughDelim,pos,pos+2,!sAfter&&(!pAfter||sBefore||pBefore),!sBefore&&(!pBefore||sAfter||pAfter))},after:"Emphasis"}]};function parseRow(cx,line){var startI=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var elts=arguments.length>3?arguments[3]:undefined;var offset=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var count=0,first=true,cellStart=-1,cellEnd=-1,esc=false;var parseCell=function parseCell(){elts.push(cx.elt("TableCell",offset+cellStart,offset+cellEnd,cx.parser.parseInline(line.slice(cellStart,cellEnd),offset+cellStart)))};for(var _i281=startI;_i281<line.length;_i281++){var next=line.charCodeAt(_i281);if(next==124&&!esc){if(!first||cellStart>-1)count++;first=false;if(elts){if(cellStart>-1)parseCell();elts.push(cx.elt("TableDelimiter",_i281+offset,_i281+offset+1))}cellStart=cellEnd=-1}else if(esc||next!=32&&next!=9){if(cellStart<0)cellStart=_i281;cellEnd=_i281+1}esc=!esc&&next==92}if(cellStart>-1){count++;if(elts)parseCell()}return count}function hasPipe(str,start){for(var _i282=start;_i282<str.length;_i282++){var next=str.charCodeAt(_i282);if(next==124)return true;if(next==92)_i282++}return false}var delimiterLine=/^\|?(\s*:?-+:?\s*\|)+(\s*:?-+:?\s*)?$/;var TableParser=function(){function TableParser(){_classCallCheck2(this,TableParser);this.rows=null}_createClass2(TableParser,[{key:"nextLine",value:function nextLine(cx,line,leaf){if(this.rows==null){this.rows=false;var lineText;if((line.next==45||line.next==58||line.next==124)&&delimiterLine.test(lineText=line.text.slice(line.pos))){var firstRow=[],firstCount=parseRow(cx,leaf.content,0,firstRow,leaf.start);if(firstCount==parseRow(cx,lineText,line.pos))this.rows=[cx.elt("TableHeader",leaf.start,leaf.start+leaf.content.length,firstRow),cx.elt("TableDelimiter",cx.lineStart+line.pos,cx.lineStart+line.text.length)]}}else if(this.rows){var _content10=[];parseRow(cx,line.text,line.pos,_content10,cx.lineStart);this.rows.push(cx.elt("TableRow",cx.lineStart+line.pos,cx.lineStart+line.text.length,_content10))}return false}},{key:"finish",value:function finish(cx,leaf){if(!this.rows)return false;cx.addLeafElement(leaf,cx.elt("Table",leaf.start,leaf.start+leaf.content.length,this.rows));return true}}]);return TableParser}();var Table={defineNodes:[{name:"Table",block:true},{name:"TableHeader",style:{"TableHeader/...":tags$1.heading}},"TableRow",{name:"TableCell",style:tags$1.content},{name:"TableDelimiter",style:tags$1.processingInstruction}],parseBlock:[{name:"Table",leaf:function leaf(_,_leaf){return hasPipe(_leaf.content,0)?new TableParser:null},endLeaf:function endLeaf(cx,line,leaf){if(leaf.parsers.some(function(p){return p instanceof TableParser})||!hasPipe(line.text,line.basePos))return false;var next=cx.scanLine(cx.absoluteLineEnd+1).text;return delimiterLine.test(next)&&parseRow(cx,line.text,line.basePos)==parseRow(cx,next,line.basePos)},before:"SetextHeading"}]};var TaskParser=function(){function TaskParser(){_classCallCheck2(this,TaskParser)}_createClass2(TaskParser,[{key:"nextLine",value:function nextLine(){return false}},{key:"finish",value:function finish(cx,leaf){cx.addLeafElement(leaf,cx.elt("Task",leaf.start,leaf.start+leaf.content.length,[cx.elt("TaskMarker",leaf.start,leaf.start+3)].concat(_toConsumableArray2(cx.parser.parseInline(leaf.content.slice(3),leaf.start+3)))));return true}}]);return TaskParser}();var TaskList={defineNodes:[{name:"Task",block:true,style:tags$1.list},{name:"TaskMarker",style:tags$1.atom}],parseBlock:[{name:"TaskList",leaf:function leaf(cx,_leaf2){return /^\[[ xX]\][ \t]/.test(_leaf2.content)&&cx.parentType().name=="ListItem"?new TaskParser:null},after:"SetextHeading"}]};var autolinkRE=new RegExp("(www\\.)|(https?:\\/\\/)|([\\w.+-]+@)|(mailto:|xmpp:)","gy");var urlRE=new RegExp("[\\w-]+(\\.[\\w-]+)+(\\/[^\\s<]*)?","gy");var lastTwoDomainWords=/[\w-]+\.[\w-]+($|\/)/;var emailRE=new RegExp("[\\w.+-]+@[\\w-]+(\\.[\\w.-]+)+","gy");var xmppResourceRE=new RegExp("\\/[a-zA-Z\\d@.]+","gy");function count(str,from,to,ch){var result=0;for(var _i283=from;_i283<to;_i283++)if(str[_i283]==ch)result++;return result}function autolinkURLEnd(text,from){urlRE.lastIndex=from;var m=urlRE.exec(text);if(!m||lastTwoDomainWords.exec(m[0])[0].indexOf("_")>-1)return-1;var end=from+m[0].length;for(;;){var last=text[end-1],_m5=void 0;if(/[?!.,:*_~]/.test(last)||last==")"&&count(text,from,end,")")>count(text,from,end,"("))end--;else if(last==";"&&(_m5=/&(?:#\d+|#x[a-f\d]+|\w+);$/.exec(text.slice(from,end))))end=from+_m5.index;else break}return end}function autolinkEmailEnd(text,from){emailRE.lastIndex=from;var m=emailRE.exec(text);if(!m)return-1;var last=m[0][m[0].length-1];return last=="_"||last=="-"?-1:from+m[0].length-(last=="."?1:0)}var Autolink={parseInline:[{name:"Autolink",parse:function parse(cx,next,absPos){var pos=absPos-cx.offset;autolinkRE.lastIndex=pos;var m=autolinkRE.exec(cx.text),end=-1;if(!m)return-1;if(m[1]||m[2]){end=autolinkURLEnd(cx.text,pos+m[0].length)}else if(m[3]){end=autolinkEmailEnd(cx.text,pos)}else{end=autolinkEmailEnd(cx.text,pos+m[0].length);if(end>-1&&m[0]=="xmpp:"){xmppResourceRE.lastIndex=end;m=xmppResourceRE.exec(cx.text);if(m)end=m.index+m[0].length}}if(end<0)return-1;cx.addElement(cx.elt("URL",absPos,end+cx.offset));return end+cx.offset}}]};var GFM=[Table,TaskList,Strikethrough,Autolink];function parseSubSuper(ch,node,mark){return function(cx,next,pos){if(next!=ch||cx["char"](pos+1)==ch)return-1;var elts=[cx.elt(mark,pos,pos+1)];for(var _i284=pos+1;_i284<cx.end;_i284++){var _next7=cx["char"](_i284);if(_next7==ch)return cx.addElement(cx.elt(node,pos,_i284+1,elts.concat(cx.elt(mark,_i284,_i284+1))));if(_next7==92)elts.push(cx.elt("Escape",_i284,_i284++ +2));if(space$2(_next7))break}return-1}}var Superscript={defineNodes:[{name:"Superscript",style:tags$1.special(tags$1.content)},{name:"SuperscriptMark",style:tags$1.processingInstruction}],parseInline:[{name:"Superscript",parse:parseSubSuper(94,"Superscript","SuperscriptMark")}]};var Subscript={defineNodes:[{name:"Subscript",style:tags$1.special(tags$1.content)},{name:"SubscriptMark",style:tags$1.processingInstruction}],parseInline:[{name:"Subscript",parse:parseSubSuper(126,"Subscript","SubscriptMark")}]};var Emoji={defineNodes:[{name:"Emoji",style:tags$1.character}],parseInline:[{name:"Emoji",parse:function parse(cx,next,pos){var match;if(next!=58||!(match=/^[a-zA-Z_0-9]+:/.exec(cx.slice(pos+1,cx.end))))return-1;return cx.addElement(cx.elt("Emoji",pos,pos+1+match[0].length))}}]};var Stack=function(){function Stack(p,stack,state,reducePos,pos,score,buffer,bufferBase,curContext){var lookAhead=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var parent=arguments.length>10?arguments[10]:undefined;_classCallCheck2(this,Stack);this.p=p;this.stack=stack;this.state=state;this.reducePos=reducePos;this.pos=pos;this.score=score;this.buffer=buffer;this.bufferBase=bufferBase;this.curContext=curContext;this.lookAhead=lookAhead;this.parent=parent}_createClass2(Stack,[{key:"toString",value:function toString(){return"[".concat(this.stack.filter(function(_,i){return i%3==0}).concat(this.state),"]@").concat(this.pos).concat(this.score?"!"+this.score:"")}},{key:"context",get:function get(){return this.curContext?this.curContext.context:null}},{key:"pushState",value:function pushState(state,start){this.stack.push(this.state,start,this.bufferBase+this.buffer.length);this.state=state}},{key:"reduce",value:function reduce(action){var _a;var depth=action>>19,type=action&65535;var parser=this.p.parser;var dPrec=parser.dynamicPrecedence(type);if(dPrec)this.score+=dPrec;if(depth==0){this.pushState(parser.getGoto(this.state,type,true),this.reducePos);if(type<parser.minRepeatTerm)this.storeNode(type,this.reducePos,this.reducePos,4,true);this.reduceContext(type,this.reducePos);return}var base=this.stack.length-(depth-1)*3-(action&262144?6:0);var start=base?this.stack[base-2]:this.p.ranges[0].from,size=this.reducePos-start;if(size>=2000&&!((_a=this.p.parser.nodeSet.types[type])===null||_a===void 0?void 0:_a.isAnonymous)){if(start==this.p.lastBigReductionStart){this.p.bigReductionCount++;this.p.lastBigReductionSize=size}else if(this.p.lastBigReductionSize<size){this.p.bigReductionCount=1;this.p.lastBigReductionStart=start;this.p.lastBigReductionSize=size}}var bufferBase=base?this.stack[base-1]:0,count=this.bufferBase+this.buffer.length-bufferBase;if(type<parser.minRepeatTerm||action&131072){var pos=parser.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(type,start,pos,count+4,true)}if(action&262144){this.state=this.stack[base]}else{var baseStateID=this.stack[base-3];this.state=parser.getGoto(baseStateID,type,true)}while(this.stack.length>base)this.stack.pop();this.reduceContext(type,start)}},{key:"storeNode",value:function storeNode(term,start,end){var size=arguments.length>3&&arguments[3]!==undefined?arguments[3]:4;var isReduce=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;if(term==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){var _cur25=this,_top10=this.buffer.length;if(_top10==0&&_cur25.parent){_top10=_cur25.bufferBase-_cur25.parent.bufferBase;_cur25=_cur25.parent}if(_top10>0&&_cur25.buffer[_top10-4]==0&&_cur25.buffer[_top10-1]>-1){if(start==end)return;if(_cur25.buffer[_top10-2]>=start){_cur25.buffer[_top10-2]=end;return}}}if(!isReduce||this.pos==end){this.buffer.push(term,start,end,size)}else{var index=this.buffer.length;if(index>0&&this.buffer[index-4]!=0)while(index>0&&this.buffer[index-2]>end){this.buffer[index]=this.buffer[index-4];this.buffer[index+1]=this.buffer[index-3];this.buffer[index+2]=this.buffer[index-2];this.buffer[index+3]=this.buffer[index-1];index-=4;if(size>4)size-=4}this.buffer[index]=term;this.buffer[index+1]=start;this.buffer[index+2]=end;this.buffer[index+3]=size}}},{key:"shift",value:function shift(action,type,start,end){if(action&131072){this.pushState(action&65535,this.pos)}else if((action&262144)==0){var nextState=action,_parser5=this.p.parser;if(end>this.pos||type<=_parser5.maxNode){this.pos=end;if(!_parser5.stateFlag(nextState,1))this.reducePos=end}this.pushState(nextState,start);this.shiftContext(type,start);if(type<=_parser5.maxNode)this.buffer.push(type,start,end,4)}else{this.pos=end;this.shiftContext(type,start);if(type<=this.p.parser.maxNode)this.buffer.push(type,start,end,4)}}},{key:"apply",value:function apply(action,next,nextStart,nextEnd){if(action&65536)this.reduce(action);else this.shift(action,next,nextStart,nextEnd)}},{key:"useNode",value:function useNode(value,next){var index=this.p.reused.length-1;if(index<0||this.p.reused[index]!=value){this.p.reused.push(value);index++}var start=this.pos;this.reducePos=this.pos=start+value.length;this.pushState(next,start);this.buffer.push(index,start,this.reducePos,-1);if(this.curContext)this.updateContext(this.curContext.tracker.reuse(this.curContext.context,value,this,this.p.stream.reset(this.pos-value.length)))}},{key:"split",value:function split(){var parent=this;var off=parent.buffer.length;while(off>0&&parent.buffer[off-2]>parent.reducePos)off-=4;var buffer=parent.buffer.slice(off),base=parent.bufferBase+off;while(parent&&base==parent.bufferBase)parent=parent.parent;return new Stack(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,buffer,base,this.curContext,this.lookAhead,parent)}},{key:"recoverByDelete",value:function recoverByDelete(next,nextEnd){var isNode=next<=this.p.parser.maxNode;if(isNode)this.storeNode(next,this.pos,nextEnd,4);this.storeNode(0,this.pos,nextEnd,isNode?8:4);this.pos=this.reducePos=nextEnd;this.score-=190}},{key:"canShift",value:function canShift(term){for(var sim=new SimulatedStack(this);;){var action=this.p.parser.stateSlot(sim.state,4)||this.p.parser.hasAction(sim.state,term);if(action==0)return false;if((action&65536)==0)return true;sim.reduce(action)}}},{key:"recoverByInsert",value:function recoverByInsert(next){if(this.stack.length>=300)return[];var nextStates=this.p.parser.nextStates(this.state);if(nextStates.length>4<<1||this.stack.length>=120){var best=[];for(var _i285=0,s;_i285<nextStates.length;_i285+=2){if((s=nextStates[_i285+1])!=this.state&&this.p.parser.hasAction(s,next))best.push(nextStates[_i285],s)}if(this.stack.length<120){var _loop29=function _loop29(){var s=nextStates[_i286+1];if(!best.some(function(v,i){return i&1&&v==s}))best.push(nextStates[_i286],s)};for(var _i286=0;best.length<4<<1&&_i286<nextStates.length;_i286+=2){_loop29()}}nextStates=best}var result=[];for(var _i287=0;_i287<nextStates.length&&result.length<4;_i287+=2){var _s5=nextStates[_i287+1];if(_s5==this.state)continue;var stack=this.split();stack.pushState(_s5,this.pos);stack.storeNode(0,stack.pos,stack.pos,4,true);stack.shiftContext(nextStates[_i287],this.pos);stack.reducePos=this.pos;stack.score-=200;result.push(stack)}return result}},{key:"forceReduce",value:function forceReduce(){var parser=this.p.parser;var reduce=parser.stateSlot(this.state,5);if((reduce&65536)==0)return false;if(!parser.validAction(this.state,reduce)){var depth=reduce>>19,term=reduce&65535;var target=this.stack.length-depth*3;if(target<0||parser.getGoto(this.stack[target],term,false)<0){var backup=this.findForcedReduction();if(backup==null)return false;reduce=backup}this.storeNode(0,this.pos,this.pos,4,true);this.score-=100}this.reducePos=this.pos;this.reduce(reduce);return true}},{key:"findForcedReduction",value:function findForcedReduction(){var _this271=this;var parser=this.p.parser,seen=[];var explore=function explore(state,depth){if(seen.includes(state))return;seen.push(state);return parser.allActions(state,function(action){if(action&(262144|131072));else if(action&65536){var rDepth=(action>>19)-depth;if(rDepth>1){var term=action&65535,target=_this271.stack.length-rDepth*3;if(target>=0&&parser.getGoto(_this271.stack[target],term,false)>=0)return rDepth<<19|65536|term}}else{var found=explore(action,depth+1);if(found!=null)return found}})};return explore(this.state,0)}},{key:"forceAll",value:function forceAll(){while(!this.p.parser.stateFlag(this.state,2)){if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,true);break}}return this}},{key:"deadEnd",get:function get(){if(this.stack.length!=3)return false;var parser=this.p.parser;return parser.data[parser.stateSlot(this.state,1)]==65535&&!parser.stateSlot(this.state,4)}},{key:"restart",value:function restart(){this.storeNode(0,this.pos,this.pos,4,true);this.state=this.stack[0];this.stack.length=0}},{key:"sameState",value:function sameState(other){if(this.state!=other.state||this.stack.length!=other.stack.length)return false;for(var _i288=0;_i288<this.stack.length;_i288+=3)if(this.stack[_i288]!=other.stack[_i288])return false;return true}},{key:"parser",get:function get(){return this.p.parser}},{key:"dialectEnabled",value:function dialectEnabled(dialectID){return this.p.parser.dialect.flags[dialectID]}},{key:"shiftContext",value:function shiftContext(term,start){if(this.curContext)this.updateContext(this.curContext.tracker.shift(this.curContext.context,term,this,this.p.stream.reset(start)))}},{key:"reduceContext",value:function reduceContext(term,start){if(this.curContext)this.updateContext(this.curContext.tracker.reduce(this.curContext.context,term,this,this.p.stream.reset(start)))}},{key:"emitContext",value:function emitContext(){var last=this.buffer.length-1;if(last<0||this.buffer[last]!=-3)this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}},{key:"emitLookAhead",value:function emitLookAhead(){var last=this.buffer.length-1;if(last<0||this.buffer[last]!=-4)this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}},{key:"updateContext",value:function updateContext(context){if(context!=this.curContext.context){var newCx=new StackContext(this.curContext.tracker,context);if(newCx.hash!=this.curContext.hash)this.emitContext();this.curContext=newCx}}},{key:"setLookAhead",value:function setLookAhead(lookAhead){if(lookAhead>this.lookAhead){this.emitLookAhead();this.lookAhead=lookAhead}}},{key:"close",value:function close(){if(this.curContext&&this.curContext.tracker.strict)this.emitContext();if(this.lookAhead>0)this.emitLookAhead()}}],[{key:"start",value:function start(p,state){var pos=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var cx=p.parser.context;return new Stack(p,[],state,pos,pos,0,[],0,cx?new StackContext(cx,cx.start):null,0,null)}}]);return Stack}();var StackContext=_createClass2(function StackContext(tracker,context){_classCallCheck2(this,StackContext);this.tracker=tracker;this.context=context;this.hash=tracker.strict?tracker.hash(context):0});var SimulatedStack=function(){function SimulatedStack(start){_classCallCheck2(this,SimulatedStack);this.start=start;this.state=start.state;this.stack=start.stack;this.base=this.stack.length}_createClass2(SimulatedStack,[{key:"reduce",value:function reduce(action){var term=action&65535,depth=action>>19;if(depth==0){if(this.stack==this.start.stack)this.stack=this.stack.slice();this.stack.push(this.state,0,0);this.base+=3}else{this.base-=(depth-1)*3}var _goto=this.start.p.parser.getGoto(this.stack[this.base-3],term,true);this.state=_goto}}]);return SimulatedStack}();var StackBufferCursor=function(){function StackBufferCursor(stack,pos,index){_classCallCheck2(this,StackBufferCursor);this.stack=stack;this.pos=pos;this.index=index;this.buffer=stack.buffer;if(this.index==0)this.maybeNext()}_createClass2(StackBufferCursor,[{key:"maybeNext",value:function maybeNext(){var next=this.stack.parent;if(next!=null){this.index=this.stack.bufferBase-next.bufferBase;this.stack=next;this.buffer=next.buffer}}},{key:"id",get:function get(){return this.buffer[this.index-4]}},{key:"start",get:function get(){return this.buffer[this.index-3]}},{key:"end",get:function get(){return this.buffer[this.index-2]}},{key:"size",get:function get(){return this.buffer[this.index-1]}},{key:"next",value:function next(){this.index-=4;this.pos-=4;if(this.index==0)this.maybeNext()}},{key:"fork",value:function fork(){return new StackBufferCursor(this.stack,this.pos,this.index)}}],[{key:"create",value:function create(stack){var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:stack.bufferBase+stack.buffer.length;return new StackBufferCursor(stack,pos,pos-stack.bufferBase)}}]);return StackBufferCursor}();function decodeArray(input){var Type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Uint16Array;if(typeof input!="string")return input;var array=null;for(var pos=0,out=0;pos<input.length;){var value=0;for(;;){var next=input.charCodeAt(pos++),stop=false;if(next==126){value=65535;break}if(next>=92)next--;if(next>=34)next--;var digit=next-32;if(digit>=46){digit-=46;stop=true}value+=digit;if(stop)break;value*=46}if(array)array[out++]=value;else array=new Type(value)}return array}var CachedToken=_createClass2(function CachedToken(){_classCallCheck2(this,CachedToken);this.start=-1;this.value=-1;this.end=-1;this.extended=-1;this.lookAhead=0;this.mask=0;this.context=0});var nullToken=new CachedToken;var InputStream=function(){function InputStream(input,ranges){_classCallCheck2(this,InputStream);this.input=input;this.ranges=ranges;this.chunk="";this.chunkOff=0;this.chunk2="";this.chunk2Pos=0;this.next=-1;this.token=nullToken;this.rangeIndex=0;this.pos=this.chunkPos=ranges[0].from;this.range=ranges[0];this.end=ranges[ranges.length-1].to;this.readNext()}_createClass2(InputStream,[{key:"resolveOffset",value:function resolveOffset(offset,assoc){var range=this.range,index=this.rangeIndex;var pos=this.pos+offset;while(pos<range.from){if(!index)return null;var next=this.ranges[--index];pos-=range.from-next.to;range=next}while(assoc<0?pos>range.to:pos>=range.to){if(index==this.ranges.length-1)return null;var _next8=this.ranges[++index];pos+=_next8.from-range.to;range=_next8}return pos}},{key:"clipPos",value:function clipPos(pos){if(pos>=this.range.from&&pos<this.range.to)return pos;var _iterator445=_createForOfIteratorHelper(this.ranges),_step445;try{for(_iterator445.s();!(_step445=_iterator445.n()).done;){var range=_step445.value;if(range.to>pos)return Math.max(pos,range.from)}}catch(err){_iterator445.e(err)}finally{_iterator445.f()}return this.end}},{key:"peek",value:function peek(offset){var idx=this.chunkOff+offset,pos,result;if(idx>=0&&idx<this.chunk.length){pos=this.pos+offset;result=this.chunk.charCodeAt(idx)}else{var resolved=this.resolveOffset(offset,1);if(resolved==null)return-1;pos=resolved;if(pos>=this.chunk2Pos&&pos<this.chunk2Pos+this.chunk2.length){result=this.chunk2.charCodeAt(pos-this.chunk2Pos)}else{var _i289=this.rangeIndex,range=this.range;while(range.to<=pos)range=this.ranges[++_i289];this.chunk2=this.input.chunk(this.chunk2Pos=pos);if(pos+this.chunk2.length>range.to)this.chunk2=this.chunk2.slice(0,range.to-pos);result=this.chunk2.charCodeAt(0)}}if(pos>=this.token.lookAhead)this.token.lookAhead=pos+1;return result}},{key:"acceptToken",value:function acceptToken(token){var endOffset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var end=endOffset?this.resolveOffset(endOffset,-1):this.pos;if(end==null||end<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=token;this.token.end=end}},{key:"getChunk",value:function getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){var chunk=this.chunk,chunkPos=this.chunkPos;this.chunk=this.chunk2;this.chunkPos=this.chunk2Pos;this.chunk2=chunk;this.chunk2Pos=chunkPos;this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk;this.chunk2Pos=this.chunkPos;var nextChunk=this.input.chunk(this.pos);var _end41=this.pos+nextChunk.length;this.chunk=_end41>this.range.to?nextChunk.slice(0,this.range.to-this.pos):nextChunk;this.chunkPos=this.pos;this.chunkOff=0}}},{key:"readNext",value:function readNext(){if(this.chunkOff>=this.chunk.length){this.getChunk();if(this.chunkOff==this.chunk.length)return this.next=-1}return this.next=this.chunk.charCodeAt(this.chunkOff)}},{key:"advance",value:function advance(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.chunkOff+=n;while(this.pos+n>=this.range.to){if(this.rangeIndex==this.ranges.length-1)return this.setDone();n-=this.range.to-this.pos;this.range=this.ranges[++this.rangeIndex];this.pos=this.range.from}this.pos+=n;if(this.pos>=this.token.lookAhead)this.token.lookAhead=this.pos+1;return this.readNext()}},{key:"setDone",value:function setDone(){this.pos=this.chunkPos=this.end;this.range=this.ranges[this.rangeIndex=this.ranges.length-1];this.chunk="";return this.next=-1}},{key:"reset",value:function reset(pos,token){if(token){this.token=token;token.start=pos;token.lookAhead=pos+1;token.value=token.extended=-1}else{this.token=nullToken}if(this.pos!=pos){this.pos=pos;if(pos==this.end){this.setDone();return this}while(pos<this.range.from)this.range=this.ranges[--this.rangeIndex];while(pos>=this.range.to)this.range=this.ranges[++this.rangeIndex];if(pos>=this.chunkPos&&pos<this.chunkPos+this.chunk.length){this.chunkOff=pos-this.chunkPos}else{this.chunk="";this.chunkOff=0}this.readNext()}return this}},{key:"read",value:function read(from,to){if(from>=this.chunkPos&&to<=this.chunkPos+this.chunk.length)return this.chunk.slice(from-this.chunkPos,to-this.chunkPos);if(from>=this.chunk2Pos&&to<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(from-this.chunk2Pos,to-this.chunk2Pos);if(from>=this.range.from&&to<=this.range.to)return this.input.read(from,to);var result="";var _iterator446=_createForOfIteratorHelper(this.ranges),_step446;try{for(_iterator446.s();!(_step446=_iterator446.n()).done;){var _r14=_step446.value;if(_r14.from>=to)break;if(_r14.to>from)result+=this.input.read(Math.max(_r14.from,from),Math.min(_r14.to,to))}}catch(err){_iterator446.e(err)}finally{_iterator446.f()}return result}}]);return InputStream}();var TokenGroup=function(){function TokenGroup(data,id){_classCallCheck2(this,TokenGroup);this.data=data;this.id=id}_createClass2(TokenGroup,[{key:"token",value:function token(input,stack){var parser=stack.p.parser;readToken(this.data,input,stack,this.id,parser.data,parser.tokenPrecTable)}}]);return TokenGroup}();TokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=false;var LocalTokenGroup=function(){function LocalTokenGroup(data,precTable,elseToken){_classCallCheck2(this,LocalTokenGroup);this.precTable=precTable;this.elseToken=elseToken;this.data=typeof data=="string"?decodeArray(data):data}_createClass2(LocalTokenGroup,[{key:"token",value:function token(input,stack){var start=input.pos,skipped=0;for(;;){var atEof=input.next<0,nextPos=input.resolveOffset(1,1);readToken(this.data,input,stack,0,this.data,this.precTable);if(input.token.value>-1)break;if(this.elseToken==null)return;if(!atEof)skipped++;if(nextPos==null)break;input.reset(nextPos,input.token)}if(skipped){input.reset(start,input.token);input.acceptToken(this.elseToken,skipped)}}}]);return LocalTokenGroup}();LocalTokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=false;var ExternalTokenizer=_createClass2(function ExternalTokenizer(token){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck2(this,ExternalTokenizer);this.token=token;this.contextual=!!options.contextual;this.fallback=!!options.fallback;this.extend=!!options.extend});function readToken(data,input,stack,group,precTable,precOffset){var state=0,groupMask=1<<group,dialect=stack.p.parser.dialect;scan:for(;;){if((groupMask&data[state])==0)break;var accEnd=data[state+1];for(var _i290=state+3;_i290<accEnd;_i290+=2)if((data[_i290+1]&groupMask)>0){var term=data[_i290];if(dialect.allows(term)&&(input.token.value==-1||input.token.value==term||overrides(term,input.token.value,precTable,precOffset))){input.acceptToken(term);break}}var next=input.next,low=0,high=data[state+2];if(input.next<0&&high>low&&data[accEnd+high*3-3]==65535){state=data[accEnd+high*3-1];continue scan}for(;low<high;){var mid=low+high>>1;var index=accEnd+mid+(mid<<1);var from=data[index],to=data[index+1]||65536;if(next<from)high=mid;else if(next>=to)low=mid+1;else{state=data[index+2];input.advance();continue scan}}break}}function findOffset(data,start,term){for(var _i291=start,next;(next=data[_i291])!=65535;_i291++)if(next==term)return _i291-start;return-1}function overrides(token,prev,tableData,tableOffset){var iPrev=findOffset(tableData,tableOffset,prev);return iPrev<0||findOffset(tableData,tableOffset,token)<iPrev}var verbose=typeof process!="undefined"&&process.env&&/\bparse\b/.test(process.env.LOG);var stackIDs=null;function cutAt(tree,pos,side){var cursor=tree.cursor(IterMode.IncludeAnonymous);cursor.moveTo(pos);for(;;){if(!(side<0?cursor.childBefore(pos):cursor.childAfter(pos)))for(;;){if((side<0?cursor.to<pos:cursor.from>pos)&&!cursor.type.isError)return side<0?Math.max(0,Math.min(cursor.to-1,pos-25)):Math.min(tree.length,Math.max(cursor.from+1,pos+25));if(side<0?cursor.prevSibling():cursor.nextSibling())break;if(!cursor.parent())return side<0?0:tree.length}}}var FragmentCursor=function(){function FragmentCursor(fragments,nodeSet){_classCallCheck2(this,FragmentCursor);this.fragments=fragments;this.nodeSet=nodeSet;this.i=0;this.fragment=null;this.safeFrom=-1;this.safeTo=-1;this.trees=[];this.start=[];this.index=[];this.nextFragment()}_createClass2(FragmentCursor,[{key:"nextFragment",value:function nextFragment(){var fr=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(fr){this.safeFrom=fr.openStart?cutAt(fr.tree,fr.from+fr.offset,1)-fr.offset:fr.from;this.safeTo=fr.openEnd?cutAt(fr.tree,fr.to+fr.offset,-1)-fr.offset:fr.to;while(this.trees.length){this.trees.pop();this.start.pop();this.index.pop()}this.trees.push(fr.tree);this.start.push(-fr.offset);this.index.push(0);this.nextStart=this.safeFrom}else{this.nextStart=1e9}}},{key:"nodeAt",value:function nodeAt(pos){if(pos<this.nextStart)return null;while(this.fragment&&this.safeTo<=pos)this.nextFragment();if(!this.fragment)return null;for(;;){var last=this.trees.length-1;if(last<0){this.nextFragment();return null}var _top11=this.trees[last],index=this.index[last];if(index==_top11.children.length){this.trees.pop();this.start.pop();this.index.pop();continue}var next=_top11.children[index];var _start24=this.start[last]+_top11.positions[index];if(_start24>pos){this.nextStart=_start24;return null}if(next instanceof Tree){if(_start24==pos){if(_start24<this.safeFrom)return null;var _end42=_start24+next.length;if(_end42<=this.safeTo){var lookAhead=next.prop(NodeProp.lookAhead);if(!lookAhead||_end42+lookAhead<this.fragment.to)return next}}this.index[last]++;if(_start24+next.length>=Math.max(this.safeFrom,pos)){this.trees.push(next);this.start.push(_start24);this.index.push(0)}}else{this.index[last]++;this.nextStart=_start24+next.length}}}}]);return FragmentCursor}();var TokenCache=function(){function TokenCache(parser,stream){_classCallCheck2(this,TokenCache);this.stream=stream;this.tokens=[];this.mainToken=null;this.actions=[];this.tokens=parser.tokenizers.map(function(_){return new CachedToken})}_createClass2(TokenCache,[{key:"getActions",value:function getActions(stack){var actionIndex=0;var main=null;var parser=stack.p.parser,tokenizers=parser.tokenizers;var mask=parser.stateSlot(stack.state,3);var context=stack.curContext?stack.curContext.hash:0;var lookAhead=0;for(var _i292=0;_i292<tokenizers.length;_i292++){if((1<<_i292&mask)==0)continue;var tokenizer=tokenizers[_i292],token=this.tokens[_i292];if(main&&!tokenizer.fallback)continue;if(tokenizer.contextual||token.start!=stack.pos||token.mask!=mask||token.context!=context){this.updateCachedToken(token,tokenizer,stack);token.mask=mask;token.context=context}if(token.lookAhead>token.end+25)lookAhead=Math.max(token.lookAhead,lookAhead);if(token.value!=0){var startIndex=actionIndex;if(token.extended>-1)actionIndex=this.addActions(stack,token.extended,token.end,actionIndex);actionIndex=this.addActions(stack,token.value,token.end,actionIndex);if(!tokenizer.extend){main=token;if(actionIndex>startIndex)break}}}while(this.actions.length>actionIndex)this.actions.pop();if(lookAhead)stack.setLookAhead(lookAhead);if(!main&&stack.pos==this.stream.end){main=new CachedToken;main.value=stack.p.parser.eofTerm;main.start=main.end=stack.pos;actionIndex=this.addActions(stack,main.value,main.end,actionIndex)}this.mainToken=main;return this.actions}},{key:"getMainToken",value:function getMainToken(stack){if(this.mainToken)return this.mainToken;var main=new CachedToken,pos=stack.pos,p=stack.p;main.start=pos;main.end=Math.min(pos+1,p.stream.end);main.value=pos==p.stream.end?p.parser.eofTerm:0;return main}},{key:"updateCachedToken",value:function updateCachedToken(token,tokenizer,stack){var start=this.stream.clipPos(stack.pos);tokenizer.token(this.stream.reset(start,token),stack);if(token.value>-1){var _parser6=stack.p.parser;for(var _i293=0;_i293<_parser6.specialized.length;_i293++)if(_parser6.specialized[_i293]==token.value){var result=_parser6.specializers[_i293](this.stream.read(token.start,token.end),stack);if(result>=0&&stack.p.parser.dialect.allows(result>>1)){if((result&1)==0)token.value=result>>1;else token.extended=result>>1;break}}}else{token.value=0;token.end=this.stream.clipPos(start+1)}}},{key:"putAction",value:function putAction(action,token,end,index){for(var _i294=0;_i294<index;_i294+=3)if(this.actions[_i294]==action)return index;this.actions[index++]=action;this.actions[index++]=token;this.actions[index++]=end;return index}},{key:"addActions",value:function addActions(stack,token,end,index){var state=stack.state,parser=stack.p.parser,data=parser.data;for(var set=0;set<2;set++){for(var _i295=parser.stateSlot(state,set?2:1);;_i295+=3){if(data[_i295]==65535){if(data[_i295+1]==1){_i295=pair(data,_i295+2)}else{if(index==0&&data[_i295+1]==2)index=this.putAction(pair(data,_i295+2),token,end,index);break}}if(data[_i295]==token)index=this.putAction(pair(data,_i295+1),token,end,index)}}return index}}]);return TokenCache}();var Parse=function(){function Parse(parser,input,fragments,ranges){_classCallCheck2(this,Parse);this.parser=parser;this.input=input;this.ranges=ranges;this.recovering=0;this.nextStackID=9812;this.minStackPos=0;this.reused=[];this.stoppedAt=null;this.lastBigReductionStart=-1;this.lastBigReductionSize=0;this.bigReductionCount=0;this.stream=new InputStream(input,ranges);this.tokens=new TokenCache(parser,this.stream);this.topTerm=parser.top[1];var from=ranges[0].from;this.stacks=[Stack.start(this,parser.top[0],from)];this.fragments=fragments.length&&this.stream.end-from>parser.bufferLength*4?new FragmentCursor(fragments,parser.nodeSet):null}_createClass2(Parse,[{key:"parsedPos",get:function get(){return this.minStackPos}},{key:"advance",value:function advance(){var stacks=this.stacks,pos=this.minStackPos;var newStacks=this.stacks=[];var stopped,stoppedTokens;if(this.bigReductionCount>300&&stacks.length==1){var _stacks=_slicedToArray2(stacks,1),s=_stacks[0];while(s.forceReduce()&&s.stack.length&&s.stack[s.stack.length-2]>=this.lastBigReductionStart){}this.bigReductionCount=this.lastBigReductionSize=0}for(var _i296=0;_i296<stacks.length;_i296++){var stack=stacks[_i296];for(;;){this.tokens.mainToken=null;if(stack.pos>pos){newStacks.push(stack)}else if(this.advanceStack(stack,newStacks,stacks)){continue}else{if(!stopped){stopped=[];stoppedTokens=[]}stopped.push(stack);var tok=this.tokens.getMainToken(stack);stoppedTokens.push(tok.value,tok.end)}break}}if(!newStacks.length){var finished=stopped&&findFinished(stopped);if(finished){if(verbose)console.log("Finish with "+this.stackID(finished));return this.stackToTree(finished)}if(this.parser.strict){if(verbose&&stopped)console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none"));throw new SyntaxError("No parse at "+pos)}if(!this.recovering)this.recovering=5}if(this.recovering&&stopped){var _finished=this.stoppedAt!=null&&stopped[0].pos>this.stoppedAt?stopped[0]:this.runRecovery(stopped,stoppedTokens,newStacks);if(_finished){if(verbose)console.log("Force-finish "+this.stackID(_finished));return this.stackToTree(_finished.forceAll())}}if(this.recovering){var maxRemaining=this.recovering==1?1:this.recovering*3;if(newStacks.length>maxRemaining){newStacks.sort(function(a,b){return b.score-a.score});while(newStacks.length>maxRemaining)newStacks.pop()}if(newStacks.some(function(s){return s.reducePos>pos}))this.recovering--}else if(newStacks.length>1){outer:for(var _i297=0;_i297<newStacks.length-1;_i297++){var _stack=newStacks[_i297];for(var j=_i297+1;j<newStacks.length;j++){var other=newStacks[j];if(_stack.sameState(other)||_stack.buffer.length>500&&other.buffer.length>500){if((_stack.score-other.score||_stack.buffer.length-other.buffer.length)>0){newStacks.splice(j--,1)}else{newStacks.splice(_i297--,1);continue outer}}}}if(newStacks.length>12)newStacks.splice(12,newStacks.length-12)}this.minStackPos=newStacks[0].pos;for(var _i298=1;_i298<newStacks.length;_i298++)if(newStacks[_i298].pos<this.minStackPos)this.minStackPos=newStacks[_i298].pos;return null}},{key:"stopAt",value:function stopAt(pos){if(this.stoppedAt!=null&&this.stoppedAt<pos)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=pos}},{key:"advanceStack",value:function advanceStack(stack,stacks,split){var start=stack.pos,parser=this.parser;var base=verbose?this.stackID(stack)+" -> ":"";if(this.stoppedAt!=null&&start>this.stoppedAt)return stack.forceReduce()?stack:null;if(this.fragments){var strictCx=stack.curContext&&stack.curContext.tracker.strict,cxHash=strictCx?stack.curContext.hash:0;for(var cached=this.fragments.nodeAt(start);cached;){var match=this.parser.nodeSet.types[cached.type.id]==cached.type?parser.getGoto(stack.state,cached.type.id):-1;if(match>-1&&cached.length&&(!strictCx||(cached.prop(NodeProp.contextHash)||0)==cxHash)){stack.useNode(cached,match);if(verbose)console.log(base+this.stackID(stack)+" (via reuse of ".concat(parser.getName(cached.type.id),")"));return true}if(!(cached instanceof Tree)||cached.children.length==0||cached.positions[0]>0)break;var inner=cached.children[0];if(inner instanceof Tree&&cached.positions[0]==0)cached=inner;else break}}var defaultReduce=parser.stateSlot(stack.state,4);if(defaultReduce>0){stack.reduce(defaultReduce);if(verbose)console.log(base+this.stackID(stack)+" (via always-reduce ".concat(parser.getName(defaultReduce&65535),")"));return true}if(stack.stack.length>=8400){while(stack.stack.length>6000&&stack.forceReduce()){}}var actions=this.tokens.getActions(stack);for(var _i299=0;_i299<actions.length;){var action=actions[_i299++],term=actions[_i299++],_end43=actions[_i299++];var last=_i299==actions.length||!split;var localStack=last?stack:stack.split();var _main2=this.tokens.mainToken;localStack.apply(action,term,_main2?_main2.start:localStack.pos,_end43);if(verbose)console.log(base+this.stackID(localStack)+" (via ".concat((action&65536)==0?"shift":"reduce of ".concat(parser.getName(action&65535))," for ").concat(parser.getName(term)," @ ").concat(start).concat(localStack==stack?"":", split",")"));if(last)return true;else if(localStack.pos>start)stacks.push(localStack);else split.push(localStack)}return false}},{key:"advanceFully",value:function advanceFully(stack,newStacks){var pos=stack.pos;for(;;){if(!this.advanceStack(stack,null,null))return false;if(stack.pos>pos){pushStackDedup(stack,newStacks);return true}}}},{key:"runRecovery",value:function runRecovery(stacks,tokens,newStacks){var finished=null,restarted=false;for(var _i300=0;_i300<stacks.length;_i300++){var stack=stacks[_i300],token=tokens[_i300<<1],tokenEnd=tokens[(_i300<<1)+1];var _base4=verbose?this.stackID(stack)+" -> ":"";if(stack.deadEnd){if(restarted)continue;restarted=true;stack.restart();if(verbose)console.log(_base4+this.stackID(stack)+" (restarted)");var done=this.advanceFully(stack,newStacks);if(done)continue}var force=stack.split(),forceBase=_base4;for(var j=0;force.forceReduce()&&j<10;j++){if(verbose)console.log(forceBase+this.stackID(force)+" (via force-reduce)");var _done2=this.advanceFully(force,newStacks);if(_done2)break;if(verbose)forceBase=this.stackID(force)+" -> "}var _iterator447=_createForOfIteratorHelper(stack.recoverByInsert(token)),_step447;try{for(_iterator447.s();!(_step447=_iterator447.n()).done;){var _insert2=_step447.value;if(verbose)console.log(_base4+this.stackID(_insert2)+" (via recover-insert)");this.advanceFully(_insert2,newStacks)}}catch(err){_iterator447.e(err)}finally{_iterator447.f()}if(this.stream.end>stack.pos){if(tokenEnd==stack.pos){tokenEnd++;token=0}stack.recoverByDelete(token,tokenEnd);if(verbose)console.log(_base4+this.stackID(stack)+" (via recover-delete ".concat(this.parser.getName(token),")"));pushStackDedup(stack,newStacks)}else if(!finished||finished.score<stack.score){finished=stack}}return finished}},{key:"stackToTree",value:function stackToTree(stack){stack.close();return Tree.build({buffer:StackBufferCursor.create(stack),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:stack.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}},{key:"stackID",value:function stackID(stack){var id=(stackIDs||(stackIDs=new WeakMap)).get(stack);if(!id)stackIDs.set(stack,id=String.fromCodePoint(this.nextStackID++));return id+stack}}]);return Parse}();function pushStackDedup(stack,newStacks){for(var _i301=0;_i301<newStacks.length;_i301++){var other=newStacks[_i301];if(other.pos==stack.pos&&other.sameState(stack)){if(newStacks[_i301].score<stack.score)newStacks[_i301]=stack;return}}newStacks.push(stack)}var Dialect=function(){function Dialect(source,flags,disabled){_classCallCheck2(this,Dialect);this.source=source;this.flags=flags;this.disabled=disabled}_createClass2(Dialect,[{key:"allows",value:function allows(term){return!this.disabled||this.disabled[term]==0}}]);return Dialect}();var id=function id(x){return x};var ContextTracker=_createClass2(function ContextTracker(spec){_classCallCheck2(this,ContextTracker);this.start=spec.start;this.shift=spec.shift||id;this.reduce=spec.reduce||id;this.reuse=spec.reuse||id;this.hash=spec.hash||function(){return 0};this.strict=spec.strict!==false});var LRParser=function(_Parser3){_inherits2(LRParser,_Parser3);var _super111=_createSuper(LRParser);function LRParser(spec){var _this272$nodeSet;var _this272;_classCallCheck2(this,LRParser);_this272=_super111.call(this);_this272.wrappers=[];if(spec.version!=14)throw new RangeError("Parser version (".concat(spec.version,") doesn't match runtime version (",14,")"));var nodeNames=spec.nodeNames.split(" ");_this272.minRepeatTerm=nodeNames.length;for(var _i302=0;_i302<spec.repeatNodeCount;_i302++)nodeNames.push("");var topTerms=Object.keys(spec.topRules).map(function(r){return spec.topRules[r][1]});var nodeProps=[];for(var _i303=0;_i303<nodeNames.length;_i303++)nodeProps.push([]);function setProp(nodeID,prop,value){nodeProps[nodeID].push([prop,prop.deserialize(String(value))])}if(spec.nodeProps){var _iterator448=_createForOfIteratorHelper(spec.nodeProps),_step448;try{for(_iterator448.s();!(_step448=_iterator448.n()).done;){var propSpec=_step448.value;var prop=propSpec[0];if(typeof prop=="string")prop=NodeProp[prop];for(var _i304=1;_i304<propSpec.length;){var next=propSpec[_i304++];if(next>=0){setProp(next,prop,propSpec[_i304++])}else{var value=propSpec[_i304+-next];for(var j=-next;j>0;j--)setProp(propSpec[_i304++],prop,value);_i304++}}}}catch(err){_iterator448.e(err)}finally{_iterator448.f()}}_this272.nodeSet=new NodeSet(nodeNames.map(function(name,i){return NodeType.define({name:i>=_this272.minRepeatTerm?undefined:name,id:i,props:nodeProps[i],top:topTerms.indexOf(i)>-1,error:i==0,skipped:spec.skippedNodes&&spec.skippedNodes.indexOf(i)>-1})}));if(spec.propSources)_this272.nodeSet=(_this272$nodeSet=_this272.nodeSet).extend.apply(_this272$nodeSet,_toConsumableArray2(spec.propSources));_this272.strict=false;_this272.bufferLength=DefaultBufferLength;var tokenArray=decodeArray(spec.tokenData);_this272.context=spec.context;_this272.specializerSpecs=spec.specialized||[];_this272.specialized=new Uint16Array(_this272.specializerSpecs.length);for(var _i305=0;_i305<_this272.specializerSpecs.length;_i305++)_this272.specialized[_i305]=_this272.specializerSpecs[_i305].term;_this272.specializers=_this272.specializerSpecs.map(getSpecializer);_this272.states=decodeArray(spec.states,Uint32Array);_this272.data=decodeArray(spec.stateData);_this272["goto"]=decodeArray(spec["goto"]);_this272.maxTerm=spec.maxTerm;_this272.tokenizers=spec.tokenizers.map(function(value){return typeof value=="number"?new TokenGroup(tokenArray,value):value});_this272.topRules=spec.topRules;_this272.dialects=spec.dialects||{};_this272.dynamicPrecedences=spec.dynamicPrecedences||null;_this272.tokenPrecTable=spec.tokenPrec;_this272.termNames=spec.termNames||null;_this272.maxNode=_this272.nodeSet.types.length-1;_this272.dialect=_this272.parseDialect();_this272.top=_this272.topRules[Object.keys(_this272.topRules)[0]];return _this272}_createClass2(LRParser,[{key:"createParse",value:function createParse(input,fragments,ranges){var parse=new Parse(this,input,fragments,ranges);var _iterator449=_createForOfIteratorHelper(this.wrappers),_step449;try{for(_iterator449.s();!(_step449=_iterator449.n()).done;){var w=_step449.value;parse=w(parse,input,fragments,ranges)}}catch(err){_iterator449.e(err)}finally{_iterator449.f()}return parse}},{key:"getGoto",value:function getGoto(state,term){var loose=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var table=this["goto"];if(term>=table[0])return-1;for(var pos=table[term+1];;){var groupTag=table[pos++],last=groupTag&1;var target=table[pos++];if(last&&loose)return target;for(var _end44=pos+(groupTag>>1);pos<_end44;pos++)if(table[pos]==state)return target;if(last)return-1}}},{key:"hasAction",value:function hasAction(state,terminal){var data=this.data;for(var set=0;set<2;set++){for(var _i306=this.stateSlot(state,set?2:1),next;;_i306+=3){if((next=data[_i306])==65535){if(data[_i306+1]==1)next=data[_i306=pair(data,_i306+2)];else if(data[_i306+1]==2)return pair(data,_i306+2);else break}if(next==terminal||next==0)return pair(data,_i306+1)}}return 0}},{key:"stateSlot",value:function stateSlot(state,slot){return this.states[state*6+slot]}},{key:"stateFlag",value:function stateFlag(state,flag){return(this.stateSlot(state,0)&flag)>0}},{key:"validAction",value:function validAction(state,action){return!!this.allActions(state,function(a){return a==action?true:null})}},{key:"allActions",value:function allActions(state,action){var deflt=this.stateSlot(state,4);var result=deflt?action(deflt):undefined;for(var _i307=this.stateSlot(state,1);result==null;_i307+=3){if(this.data[_i307]==65535){if(this.data[_i307+1]==1)_i307=pair(this.data,_i307+2);else break}result=action(pair(this.data,_i307+1))}return result}},{key:"nextStates",value:function nextStates(state){var _this273=this;var result=[];var _loop30=function _loop30(_i309){if(_this273.data[_i309]==65535){if(_this273.data[_i309+1]==1)_i309=pair(_this273.data,_i309+2);else{_i308=_i309;return 1}}if((_this273.data[_i309+2]&65536>>16)==0){var value=_this273.data[_i309+1];if(!result.some(function(v,i){return i&1&&v==value}))result.push(_this273.data[_i309],value)}_i308=_i309};for(var _i308=this.stateSlot(state,1);;_i308+=3){if(_loop30(_i308))break}return result}},{key:"configure",value:function configure(config){var _this$nodeSet;var copy=Object.assign(Object.create(LRParser.prototype),this);if(config.props)copy.nodeSet=(_this$nodeSet=this.nodeSet).extend.apply(_this$nodeSet,_toConsumableArray2(config.props));if(config.top){var info=this.topRules[config.top];if(!info)throw new RangeError("Invalid top rule name ".concat(config.top));copy.top=info}if(config.tokenizers)copy.tokenizers=this.tokenizers.map(function(t){var found=config.tokenizers.find(function(r){return r.from==t});return found?found.to:t});if(config.specializers){copy.specializers=this.specializers.slice();copy.specializerSpecs=this.specializerSpecs.map(function(s,i){var found=config.specializers.find(function(r){return r.from==s.external});if(!found)return s;var spec=Object.assign(Object.assign({},s),{external:found.to});copy.specializers[i]=getSpecializer(spec);return spec})}if(config.contextTracker)copy.context=config.contextTracker;if(config.dialect)copy.dialect=this.parseDialect(config.dialect);if(config.strict!=null)copy.strict=config.strict;if(config.wrap)copy.wrappers=copy.wrappers.concat(config.wrap);if(config.bufferLength!=null)copy.bufferLength=config.bufferLength;return copy}},{key:"hasWrappers",value:function hasWrappers(){return this.wrappers.length>0}},{key:"getName",value:function getName(term){return this.termNames?this.termNames[term]:String(term<=this.maxNode&&this.nodeSet.types[term].name||term)}},{key:"eofTerm",get:function get(){return this.maxNode+1}},{key:"topNode",get:function get(){return this.nodeSet.types[this.top[1]]}},{key:"dynamicPrecedence",value:function dynamicPrecedence(term){var prec=this.dynamicPrecedences;return prec==null?0:prec[term]||0}},{key:"parseDialect",value:function parseDialect(dialect){var values=Object.keys(this.dialects),flags=values.map(function(){return false});if(dialect){var _iterator450=_createForOfIteratorHelper(dialect.split(" ")),_step450;try{for(_iterator450.s();!(_step450=_iterator450.n()).done;){var part=_step450.value;var _id24=values.indexOf(part);if(_id24>=0)flags[_id24]=true}}catch(err){_iterator450.e(err)}finally{_iterator450.f()}}var disabled=null;for(var _i310=0;_i310<values.length;_i310++)if(!flags[_i310]){for(var j=this.dialects[values[_i310]],_id25;(_id25=this.data[j++])!=65535;)(disabled||(disabled=new Uint8Array(this.maxTerm+1)))[_id25]=1}return new Dialect(dialect,flags,disabled)}}],[{key:"deserialize",value:function deserialize(spec){return new LRParser(spec)}}]);return LRParser}(Parser);function pair(data,off){return data[off]|data[off+1]<<16}function findFinished(stacks){var best=null;var _iterator451=_createForOfIteratorHelper(stacks),_step451;try{for(_iterator451.s();!(_step451=_iterator451.n()).done;){var stack=_step451.value;var stopped=stack.p.stoppedAt;if((stack.pos==stack.p.stream.end||stopped!=null&&stack.pos>stopped)&&stack.p.parser.stateFlag(stack.state,2)&&(!best||best.score<stack.score))best=stack}}catch(err){_iterator451.e(err)}finally{_iterator451.f()}return best}function getSpecializer(spec){if(spec.external){var mask=spec.extend?1:0;return function(value,stack){return spec.external(value,stack)<<1|mask}}return spec.get}var scriptText=54,StartCloseScriptTag=1,styleText=55,StartCloseStyleTag=2,textareaText=56,StartCloseTextareaTag=3,EndTag=4,SelfClosingEndTag=5,StartTag=6,StartScriptTag=7,StartStyleTag=8,StartTextareaTag=9,StartSelfClosingTag=10,StartCloseTag=11,NoMatchStartCloseTag=12,MismatchedStartCloseTag=13,missingCloseTag=57,IncompleteCloseTag=14,commentContent$1=58,Element$1=20,TagName=22,Attribute=23,AttributeName=24,AttributeValue=26,UnquotedAttributeValue=27,ScriptText=28,StyleText=31,TextareaText=34,OpenTag=36,CloseTag=37,Dialect_noMatch=0,Dialect_selfClosing=1;var selfClosers$1={area:true,base:true,br:true,col:true,command:true,embed:true,frame:true,hr:true,img:true,input:true,keygen:true,link:true,meta:true,param:true,source:true,track:true,wbr:true,menuitem:true};var implicitlyClosed={dd:true,li:true,optgroup:true,option:true,p:true,rp:true,rt:true,tbody:true,td:true,tfoot:true,th:true,tr:true};var closeOnOpen={dd:{dd:true,dt:true},dt:{dd:true,dt:true},li:{li:true},option:{option:true,optgroup:true},optgroup:{optgroup:true},p:{address:true,article:true,aside:true,blockquote:true,dir:true,div:true,dl:true,fieldset:true,footer:true,form:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,header:true,hgroup:true,hr:true,menu:true,nav:true,ol:true,p:true,pre:true,section:true,table:true,ul:true},rp:{rp:true,rt:true},rt:{rp:true,rt:true},tbody:{tbody:true,tfoot:true},td:{td:true,th:true},tfoot:{tbody:true},th:{td:true,th:true},thead:{tbody:true,tfoot:true},tr:{tr:true}};function nameChar(ch){return ch==45||ch==46||ch==58||ch>=65&&ch<=90||ch==95||ch>=97&&ch<=122||ch>=161}function isSpace(ch){return ch==9||ch==10||ch==13||ch==32}var cachedName=null,cachedInput=null,cachedPos=0;function tagNameAfter(input,offset){var pos=input.pos+offset;if(cachedPos==pos&&cachedInput==input)return cachedName;var next=input.peek(offset);while(isSpace(next))next=input.peek(++offset);var name="";for(;;){if(!nameChar(next))break;name+=String.fromCharCode(next);next=input.peek(++offset)}cachedInput=input;cachedPos=pos;return cachedName=name?name.toLowerCase():next==question||next==bang?undefined:null}var lessThan=60,greaterThan=62,slash$1=47,question=63,bang=33,dash$1=45;function ElementContext(name,parent){this.name=name;this.parent=parent;this.hash=parent?parent.hash:0;for(var _i311=0;_i311<name.length;_i311++)this.hash+=(this.hash<<4)+name.charCodeAt(_i311)+(name.charCodeAt(_i311)<<8)}var startTagTerms=[StartTag,StartSelfClosingTag,StartScriptTag,StartStyleTag,StartTextareaTag];var elementContext=new ContextTracker({start:null,shift:function shift(context,term,stack,input){return startTagTerms.indexOf(term)>-1?new ElementContext(tagNameAfter(input,1)||"",context):context},reduce:function reduce(context,term){return term==Element$1&&context?context.parent:context},reuse:function reuse(context,node,stack,input){var type=node.type.id;return type==StartTag||type==OpenTag?new ElementContext(tagNameAfter(input,1)||"",context):context},hash:function hash(context){return context?context.hash:0},strict:false});var tagStart=new ExternalTokenizer(function(input,stack){if(input.next!=lessThan){if(input.next<0&&stack.context)input.acceptToken(missingCloseTag);return}input.advance();var close=input.next==slash$1;if(close)input.advance();var name=tagNameAfter(input,0);if(name===undefined)return;if(!name)return input.acceptToken(close?IncompleteCloseTag:StartTag);var parent=stack.context?stack.context.name:null;if(close){if(name==parent)return input.acceptToken(StartCloseTag);if(parent&&implicitlyClosed[parent])return input.acceptToken(missingCloseTag,-2);if(stack.dialectEnabled(Dialect_noMatch))return input.acceptToken(NoMatchStartCloseTag);for(var cx=stack.context;cx;cx=cx.parent)if(cx.name==name)return;input.acceptToken(MismatchedStartCloseTag)}else{if(name=="script")return input.acceptToken(StartScriptTag);if(name=="style")return input.acceptToken(StartStyleTag);if(name=="textarea")return input.acceptToken(StartTextareaTag);if(selfClosers$1.hasOwnProperty(name))return input.acceptToken(StartSelfClosingTag);if(parent&&closeOnOpen[parent]&&closeOnOpen[parent][name])input.acceptToken(missingCloseTag,-1);else input.acceptToken(StartTag)}},{contextual:true});var commentContent=new ExternalTokenizer(function(input){for(var dashes=0,_i312=0;;_i312++){if(input.next<0){if(_i312)input.acceptToken(commentContent$1);break}if(input.next==dash$1){dashes++}else if(input.next==greaterThan&&dashes>=2){if(_i312>=3)input.acceptToken(commentContent$1,-2);break}else{dashes=0}input.advance()}});function inForeignElement(context){for(;context;context=context.parent)if(context.name=="svg"||context.name=="math")return true;return false}var endTag=new ExternalTokenizer(function(input,stack){if(input.next==slash$1&&input.peek(1)==greaterThan){var selfClosing=stack.dialectEnabled(Dialect_selfClosing)||inForeignElement(stack.context);input.acceptToken(selfClosing?SelfClosingEndTag:EndTag,2)}else if(input.next==greaterThan){input.acceptToken(EndTag,1)}});function contentTokenizer(tag,textToken,endToken){var lastState=2+tag.length;return new ExternalTokenizer(function(input){for(var state=0,matchedLen=0,_i313=0;;_i313++){if(input.next<0){if(_i313)input.acceptToken(textToken);break}if(state==0&&input.next==lessThan||state==1&&input.next==slash$1||state>=2&&state<lastState&&input.next==tag.charCodeAt(state-2)){state++;matchedLen++}else if((state==2||state==lastState)&&isSpace(input.next)){matchedLen++}else if(state==lastState&&input.next==greaterThan){if(_i313>matchedLen)input.acceptToken(textToken,-matchedLen);else input.acceptToken(endToken,-(matchedLen-2));break}else if((input.next==10||input.next==13)&&_i313){input.acceptToken(textToken,1);break}else{state=matchedLen=0}input.advance()}})}var scriptTokens=contentTokenizer("script",scriptText,StartCloseScriptTag);var styleTokens=contentTokenizer("style",styleText,StartCloseStyleTag);var textareaTokens=contentTokenizer("textarea",textareaText,StartCloseTextareaTag);var htmlHighlighting=styleTags({"Text RawText":tags$1.content,"StartTag StartCloseTag SelfClosingEndTag EndTag":tags$1.angleBracket,TagName:tags$1.tagName,"MismatchedCloseTag/TagName":[tags$1.tagName,tags$1.invalid],AttributeName:tags$1.attributeName,"AttributeValue UnquotedAttributeValue":tags$1.attributeValue,Is:tags$1.definitionOperator,"EntityReference CharacterReference":tags$1.character,Comment:tags$1.blockComment,ProcessingInst:tags$1.processingInstruction,DoctypeDecl:tags$1.documentMeta});var parser$2=LRParser.deserialize({version:14,states:",xOVO!rOOO!WQ#tO'#CqO!]Q#tO'#CzO!bQ#tO'#C}O!gQ#tO'#DQO!lQ#tO'#DSO!qOaO'#CpO!|ObO'#CpO#XOdO'#CpO$eO!rO'#CpOOO`'#Cp'#CpO$lO$fO'#DTO$tQ#tO'#DVO$yQ#tO'#DWOOO`'#Dk'#DkOOO`'#DY'#DYQVO!rOOO%OQ&rO,59]O%WQ&rO,59fO%`Q&rO,59iO%hQ&rO,59lO%sQ&rO,59nOOOa'#D^'#D^O%{OaO'#CxO&WOaO,59[OOOb'#D_'#D_O&`ObO'#C{O&kObO,59[OOOd'#D`'#D`O&sOdO'#DOO'OOdO,59[OOO`'#Da'#DaO'WO!rO,59[O'_Q#tO'#DROOO`,59[,59[OOOp'#Db'#DbO'dO$fO,59oOOO`,59o,59oO'lQ#|O,59qO'qQ#|O,59rOOO`-E7W-E7WO'vQ&rO'#CsOOQW'#DZ'#DZO(UQ&rO1G.wOOOa1G.w1G.wO(^Q&rO1G/QOOOb1G/Q1G/QO(fQ&rO1G/TOOOd1G/T1G/TO(nQ&rO1G/WOOO`1G/W1G/WOOO`1G/Y1G/YO(yQ&rO1G/YOOOa-E7[-E7[O)RQ#tO'#CyOOO`1G.v1G.vOOOb-E7]-E7]O)WQ#tO'#C|OOOd-E7^-E7^O)]Q#tO'#DPOOO`-E7_-E7_O)bQ#|O,59mOOOp-E7`-E7`OOO`1G/Z1G/ZOOO`1G/]1G/]OOO`1G/^1G/^O)gQ,UO,59_OOQW-E7X-E7XOOOa7+$c7+$cOOOb7+$l7+$lOOOd7+$o7+$oOOO`7+$r7+$rOOO`7+$t7+$tO)rQ#|O,59eO)wQ#|O,59hO)|Q#|O,59kOOO`1G/X1G/XO*RO7[O'#CvO*dOMhO'#CvOOQW1G.y1G.yOOO`1G/P1G/POOO`1G/S1G/SOOO`1G/V1G/VOOOO'#D['#D[O*uO7[O,59bOOQW,59b,59bOOOO'#D]'#D]O+WOMhO,59bOOOO-E7Y-E7YOOQW1G.|1G.|OOOO-E7Z-E7Z",stateData:"+s~O!^OS~OUSOVPOWQOXROYTO[]O][O^^O`^Oa^Ob^Oc^Ox^O{_O!dZO~OfaO~OfbO~OfcO~OfdO~OfeO~O!WfOPlP!ZlP~O!XiOQoP!ZoP~O!YlORrP!ZrP~OUSOVPOWQOXROYTOZqO[]O][O^^O`^Oa^Ob^Oc^Ox^O!dZO~O!ZrO~P#dO![sO!euO~OfvO~OfwO~OS|OhyO~OS!OOhyO~OS!QOhyO~OS!SOT!TOhyO~OS!TOhyO~O!WfOPlX!ZlX~OP!WO!Z!XO~O!XiOQoX!ZoX~OQ!ZO!Z!XO~O!YlORrX!ZrX~OR!]O!Z!XO~O!Z!XO~P#dOf!_O~O![sO!e!aO~OS!bO~OS!cO~Oi!dOSgXhgXTgX~OS!fOhyO~OS!gOhyO~OS!hOhyO~OS!iOT!jOhyO~OS!jOhyO~Of!kO~Of!lO~Of!mO~OS!nO~Ok!qO!`!oO!b!pO~OS!rO~OS!sO~OS!tO~Oa!uOb!uOc!uO!`!wO!a!uO~Oa!xOb!xOc!xO!b!wO!c!xO~Oa!uOb!uOc!uO!`!{O!a!uO~Oa!xOb!xOc!xO!b!{O!c!xO~OT~bac!dx{!d~","goto":"%p!`PPPPPPPPPPPPPPPPPPPP!a!gP!mPP!yP!|#P#S#Y#]#`#f#i#l#r#x!aP!a!aP$O$U$l$r$x%O%U%[%bPPPPPPPP%hX^OX`pXUOX`pezabcde{}!P!R!UR!q!dRhUR!XhXVOX`pRkVR!XkXWOX`pRnWR!XnXXOX`pQrXR!XpXYOX`pQ`ORx`Q{aQ}bQ!PcQ!RdQ!UeZ!e{}!P!R!UQ!v!oR!z!vQ!y!pR!|!yQgUR!VgQjVR!YjQmWR![mQpXR!^pQtZR!`tS_O`ToXp",nodeNames:"\u26A0 StartCloseTag StartCloseTag StartCloseTag EndTag SelfClosingEndTag StartTag StartTag StartTag StartTag StartTag StartCloseTag StartCloseTag StartCloseTag IncompleteCloseTag Document Text EntityReference CharacterReference InvalidEntity Element OpenTag TagName Attribute AttributeName Is AttributeValue UnquotedAttributeValue ScriptText CloseTag OpenTag StyleText CloseTag OpenTag TextareaText CloseTag OpenTag CloseTag SelfClosingTag Comment ProcessingInst MismatchedCloseTag CloseTag DoctypeDecl",maxTerm:67,context:elementContext,nodeProps:[["closedBy",-10,1,2,3,7,8,9,10,11,12,13,"EndTag",6,"EndTag SelfClosingEndTag",-4,21,30,33,36,"CloseTag"],["openedBy",4,"StartTag StartCloseTag",5,"StartTag",-4,29,32,35,37,"OpenTag"],["group",-9,14,17,18,19,20,39,40,41,42,"Entity",16,"Entity TextContent",-3,28,31,34,"TextContent Entity"],["isolate",-11,21,29,30,32,33,35,36,37,38,41,42,"ltr",-3,26,27,39,""]],propSources:[htmlHighlighting],skippedNodes:[0],repeatNodeCount:9,tokenData:"!<p!aR!YOX$qXY,QYZ,QZ[$q[]&X]^,Q^p$qpq,Qqr-_rs3_sv-_vw3}wxHYx}-_}!OH{!O!P-_!P!Q$q!Q![-_![!]Mz!]!^-_!^!_!$S!_!`!;x!`!a&X!a!c-_!c!}Mz!}#R-_#R#SMz#S#T1k#T#oMz#o#s-_#s$f$q$f%W-_%W%oMz%o%p-_%p&aMz&a&b-_&b1pMz1p4U-_4U4dMz4d4e-_4e$ISMz$IS$I`-_$I`$IbMz$Ib$Kh-_$Kh%#tMz%#t&/x-_&/x&EtMz&Et&FV-_&FV;'SMz;'S;:j!#|;:j;=`3X<%l?&r-_?&r?AhMz?Ah?BY$q?BY?MnMz?MnO$q!Z$|c`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr$qrs&}sv$qvw+Pwx(tx!^$q!^!_*V!_!a&X!a#S$q#S#T&X#T;'S$q;'S;=`+z<%lO$q!R&bX`P!a`!cpOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&Xq'UV`P!cpOv&}wx'kx!^&}!^!_(V!_;'S&};'S;=`(n<%lO&}P'pT`POv'kw!^'k!_;'S'k;'S;=`(P<%lO'kP(SP;=`<%l'kp([S!cpOv(Vx;'S(V;'S;=`(h<%lO(Vp(kP;=`<%l(Vq(qP;=`<%l&}a({W`P!a`Or(trs'ksv(tw!^(t!^!_)e!_;'S(t;'S;=`*P<%lO(t`)jT!a`Or)esv)ew;'S)e;'S;=`)y<%lO)e`)|P;=`<%l)ea*SP;=`<%l(t!Q*^V!a`!cpOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!Q*vP;=`<%l*V!R*|P;=`<%l&XW+UYkWOX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+PW+wP;=`<%l+P!Z+}P;=`<%l$q!a,]``P!a`!cp!^^OX&XXY,QYZ,QZ]&X]^,Q^p&Xpq,Qqr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X!_-ljhS`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx!P-_!P!Q$q!Q!^-_!^!_*V!_!a&X!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q[/ebhSkWOX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+PS0rXhSqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0mS1bP;=`<%l0m[1hP;=`<%l/^!V1vchS`P!a`!cpOq&Xqr1krs&}sv1kvw0mwx(tx!P1k!P!Q&X!Q!^1k!^!_*V!_!a&X!a#s1k#s$f&X$f;'S1k;'S;=`3R<%l?Ah1k?Ah?BY&X?BY?Mn1k?MnO&X!V3UP;=`<%l1k!_3[P;=`<%l-_!Z3hV!`h`P!cpOv&}wx'kx!^&}!^!_(V!_;'S&};'S;=`(n<%lO&}!_4WihSkWc!ROX5uXZ7SZ[5u[^7S^p5uqr8trs7Sst>]tw8twx7Sx!P8t!P!Q5u!Q!]8t!]!^/^!^!a7S!a#S8t#S#T;{#T#s8t#s$f5u$f;'S8t;'S;=`>V<%l?Ah8t?Ah?BY5u?BY?Mn8t?MnO5u!Z5zbkWOX5uXZ7SZ[5u[^7S^p5uqr5urs7Sst+Ptw5uwx7Sx!]5u!]!^7w!^!a7S!a#S5u#S#T7S#T;'S5u;'S;=`8n<%lO5u!R7VVOp7Sqs7St!]7S!]!^7l!^;'S7S;'S;=`7q<%lO7S!R7qOa!R!R7tP;=`<%l7S!Z8OYkWa!ROX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+P!Z8qP;=`<%l5u!_8{ihSkWOX5uXZ7SZ[5u[^7S^p5uqr8trs7Sst/^tw8twx7Sx!P8t!P!Q5u!Q!]8t!]!^:j!^!a7S!a#S8t#S#T;{#T#s8t#s$f5u$f;'S8t;'S;=`>V<%l?Ah8t?Ah?BY5u?BY?Mn8t?MnO5u!_:sbhSkWa!ROX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+P!V<QchSOp7Sqr;{rs7Sst0mtw;{wx7Sx!P;{!P!Q7S!Q!];{!]!^=]!^!a7S!a#s;{#s$f7S$f;'S;{;'S;=`>P<%l?Ah;{?Ah?BY7S?BY?Mn;{?MnO7S!V=dXhSa!Rqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0m!V>SP;=`<%l;{!_>YP;=`<%l8t!_>dhhSkWOX@OXZAYZ[@O[^AY^p@OqrBwrsAYswBwwxAYx!PBw!P!Q@O!Q!]Bw!]!^/^!^!aAY!a#SBw#S#TE{#T#sBw#s$f@O$f;'SBw;'S;=`HS<%l?AhBw?Ah?BY@O?BY?MnBw?MnO@O!Z@TakWOX@OXZAYZ[@O[^AY^p@Oqr@OrsAYsw@OwxAYx!]@O!]!^Az!^!aAY!a#S@O#S#TAY#T;'S@O;'S;=`Bq<%lO@O!RA]UOpAYq!]AY!]!^Ao!^;'SAY;'S;=`At<%lOAY!RAtOb!R!RAwP;=`<%lAY!ZBRYkWb!ROX+PZ[+P^p+Pqr+Psw+Px!^+P!a#S+P#T;'S+P;'S;=`+t<%lO+P!ZBtP;=`<%l@O!_COhhSkWOX@OXZAYZ[@O[^AY^p@OqrBwrsAYswBwwxAYx!PBw!P!Q@O!Q!]Bw!]!^Dj!^!aAY!a#SBw#S#TE{#T#sBw#s$f@O$f;'SBw;'S;=`HS<%l?AhBw?Ah?BY@O?BY?MnBw?MnO@O!_DsbhSkWb!ROX+PZ[+P^p+Pqr/^sw/^x!P/^!P!Q+P!Q!^/^!a#S/^#S#T0m#T#s/^#s$f+P$f;'S/^;'S;=`1e<%l?Ah/^?Ah?BY+P?BY?Mn/^?MnO+P!VFQbhSOpAYqrE{rsAYswE{wxAYx!PE{!P!QAY!Q!]E{!]!^GY!^!aAY!a#sE{#s$fAY$f;'SE{;'S;=`G|<%l?AhE{?Ah?BYAY?BY?MnE{?MnOAY!VGaXhSb!Rqr0msw0mx!P0m!Q!^0m!a#s0m$f;'S0m;'S;=`1_<%l?Ah0m?BY?Mn0m!VHPP;=`<%lE{!_HVP;=`<%lBw!ZHcW!bx`P!a`Or(trs'ksv(tw!^(t!^!_)e!_;'S(t;'S;=`*P<%lO(t!aIYlhS`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx}-_}!OKQ!O!P-_!P!Q$q!Q!^-_!^!_*V!_!a&X!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q!aK_khS`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx!P-_!P!Q$q!Q!^-_!^!_*V!_!`&X!`!aMS!a#S-_#S#T1k#T#s-_#s$f$q$f;'S-_;'S;=`3X<%l?Ah-_?Ah?BY$q?BY?Mn-_?MnO$q!TM_X`P!a`!cp!eQOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X!aNZ!ZhSfQ`PkW!a`!cpOX$qXZ&XZ[$q[^&X^p$qpq&Xqr-_rs&}sv-_vw/^wx(tx}-_}!OMz!O!PMz!P!Q$q!Q![Mz![!]Mz!]!^-_!^!_*V!_!a&X!a!c-_!c!}Mz!}#R-_#R#SMz#S#T1k#T#oMz#o#s-_#s$f$q$f$}-_$}%OMz%O%W-_%W%oMz%o%p-_%p&aMz&a&b-_&b1pMz1p4UMz4U4dMz4d4e-_4e$ISMz$IS$I`-_$I`$IbMz$Ib$Je-_$Je$JgMz$Jg$Kh-_$Kh%#tMz%#t&/x-_&/x&EtMz&Et&FV-_&FV;'SMz;'S;:j!#|;:j;=`3X<%l?&r-_?&r?AhMz?Ah?BY$q?BY?MnMz?MnO$q!a!$PP;=`<%lMz!R!$ZY!a`!cpOq*Vqr!$yrs(Vsv*Vwx)ex!a*V!a!b!4t!b;'S*V;'S;=`*s<%lO*V!R!%Q]!a`!cpOr*Vrs(Vsv*Vwx)ex}*V}!O!%y!O!f*V!f!g!']!g#W*V#W#X!0`#X;'S*V;'S;=`*s<%lO*V!R!&QX!a`!cpOr*Vrs(Vsv*Vwx)ex}*V}!O!&m!O;'S*V;'S;=`*s<%lO*V!R!&vV!a`!cp!dPOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!'dX!a`!cpOr*Vrs(Vsv*Vwx)ex!q*V!q!r!(P!r;'S*V;'S;=`*s<%lO*V!R!(WX!a`!cpOr*Vrs(Vsv*Vwx)ex!e*V!e!f!(s!f;'S*V;'S;=`*s<%lO*V!R!(zX!a`!cpOr*Vrs(Vsv*Vwx)ex!v*V!v!w!)g!w;'S*V;'S;=`*s<%lO*V!R!)nX!a`!cpOr*Vrs(Vsv*Vwx)ex!{*V!{!|!*Z!|;'S*V;'S;=`*s<%lO*V!R!*bX!a`!cpOr*Vrs(Vsv*Vwx)ex!r*V!r!s!*}!s;'S*V;'S;=`*s<%lO*V!R!+UX!a`!cpOr*Vrs(Vsv*Vwx)ex!g*V!g!h!+q!h;'S*V;'S;=`*s<%lO*V!R!+xY!a`!cpOr!+qrs!,hsv!+qvw!-Swx!.[x!`!+q!`!a!/j!a;'S!+q;'S;=`!0Y<%lO!+qq!,mV!cpOv!,hvx!-Sx!`!,h!`!a!-q!a;'S!,h;'S;=`!.U<%lO!,hP!-VTO!`!-S!`!a!-f!a;'S!-S;'S;=`!-k<%lO!-SP!-kO{PP!-nP;=`<%l!-Sq!-xS!cp{POv(Vx;'S(V;'S;=`(h<%lO(Vq!.XP;=`<%l!,ha!.aX!a`Or!.[rs!-Ssv!.[vw!-Sw!`!.[!`!a!.|!a;'S!.[;'S;=`!/d<%lO!.[a!/TT!a`{POr)esv)ew;'S)e;'S;=`)y<%lO)ea!/gP;=`<%l!.[!R!/sV!a`!cp{POr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!0]P;=`<%l!+q!R!0gX!a`!cpOr*Vrs(Vsv*Vwx)ex#c*V#c#d!1S#d;'S*V;'S;=`*s<%lO*V!R!1ZX!a`!cpOr*Vrs(Vsv*Vwx)ex#V*V#V#W!1v#W;'S*V;'S;=`*s<%lO*V!R!1}X!a`!cpOr*Vrs(Vsv*Vwx)ex#h*V#h#i!2j#i;'S*V;'S;=`*s<%lO*V!R!2qX!a`!cpOr*Vrs(Vsv*Vwx)ex#m*V#m#n!3^#n;'S*V;'S;=`*s<%lO*V!R!3eX!a`!cpOr*Vrs(Vsv*Vwx)ex#d*V#d#e!4Q#e;'S*V;'S;=`*s<%lO*V!R!4XX!a`!cpOr*Vrs(Vsv*Vwx)ex#X*V#X#Y!+q#Y;'S*V;'S;=`*s<%lO*V!R!4{Y!a`!cpOr!4trs!5ksv!4tvw!6Vwx!8]x!a!4t!a!b!:]!b;'S!4t;'S;=`!;r<%lO!4tq!5pV!cpOv!5kvx!6Vx!a!5k!a!b!7W!b;'S!5k;'S;=`!8V<%lO!5kP!6YTO!a!6V!a!b!6i!b;'S!6V;'S;=`!7Q<%lO!6VP!6lTO!`!6V!`!a!6{!a;'S!6V;'S;=`!7Q<%lO!6VP!7QOxPP!7TP;=`<%l!6Vq!7]V!cpOv!5kvx!6Vx!`!5k!`!a!7r!a;'S!5k;'S;=`!8V<%lO!5kq!7yS!cpxPOv(Vx;'S(V;'S;=`(h<%lO(Vq!8YP;=`<%l!5ka!8bX!a`Or!8]rs!6Vsv!8]vw!6Vw!a!8]!a!b!8}!b;'S!8];'S;=`!:V<%lO!8]a!9SX!a`Or!8]rs!6Vsv!8]vw!6Vw!`!8]!`!a!9o!a;'S!8];'S;=`!:V<%lO!8]a!9vT!a`xPOr)esv)ew;'S)e;'S;=`)y<%lO)ea!:YP;=`<%l!8]!R!:dY!a`!cpOr!4trs!5ksv!4tvw!6Vwx!8]x!`!4t!`!a!;S!a;'S!4t;'S;=`!;r<%lO!4t!R!;]V!a`!cpxPOr*Vrs(Vsv*Vwx)ex;'S*V;'S;=`*s<%lO*V!R!;uP;=`<%l!4t!V!<TXiS`P!a`!cpOr&Xrs&}sv&Xwx(tx!^&X!^!_*V!_;'S&X;'S;=`*y<%lO&X",tokenizers:[scriptTokens,styleTokens,textareaTokens,endTag,tagStart,commentContent,0,1,2,3,4,5],topRules:{"Document":[0,15]},dialects:{noMatch:0,selfClosing:485},tokenPrec:487});function getAttrs(openTag,input){var attrs=Object.create(null);var _iterator452=_createForOfIteratorHelper(openTag.getChildren(Attribute)),_step452;try{for(_iterator452.s();!(_step452=_iterator452.n()).done;){var att=_step452.value;var _name31=att.getChild(AttributeName),value=att.getChild(AttributeValue)||att.getChild(UnquotedAttributeValue);if(_name31)attrs[input.read(_name31.from,_name31.to)]=!value?"":value.type.id==AttributeValue?input.read(value.from+1,value.to-1):input.read(value.from,value.to)}}catch(err){_iterator452.e(err)}finally{_iterator452.f()}return attrs}function findTagName(openTag,input){var tagNameNode=openTag.getChild(TagName);return tagNameNode?input.read(tagNameNode.from,tagNameNode.to):" "}function maybeNest(node,input,tags){var attrs;var _iterator453=_createForOfIteratorHelper(tags),_step453;try{for(_iterator453.s();!(_step453=_iterator453.n()).done;){var tag=_step453.value;if(!tag.attrs||tag.attrs(attrs||(attrs=getAttrs(node.node.parent.firstChild,input))))return{parser:tag.parser}}}catch(err){_iterator453.e(err)}finally{_iterator453.f()}return null}function configureNesting(){var tags=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var attributes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var script=[],style=[],textarea=[],other=[];var _iterator454=_createForOfIteratorHelper(tags),_step454;try{for(_iterator454.s();!(_step454=_iterator454.n()).done;){var tag=_step454.value;var array=tag.tag=="script"?script:tag.tag=="style"?style:tag.tag=="textarea"?textarea:other;array.push(tag)}}catch(err){_iterator454.e(err)}finally{_iterator454.f()}var attrs=attributes.length?Object.create(null):null;var _iterator455=_createForOfIteratorHelper(attributes),_step455;try{for(_iterator455.s();!(_step455=_iterator455.n()).done;){var attr=_step455.value;(attrs[attr.name]||(attrs[attr.name]=[])).push(attr)}}catch(err){_iterator455.e(err)}finally{_iterator455.f()}return parseMixed(function(node,input){var id=node.type.id;if(id==ScriptText)return maybeNest(node,input,script);if(id==StyleText)return maybeNest(node,input,style);if(id==TextareaText)return maybeNest(node,input,textarea);if(id==Element$1&&other.length){var n=node.node,open=n.firstChild,tagName=open&&findTagName(open,input),_attrs;if(tagName)for(var _i314=0,_other2=other;_i314<_other2.length;_i314++){var tag=_other2[_i314];if(tag.tag==tagName&&(!tag.attrs||tag.attrs(_attrs||(_attrs=getAttrs(n,input))))){var close=n.lastChild;var to=close.type.id==CloseTag?close.from:n.to;if(to>open.to)return{parser:tag.parser,overlay:[{from:open.to,to:to}]}}}}if(attrs&&id==Attribute){var _n3=node.node,nameNode;if(nameNode=_n3.firstChild){var matches=attrs[input.read(nameNode.from,nameNode.to)];if(matches){var _iterator456=_createForOfIteratorHelper(matches),_step456;try{for(_iterator456.s();!(_step456=_iterator456.n()).done;){var attr=_step456.value;if(attr.tagName&&attr.tagName!=findTagName(_n3.parent,input))continue;var value=_n3.lastChild;if(value.type.id==AttributeValue){var from=value.from+1;var last=value.lastChild,_to3=value.to-(last&&last.isError?0:1);if(_to3>from)return{parser:attr.parser,overlay:[{from:from,to:_to3}]}}else if(value.type.id==UnquotedAttributeValue){return{parser:attr.parser,overlay:[{from:value.from,to:value.to}]}}}}catch(err){_iterator456.e(err)}finally{_iterator456.f()}}}}return null})}var descendantOp=99,Unit=1,callee=100,identifier$2=101,VariableName=2;var space$1=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288];var colon=58,parenL=40,underscore=95,bracketL=91,dash=45,period=46,hash=35,percent=37,ampersand=38,backslash=92,newline$1=10;function isAlpha(ch){return ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=161}function isDigit(ch){return ch>=48&&ch<=57}var identifiers=new ExternalTokenizer(function(input,stack){for(var _inside=false,dashes=0,_i315=0;;_i315++){var next=input.next;if(isAlpha(next)||next==dash||next==underscore||_inside&&isDigit(next)){if(!_inside&&(next!=dash||_i315>0))_inside=true;if(dashes===_i315&&next==dash)dashes++;input.advance()}else if(next==backslash&&input.peek(1)!=newline$1){input.advance();if(input.next>-1)input.advance();_inside=true}else{if(_inside)input.acceptToken(next==parenL?callee:dashes==2&&stack.canShift(VariableName)?VariableName:identifier$2);break}}});var descendant=new ExternalTokenizer(function(input){if(space$1.includes(input.peek(-1))){var next=input.next;if(isAlpha(next)||next==underscore||next==hash||next==period||next==bracketL||next==colon||next==dash||next==ampersand)input.acceptToken(descendantOp)}});var unitToken=new ExternalTokenizer(function(input){if(!space$1.includes(input.peek(-1))){var next=input.next;if(next==percent){input.advance();input.acceptToken(Unit)}if(isAlpha(next)){do{input.advance()}while(isAlpha(input.next));input.acceptToken(Unit)}}});var cssHighlighting=styleTags({"AtKeyword import charset namespace keyframes media supports":tags$1.definitionKeyword,"from to selector":tags$1.keyword,NamespaceName:tags$1.namespace,KeyframeName:tags$1.labelName,KeyframeRangeName:tags$1.operatorKeyword,TagName:tags$1.tagName,ClassName:tags$1.className,PseudoClassName:tags$1.constant(tags$1.className),IdName:tags$1.labelName,"FeatureName PropertyName":tags$1.propertyName,AttributeName:tags$1.attributeName,NumberLiteral:tags$1.number,KeywordQuery:tags$1.keyword,UnaryQueryOp:tags$1.operatorKeyword,"CallTag ValueName":tags$1.atom,VariableName:tags$1.variableName,Callee:tags$1.operatorKeyword,Unit:tags$1.unit,"UniversalSelector NestingSelector":tags$1.definitionOperator,MatchOp:tags$1.compareOperator,"ChildOp SiblingOp, LogicOp":tags$1.logicOperator,BinOp:tags$1.arithmeticOperator,Important:tags$1.modifier,Comment:tags$1.blockComment,ColorLiteral:tags$1.color,"ParenthesizedContent StringLiteral":tags$1.string,":":tags$1.punctuation,"PseudoOp #":tags$1.derefOperator,"; ,":tags$1.separator,"( )":tags$1.paren,"[ ]":tags$1.squareBracket,"{ }":tags$1.brace});var spec_callee={__proto__:null,lang:32,"nth-child":32,"nth-last-child":32,"nth-of-type":32,"nth-last-of-type":32,dir:32,"host-context":32,url:60,"url-prefix":60,domain:60,regexp:60,selector:138};var spec_AtKeyword={__proto__:null,"@import":118,"@media":142,"@charset":146,"@namespace":150,"@keyframes":156,"@supports":168};var spec_identifier$1={__proto__:null,not:132,only:132};var parser$1=LRParser.deserialize({version:14,states:":^QYQ[OOO#_Q[OOP#fOWOOOOQP'#Cd'#CdOOQP'#Cc'#CcO#kQ[O'#CfO$_QXO'#CaO$fQ[O'#ChO$qQ[O'#DTO$vQ[O'#DWOOQP'#Em'#EmO${QdO'#DgO%jQ[O'#DtO${QdO'#DvO%{Q[O'#DxO&WQ[O'#D{O&`Q[O'#ERO&nQ[O'#ETOOQS'#El'#ElOOQS'#EW'#EWQYQ[OOO&uQXO'#CdO'jQWO'#DcO'oQWO'#EsO'zQ[O'#EsQOQWOOP(UO#tO'#C_POOO)C@[)C@[OOQP'#Cg'#CgOOQP,59Q,59QO#kQ[O,59QO(aQ[O'#E[O({QWO,58{O)TQ[O,59SO$qQ[O,59oO$vQ[O,59rO(aQ[O,59uO(aQ[O,59wO(aQ[O,59xO)`Q[O'#DbOOQS,58{,58{OOQP'#Ck'#CkOOQO'#DR'#DROOQP,59S,59SO)gQWO,59SO)lQWO,59SOOQP'#DV'#DVOOQP,59o,59oOOQO'#DX'#DXO)qQ`O,59rOOQS'#Cp'#CpO${QdO'#CqO)yQvO'#CsO+ZQtO,5:ROOQO'#Cx'#CxO)lQWO'#CwO+oQWO'#CyO+tQ[O'#DOOOQS'#Ep'#EpOOQO'#Dj'#DjO+|Q[O'#DqO,[QWO'#EtO&`Q[O'#DoO,jQWO'#DrOOQO'#Eu'#EuO)OQWO,5:`O,oQpO,5:bOOQS'#Dz'#DzO,wQWO,5:dO,|Q[O,5:dOOQO'#D}'#D}O-UQWO,5:gO-ZQWO,5:mO-cQWO,5:oOOQS-E8U-E8UO${QdO,59}O-kQ[O'#E^O-xQWO,5;_O-xQWO,5;_POOO'#EV'#EVP.TO#tO,58yPOOO,58y,58yOOQP1G.l1G.lO.zQXO,5:vOOQO-E8Y-E8YOOQS1G.g1G.gOOQP1G.n1G.nO)gQWO1G.nO)lQWO1G.nOOQP1G/Z1G/ZO/XQ`O1G/^O/rQXO1G/aO0YQXO1G/cO0pQXO1G/dO1WQWO,59|O1]Q[O'#DSO1dQdO'#CoOOQP1G/^1G/^O${QdO1G/^O1kQpO,59]OOQS,59_,59_O${QdO,59aO1sQWO1G/mOOQS,59c,59cO1xQ!bO,59eOOQS'#DP'#DPOOQS'#EY'#EYO2QQ[O,59jOOQS,59j,59jO2YQWO'#DjO2eQWO,5:VO2jQWO,5:]O&`Q[O,5:XO&`Q[O'#E_O2rQWO,5;`O2}QWO,5:ZO(aQ[O,5:^OOQS1G/z1G/zOOQS1G/|1G/|OOQS1G0O1G0OO3`QWO1G0OO3eQdO'#EOOOQS1G0R1G0ROOQS1G0X1G0XOOQS1G0Z1G0ZO3pQtO1G/iOOQO,5:x,5:xO4WQ[O,5:xOOQO-E8[-E8[O4eQWO1G0yPOOO-E8T-E8TPOOO1G.e1G.eOOQP7+$Y7+$YOOQP7+$x7+$xO${QdO7+$xOOQS1G/h1G/hO4pQXO'#ErO4wQWO,59nO4|QtO'#EXO5tQdO'#EoO6OQWO,59ZO6TQpO7+$xOOQS1G.w1G.wOOQS1G.{1G.{OOQS7+%X7+%XO6]QWO1G/POOQS-E8W-E8WOOQS1G/U1G/UO${QdO1G/qOOQO1G/w1G/wOOQO1G/s1G/sO6bQWO,5:yOOQO-E8]-E8]O6pQXO1G/xOOQS7+%j7+%jO6wQYO'#CsOOQO'#EQ'#EQO7SQ`O'#EPOOQO'#EP'#EPO7_QWO'#E`O7gQdO,5:jOOQS,5:j,5:jO7rQtO'#E]O${QdO'#E]O8sQdO7+%TOOQO7+%T7+%TOOQO1G0d1G0dO9WQpO<<HdO9`QWO,5;^OOQP1G/Y1G/YOOQS-E8V-E8VO${QdO'#EZO9hQWO,5;ZOOQT1G.u1G.uOOQP<<Hd<<HdOOQS7+$k7+$kO9pQdO7+%]OOQO7+%d7+%dOOQO,5:k,5:kO3hQdO'#EaO7_QWO,5:zOOQS,5:z,5:zOOQS-E8^-E8^OOQS1G0U1G0UO9wQtO,5:wOOQS-E8Z-E8ZOOQO<<Ho<<HoOOQPAN>OAN>OO:xQdO,5:uOOQO-E8X-E8XOOQO<<Hw<<HwOOQO,5:{,5:{OOQO-E8_-E8_OOQS1G0f1G0f",stateData:";[~O#ZOS#[QQ~OUYOXYO]VO^VOqXOxWO![aO!]ZO!i[O!k]O!m^O!p_O!v`O#XRO#bTO~OQfOUYOXYO]VO^VOqXOxWO![aO!]ZO!i[O!k]O!m^O!p_O!v`O#XeO#bTO~O#U#gP~P!ZO#[jO~O#XlO~O]qO^qOqsOtoOxrO!OtO!RvO#VuO#bnO~O!TwO~P#pO`}O#WzO#XyO~O#X!OO~O#X!QO~OQ![Ob!TOf![Oh![On!YOq!ZO#W!WO#X!SO#e!UO~Ob!^O!d!`O!g!aO#X!]O!T#hP~Oh!fOn!YO#X!eO~Oh!hO#X!hO~Ob!^O!d!`O!g!aO#X!]O~O!Y#hP~P%jO]WX]!WX^WXqWXtWXxWX!OWX!RWX!TWX#VWX#bWX~O]!mO~O!Y!nO#U#gX!S#gX~O#U#gX!S#gX~P!ZO#]!qO#^!qO#_!sO~OUYOXYO]VO^VOqXOxWO#XRO#bTO~OtoO!TwO~O`!zO#WzO#XyO~O!S#gP~P!ZOb#RO~Ob#SO~Op#TO|#UO~OP#WObgXjgX!YgX!dgX!ggX#XgXagXQgXfgXhgXngXqgXtgX!XgX#UgX#WgX#egXpgX!SgX~Ob!^Oj#XO!d!`O!g!aO#X!]O!Y#hP~Ob#[O~Op#`O#X#]O~Ob!^O!d!`O!g!aO#X#aO~Ot#eO!b#dO!T#hX!Y#hX~Ob#hO~Oj#XO!Y#jO~O!Y#kO~Oh#lOn!YO~O!T#mO~O!TwO!b#dO~O!TwO!Y#pO~O!Y#QX#U#QX!S#QX~P!ZO!Y!nO#U#ga!S#ga~O#]!qO#^!qO#_#wO~O]qO^qOqsOxrO!OtO!RvO#VuO#bnO~Ot#Oa!T#Oaa#Oa~P.`Op#yO|#zO~O]qO^qOqsOxrO#bnO~Ot}i!O}i!R}i!T}i#V}ia}i~P/aOt!Pi!O!Pi!R!Pi!T!Pi#V!Pia!Pi~P/aOt!Qi!O!Qi!R!Qi!T!Qi#V!Qia!Qi~P/aO!S#{O~Oa#fP~P(aOa#cP~P${Oa$SOj#XO~O!Y$UO~Oh$VOo$VO~Op$XO#X#]O~O]!`Xa!^X!b!^X~O]$YO~Oa$ZO!b#dO~Ot#eO!T#ha!Y#ha~O!b#dOt!ca!T!ca!Y!caa!ca~O!Y$`O~O!S$gO#X$bO#e$aO~Oj#XOt$iO!X$kO!Y!Vi#U!Vi!S!Vi~P${O!Y#Qa#U#Qa!S#Qa~P!ZO!Y!nO#U#gi!S#gi~Oa#fX~P#pOa$oO~Oj#XOQ!{Xa!{Xb!{Xf!{Xh!{Xn!{Xq!{Xt!{X#W!{X#X!{X#e!{X~Ot$qOa#cX~P${Oa$sO~Oj#XOp$tO~Oa$uO~O!b#dOt#Ra!T#Ra!Y#Ra~Oa$wO~P.`OP#WOtgX!TgX~O#e$aOt!sX!T!sX~Ot$yO!TwO~O!S$}O#X$bO#e$aO~Oj#XOQ#PXb#PXf#PXh#PXn#PXq#PXt#PX!X#PX!Y#PX#U#PX#W#PX#X#PX#e#PX!S#PX~Ot$iO!X%QO!Y!Vq#U!Vq!S!Vq~P${Oj#XOp%RO~OtoOa#fa~Ot$qOa#ca~Oa%UO~P${Oj#XOQ#Pab#Paf#Pah#Pan#Paq#Pat#Pa!X#Pa!Y#Pa#U#Pa#W#Pa#X#Pa#e#Pa!S#Pa~Oa!}at!}a~P${O#Zo#[#ej!R#e~","goto":"-g#jPPP#kP#nP#w$WP#w$g#wPP$mPPP$s$|$|P%`P$|P$|%z&^PPPP$|&vP&z'Q#wP'W#w'^P#wP#w#wPPP'd'y(WPP#nPP(_(_(i(_P(_P(_(_P#nP#nP#nP(l#nP(o(r(u(|#nP#nP)R)X)h)v)|*S*^*d*n*t*zPPPPPPPPPP+Q+ZP+v+yP,o,r,x-RRkQ_bOPdhw!n#skYOPdhotuvw!n#R#h#skSOPdhotuvw!n#R#h#sQmTR!tnQ{VR!xqQ!x}Q#Z!XR#x!zq![Z]!T!m#S#U#X#q#z$P$Y$i$j$q$v%Sp![Z]!T!m#S#U#X#q#z$P$Y$i$j$q$v%SU$d#m$f$yR$x$cq!XZ]!T!m#S#U#X#q#z$P$Y$i$j$q$v%Sp![Z]!T!m#S#U#X#q#z$P$Y$i$j$q$v%SQ!f^R#l!gT#^!Z#_Q|VR!yqQ!x|R#x!yQ!PWR!{rQ!RXR!|sQxUQ!wpQ#i!cQ#o!jQ#p!kQ${$eR%X$zSgPwQ!phQ#r!nR$l#sZfPhw!n#sa!b[`a!V!^!`#d#eR#b!^R!g^R!i_R#n!iS$e#m$fR%V$yV$c#m$f$yQ!rjR#v!rQdOShPwU!ldh#sR#s!nQ$P#SU$p$P$v%SQ$v$YR%S$qQ#_!ZR$W#_Q$r$PR%T$rQpUS!vp$nR$n#|Q$j#qR%P$jQ!ogS#t!o#uR#u!pQ#f!_R$^#fQ$f#mR$|$fQ$z$eR%W$z_cOPdhw!n#s^UOPdhw!n#sQ!uoQ!}tQ#OuQ#PvQ#|#RR$_#hR$Q#SQ!VZQ!d]Q#V!TQ#q!m[$O#S$P$Y$q$v%SQ$R#UQ$T#XS$h#q$jQ$m#zR%O$iR#}#RQiPR#QwQ!c[Q!kaR#Y!VU!_[a!VQ!j`Q#c!^Q#g!`Q$[#dR$]#e",nodeNames:"\u26A0 Unit VariableName Comment StyleSheet RuleSet UniversalSelector TagSelector TagName NestingSelector ClassSelector ClassName PseudoClassSelector : :: PseudoClassName PseudoClassName ) ( ArgList ValueName ParenthesizedValue ColorLiteral NumberLiteral StringLiteral BinaryExpression BinOp CallExpression Callee CallLiteral CallTag ParenthesizedContent ] [ LineNames LineName , PseudoClassName ArgList IdSelector # IdName AttributeSelector AttributeName MatchOp ChildSelector ChildOp DescendantSelector SiblingSelector SiblingOp } { Block Declaration PropertyName Important ; ImportStatement AtKeyword import KeywordQuery FeatureQuery FeatureName BinaryQuery LogicOp UnaryQuery UnaryQueryOp ParenthesizedQuery SelectorQuery selector MediaStatement media CharsetStatement charset NamespaceStatement namespace NamespaceName KeyframesStatement keyframes KeyframeName KeyframeList KeyframeSelector KeyframeRangeName SupportsStatement supports AtRule Styles",maxTerm:117,nodeProps:[["isolate",-2,3,24,""],["openedBy",17,"(",32,"[",50,"{"],["closedBy",18,")",33,"]",51,"}"]],propSources:[cssHighlighting],skippedNodes:[0,3,87],repeatNodeCount:11,tokenData:"J^~R!^OX$}X^%u^p$}pq%uqr)Xrs.Rst/utu6duv$}vw7^wx7oxy9^yz9oz{9t{|:_|}?Q}!O?c!O!P@Q!P!Q@i!Q![Ab![!]B]!]!^CX!^!_$}!_!`Cj!`!aC{!a!b$}!b!cDw!c!}$}!}#OFa#O#P$}#P#QFr#Q#R6d#R#T$}#T#UGT#U#c$}#c#dHf#d#o$}#o#pH{#p#q6d#q#rI^#r#sIo#s#y$}#y#z%u#z$f$}$f$g%u$g#BY$}#BY#BZ%u#BZ$IS$}$IS$I_%u$I_$I|$}$I|$JO%u$JO$JT$}$JT$JU%u$JU$KV$}$KV$KW%u$KW&FU$}&FU&FV%u&FV;'S$};'S;=`JW<%lO$}`%QSOy%^z;'S%^;'S;=`%o<%lO%^`%cSo`Oy%^z;'S%^;'S;=`%o<%lO%^`%rP;=`<%l%^~%zh#Z~OX%^X^'f^p%^pq'fqy%^z#y%^#y#z'f#z$f%^$f$g'f$g#BY%^#BY#BZ'f#BZ$IS%^$IS$I_'f$I_$I|%^$I|$JO'f$JO$JT%^$JT$JU'f$JU$KV%^$KV$KW'f$KW&FU%^&FU&FV'f&FV;'S%^;'S;=`%o<%lO%^~'mh#Z~o`OX%^X^'f^p%^pq'fqy%^z#y%^#y#z'f#z$f%^$f$g'f$g#BY%^#BY#BZ'f#BZ$IS%^$IS$I_'f$I_$I|%^$I|$JO'f$JO$JT%^$JT$JU'f$JU$KV%^$KV$KW'f$KW&FU%^&FU&FV'f&FV;'S%^;'S;=`%o<%lO%^l)[UOy%^z#]%^#]#^)n#^;'S%^;'S;=`%o<%lO%^l)sUo`Oy%^z#a%^#a#b*V#b;'S%^;'S;=`%o<%lO%^l*[Uo`Oy%^z#d%^#d#e*n#e;'S%^;'S;=`%o<%lO%^l*sUo`Oy%^z#c%^#c#d+V#d;'S%^;'S;=`%o<%lO%^l+[Uo`Oy%^z#f%^#f#g+n#g;'S%^;'S;=`%o<%lO%^l+sUo`Oy%^z#h%^#h#i,V#i;'S%^;'S;=`%o<%lO%^l,[Uo`Oy%^z#T%^#T#U,n#U;'S%^;'S;=`%o<%lO%^l,sUo`Oy%^z#b%^#b#c-V#c;'S%^;'S;=`%o<%lO%^l-[Uo`Oy%^z#h%^#h#i-n#i;'S%^;'S;=`%o<%lO%^l-uS!X[o`Oy%^z;'S%^;'S;=`%o<%lO%^~.UWOY.RZr.Rrs.ns#O.R#O#P.s#P;'S.R;'S;=`/o<%lO.R~.sOh~~.vRO;'S.R;'S;=`/P;=`O.R~/SXOY.RZr.Rrs.ns#O.R#O#P.s#P;'S.R;'S;=`/o;=`<%l.R<%lO.R~/rP;=`<%l.Rn/zYxQOy%^z!Q%^!Q![0j![!c%^!c!i0j!i#T%^#T#Z0j#Z;'S%^;'S;=`%o<%lO%^l0oYo`Oy%^z!Q%^!Q![1_![!c%^!c!i1_!i#T%^#T#Z1_#Z;'S%^;'S;=`%o<%lO%^l1dYo`Oy%^z!Q%^!Q![2S![!c%^!c!i2S!i#T%^#T#Z2S#Z;'S%^;'S;=`%o<%lO%^l2ZYf[o`Oy%^z!Q%^!Q![2y![!c%^!c!i2y!i#T%^#T#Z2y#Z;'S%^;'S;=`%o<%lO%^l3QYf[o`Oy%^z!Q%^!Q![3p![!c%^!c!i3p!i#T%^#T#Z3p#Z;'S%^;'S;=`%o<%lO%^l3uYo`Oy%^z!Q%^!Q![4e![!c%^!c!i4e!i#T%^#T#Z4e#Z;'S%^;'S;=`%o<%lO%^l4lYf[o`Oy%^z!Q%^!Q![5[![!c%^!c!i5[!i#T%^#T#Z5[#Z;'S%^;'S;=`%o<%lO%^l5aYo`Oy%^z!Q%^!Q![6P![!c%^!c!i6P!i#T%^#T#Z6P#Z;'S%^;'S;=`%o<%lO%^l6WSf[o`Oy%^z;'S%^;'S;=`%o<%lO%^d6gUOy%^z!_%^!_!`6y!`;'S%^;'S;=`%o<%lO%^d7QS|So`Oy%^z;'S%^;'S;=`%o<%lO%^b7cSXQOy%^z;'S%^;'S;=`%o<%lO%^~7rWOY7oZw7owx.nx#O7o#O#P8[#P;'S7o;'S;=`9W<%lO7o~8_RO;'S7o;'S;=`8h;=`O7o~8kXOY7oZw7owx.nx#O7o#O#P8[#P;'S7o;'S;=`9W;=`<%l7o<%lO7o~9ZP;=`<%l7on9cSb^Oy%^z;'S%^;'S;=`%o<%lO%^~9tOa~n9{UUQjWOy%^z!_%^!_!`6y!`;'S%^;'S;=`%o<%lO%^n:fWjW!RQOy%^z!O%^!O!P;O!P!Q%^!Q![>T![;'S%^;'S;=`%o<%lO%^l;TUo`Oy%^z!Q%^!Q![;g![;'S%^;'S;=`%o<%lO%^l;nYo`#e[Oy%^z!Q%^!Q![;g![!g%^!g!h<^!h#X%^#X#Y<^#Y;'S%^;'S;=`%o<%lO%^l<cYo`Oy%^z{%^{|=R|}%^}!O=R!O!Q%^!Q![=j![;'S%^;'S;=`%o<%lO%^l=WUo`Oy%^z!Q%^!Q![=j![;'S%^;'S;=`%o<%lO%^l=qUo`#e[Oy%^z!Q%^!Q![=j![;'S%^;'S;=`%o<%lO%^l>[[o`#e[Oy%^z!O%^!O!P;g!P!Q%^!Q![>T![!g%^!g!h<^!h#X%^#X#Y<^#Y;'S%^;'S;=`%o<%lO%^n?VSt^Oy%^z;'S%^;'S;=`%o<%lO%^l?hWjWOy%^z!O%^!O!P;O!P!Q%^!Q![>T![;'S%^;'S;=`%o<%lO%^n@VU#bQOy%^z!Q%^!Q![;g![;'S%^;'S;=`%o<%lO%^~@nTjWOy%^z{@}{;'S%^;'S;=`%o<%lO%^~AUSo`#[~Oy%^z;'S%^;'S;=`%o<%lO%^lAg[#e[Oy%^z!O%^!O!P;g!P!Q%^!Q![>T![!g%^!g!h<^!h#X%^#X#Y<^#Y;'S%^;'S;=`%o<%lO%^bBbU]QOy%^z![%^![!]Bt!];'S%^;'S;=`%o<%lO%^bB{S^Qo`Oy%^z;'S%^;'S;=`%o<%lO%^nC^S!Y^Oy%^z;'S%^;'S;=`%o<%lO%^dCoS|SOy%^z;'S%^;'S;=`%o<%lO%^bDQU!OQOy%^z!`%^!`!aDd!a;'S%^;'S;=`%o<%lO%^bDkS!OQo`Oy%^z;'S%^;'S;=`%o<%lO%^bDzWOy%^z!c%^!c!}Ed!}#T%^#T#oEd#o;'S%^;'S;=`%o<%lO%^bEk[![Qo`Oy%^z}%^}!OEd!O!Q%^!Q![Ed![!c%^!c!}Ed!}#T%^#T#oEd#o;'S%^;'S;=`%o<%lO%^nFfSq^Oy%^z;'S%^;'S;=`%o<%lO%^nFwSp^Oy%^z;'S%^;'S;=`%o<%lO%^bGWUOy%^z#b%^#b#cGj#c;'S%^;'S;=`%o<%lO%^bGoUo`Oy%^z#W%^#W#XHR#X;'S%^;'S;=`%o<%lO%^bHYS!bQo`Oy%^z;'S%^;'S;=`%o<%lO%^bHiUOy%^z#f%^#f#gHR#g;'S%^;'S;=`%o<%lO%^fIQS!TUOy%^z;'S%^;'S;=`%o<%lO%^nIcS!S^Oy%^z;'S%^;'S;=`%o<%lO%^fItU!RQOy%^z!_%^!_!`6y!`;'S%^;'S;=`%o<%lO%^`JZP;=`<%l$}",tokenizers:[descendant,unitToken,identifiers,1,2,3,4,new LocalTokenGroup("m~RRYZ[z{a~~g~aO#^~~dP!P!Qg~lO#_~~",28,105)],topRules:{"StyleSheet":[0,4],"Styles":[1,86]},specialized:[{term:100,get:function get(value){return spec_callee[value]||-1}},{term:58,get:function get(value){return spec_AtKeyword[value]||-1}},{term:101,get:function get(value){return spec_identifier$1[value]||-1}}],tokenPrec:1200});var _properties=null;function properties(){if(!_properties&&(typeof document==="undefined"?"undefined":_typeof2(document))=="object"&&document.body){var style=document.body.style,names=[],seen=new Set;for(var prop in style)if(prop!="cssText"&&prop!="cssFloat"){if(typeof style[prop]=="string"){if(/[A-Z]/.test(prop))prop=prop.replace(/[A-Z]/g,function(ch){return"-"+ch.toLowerCase()});if(!seen.has(prop)){names.push(prop);seen.add(prop)}}}_properties=names.sort().map(function(name){return{type:"property",label:name}})}return _properties||[]}var pseudoClasses=["active","after","any-link","autofill","backdrop","before","checked","cue","default","defined","disabled","empty","enabled","file-selector-button","first","first-child","first-letter","first-line","first-of-type","focus","focus-visible","focus-within","fullscreen","has","host","host-context","hover","in-range","indeterminate","invalid","is","lang","last-child","last-of-type","left","link","marker","modal","not","nth-child","nth-last-child","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","part","placeholder","placeholder-shown","read-only","read-write","required","right","root","scope","selection","slotted","target","target-text","valid","visited","where"].map(function(name){return{type:"class",label:name}});var values=["above","absolute","activeborder","additive","activecaption","after-white-space","ahead","alias","all","all-scroll","alphabetic","alternate","always","antialiased","appworkspace","asterisks","attr","auto","auto-flow","avoid","avoid-column","avoid-page","avoid-region","axis-pan","background","backwards","baseline","below","bidi-override","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","bullets","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","calc","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-decimal","clear","clip","close-quote","col-resize","collapse","color","color-burn","color-dodge","column","column-reverse","compact","condensed","contain","content","contents","content-box","context-menu","continuous","copy","counter","counters","cover","crop","cross","crosshair","currentcolor","cursive","cyclic","darken","dashed","decimal","decimal-leading-zero","default","default-button","dense","destination-atop","destination-in","destination-out","destination-over","difference","disc","discard","disclosure-closed","disclosure-open","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic-abegede-gez","ethiopic-halehame-aa-er","ethiopic-halehame-gez","ew-resize","exclusion","expanded","extends","extra-condensed","extra-expanded","fantasy","fast","fill","fill-box","fixed","flat","flex","flex-end","flex-start","footnotes","forwards","from","geometricPrecision","graytext","grid","groove","hand","hard-light","help","hidden","hide","higher","highlight","highlighttext","horizontal","hsl","hsla","hue","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-flex","inline-grid","inline-table","inset","inside","intrinsic","invert","italic","justify","keep-all","landscape","large","larger","left","level","lighter","lighten","line-through","linear","linear-gradient","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-hexadecimal","lower-latin","lower-norwegian","lowercase","ltr","luminosity","manipulation","match","matrix","matrix3d","medium","menu","menutext","message-box","middle","min-intrinsic","mix","monospace","move","multiple","multiple_mask_images","multiply","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","numbers","numeric","nw-resize","nwse-resize","oblique","opacity","open-quote","optimizeLegibility","optimizeSpeed","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","perspective","pinch-zoom","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radial-gradient","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeating-linear-gradient","repeating-radial-gradient","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","rotate","rotate3d","rotateX","rotateY","rotateZ","round","row","row-resize","row-reverse","rtl","run-in","running","s-resize","sans-serif","saturation","scale","scale3d","scaleX","scaleY","scaleZ","screen","scroll","scrollbar","scroll-position","se-resize","self-start","self-end","semi-condensed","semi-expanded","separate","serif","show","single","skew","skewX","skewY","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","soft-light","solid","source-atop","source-in","source-out","source-over","space","space-around","space-between","space-evenly","spell-out","square","start","static","status-bar","stretch","stroke","stroke-box","sub","subpixel-antialiased","svg_masks","super","sw-resize","symbolic","symbols","system-ui","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","text","text-bottom","text-top","textarea","textfield","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","to","top","transform","translate","translate3d","translateX","translateY","translateZ","transparent","ultra-condensed","ultra-expanded","underline","unidirectional-pan","unset","up","upper-latin","uppercase","url","var","vertical","vertical-text","view-box","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","words","wrap","wrap-reverse","x-large","x-small","xor","xx-large","xx-small"].map(function(name){return{type:"keyword",label:name}}).concat(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"].map(function(name){return{type:"constant",label:name}}));var tags=["a","abbr","address","article","aside","b","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","dd","del","details","dfn","dialog","div","dl","dt","em","figcaption","figure","footer","form","header","hgroup","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","main","meter","nav","ol","output","p","pre","ruby","section","select","small","source","span","strong","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","tr","u","ul"].map(function(name){return{type:"type",label:name}});var identifier$1=/^(\w[\w-]*|-\w[\w-]*|)$/,variable=/^-(-[\w-]*)?$/;function isVarArg(node,doc){var _a;if(node.name=="("||node.type.isError)node=node.parent||node;if(node.name!="ArgList")return false;var callee=(_a=node.parent)===null||_a===void 0?void 0:_a.firstChild;if((callee===null||callee===void 0?void 0:callee.name)!="Callee")return false;return doc.sliceString(callee.from,callee.to)=="var"}var VariablesByNode=new NodeWeakMap;var declSelector=["Declaration"];function astTop(node){for(var _cur26=node;;){if(_cur26.type.isTop)return _cur26;if(!(_cur26=_cur26.parent))return node}}function variableNames(doc,node,isVariable){if(node.to-node.from>4096){var known=VariablesByNode.get(node);if(known)return known;var result=[],seen=new Set,_cursor8=node.cursor(IterMode.IncludeAnonymous);if(_cursor8.firstChild())do{var _iterator457=_createForOfIteratorHelper(variableNames(doc,_cursor8.node,isVariable)),_step457;try{for(_iterator457.s();!(_step457=_iterator457.n()).done;){var option=_step457.value;if(!seen.has(option.label)){seen.add(option.label);result.push(option)}}}catch(err){_iterator457.e(err)}finally{_iterator457.f()}}while(_cursor8.nextSibling());VariablesByNode.set(node,result);return result}else{var _result2=[],_seen=new Set;node.cursor().iterate(function(node){var _a;if(isVariable(node)&&node.matchContext(declSelector)&&((_a=node.node.nextSibling)===null||_a===void 0?void 0:_a.name)==":"){var _name32=doc.sliceString(node.from,node.to);if(!_seen.has(_name32)){_seen.add(_name32);_result2.push({label:_name32,type:"variable"})}}});return _result2}}var defineCSSCompletionSource=function defineCSSCompletionSource(isVariable){return function(context){var state=context.state,pos=context.pos,node=syntaxTree(state).resolveInner(pos,-1);var isDash=node.type.isError&&node.from==node.to-1&&state.doc.sliceString(node.from,node.to)=="-";if(node.name=="PropertyName"||(isDash||node.name=="TagName")&&/^(Block|Styles)$/.test(node.resolve(node.to).name))return{from:node.from,options:properties(),validFor:identifier$1};if(node.name=="ValueName")return{from:node.from,options:values,validFor:identifier$1};if(node.name=="PseudoClassName")return{from:node.from,options:pseudoClasses,validFor:identifier$1};if(isVariable(node)||(context.explicit||isDash)&&isVarArg(node,state.doc))return{from:isVariable(node)||isDash?node.from:pos,options:variableNames(state.doc,astTop(node),isVariable),validFor:variable};if(node.name=="TagName"){for(var parent=node.parent;parent;parent=parent.parent)if(parent.name=="Block")return{from:node.from,options:properties(),validFor:identifier$1};return{from:node.from,options:tags,validFor:identifier$1}}if(!context.explicit)return null;var above=node.resolve(pos),before=above.childBefore(pos);if(before&&before.name==":"&&above.name=="PseudoClassSelector")return{from:pos,options:pseudoClasses,validFor:identifier$1};if(before&&before.name==":"&&above.name=="Declaration"||above.name=="ArgList")return{from:pos,options:values,validFor:identifier$1};if(above.name=="Block"||above.name=="Styles")return{from:pos,options:properties(),validFor:identifier$1};return null}};var cssCompletionSource=defineCSSCompletionSource(function(n){return n.name=="VariableName"});var cssLanguage=LRLanguage.define({name:"css",parser:parser$1.configure({props:[indentNodeProp.add({Declaration:continuedIndent()}),foldNodeProp.add({"Block KeyframeList":foldInside})]}),languageData:{commentTokens:{block:{open:"/*",close:"*/"}},indentOnInput:/^\s*\}$/,wordChars:"-"}});function css(){return new LanguageSupport(cssLanguage,cssLanguage.data.of({autocomplete:cssCompletionSource}))}var noSemi=309,incdec=1,incdecPrefix=2,JSXStartTag=3,insertSemi=310,spaces=312,newline=313,LineComment=4,BlockComment=5,Dialect_jsx=0;var space=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288];var braceR=125,semicolon=59,slash=47,star=42,plus=43,minus=45,lt=60,comma=44;var trackNewline=new ContextTracker({start:false,shift:function shift(context,term){return term==LineComment||term==BlockComment||term==spaces?context:term==newline},strict:false});var insertSemicolon=new ExternalTokenizer(function(input,stack){var next=input.next;if(next==braceR||next==-1||stack.context)input.acceptToken(insertSemi)},{contextual:true,fallback:true});var noSemicolon=new ExternalTokenizer(function(input,stack){var next=input.next,after;if(space.indexOf(next)>-1)return;if(next==slash&&((after=input.peek(1))==slash||after==star))return;if(next!=braceR&&next!=semicolon&&next!=-1&&!stack.context)input.acceptToken(noSemi)},{contextual:true});var incdecToken=new ExternalTokenizer(function(input,stack){var next=input.next;if(next==plus||next==minus){input.advance();if(next==input.next){input.advance();var mayPostfix=!stack.context&&stack.canShift(incdec);input.acceptToken(mayPostfix?incdec:incdecPrefix)}}},{contextual:true});function identifierChar(ch,start){return ch>=65&&ch<=90||ch>=97&&ch<=122||ch==95||ch>=192||!start&&ch>=48&&ch<=57}var jsx=new ExternalTokenizer(function(input,stack){if(input.next!=lt||!stack.dialectEnabled(Dialect_jsx))return;input.advance();if(input.next==slash)return;var back=0;while(space.indexOf(input.next)>-1){input.advance();back++}if(identifierChar(input.next,true)){input.advance();back++;while(identifierChar(input.next,false)){input.advance();back++}while(space.indexOf(input.next)>-1){input.advance();back++}if(input.next==comma)return;for(var _i316=0;;_i316++){if(_i316==7){if(!identifierChar(input.next,true))return;break}if(input.next!="extends".charCodeAt(_i316))break;input.advance();back++}}input.acceptToken(JSXStartTag,-back)});var jsHighlight=styleTags({"get set async static":tags$1.modifier,"for while do if else switch try catch finally return throw break continue default case":tags$1.controlKeyword,"in of await yield void typeof delete instanceof":tags$1.operatorKeyword,"let var const using function class extends":tags$1.definitionKeyword,"import export from":tags$1.moduleKeyword,"with debugger as new":tags$1.keyword,TemplateString:tags$1.special(tags$1.string),"super":tags$1.atom,BooleanLiteral:tags$1.bool,"this":tags$1.self,"null":tags$1["null"],Star:tags$1.modifier,VariableName:tags$1.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":tags$1["function"](tags$1.variableName),VariableDefinition:tags$1.definition(tags$1.variableName),Label:tags$1.labelName,PropertyName:tags$1.propertyName,PrivatePropertyName:tags$1.special(tags$1.propertyName),"CallExpression/MemberExpression/PropertyName":tags$1["function"](tags$1.propertyName),"FunctionDeclaration/VariableDefinition":tags$1["function"](tags$1.definition(tags$1.variableName)),"ClassDeclaration/VariableDefinition":tags$1.definition(tags$1.className),PropertyDefinition:tags$1.definition(tags$1.propertyName),PrivatePropertyDefinition:tags$1.definition(tags$1.special(tags$1.propertyName)),UpdateOp:tags$1.updateOperator,"LineComment Hashbang":tags$1.lineComment,BlockComment:tags$1.blockComment,Number:tags$1.number,String:tags$1.string,Escape:tags$1.escape,ArithOp:tags$1.arithmeticOperator,LogicOp:tags$1.logicOperator,BitOp:tags$1.bitwiseOperator,CompareOp:tags$1.compareOperator,RegExp:tags$1.regexp,Equals:tags$1.definitionOperator,Arrow:tags$1["function"](tags$1.punctuation),": Spread":tags$1.punctuation,"( )":tags$1.paren,"[ ]":tags$1.squareBracket,"{ }":tags$1.brace,"InterpolationStart InterpolationEnd":tags$1.special(tags$1.brace),".":tags$1.derefOperator,", ;":tags$1.separator,"@":tags$1.meta,TypeName:tags$1.typeName,TypeDefinition:tags$1.definition(tags$1.typeName),"type enum interface implements namespace module declare":tags$1.definitionKeyword,"abstract global Privacy readonly override":tags$1.modifier,"is keyof unique infer":tags$1.operatorKeyword,JSXAttributeValue:tags$1.attributeValue,JSXText:tags$1.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":tags$1.angleBracket,"JSXIdentifier JSXNameSpacedName":tags$1.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":tags$1.attributeName,"JSXBuiltin/JSXIdentifier":tags$1.standard(tags$1.tagName)});var spec_identifier={__proto__:null,"export":18,as:23,from:31,"default":34,async:39,"function":40,"extends":52,"this":56,"true":64,"false":64,"null":76,"void":80,"typeof":84,"super":102,"new":136,"delete":152,"yield":161,"await":165,"class":170,"public":227,"private":227,"protected":227,readonly:229,"instanceof":248,satisfies:251,"in":252,"const":254,"import":286,keyof:339,unique:343,infer:349,is:385,"abstract":405,"implements":407,type:409,"let":412,"var":414,using:417,"interface":423,"enum":427,namespace:433,module:435,declare:439,global:443,"for":462,of:471,"while":474,"with":478,"do":482,"if":486,"else":488,"switch":492,"case":498,"try":504,"catch":508,"finally":512,"return":516,"throw":520,"break":524,"continue":528,"debugger":532};var spec_word={__proto__:null,async:123,get:125,set:127,declare:187,"public":189,"private":189,"protected":189,"static":191,"abstract":193,override:195,readonly:201,accessor:203,"new":389};var spec_LessThan={__proto__:null,"<":143};var parser=LRParser.deserialize({version:14,states:"$<UO%TQ^OOO%[Q^OOO'_Q`OOP(lOWOOO*zQ08SO'#ChO+RO!bO'#CiO+aO#tO'#CiO+oO?MpO'#D^O.QQ^O'#DdO.bQ^O'#DoO%[Q^O'#DyO0fQ^O'#EROOQ07b'#EZ'#EZO1PQWO'#EWOOQO'#El'#ElOOQO'#Ie'#IeO1XQWO'#GmO1dQWO'#EkO1iQWO'#EkO3kQ08SO'#JiO6[Q08SO'#JjO6xQWO'#FZO6}Q&jO'#FqOOQ07b'#Fc'#FcO7YO,YO'#FcO7hQ7[O'#FxO9UQWO'#FwOOQ07b'#Jj'#JjOOQ07`'#Ji'#JiO9ZQWO'#GqOOQU'#KU'#KUO9fQWO'#IRO9kQ07hO'#ISOOQU'#JW'#JWOOQU'#IW'#IWQ`Q^OOO`Q^OOO%[Q^O'#DqO9sQ^O'#D}O9zQ^O'#EPO9aQWO'#GmO:RQ7[O'#CnO:aQWO'#EjO:lQWO'#EuO:qQ7[O'#FbO;`QWO'#GmOOQO'#KV'#KVO;eQWO'#KVO;sQWO'#GuO;sQWO'#GvO;sQWO'#GxO9aQWO'#G{O<jQWO'#HOO>RQWO'#CdO>cQWO'#H[O>kQWO'#HbO>kQWO'#HdO`Q^O'#HfO>kQWO'#HhO>kQWO'#HkO>pQWO'#HqO>uQ07iO'#HwO%[Q^O'#HyO?QQ07iO'#H{O?]Q07iO'#H}O9kQ07hO'#IPO?hQ08SO'#ChO@jQ`O'#DiQOQWOOO%[Q^O'#EPOAQQWO'#ESO:RQ7[O'#EjOA]QWO'#EjOAhQpO'#FbOOQU'#Cf'#CfOOQ07`'#Dn'#DnOOQ07`'#Jm'#JmO%[Q^O'#JmOOQO'#Jq'#JqOOQO'#Ib'#IbOBhQ`O'#EcOOQ07`'#Eb'#EbOCdQ07pO'#EcOCnQ`O'#EVOOQO'#Jp'#JpODSQ`O'#JqOEaQ`O'#EVOCnQ`O'#EcPEnO!0LbO'#CaPOOO)CDu)CDuOOOO'#IX'#IXOEyO!bO,59TOOQ07b,59T,59TOOOO'#IY'#IYOFXO#tO,59TO%[Q^O'#D`OOOO'#I['#I[OFgO?MpO,59xOOQ07b,59x,59xOFuQ^O'#I]OGYQWO'#JkOI[QrO'#JkO+}Q^O'#JkOIcQWO,5:OOIyQWO'#ElOJWQWO'#JyOJcQWO'#JxOJcQWO'#JxOJkQWO,5;YOJpQWO'#JwOOQ07f,5:Z,5:ZOJwQ^O,5:ZOLxQ08SO,5:eOMiQWO,5:mONSQ07hO'#JvONZQWO'#JuO9ZQWO'#JuONoQWO'#JuONwQWO,5;XON|QWO'#JuO!#UQrO'#JjOOQ07b'#Ch'#ChO%[Q^O'#ERO!#tQpO,5:rOOQO'#Jr'#JrOOQO-E<c-E<cO9aQWO,5=XO!$[QWO,5=XO!$aQ^O,5;VO!&dQ7[O'#EgO!'}QWO,5;VO!)mQ7[O'#DsO!)tQ^O'#DxO!*OQ`O,5;`O!*WQ`O,5;`O%[Q^O,5;`OOQU'#FR'#FROOQU'#FT'#FTO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aO%[Q^O,5;aOOQU'#FX'#FXO!*fQ^O,5;rOOQ07b,5;w,5;wOOQ07b,5;x,5;xO!,iQWO,5;xOOQ07b,5;y,5;yO%[Q^O'#IiO!,qQ07hO,5<eO!&dQ7[O,5;aO!-`Q7[O,5;aO%[Q^O,5;uO!-gQ&jO'#FgO!.dQ&jO'#J}O!.OQ&jO'#J}O!.kQ&jO'#J}OOQO'#J}'#J}O!/PQ&jO,5<POOOS,5<],5<]O!/bQ^O'#FsOOOS'#Ih'#IhO7YO,YO,5;}O!/iQ&jO'#FuOOQ07b,5;},5;}O!0YQMhO'#CuOOQ07b'#Cy'#CyO!0mQWO'#CyO!0rO?MpO'#C}O!1`Q7[O,5<bO!1gQWO,5<dO!3SQ!LQO'#GSO!3aQWO'#GTO!3fQWO'#GTO!3kQ!LQO'#GXO!4jQ`O'#G]OOQO'#Gh'#GhO!(SQ7[O'#GgOOQO'#Gj'#GjO!(SQ7[O'#GiO!5]QMhO'#JdOOQ07b'#Jd'#JdO!5gQWO'#JcO!5uQWO'#JbO!5}QWO'#CtOOQ07b'#Cw'#CwOOQ07b'#DR'#DROOQ07b'#DT'#DTO1SQWO'#DVO!(SQ7[O'#FzO!(SQ7[O'#F|O!6VQWO'#GOO!6[QWO'#GPO!3fQWO'#GVO!(SQ7[O'#G[O!6aQWO'#EmO!7OQWO,5<cOOQ07`'#Cq'#CqO!7WQWO'#EnO!8QQ`O'#EoOOQ07`'#Jw'#JwO!8XQ07hO'#KWO9kQ07hO,5=]O`Q^O,5>mOOQU'#J`'#J`OOQU,5>n,5>nOOQU-E<U-E<UO!:ZQ08SO,5:]O!<wQ08SO,5:iO%[Q^O,5:iO!?bQ08SO,5:kOOQO,5@q,5@qO!@RQ7[O,5=XO!@aQ07hO'#JaO9UQWO'#JaO!@rQ07hO,59YO!@}Q`O,59YO!AVQ7[O,59YO:RQ7[O,59YO!AbQWO,5;VO!AjQWO'#HZO!BOQWO'#KZO%[Q^O,5;zO!7{Q`O,5;|O!BWQWO,5=tO!B]QWO,5=tO!BbQWO,5=tO9kQ07hO,5=tO;sQWO,5=dOOQO'#Cu'#CuO!BpQ`O,5=aO!BxQ7[O,5=bO!CTQWO,5=dO!CYQpO,5=gO!CbQWO'#KVO>pQWO'#HQO9aQWO'#HSO!CgQWO'#HSO:RQ7[O'#HUO!ClQWO'#HUOOQU,5=j,5=jO!CqQWO'#HVO!DSQWO'#CnO!DXQWO,59OO!DcQWO,59OO!FhQ^O,59OOOQU,59O,59OO!FxQ07hO,59OO%[Q^O,59OO!ITQ^O'#H^OOQU'#H_'#H_OOQU'#H`'#H`O`Q^O,5=vO!IkQWO,5=vO`Q^O,5=|O`Q^O,5>OO!IpQWO,5>QO`Q^O,5>SO!IuQWO,5>VO!IzQ^O,5>]OOQU,5>c,5>cO%[Q^O,5>cO9kQ07hO,5>eOOQU,5>g,5>gO!NUQWO,5>gOOQU,5>i,5>iO!NUQWO,5>iOOQU,5>k,5>kO!NZQ`O'#D[O%[Q^O'#JmO!NxQ`O'#JmO# gQ`O'#DjO# xQ`O'#DjO#$ZQ^O'#DjO#$bQWO'#JlO#$jQWO,5:TO#$oQWO'#EpO#$}QWO'#JzO#%VQWO,5;ZO#%[Q`O'#DjO#%iQ`O'#EUOOQ07b,5:n,5:nO%[Q^O,5:nO#%pQWO,5:nO>pQWO,5;UO!@}Q`O,5;UO!AVQ7[O,5;UO:RQ7[O,5;UO#%xQWO,5@XO#%}Q$ISO,5:rOOQO-E<`-E<`O#'TQ07pO,5:}OCnQ`O,5:qO#'_Q`O,5:qOCnQ`O,5:}O!@rQ07hO,5:qOOQ07`'#Ef'#EfOOQO,5:},5:}O%[Q^O,5:}O#'lQ07hO,5:}O#'wQ07hO,5:}O!@}Q`O,5:qOOQO,5;T,5;TO#(VQ07hO,5:}POOO'#IV'#IVP#(kO!0LbO,58{POOO,58{,58{OOOO-E<V-E<VOOQ07b1G.o1G.oOOOO-E<W-E<WO#(vQpO,59zOOOO-E<Y-E<YOOQ07b1G/d1G/dO#({QrO,5>wO+}Q^O,5>wOOQO,5>},5>}O#)VQ^O'#I]OOQO-E<Z-E<ZO#)dQWO,5@VO#)lQrO,5@VO#)sQWO,5@dOOQ07b1G/j1G/jO%[Q^O,5@eO#){QWO'#IcOOQO-E<a-E<aO#)sQWO,5@dOOQ07`1G0t1G0tOOQ07f1G/u1G/uOOQ07f1G0X1G0XO%[Q^O,5@bO#*aQ07hO,5@bO#*rQ07hO,5@bO#*yQWO,5@aO9ZQWO,5@aO#+RQWO,5@aO#+aQWO'#IfO#*yQWO,5@aOOQ07`1G0s1G0sO!*OQ`O,5:tO!*ZQ`O,5:tOOQO,5:v,5:vO#,RQWO,5:vO#,ZQ7[O1G2sO9aQWO1G2sOOQ07b1G0q1G0qO#,iQ08SO1G0qO#-nQ08QO,5;ROOQ07b'#GR'#GRO#.[Q08SO'#JdO!$aQ^O1G0qO#0dQ7[O'#JnO#0nQWO,5:_O#0sQrO'#JoO%[Q^O'#JoO#0}QWO,5:dOOQ07b'#D['#D[OOQ07b1G0z1G0zO%[Q^O1G0zOOQ07b1G1d1G1dO#1SQWO1G0zO#3kQ08SO1G0{O#3rQ08SO1G0{O#6]Q08SO1G0{O#6dQ08SO1G0{O#8nQ08SO1G0{O#9UQ08SO1G0{O#<OQ08SO1G0{O#<VQ08SO1G0{O#>pQ08SO1G0{O#>wQ08SO1G0{O#@oQ08SO1G0{O#CoQ(CYO'#ChO#EmQ(CYO1G1^O#EtQ(CYO'#JjO!,lQWO1G1dO#FUQ08SO,5?TOOQ07`-E<g-E<gO#FxQ08SO1G0{OOQ07b1G0{1G0{O#ITQ08SO1G1aO#IwQ&jO,5<TO#JPQ&jO,5<UO#JXQ&jO'#FlO#JpQWO'#FkOOQO'#KO'#KOOOQO'#Ig'#IgO#JuQ&jO1G1kOOQ07b1G1k1G1kOOOS1G1v1G1vO#KWQ(CYO'#JiO#KbQWO,5<_O!*fQ^O,5<_OOOS-E<f-E<fOOQ07b1G1i1G1iO#KgQ`O'#J}OOQ07b,5<a,5<aO#KoQ`O,5<aOOQ07b,59e,59eO!&dQ7[O'#DPOOOO'#IZ'#IZO#KtO?MpO,59iOOQ07b,59i,59iO%[Q^O1G1|O!6[QWO'#IkO#LPQ7[O,5<uOOQ07b,5<r,5<rO!(SQ7[O'#InO#LoQ7[O,5=RO!(SQ7[O'#IpO#MbQ7[O,5=TO!&dQ7[O,5=VOOQO1G2O1G2OO#MlQpO'#CqO#NPQpO,5<nO#NWQWO'#KRO9aQWO'#KRO#NfQWO,5<pO!(SQ7[O,5<oO#NkQWO'#GUO#NvQWO,5<oO#N{QpO'#GRO$ YQpO'#KSO$ dQWO'#KSO!&dQ7[O'#KSO$ iQWO,5<sO$ nQ`O'#G^O!4eQ`O'#G^O$!PQWO'#G`O$!UQWO'#GbO!3fQWO'#GeO$!ZQ07hO'#ImO$!fQ`O,5<wOOQ07f,5<w,5<wO$!mQ`O'#G^O$!{Q`O'#G_O$#TQ`O'#G_O$#YQ7[O,5=RO$#jQ7[O,5=TOOQ07b,5=W,5=WO!(SQ7[O,5?}O!(SQ7[O,5?}O$#zQWO'#IrO$$VQWO,5?|O$$_QWO,59`O$%OQ7[O,59qOOQ07b,59q,59qO$%qQ7[O,5<fO$&dQ7[O,5<hO@bQWO,5<jOOQ07b,5<k,5<kO$&nQWO,5<qO$&sQ7[O,5<vO$'TQWO'#JuO!$aQ^O1G1}O$'YQWO1G1}O9ZQWO'#JxO9ZQWO'#EpO%[Q^O'#EpO9ZQWO'#ItO$'_Q07hO,5@rOOQU1G2w1G2wOOQU1G4X1G4XOOQ07b1G/w1G/wO!,iQWO1G/wO$)dQ08SO1G0TOOQU1G2s1G2sO!&dQ7[O1G2sO%[Q^O1G2sO#,^QWO1G2sO$+hQ7[O'#EgOOQ07`,5?{,5?{O$+rQ07hO,5?{OOQU1G.t1G.tO!@rQ07hO1G.tO!@}Q`O1G.tO!AVQ7[O1G.tO$,TQWO1G0qO$,YQWO'#ChO$,eQWO'#K[O$,mQWO,5=uO$,rQWO'#K[O$,wQWO'#K[O$-VQWO'#IzO$-eQWO,5@uO$-mQrO1G1fOOQ07b1G1h1G1hO9aQWO1G3`O@bQWO1G3`O$-tQWO1G3`O$-yQWO1G3`OOQU1G3`1G3`O!CTQWO1G3OO!&dQ7[O1G2{O$.OQWO1G2{OOQU1G2|1G2|O!&dQ7[O1G2|O$.TQWO1G2|O$.]Q`O'#GzOOQU1G3O1G3OO!4eQ`O'#IvO!CYQpO1G3ROOQU1G3R1G3ROOQU,5=l,5=lO$.eQ7[O,5=nO9aQWO,5=nO$!UQWO,5=pO9UQWO,5=pO!@}Q`O,5=pO!AVQ7[O,5=pO:RQ7[O,5=pO$.sQWO'#KYO$/OQWO,5=qOOQU1G.j1G.jO$/TQ07hO1G.jO@bQWO1G.jO$/`QWO1G.jO9kQ07hO1G.jO$1eQrO,5@wO$1uQWO,5@wO9ZQWO,5@wO$2QQ^O,5=xO$2XQWO,5=xOOQU1G3b1G3bO`Q^O1G3bOOQU1G3h1G3hOOQU1G3j1G3jO>kQWO1G3lO$2^Q^O1G3nO$6bQ^O'#HmOOQU1G3q1G3qO$6oQWO'#HsO>pQWO'#HuOOQU1G3w1G3wO$6wQ^O1G3wO9kQ07hO1G3}OOQU1G4P1G4POOQ07`'#GY'#GYO9kQ07hO1G4RO9kQ07hO1G4TO$;OQWO,5@XO!*fQ^O,5;[O9ZQWO,5;[O>pQWO,5:UO!*fQ^O,5:UO!@}Q`O,5:UO$;TQ(CYO,5:UOOQO,5;[,5;[O$;_Q`O'#I^O$;uQWO,5@WOOQ07b1G/o1G/oO$;}Q`O'#IdO$<XQWO,5@fOOQ07`1G0u1G0uO# xQ`O,5:UOOQO'#Ia'#IaO$<aQ`O,5:pOOQ07f,5:p,5:pO#%sQWO1G0YOOQ07b1G0Y1G0YO%[Q^O1G0YOOQ07b1G0p1G0pO>pQWO1G0pO!@}Q`O1G0pO!AVQ7[O1G0pOOQ07`1G5s1G5sO!@rQ07hO1G0]OOQO1G0i1G0iO%[Q^O1G0iO$<hQ07hO1G0iO$<sQ07hO1G0iO!@}Q`O1G0]OCnQ`O1G0]O$=RQ07hO1G0iOOQO1G0]1G0]O$=gQ08SO1G0iPOOO-E<T-E<TPOOO1G.g1G.gOOOO1G/f1G/fO$=qQpO,5<eO$=yQrO1G4cOOQO1G4i1G4iO%[Q^O,5>wO$>TQWO1G5qO$>]QWO1G6OO$>eQrO1G6PO9ZQWO,5>}O$>oQ08SO1G5|O%[Q^O1G5|O$?PQ07hO1G5|O$?bQWO1G5{O$?bQWO1G5{O9ZQWO1G5{O$?jQWO,5?QO9ZQWO,5?QOOQO,5?Q,5?QO$@OQWO,5?QO$'TQWO,5?QOOQO-E<d-E<dOOQO1G0`1G0`OOQO1G0b1G0bO!,lQWO1G0bOOQU7+(_7+(_O!&dQ7[O7+(_O%[Q^O7+(_O$@^QWO7+(_O$@iQ7[O7+(_O$@wQ08SO,5=RO$CSQ08SO,5=TO$E_Q08SO,5=RO$GpQ08SO,5=TO$JRQ08SO,59qO$LZQ08SO,5<fO$NfQ08SO,5<hO%!qQ08SO,5<vOOQ07b7+&]7+&]O%%SQ08SO7+&]O%%vQ7[O'#I_O%&QQWO,5@YOOQ07b1G/y1G/yO%&YQ^O'#I`O%&gQWO,5@ZO%&oQrO,5@ZOOQ07b1G0O1G0OO%&yQWO7+&fOOQ07b7+&f7+&fO%'OQ(CYO,5:eO%[Q^O7+&xO%'YQ(CYO,5:]O%'gQ(CYO,5:iO%'qQ(CYO,5:kOOQ07b7+'O7+'OOOQO1G1o1G1oOOQO1G1p1G1pO%'{QtO,5<WO!*fQ^O,5<VOOQO-E<e-E<eOOQ07b7+'V7+'VOOOS7+'b7+'bOOOS1G1y1G1yO%(WQWO1G1yOOQ07b1G1{1G1{O%(]QpO,59kOOOO-E<X-E<XOOQ07b1G/T1G/TO%(dQ08SO7+'hOOQ07b,5?V,5?VO%)WQpO,5?VOOQ07b1G2a1G2aP!&dQ7[O'#IkPOQ07b-E<i-E<iO%)vQ7[O,5?YOOQ07b-E<l-E<lO%*iQ7[O,5?[OOQ07b-E<n-E<nO%*sQpO1G2qOOQ07b1G2Y1G2YO%*zQWO'#IjO%+YQWO,5@mO%+YQWO,5@mO%+bQWO,5@mO%+mQWO,5@mOOQO1G2[1G2[O%+{Q7[O1G2ZO!(SQ7[O1G2ZO%,]Q!LQO'#IlO%,mQWO,5@nO!&dQ7[O,5@nO%,uQpO,5@nOOQ07b1G2_1G2_OOQ07`,5<x,5<xOOQ07`,5<y,5<yO$'TQWO,5<yOC_QWO,5<yO!@}Q`O,5<xOOQO'#Ga'#GaO%-PQWO,5<zOOQ07`,5<|,5<|O$'TQWO,5=POOQO,5?X,5?XOOQO-E<k-E<kOOQ07f1G2c1G2cO!4eQ`O,5<xO%-XQWO,5<yO$!PQWO,5<zO!4eQ`O,5<yO!(SQ7[O'#InO%-{Q7[O1G2mO!(SQ7[O'#IpO%.nQ7[O1G2oO%.xQ7[O1G5iO%/SQ7[O1G5iOOQO,5?^,5?^OOQO-E<p-E<pOOQO1G.z1G.zO!7{Q`O,59sO%[Q^O,59sO%/aQWO1G2UO!(SQ7[O1G2]O%/fQ08SO7+'iOOQ07b7+'i7+'iO!$aQ^O7+'iO%0YQWO,5;[OOQ07`,5?`,5?`OOQ07`-E<r-E<rOOQ07b7+%c7+%cO%0_QpO'#KTO#%sQWO7+(_O%0iQrO7+(_O$@aQWO7+(_O%0pQ08QO'#ChO%1TQ08QO,5<}O%1uQWO,5<}OOQ07`1G5g1G5gOOQU7+$`7+$`O!@rQ07hO7+$`O!@}Q`O7+$`O!$aQ^O7+&]O%1zQWO'#IyO%2cQWO,5@vOOQO1G3a1G3aO9aQWO,5@vO%2cQWO,5@vO%2kQWO,5@vOOQO,5?f,5?fOOQO-E<x-E<xOOQ07b7+'Q7+'QO%2pQWO7+(zO9kQ07hO7+(zO9aQWO7+(zO@bQWO7+(zOOQU7+(j7+(jO%2uQ08QO7+(gO!&dQ7[O7+(gO%3PQpO7+(hOOQU7+(h7+(hO!&dQ7[O7+(hO%3WQWO'#KXO%3cQWO,5=fOOQO,5?b,5?bOOQO-E<t-E<tOOQU7+(m7+(mO%4rQ`O'#HTOOQU1G3Y1G3YO!&dQ7[O1G3YO%[Q^O1G3YO%4yQWO1G3YO%5UQ7[O1G3YO9kQ07hO1G3[O$!UQWO1G3[O9UQWO1G3[O!@}Q`O1G3[O!AVQ7[O1G3[O%5dQWO'#IxO%5xQWO,5@tO%6QQ`O,5@tOOQ07`1G3]1G3]OOQU7+$U7+$UO@bQWO7+$UO9kQ07hO7+$UO%6]QWO7+$UO%[Q^O1G6cO%[Q^O1G6dO%6bQ07hO1G6cO%6lQ^O1G3dO%6sQWO1G3dO%6xQ^O1G3dOOQU7+(|7+(|O9kQ07hO7+)WO`Q^O7+)YOOQU'#K_'#K_OOQU'#I{'#I{O%7PQ^O,5>XOOQU,5>X,5>XO%[Q^O'#HnO%7^QWO'#HpOOQU,5>_,5>_O9ZQWO,5>_OOQU,5>a,5>aOOQU7+)c7+)cOOQU7+)i7+)iOOQU7+)m7+)mOOQU7+)o7+)oO%7cQ`O1G5sO%7wQ(CYO1G0vO%8RQWO1G0vOOQO1G/p1G/pO%8^Q(CYO1G/pO>pQWO1G/pO!*fQ^O'#DjOOQO,5>x,5>xOOQO-E<[-E<[OOQO,5?O,5?OOOQO-E<b-E<bO!@}Q`O1G/pOOQO-E<_-E<_OOQ07f1G0[1G0[OOQ07b7+%t7+%tO#%sQWO7+%tOOQ07b7+&[7+&[O>pQWO7+&[O!@}Q`O7+&[OOQO7+%w7+%wO$=gQ08SO7+&TOOQO7+&T7+&TO%[Q^O7+&TO%8hQ07hO7+&TO!@rQ07hO7+%wO!@}Q`O7+%wO%8sQ07hO7+&TO%9RQ08SO7++hO%[Q^O7++hO%9cQWO7++gO%9cQWO7++gOOQO1G4l1G4lO9ZQWO1G4lO%9kQWO1G4lOOQO7+%|7+%|O#%sQWO<<KyO%0iQrO<<KyO%9yQWO<<KyOOQU<<Ky<<KyO!&dQ7[O<<KyO%[Q^O<<KyO%:RQWO<<KyO%:^Q08SO,5?YO%<iQ08SO,5?[O%>tQ08SO1G2ZO%AVQ08SO1G2mO%CbQ08SO1G2oO%EmQ7[O,5>yOOQO-E<]-E<]O%EwQrO,5>zO%[Q^O,5>zOOQO-E<^-E<^O%FRQWO1G5uOOQ07b<<JQ<<JQO%FZQ(CYO1G0qO%HeQ(CYO1G0{O%HlQ(CYO1G0{O%JpQ(CYO1G0{O%JwQ(CYO1G0{O%LlQ(CYO1G0{O%MSQ(CYO1G0{O& gQ(CYO1G0{O& nQ(CYO1G0{O&#rQ(CYO1G0{O&#yQ(CYO1G0{O&%qQ(CYO1G0{O&&UQ08SO<<JdO&'ZQ(CYO1G0{O&)PQ(CYO'#JdO&+SQ(CYO1G1aO&+aQ(CYO1G0TO!*fQ^O'#FnOOQO'#KP'#KPOOQO1G1r1G1rO&+kQWO1G1qO&+pQ(CYO,5?TOOOS7+'e7+'eOOOO1G/V1G/VOOQ07b1G4q1G4qO!(SQ7[O7+(]O&+zQWO,5?UO9aQWO,5?UOOQO-E<h-E<hO&,YQWO1G6XO&,YQWO1G6XO&,bQWO1G6XO&,mQ7[O7+'uO&,}QpO,5?WO&-XQWO,5?WO!&dQ7[O,5?WOOQO-E<j-E<jO&-^QpO1G6YO&-hQWO1G6YOOQ07`1G2e1G2eO$'TQWO1G2eOOQ07`1G2d1G2dO&-pQWO1G2fO!&dQ7[O1G2fOOQ07`1G2k1G2kO!@}Q`O1G2dOC_QWO1G2eO&-uQWO1G2fO&-}QWO1G2eO&.qQ7[O,5?YOOQ07b-E<m-E<mO&/dQ7[O,5?[OOQ07b-E<o-E<oO!(SQ7[O7++TOOQ07b1G/_1G/_O&/nQWO1G/_OOQ07b7+'p7+'pO&/sQ7[O7+'wO&0TQ08SO<<KTOOQ07b<<KT<<KTO&0wQWO1G0vO!&dQ7[O'#IsO&0|QWO,5@oO!&dQ7[O1G2iOOQU<<Gz<<GzO!@rQ07hO<<GzO&1UQ08SO<<IwOOQ07b<<Iw<<IwOOQO,5?e,5?eO&1xQWO,5?eO&1}QWO,5?eOOQO-E<w-E<wO&2]QWO1G6bO&2]QWO1G6bO9aQWO1G6bO@bQWO<<LfOOQU<<Lf<<LfO&2eQWO<<LfO9kQ07hO<<LfOOQU<<LR<<LRO%2uQ08QO<<LROOQU<<LS<<LSO%3PQpO<<LSO&2jQ`O'#IuO&2uQWO,5@sO!*fQ^O,5@sOOQU1G3Q1G3QO&2}Q^O'#JmOOQO'#Iw'#IwO9kQ07hO'#IwO&3XQ`O,5=oOOQU,5=o,5=oO&3`Q`O'#EcO&3tQWO7+(tO&3yQWO7+(tOOQU7+(t7+(tO!&dQ7[O7+(tO%[Q^O7+(tO&4RQWO7+(tOOQU7+(v7+(vO9kQ07hO7+(vO$!UQWO7+(vO9UQWO7+(vO!@}Q`O7+(vO&4^QWO,5?dOOQO-E<v-E<vOOQO'#HW'#HWO&4iQWO1G6`O9kQ07hO<<GpOOQU<<Gp<<GpO@bQWO<<GpO&4qQWO7++}O&4vQWO7+,OO%[Q^O7++}O%[Q^O7+,OOOQU7+)O7+)OO&4{QWO7+)OO&5QQ^O7+)OO&5XQWO7+)OOOQU<<Lr<<LrOOQU<<Lt<<LtOOQU-E<y-E<yOOQU1G3s1G3sO&5^QWO,5>YOOQU,5>[,5>[O&5cQWO1G3yO9ZQWO7+&bO!*fQ^O7+&bOOQO7+%[7+%[O&5hQ(CYO1G6PO>pQWO7+%[OOQ07b<<I`<<I`OOQ07b<<Iv<<IvO>pQWO<<IvOOQO<<Io<<IoO$=gQ08SO<<IoO%[Q^O<<IoOOQO<<Ic<<IcO!@rQ07hO<<IcO&5rQ07hO<<IoO&5}Q08SO<= SO&6_QWO<= ROOQO7+*W7+*WO9ZQWO7+*WOOQUANAeANAeO&6gQWOANAeO!&dQ7[OANAeO#%sQWOANAeO%0iQrOANAeO%[Q^OANAeO&6oQ08SO7+'uO&9QQ08SO,5?YO&;]Q08SO,5?[O&=hQ08SO7+'wO&?yQrO1G4fO&@TQ(CYO7+&]O&BXQ(CYO,5=RO&D`Q(CYO,5=TO&DpQ(CYO,5=RO&EQQ(CYO,5=TO&EbQ(CYO,59qO&GeQ(CYO,5<fO&IhQ(CYO,5<hO&KkQ(CYO,5<vO&MaQ(CYO7+'hO&MnQ(CYO7+'iO&M{QWO,5<YOOQO7+']7+']O&NQQ7[O<<KwOOQO1G4p1G4pO&NXQWO1G4pO&NdQWO1G4pO&NrQWO7++sO&NrQWO7++sO!&dQ7[O1G4rO&NzQpO1G4rO' UQWO7++tOOQ07`7+(P7+(PO$'TQWO7+(QO' ^QpO7+(QOOQ07`7+(O7+(OO$'TQWO7+(PO' eQWO7+(QO!&dQ7[O7+(QOC_QWO7+(PO' jQ7[O<<NoOOQ07b7+$y7+$yO' tQpO,5?_OOQO-E<q-E<qO'!OQ08QO7+(TOOQUAN=fAN=fO9aQWO1G5POOQO1G5P1G5PO'!`QWO1G5PO'!eQWO7++|O'!eQWO7++|O9kQ07hOANBQO@bQWOANBQOOQUANBQANBQOOQUANAmANAmOOQUANAnANAnO'!mQWO,5?aOOQO-E<s-E<sO'!xQ(CYO1G6_O'%YQrO'#ChOOQO,5?c,5?cOOQO-E<u-E<uOOQU1G3Z1G3ZO&2}Q^O,5<zOOQU<<L`<<L`O!&dQ7[O<<L`O&3tQWO<<L`O'%dQWO<<L`O%[Q^O<<L`OOQU<<Lb<<LbO9kQ07hO<<LbO$!UQWO<<LbO9UQWO<<LbO'%lQ`O1G5OO'%wQWO7++zOOQUAN=[AN=[O9kQ07hOAN=[OOQU<= i<= iOOQU<= j<= jO'&PQWO<= iO'&UQWO<= jOOQU<<Lj<<LjO'&ZQWO<<LjO'&`Q^O<<LjOOQU1G3t1G3tO>pQWO7+)eO'&gQWO<<I|O'&rQ(CYO<<I|OOQO<<Hv<<HvOOQ07bAN?bAN?bOOQOAN?ZAN?ZO$=gQ08SOAN?ZOOQOAN>}AN>}O%[Q^OAN?ZOOQO<<Mr<<MrOOQUG27PG27PO!&dQ7[OG27PO#%sQWOG27PO'&|QWOG27PO%0iQrOG27PO''UQ(CYO<<JdO''cQ(CYO1G2ZO')XQ(CYO,5?YO'+[Q(CYO,5?[O'-_Q(CYO1G2mO'/bQ(CYO1G2oO'1eQ(CYO<<KTO'1rQ(CYO<<IwOOQO1G1t1G1tO!(SQ7[OANAcOOQO7+*[7+*[O'2PQWO7+*[O'2[QWO<= _O'2dQpO7+*^OOQ07`<<Kl<<KlO$'TQWO<<KlOOQ07`<<Kk<<KkO'2nQpO<<KlO$'TQWO<<KkOOQO7+*k7+*kO9aQWO7+*kO'2uQWO<= hOOQUG27lG27lO9kQ07hOG27lO!*fQ^O1G4{O'2}QWO7++yO&3tQWOANAzOOQUANAzANAzO!&dQ7[OANAzO'3VQWOANAzOOQUANA|ANA|O9kQ07hOANA|O$!UQWOANA|OOQO'#HX'#HXOOQO7+*j7+*jOOQUG22vG22vOOQUANETANETOOQUANEUANEUOOQUANBUANBUO'3_QWOANBUOOQU<<MP<<MPO!*fQ^OAN?hOOQOG24uG24uO$=gQ08SOG24uO#%sQWOLD,kOOQULD,kLD,kO!&dQ7[OLD,kO'3dQWOLD,kO'3lQ(CYO7+'uO'5bQ(CYO,5?YO'7eQ(CYO,5?[O'9hQ(CYO7+'wO';^Q7[OG26}OOQO<<Mv<<MvOOQ07`ANAWANAWO$'TQWOANAWOOQ07`ANAVANAVOOQO<<NV<<NVOOQULD-WLD-WO';nQ(CYO7+*gOOQUG27fG27fO&3tQWOG27fO!&dQ7[OG27fOOQUG27hG27hO9kQ07hOG27hOOQUG27pG27pO';xQ(CYOG25SOOQOLD*aLD*aOOQU!$(!V!$(!VO#%sQWO!$(!VO!&dQ7[O!$(!VO'<SQ08SOG26}OOQ07`G26rG26rOOQULD-QLD-QO&3tQWOLD-QOOQULD-SLD-SOOQU!)9Eq!)9EqO#%sQWO!)9EqOOQU!$(!l!$(!lOOQU!.K;]!.K;]O'>eQ(CYOG26}O!*fQ^O'#DyO1PQWO'#EWO'@ZQrO'#JiO!*fQ^O'#DqO'@bQ^O'#D}O'@iQrO'#ChO'CPQrO'#ChO!*fQ^O'#EPO'CaQ^O,5;VO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O,5;aO!*fQ^O'#IiO'EdQWO,5<eO'ElQ7[O,5;aO'GVQ7[O,5;aO!*fQ^O,5;uO!&dQ7[O'#GgO'ElQ7[O'#GgO!&dQ7[O'#GiO'ElQ7[O'#GiO1SQWO'#DVO1SQWO'#DVO!&dQ7[O'#FzO'ElQ7[O'#FzO!&dQ7[O'#F|O'ElQ7[O'#F|O!&dQ7[O'#G[O'ElQ7[O'#G[O!*fQ^O,5:iO!*fQ^O,5@eO'CaQ^O1G0qO'G^Q(CYO'#ChO!*fQ^O1G1|O!&dQ7[O'#InO'ElQ7[O'#InO!&dQ7[O'#IpO'ElQ7[O'#IpO!&dQ7[O,5<oO'ElQ7[O,5<oO'CaQ^O1G1}O!*fQ^O7+&xO!&dQ7[O1G2ZO'ElQ7[O1G2ZO!&dQ7[O'#InO'ElQ7[O'#InO!&dQ7[O'#IpO'ElQ7[O'#IpO!&dQ7[O1G2]O'ElQ7[O1G2]O'CaQ^O7+'iO'CaQ^O7+&]O!&dQ7[OANAcO'ElQ7[OANAcO'GhQWO'#EkO'GmQWO'#EkO'GuQWO'#FZO'GzQWO'#EuO'HPQWO'#JyO'H[QWO'#JwO'HgQWO,5;VO'HlQ7[O,5<bO'HsQWO'#GTO'HxQWO'#GTO'H}QWO,5<cO'IVQWO,5;VO'I_Q(CYO1G1^O'IfQWO,5<oO'IkQWO,5<oO'IpQWO,5<qO'IuQWO,5<qO'IzQWO1G1}O'JPQWO1G0qO'JUQ7[O<<KwO'J]Q7[O<<KwO7hQ7[O'#FxO9UQWO'#FwOA]QWO'#EjO!*fQ^O,5;rO!3fQWO'#GTO!3fQWO'#GTO!3fQWO'#GVO!3fQWO'#GVO!(SQ7[O7+(]O!(SQ7[O7+(]O%*sQpO1G2qO%*sQpO1G2qO!&dQ7[O,5=VO!&dQ7[O,5=V",stateData:"'Ka~O'tOS'uOSSOS'vRQ~OPYOQYORfOX!VO`qOczOdyOlkOnYOokOpkOvkOxYOzYO!PWO!TkO!UkO![XO!fuO!kZO!nYO!oYO!pYO!rvO!twO!wxO!{]O#s!PO$T|O%b}O%d!QO%f!OO%g!OO%h!OO%k!RO%m!SO%p!TO%q!TO%s!UO&P!WO&V!XO&X!YO&Z!ZO&]![O&`!]O&f!^O&l!_O&n!`O&p!aO&r!bO&t!cO'{SO'}TO(QUO(XVO(g[O(tiO~OVtO~P`OPYOQYORfOc!jOd!iOlkOnYOokOpkOvkOxYOzYO!PWO!TkO!UkO![!eO!fuO!kZO!nYO!oYO!pYO!rvO!t!gO!w!hO$T!kO'{!dO'}TO(QUO(XVO(g[O(tiO~O`!vOo!nO!P!oO!_!xO!`!uO!a!uO!{:dO#P!pO#Q!pO#R!wO#S!pO#T!pO#W!yO#X!yO'|!lO'}TO(QUO([!mO(g!sO~O'v!zO~OP[XZ[X`[Xn[X|[X}[X!P[X!Y[X!h[X!i[X!k[X!o[X#[[X#geX#j[X#k[X#l[X#m[X#n[X#o[X#p[X#q[X#r[X#t[X#v[X#x[X#y[X$O[X'r[X(X[X(h[X(o[X(p[X~O!d$|X~P(qO^!|O'}#OO(O!|O(P#OO~O^#PO(P#OO(Q#OO(R#PO~Ot#RO!R#SO(Y#SO(Z#UO~OPYOQYORfOc!jOd!iOlkOnYOokOpkOvkOxYOzYO!PWO!TkO!UkO![!eO!fuO!kZO!nYO!oYO!pYO!rvO!t!gO!w!hO$T!kO'{:hO'}TO(QUO(XVO(g[O(tiO~O!X#YO!Y#VO!V(_P!V(lP~P+}O!Z#bO~P`OPYOQYORfOc!jOd!iOnYOokOpkOvkOxYOzYO!PWO!TkO!UkO![!eO!fuO!kZO!nYO!oYO!pYO!rvO!t!gO!w!hO$T!kO'}TO(QUO(XVO(g[O(tiO~Ol#lO!X#hO!{]O#e#kO#f#hO'{:iO!j(iP~P.iO!k#nO'{#mO~O!w#rO!{]O%b#sO~O#g#tO~O!d#uO#g#tO~OP$]OZ$dOn$QO|#yO}#zO!P#{O!Y$aO!h$SO!i#wO!k#xO!o$]O#j$OO#k$PO#l$PO#m$PO#n$RO#o$SO#p$SO#q$cO#r$SO#t$TO#v$VO#x$XO#y$YO(XVO(h$ZO(o#|O(p#}O~O`(]X'r(]X'p(]X!j(]X!V(]X![(]X%c(]X!d(]X~P1qO#[$eO$O$eOP(^XZ(^Xn(^X|(^X}(^X!P(^X!Y(^X!h(^X!k(^X!o(^X#j(^X#k(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#r(^X#t(^X#v(^X#x(^X#y(^X(X(^X(h(^X(o(^X(p(^X![(^X%c(^X~O`(^X!i(^X'r(^X'p(^X!V(^X!j(^Xr(^X!d(^X~P4XO#[$eO~O$Y$gO$[$fO$c$lO~ORfO![$mO$f$nO$h$pO~Og%VOl%WOn$tOo$sOp$sOv%XOx%YOz%ZO!P${O![$|O!f%`O!k$xO#f%aO$T%^O$o%[O$q%]O$t%_O'{$rO'}TO(QUO(X$uO(o$}O(p%POf(UP~O!k%bO~O!P%eO![%fO'{%dO~O!d%jO~O`%kO'r%kO~O'|!lO~P%[O%h%rO~P%[Og%VO!k%bO'{%dO'|!lO~Od%yO!k%bO'{%dO~O#r$SO~O|&OO![%{O!k%}O%d&RO'{%dO'|!lO'}TO(QUO_(}P~O!w#rO~O%m&TO!P(yX![(yX'{(yX~O'{&UO~O!t&ZO#s!PO%d!QO%f!OO%g!OO%h!OO%k!RO%m!SO%p!TO%q!TO~Oc&`Od&_O!w&]O%b&^O%u&[O~P;xOc&cOdyO![&bO!t&ZO!wxO!{]O#s!PO%b}O%f!OO%g!OO%h!OO%k!RO%m!SO%p!TO%q!TO%s!UO~Oa&fO#[&iO%d&dO'|!lO~P<}O!k&jO!t&nO~O!k#nO~O![XO~O`%kO'q&vO'r%kO~O`%kO'q&yO'r%kO~O`%kO'q&{O'r%kO~O'p[X!V[Xr[X!j[X&T[X![[X%c[X!d[X~P(qO!_'YO!`'RO!a'RO'|!lO'}TO(QUO~Oo'PO!P'OO!X'SO([&}O!Z(`P!Z(nP~P@UOj']O!['ZO'{%dO~Od'bO!k%bO'{%dO~O|&OO!k%}O~Oo!nO!P!oO!{:dO#P!pO#Q!pO#S!pO#T!pO'|!lO'}TO(QUO([!mO(g!sO~O!_'hO!`'gO!a'gO#R!pO#W'iO#X'iO~PApO`%kOg%VO!d#uO!k%bO'r%kO(h'kO~O!o'oO#['mO~PCOOo!nO!P!oO'}TO(QUO([!mO(g!sO~O![XOo(eX!P(eX!_(eX!`(eX!a(eX!{(eX#P(eX#Q(eX#R(eX#S(eX#T(eX#W(eX#X(eX'|(eX'}(eX(Q(eX([(eX(g(eX~O!`'gO!a'gO'|!lO~PCnO'w'sO'x'sO'y'uO~O^!|O'}'wO(O!|O(P'wO~O^#PO(P'wO(Q'wO(R#PO~Ot#RO!R#SO(Y#SO(Z'{O~O!X'}O!V'PX!V'VX!Y'PX!Y'VX~P+}O!Y(PO!V(_X~OP$]OZ$dOn$QO|#yO}#zO!P#{O!Y(PO!h$SO!i#wO!k#xO!o$]O#j$OO#k$PO#l$PO#m$PO#n$RO#o$SO#p$SO#q$cO#r$SO#t$TO#v$VO#x$XO#y$YO(XVO(h$ZO(o#|O(p#}O~O!V(_X~PGbO!V(UO~O!V(kX!Y(kX!d(kX!j(kX(h(kX~O#[(kX#g#`X!Z(kX~PIhO#[(VO!V(mX!Y(mX~O!Y(WO!V(lX~O!V(ZO~O#[$eO~PIhO!Z([O~P`O|#yO}#zO!P#{O!i#wO!k#xO(XVOP!maZ!man!ma!Y!ma!h!ma!o!ma#j!ma#k!ma#l!ma#m!ma#n!ma#o!ma#p!ma#q!ma#r!ma#t!ma#v!ma#x!ma#y!ma(h!ma(o!ma(p!ma~O`!ma'r!ma'p!ma!V!ma!j!mar!ma![!ma%c!ma!d!ma~PKOO!j(]O~O!d#uO#[(^O(h'kO!Y(jX`(jX'r(jX~O!j(jX~PMnO!P%eO![%fO!{]O#e(cO#f(bO'{%dO~O!Y(dO!j(iX~O!j(fO~O!P%eO![%fO#f(bO'{%dO~OP(^XZ(^Xn(^X|(^X}(^X!P(^X!Y(^X!h(^X!i(^X!k(^X!o(^X#j(^X#k(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#r(^X#t(^X#v(^X#x(^X#y(^X(X(^X(h(^X(o(^X(p(^X~O!d#uO!j(^X~P! [O|(gO}(hO!i#wO!k#xO!{!za!P!za~O!w!za%b!za![!za#e!za#f!za'{!za~P!#`O!w(lO~OPYOQYORfOc!jOd!iOlkOnYOokOpkOvkOxYOzYO!PWO!TkO!UkO![XO!fuO!kZO!nYO!oYO!pYO!rvO!t!gO!w!hO$T!kO'{!dO'}TO(QUO(XVO(g[O(tiO~Og%VOl%WOn$tOo$sOp$sOv%XOx%YOz;QO!P${O![$|O!f<`O!k$xO#f;WO$T%^O$o;SO$q;UO$t%_O'{(pO'}TO(QUO(X$uO(o$}O(p%PO~O#g(rO~Og%VOl%WOn$tOo$sOp$sOv%XOx%YOz%ZO!P${O![$|O!f%`O!k$xO#f%aO$T%^O$o%[O$q%]O$t%_O'{(pO'}TO(QUO(X$uO(o$}O(p%PO~Of(bP~P!(SO!X(vO!j(cP~P%[O([(xO(g[O~O!P(zO!k#xO([(xO(g[O~OP:cOQ:cORfOc<[Od!iOlkOn:cOokOpkOvkOx:cOz:cO!PWO!TkO!UkO![!eO!f:fO!kZO!n:cO!o:cO!p:cO!r:gO!t:jO!w!hO$T!kO'{)YO'}TO(QUO(XVO(g[O(t<YO~O})]O!k#xO~O!Y$aO`$ma'r$ma'p$ma!j$ma!V$ma![$ma%c$ma!d$ma~O#s)aO~P!&dO|)dO!d)cO![$ZX$W$ZX$Y$ZX$[$ZX$c$ZX~O!d)cO![(qX$W(qX$Y(qX$[(qX$c(qX~O|)dO~P!.OO|)dO![(qX$W(qX$Y(qX$[(qX$c(qX~O![)fO$W)jO$Y)eO$[)eO$c)kO~O!X)nO~P!*fO$Y$gO$[$fO$c)rO~Oj$uX|$uX!P$uX!i$uX(o$uX(p$uX~OfiXf$uXjiX!YiX#[iX~P!/tOo)tO~Ot)uO(Y)vO(Z)xO~Oj*RO|)zO!P){O(o$}O(p%PO~Of)yO~P!0}Of*SO~Og%VOl%WOn$tOo$sOp$sOv%XOx%YOz;QO!P${O![$|O!f<`O!k$xO#f;WO$T%^O$o;SO$q;UO$t%_O'}TO(QUO(X$uO(o$}O(p%PO~O!X*WO'{*TO!j(uP~P!1lO#g*YO~O!k*ZO~O!X*`O'{*]O!V(vP~P!1lOn*lO!P*dO!_*jO!`*cO!a*cO!k*ZO#W*kO%Y*fO'|!lO([!mO~O!Z*iO~P!3xO!i#wOj(WX|(WX!P(WX(o(WX(p(WX!Y(WX#[(WX~Of(WX#|(WX~P!4qOj*qO#[*pOf(VX!Y(VX~O!Y*rOf(UX~O'{&UOf(UP~O!k*yO~O'{(pO~Ol*}O!P%eO!X#hO![%fO!{]O#e#kO#f#hO'{%dO!j(iP~O!d#uO#g+OO~O!P%eO!X+QO!Y(WO![%fO'{%dO!V(lP~Oo'VO!P+SO!X+RO'}TO(QUO([(xO~O!Z(nP~P!7lO!Y+TO`(zX'r(zX~OP$]OZ$dOn$QO|#yO}#zO!P#{O!h$SO!i#wO!k#xO!o$]O#j$OO#k$PO#l$PO#m$PO#n$RO#o$SO#p$SO#q$cO#r$SO#t$TO#v$VO#x$XO#y$YO(XVO(h$ZO(o#|O(p#}O~O`!ea!Y!ea'r!ea'p!ea!V!ea!j!ear!ea![!ea%c!ea!d!ea~P!8dO|#yO}#zO!P#{O!i#wO!k#xO(XVOP!qaZ!qan!qa!Y!qa!h!qa!o!qa#j!qa#k!qa#l!qa#m!qa#n!qa#o!qa#p!qa#q!qa#r!qa#t!qa#v!qa#x!qa#y!qa(h!qa(o!qa(p!qa~O`!qa'r!qa'p!qa!V!qa!j!qar!qa![!qa%c!qa!d!qa~P!:}O|#yO}#zO!P#{O!i#wO!k#xO(XVOP!saZ!san!sa!Y!sa!h!sa!o!sa#j!sa#k!sa#l!sa#m!sa#n!sa#o!sa#p!sa#q!sa#r!sa#t!sa#v!sa#x!sa#y!sa(h!sa(o!sa(p!sa~O`!sa'r!sa'p!sa!V!sa!j!sar!sa![!sa%c!sa!d!sa~P!=hOg%VOj+^O!['ZO%c+]O~O!d+`O`(TX![(TX'r(TX!Y(TX~O`%kO![XO'r%kO~Og%VO!k%bO~Og%VO!k%bO'{%dO~O!d#uO#g(rO~Oa+kO%d+lO'{+hO'}TO(QUO!Z)OP~O!Y+mO_(}X~OZ+qO~O_+rO~O![%{O'{%dO'|!lO_(}P~Og%VO#[+wO~Og%VOj+zO![$|O~O![+|O~O|,OO![XO~O%h%rO~O!w,TO~Od,YO~Oa,ZO'{#mO'}TO(QUO!Z(|P~Od%yO~O%d!QO'{&UO~P<}OZ,`O_,_O~OPYOQYORfOczOdyOlkOnYOokOpkOvkOxYOzYO!PWO!TkO!UkO!fuO!kZO!nYO!oYO!pYO!rvO!wxO!{]O%b}O'}TO(QUO(XVO(g[O(tiO~O![!eO!t!gO$T!kO'{!dO~P!DkO_,_O`%kO'r%kO~OPYOQYORfOc!jOd!iOlkOnYOokOpkOvkOxYOzYO!PWO!TkO!UkO![!eO!fuO!kZO!nYO!oYO!pYO!rvO!w!hO$T!kO'{!dO'}TO(QUO(XVO(g[O(tiO~O`,eO!twO#s!OO%f!OO%g!OO%h!OO~P!GTO!k&jO~O&V,kO~O![,mO~O&h,oO&j,pOP&eaQ&eaR&eaX&ea`&eac&ead&eal&ean&eao&eap&eav&eax&eaz&ea!P&ea!T&ea!U&ea![&ea!f&ea!k&ea!n&ea!o&ea!p&ea!r&ea!t&ea!w&ea!{&ea#s&ea$T&ea%b&ea%d&ea%f&ea%g&ea%h&ea%k&ea%m&ea%p&ea%q&ea%s&ea&P&ea&V&ea&X&ea&Z&ea&]&ea&`&ea&f&ea&l&ea&n&ea&p&ea&r&ea&t&ea'p&ea'{&ea'}&ea(Q&ea(X&ea(g&ea(t&ea!Z&ea&^&eaa&ea&c&ea~O'{,uO~Og!bX!Y!OX!Y!bX!Z!OX!Z!bX!d!OX!d!bX!k!bX#[!OX~O!d,zO#[,yOg(aX!Y#dX!Y(aX!Z#dX!Z(aX!d(aX!k(aX~Og%VO!d,|O!k%bO!Y!^X!Z!^X~Oo!nO!P!oO'}TO(QUO([!mO~OP:cOQ:cORfOc<[Od!iOlkOn:cOokOpkOvkOx:cOz:cO!PWO!TkO!UkO![!eO!f:fO!kZO!n:cO!o:cO!p:cO!r:gO!t:jO!w!hO$T!kO'}TO(QUO(XVO(g[O(t<YO~O'{;]O~P#!ZO!Y-QO!Z(`X~O!Z-SO~O!d,zO#[,yO!Y#dX!Z#dX~O!Y-TO!Z(nX~O!Z-VO~O!`-WO!a-WO'|!lO~P# xO!Z-ZO~P'_Oj-^O!['ZO~O!V-cO~Oo!za!_!za!`!za!a!za#P!za#Q!za#R!za#S!za#T!za#W!za#X!za'|!za'}!za(Q!za([!za(g!za~P!#`O!o-hO#[-fO~PCOO!`-jO!a-jO'|!lO~PCnO`%kO#[-fO'r%kO~O`%kO!d#uO#[-fO'r%kO~O`%kO!d#uO!o-hO#[-fO'r%kO(h'kO~O'w'sO'x'sO'y-oO~Or-pO~O!V'Pa!Y'Pa~P!8dO!X-tO!V'PX!Y'PX~P%[O!Y(PO!V(_a~O!V(_a~PGbO!Y(WO!V(la~O!P%eO!X-xO![%fO'{%dO!V'VX!Y'VX~O#[-zO!Y(ja!j(ja`(ja'r(ja~O!d#uO~P#*aO!Y(dO!j(ia~O!P%eO![%fO#f.OO'{%dO~Ol.TO!P%eO!X.QO![%fO!{]O#e.SO#f.QO'{%dO!Y'YX!j'YX~O}.XO!k#xO~Og%VOj.[O!['ZO%c.ZO~O`#_i!Y#_i'r#_i'p#_i!V#_i!j#_ir#_i![#_i%c#_i!d#_i~P!8dOj<fO|)zO!P){O(o$}O(p%PO~O#g#Za`#Za#[#Za'r#Za!Y#Za!j#Za![#Za!V#Za~P#-]O#g(WXP(WXZ(WX`(WXn(WX}(WX!h(WX!k(WX!o(WX#j(WX#k(WX#l(WX#m(WX#n(WX#o(WX#p(WX#q(WX#r(WX#t(WX#v(WX#x(WX#y(WX'r(WX(X(WX(h(WX!j(WX!V(WX'p(WXr(WX![(WX%c(WX!d(WX~P!4qO!Y.iOf(bX~P!0}Of.kO~O!Y.lO!j(cX~P!8dO!j.oO~O!V.qO~OP$]O|#yO}#zO!P#{O!i#wO!k#xO!o$]O(XVOZ#ii`#iin#ii!Y#ii!h#ii#k#ii#l#ii#m#ii#n#ii#o#ii#p#ii#q#ii#r#ii#t#ii#v#ii#x#ii#y#ii'r#ii(h#ii(o#ii(p#ii'p#ii!V#ii!j#iir#ii![#ii%c#ii!d#ii~O#j#ii~P#1XO#j$OO~P#1XOP$]O|#yO}#zO!P#{O!i#wO!k#xO!o$]O#j$OO#k$PO#l$PO#m$PO(XVOZ#ii`#ii!Y#ii!h#ii#n#ii#o#ii#p#ii#q#ii#r#ii#t#ii#v#ii#x#ii#y#ii'r#ii(h#ii(o#ii(p#ii'p#ii!V#ii!j#iir#ii![#ii%c#ii!d#ii~On#ii~P#3yOn$QO~P#3yOP$]On$QO|#yO}#zO!P#{O!i#wO!k#xO!o$]O#j$OO#k$PO#l$PO#m$PO#n$RO(XVO`#ii!Y#ii#t#ii#v#ii#x#ii#y#ii'r#ii(h#ii(o#ii(p#ii'p#ii!V#ii!j#iir#ii![#ii%c#ii!d#ii~OZ#ii!h#ii#o#ii#p#ii#q#ii#r#ii~P#6kOZ$dO!h$SO#o$SO#p$SO#q$cO#r$SO~P#6kOP$]OZ$dOn$QO|#yO}#zO!P#{O!h$SO!i#wO!k#xO!o$]O#j$OO#k$PO#l$PO#m$PO#n$RO#o$SO#p$SO#q$cO#r$SO#t$TO(XVO`#ii!Y#ii#v#ii#x#ii#y#ii'r#ii(h#ii(p#ii'p#ii!V#ii!j#iir#ii![#ii%c#ii!d#ii~O(o#ii~P#9lO(o#|O~P#9lOP$]OZ$dOn$QO|#yO}#zO!P#{O!h$SO!i#wO!k#xO!o$]O#j$OO#k$PO#l$PO#m$PO#n$RO#o$SO#p$SO#q$cO#r$SO#t$TO#v$VO(XVO(o#|O`#ii!Y#ii#x#ii#y#ii'r#ii(h#ii'p#ii!V#ii!j#iir#ii![#ii%c#ii!d#ii~O(p#ii~P#<^O(p#}O~P#<^OP$]OZ$dOn$QO|#yO}#zO!P#{O!h$SO!i#wO!k#xO!o$]O#j$OO#k$PO#l$PO#m$PO#n$RO#o$SO#p$SO#q$cO#r$SO#t$TO#v$VO#x$XO(XVO(o#|O(p#}O~O`#ii!Y#ii#y#ii'r#ii(h#ii'p#ii!V#ii!j#iir#ii![#ii%c#ii!d#ii~P#?OOP[XZ[Xn[X|[X}[X!P[X!h[X!i[X!k[X!o[X#[[X#geX#j[X#k[X#l[X#m[X#n[X#o[X#p[X#q[X#r[X#t[X#v[X#x[X#y[X$O[X(X[X(h[X(o[X(p[X!Y[X!Z[X~O#|[X~P#AiOP$]OZ:zOn:nO|#yO}#zO!P#{O!h:pO!i#wO!k#xO!o$]O#j:lO#k:mO#l:mO#m:mO#n:oO#o:pO#p:pO#q:yO#r:pO#t:qO#v:sO#x:uO#y:vO(XVO(h$ZO(o#|O(p#}O~O#|.sO~P#CvO#[:{O$O:{O#|(^X!Z(^X~P! [O`']a!Y']a'r']a'p']a!j']a!V']ar']a![']a%c']a!d']a~P!8dOP#iiZ#ii`#iin#ii}#ii!Y#ii!h#ii!i#ii!k#ii!o#ii#j#ii#k#ii#l#ii#m#ii#n#ii#o#ii#p#ii#q#ii#r#ii#t#ii#v#ii#x#ii#y#ii'r#ii(X#ii(h#ii'p#ii!V#ii!j#iir#ii![#ii%c#ii!d#ii~P#-]O`#}i!Y#}i'r#}i'p#}i!V#}i!j#}ir#}i![#}i%c#}i!d#}i~P!8dO$Y.xO$[.xO~O$Y.yO$[.yO~O!d)cO#[.zO![$`X$W$`X$Y$`X$[$`X$c$`X~O!X.{O~O![)fO$W.}O$Y)eO$[)eO$c/OO~O!Y:wO!Z(]X~P#CvO!Z/PO~O!d)cO$c(qX~O$c/RO~Ot)uO(Y)vO(Z/UO~O!V/YO~P!&dO(o$}Oj%Za|%Za!P%Za(p%Za!Y%Za#[%Za~Of%Za#|%Za~P#LWO(p%POj%]a|%]a!P%]a(o%]a!Y%]a#[%]a~Of%]a#|%]a~P#LyO!YeX!deX!jeX!j$uX(heX~P!/tO!j/bO~P#-]O!Y/cO!d#uO(h'kO!j(uX~O!j/hO~O!X*WO'{%dO!j(uP~O#g/jO~O!V$uX!Y$uX!d$|X~P!/tO!Y/kO!V(vX~P#-]O!d/mO~O!V/oO~Og%VOn/sO!d#uO!k%bO(h'kO~O'{/uO~O!d+`O~O`%kO!Y/yO'r%kO~O!Z/{O~P!3xO!`/|O!a/|O'|!lO([!mO~O!P0OO([!mO~O#W0PO~Of%Za!Y%Za#[%Za#|%Za~P!0}Of%]a!Y%]a#[%]a#|%]a~P!0}O'{&UOf'fX!Y'fX~O!Y*rOf(Ua~Of0YO~O|0ZO}0ZO!P0[Ojya(oya(pya!Yya#[ya~Ofya#|ya~P$$dO|)zO!P){Oj$na(o$na(p$na!Y$na#[$na~Of$na#|$na~P$%YO|)zO!P){Oj$pa(o$pa(p$pa!Y$pa#[$pa~Of$pa#|$pa~P$%{O#g0^O~Of%Oa!Y%Oa#[%Oa#|%Oa~P!0}O!d#uO~O#g0aO~O!Y+TO`(za'r(za~O|#yO}#zO!P#{O!i#wO!k#xO(XVOP!qiZ!qin!qi!Y!qi!h!qi!o!qi#j!qi#k!qi#l!qi#m!qi#n!qi#o!qi#p!qi#q!qi#r!qi#t!qi#v!qi#x!qi#y!qi(h!qi(o!qi(p!qi~O`!qi'r!qi'p!qi!V!qi!j!qir!qi![!qi%c!qi!d!qi~P$'jOg%VOn$tOo$sOp$sOv%XOx%YOz;QO!P${O![$|O!f<`O!k$xO#f;WO$T%^O$o;SO$q;UO$t%_O'}TO(QUO(X$uO(o$}O(p%PO~Ol0kO'{0jO~P$*TO!d+`O`(Ta![(Ta'r(Ta!Y(Ta~O#g0qO~OZ[X!YeX!ZeX~O!Y0rO!Z)OX~O!Z0tO~OZ0uO~Oa0wO'{+hO'}TO(QUO~O![%{O'{%dO_'nX!Y'nX~O!Y+mO_(}a~O!j0zO~P!8dOZ0}O~O_1OO~O#[1RO~Oj1UO![$|O~O([(xO!Z({P~Og%VOj1_O![1[O%c1^O~OZ1iO!Y1gO!Z(|X~O!Z1jO~O_1lO`%kO'r%kO~O'{#mO'}TO(QUO~O#[$eO$O$eOP(^XZ(^Xn(^X|(^X}(^X!P(^X!Y(^X!h(^X!k(^X!o(^X#j(^X#k(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#t(^X#v(^X#x(^X#y(^X(X(^X(h(^X(o(^X(p(^X~O#r1oO&T1pO`(^X!i(^X~P$/kO#[$eO#r1oO&T1pO~O`1rO~P%[O`1tO~O&^1wOP&[iQ&[iR&[iX&[i`&[ic&[id&[il&[in&[io&[ip&[iv&[ix&[iz&[i!P&[i!T&[i!U&[i![&[i!f&[i!k&[i!n&[i!o&[i!p&[i!r&[i!t&[i!w&[i!{&[i#s&[i$T&[i%b&[i%d&[i%f&[i%g&[i%h&[i%k&[i%m&[i%p&[i%q&[i%s&[i&P&[i&V&[i&X&[i&Z&[i&]&[i&`&[i&f&[i&l&[i&n&[i&p&[i&r&[i&t&[i'p&[i'{&[i'}&[i(Q&[i(X&[i(g&[i(t&[i!Z&[ia&[i&c&[i~Oa1}O!Z1{O&c1|O~P`O![XO!k2PO~O&j,pOP&eiQ&eiR&eiX&ei`&eic&eid&eil&ein&eio&eip&eiv&eix&eiz&ei!P&ei!T&ei!U&ei![&ei!f&ei!k&ei!n&ei!o&ei!p&ei!r&ei!t&ei!w&ei!{&ei#s&ei$T&ei%b&ei%d&ei%f&ei%g&ei%h&ei%k&ei%m&ei%p&ei%q&ei%s&ei&P&ei&V&ei&X&ei&Z&ei&]&ei&`&ei&f&ei&l&ei&n&ei&p&ei&r&ei&t&ei'p&ei'{&ei'}&ei(Q&ei(X&ei(g&ei(t&ei!Z&ei&^&eia&ei&c&ei~O!V2VO~O!Y!^a!Z!^a~P#CvOo!nO!P!oO!X2]O([!mO!Y'QX!Z'QX~P@UO!Y-QO!Z(`a~O!Y'WX!Z'WX~P!7lO!Y-TO!Z(na~O!Z2dO~P'_O`%kO#[2mO'r%kO~O`%kO!d#uO#[2mO'r%kO~O`%kO!d#uO!o2qO#[2mO'r%kO(h'kO~O`%kO'r%kO~P!8dO!Y$aOr$ma~O!V'Pi!Y'Pi~P!8dO!Y(PO!V(_i~O!Y(WO!V(li~O!V(mi!Y(mi~P!8dO!Y(ji!j(ji`(ji'r(ji~P!8dO#[2sO!Y(ji!j(ji`(ji'r(ji~O!Y(dO!j(ii~O!P%eO![%fO!{]O#e2xO#f2wO'{%dO~O!P%eO![%fO#f2wO'{%dO~Oj3PO!['ZO%c3OO~Og%VOj3PO!['ZO%c3OO~O#g%ZaP%ZaZ%Za`%Zan%Za}%Za!h%Za!i%Za!k%Za!o%Za#j%Za#k%Za#l%Za#m%Za#n%Za#o%Za#p%Za#q%Za#r%Za#t%Za#v%Za#x%Za#y%Za'r%Za(X%Za(h%Za!j%Za!V%Za'p%Zar%Za![%Za%c%Za!d%Za~P#LWO#g%]aP%]aZ%]a`%]an%]a}%]a!h%]a!i%]a!k%]a!o%]a#j%]a#k%]a#l%]a#m%]a#n%]a#o%]a#p%]a#q%]a#r%]a#t%]a#v%]a#x%]a#y%]a'r%]a(X%]a(h%]a!j%]a!V%]a'p%]ar%]a![%]a%c%]a!d%]a~P#LyO#g%ZaP%ZaZ%Za`%Zan%Za}%Za!Y%Za!h%Za!i%Za!k%Za!o%Za#j%Za#k%Za#l%Za#m%Za#n%Za#o%Za#p%Za#q%Za#r%Za#t%Za#v%Za#x%Za#y%Za'r%Za(X%Za(h%Za!j%Za!V%Za'p%Za#[%Zar%Za![%Za%c%Za!d%Za~P#-]O#g%]aP%]aZ%]a`%]an%]a}%]a!Y%]a!h%]a!i%]a!k%]a!o%]a#j%]a#k%]a#l%]a#m%]a#n%]a#o%]a#p%]a#q%]a#r%]a#t%]a#v%]a#x%]a#y%]a'r%]a(X%]a(h%]a!j%]a!V%]a'p%]a#[%]ar%]a![%]a%c%]a!d%]a~P#-]O#gyaPyaZya`yanya!hya!iya!kya!oya#jya#kya#lya#mya#nya#oya#pya#qya#rya#tya#vya#xya#yya'rya(Xya(hya!jya!Vya'pyarya![ya%cya!dya~P$$dO#g$naP$naZ$na`$nan$na}$na!h$na!i$na!k$na!o$na#j$na#k$na#l$na#m$na#n$na#o$na#p$na#q$na#r$na#t$na#v$na#x$na#y$na'r$na(X$na(h$na!j$na!V$na'p$nar$na![$na%c$na!d$na~P$%YO#g$paP$paZ$pa`$pan$pa}$pa!h$pa!i$pa!k$pa!o$pa#j$pa#k$pa#l$pa#m$pa#n$pa#o$pa#p$pa#q$pa#r$pa#t$pa#v$pa#x$pa#y$pa'r$pa(X$pa(h$pa!j$pa!V$pa'p$par$pa![$pa%c$pa!d$pa~P$%{O#g%OaP%OaZ%Oa`%Oan%Oa}%Oa!Y%Oa!h%Oa!i%Oa!k%Oa!o%Oa#j%Oa#k%Oa#l%Oa#m%Oa#n%Oa#o%Oa#p%Oa#q%Oa#r%Oa#t%Oa#v%Oa#x%Oa#y%Oa'r%Oa(X%Oa(h%Oa!j%Oa!V%Oa'p%Oa#[%Oar%Oa![%Oa%c%Oa!d%Oa~P#-]O`#_q!Y#_q'r#_q'p#_q!V#_q!j#_qr#_q![#_q%c#_q!d#_q~P!8dOf'RX!Y'RX~P!(SO!Y.iOf(ba~O!X3ZO!Y'SX!j'SX~P%[O!Y.lO!j(ca~O!Y.lO!j(ca~P!8dO!V3^O~O#|!ma!Z!ma~PKOO#|!ea!Y!ea!Z!ea~P#CvO#|!qa!Z!qa~P!:}O#|!sa!Z!sa~P!=hORfO![3pO$a3qO~O!Z3uO~Or3vO~P#-]O`$jq!Y$jq'r$jq'p$jq!V$jq!j$jqr$jq![$jq%c$jq!d$jq~P!8dO!V3wO~P#-]O|)zO!P){O(p%POj'ba(o'ba!Y'ba#['ba~Of'ba#|'ba~P%)_O|)zO!P){Oj'da(o'da(p'da!Y'da#['da~Of'da#|'da~P%*QO(h$ZO~P#-]O!X3zO'{%dO!Y'^X!j'^X~O!Y/cO!j(ua~O!Y/cO!d#uO!j(ua~O!Y/cO!d#uO(h'kO!j(ua~Of$wi!Y$wi#[$wi#|$wi~P!0}O!X4SO'{*]O!V'`X!Y'`X~P!1lO!Y/kO!V(va~O!Y/kO!V(va~P#-]O!d#uO#r4[O~On4_O!d#uO(h'kO~O(o$}Oj%Zi|%Zi!P%Zi(p%Zi!Y%Zi#[%Zi~Of%Zi#|%Zi~P%-dO(p%POj%]i|%]i!P%]i(o%]i!Y%]i#[%]i~Of%]i#|%]i~P%.VOf(Vi!Y(Vi~P!0}O#[4fOf(Vi!Y(Vi~P!0}O!j4iO~O`$kq!Y$kq'r$kq'p$kq!V$kq!j$kqr$kq![$kq%c$kq!d$kq~P!8dO!V4mO~O!Y4nO![(wX~P#-]O!i#wO~P4XO`$uX![$uX%W[X'r$uX!Y$uX~P!/tO%W4pO`kXjkX|kX!PkX![kX'rkX(okX(pkX!YkX~O%W4pO~Oa4vO%d4wO'{+hO'}TO(QUO!Y'mX!Z'mX~O!Y0rO!Z)Oa~OZ4{O~O_4|O~O`%kO'r%kO~P#-]O![$|O~P#-]O!Y5UO#[5WO!Z({X~O!Z5XO~Oo!nO!P5YO!_!xO!`!uO!a!uO!{:dO#P!pO#Q!pO#R!pO#S!pO#T!pO#W5_O#X!yO'|!lO'}TO(QUO([!mO(g!sO~O!Z5^O~P%3hOj5dO![1[O%c5cO~Og%VOj5dO![1[O%c5cO~Oa5kO'{#mO'}TO(QUO!Y'lX!Z'lX~O!Y1gO!Z(|a~O'}TO(QUO([5mO~O_5qO~O#r5tO&T5uO~PMnO!j5vO~P%[O`5xO~O`5xO~P%[Oa1}O!Z5}O&c1|O~P`O!d6PO~O!d6ROg(ai!Y(ai!Z(ai!d(ai!k(ai~O!Y#di!Z#di~P#CvO#[6SO!Y#di!Z#di~O!Y!^i!Z!^i~P#CvO`%kO#[6]O'r%kO~O`%kO!d#uO#[6]O'r%kO~O!Y(jq!j(jq`(jq'r(jq~P!8dO!Y(dO!j(iq~O!P%eO![%fO#f6dO'{%dO~O!['ZO%c6gO~Oj6jO!['ZO%c6gO~O#g'baP'baZ'ba`'ban'ba}'ba!h'ba!i'ba!k'ba!o'ba#j'ba#k'ba#l'ba#m'ba#n'ba#o'ba#p'ba#q'ba#r'ba#t'ba#v'ba#x'ba#y'ba'r'ba(X'ba(h'ba!j'ba!V'ba'p'bar'ba!['ba%c'ba!d'ba~P%)_O#g'daP'daZ'da`'dan'da}'da!h'da!i'da!k'da!o'da#j'da#k'da#l'da#m'da#n'da#o'da#p'da#q'da#r'da#t'da#v'da#x'da#y'da'r'da(X'da(h'da!j'da!V'da'p'dar'da!['da%c'da!d'da~P%*QO#g$wiP$wiZ$wi`$win$wi}$wi!Y$wi!h$wi!i$wi!k$wi!o$wi#j$wi#k$wi#l$wi#m$wi#n$wi#o$wi#p$wi#q$wi#r$wi#t$wi#v$wi#x$wi#y$wi'r$wi(X$wi(h$wi!j$wi!V$wi'p$wi#[$wir$wi![$wi%c$wi!d$wi~P#-]O#g%ZiP%ZiZ%Zi`%Zin%Zi}%Zi!h%Zi!i%Zi!k%Zi!o%Zi#j%Zi#k%Zi#l%Zi#m%Zi#n%Zi#o%Zi#p%Zi#q%Zi#r%Zi#t%Zi#v%Zi#x%Zi#y%Zi'r%Zi(X%Zi(h%Zi!j%Zi!V%Zi'p%Zir%Zi![%Zi%c%Zi!d%Zi~P%-dO#g%]iP%]iZ%]i`%]in%]i}%]i!h%]i!i%]i!k%]i!o%]i#j%]i#k%]i#l%]i#m%]i#n%]i#o%]i#p%]i#q%]i#r%]i#t%]i#v%]i#x%]i#y%]i'r%]i(X%]i(h%]i!j%]i!V%]i'p%]ir%]i![%]i%c%]i!d%]i~P%.VOf'Ra!Y'Ra~P!0}O!Y'Sa!j'Sa~P!8dO!Y.lO!j(ci~O#|#_i!Y#_i!Z#_i~P#CvOP$]O|#yO}#zO!P#{O!i#wO!k#xO!o$]O(XVOZ#iin#ii!h#ii#k#ii#l#ii#m#ii#n#ii#o#ii#p#ii#q#ii#r#ii#t#ii#v#ii#x#ii#y#ii#|#ii(h#ii(o#ii(p#ii!Y#ii!Z#ii~O#j#ii~P%FhO#j:lO~P%FhOP$]O|#yO}#zO!P#{O!i#wO!k#xO!o$]O#j:lO#k:mO#l:mO#m:mO(XVOZ#ii!h#ii#n#ii#o#ii#p#ii#q#ii#r#ii#t#ii#v#ii#x#ii#y#ii#|#ii(h#ii(o#ii(p#ii!Y#ii!Z#ii~On#ii~P%HsOn:nO~P%HsOP$]On:nO|#yO}#zO!P#{O!i#wO!k#xO!o$]O#j:lO#k:mO#l:mO#m:mO#n:oO(XVO#t#ii#v#ii#x#ii#y#ii#|#ii(h#ii(o#ii(p#ii!Y#ii!Z#ii~OZ#ii!h#ii#o#ii#p#ii#q#ii#r#ii~P%KOOZ:zO!h:pO#o:pO#p:pO#q:yO#r:pO~P%KOOP$]OZ:zOn:nO|#yO}#zO!P#{O!h:pO!i#wO!k#xO!o$]O#j:lO#k:mO#l:mO#m:mO#n:oO#o:pO#p:pO#q:yO#r:pO#t:qO(XVO#v#ii#x#ii#y#ii#|#ii(h#ii(p#ii!Y#ii!Z#ii~O(o#ii~P%MjO(o#|O~P%MjOP$]OZ:zOn:nO|#yO}#zO!P#{O!h:pO!i#wO!k#xO!o$]O#j:lO#k:mO#l:mO#m:mO#n:oO#o:pO#p:pO#q:yO#r:pO#t:qO#v:sO(XVO(o#|O#x#ii#y#ii#|#ii(h#ii!Y#ii!Z#ii~O(p#ii~P& uO(p#}O~P& uOP$]OZ:zOn:nO|#yO}#zO!P#{O!h:pO!i#wO!k#xO!o$]O#j:lO#k:mO#l:mO#m:mO#n:oO#o:pO#p:pO#q:yO#r:pO#t:qO#v:sO#x:uO(XVO(o#|O(p#}O~O#y#ii#|#ii(h#ii!Y#ii!Z#ii~P&$QO`#zy!Y#zy'r#zy'p#zy!V#zy!j#zyr#zy![#zy%c#zy!d#zy~P!8dOj<gO|)zO!P){O(o$}O(p%PO~OP#iiZ#iin#ii}#ii!h#ii!i#ii!k#ii!o#ii#j#ii#k#ii#l#ii#m#ii#n#ii#o#ii#p#ii#q#ii#r#ii#t#ii#v#ii#x#ii#y#ii#|#ii(X#ii(h#ii!Y#ii!Z#ii~P&&xO!i#wOP(WXZ(WXj(WXn(WX|(WX}(WX!P(WX!h(WX!k(WX!o(WX#j(WX#k(WX#l(WX#m(WX#n(WX#o(WX#p(WX#q(WX#r(WX#t(WX#v(WX#x(WX#y(WX#|(WX(X(WX(h(WX(o(WX(p(WX!Y(WX!Z(WX~O#|#}i!Y#}i!Z#}i~P#CvO#|!qi!Z!qi~P$'jO!Z6|O~O!Y']a!Z']a~P#CvO!d#uO(h'kO!Y'^a!j'^a~O!Y/cO!j(ui~O!Y/cO!d#uO!j(ui~Of$wq!Y$wq#[$wq#|$wq~P!0}O!V'`a!Y'`a~P#-]O!d7TO~O!Y/kO!V(vi~P#-]O!Y/kO!V(vi~O!V7XO~O!d#uO#r7^O~On7_O!d#uO(h'kO~O|)zO!P){O(p%POj'ca(o'ca!Y'ca#['ca~Of'ca#|'ca~P&.YO|)zO!P){Oj'ea(o'ea(p'ea!Y'ea#['ea~Of'ea#|'ea~P&.{O!V7aO~Of$yq!Y$yq#[$yq#|$yq~P!0}O`$ky!Y$ky'r$ky'p$ky!V$ky!j$kyr$ky![$ky%c$ky!d$ky~P!8dO!d6RO~O!Y4nO![(wa~O`#_y!Y#_y'r#_y'p#_y!V#_y!j#_yr#_y![#_y%c#_y!d#_y~P!8dOZ7fO~Oa7hO'{+hO'}TO(QUO~O!Y0rO!Z)Oi~O_7lO~O([(xO!Y'iX!Z'iX~O!Y5UO!Z({a~OlkO'{7sO~P.iO!Z7vO~P%3hOo!nO!P7wO'}TO(QUO([!mO(g!sO~O![1[O~O![1[O%c7yO~Oj7|O![1[O%c7yO~OZ8RO!Y'la!Z'la~O!Y1gO!Z(|i~O!j8VO~O!j8WO~O!j8ZO~O!j8ZO~P%[O`8]O~O!d8^O~O!j8_O~O!Y(mi!Z(mi~P#CvO`%kO#[8gO'r%kO~O!Y(jy!j(jy`(jy'r(jy~P!8dO!Y(dO!j(iy~O!['ZO%c8jO~O#g$wqP$wqZ$wq`$wqn$wq}$wq!Y$wq!h$wq!i$wq!k$wq!o$wq#j$wq#k$wq#l$wq#m$wq#n$wq#o$wq#p$wq#q$wq#r$wq#t$wq#v$wq#x$wq#y$wq'r$wq(X$wq(h$wq!j$wq!V$wq'p$wq#[$wqr$wq![$wq%c$wq!d$wq~P#-]O#g'caP'caZ'ca`'can'ca}'ca!h'ca!i'ca!k'ca!o'ca#j'ca#k'ca#l'ca#m'ca#n'ca#o'ca#p'ca#q'ca#r'ca#t'ca#v'ca#x'ca#y'ca'r'ca(X'ca(h'ca!j'ca!V'ca'p'car'ca!['ca%c'ca!d'ca~P&.YO#g'eaP'eaZ'ea`'ean'ea}'ea!h'ea!i'ea!k'ea!o'ea#j'ea#k'ea#l'ea#m'ea#n'ea#o'ea#p'ea#q'ea#r'ea#t'ea#v'ea#x'ea#y'ea'r'ea(X'ea(h'ea!j'ea!V'ea'p'ear'ea!['ea%c'ea!d'ea~P&.{O#g$yqP$yqZ$yq`$yqn$yq}$yq!Y$yq!h$yq!i$yq!k$yq!o$yq#j$yq#k$yq#l$yq#m$yq#n$yq#o$yq#p$yq#q$yq#r$yq#t$yq#v$yq#x$yq#y$yq'r$yq(X$yq(h$yq!j$yq!V$yq'p$yq#[$yqr$yq![$yq%c$yq!d$yq~P#-]O!Y'Si!j'Si~P!8dO#|#_q!Y#_q!Z#_q~P#CvO(o$}OP%ZaZ%Zan%Za}%Za!h%Za!i%Za!k%Za!o%Za#j%Za#k%Za#l%Za#m%Za#n%Za#o%Za#p%Za#q%Za#r%Za#t%Za#v%Za#x%Za#y%Za#|%Za(X%Za(h%Za!Y%Za!Z%Za~Oj%Za|%Za!P%Za(p%Za~P&@bO(p%POP%]aZ%]an%]a}%]a!h%]a!i%]a!k%]a!o%]a#j%]a#k%]a#l%]a#m%]a#n%]a#o%]a#p%]a#q%]a#r%]a#t%]a#v%]a#x%]a#y%]a#|%]a(X%]a(h%]a!Y%]a!Z%]a~Oj%]a|%]a!P%]a(o%]a~P&BiOj<gO|)zO!P){O(p%PO~P&@bOj<gO|)zO!P){O(o$}O~P&BiO|0ZO}0ZO!P0[OPyaZyajyanya!hya!iya!kya!oya#jya#kya#lya#mya#nya#oya#pya#qya#rya#tya#vya#xya#yya#|ya(Xya(hya(oya(pya!Yya!Zya~O|)zO!P){OP$naZ$naj$nan$na}$na!h$na!i$na!k$na!o$na#j$na#k$na#l$na#m$na#n$na#o$na#p$na#q$na#r$na#t$na#v$na#x$na#y$na#|$na(X$na(h$na(o$na(p$na!Y$na!Z$na~O|)zO!P){OP$paZ$paj$pan$pa}$pa!h$pa!i$pa!k$pa!o$pa#j$pa#k$pa#l$pa#m$pa#n$pa#o$pa#p$pa#q$pa#r$pa#t$pa#v$pa#x$pa#y$pa#|$pa(X$pa(h$pa(o$pa(p$pa!Y$pa!Z$pa~OP%OaZ%Oan%Oa}%Oa!h%Oa!i%Oa!k%Oa!o%Oa#j%Oa#k%Oa#l%Oa#m%Oa#n%Oa#o%Oa#p%Oa#q%Oa#r%Oa#t%Oa#v%Oa#x%Oa#y%Oa#|%Oa(X%Oa(h%Oa!Y%Oa!Z%Oa~P&&xO#|$jq!Y$jq!Z$jq~P#CvO#|$kq!Y$kq!Z$kq~P#CvO!Z8vO~O#|8wO~P!0}O!d#uO!Y'^i!j'^i~O!d#uO(h'kO!Y'^i!j'^i~O!Y/cO!j(uq~O!V'`i!Y'`i~P#-]O!Y/kO!V(vq~O!V8}O~P#-]O!V8}O~Of(Vy!Y(Vy~P!0}O!Y'ga!['ga~P#-]O`%Vq![%Vq'r%Vq!Y%Vq~P#-]OZ9SO~O!Y0rO!Z)Oq~O#[9WO!Y'ia!Z'ia~O!Y5UO!Z({i~P#CvOP[XZ[Xn[X|[X}[X!P[X!V[X!Y[X!h[X!i[X!k[X!o[X#[[X#geX#j[X#k[X#l[X#m[X#n[X#o[X#p[X#q[X#r[X#t[X#v[X#x[X#y[X$O[X(X[X(h[X(o[X(p[X~O!d%TX#r%TX~P'#SO![1[O%c9[O~O'}TO(QUO([9aO~O!Y1gO!Z(|q~O!j9dO~O!j9eO~O!j9fO~O!j9fO~P%[O#[9iO!Y#dy!Z#dy~O!Y#dy!Z#dy~P#CvO!['ZO%c9nO~O#|#zy!Y#zy!Z#zy~P#CvOP$wiZ$win$wi}$wi!h$wi!i$wi!k$wi!o$wi#j$wi#k$wi#l$wi#m$wi#n$wi#o$wi#p$wi#q$wi#r$wi#t$wi#v$wi#x$wi#y$wi#|$wi(X$wi(h$wi!Y$wi!Z$wi~P&&xO|)zO!P){O(p%POP'baZ'baj'ban'ba}'ba!h'ba!i'ba!k'ba!o'ba#j'ba#k'ba#l'ba#m'ba#n'ba#o'ba#p'ba#q'ba#r'ba#t'ba#v'ba#x'ba#y'ba#|'ba(X'ba(h'ba(o'ba!Y'ba!Z'ba~O|)zO!P){OP'daZ'daj'dan'da}'da!h'da!i'da!k'da!o'da#j'da#k'da#l'da#m'da#n'da#o'da#p'da#q'da#r'da#t'da#v'da#x'da#y'da#|'da(X'da(h'da(o'da(p'da!Y'da!Z'da~O(o$}OP%ZiZ%Zij%Zin%Zi|%Zi}%Zi!P%Zi!h%Zi!i%Zi!k%Zi!o%Zi#j%Zi#k%Zi#l%Zi#m%Zi#n%Zi#o%Zi#p%Zi#q%Zi#r%Zi#t%Zi#v%Zi#x%Zi#y%Zi#|%Zi(X%Zi(h%Zi(p%Zi!Y%Zi!Z%Zi~O(p%POP%]iZ%]ij%]in%]i|%]i}%]i!P%]i!h%]i!i%]i!k%]i!o%]i#j%]i#k%]i#l%]i#m%]i#n%]i#o%]i#p%]i#q%]i#r%]i#t%]i#v%]i#x%]i#y%]i#|%]i(X%]i(h%]i(o%]i!Y%]i!Z%]i~O#|$ky!Y$ky!Z$ky~P#CvO#|#_y!Y#_y!Z#_y~P#CvO!d#uO!Y'^q!j'^q~O!Y/cO!j(uy~O!V'`q!Y'`q~P#-]O!V9wO~P#-]O!Y0rO!Z)Oy~O!Y5UO!Z({q~O![1[O%c:OO~O!j:RO~O!['ZO%c:WO~OP$wqZ$wqn$wq}$wq!h$wq!i$wq!k$wq!o$wq#j$wq#k$wq#l$wq#m$wq#n$wq#o$wq#p$wq#q$wq#r$wq#t$wq#v$wq#x$wq#y$wq#|$wq(X$wq(h$wq!Y$wq!Z$wq~P&&xO|)zO!P){O(p%POP'caZ'caj'can'ca}'ca!h'ca!i'ca!k'ca!o'ca#j'ca#k'ca#l'ca#m'ca#n'ca#o'ca#p'ca#q'ca#r'ca#t'ca#v'ca#x'ca#y'ca#|'ca(X'ca(h'ca(o'ca!Y'ca!Z'ca~O|)zO!P){OP'eaZ'eaj'ean'ea}'ea!h'ea!i'ea!k'ea!o'ea#j'ea#k'ea#l'ea#m'ea#n'ea#o'ea#p'ea#q'ea#r'ea#t'ea#v'ea#x'ea#y'ea#|'ea(X'ea(h'ea(o'ea(p'ea!Y'ea!Z'ea~OP$yqZ$yqn$yq}$yq!h$yq!i$yq!k$yq!o$yq#j$yq#k$yq#l$yq#m$yq#n$yq#o$yq#p$yq#q$yq#r$yq#t$yq#v$yq#x$yq#y$yq#|$yq(X$yq(h$yq!Y$yq!Z$yq~P&&xOf%_!Z!Y%_!Z#[%_!Z#|%_!Z~P!0}O!Y'iq!Z'iq~P#CvO!Y#d!Z!Z#d!Z~P#CvO#g%_!ZP%_!ZZ%_!Z`%_!Zn%_!Z}%_!Z!Y%_!Z!h%_!Z!i%_!Z!k%_!Z!o%_!Z#j%_!Z#k%_!Z#l%_!Z#m%_!Z#n%_!Z#o%_!Z#p%_!Z#q%_!Z#r%_!Z#t%_!Z#v%_!Z#x%_!Z#y%_!Z'r%_!Z(X%_!Z(h%_!Z!j%_!Z!V%_!Z'p%_!Z#[%_!Zr%_!Z![%_!Z%c%_!Z!d%_!Z~P#-]OP%_!ZZ%_!Zn%_!Z}%_!Z!h%_!Z!i%_!Z!k%_!Z!o%_!Z#j%_!Z#k%_!Z#l%_!Z#m%_!Z#n%_!Z#o%_!Z#p%_!Z#q%_!Z#r%_!Z#t%_!Z#v%_!Z#x%_!Z#y%_!Z#|%_!Z(X%_!Z(h%_!Z!Y%_!Z!Z%_!Z~P&&xOr(]X~P1qO'|!lO~P!*fO!VeX!YeX#[eX~P'#SOP[XZ[Xn[X|[X}[X!P[X!Y[X!YeX!h[X!i[X!k[X!o[X#[[X#[eX#geX#j[X#k[X#l[X#m[X#n[X#o[X#p[X#q[X#r[X#t[X#v[X#x[X#y[X$O[X(X[X(h[X(o[X(p[X~O!deX!j[X!jeX(heX~P'@vOP:cOQ:cORfOc<[Od!iOlkOn:cOokOpkOvkOx:cOz:cO!PWO!TkO!UkO![XO!f:fO!kZO!n:cO!o:cO!p:cO!r:gO!t:jO!w!hO$T!kO'{)YO'}TO(QUO(XVO(g[O(t<YO~O!Y:wO!Z$ma~Og%VOl%WOn$tOo$sOp$sOv%XOx%YOz;RO!P${O![$|O!f<aO!k$xO#f;XO$T%^O$o;TO$q;VO$t%_O'{(pO'}TO(QUO(X$uO(o$}O(p%PO~O#s)aO~P'ElO!Z[X!ZeX~P'@vO#g:kO~O!d#uO#g:kO~O#[:{O~O#r:pO~O#[;ZO!Y(mX!Z(mX~O#[:{O!Y(kX!Z(kX~O#g;[O~Of;^O~P!0}O#g;cO~O#g;dO~O!d#uO#g;eO~O!d#uO#g;[O~O#|;fO~P#CvO#g;gO~O#g;hO~O#g;mO~O#g;nO~O#g;oO~O#g;pO~O#|;qO~P!0}O#|;rO~P!0}O!i#P#Q#S#T#W#e#f#q(t$o$q$t%W%b%c%d%k%m%p%q%s%u~'vS#k!U't'|#lo#j#mn|'u$Y'u'{$[([~","goto":"$2p)SPPPPP)TPP)WP)iP*x.|PPPP5pPP6WPP<S?gP?zP?zPPP?zPAxP?zP?zP?zPA|PPBRPBlPGdPPPGhPPPPGhJiPPPJoKjPGhPMxPPPP!!WGhPPPGhPGhP!$fGhP!'z!(|!)VP!)y!)}!)yPPPPP!-Y!(|PP!-v!.pP!1dGhGh!1i!4s!9Y!9Y!=OPPP!=VGhPPPPPPPPPPP!@dP!AuPPGh!CSPGhPGhGhGhGhPGh!DfP!GnP!JrP!Jv!KQ!KU!KUP!GkP!KY!KYP!N^P!NbGhGh!Nh##k?zP?zP?z?zP#$v?z?z#'O?z#)k?z#+m?z?z#,[#.f#.f#.j#.r#.f#.zP#.fP?z#/d?z#3R?z?z5pPPP#6vPPP#7a#7aP#7aP#7w#7aPP#7}P#7tP#7t#8b#7t#8|#9S5m)W#9V)WP#9^#9^#9^P)WP)WP)WP)WPP)WP#9d#9gP#9g)WP#9kP#9nP)WP)WP)WP)WP)WP)W)WPP#9t#9z#:V#:]#:c#:i#:o#:}#;T#;Z#;e#;k#;u#<U#<[#<|#=`#=f#=l#=z#>a#@O#@^#@d#Ax#BW#Cr#DQ#DW#D^#Dd#Dn#Dt#Dz#EU#Eh#EnPPPPPPPPPP#EtPPPPPPP#Fi#Ip#KP#KW#K`PPPP$!d$%Z$+r$+u$+x$,q$,t$,w$-O$-WPP$-^$-b$.Y$/X$/]$/qPP$/u$/{$0PP$0S$0W$0Z$1P$1h$2P$2T$2W$2Z$2a$2d$2h$2lR!{RoqOXst!Z#c%j&m&o&p&r,h,m1w1zY!uQ'Z-Y1[5]Q%pvQ%xyQ&P|Q&e!VS'R!e-QQ'a!iS'g!r!xS*c$|*hQ+f%yQ+s&RQ,X&_Q-W'YQ-b'bQ-j'hQ/|*jQ1f,YR;Y:g%OdOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$a$e%j%p%}&f&i&m&o&p&r&v'O']'m'}(P(V(^(r(v(z)y+O+S,e,h,m-^-f-t-z.l.s0[0a0q1_1o1p1r1t1w1z1|2m2s3Z5Y5d5t5u5x6]7w7|8]8gS#p]:d!r)[$[$m'S)n,y,|.{2]3p5W6S9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]Q*u%ZQ+k%{Q,Z&bQ,b&jQ.c;QQ0h+^Q0l+`Q0w+lQ1n,`Q2{.[Q4v0rQ5k1gQ6i3PQ6u;RQ7h4wR8m6j&|kOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$[$a$e$m%j%p%}&f&i&j&m&o&p&r&v'O'S']'m'}(P(V(^(r(v(z)n)y+O+S+^,e,h,m,y,|-^-f-t-z.[.l.s.{0[0a0q1_1o1p1r1t1w1z1|2]2m2s3P3Z3p5W5Y5d5t5u5x6S6]6j7w7|8]8g9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]t!nQ!r!u!x!y'R'Y'Z'g'h'i-Q-W-Y-j1[5]5_$v$si#u#w$c$d$x${%O%Q%[%]%a)u){)}*P*R*Y*`*p*q+]+`+w+z.Z.i/Z/j/k/m0Q0S0^1R1U1^3O3x4S4[4f4n4p5c6g7T7^7y8j8w9[9n:O:W:y:z:|:};O;P;S;T;U;V;W;X;_;`;a;b;c;d;g;h;i;j;k;l;m;n;q;r<Y<b<c<f<gQ&S|Q'P!eS'V%f-TQ+k%{Q,Z&bQ0]*yQ0w+lQ0|+rQ1m,_Q1n,`Q4v0rQ5P1OQ5k1gQ5n1iQ5o1lQ7h4wQ7k4|Q8U5qQ9V7lR9b8RrnOXst!V!Z#c%j&d&m&o&p&r,h,m1w1zR,]&f&v^OPXYstuvwz!Z!`!g!j!o#R#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$[$a$e$m%j%p%}&f&i&j&m&o&p&r&v'O']'m(P(V(^(r(v(z)n)y+O+S+^,e,h,m,y,|-^-f-t-z.[.l.s.{0[0a0q1_1o1p1r1t1w1z1|2]2m2s3P3Z3p5W5Y5d5t5u5x6S6]6j7w7|8]8g9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<[<][#[WZ#V#Y'S'}!S%gm#g#h#k%b%e(W(b(c(d+Q+R+T,d,z-x.O.P.Q.S2P2w2x6R6dQ%sxQ%wyS%||&RQ&Y!TQ'^!hQ'`!iQ(k#rS*V$x*ZS+e%x%yQ+i%{Q,S&]Q,W&_S-a'a'bQ.^(lQ/g*WQ0p+fQ0v+lQ0x+mQ0{+qQ1a,TS1e,X,YQ2i-bQ3y/cQ4u0rQ4y0uQ5O0}Q5j1fQ7Q3zQ7g4wQ7j4{Q9R7fR9y9S!O$zi#w%O%Q%[%]%a)}*P*Y*p*q.i/j0Q0S0^3x4f8w<Y<b<c!S%uy!i!t%w%x%y'Q'`'a'b'f'p*b+e+f,}-a-b-i/t0p2b2i2p4^Q+_%sQ+x&VQ+{&WQ,V&_Q.](kQ1`,SU1d,W,X,YQ3Q.^Q5e1aS5i1e1fQ8Q5j#W<^#u$c$d$x${)u){*R*`+]+`+w+z.Z/Z/k/m1R1U1^3O4S4[4n4p5c6g7T7^7y8j9[9n:O:W:|;O;S;U;W;_;a;c;g;i;k;m;q<f<go<_:y:z:};P;T;V;X;`;b;d;h;j;l;n;rW%Ti%V*r<YS&V!Q&dQ&W!RQ&X!SR+v&T$w%Si#u#w$c$d$x${%O%Q%[%]%a)u){)}*P*R*Y*`*p*q+]+`+w+z.Z.i/Z/j/k/m0Q0S0^1R1U1^3O3x4S4[4f4n4p5c6g7T7^7y8j8w9[9n:O:W:y:z:|:};O;P;S;T;U;V;W;X;_;`;a;b;c;d;g;h;i;j;k;l;m;n;q;r<Y<b<c<f<gT)v$u)wV*v%Z;Q;RU'V!e%f-TS(y#y#zQ+p&OS.V(g(hQ1V+|Q4g0ZR7p5U&|kOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$[$a$e$m%j%p%}&f&i&j&m&o&p&r&v'O'S']'m'}(P(V(^(r(v(z)n)y+O+S+^,e,h,m,y,|-^-f-t-z.[.l.s.{0[0a0q1_1o1p1r1t1w1z1|2]2m2s3P3Z3p5W5Y5d5t5u5x6S6]6j7w7|8]8g9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]$i$`c#X#d%n%o%q'|(S(n(u(})O)P)Q)R)S)T)U)V)W)X)Z)^)b)l+Z+o-O-m-r-w-y.h.n.r.t.u.v/V0_2W2Z2k2r3Y3_3`3a3b3c3d3e3f3g3h3i3j3k3n3o3t4k4s6U6[6a6o6p6y6z7r8a8e8n8t8u9k9{:S:e<PT#SV#T&}kOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$[$a$e$m%j%p%}&f&i&j&m&o&p&r&v'O'S']'m'}(P(V(^(r(v(z)n)y+O+S+^,e,h,m,y,|-^-f-t-z.[.l.s.{0[0a0q1_1o1p1r1t1w1z1|2]2m2s3P3Z3p5W5Y5d5t5u5x6S6]6j7w7|8]8g9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]Q'T!eR2^-Qv!nQ!e!r!u!x!y'R'Y'Z'g'h'i-Q-W-Y-j1[5]5_S*b$|*hS/t*c*jQ/}*kQ1X,OQ4^/|R4a0PnqOXst!Z#c%j&m&o&p&r,h,m1w1zQ&t!^Q'q!wS(m#t:kQ+c%vQ,Q&YQ,R&[Q-_'_Q-l'jS.g(r;[S0`+O;eQ0n+dQ1Z,PQ2O,oQ2Q,pQ2Y,{Q2g-`Q2j-dS4l0a;oQ4q0oS4t0q;pQ6T2[Q6X2hQ6^2oQ7e4rQ8b6VQ8c6YQ8f6_R9h8_$d$_c#X#d%o%q'|(S(n(u(})O)P)Q)R)S)T)U)V)W)X)Z)^)b)l+Z+o-O-m-r-w-y.h.n.r.u.v/V0_2W2Z2k2r3Y3_3`3a3b3c3d3e3f3g3h3i3j3k3n3o3t4k4s6U6[6a6o6p6y6z7r8a8e8n8t8u9k9{:S:e<PS(j#o'dU*o%R(q3mS+Y%n.tQ2|0hQ6f2{Q8l6iR9o8m$d$^c#X#d%o%q'|(S(n(u(})O)P)Q)R)S)T)U)V)W)X)Z)^)b)l+Z+o-O-m-r-w-y.h.n.r.u.v/V0_2W2Z2k2r3Y3_3`3a3b3c3d3e3f3g3h3i3j3k3n3o3t4k4s6U6[6a6o6p6y6z7r8a8e8n8t8u9k9{:S:e<PS(i#o'dS({#z$_S+X%n.tS.W(h(jQ.w)]Q0e+YR2y.X&|kOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$[$a$e$m%j%p%}&f&i&j&m&o&p&r&v'O'S']'m'}(P(V(^(r(v(z)n)y+O+S+^,e,h,m,y,|-^-f-t-z.[.l.s.{0[0a0q1_1o1p1r1t1w1z1|2]2m2s3P3Z3p5W5Y5d5t5u5x6S6]6j7w7|8]8g9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]S#p]:dQ&o!XQ&p!YQ&r![Q&s!]R1v,kQ'[!hQ+[%sQ-]'^S.Y(k+_Q2e-[W2}.].^0g0iQ6W2fU6e2z2|3QS8i6f6hS9m8k8lS:U9l9oQ:^:VR:a:_U!vQ'Z-YT5Z1[5]!Q_OXZ`st!V!Z#c#g%b%j&d&f&m&o&p&r(d,h,m.P1w1z]!pQ!r'Z-Y1[5]T#p]:d%Y{OPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$a$e%j%p%}&f&i&j&m&o&p&r&v'O']'m'}(P(V(^(r(v(z)y+O+S+^,e,h,m-^-f-t-z.[.l.s0[0a0q1_1o1p1r1t1w1z1|2m2s3P3Z5Y5d5t5u5x6]6j7w7|8]8gS(y#y#zS.V(g(h!s;v$[$m'S)n,y,|.{2]3p5W6S9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]Y!tQ'Z-Y1[5]Q'f!rS'p!u!xS'r!y5_S-i'g'hQ-k'iR2p-jQ'o!tS(`#f1qS-h'f'rQ/f*VQ/r*bQ2q-kQ4O/gS4X/s/}Q7P3yS7[4_4aQ8y7QR9Q7_Q#vbQ'n!tS(_#f1qS(a#l*}Q+P%cQ+a%tQ+g%zU-g'f'o'rQ-{(`Q/e*VQ/q*bQ/w*eQ0m+bQ1b,US2n-h-kQ2v.TS3}/f/gS4W/r/}Q4Z/vQ4]/xQ5g1cQ6`2qQ7O3yQ7S4OS7W4X4aQ7]4`Q8O5hS8x7P7QQ8|7XQ9O7[Q9_8PQ9u8yQ9v8}Q9x9QQ:Q9`Q:Y9wQ;y;tQ<U;}R<V<OV!vQ'Z-Y%YaOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$a$e%j%p%}&f&i&j&m&o&p&r&v'O']'m'}(P(V(^(r(v(z)y+O+S+^,e,h,m-^-f-t-z.[.l.s0[0a0q1_1o1p1r1t1w1z1|2m2s3P3Z5Y5d5t5u5x6]6j7w7|8]8gS#vz!j!r;s$[$m'S)n,y,|.{2]3p5W6S9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]R;y<[%YbOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$a$e%j%p%}&f&i&j&m&o&p&r&v'O']'m'}(P(V(^(r(v(z)y+O+S+^,e,h,m-^-f-t-z.[.l.s0[0a0q1_1o1p1r1t1w1z1|2m2s3P3Z5Y5d5t5u5x6]6j7w7|8]8gQ%cj!S%ty!i!t%w%x%y'Q'`'a'b'f'p*b+e+f,}-a-b-i/t0p2b2i2p4^S%zz!jQ+b%uQ,U&_W1c,V,W,X,YU5h1d1e1fS8P5i5jQ9`8Q!r;t$[$m'S)n,y,|.{2]3p5W6S9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]Q;}<ZR<O<[$|eOPXYstuvw!Z!`!g!o#R#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$a$e%j%p%}&f&i&m&o&p&r&v'O']'m(P(V(^(r(v(z)y+O+S+^,e,h,m-^-f-t-z.[.l.s0[0a0q1_1o1p1r1t1w1z1|2m2s3P3Z5Y5d5t5u5x6]6j7w7|8]8gY#aWZ#V#Y'}!S%gm#g#h#k%b%e(W(b(c(d+Q+R+T,d,z-x.O.P.Q.S2P2w2x6R6dQ,c&j!p;u$[$m)n,y,|.{2]3p5W6S9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]R;x'SS'W!e%fR2`-T%OdOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$a$e%j%p%}&f&i&m&o&p&r&v'O']'m'}(P(V(^(r(v(z)y+O+S,e,h,m-^-f-t-z.l.s0[0a0q1_1o1p1r1t1w1z1|2m2s3Z5Y5d5t5u5x6]7w7|8]8g!r)[$[$m'S)n,y,|.{2]3p5W6S9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]Q,b&jQ0h+^Q2{.[Q6i3PR8m6j!f$Uc#X%n'|(S(n(u)U)V)W)X)^)b+o-m-r-w-y.h.n/V0_2k2r3Y3k4k4s6[6a6o8e9k:e!T:r)Z)l-O.t2W2Z3_3g3h3i3j3n3t6U6p6y6z7r8a8n8t8u9{:S<P!b$Wc#X%n'|(S(n(u)W)X)^)b+o-m-r-w-y.h.n/V0_2k2r3Y3k4k4s6[6a6o8e9k:e!P:t)Z)l-O.t2W2Z3_3i3j3n3t6U6p6y6z7r8a8n8t8u9{:S<P!^$[c#X%n'|(S(n(u)^)b+o-m-r-w-y.h.n/V0_2k2r3Y3k4k4s6[6a6o8e9k:eQ3x/az<])Z)l-O.t2W2Z3_3n3t6U6p6y6z7r8a8n8t8u9{:S<PQ<b<dR<c<e&|kOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$[$a$e$m%j%p%}&f&i&j&m&o&p&r&v'O'S']'m'}(P(V(^(r(v(z)n)y+O+S+^,e,h,m,y,|-^-f-t-z.[.l.s.{0[0a0q1_1o1p1r1t1w1z1|2]2m2s3P3Z3p5W5Y5d5t5u5x6S6]6j7w7|8]8g9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]S$nh$oR3q.z'TgOPWXYZhstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$[$a$e$m$o%j%p%}&f&i&j&m&o&p&r&v'O'S']'m'}(P(V(^(r(v(z)n)y+O+S+^,e,h,m,y,|-^-f-t-z.[.l.s.z.{0[0a0q1_1o1p1r1t1w1z1|2]2m2s3P3Z3p5W5Y5d5t5u5x6S6]6j7w7|8]8g9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]T$jf$pQ$hfS)e$k)iR)q$pT$if$pT)g$k)i'ThOPWXYZhstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$[$a$e$m$o%j%p%}&f&i&j&m&o&p&r&v'O'S']'m'}(P(V(^(r(v(z)n)y+O+S+^,e,h,m,y,|-^-f-t-z.[.l.s.z.{0[0a0q1_1o1p1r1t1w1z1|2]2m2s3P3Z3p5W5Y5d5t5u5x6S6]6j7w7|8]8g9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]T$nh$oQ$qhR)p$o%YjOPWXYZstuvw!Z!`!g!o#R#V#Y#c#n#t#x#{$O$P$Q$R$S$T$U$V$W$X$Y$a$e%j%p%}&f&i&j&m&o&p&r&v'O']'m'}(P(V(^(r(v(z)y+O+S+^,e,h,m-^-f-t-z.[.l.s0[0a0q1_1o1p1r1t1w1z1|2m2s3P3Z5Y5d5t5u5x6]6j7w7|8]8g!s<Z$[$m'S)n,y,|.{2]3p5W6S9W9i:c:f:g:j:k:l:m:n:o:p:q:r:s:t:u:v:w:{;Y;Z;[;^;e;f;o;p<]#clOPXZst!Z!`!o#R#c#n#{$m%j&f&i&j&m&o&p&r&v'O'](z)n+S+^,e,h,m-^.[.{0[1_1o1p1r1t1w1z1|3P3p5Y5d5t5u5x6j7w7|8]!O%Ri#w%O%Q%[%]%a)}*P*Y*p*q.i/j0Q0S0^3x4f8w<Y<b<c#W(q#u$c$d$x${)u){*R*`+]+`+w+z.Z/Z/k/m1R1U1^3O4S4[4n4p5c6g7T7^7y8j9[9n:O:W:|;O;S;U;W;_;a;c;g;i;k;m;q<f<gQ*z%_Q/W)zo3m:y:z:};P;T;V;X;`;b;d;h;j;l;n;r!O$yi#w%O%Q%[%]%a)}*P*Y*p*q.i/j0Q0S0^3x4f8w<Y<b<cQ*[$zS*e$|*hQ*{%`Q/x*f#W;{#u$c$d$x${)u){*R*`+]+`+w+z.Z/Z/k/m1R1U1^3O4S4[4n4p5c6g7T7^7y8j9[9n:O:W:|;O;S;U;W;_;a;c;g;i;k;m;q<f<gn;|:y:z:};P;T;V;X;`;b;d;h;j;l;n;rQ<Q<^Q<R<_Q<S<`R<T<a!O%Ri#w%O%Q%[%]%a)}*P*Y*p*q.i/j0Q0S0^3x4f8w<Y<b<c#W(q#u$c$d$x${)u){*R*`+]+`+w+z.Z/Z/k/m1R1U1^3O4S4[4n4p5c6g7T7^7y8j9[9n:O:W:|;O;S;U;W;_;a;c;g;i;k;m;q<f<go3m:y:z:};P;T;V;X;`;b;d;h;j;l;n;rnoOXst!Z#c%j&m&o&p&r,h,m1w1zQ*_${Q,v&yQ,w&{R4R/k$v%Si#u#w$c$d$x${%O%Q%[%]%a)u){)}*P*R*Y*`*p*q+]+`+w+z.Z.i/Z/j/k/m0Q0S0^1R1U1^3O3x4S4[4f4n4p5c6g7T7^7y8j8w9[9n:O:W:y:z:|:};O;P;S;T;U;V;W;X;_;`;a;b;c;d;g;h;i;j;k;l;m;n;q;r<Y<b<c<f<gQ+y&WQ1T+{Q5S1SR7o5TT*g$|*hS*g$|*hT5[1[5]S/v*d5YT4`0O7wQ+a%tQ/w*eQ0m+bQ1b,UQ5g1cQ8O5hQ9_8PR:Q9`!O%Oi#w%O%Q%[%]%a)}*P*Y*p*q.i/j0Q0S0^3x4f8w<Y<b<cr)}$v(s*O*n*|/i0U0V3W4P4j6}7`9t;z<W<XS0Q*m0R#W:|#u$c$d$x${)u){*R*`+]+`+w+z.Z/Z/k/m1R1U1^3O4S4[4n4p5c6g7T7^7y8j9[9n:O:W:|;O;S;U;W;_;a;c;g;i;k;m;q<f<gn:}:y:z:};P;T;V;X;`;b;d;h;j;l;n;r!^;_(o)`*U*^._.b.f/S/X/a/n0f1Q1S3T4Q4U5R5T6k6n7U7Y7b7d8{9P:X<d<e`;`3l6q6t6x8o9p9s:bS;i.a3UT;j6s8r!O%Qi#w%O%Q%[%]%a)}*P*Y*p*q.i/j0Q0S0^3x4f8w<Y<b<cv*P$v(s*Q*m*|/]/i0U0V3W4P4b4j6}7`9t;z<W<XS0S*n0T#W;O#u$c$d$x${)u){*R*`+]+`+w+z.Z/Z/k/m1R1U1^3O4S4[4n4p5c6g7T7^7y8j9[9n:O:W:|;O;S;U;W;_;a;c;g;i;k;m;q<f<gn;P:y:z:};P;T;V;X;`;b;d;h;j;l;n;r!b;a(o)`*U*^.`.a.f/S/X/a/n0f1Q1S3R3T4Q4U5R5T6k6l6n7U7Y7b7d8{9P:X<d<ed;b3l6r6s6x8o8p9p9q9s:bS;k.b3VT;l6t8srnOXst!V!Z#c%j&d&m&o&p&r,h,m1w1zQ&a!UR,e&jrnOXst!V!Z#c%j&d&m&o&p&r,h,m1w1zR&a!UQ+}&XR1P+vsnOXst!V!Z#c%j&d&m&o&p&r,h,m1w1zQ1],SS5b1`1aU7x5`5a5eS9Z7z7{S9|9Y9]Q:Z9}R:`:[Q&h!VR,^&dR5n1iS%||&RR0x+mQ&m!WR,h&nR,n&sT1x,m1zR,r&tQ,q&tR2R,rQ't!zR-n'tSsOtQ#cXT%ms#cQ!}TR'v!}Q#QUR'x#QQ)w$uR/T)wQ#TVR'z#TQ#WWU(Q#W(R-uQ(R#XR-u(SQ-R'TR2_-RQ.j(sR3X.jQ.m(uS3[.m3]R3].nQ-Y'ZR2c-YY!rQ'Z-Y1[5]R'e!rS#^W%eU(X#^(Y-vQ(Y#_R-v(TQ-U'WR2a-Ut`OXst!V!Z#c%j&d&f&m&o&p&r,h,m1w1zS#gZ%bU#q`#g.PR.P(dQ(e#iQ-|(aW.U(e-|2t6bQ2t-}R6b2uQ)i$kR.|)iQ$ohR)o$oQ$bcU)_$b-q:xQ-q:eR:x)lQ/d*VW3{/d3|7R8zU3|/e/f/gS7R3}4OR8z7S$X)|$v(o(s)`*U*^*m*n*w*x*|.a.b.d.e.f/S/X/]/_/a/i/n0U0V0f1Q1S3R3S3T3W3l4P4Q4U4b4d4j5R5T6k6l6m6n6s6t6v6w6x6}7U7Y7`7b7d8o8p8q8{9P9p9q9r9s9t:X:b;z<W<X<d<eQ/l*^U4T/l4V7VQ4V/nR7V4UQ*h$|R/z*hr*O$v(s*m*n*|/i0U0V3W4P4j6}7`9t;z<W<X!^._(o)`*U*^.a.b.f/S/X/a/n0f1Q1S3T4Q4U5R5T6k6n7U7Y7b7d8{9P:X<d<eU/^*O._6qa6q3l6s6t6x8o9p9s:bQ0R*mQ3U.aU4c0R3U8rR8r6sv*Q$v(s*m*n*|/]/i0U0V3W4P4b4j6}7`9t;z<W<X!b.`(o)`*U*^.a.b.f/S/X/a/n0f1Q1S3R3T4Q4U5R5T6k6l6n7U7Y7b7d8{9P:X<d<eU/`*Q.`6re6r3l6s6t6x8o8p9p9q9s:bQ0T*nQ3V.bU4e0T3V8sR8s6tQ*s%UR0X*sQ4o0fR7c4oQ+U%hR0d+UQ5V1VS7q5V9XR9X7rQ,P&YR1Y,PQ5]1[R7u5]Q1h,ZS5l1h8SR8S5nQ0s+iW4x0s4z7i9TQ4z0vQ7i4yR9T7jQ+n%|R0y+nQ1z,mR5|1zYrOXst#cQ&q!ZQ+W%jQ,g&mQ,i&oQ,j&pQ,l&rQ1u,hS1x,m1zR5{1wQ%lpQ&u!_Q&x!aQ&z!bQ&|!cQ'l!tQ+V%iQ+c%vQ+u&SQ,]&hQ,t&wW-e'f'n'o'rQ-l'jQ/y*gQ0n+dS1k,^,aQ2S,sQ2T,vQ2U,wQ2j-dW2l-g-h-k-mQ4q0oQ4}0|Q5Q1QQ5f1bQ5p1mQ5z1vU6Z2k2n2qQ6^2oQ7e4rQ7m5PQ7n5RQ7t5[Q7}5gQ8T5oS8d6[6`Q8f6_Q9U7kQ9^8OQ9c8UQ9j8eQ9z9VQ:P9_Q:T9kR:]:QQ%vyQ'_!iQ'j!tU+d%w%x%yQ,{'QU-`'`'a'bS-d'f'pQ/p*bS0o+e+fQ2[,}S2h-a-bQ2o-iQ4Y/tQ4r0pQ6V2bQ6Y2iQ6_2pR7Z4^S$wi<YR*t%VU%Ui%V<YR0W*rQ$viS(o#u+`Q(s#wS)`$c$dQ*U$xQ*^${Q*m%OQ*n%QQ*w%[Q*x%]Q*|%aQ.a:|Q.b;OQ.d;SQ.e;UQ.f;WQ/S)uS/X){/ZQ/])}Q/_*PQ/a*RQ/i*YQ/n*`Q0U*pQ0V*qh0f+].Z1^3O5c6g7y8j9[9n:O:WQ1Q+wQ1S+zQ3R;_Q3S;aQ3T;cQ3W.iS3l:y:zQ4P/jQ4Q/kQ4U/mQ4b0QQ4d0SQ4j0^Q5R1RQ5T1UQ6k;gQ6l;iQ6m;kQ6n;mQ6s:}Q6t;PQ6v;TQ6w;VQ6x;XQ6}3xQ7U4SQ7Y4[Q7`4fQ7b4nQ7d4pQ8o;dQ8p;`Q8q;bQ8{7TQ9P7^Q9p;hQ9q;jQ9r;lQ9s;nQ9t8wQ:X;qQ:b;rQ;z<YQ<W<bQ<X<cQ<d<fR<e<gnpOXst!Z#c%j&m&o&p&r,h,m1w1zQ!fPS#eZ#nQ&w!`U'c!o5Y7wQ'y#RQ(|#{Q)m$mS,a&f&iQ,f&jQ,s&vQ,x'OQ-[']Q.p(zQ/Q)nQ0b+SQ0i+^Q1s,eQ2f-^Q2|.[Q3s.{Q4h0[Q5a1_Q5r1oQ5s1pQ5w1rQ5y1tQ6O1|Q6f3PQ6{3pQ7{5dQ8X5tQ8Y5uQ8[5xQ8l6jQ9]7|R9g8]#WcOPXZst!Z!`!o#c#n#{%j&f&i&j&m&o&p&r&v'O'](z+S+^,e,h,m-^.[0[1_1o1p1r1t1w1z1|3P5Y5d5t5u5x6j7w7|8]Q#XWQ#dYQ%nuQ%ovS%qw!gS'|#V(PQ(S#YQ(n#tQ(u#xQ(}$OQ)O$PQ)P$QQ)Q$RQ)R$SQ)S$TQ)T$UQ)U$VQ)V$WQ)W$XQ)X$YQ)Z$[Q)^$aQ)b$eW)l$m)n.{3pQ+Z%pQ+o%}S-O'S2]Q-m'mS-r'}-tQ-w(VQ-y(^Q.h(rQ.n(vQ.r:cQ.t:fQ.u:gQ.v:jQ/V)yQ0_+OQ2W,yQ2Z,|Q2k-fQ2r-zQ3Y.lQ3_:kQ3`:lQ3a:mQ3b:nQ3c:oQ3d:pQ3e:qQ3f:rQ3g:sQ3h:tQ3i:uQ3j:vQ3k.sQ3n:{Q3o;YQ3t:wQ4k0aQ4s0qQ6U;ZQ6[2mQ6a2sQ6o3ZQ6p;[Q6y;^Q6z;eQ7r5WQ8a6SQ8e6]Q8n;fQ8t;oQ8u;pQ9k8gQ9{9WQ:S9iQ:e#RR<P<]R#ZWR'U!eY!tQ'Z-Y1[5]S'Q!e-QQ'f!rS'p!u!xS'r!y5_S,}'R'YS-i'g'hQ-k'iQ2b-WR2p-jR(t#wR(w#xQ!fQT-X'Z-Y]!qQ!r'Z-Y1[5]Q#o]R'd:dT#jZ%bS#iZ%bS%hm,dU(a#g#h#kS-}(b(cQ.R(dQ0c+TQ2u.OU2v.P.Q.SS6c2w2xR8h6d`#]W#V#Y%e'}(W+Q-xr#fZm#g#h#k%b(b(c(d+T.O.P.Q.S2w2x6dQ1q,dQ2X,zQ6Q2PQ8`6RT;w'S+RT#`W%eS#_W%eS(O#V(WS(T#Y+QS-P'S+RT-s'}-xT'X!e%fQ$kfR)s$pT)h$k)iR3r.zT*X$x*ZR*a${Q0g+]Q2z.ZQ5`1^Q6h3OQ7z5cQ8k6gQ9Y7yQ9l8jQ9}9[Q:V9nQ:[:OR:_:WnqOXst!Z#c%j&m&o&p&r,h,m1w1zQ&g!VR,]&dtmOXst!U!V!Z#c%j&d&m&o&p&r,h,m1w1zR,d&jT%im,dR1W+|R,[&bQ&Q|R+t&RR+j%{T&k!W&nT&l!W&nT1y,m1z",nodeNames:"\u26A0 ArithOp ArithOp JSXStartTag LineComment BlockComment Script Hashbang ExportDeclaration export Star as VariableName String Escape from ; default FunctionDeclaration async function VariableDefinition > < TypeParamList TypeDefinition extends ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation InterpolationStart NullType null VoidType void TypeofType typeof MemberExpression . ?. PropertyName [ TemplateString Escape Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewExpression new TypeArgList CompareOp < ) ( ArgList UnaryExpression delete LogicOp BitOp YieldExpression yield AwaitExpression await ParenthesizedExpression ClassExpression class ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression declare Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies in const CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast ArrowFunction TypeParamList SequenceExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var using TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression SingleClassItem",maxTerm:371,context:trackNewline,nodeProps:[["group",-26,8,16,18,65,201,205,209,210,212,215,218,228,230,236,238,240,242,245,251,257,259,261,263,265,267,268,"Statement",-32,12,13,28,31,32,38,48,51,52,54,59,67,75,79,81,83,84,106,107,116,117,134,137,139,140,141,142,144,145,164,165,167,"Expression",-23,27,29,33,37,39,41,168,170,172,173,175,176,177,179,180,181,183,184,185,195,197,199,200,"Type",-3,87,99,105,"ClassItem"],["openedBy",22,"<",34,"InterpolationStart",53,"[",57,"{",72,"(",157,"JSXStartCloseTag"],["closedBy",23,">",36,"InterpolationEnd",47,"]",58,"}",73,")",162,"JSXEndTag"]],propSources:[jsHighlight],skippedNodes:[0,4,5,271],repeatNodeCount:37,tokenData:"$Fj(CSR!bOX%ZXY+gYZ-yZ[+g[]%Z]^.c^p%Zpq+gqr/mrs3cst:_tuEruvJSvwLkwx! Yxy!'iyz!(sz{!)}{|!,q|}!.O}!O!,q!O!P!/Y!P!Q!9j!Q!R#8g!R![#:v![!]#Gv!]!^#IS!^!_#J^!_!`#Ns!`!a$#_!a!b$(l!b!c$,k!c!}Er!}#O$-u#O#P$/P#P#Q$4h#Q#R$5r#R#SEr#S#T$7P#T#o$8Z#o#p$<k#p#q$=a#q#r$>q#r#s$?}#s$f%Z$f$g+g$g#BYEr#BY#BZ$AX#BZ$ISEr$IS$I_$AX$I_$I|Er$I|$I}$Dd$I}$JO$Dd$JO$JTEr$JT$JU$AX$JU$KVEr$KV$KW$AX$KW&FUEr&FU&FV$AX&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$AX?HUOEr(n%d_$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&j&hT$f&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c&j&zP;=`<%l&c'|'U]$f&j(R!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!b(SU(R!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!b(iP;=`<%l'}'|(oP;=`<%l&}'[(y]$f&j(OpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rp)wU(OpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)rp*^P;=`<%l)r'[*dP;=`<%l(r#S*nX(Op(R!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g#S+^P;=`<%l*g(n+dP;=`<%l%Z(CS+rq$f&j(Op(R!b't(;dOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p$f%Z$f$g+g$g#BY%Z#BY#BZ+g#BZ$IS%Z$IS$I_+g$I_$JT%Z$JT$JU+g$JU$KV%Z$KV$KW+g$KW&FU%Z&FU&FV+g&FV;'S%Z;'S;=`+a<%l?HT%Z?HT?HU+g?HUO%Z(CS.ST(P#S$f&j'u(;dO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c(CS.n_$f&j(Op(R!b'u(;dOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#`/x`$f&j!o$Ip(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#S1V`#t$Id$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`2X!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#S2d_#t$Id$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/|3l_'}$(n$f&j(R!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k(^4r_$f&j(R!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k&z5vX$f&jOr5qrs6cs!^5q!^!_6y!_#o5q#o#p6y#p;'S5q;'S;=`7h<%lO5q&z6jT$a`$f&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c`6|TOr6yrs7]s;'S6y;'S;=`7b<%lO6y`7bO$a``7eP;=`<%l6y&z7kP;=`<%l5q(^7w]$a`$f&j(R!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!r8uZ(R!bOY8pYZ6yZr8prs9hsw8pwx6yx#O8p#O#P6y#P;'S8p;'S;=`:R<%lO8p!r9oU$a`(R!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!r:UP;=`<%l8p(^:[P;=`<%l4k#%|:hh$f&j(Op(R!bOY%ZYZ&cZq%Zqr<Srs&}st%ZtuCruw%Zwx(rx!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr(r<__VS$f&j(Op(R!bOY<SYZ&cZr<Srs=^sw<Swx@nx!^<S!^!_Bm!_#O<S#O#P>`#P#o<S#o#pBm#p;'S<S;'S;=`Cl<%lO<S(Q=g]VS$f&j(R!bOY=^YZ&cZw=^wx>`x!^=^!^!_?q!_#O=^#O#P>`#P#o=^#o#p?q#p;'S=^;'S;=`@h<%lO=^&n>gXVS$f&jOY>`YZ&cZ!^>`!^!_?S!_#o>`#o#p?S#p;'S>`;'S;=`?k<%lO>`S?XSVSOY?SZ;'S?S;'S;=`?e<%lO?SS?hP;=`<%l?S&n?nP;=`<%l>`!f?xWVS(R!bOY?qZw?qwx?Sx#O?q#O#P?S#P;'S?q;'S;=`@b<%lO?q!f@eP;=`<%l?q(Q@kP;=`<%l=^'`@w]VS$f&j(OpOY@nYZ&cZr@nrs>`s!^@n!^!_Ap!_#O@n#O#P>`#P#o@n#o#pAp#p;'S@n;'S;=`Bg<%lO@ntAwWVS(OpOYApZrAprs?Ss#OAp#O#P?S#P;'SAp;'S;=`Ba<%lOAptBdP;=`<%lAp'`BjP;=`<%l@n#WBvYVS(Op(R!bOYBmZrBmrs?qswBmwxApx#OBm#O#P?S#P;'SBm;'S;=`Cf<%lOBm#WCiP;=`<%lBm(rCoP;=`<%l<S#%|C}i$f&j(g!L^(Op(R!bOY%ZYZ&cZr%Zrs&}st%ZtuCruw%Zwx(rx!Q%Z!Q![Cr![!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr#%|EoP;=`<%lCr(CSFRk$f&j(Op(R!b$Y#t'{&;d([!LYOY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr+dHRk$f&j(Op(R!b$Y#tOY%ZYZ&cZr%Zrs&}st%ZtuGvuw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Gv![!^%Z!^!_*g!_!c%Z!c!}Gv!}#O%Z#O#P&c#P#R%Z#R#SGv#S#T%Z#T#oGv#o#p*g#p$g%Z$g;'SGv;'S;=`Iv<%lOGv+dIyP;=`<%lGv(CSJPP;=`<%lEr%#SJ_`$f&j(Op(R!b#l$IdOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#SKl_$f&j$O$Id(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&COLva(p&;`$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sv%ZvwM{wx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#SNW`$f&j#x$Id(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/|! c_(Q$)`$f&j(OpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b'l!!i_$f&j(OpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b&z!#mX$f&jOw!#hwx6cx!^!#h!^!_!$Y!_#o!#h#o#p!$Y#p;'S!#h;'S;=`!$r<%lO!#h`!$]TOw!$Ywx7]x;'S!$Y;'S;=`!$l<%lO!$Y`!$oP;=`<%l!$Y&z!$uP;=`<%l!#h'l!%R]$a`$f&j(OpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r!Q!&PZ(OpOY!%zYZ!$YZr!%zrs!$Ysw!%zwx!&rx#O!%z#O#P!$Y#P;'S!%z;'S;=`!']<%lO!%z!Q!&yU$a`(OpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)r!Q!'`P;=`<%l!%z'l!'fP;=`<%l!!b(*Q!'t_!k(!b$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z!'l!)O_!jM|$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'+h!*[b$f&j(Op(R!b'|#)d#m$IdOY%ZYZ&cZr%Zrs&}sw%Zwx(rxz%Zz{!+d{!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#S!+o`$f&j(Op(R!b#j$IdOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&-O!,|`$f&j(Op(R!bn&%`OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&C[!.Z_!Y&;l$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(CS!/ec$f&j(Op(R!b|'<nOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!0p!P!Q%Z!Q![!3Y![!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z!'d!0ya$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!2O!P!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z!'d!2Z_!XMt$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l!3eg$f&j(Op(R!bo$'|OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!3Y![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S!3Y#S#X%Z#X#Y!4|#Y#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l!5Vg$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx{%Z{|!6n|}%Z}!O!6n!O!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l!6wc$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l!8_c$f&j(Op(R!bo$'|OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(CS!9uf$f&j(Op(R!b#k$IdOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Kpxz!;Zz{#,f{!P!;Z!P!Q#-{!Q!^!;Z!^!_#'Z!_!`#5k!`!a#7Q!a!}!;Z!}#O#*}#O#P!Dj#P#o!;Z#o#p#'Z#p;'S!;Z;'S;=`#,`<%lO!;Z(r!;fb$f&j(Op(R!b!USOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Kpx!P!;Z!P!Q#%Z!Q!^!;Z!^!_#'Z!_!}!;Z!}#O#*}#O#P!Dj#P#o!;Z#o#p#'Z#p;'S!;Z;'S;=`#,`<%lO!;Z(Q!<w`$f&j(R!b!USOY!<nYZ&cZw!<nwx!=yx!P!<n!P!Q!Eb!Q!^!<n!^!_!GY!_!}!<n!}#O!Ja#O#P!Dj#P#o!<n#o#p!GY#p;'S!<n;'S;=`!Kj<%lO!<n&n!>Q^$f&j!USOY!=yYZ&cZ!P!=y!P!Q!>|!Q!^!=y!^!_!@Y!_!}!=y!}#O!Bw#O#P!Dj#P#o!=y#o#p!@Y#p;'S!=y;'S;=`!E[<%lO!=y&n!?Ta$f&j!USO!^&c!_#Z&c#Z#[!>|#[#]&c#]#^!>|#^#a&c#a#b!>|#b#g&c#g#h!>|#h#i&c#i#j!>|#j#m&c#m#n!>|#n#o&c#p;'S&c;'S;=`&w<%lO&cS!@_X!USOY!@YZ!P!@Y!P!Q!@z!Q!}!@Y!}#O!Ac#O#P!Bb#P;'S!@Y;'S;=`!Bq<%lO!@YS!APU!US#Z#[!@z#]#^!@z#a#b!@z#g#h!@z#i#j!@z#m#n!@zS!AfVOY!AcZ#O!Ac#O#P!A{#P#Q!@Y#Q;'S!Ac;'S;=`!B[<%lO!AcS!BOSOY!AcZ;'S!Ac;'S;=`!B[<%lO!AcS!B_P;=`<%l!AcS!BeSOY!@YZ;'S!@Y;'S;=`!Bq<%lO!@YS!BtP;=`<%l!@Y&n!B|[$f&jOY!BwYZ&cZ!^!Bw!^!_!Ac!_#O!Bw#O#P!Cr#P#Q!=y#Q#o!Bw#o#p!Ac#p;'S!Bw;'S;=`!Dd<%lO!Bw&n!CwX$f&jOY!BwYZ&cZ!^!Bw!^!_!Ac!_#o!Bw#o#p!Ac#p;'S!Bw;'S;=`!Dd<%lO!Bw&n!DgP;=`<%l!Bw&n!DoX$f&jOY!=yYZ&cZ!^!=y!^!_!@Y!_#o!=y#o#p!@Y#p;'S!=y;'S;=`!E[<%lO!=y&n!E_P;=`<%l!=y(Q!Eki$f&j(R!b!USOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#Z&}#Z#[!Eb#[#]&}#]#^!Eb#^#a&}#a#b!Eb#b#g&}#g#h!Eb#h#i&}#i#j!Eb#j#m&}#m#n!Eb#n#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!f!GaZ(R!b!USOY!GYZw!GYwx!@Yx!P!GY!P!Q!HS!Q!}!GY!}#O!Ic#O#P!Bb#P;'S!GY;'S;=`!JZ<%lO!GY!f!HZb(R!b!USOY'}Zw'}x#O'}#P#Z'}#Z#[!HS#[#]'}#]#^!HS#^#a'}#a#b!HS#b#g'}#g#h!HS#h#i'}#i#j!HS#j#m'}#m#n!HS#n;'S'};'S;=`(f<%lO'}!f!IhX(R!bOY!IcZw!Icwx!Acx#O!Ic#O#P!A{#P#Q!GY#Q;'S!Ic;'S;=`!JT<%lO!Ic!f!JWP;=`<%l!Ic!f!J^P;=`<%l!GY(Q!Jh^$f&j(R!bOY!JaYZ&cZw!Jawx!Bwx!^!Ja!^!_!Ic!_#O!Ja#O#P!Cr#P#Q!<n#Q#o!Ja#o#p!Ic#p;'S!Ja;'S;=`!Kd<%lO!Ja(Q!KgP;=`<%l!Ja(Q!KmP;=`<%l!<n'`!Ky`$f&j(Op!USOY!KpYZ&cZr!Kprs!=ys!P!Kp!P!Q!L{!Q!^!Kp!^!_!Ns!_!}!Kp!}#O##z#O#P!Dj#P#o!Kp#o#p!Ns#p;'S!Kp;'S;=`#%T<%lO!Kp'`!MUi$f&j(Op!USOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#Z(r#Z#[!L{#[#](r#]#^!L{#^#a(r#a#b!L{#b#g(r#g#h!L{#h#i(r#i#j!L{#j#m(r#m#n!L{#n#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rt!NzZ(Op!USOY!NsZr!Nsrs!@Ys!P!Ns!P!Q# m!Q!}!Ns!}#O#!|#O#P!Bb#P;'S!Ns;'S;=`##t<%lO!Nst# tb(Op!USOY)rZr)rs#O)r#P#Z)r#Z#[# m#[#])r#]#^# m#^#a)r#a#b# m#b#g)r#g#h# m#h#i)r#i#j# m#j#m)r#m#n# m#n;'S)r;'S;=`*Z<%lO)rt##RX(OpOY#!|Zr#!|rs!Acs#O#!|#O#P!A{#P#Q!Ns#Q;'S#!|;'S;=`##n<%lO#!|t##qP;=`<%l#!|t##wP;=`<%l!Ns'`#$R^$f&j(OpOY##zYZ&cZr##zrs!Bws!^##z!^!_#!|!_#O##z#O#P!Cr#P#Q!Kp#Q#o##z#o#p#!|#p;'S##z;'S;=`#$}<%lO##z'`#%QP;=`<%l##z'`#%WP;=`<%l!Kp(r#%fk$f&j(Op(R!b!USOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#Z%Z#Z#[#%Z#[#]%Z#]#^#%Z#^#a%Z#a#b#%Z#b#g%Z#g#h#%Z#h#i%Z#i#j#%Z#j#m%Z#m#n#%Z#n#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#W#'d](Op(R!b!USOY#'ZZr#'Zrs!GYsw#'Zwx!Nsx!P#'Z!P!Q#(]!Q!}#'Z!}#O#)w#O#P!Bb#P;'S#'Z;'S;=`#*w<%lO#'Z#W#(fe(Op(R!b!USOY*gZr*grs'}sw*gwx)rx#O*g#P#Z*g#Z#[#(]#[#]*g#]#^#(]#^#a*g#a#b#(]#b#g*g#g#h#(]#h#i*g#i#j#(]#j#m*g#m#n#(]#n;'S*g;'S;=`+Z<%lO*g#W#*OZ(Op(R!bOY#)wZr#)wrs!Icsw#)wwx#!|x#O#)w#O#P!A{#P#Q#'Z#Q;'S#)w;'S;=`#*q<%lO#)w#W#*tP;=`<%l#)w#W#*zP;=`<%l#'Z(r#+W`$f&j(Op(R!bOY#*}YZ&cZr#*}rs!Jasw#*}wx##zx!^#*}!^!_#)w!_#O#*}#O#P!Cr#P#Q!;Z#Q#o#*}#o#p#)w#p;'S#*};'S;=`#,Y<%lO#*}(r#,]P;=`<%l#*}(r#,cP;=`<%l!;Z(CS#,sb$f&j(Op(R!b'v(;d!USOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Kpx!P!;Z!P!Q#%Z!Q!^!;Z!^!_#'Z!_!}!;Z!}#O#*}#O#P!Dj#P#o!;Z#o#p#'Z#p;'S!;Z;'S;=`#,`<%lO!;Z(CS#.W_$f&j(Op(R!bS(;dOY#-{YZ&cZr#-{rs#/Vsw#-{wx#2gx!^#-{!^!_#4f!_#O#-{#O#P#0X#P#o#-{#o#p#4f#p;'S#-{;'S;=`#5e<%lO#-{(Bb#/`]$f&j(R!bS(;dOY#/VYZ&cZw#/Vwx#0Xx!^#/V!^!_#1j!_#O#/V#O#P#0X#P#o#/V#o#p#1j#p;'S#/V;'S;=`#2a<%lO#/V(AO#0`X$f&jS(;dOY#0XYZ&cZ!^#0X!^!_#0{!_#o#0X#o#p#0{#p;'S#0X;'S;=`#1d<%lO#0X(;d#1QSS(;dOY#0{Z;'S#0{;'S;=`#1^<%lO#0{(;d#1aP;=`<%l#0{(AO#1gP;=`<%l#0X(<v#1qW(R!bS(;dOY#1jZw#1jwx#0{x#O#1j#O#P#0{#P;'S#1j;'S;=`#2Z<%lO#1j(<v#2^P;=`<%l#1j(Bb#2dP;=`<%l#/V(Ap#2p]$f&j(OpS(;dOY#2gYZ&cZr#2grs#0Xs!^#2g!^!_#3i!_#O#2g#O#P#0X#P#o#2g#o#p#3i#p;'S#2g;'S;=`#4`<%lO#2g(<U#3pW(OpS(;dOY#3iZr#3irs#0{s#O#3i#O#P#0{#P;'S#3i;'S;=`#4Y<%lO#3i(<U#4]P;=`<%l#3i(Ap#4cP;=`<%l#2g(=h#4oY(Op(R!bS(;dOY#4fZr#4frs#1jsw#4fwx#3ix#O#4f#O#P#0{#P;'S#4f;'S;=`#5_<%lO#4f(=h#5bP;=`<%l#4f(CS#5hP;=`<%l#-{%#W#5xb$f&j$O$Id(Op(R!b!USOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Kpx!P!;Z!P!Q#%Z!Q!^!;Z!^!_#'Z!_!}!;Z!}#O#*}#O#P!Dj#P#o!;Z#o#p#'Z#p;'S!;Z;'S;=`#,`<%lO!;Z+h#7_b$W#t$f&j(Op(R!b!USOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Kpx!P!;Z!P!Q#%Z!Q!^!;Z!^!_#'Z!_!}!;Z!}#O#*}#O#P!Dj#P#o!;Z#o#p#'Z#p;'S!;Z;'S;=`#,`<%lO!;Z$/l#8rp$f&j(Op(R!bo$'|OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#:v![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#:v#S#U%Z#U#V#>Q#V#X%Z#X#Y!4|#Y#b%Z#b#c#<v#c#d#AY#d#l%Z#l#m#D[#m#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l#;Rk$f&j(Op(R!bo$'|OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#:v![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#:v#S#X%Z#X#Y!4|#Y#b%Z#b#c#<v#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l#=R_$f&j(Op(R!bo$'|OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l#>Zd$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#?i!R!S#?i!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#?i#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l#?tf$f&j(Op(R!bo$'|OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#?i!R!S#?i!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#?i#S#b%Z#b#c#<v#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l#Acc$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#Bn!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#Bn#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l#Bye$f&j(Op(R!bo$'|OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#Bn!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#Bn#S#b%Z#b#c#<v#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l#Deg$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#E|![!^%Z!^!_*g!_!c%Z!c!i#E|!i#O%Z#O#P&c#P#R%Z#R#S#E|#S#T%Z#T#Z#E|#Z#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z$/l#FXi$f&j(Op(R!bo$'|OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#E|![!^%Z!^!_*g!_!c%Z!c!i#E|!i#O%Z#O#P&c#P#R%Z#R#S#E|#S#T%Z#T#Z#E|#Z#b%Z#b#c#<v#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%Gh#HT_!d$b$f&j#|%<f(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)[#I__`l$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(@^#Jk^g!*v!h'.r(Op(R!b(tSOY*gZr*grs'}sw*gwx)rx!P*g!P!Q#Kg!Q!^*g!^!_#L]!_!`#M}!`#O*g#P;'S*g;'S;=`+Z<%lO*g(n#KpX$h&j(Op(R!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g$Kh#LfZ#n$Id(Op(R!bOY*gZr*grs'}sw*gwx)rx!_*g!_!`#MX!`#O*g#P;'S*g;'S;=`+Z<%lO*g$Kh#MbX$O$Id(Op(R!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g$Kh#NWX#o$Id(Op(R!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g%Gh$ Oa#[%?x$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`!a$!T!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#W$!`_#g$Ih$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%Gh$#nafBf#o$Id$c#|$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`$$s!`!a$%}!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#S$%O_#o$Id$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#S$&Ya#n$Id$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`!a$'_!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#S$'j`#n$Id$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'+h$(wc(h$Ip$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P$*S!P!^%Z!^!_*g!_!a%Z!a!b$+^!b#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'+`$*__}'#p$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#S$+i`$f&j#y$Id(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#&^$,v_!{!Ln$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(@^$.Q_!P(8n$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(n$/UZ$f&jO!^$/w!^!_$0_!_#i$/w#i#j$0d#j#l$/w#l#m$2V#m#o$/w#o#p$0_#p;'S$/w;'S;=`$4b<%lO$/w(n$0OT^#S$f&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c#S$0dO^#S(n$0i[$f&jO!Q&c!Q![$1_![!^&c!_!c&c!c!i$1_!i#T&c#T#Z$1_#Z#o&c#o#p$3u#p;'S&c;'S;=`&w<%lO&c(n$1dZ$f&jO!Q&c!Q![$2V![!^&c!_!c&c!c!i$2V!i#T&c#T#Z$2V#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$2[Z$f&jO!Q&c!Q![$2}![!^&c!_!c&c!c!i$2}!i#T&c#T#Z$2}#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$3SZ$f&jO!Q&c!Q![$/w![!^&c!_!c&c!c!i$/w!i#T&c#T#Z$/w#Z#o&c#p;'S&c;'S;=`&w<%lO&c#S$3xR!Q![$4R!c!i$4R#T#Z$4R#S$4US!Q![$4R!c!i$4R#T#Z$4R#q#r$0_(n$4eP;=`<%l$/w!2r$4s_!V!+S$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#S$5}`#v$Id$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&,v$7[_$f&j(Op(R!b(X&%WOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(CS$8jk$f&j(Op(R!b'{&;d$[#t([!LYOY%ZYZ&cZr%Zrs&}st%Ztu$8Zuw%Zwx(rx}%Z}!O$:_!O!Q%Z!Q![$8Z![!^%Z!^!_*g!_!c%Z!c!}$8Z!}#O%Z#O#P&c#P#R%Z#R#S$8Z#S#T%Z#T#o$8Z#o#p*g#p$g%Z$g;'S$8Z;'S;=`$<e<%lO$8Z+d$:jk$f&j(Op(R!b$[#tOY%ZYZ&cZr%Zrs&}st%Ztu$:_uw%Zwx(rx}%Z}!O$:_!O!Q%Z!Q![$:_![!^%Z!^!_*g!_!c%Z!c!}$:_!}#O%Z#O#P&c#P#R%Z#R#S$:_#S#T%Z#T#o$:_#o#p*g#p$g%Z$g;'S$:_;'S;=`$<_<%lO$:_+d$<bP;=`<%l$:_(CS$<hP;=`<%l$8Z!5p$<tX![!3l(Op(R!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g&CO$=la(o&;`$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p#q$+^#q;'S%Z;'S;=`+a<%lO%Z%#`$?O_!Z$I`r`$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(r$@Y_!pS$f&j(Op(R!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(CS$Aj|$f&j(Op(R!b't(;d$Y#t'{&;d([!LYOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$f%Z$f$g+g$g#BYEr#BY#BZ$AX#BZ$ISEr$IS$I_$AX$I_$JTEr$JT$JU$AX$JU$KVEr$KV$KW$AX$KW&FUEr&FU&FV$AX&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$AX?HUOEr(CS$Duk$f&j(Op(R!b'u(;d$Y#t'{&;d([!LYOY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr",tokenizers:[noSemicolon,incdecToken,jsx,2,3,4,5,6,7,8,9,10,11,12,13,insertSemicolon,new LocalTokenGroup("$S~RRtu[#O#Pg#S#T#|~_P#o#pb~gOt~~jVO#i!P#i#j!U#j#l!P#l#m!q#m;'S!P;'S;=`#v<%lO!P~!UO!R~~!XS!Q![!e!c!i!e#T#Z!e#o#p#Z~!hR!Q![!q!c!i!q#T#Z!q~!tR!Q![!}!c!i!}#T#Z!}~#QR!Q![!P!c!i!P#T#Z!P~#^R!Q![#g!c!i#g#T#Z#g~#jS!Q![#g!c!i#g#T#Z#g#q#r!P~#yP;=`<%l!P~$RO(Z~~",141,332),new LocalTokenGroup("j~RQYZXz{^~^O'x~~aP!P!Qd~iO'y~~",25,315)],topRules:{"Script":[0,6],"SingleExpression":[1,269],"SingleClassItem":[2,270]},dialects:{jsx:0,ts:14602},dynamicPrecedences:{"69":1,"79":1,"81":1,"165":1,"193":1},specialized:[{term:319,get:function get(value){return spec_identifier[value]||-1}},{term:334,get:function get(value){return spec_word[value]||-1}},{term:70,get:function get(value){return spec_LessThan[value]||-1}}],tokenPrec:14626});var snippets=[snippetCompletion("function ${name}(${params}) {\n\t${}\n}",{label:"function",detail:"definition",type:"keyword"}),snippetCompletion("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n\t${}\n}",{label:"for",detail:"loop",type:"keyword"}),snippetCompletion("for (let ${name} of ${collection}) {\n\t${}\n}",{label:"for",detail:"of loop",type:"keyword"}),snippetCompletion("do {\n\t${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),snippetCompletion("while (${}) {\n\t${}\n}",{label:"while",detail:"loop",type:"keyword"}),snippetCompletion("try {\n\t${}\n} catch (${error}) {\n\t${}\n}",{label:"try",detail:"/ catch block",type:"keyword"}),snippetCompletion("if (${}) {\n\t${}\n}",{label:"if",detail:"block",type:"keyword"}),snippetCompletion("if (${}) {\n\t${}\n} else {\n\t${}\n}",{label:"if",detail:"/ else block",type:"keyword"}),snippetCompletion("class ${name} {\n\tconstructor(${params}) {\n\t\t${}\n\t}\n}",{label:"class",detail:"definition",type:"keyword"}),snippetCompletion("import {${names}} from \"${module}\"\n${}",{label:"import",detail:"named",type:"keyword"}),snippetCompletion("import ${name} from \"${module}\"\n${}",{label:"import",detail:"default",type:"keyword"})];var typescriptSnippets=snippets.concat([snippetCompletion("interface ${name} {\n\t${}\n}",{label:"interface",detail:"definition",type:"keyword"}),snippetCompletion("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),snippetCompletion("enum ${name} {\n\t${}\n}",{label:"enum",detail:"definition",type:"keyword"})]);var cache=new NodeWeakMap;var ScopeNodes=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function defID(type){return function(node,def){var id=node.node.getChild("VariableDefinition");if(id)def(id,type);return true}}var functionContext=["FunctionDeclaration"];var gatherCompletions={FunctionDeclaration:defID("function"),ClassDeclaration:defID("class"),ClassExpression:function ClassExpression(){return true},EnumDeclaration:defID("constant"),TypeAliasDeclaration:defID("type"),NamespaceDeclaration:defID("namespace"),VariableDefinition:function VariableDefinition(node,def){if(!node.matchContext(functionContext))def(node,"variable")},TypeDefinition:function TypeDefinition(node,def){def(node,"type")},__proto__:null};function getScope(doc,node){var cached=cache.get(node);if(cached)return cached;var completions=[],top=true;function def(node,type){var name=doc.sliceString(node.from,node.to);completions.push({label:name,type:type})}node.cursor(IterMode.IncludeAnonymous).iterate(function(node){if(top){top=false}else if(node.name){var gather=gatherCompletions[node.name];if(gather&&gather(node,def)||ScopeNodes.has(node.name))return false}else if(node.to-node.from>8192){var _iterator458=_createForOfIteratorHelper(getScope(doc,node.node)),_step458;try{for(_iterator458.s();!(_step458=_iterator458.n()).done;){var c=_step458.value;completions.push(c)}}catch(err){_iterator458.e(err)}finally{_iterator458.f()}return false}});cache.set(node,completions);return completions}var Identifier=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/;var dontComplete=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName",".","?."];function localCompletionSource(context){var inner=syntaxTree(context.state).resolveInner(context.pos,-1);if(dontComplete.indexOf(inner.name)>-1)return null;var isWord=inner.name=="VariableName"||inner.to-inner.from<20&&Identifier.test(context.state.sliceDoc(inner.from,inner.to));if(!isWord&&!context.explicit)return null;var options=[];for(var pos=inner;pos;pos=pos.parent){if(ScopeNodes.has(pos.name))options=options.concat(getScope(context.state.doc,pos))}return{options:options,from:isWord?inner.from:context.pos,validFor:Identifier}}var javascriptLanguage=LRLanguage.define({name:"javascript",parser:parser.configure({props:[indentNodeProp.add({IfStatement:continuedIndent({except:/^\s*({|else\b)/}),TryStatement:continuedIndent({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:flatIndent,SwitchBody:function SwitchBody(context){var after=context.textAfter,closed=/^\s*\}/.test(after),isCase=/^\s*(case|default)\b/.test(after);return context.baseIndent+(closed?0:isCase?1:2)*context.unit},Block:delimitedIndent({closing:"}"}),ArrowFunction:function ArrowFunction(cx){return cx.baseIndent+cx.unit},"TemplateString BlockComment":function TemplateStringBlockComment(){return null},"Statement Property":continuedIndent({except:/^{/}),JSXElement:function JSXElement(context){var closed=/^\s*<\//.test(context.textAfter);return context.lineIndent(context.node.from)+(closed?0:context.unit)},JSXEscape:function JSXEscape(context){var closed=/\s*\}/.test(context.textAfter);return context.lineIndent(context.node.from)+(closed?0:context.unit)},"JSXOpenTag JSXSelfClosingTag":function JSXOpenTagJSXSelfClosingTag(context){return context.column(context.node.from)+context.unit}}),foldNodeProp.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":foldInside,BlockComment:function BlockComment(tree){return{from:tree.from+2,to:tree.to-2}}})]}),languageData:{closeBrackets:{brackets:["(","[","{","'","\"","`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}});var jsxSublanguage={test:function test(node){return /^JSX/.test(node.name)},facet:defineLanguageFacet({commentTokens:{block:{open:"{/*",close:"*/}"}}})};var typescriptLanguage=javascriptLanguage.configure({dialect:"ts"},"typescript");var jsxLanguage=javascriptLanguage.configure({dialect:"jsx",props:[sublanguageProp.add(function(n){return n.isTop?[jsxSublanguage]:undefined})]});var tsxLanguage=javascriptLanguage.configure({dialect:"jsx ts",props:[sublanguageProp.add(function(n){return n.isTop?[jsxSublanguage]:undefined})]},"typescript");var kwCompletion=function kwCompletion(name){return{label:name,type:"keyword"}};var keywords="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(kwCompletion);var typescriptKeywords=keywords.concat(["declare","implements","private","protected","public"].map(kwCompletion));function javascript(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var lang=config.jsx?config.typescript?tsxLanguage:jsxLanguage:config.typescript?typescriptLanguage:javascriptLanguage;var completions=config.typescript?typescriptSnippets.concat(typescriptKeywords):snippets.concat(keywords);return new LanguageSupport(lang,[javascriptLanguage.data.of({autocomplete:ifNotIn(dontComplete,completeFromList(completions))}),javascriptLanguage.data.of({autocomplete:localCompletionSource}),config.jsx?autoCloseTags$1:[]])}function findOpenTag(node){for(;;){if(node.name=="JSXOpenTag"||node.name=="JSXSelfClosingTag"||node.name=="JSXFragmentTag")return node;if(node.name=="JSXEscape"||!node.parent)return null;node=node.parent}}function elementName$1(doc,tree){var max=arguments.length>2&&arguments[2]!==undefined?arguments[2]:doc.length;for(var ch=tree===null||tree===void 0?void 0:tree.firstChild;ch;ch=ch.nextSibling){if(ch.name=="JSXIdentifier"||ch.name=="JSXBuiltin"||ch.name=="JSXNamespacedName"||ch.name=="JSXMemberExpression")return doc.sliceString(ch.from,Math.min(ch.to,max))}return""}var android=(typeof navigator==="undefined"?"undefined":_typeof2(navigator))=="object"&&/Android\b/.test(navigator.userAgent);var autoCloseTags$1=EditorView.inputHandler.of(function(view,from,to,text,defaultInsert){if((android?view.composing:view.compositionStarted)||view.state.readOnly||from!=to||text!=">"&&text!="/"||!javascriptLanguage.isActiveAt(view.state,from,-1))return false;var base=defaultInsert(),state=base.state;var closeTags=state.changeByRange(function(range){var _a;var head=range.head,around=syntaxTree(state).resolveInner(head-1,-1),name;if(around.name=="JSXStartTag")around=around.parent;if(state.doc.sliceString(head-1,head)!=text||around.name=="JSXAttributeValue"&&around.to>head);else if(text==">"&&around.name=="JSXFragmentTag"){return{range:range,changes:{from:head,insert:"</>"}}}else if(text=="/"&&around.name=="JSXStartCloseTag"){var _empty3=around.parent,_base5=_empty3.parent;if(_base5&&_empty3.from==head-2&&((name=elementName$1(state.doc,_base5.firstChild,head))||((_a=_base5.firstChild)===null||_a===void 0?void 0:_a.name)=="JSXFragmentTag")){var _insert3="".concat(name,">");return{range:EditorSelection.cursor(head+_insert3.length,-1),changes:{from:head,insert:_insert3}}}}else if(text==">"){var openTag=findOpenTag(around);if(openTag&&!/^\/?>|^<\//.test(state.doc.sliceString(head,head+2))&&(name=elementName$1(state.doc,openTag,head)))return{range:range,changes:{from:head,insert:"</".concat(name,">")}}}return{range:range}});if(closeTags.changes.empty)return false;view.dispatch([base,state.update(closeTags,{userEvent:"input.complete",scrollIntoView:true})]);return true});var Targets=["_blank","_self","_top","_parent"];var Charsets=["ascii","utf-8","utf-16","latin1","latin1"];var Methods=["get","post","put","delete"];var Encs=["application/x-www-form-urlencoded","multipart/form-data","text/plain"];var Bool=["true","false"];var S={};var Tags={a:{attrs:{href:null,ping:null,type:null,media:null,target:Targets,hreflang:null}},abbr:S,address:S,area:{attrs:{alt:null,coords:null,href:null,target:null,ping:null,media:null,hreflang:null,type:null,shape:["default","rect","circle","poly"]}},article:S,aside:S,audio:{attrs:{src:null,mediagroup:null,crossorigin:["anonymous","use-credentials"],preload:["none","metadata","auto"],autoplay:["autoplay"],loop:["loop"],controls:["controls"]}},b:S,base:{attrs:{href:null,target:Targets}},bdi:S,bdo:S,blockquote:{attrs:{cite:null}},body:S,br:S,button:{attrs:{form:null,formaction:null,name:null,value:null,autofocus:["autofocus"],disabled:["autofocus"],formenctype:Encs,formmethod:Methods,formnovalidate:["novalidate"],formtarget:Targets,type:["submit","reset","button"]}},canvas:{attrs:{width:null,height:null}},caption:S,center:S,cite:S,code:S,col:{attrs:{span:null}},colgroup:{attrs:{span:null}},command:{attrs:{type:["command","checkbox","radio"],label:null,icon:null,radiogroup:null,command:null,title:null,disabled:["disabled"],checked:["checked"]}},data:{attrs:{value:null}},datagrid:{attrs:{disabled:["disabled"],multiple:["multiple"]}},datalist:{attrs:{data:null}},dd:S,del:{attrs:{cite:null,datetime:null}},details:{attrs:{open:["open"]}},dfn:S,div:S,dl:S,dt:S,em:S,embed:{attrs:{src:null,type:null,width:null,height:null}},eventsource:{attrs:{src:null}},fieldset:{attrs:{disabled:["disabled"],form:null,name:null}},figcaption:S,figure:S,footer:S,form:{attrs:{action:null,name:null,"accept-charset":Charsets,autocomplete:["on","off"],enctype:Encs,method:Methods,novalidate:["novalidate"],target:Targets}},h1:S,h2:S,h3:S,h4:S,h5:S,h6:S,head:{children:["title","base","link","style","meta","script","noscript","command"]},header:S,hgroup:S,hr:S,html:{attrs:{manifest:null}},i:S,iframe:{attrs:{src:null,srcdoc:null,name:null,width:null,height:null,sandbox:["allow-top-navigation","allow-same-origin","allow-forms","allow-scripts"],seamless:["seamless"]}},img:{attrs:{alt:null,src:null,ismap:null,usemap:null,width:null,height:null,crossorigin:["anonymous","use-credentials"]}},input:{attrs:{alt:null,dirname:null,form:null,formaction:null,height:null,list:null,max:null,maxlength:null,min:null,name:null,pattern:null,placeholder:null,size:null,src:null,step:null,value:null,width:null,accept:["audio/*","video/*","image/*"],autocomplete:["on","off"],autofocus:["autofocus"],checked:["checked"],disabled:["disabled"],formenctype:Encs,formmethod:Methods,formnovalidate:["novalidate"],formtarget:Targets,multiple:["multiple"],readonly:["readonly"],required:["required"],type:["hidden","text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","number","range","color","checkbox","radio","file","submit","image","reset","button"]}},ins:{attrs:{cite:null,datetime:null}},kbd:S,keygen:{attrs:{challenge:null,form:null,name:null,autofocus:["autofocus"],disabled:["disabled"],keytype:["RSA"]}},label:{attrs:{"for":null,form:null}},legend:S,li:{attrs:{value:null}},link:{attrs:{href:null,type:null,hreflang:null,media:null,sizes:["all","16x16","16x16 32x32","16x16 32x32 64x64"]}},map:{attrs:{name:null}},mark:S,menu:{attrs:{label:null,type:["list","context","toolbar"]}},meta:{attrs:{content:null,charset:Charsets,name:["viewport","application-name","author","description","generator","keywords"],"http-equiv":["content-language","content-type","default-style","refresh"]}},meter:{attrs:{value:null,min:null,low:null,high:null,max:null,optimum:null}},nav:S,noscript:S,object:{attrs:{data:null,type:null,name:null,usemap:null,form:null,width:null,height:null,typemustmatch:["typemustmatch"]}},ol:{attrs:{reversed:["reversed"],start:null,type:["1","a","A","i","I"]},children:["li","script","template","ul","ol"]},optgroup:{attrs:{disabled:["disabled"],label:null}},option:{attrs:{disabled:["disabled"],label:null,selected:["selected"],value:null}},output:{attrs:{"for":null,form:null,name:null}},p:S,param:{attrs:{name:null,value:null}},pre:S,progress:{attrs:{value:null,max:null}},q:{attrs:{cite:null}},rp:S,rt:S,ruby:S,samp:S,script:{attrs:{type:["text/javascript"],src:null,async:["async"],defer:["defer"],charset:Charsets}},section:S,select:{attrs:{form:null,name:null,size:null,autofocus:["autofocus"],disabled:["disabled"],multiple:["multiple"]}},slot:{attrs:{name:null}},small:S,source:{attrs:{src:null,type:null,media:null}},span:S,strong:S,style:{attrs:{type:["text/css"],media:null,scoped:null}},sub:S,summary:S,sup:S,table:S,tbody:S,td:{attrs:{colspan:null,rowspan:null,headers:null}},template:S,textarea:{attrs:{dirname:null,form:null,maxlength:null,name:null,placeholder:null,rows:null,cols:null,autofocus:["autofocus"],disabled:["disabled"],readonly:["readonly"],required:["required"],wrap:["soft","hard"]}},tfoot:S,th:{attrs:{colspan:null,rowspan:null,headers:null,scope:["row","col","rowgroup","colgroup"]}},thead:S,time:{attrs:{datetime:null}},title:S,tr:S,track:{attrs:{src:null,label:null,"default":null,kind:["subtitles","captions","descriptions","chapters","metadata"],srclang:null}},ul:{children:["li","script","template","ul","ol"]},"var":S,video:{attrs:{src:null,poster:null,width:null,height:null,crossorigin:["anonymous","use-credentials"],preload:["auto","metadata","none"],autoplay:["autoplay"],mediagroup:["movie"],muted:["muted"],controls:["controls"]}},wbr:S};var GlobalAttrs={accesskey:null,"class":null,contenteditable:Bool,contextmenu:null,dir:["ltr","rtl","auto"],draggable:["true","false","auto"],dropzone:["copy","move","link","string:","file:"],hidden:["hidden"],id:null,inert:["inert"],itemid:null,itemprop:null,itemref:null,itemscope:["itemscope"],itemtype:null,lang:["ar","bn","de","en-GB","en-US","es","fr","hi","id","ja","pa","pt","ru","tr","zh"],spellcheck:Bool,autocorrect:Bool,autocapitalize:Bool,style:null,tabindex:null,title:null,translate:["yes","no"],rel:["stylesheet","alternate","author","bookmark","help","license","next","nofollow","noreferrer","prefetch","prev","search","tag"],role:"alert application article banner button cell checkbox complementary contentinfo dialog document feed figure form grid gridcell heading img list listbox listitem main navigation region row rowgroup search switch tab table tabpanel textbox timer".split(" "),"aria-activedescendant":null,"aria-atomic":Bool,"aria-autocomplete":["inline","list","both","none"],"aria-busy":Bool,"aria-checked":["true","false","mixed","undefined"],"aria-controls":null,"aria-describedby":null,"aria-disabled":Bool,"aria-dropeffect":null,"aria-expanded":["true","false","undefined"],"aria-flowto":null,"aria-grabbed":["true","false","undefined"],"aria-haspopup":Bool,"aria-hidden":Bool,"aria-invalid":["true","false","grammar","spelling"],"aria-label":null,"aria-labelledby":null,"aria-level":null,"aria-live":["off","polite","assertive"],"aria-multiline":Bool,"aria-multiselectable":Bool,"aria-owns":null,"aria-posinset":null,"aria-pressed":["true","false","mixed","undefined"],"aria-readonly":Bool,"aria-relevant":null,"aria-required":Bool,"aria-selected":["true","false","undefined"],"aria-setsize":null,"aria-sort":["ascending","descending","none","other"],"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null,"aria-valuetext":null};var eventAttributes=("beforeunload copy cut dragstart dragover dragleave dragenter dragend "+"drag paste focus blur change click load mousedown mouseenter mouseleave "+"mouseup keydown keyup resize scroll unload").split(" ").map(function(n){return"on"+n});var _iterator459=_createForOfIteratorHelper(eventAttributes),_step459;try{for(_iterator459.s();!(_step459=_iterator459.n()).done;){var a=_step459.value;GlobalAttrs[a]=null}}catch(err){_iterator459.e(err)}finally{_iterator459.f()}var Schema=_createClass2(function Schema(extraTags,extraAttrs){_classCallCheck2(this,Schema);this.tags=Object.assign(Object.assign({},Tags),extraTags);this.globalAttrs=Object.assign(Object.assign({},GlobalAttrs),extraAttrs);this.allTags=Object.keys(this.tags);this.globalAttrNames=Object.keys(this.globalAttrs)});Schema["default"]=new Schema;function elementName(doc,tree){var max=arguments.length>2&&arguments[2]!==undefined?arguments[2]:doc.length;if(!tree)return"";var tag=tree.firstChild;var name=tag&&tag.getChild("TagName");return name?doc.sliceString(name.from,Math.min(name.to,max)):""}function findParentElement(tree){var skip=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;for(;tree;tree=tree.parent)if(tree.name=="Element"){if(skip)skip=false;else return tree}return null}function allowedChildren(doc,tree,schema){var parentInfo=schema.tags[elementName(doc,findParentElement(tree))];return(parentInfo===null||parentInfo===void 0?void 0:parentInfo.children)||schema.allTags}function openTags(doc,tree){var open=[];for(var parent=findParentElement(tree);parent&&!parent.type.isTop;parent=findParentElement(parent.parent)){var tagName=elementName(doc,parent);if(tagName&&parent.lastChild.name=="CloseTag")break;if(tagName&&open.indexOf(tagName)<0&&(tree.name=="EndTag"||tree.from>=parent.firstChild.to))open.push(tagName)}return open}var identifier=/^[:\-\.\w\u00b7-\uffff]*$/;function completeTag(state,schema,tree,from,to){var end=/\s*>/.test(state.sliceDoc(to,to+5))?"":">";var parent=findParentElement(tree,true);return{from:from,to:to,options:allowedChildren(state.doc,parent,schema).map(function(tagName){return{label:tagName,type:"type"}}).concat(openTags(state.doc,tree).map(function(tag,i){return{label:"/"+tag,apply:"/"+tag+end,type:"type",boost:99-i}})),validFor:/^\/?[:\-\.\w\u00b7-\uffff]*$/}}function completeCloseTag(state,tree,from,to){var end=/\s*>/.test(state.sliceDoc(to,to+5))?"":">";return{from:from,to:to,options:openTags(state.doc,tree).map(function(tag,i){return{label:tag,apply:tag+end,type:"type",boost:99-i}}),validFor:identifier}}function completeStartTag(state,schema,tree,pos){var options=[],level=0;var _iterator460=_createForOfIteratorHelper(allowedChildren(state.doc,tree,schema)),_step460;try{for(_iterator460.s();!(_step460=_iterator460.n()).done;){var tagName=_step460.value;options.push({label:"<"+tagName,type:"type"})}}catch(err){_iterator460.e(err)}finally{_iterator460.f()}var _iterator461=_createForOfIteratorHelper(openTags(state.doc,tree)),_step461;try{for(_iterator461.s();!(_step461=_iterator461.n()).done;){var open=_step461.value;options.push({label:"</"+open+">",type:"type",boost:99-level++})}}catch(err){_iterator461.e(err)}finally{_iterator461.f()}return{from:pos,to:pos,options:options,validFor:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}function completeAttrName(state,schema,tree,from,to){var elt=findParentElement(tree),info=elt?schema.tags[elementName(state.doc,elt)]:null;var localAttrs=info&&info.attrs?Object.keys(info.attrs):[];var names=info&&info.globalAttrs===false?localAttrs:localAttrs.length?localAttrs.concat(schema.globalAttrNames):schema.globalAttrNames;return{from:from,to:to,options:names.map(function(attrName){return{label:attrName,type:"property"}}),validFor:identifier}}function completeAttrValue(state,schema,tree,from,to){var _a;var nameNode=(_a=tree.parent)===null||_a===void 0?void 0:_a.getChild("AttributeName");var options=[],token=undefined;if(nameNode){var attrName=state.sliceDoc(nameNode.from,nameNode.to);var attrs=schema.globalAttrs[attrName];if(!attrs){var elt=findParentElement(tree),info=elt?schema.tags[elementName(state.doc,elt)]:null;attrs=(info===null||info===void 0?void 0:info.attrs)&&info.attrs[attrName]}if(attrs){var _base6=state.sliceDoc(from,to).toLowerCase(),quoteStart="\"",quoteEnd="\"";if(/^['"]/.test(_base6)){token=_base6[0]=="\""?/^[^"]*$/:/^[^']*$/;quoteStart="";quoteEnd=state.sliceDoc(to,to+1)==_base6[0]?"":_base6[0];_base6=_base6.slice(1);from++}else{token=/^[^\s<>='"]*$/}var _iterator462=_createForOfIteratorHelper(attrs),_step462;try{for(_iterator462.s();!(_step462=_iterator462.n()).done;){var value=_step462.value;options.push({label:value,apply:quoteStart+value+quoteEnd,type:"constant"})}}catch(err){_iterator462.e(err)}finally{_iterator462.f()}}}return{from:from,to:to,options:options,validFor:token}}function htmlCompletionFor(schema,context){var state=context.state,pos=context.pos,tree=syntaxTree(state).resolveInner(pos,-1),around=tree.resolve(pos);for(var scan=pos,_before4;around==tree&&(_before4=tree.childBefore(scan));){var last=_before4.lastChild;if(!last||!last.type.isError||last.from<last.to)break;around=tree=_before4;scan=last.from}if(tree.name=="TagName"){return tree.parent&&/CloseTag$/.test(tree.parent.name)?completeCloseTag(state,tree,tree.from,pos):completeTag(state,schema,tree,tree.from,pos)}else if(tree.name=="StartTag"){return completeTag(state,schema,tree,pos,pos)}else if(tree.name=="StartCloseTag"||tree.name=="IncompleteCloseTag"){return completeCloseTag(state,tree,pos,pos)}else if(context.explicit&&(tree.name=="OpenTag"||tree.name=="SelfClosingTag")||tree.name=="AttributeName"){return completeAttrName(state,schema,tree,tree.name=="AttributeName"?tree.from:pos,pos)}else if(tree.name=="Is"||tree.name=="AttributeValue"||tree.name=="UnquotedAttributeValue"){return completeAttrValue(state,schema,tree,tree.name=="Is"?pos:tree.from,pos)}else if(context.explicit&&(around.name=="Element"||around.name=="Text"||around.name=="Document")){return completeStartTag(state,schema,tree,pos)}else{return null}}function htmlCompletionSource(context){return htmlCompletionFor(Schema["default"],context)}function htmlCompletionSourceWith(config){var extraTags=config.extraTags,extraAttrs=config.extraGlobalAttributes;var schema=extraAttrs||extraTags?new Schema(extraTags,extraAttrs):Schema["default"];return function(context){return htmlCompletionFor(schema,context)}}var jsonParser=javascriptLanguage.parser.configure({top:"SingleExpression"});var defaultNesting=[{tag:"script",attrs:function attrs(_attrs2){return _attrs2.type=="text/typescript"||_attrs2.lang=="ts"},parser:typescriptLanguage.parser},{tag:"script",attrs:function attrs(_attrs3){return _attrs3.type=="text/babel"||_attrs3.type=="text/jsx"},parser:jsxLanguage.parser},{tag:"script",attrs:function attrs(_attrs4){return _attrs4.type=="text/typescript-jsx"},parser:tsxLanguage.parser},{tag:"script",attrs:function attrs(_attrs5){return /^(importmap|speculationrules|application\/(.+\+)?json)$/i.test(_attrs5.type)},parser:jsonParser},{tag:"script",attrs:function attrs(_attrs6){return!_attrs6.type||/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i.test(_attrs6.type)},parser:javascriptLanguage.parser},{tag:"style",attrs:function attrs(_attrs7){return(!_attrs7.lang||_attrs7.lang=="css")&&(!_attrs7.type||/^(text\/)?(x-)?(stylesheet|css)$/i.test(_attrs7.type))},parser:cssLanguage.parser}];var defaultAttrs=[{name:"style",parser:cssLanguage.parser.configure({top:"Styles"})}].concat(eventAttributes.map(function(name){return{name:name,parser:javascriptLanguage.parser}}));var htmlPlain=LRLanguage.define({name:"html",parser:parser$2.configure({props:[indentNodeProp.add({Element:function Element(context){var after=/^(\s*)(<\/)?/.exec(context.textAfter);if(context.node.to<=context.pos+after[0].length)return context["continue"]();return context.lineIndent(context.node.from)+(after[2]?0:context.unit)},"OpenTag CloseTag SelfClosingTag":function OpenTagCloseTagSelfClosingTag(context){return context.column(context.node.from)+context.unit},Document:function Document(context){if(context.pos+/\s*/.exec(context.textAfter)[0].length<context.node.to)return context["continue"]();var endElt=null,close;for(var _cur27=context.node;;){var last=_cur27.lastChild;if(!last||last.name!="Element"||last.to!=_cur27.to)break;endElt=_cur27=last}if(endElt&&!((close=endElt.lastChild)&&(close.name=="CloseTag"||close.name=="SelfClosingTag")))return context.lineIndent(endElt.from)+context.unit;return null}}),foldNodeProp.add({Element:function Element(node){var first=node.firstChild,last=node.lastChild;if(!first||first.name!="OpenTag")return null;return{from:first.to,to:last.name=="CloseTag"?last.from:node.to}}}),bracketMatchingHandle.add({"OpenTag CloseTag":function OpenTagCloseTag(node){return node.getChild("TagName")}})]}),languageData:{commentTokens:{block:{open:"<!--",close:"-->"}},indentOnInput:/^\s*<\/\w+\W$/,wordChars:"-._"}});var htmlLanguage=htmlPlain.configure({wrap:configureNesting(defaultNesting,defaultAttrs)});function html(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var dialect="",wrap;if(config.matchClosingTags===false)dialect="noMatch";if(config.selfClosingTags===true)dialect=(dialect?dialect+" ":"")+"selfClosing";if(config.nestedLanguages&&config.nestedLanguages.length||config.nestedAttributes&&config.nestedAttributes.length)wrap=configureNesting((config.nestedLanguages||[]).concat(defaultNesting),(config.nestedAttributes||[]).concat(defaultAttrs));var lang=wrap?htmlPlain.configure({wrap:wrap,dialect:dialect}):dialect?htmlLanguage.configure({dialect:dialect}):htmlLanguage;return new LanguageSupport(lang,[htmlLanguage.data.of({autocomplete:htmlCompletionSourceWith(config)}),config.autoCloseTags!==false?autoCloseTags:[],javascript().support,css().support])}var selfClosers=new Set("area base br col command embed frame hr img input keygen link meta param source track wbr menuitem".split(" "));var autoCloseTags=EditorView.inputHandler.of(function(view,from,to,text,insertTransaction){if(view.composing||view.state.readOnly||from!=to||text!=">"&&text!="/"||!htmlLanguage.isActiveAt(view.state,from,-1))return false;var base=insertTransaction(),state=base.state;var closeTags=state.changeByRange(function(range){var _a,_b,_c;var didType=state.doc.sliceString(range.from-1,range.to)==text;var head=range.head,around=syntaxTree(state).resolveInner(head-1,-1),name;if(around.name=="TagName"||around.name=="StartTag")around=around.parent;if(didType&&text==">"&&around.name=="OpenTag"){if(((_b=(_a=around.parent)===null||_a===void 0?void 0:_a.lastChild)===null||_b===void 0?void 0:_b.name)!="CloseTag"&&(name=elementName(state.doc,around.parent,head))&&!selfClosers.has(name)){var _to4=head+(state.doc.sliceString(head,head+1)===">"?1:0);var _insert4="</".concat(name,">");return{range:range,changes:{from:head,to:_to4,insert:_insert4}}}}else if(didType&&text=="/"&&around.name=="IncompleteCloseTag"){var _base7=around.parent;if(around.from==head-2&&((_c=_base7.lastChild)===null||_c===void 0?void 0:_c.name)!="CloseTag"&&(name=elementName(state.doc,_base7,head))&&!selfClosers.has(name)){var _to5=head+(state.doc.sliceString(head,head+1)===">"?1:0);var _insert5="".concat(name,">");return{range:EditorSelection.cursor(head+_insert5.length,-1),changes:{from:head,to:_to5,insert:_insert5}}}}return{range:range}});if(closeTags.changes.empty)return false;view.dispatch([base,state.update(closeTags,{userEvent:"input.complete",scrollIntoView:true})]);return true});var data=defineLanguageFacet({commentTokens:{block:{open:"<!--",close:"-->"}}});var headingProp=new NodeProp;var commonmark=parser$3.configure({props:[foldNodeProp.add(function(type){return!type.is("Block")||type.is("Document")||isHeading(type)!=null?undefined:function(tree,state){return{from:state.doc.lineAt(tree.from).to,to:tree.to}}}),headingProp.add(isHeading),indentNodeProp.add({Document:function Document(){return null}}),languageDataProp.add({Document:data})]});function isHeading(type){var match=/^(?:ATX|Setext)Heading(\d)$/.exec(type.name);return match?+match[1]:undefined}function findSectionEnd(headerNode,level){var last=headerNode;for(;;){var next=last.nextSibling,_heading=void 0;if(!next||(_heading=isHeading(next.type))!=null&&_heading<=level)break;last=next}return last.to}var headerIndent=foldService.of(function(state,start,end){for(var node=syntaxTree(state).resolveInner(end,-1);node;node=node.parent){if(node.from<start)break;var _heading2=node.type.prop(headingProp);if(_heading2==null)continue;var upto=findSectionEnd(node,_heading2);if(upto>end)return{from:end,to:upto}}return null});function mkLang(parser){return new Language(data,parser,[headerIndent],"markdown")}var commonmarkLanguage=mkLang(commonmark);var extended=commonmark.configure([GFM,Subscript,Superscript,Emoji,{props:[foldNodeProp.add({Table:function Table(tree,state){return{from:state.doc.lineAt(tree.from).to,to:tree.to}}})]}]);var markdownLanguage=mkLang(extended);function getCodeParser(languages,defaultLanguage){return function(info){if(info&&languages){var found=null;info=/\S*/.exec(info)[0];if(typeof languages=="function")found=languages(info);else found=LanguageDescription.matchLanguageName(languages,info,true);if(found instanceof LanguageDescription)return found.support?found.support.language.parser:ParseContext.getSkippingParser(found.load());else if(found)return found.parser}return defaultLanguage?defaultLanguage.parser:null}}var Context=function(){function Context(node,from,to,spaceBefore,spaceAfter,type,item){_classCallCheck2(this,Context);this.node=node;this.from=from;this.to=to;this.spaceBefore=spaceBefore;this.spaceAfter=spaceAfter;this.type=type;this.item=item}_createClass2(Context,[{key:"blank",value:function blank(maxWidth){var trailing=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var result=this.spaceBefore+(this.node.name=="Blockquote"?">":"");if(maxWidth!=null){while(result.length<maxWidth)result+=" ";return result}else{for(var _i317=this.to-this.from-result.length-this.spaceAfter.length;_i317>0;_i317--)result+=" ";return result+(trailing?this.spaceAfter:"")}}},{key:"marker",value:function marker(doc,add){var number=this.node.name=="OrderedList"?String(+itemNumber(this.item,doc)[2]+add):"";return this.spaceBefore+number+this.type+this.spaceAfter}}]);return Context}();function getContext(node,doc){var nodes=[];for(var _cur28=node;_cur28&&_cur28.name!="Document";_cur28=_cur28.parent){if(_cur28.name=="ListItem"||_cur28.name=="Blockquote"||_cur28.name=="FencedCode")nodes.push(_cur28)}var context=[];for(var _i318=nodes.length-1;_i318>=0;_i318--){var _node4=nodes[_i318],match=void 0;var line=doc.lineAt(_node4.from),startPos=_node4.from-line.from;if(_node4.name=="FencedCode"){context.push(new Context(_node4,startPos,startPos,"","","",null))}else if(_node4.name=="Blockquote"&&(match=/^ *>( ?)/.exec(line.text.slice(startPos)))){context.push(new Context(_node4,startPos,startPos+match[0].length,"",match[1],">",null))}else if(_node4.name=="ListItem"&&_node4.parent.name=="OrderedList"&&(match=/^( *)\d+([.)])( *)/.exec(line.text.slice(startPos)))){var _after8=match[3],len=match[0].length;if(_after8.length>=4){_after8=_after8.slice(0,_after8.length-4);len-=4}context.push(new Context(_node4.parent,startPos,startPos+len,match[1],_after8,match[2],_node4))}else if(_node4.name=="ListItem"&&_node4.parent.name=="BulletList"&&(match=/^( *)([-+*])( {1,4}\[[ xX]\])?( +)/.exec(line.text.slice(startPos)))){var _after9=match[4],_len17=match[0].length;if(_after9.length>4){_after9=_after9.slice(0,_after9.length-4);_len17-=4}var type=match[2];if(match[3])type+=match[3].replace(/[xX]/," ");context.push(new Context(_node4.parent,startPos,startPos+_len17,match[1],_after9,type,_node4))}}return context}function itemNumber(item,doc){return /^(\s*)(\d+)(?=[.)])/.exec(doc.sliceString(item.from,item.from+10))}function renumberList(after,doc,changes){var offset=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;for(var prev=-1,node=after;;){if(node.name=="ListItem"){var m=itemNumber(node,doc);var _number=+m[2];if(prev>=0){if(_number!=prev+1)return;changes.push({from:node.from+m[1].length,to:node.from+m[0].length,insert:String(prev+2+offset)})}prev=_number}var next=node.nextSibling;if(!next)break;node=next}}function normalizeIndent(content,state){var blank=/^[ \t]*/.exec(content)[0].length;if(!blank||state.facet(indentUnit)!="\t")return content;var col=_countColumn(content,4,blank);var space="";for(var _i319=col;_i319>0;){if(_i319>=4){space+="\t";_i319-=4}else{space+=" ";_i319--}}return space+content.slice(blank)}var insertNewlineContinueMarkup=function insertNewlineContinueMarkup(_ref280){var state=_ref280.state,dispatch=_ref280.dispatch;var tree=syntaxTree(state),doc=state.doc;var dont=null,changes=state.changeByRange(function(range){if(!range.empty||!markdownLanguage.isActiveAt(state,range.from))return dont={range:range};var pos=range.from,line=doc.lineAt(pos);var context=getContext(tree.resolveInner(pos,-1),doc);while(context.length&&context[context.length-1].from>pos-line.from)context.pop();if(!context.length)return dont={range:range};var inner=context[context.length-1];if(inner.to-inner.spaceAfter.length>pos-line.from)return dont={range:range};var emptyLine=pos>=inner.to-inner.spaceAfter.length&&!/\S/.test(line.text.slice(inner.to));if(inner.item&&emptyLine){if(inner.node.firstChild.to>=pos||line.from>0&&!/[^\s>]/.test(doc.lineAt(line.from-1).text)){var next=context.length>1?context[context.length-2]:null;var delTo,_insert6="";if(next&&next.item){delTo=line.from+next.from;_insert6=next.marker(doc,1)}else{delTo=line.from+(next?next.to:0)}var _changes3=[{from:delTo,to:pos,insert:_insert6}];if(inner.node.name=="OrderedList")renumberList(inner.item,doc,_changes3,-2);if(next&&next.node.name=="OrderedList")renumberList(next.item,doc,_changes3);return{range:EditorSelection.cursor(delTo+_insert6.length),changes:_changes3}}else{var _insert7="";for(var _i320=0,e=context.length-2;_i320<=e;_i320++){_insert7+=context[_i320].blank(_i320<e?_countColumn(line.text,4,context[_i320+1].from)-_insert7.length:null,_i320<e)}_insert7=normalizeIndent(_insert7,state);return{range:EditorSelection.cursor(pos+_insert7.length+1),changes:{from:line.from,insert:_insert7+state.lineBreak}}}}if(inner.node.name=="Blockquote"&&emptyLine&&line.from){var prevLine=doc.lineAt(line.from-1),quoted=/>\s*$/.exec(prevLine.text);if(quoted&&quoted.index==inner.from){var _changes4=state.changes([{from:prevLine.from+quoted.index,to:prevLine.to},{from:line.from+inner.from,to:line.to}]);return{range:range.map(_changes4),changes:_changes4}}}var changes=[];if(inner.node.name=="OrderedList")renumberList(inner.item,doc,changes);var continued=inner.item&&inner.item.from<line.from;var insert="";if(!continued||/^[\s\d.)\-+*>]*/.exec(line.text)[0].length>=inner.to){for(var _i321=0,_e3=context.length-1;_i321<=_e3;_i321++){insert+=_i321==_e3&&!continued?context[_i321].marker(doc,1):context[_i321].blank(_i321<_e3?_countColumn(line.text,4,context[_i321+1].from)-insert.length:null)}}var from=pos;while(from>line.from&&/\s/.test(line.text.charAt(from-line.from-1)))from--;insert=normalizeIndent(insert,state);changes.push({from:from,to:pos,insert:state.lineBreak+insert});return{range:EditorSelection.cursor(from+insert.length+1),changes:changes}});if(dont)return false;dispatch(state.update(changes,{scrollIntoView:true,userEvent:"input"}));return true};function isMark(node){return node.name=="QuoteMark"||node.name=="ListMark"}function contextNodeForDelete(tree,pos){var node=tree.resolveInner(pos,-1),scan=pos;if(isMark(node)){scan=node.from;node=node.parent}for(var prev;prev=node.childBefore(scan);){if(isMark(prev)){scan=prev.from}else if(prev.name=="OrderedList"||prev.name=="BulletList"){node=prev.lastChild;scan=node.to}else{break}}return node}var deleteMarkupBackward=function deleteMarkupBackward(_ref281){var state=_ref281.state,dispatch=_ref281.dispatch;var tree=syntaxTree(state);var dont=null,changes=state.changeByRange(function(range){var pos=range.from,doc=state.doc;if(range.empty&&markdownLanguage.isActiveAt(state,range.from)){var line=doc.lineAt(pos);var context=getContext(contextNodeForDelete(tree,pos),doc);if(context.length){var inner=context[context.length-1];var spaceEnd=inner.to-inner.spaceAfter.length+(inner.spaceAfter?1:0);if(pos-line.from>spaceEnd&&!/\S/.test(line.text.slice(spaceEnd,pos-line.from)))return{range:EditorSelection.cursor(line.from+spaceEnd),changes:{from:line.from+spaceEnd,to:pos}};if(pos-line.from==spaceEnd&&(!inner.item||line.from<=inner.item.from||!/\S/.test(line.text.slice(0,inner.to)))){var _start25=line.from+inner.from;if(inner.item&&inner.node.from<inner.item.from&&/\S/.test(line.text.slice(inner.from,inner.to))){var _insert8=inner.blank(_countColumn(line.text,4,inner.to)-_countColumn(line.text,4,inner.from));if(_start25==line.from)_insert8=normalizeIndent(_insert8,state);return{range:EditorSelection.cursor(_start25+_insert8.length),changes:{from:_start25,to:line.from+inner.to,insert:_insert8}}}if(_start25<pos)return{range:EditorSelection.cursor(_start25),changes:{from:_start25,to:pos}}}}}return dont={range:range}});if(dont)return false;dispatch(state.update(changes,{scrollIntoView:true,userEvent:"delete"}));return true};var markdownKeymap=[{key:"Enter",run:insertNewlineContinueMarkup},{key:"Backspace",run:deleteMarkupBackward}];var htmlNoMatch=html({matchClosingTags:false});function markdown(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var codeLanguages=config.codeLanguages,defaultCodeLanguage=config.defaultCodeLanguage,_config$addKeymap=config.addKeymap,addKeymap=_config$addKeymap===void 0?true:_config$addKeymap,_config$base=config.base,_config$base2=_config$base===void 0?commonmarkLanguage:_config$base,parser=_config$base2.parser,_config$completeHTMLT=config.completeHTMLTags,completeHTMLTags=_config$completeHTMLT===void 0?true:_config$completeHTMLT;if(!(parser instanceof MarkdownParser))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");var extensions=config.extensions?[config.extensions]:[];var support=[htmlNoMatch.support],defaultCode;if(defaultCodeLanguage instanceof LanguageSupport){support.push(defaultCodeLanguage.support);defaultCode=defaultCodeLanguage.language}else if(defaultCodeLanguage){defaultCode=defaultCodeLanguage}var codeParser=codeLanguages||defaultCode?getCodeParser(codeLanguages,defaultCode):undefined;extensions.push(parseCode({codeParser:codeParser,htmlParser:htmlNoMatch.language.parser}));if(addKeymap)support.push(Prec.high(keymap.of(markdownKeymap)));var lang=mkLang(parser.configure(extensions));if(completeHTMLTags)support.push(lang.data.of({autocomplete:htmlTagCompletion}));return new LanguageSupport(lang,support)}function htmlTagCompletion(context){var state=context.state,pos=context.pos,m=/<[:\-\.\w\u00b7-\uffff]*$/.exec(state.sliceDoc(pos-25,pos));if(!m)return null;var tree=syntaxTree(state).resolveInner(pos,-1);while(tree&&!tree.type.isTop){if(tree.name=="CodeBlock"||tree.name=="FencedCode"||tree.name=="ProcessingInstructionBlock"||tree.name=="CommentBlock"||tree.name=="Link"||tree.name=="Image")return null;tree=tree.parent}return{from:pos-m[0].length,to:pos,options:htmlTagCompletions(),validFor:/^<[:\-\.\w\u00b7-\uffff]*$/}}var _tagCompletions=null;function htmlTagCompletions(){if(_tagCompletions)return _tagCompletions;var result=htmlCompletionSource(new CompletionContext(EditorState.create({extensions:htmlNoMatch}),0,true));return _tagCompletions=result?result.options:[]}var mentionMatcher=new MatchDecorator({regexp:/(\[(.+?)\])(\(@u(\d+)\))/g,decoration:function decoration(match){return Decoration.replace({inclusive:true,widget:new MentionWidget(match)})}});var MentionWidget=function(_WidgetType11){_inherits2(MentionWidget,_WidgetType11);var _super112=_createSuper(MentionWidget);function MentionWidget(match){var _this274;_classCallCheck2(this,MentionWidget);_this274=_super112.call(this);_this274.match=match;return _this274}_createClass2(MentionWidget,[{key:"eq",value:function eq(other){return other.match[1]===this.match[1]}},{key:"toDOM",value:function toDOM(){var wrap=document.createElement("span");wrap.className="wy-mention";wrap.innerHTML=typeof this.match[5]!=="undefined"?this.match[5]:this.match[2];return wrap}},{key:"ignoreEvent",value:function ignoreEvent(){return false}}]);return MentionWidget}(WidgetType);var mentions=ViewPlugin.fromClass(function(){function _class74(view){_classCallCheck2(this,_class74);this.mentions=mentionMatcher.createDeco(view)}_createClass2(_class74,[{key:"update",value:function update(_update27){this.mentions=mentionMatcher.updateDeco(_update27,this.mentions)}}]);return _class74}(),{decorations:function decorations(instance){return instance.mentions},provide:function provide(plugin){return EditorView.atomicRanges.of(function(view){var _a;return((_a=view.plugin(plugin))===null||_a===void 0?void 0:_a.mentions)||Decoration.none})}});function useEmbeds(callback){var _React$useContext27=React.useContext(WeavyContext),client=_React$useContext27.client;var regexp=/(((https?|ftp):\/\/|(www|ftp)\.)[\w]+(.[\w]+)([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#]))/gmi;var _React$useState91=React.useState([]),_React$useState92=_slicedToArray2(_React$useState91,2),latest=_React$useState92[0],setLatest=_React$useState92[1];var _React$useState93=React.useState([]),_React$useState94=_slicedToArray2(_React$useState93,2),embeds=_React$useState94[0],setEmbeds=_React$useState94[1];var _React$useState95=React.useState([]),_React$useState96=_slicedToArray2(_React$useState95,2),failed=_React$useState96[0],setFailed=_React$useState96[1];var _React$useState97=React.useState([]),_React$useState98=_slicedToArray2(_React$useState97,2),rejected=_React$useState98[0],setRejected=_React$useState98[1];var _React$useState99=React.useState({}),_React$useState100=_slicedToArray2(_React$useState99,2),candidates=_React$useState100[0],setCandidates=_React$useState100[1];if(!client){throw new Error("useEmbeds must be used within an WeavyProvider")}var arrayEquals=function arrayEquals(a,b){return a.length===b.length&&a.every(function(v,i){return v===b[i]})};var fetchEmbed=function(){var _ref282=_asyncToGenerator(_regeneratorRuntime().mark(function _callee136(url){var data,response,json;return _regeneratorRuntime().wrap(function _callee136$(_context138){while(1)switch(_context138.prev=_context138.next){case 0:data=new FormData;data.append("url",url);_context138.prev=2;_context138.next=5;return client.post("/api/embeds","POST",JSON.stringify({url:url}));case 5:response=_context138.sent;if(response.ok){_context138.next=8;break}throw new Error;case 8:_context138.next=10;return response.json();case 10:json=_context138.sent;setEmbeds(function(prev){return[].concat(_toConsumableArray2(prev),[url])});setCandidates(function(prev){delete prev[url];return prev});callback(json);_context138.next=20;break;case 16:_context138.prev=16;_context138.t0=_context138["catch"](2);setFailed(function(prev){return[].concat(_toConsumableArray2(prev),[url])});setCandidates(function(prev){delete prev[url];return prev});case 20:case"end":return _context138.stop()}},_callee136,null,[[2,16]])}));return function fetchEmbed(_x112){return _ref282.apply(this,arguments)}}();var initEmbeds=function initEmbeds(urls){setEmbeds(urls)};var clearEmbeds=function clearEmbeds(){setLatest([]);setEmbeds([]);setFailed([]);setRejected([]);setCandidates({})};var getEmbeds=function(){var _ref283=_asyncToGenerator(_regeneratorRuntime().mark(function _callee137(content){var _a,matches,_loop31,candidate;return _regeneratorRuntime().wrap(function _callee137$(_context140){while(1)switch(_context140.prev=_context140.next){case 0:matches=((_a=content.match(regexp))===null||_a===void 0?void 0:_a.map(function(match){return match}))||null;if(matches!==null){matches=matches.map(function(url){if(url.startsWith("//")){return"http:"+url}else if(!url.startsWith("http://")&&!url.startsWith("https://")){return"http://"+url}else{return url}})}if(!(matches===null||matches.length===0)){_context140.next=6;break};_context140.next=17;break;case 6:if(!(matches.length!==latest.length||!arrayEquals(matches,latest))){_context140.next=17;break}setLatest(matches);matches.forEach(function(match){if(!embeds.includes(match)&&!failed.includes(match)&&!rejected.includes(match)&&typeof candidates[match]==="undefined"){setCandidates(function(prev){prev[match]=setTimeout(function(){fetchEmbed(match)},500);return prev})}});setRejected(function(prev){return prev.filter(function(rejected){return latest.includes(rejected)})});_loop31=_regeneratorRuntime().mark(function _loop31(candidate){return _regeneratorRuntime().wrap(function _loop31$(_context139){while(1)switch(_context139.prev=_context139.next){case 0:if(!latest.includes(candidate)){clearTimeout(candidates[candidate]);setCandidates(function(prev){delete prev[candidate];return prev})}case 1:case"end":return _context139.stop()}},_loop31)});_context140.t0=_regeneratorRuntime().keys(candidates);case 12:if((_context140.t1=_context140.t0()).done){_context140.next=17;break}candidate=_context140.t1.value;return _context140.delegateYield(_loop31(candidate),"t2",15);case 15:_context140.next=12;break;case 17:case"end":return _context140.stop()}},_callee137)}));return function getEmbeds(_x113){return _ref283.apply(this,arguments)}}();return{getEmbeds:getEmbeds,initEmbeds:initEmbeds,clearEmbeds:clearEmbeds}}var Blob$1=function Blob$1(_ref284){var id=_ref284.id,name=_ref284.name,className=_ref284.className,children=_ref284.children;var ext=getExtension(name);var _getIcon2=getIcon(name),icon=_getIcon2.icon;var kind=getKind(name);return React.createElement("div",{className:"wy-item"},React.createElement(UIIcon.UI,{name:icon,size:24,className:classNames("wy-kind-"+toKebabCase(kind),"wy-ext-"+ext.substring(1))}),React.createElement("div",{className:"wy-item-body"},name),children)};var Embed=function Embed(_ref285){var embed=_ref285.embed,onRemove=_ref285.onRemove,onSwap=_ref285.onSwap;var giphy=embed.type==="photo"&&embed.provider_name.toLocaleLowerCase()==="giphy";var caption=!embed.html&&!giphy;return React.createElement("div",{className:"wy-embed"},React.createElement("div",{className:"wy-embed-actions"},onSwap&&React.createElement(UIButton.UI,{title:"Switch",onClick:onSwap},React.createElement(UIIcon.UI,{name:"swap-horizontal"})),!onSwap&&React.createElement(UIButton.UI,{className:"wy-embed-cycle"}),onRemove&&React.createElement(UIButton.UI,{title:"Remove",onClick:function onClick(){return onRemove(embed.id)}},React.createElement(UIIcon.UI,{name:"close-circle"}))),embed.type==="audio"&&React.createElement("div",{className:"wy-embed-audio"}),embed.type==="video"&&embed.html&&React.createElement("div",{className:"wy-embed-video"},React.createElement("div",{dangerouslySetInnerHTML:{__html:embed.html}})),embed.type==="rich"&&React.createElement("div",{className:"wy-embed-rich"}),embed.type==="photo"&&embed.thumbnail_url&&React.createElement("div",{className:"wy-embed-photo"+((embed.thumbnail_width||0)<250?"wy-embed-photo-sm":"")},React.createElement("a",{href:embed.original_url,target:"_blank"},React.createElement("img",{src:embed.thumbnail_url,width:embed.thumbnail_width,height:embed.thumbnail_height,alt:""}))),embed.type!=="audio"&&embed.type!=="video"&&embed.type!=="rich"&&embed.type!=="photo"&&embed.thumbnail_url&&React.createElement("div",{className:"wy-embed-photo"+((embed.thumbnail_width||0)<250?"wy-embed-photo-sm":"")},React.createElement("a",{href:embed.original_url,target:"_blank"},React.createElement("img",{src:embed.thumbnail_url,width:embed.thumbnail_width,height:embed.thumbnail_height,alt:""}))),caption&&React.createElement("div",{className:"wy-embed-caption"},React.createElement("a",{className:"wy-embed-link",href:embed.original_url,target:"_blank"},embed.host),embed.title&&React.createElement("div",{className:"wy-embed-title"},embed.title),embed.description&&React.createElement("div",{className:"wy-embed-description"},embed.description)))};function useCloudFiles(callback){var _React$useContext28=React.useContext(CloudFilesContext),open=_React$useContext28.open;var openCloudFiles=function openCloudFiles(){open(callback)};return{openCloudFiles:openCloudFiles}}function useMutateTyping(){var _React$useContext29=React.useContext(WeavyContext),client=_React$useContext29.client;if(!client){throw new Error("useMutateTyping must be used within an WeavyProvider")}var mutateTyping=function(){var _ref287=_asyncToGenerator(_regeneratorRuntime().mark(function _callee138(_ref286){var id,type,location,response;return _regeneratorRuntime().wrap(function _callee138$(_context141){while(1)switch(_context141.prev=_context141.next){case 0:id=_ref286.id,type=_ref286.type,location=_ref286.location;_context141.next=3;return client.post("/api/".concat(location,"/").concat(id,"/").concat(type,"/typing"),"PUT",JSON.stringify({}));case 3:response=_context141.sent;return _context141.abrupt("return",response);case 5:case"end":return _context141.stop()}},_callee138)}));return function mutateTyping(_x114){return _ref287.apply(this,arguments)}}();return useMutation(mutateTyping,{})}function useMutateMeeting(){var _React$useContext30=React.useContext(WeavyContext),client=_React$useContext30.client;useQueryClient();if(!client){throw new Error("useMutateMeeting must be used within an WeavyProvider")}var mutateMeeting=function(){var _ref289=_asyncToGenerator(_regeneratorRuntime().mark(function _callee139(_ref288){var provider,response;return _regeneratorRuntime().wrap(function _callee139$(_context142){while(1)switch(_context142.prev=_context142.next){case 0:provider=_ref288.provider;_context142.next=3;return client.post("/api/meetings","POST",JSON.stringify({provider:provider}));case 3:response=_context142.sent;return _context142.abrupt("return",response.json());case 5:case"end":return _context142.stop()}},_callee139)}));return function mutateMeeting(_x115){return _ref289.apply(this,arguments)}}();return useMutation(mutateMeeting,{onSuccess:function onSuccess(variables){}})}var Meetings=function Meetings(_ref290){var onMeetingAdded=_ref290.onMeetingAdded,_ref290$dropdown=_ref290.dropdown,dropdown=_ref290$dropdown===void 0?false:_ref290$dropdown;var _React$useContext31=React.useContext(WeavyContext),options=_React$useContext31.options;var _React$useContext32=React.useContext(UserContext),user=_React$useContext32.user;var addMeeting=useMutateMeeting();React.useEffect(function(){window.addEventListener("message",createMeeting);return function(){window.removeEventListener("message",createMeeting)}},[onMeetingAdded]);var createMeeting=function(){var _ref291=_asyncToGenerator(_regeneratorRuntime().mark(function _callee140(e){var meeting;return _regeneratorRuntime().wrap(function _callee140$(_context143){while(1)switch(_context143.prev=_context143.next){case 0:_context143.t0=e.data.name;_context143.next=_context143.t0==="zoom-signed-in"?3:8;break;case 3:_context143.next=5;return addMeeting.mutateAsync({provider:"zoom"});case 5:meeting=_context143.sent;onMeetingAdded(meeting);return _context143.abrupt("break",8);case 8:case"end":return _context143.stop()}},_callee140)}));return function createMeeting(_x116){return _ref291.apply(this,arguments)}}();var handleZoom=function handleZoom(){window.open("".concat(options===null||options===void 0?void 0:options.zoomAuthenticationUrl,"&state=").concat(user.id),"zoomAuthWin","height=640,width=480")};return React.createElement(React.Fragment,null,(options===null||options===void 0?void 0:options.zoomAuthenticationUrl)&&dropdown&&React.createElement(UIDropdown.Item,{onClick:handleZoom},React.createElement(UIIcon.UI,{name:"zoom"})," Zoom meeting"),(options===null||options===void 0?void 0:options.zoomAuthenticationUrl)&&!dropdown&&React.createElement(UIButton.UI,{onClick:handleZoom,title:"Zoom meeting"},React.createElement(UIIcon.UI,{name:"zoom"})))};var Meeting=function Meeting(_ref292){var id=_ref292.id,title=_ref292.title,className=_ref292.className;return React.createElement(React.Fragment,null,React.createElement(UIIcon.UI,{name:"zoom"}),React.createElement("div",{className:className},"Zoom meeting"))};function useIsFirstRender(){var isFirst=React.useRef(true);if(isFirst.current){isFirst.current=false;return true}return isFirst.current}function useUpdateEffect(effect,deps){var isFirst=useIsFirstRender();React.useEffect(function(){if(!isFirst){return effect()}},deps)}function useUploadFile(){var _React$useContext33=React.useContext(WeavyContext),client=_React$useContext33.client;if(!client){throw new Error("useMutateFile must be used within an WeavyProvider")}return function(){var _ref293=_asyncToGenerator(_regeneratorRuntime().mark(function _callee141(file,onProgress){var formData,response,blob;return _regeneratorRuntime().wrap(function _callee141$(_context144){while(1)switch(_context144.prev=_context144.next){case 0:formData=new FormData;formData.append("blob",file);_context144.next=4;return client.upload("/api/blobs","POST",formData,"",function(progress){if(onProgress){onProgress({progress:progress})}});case 4:response=_context144.sent;if(response.ok){_context144.next=9;break}_context144.next=8;return response.json();case 8:throw _context144.sent;case 9:_context144.next=11;return response.json();case 11:blob=_context144.sent;return _context144.abrupt("return",blob);case 13:case"end":return _context144.stop()}},_callee141)}));return function(_x117,_x118){return _ref293.apply(this,arguments)}}()}function isFileMutation(mutation){return mutation.state!==undefined}var getTempFile=function getTempFile(file,name){var size=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var type=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"application/octet-stream";var refId=arguments.length>4?arguments[4]:undefined;var user=arguments.length>5?arguments[5]:undefined;var srcUrl=file&&(file instanceof URL?file.toString():URL.createObjectURL(file));var tempFile={id:refId,refId:refId,name:name,kind:getKind(name),size:size,media_type:type,embed_url:"",preview_format:getWebPreviewFormat(name),thumbnail_url:srcUrl,preview_url:srcUrl,download_url:srcUrl,version:-1,created_by:user,created_by_id:user.id,created_at:new Date().toUTCString(),is_subscribed:false,is_trashed:false,status:"pending"};return tempFile};var setMutationContext=function setMutationContext(queryClient,mutationKey,variables,contextMutation){var mutation=queryClient.getMutationCache().find({mutationKey:mutationKey,predicate:function predicate(mutation){return mutation.options.variables===variables}});if(mutation&&mutation.state.context){var newContext=Object.assign({},mutation.state.context);contextMutation(newContext);mutation.setState(Object.assign(Object.assign({},mutation.state),{context:newContext}))}};function useMutatingFileUploads(filesKey){var queryClient=useQueryClient();var _React$useState101=React.useState([]),_React$useState102=_slicedToArray2(_React$useState101,2),mutations=_React$useState102[0],setMutations=_React$useState102[1];var _React$useState103=React.useState(),_React$useState104=_slicedToArray2(_React$useState103,2),status=_React$useState104[0],setStatus=_React$useState104[1];var _React$useState105=React.useState(),_React$useState106=_slicedToArray2(_React$useState105,2),progress=_React$useState106[0],setProgress=_React$useState106[1];var getProgress=function getProgress(mutations){return mutations.reduce(function(combinedProgress,mutation){var _a;var file=(_a=mutation.state.context)===null||_a===void 0?void 0:_a.file;if(file&&file.progress&&file.size){return{loaded:combinedProgress.loaded+file.progress*file.size,total:combinedProgress.total+file.size}}return combinedProgress},{loaded:0,total:0})};var getStatus=function getStatus(mutations){return mutations.some(function(mutation){var _a;return((_a=mutation.state.error)===null||_a===void 0?void 0:_a.status)===409})?"conflict":mutations.some(function(mutation){return mutation.state.status==="error"})?"error":mutations.every(function(mutation){return mutation.state.status==="success"})?"ok":"pending"};var updateMutations=function updateMutations(){var newMutations=queryClient.getMutationCache().findAll({mutationKey:filesKey});setMutations(newMutations)};React.useEffect(function(){updateMutations();return queryClient.getMutationCache().subscribe(function(){return updateMutations()})},_toConsumableArray2(filesKey));React.useEffect(function(){setStatus(getStatus(mutations));var totalProgress=getProgress(mutations);setProgress(totalProgress.total>0?totalProgress.loaded/totalProgress.total:undefined)},[mutations]);return{mutations:mutations,status:status,progress:progress}}function useRemoveMutatingFileUpload(filesKey){var queryClient=useQueryClient();var mutationKey=filesKey;return function(mutation){var _a,_b;if(queryClient.getMutationCache().find({mutationKey:mutationKey,predicate:function predicate(m){return m===mutation}})){updateCacheItem(queryClient,filesKey,((_a=mutation.state.context.file)===null||_a===void 0?void 0:_a.refId)||((_b=mutation.state.context.file)===null||_b===void 0?void 0:_b.id),function(file){return Object.assign(file,{status:"ok",statusText:undefined,progress:undefined})});queryClient.getMutationCache().remove(mutation)}}}function useClearMutatingFileUpload(filesKey){var queryClient=useQueryClient();var mutationKey=filesKey;return function(){var mutations=queryClient.getMutationCache().findAll({mutationKey:mutationKey});mutations.forEach(function(mutation){var _a,_b,_c;if(isFileMutation(mutation)){updateCacheItem(queryClient,filesKey,((_b=(_a=mutation.state.context)===null||_a===void 0?void 0:_a.file)===null||_b===void 0?void 0:_b.refId)||((_c=mutation.state.context.file)===null||_c===void 0?void 0:_c.id),function(file){return Object.assign(file,{status:"ok",statusText:undefined,progress:undefined})})}queryClient.getMutationCache().remove(mutation)})}}function useMutateFileUpload(filesKey,createFile){var queryClient=useQueryClient();var _React$useContext34=React.useContext(UserContext),user=_React$useContext34.user;var mutationKey=filesKey;var uploadFile=useUploadFile();return useMutation(function(){var _ref294=_asyncToGenerator(_regeneratorRuntime().mark(function _callee142(variables){var uploadedFile;return _regeneratorRuntime().wrap(function _callee142$(_context145){while(1)switch(_context145.prev=_context145.next){case 0:_context145.next=2;return uploadFile(variables.file,variables.onProgress);case 2:uploadedFile=_context145.sent;setMutationContext(queryClient,mutationKey,variables,function(context){context.blob=uploadedFile});if(!createFile){_context145.next=10;break}_context145.next=7;return createFile({blob:uploadedFile});case 7:_context145.t0=_context145.sent;_context145.next=11;break;case 10:_context145.t0=uploadedFile;case 11:return _context145.abrupt("return",_context145.t0);case 12:case"end":return _context145.stop()}},_callee142)}));return function(_x119){return _ref294.apply(this,arguments)}}(),{mutationKey:mutationKey,onMutate:function(){var _onMutate7=_asyncToGenerator(_regeneratorRuntime().mark(function _callee143(variables){var _a,files,file,_meta,_order2,refId;return _regeneratorRuntime().wrap(function _callee143$(_context146){while(1)switch(_context146.prev=_context146.next){case 0:_context146.next=2;return queryClient.cancelQueries({queryKey:filesKey,exact:true});case 2:files=queryClient.getQueryData(filesKey);file=findAnyExistingItem(files,"name",variables.file.name,true);if(!file){_meta=(_a=queryClient.getQueryCache().find(filesKey))===null||_a===void 0?void 0:_a.meta;_order2=_meta===null||_meta===void 0?void 0:_meta.order;refId=Math.random();file=getTempFile(variables.file,variables.file.name,variables.file.size,variables.file.type,refId,user);addCacheItem(queryClient,filesKey,file,file.id,_order2)}variables.onProgress=function(_ref295){var progress=_ref295.progress;if(file===null||file===void 0?void 0:file.id){updateCacheItem(queryClient,filesKey,file.refId||file.id,function(cacheFile){return Object.assign(cacheFile,{status:"pending",progress:progress})})}setMutationContext(queryClient,mutationKey,variables,function(context){context.file.progress=progress;context.file.status="pending"})};return _context146.abrupt("return",{file:file});case 7:case"end":return _context146.stop()}},_callee143)}));function onMutate(_x120){return _onMutate7.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){var _a;if((_a=context===null||context===void 0?void 0:context.file)===null||_a===void 0?void 0:_a.id){updateCacheItem(queryClient,filesKey,context.file.id,function(file){return Object.assign(file,data||(context===null||context===void 0?void 0:context.file),{status:"ok",statusText:undefined,progress:undefined})})}setMutationContext(queryClient,mutationKey,variables,function(context){context.file.progress=undefined;context.file.status="ok";context.file.statusText=undefined});queryClient.invalidateQueries({queryKey:filesKey})},onError:function onError(error,variables,context){var _a,_b;if(error&&error.status===409){if((_a=context===null||context===void 0?void 0:context.file)===null||_a===void 0?void 0:_a.id){updateCacheItem(queryClient,filesKey,context.file.id,function(file){return Object.assign(file,{status:"conflict",statusText:error.detail||error.title,progress:undefined})})}setMutationContext(queryClient,mutationKey,variables,function(context){context.file.progress=undefined;context.file.status="conflict";context.file.statusText=error.detail||error.title})}else{if((_b=context===null||context===void 0?void 0:context.file)===null||_b===void 0?void 0:_b.id){if(context.file.id>=1){updateCacheItem(queryClient,filesKey,context.file.id,function(file){return Object.assign(file,{status:"error",statusText:error.detail||error.title,progress:undefined})})}else if(context.file.id>=0&&context.file.id<1){removeCacheItem(queryClient,filesKey,context.file.id)}}setMutationContext(queryClient,mutationKey,variables,function(context){if(context){context.file.progress=undefined;context.file.status="error";context.file.statusText=error.detail||error.title}})}}})}function useMutateFileCreate(filesKey,createFile){var queryClient=useQueryClient();var _React$useContext35=React.useContext(UserContext),user=_React$useContext35.user;var mutationKey=filesKey;return useMutation(createFile,{mutationKey:mutationKey,onMutate:function(){var _onMutate8=_asyncToGenerator(_regeneratorRuntime().mark(function _callee144(variables){var files,file,_meta2,_order3,refId,srcUrl;return _regeneratorRuntime().wrap(function _callee144$(_context147){while(1)switch(_context147.prev=_context147.next){case 0:_context147.next=2;return queryClient.cancelQueries({queryKey:filesKey,exact:true});case 2:files=queryClient.getQueryData(filesKey);file=findAnyExistingItem(files,"name",variables.blob.name,true)||variables.file;if(!file){_meta2=queryClient.getQueryCache().find(filesKey).meta;_order3=_meta2.order;refId=Math.random();try{srcUrl=variables.blob.thumbnail_url&&new URL(variables.blob.thumbnail_url)||undefined}catch(e){}file=getTempFile(srcUrl,variables.blob.name,variables.blob.size,variables.blob.media_type,refId,user);addCacheItem(queryClient,filesKey,file,file.id,_order3)}else{updateCacheItem(queryClient,filesKey,(file===null||file===void 0?void 0:file.refId)||(file===null||file===void 0?void 0:file.id),function(file){return Object.assign(file,{status:"pending"})})}return _context147.abrupt("return",{file:file,blob:variables.blob});case 6:case"end":return _context147.stop()}},_callee144)}));function onMutate(_x121){return _onMutate8.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){var _a,_b;updateCacheItem(queryClient,filesKey,((_a=context.file)===null||_a===void 0?void 0:_a.refId)||((_b=context.file)===null||_b===void 0?void 0:_b.id),function(file){return Object.assign(file,data,{status:"ok",statusText:undefined,progress:undefined})});setMutationContext(queryClient,mutationKey,variables,function(context){context.file.progress=undefined;context.file.status="ok";context.file.statusText=undefined});queryClient.invalidateQueries({queryKey:filesKey})},onError:function onError(error,variables,context){var _a,_b,_c,_d;if(error&&error.status===409){updateCacheItem(queryClient,filesKey,((_a=context.file)===null||_a===void 0?void 0:_a.refId)||((_b=context.file)===null||_b===void 0?void 0:_b.id),function(file){return Object.assign(file,{status:"conflict",statusText:error.detail||error.title,progress:undefined})});setMutationContext(queryClient,mutationKey,variables,function(context){context.file.progress=undefined;context.file.status="conflict";context.file.statusText=error.detail||error.title})}else{var errorId=((_c=context.file)===null||_c===void 0?void 0:_c.refId)||((_d=context.file)===null||_d===void 0?void 0:_d.id);if(errorId){if(errorId>=1){updateCacheItem(queryClient,filesKey,errorId,function(file){return Object.assign(file,{status:"error",statusText:error.detail||error.title,progress:undefined})})}else if(errorId>0&&errorId<1){removeCacheItem(queryClient,mutationKey,errorId)}}setMutationContext(queryClient,mutationKey,variables,function(context){if(context){context.file.progress=undefined;context.file.status="error";context.file.statusText=error.detail||error.title}})}}})}var triggerDownload=function triggerDownload(file){openUrl(file.download_url,"_top",file.name,true)};var triggerExternal=function triggerExternal(file){openUrl(file===null||file===void 0?void 0:file.external_url,"_blank",file.name)};var triggerApplication=function triggerApplication(file){openUrl(file===null||file===void 0?void 0:file.application_url,"_top",file.name)};var FileMenu=function FileMenu(_a){var file=_a.file,className=_a.className,onRename=_a.onRename,onSubscribe=_a.onSubscribe,onUnsubscribe=_a.onUnsubscribe,onTrash=_a.onTrash,onRestore=_a.onRestore,onDeleteForever=_a.onDeleteForever,children=_a.children,noWrapper=_a.noWrapper,features=_a.features,appFeatures=_a.appFeatures,props=__rest(_a,["file","className","onRename","onSubscribe","onUnsubscribe","onTrash","onRestore","onDeleteForever","children","noWrapper","features","appFeatures"]);var _getIcon3=getIcon(file.name),icon=_getIcon3.icon;var isNotTemp=file.id>=1;return React.createElement(UIDropdown.UI,Object.assign({directionX:"left",className:className,disabled:file.status&&file.status!=="ok",noWrapper:noWrapper},props),isNotTemp&&file.is_trashed&&React.createElement(React.Fragment,null,onRestore&&React.createElement(UIDropdown.Item,{onClick:onRestore},React.createElement(UIIcon.UI,{name:"delete-restore"}),"Restore"),onRestore&&onDeleteForever&&React.createElement(UIDropdown.Divider,null),onDeleteForever&&React.createElement(UIDropdown.Item,{onClick:onDeleteForever},React.createElement(UIIcon.UI,{name:"delete-forever"}),"Delete")),!file.is_trashed&&React.createElement(React.Fragment,null,file.external_url?React.createElement(UIDropdown.Item,{onClick:function onClick(){return triggerExternal(file)}},React.createElement(UIIcon.UI,{name:icon})," ","Open in ".concat(file.provider)):React.createElement(React.Fragment,null,file.application_url&&hasFeature(features,Feature.WebDAV,appFeatures===null||appFeatures===void 0?void 0:appFeatures.webDAV)&&React.createElement(UIDropdown.Item,{onClick:function onClick(){return triggerApplication(file)}},React.createElement(UIIcon.UI,{name:file.provider?toKebabCase(file.provider):icon})," ","Open in ".concat(file.provider||"app")),React.createElement(UIDropdown.Item,{onClick:function onClick(){return triggerDownload(file)}},React.createElement(UIIcon.UI,{name:"download",size:24})," Download")),isNotTemp&&React.createElement(React.Fragment,null,onRename&&React.createElement(UIDropdown.Item,{onClick:onRename},React.createElement(UIIcon.UI,{name:"textbox",size:24})," Rename"),!file.is_subscribed&&onSubscribe&&React.createElement(UIDropdown.Item,{onClick:onSubscribe},React.createElement(UIIcon.UI,{name:"bell",size:24})," Subscribe"),file.is_subscribed&&onUnsubscribe&&React.createElement(UIDropdown.Item,{onClick:onUnsubscribe},React.createElement(UIIcon.UI,{name:"bell-off",size:24})," Unsubscribe"),onTrash&&React.createElement(React.Fragment,null,React.createElement(UIDropdown.Divider,null),React.createElement(UIDropdown.Item,{onClick:onTrash},React.createElement(UIIcon.UI,{name:"delete",size:24})," Trash")))),children)};var clickBlock=function clickBlock(callback){return function(e){e.preventDefault();var onClickBlock=function onClickBlock(e){console.debug("Blocked event",e.type);e.preventDefault();e.stopImmediatePropagation()};document.addEventListener("click",onClickBlock,{once:true,capture:true});setTimeout(function(){document.removeEventListener("click",onClickBlock,{capture:true})},500);return callback(e)}};var FileRow=function FileRow(_ref296){var file=_ref296.file,className=_ref296.className,onClick=_ref296.onClick,onRename=_ref296.onRename,isRenaming=_ref296.isRenaming,onSubscribe=_ref296.onSubscribe,onUnsubscribe=_ref296.onUnsubscribe,onTrash=_ref296.onTrash,onRestore=_ref296.onRestore,onDeleteForever=_ref296.onDeleteForever,onHandleError=_ref296.onHandleError,statusText=_ref296.statusText,title=_ref296.title,features=_ref296.features,appFeatures=_ref296.appFeatures,children=_ref296.children;var _React$useState107=React.useState(false),_React$useState108=_slicedToArray2(_React$useState107,2),renaming=_React$useState108[0],setRenaming=_React$useState108[1];React.useEffect(function(){if(isRenaming!==undefined){setRenaming(isRenaming)}},[isRenaming]);var fileSize=file.size&&file.size>0?fileSizeAsString(file.size):null;var fileChangedAt=file.modified_at||file.created_at;var fileDate=dayjs.utc(fileChangedAt).tz(dayjs.tz.guess());var _getIcon4=getIcon(file.name),icon=_getIcon4.icon;var ext=getExtension(file.name);var onClickWrapper=function onClickWrapper(e){if(!e.defaultPrevented){if(onHandleError&&(file.status==="conflict"||file.status==="error")){onHandleError(file)}else if(onClick){onClick(e)}}};var handleRename=function handleRename(e){var renameTarget=e.target;if(renameTarget.value&&renameTarget.value!==file.name){onRename(renameTarget.value,file)}setRenaming(false)};var handleRenameKey=function handleRenameKey(e){if(e.key==="Escape"){e.preventDefault();e.target.value=file.name;e.target.blur()}else if(e.key==="Enter"){e.preventDefault();handleRename(e)}};return React.createElement("tr",{className:classNames({"wy-table-trashed":file.is_trashed},className),onClick:onClickWrapper,title:title},React.createElement("td",{className:"wy-table-cell-icon"},file.status==="error"?React.createElement(UIIcon.UI,{name:"alert-octagon",color:"error",size:24,title:file.statusText||statusText}):file.status==="conflict"?React.createElement(UIIcon.UI,{name:"alert",color:"yellow",size:24,title:file.statusText||statusText}):file.status==="pending"?React.createElement(UISpinner.UI,{spin:!file.progress,progress:file.progress}):React.createElement(UIIcon.UI,{name:icon,size:24,className:classNames("wy-kind-"+toKebabCase(file.kind),"wy-ext-"+ext.substring(1))})),React.createElement("td",null,renaming&&onRename?React.createElement(React.Fragment,null,React.createElement("input",{type:"text",maxLength:256,className:"wy-input",defaultValue:file.name,onBlur:clickBlock(handleRename),onKeyUp:handleRenameKey,onClick:function onClick(e){return e.preventDefault()},onFocus:function onFocus(e){var i=e.target.value.lastIndexOf(".");if(i===-1){e.target.select()}else{e.target.setSelectionRange(0,i)}},autoFocus:true})):React.createElement(React.Fragment,null,React.createElement("span",{title:file.name+(statusText||file.statusText?": ".concat(statusText||file.statusText):"")},file.name,(statusText||file.statusText)&&React.createElement(React.Fragment,null,": ",React.createElement("em",null,statusText||file.statusText))))),React.createElement("td",null,React.createElement("time",{dateTime:fileChangedAt,title:fileDate.format("LLLL")},fileDate.format("l"))),React.createElement("td",null,React.createElement("span",null,file.kind)),React.createElement("td",null,React.createElement("span",null,fileSize)),React.createElement("td",{className:"wy-table-cell-icon"},children||React.createElement(React.Fragment,null,React.createElement(FileMenu,{file:file,onRename:onRename?function(){return setRenaming(true)}:undefined,onSubscribe:onSubscribe===null||onSubscribe===void 0?void 0:onSubscribe.bind(FileRow,file),onUnsubscribe:onUnsubscribe===null||onUnsubscribe===void 0?void 0:onUnsubscribe.bind(FileRow,file),onTrash:onTrash===null||onTrash===void 0?void 0:onTrash.bind(FileRow,file),onRestore:onRestore===null||onRestore===void 0?void 0:onRestore.bind(FileRow,file),onDeleteForever:onDeleteForever===null||onDeleteForever===void 0?void 0:onDeleteForever.bind(FileRow,file),noWrapper:true,features:features,appFeatures:appFeatures}))))};var FileCard=function FileCard(_ref297){var file=_ref297.file,className=_ref297.className,onClick=_ref297.onClick,onRename=_ref297.onRename,isRenaming=_ref297.isRenaming,onSubscribe=_ref297.onSubscribe,onUnsubscribe=_ref297.onUnsubscribe,onTrash=_ref297.onTrash,onRestore=_ref297.onRestore,onDeleteForever=_ref297.onDeleteForever,onHandleError=_ref297.onHandleError,statusText=_ref297.statusText,title=_ref297.title,features=_ref297.features,appFeatures=_ref297.appFeatures,children=_ref297.children;var _React$useState109=React.useState(false),_React$useState110=_slicedToArray2(_React$useState109,2),renaming=_React$useState110[0],setRenaming=_React$useState110[1];React.useEffect(function(){if(isRenaming!==undefined){setRenaming(isRenaming)}},[isRenaming]);var _getIcon5=getIcon(file.name),icon=_getIcon5.icon;var ext=getExtension(file.name);var onClickWrapper=function onClickWrapper(e){if(!e.defaultPrevented&&!renaming){if(onHandleError&&(file.status==="conflict"||file.status==="error")){onHandleError(file)}else if(onClick){onClick(e)}}};var handleRename=function handleRename(e){var renameTarget=e.target;if(renameTarget.value&&renameTarget.value!==file.name){onRename(renameTarget.value,file)}setRenaming(false)};var handleRenameKey=function handleRenameKey(e){if(e.key==="Escape"){e.preventDefault();e.target.value=file.name;e.target.blur()}else if(e.key==="Enter"){e.preventDefault();handleRename(e)}};return React.createElement("div",{className:classNames("wy-card",{"wy-card-trashed":file.is_trashed,"wy-card-hover":onClick&&!file.is_trashed&&!renaming},className),onClick:onClickWrapper,title:title},React.createElement("div",{className:"wy-card-actions"},file.status==="error"&&React.createElement(UIIcon.UI,{name:"alert-octagon",color:"error",size:24,title:file.statusText||statusText})||file.status==="conflict"&&React.createElement(UIIcon.UI,{name:"alert",color:"yellow",size:24,title:file.statusText||statusText})||file.status==="pending"&&React.createElement(UISpinner.UI,{spin:!file.progress,progress:file.progress}),children||React.createElement(React.Fragment,null,React.createElement(FileMenu,{file:file,onRename:onRename?function(){return setRenaming(true)}:undefined,onSubscribe:onSubscribe===null||onSubscribe===void 0?void 0:onSubscribe.bind(FileRow,file),onUnsubscribe:onUnsubscribe===null||onUnsubscribe===void 0?void 0:onUnsubscribe.bind(FileRow,file),onTrash:onTrash===null||onTrash===void 0?void 0:onTrash.bind(FileRow,file),onRestore:onRestore===null||onRestore===void 0?void 0:onRestore.bind(FileRow,file),onDeleteForever:onDeleteForever===null||onDeleteForever===void 0?void 0:onDeleteForever.bind(FileRow,file),features:features,appFeatures:appFeatures}))),!file.is_trashed&&file.thumbnail_url&&React.createElement("img",{className:classNames("wy-card-top wy-card-content",{"wy-card-top-image":file.kind==="image"}),src:file.thumbnail_url,loading:"lazy"})||React.createElement("div",{className:"wy-content-icon wy-card-top wy-card-content"},React.createElement(UIIcon.UI,{name:icon,size:96,className:classNames("wy-kind-"+toKebabCase(file.kind),"wy-ext-"+ext.substring(1))})),React.createElement("div",{className:"wy-card-label wy-card-content wy-filename"},renaming&&onRename?React.createElement(React.Fragment,null,React.createElement("input",{type:"text",maxLength:256,className:"wy-input",defaultValue:file.name,onBlur:clickBlock(handleRename),onKeyUp:handleRenameKey,onClick:function onClick(e){return e.preventDefault()},onFocus:function onFocus(e){var i=e.target.value.lastIndexOf(".");if(i===-1){e.target.select()}else{e.target.setSelectionRange(0,i)}},autoFocus:true})):React.createElement("span",{title:file.name+(statusText||file.statusText?": ".concat(statusText||file.statusText):"")},file.name,(statusText||file.statusText)&&React.createElement(React.Fragment,null,": ",React.createElement("em",null,statusText||file.statusText)))))};var FileItem=function FileItem(_ref298){var file=_ref298.file,className=_ref298.className,onClick=_ref298.onClick,onRename=_ref298.onRename,isRenaming=_ref298.isRenaming,onSubscribe=_ref298.onSubscribe,onUnsubscribe=_ref298.onUnsubscribe,onTrash=_ref298.onTrash,onRestore=_ref298.onRestore,onDeleteForever=_ref298.onDeleteForever,onHandleError=_ref298.onHandleError,statusText=_ref298.statusText,title=_ref298.title,features=_ref298.features,appFeatures=_ref298.appFeatures,children=_ref298.children;var _React$useState111=React.useState(false),_React$useState112=_slicedToArray2(_React$useState111,2),renaming=_React$useState112[0],setRenaming=_React$useState112[1];React.useEffect(function(){if(isRenaming!==undefined){setRenaming(isRenaming)}},[isRenaming]);var _getIcon6=getIcon(file.name),icon=_getIcon6.icon;var ext=getExtension(file.name);var onClickWrapper=function onClickWrapper(e){if(!e.defaultPrevented&&!renaming){if(onHandleError&&(file.status==="conflict"||file.status==="error")){onHandleError(file)}else if(onClick){onClick(e)}}};var handleRename=function handleRename(e){var renameTarget=e.target;if(renameTarget.value&&renameTarget.value!==file.name){onRename(renameTarget.value,file)}setRenaming(false)};var handleRenameKey=function handleRenameKey(e){if(e.key==="Escape"){e.preventDefault();e.target.value=file.name;e.target.blur()}else if(e.key==="Enter"){e.preventDefault();handleRename(e)}};return React.createElement("div",{className:classNames("wy-item",{"wy-item-trashed":file.is_trashed,"wy-item-hover":onClick&&!file.is_trashed&&!renaming},className),onClick:onClickWrapper,title:title},file.status==="error"?React.createElement(UIIcon.UI,{name:"alert-octagon",color:"error",size:24,title:file.statusText||statusText}):file.status==="conflict"?React.createElement(UIIcon.UI,{name:"alert",color:"yellow",size:24,title:file.statusText||statusText}):file.status==="pending"?React.createElement(UISpinner.UI,{spin:!file.progress,progress:file.progress}):React.createElement(UIIcon.UI,{name:icon,size:24,className:classNames("wy-kind-"+toKebabCase(file.kind),"wy-ext-"+ext.substring(1))}),React.createElement("div",{className:"wy-item-body"},renaming&&onRename?React.createElement(React.Fragment,null,React.createElement("input",{type:"text",maxLength:256,className:"wy-input",defaultValue:file.name,onBlur:clickBlock(handleRename),onKeyUp:handleRenameKey,onClick:function onClick(e){return e.preventDefault()},onFocus:function onFocus(e){var i=e.target.value.lastIndexOf(".");if(i===-1){e.target.select()}else{e.target.setSelectionRange(0,i)}},autoFocus:true})):React.createElement("span",{title:file.name+(statusText||file.statusText?": ".concat(statusText||file.statusText):"")},file.name,(statusText||file.statusText)&&React.createElement(React.Fragment,null,": ",React.createElement("em",null,statusText||file.statusText)))),children||React.createElement(React.Fragment,null,React.createElement(FileMenu,{file:file,onRename:onRename?function(){return setRenaming(true)}:undefined,onSubscribe:onSubscribe===null||onSubscribe===void 0?void 0:onSubscribe.bind(FileRow,file),onUnsubscribe:onUnsubscribe===null||onUnsubscribe===void 0?void 0:onUnsubscribe.bind(FileRow,file),onTrash:onTrash===null||onTrash===void 0?void 0:onTrash.bind(FileRow,file),onRestore:onRestore===null||onRestore===void 0?void 0:onRestore.bind(FileRow,file),onDeleteForever:onDeleteForever===null||onDeleteForever===void 0?void 0:onDeleteForever.bind(FileRow,file),features:features,appFeatures:appFeatures})))};var FileItem$1={Row:FileRow,Card:FileCard,Item:FileItem,Menu:FileMenu};var propTypesExports=requirePropTypes();var PropTypes=getDefaultExportFromCjs(propTypesExports);var COMMON_MIME_TYPES=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function toFileWithPath(file,path){var f=withMimeType(file);if(typeof f.path!=="string"){var webkitRelativePath=file.webkitRelativePath;Object.defineProperty(f,"path",{value:typeof path==="string"?path:typeof webkitRelativePath==="string"&&webkitRelativePath.length>0?webkitRelativePath:file.name,writable:false,configurable:false,enumerable:true})}return f}function withMimeType(file){var name=file.name;var hasExtension=name&&name.lastIndexOf(".")!==-1;if(hasExtension&&!file.type){var ext=name.split(".").pop().toLowerCase();var type=COMMON_MIME_TYPES.get(ext);if(type){Object.defineProperty(file,"type",{value:type,writable:false,configurable:false,enumerable:true})}}return file}var FILES_TO_IGNORE=[".DS_Store","Thumbs.db"];function fromEvent(evt){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(isObject(evt)&&isDataTransfer(evt.dataTransfer)){return[2,getDataTransferFiles(evt.dataTransfer,evt.type)]}else if(isChangeEvt(evt)){return[2,getInputFiles(evt)]}else if(Array.isArray(evt)&&evt.every(function(item){return"getFile"in item&&typeof item.getFile==="function"})){return[2,getFsHandleFiles(evt)]}return[2,[]]})})}function isDataTransfer(value){return isObject(value)}function isChangeEvt(value){return isObject(value)&&isObject(value.target)}function isObject(v){return _typeof2(v)==="object"&&v!==null}function getInputFiles(evt){return fromList(evt.target.files).map(function(file){return toFileWithPath(file)})}function getFsHandleFiles(handles){return __awaiter(this,void 0,void 0,function(){var files;return __generator(this,function(_a){switch(_a.label){case 0:return[4,Promise.all(handles.map(function(h){return h.getFile()}))];case 1:files=_a.sent();return[2,files.map(function(file){return toFileWithPath(file)})]}})})}function getDataTransferFiles(dt,type){return __awaiter(this,void 0,void 0,function(){var items,files;return __generator(this,function(_a){switch(_a.label){case 0:if(!dt.items)return[3,2];items=fromList(dt.items).filter(function(item){return item.kind==="file"});if(type!=="drop"){return[2,items]}return[4,Promise.all(items.map(toFilePromises))];case 1:files=_a.sent();return[2,noIgnoredFiles(flatten(files))];case 2:return[2,noIgnoredFiles(fromList(dt.files).map(function(file){return toFileWithPath(file)}))]}})})}function noIgnoredFiles(files){return files.filter(function(file){return FILES_TO_IGNORE.indexOf(file.name)===-1})}function fromList(items){if(items===null){return[]}var files=[];for(var i=0;i<items.length;i++){var file=items[i];files.push(file)}return files}function toFilePromises(item){if(typeof item.webkitGetAsEntry!=="function"){return fromDataTransferItem(item)}var entry=item.webkitGetAsEntry();if(entry&&entry.isDirectory){return fromDirEntry(entry)}return fromDataTransferItem(item)}function flatten(items){return items.reduce(function(acc,files){return __spreadArray(__spreadArray([],__read(acc),false),__read(Array.isArray(files)?flatten(files):[files]),false)},[])}function fromDataTransferItem(item){var file=item.getAsFile();if(!file){return Promise.reject("".concat(item," is not a File"))}var fwp=toFileWithPath(file);return Promise.resolve(fwp)}function fromEntry(entry){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,entry.isDirectory?fromDirEntry(entry):fromFileEntry(entry)]})})}function fromDirEntry(entry){var reader=entry.createReader();return new Promise(function(resolve,reject){var entries=[];function readEntries(){var _this=this;reader.readEntries(function(batch){return __awaiter(_this,void 0,void 0,function(){var files,err_1,items;return __generator(this,function(_a){switch(_a.label){case 0:if(!!batch.length)return[3,5];_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,Promise.all(entries)];case 2:files=_a.sent();resolve(files);return[3,4];case 3:err_1=_a.sent();reject(err_1);return[3,4];case 4:return[3,6];case 5:items=Promise.all(batch.map(fromEntry));entries.push(items);readEntries();_a.label=6;case 6:return[2]}})})},function(err){reject(err)})}readEntries()})}function fromFileEntry(entry){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve,reject){entry.file(function(file){var fwp=toFileWithPath(file,entry.fullPath);resolve(fwp)},function(err){reject(err)})})]})})}var _default=function _default(file,acceptedFiles){if(file&&acceptedFiles){var acceptedFilesArray=Array.isArray(acceptedFiles)?acceptedFiles:acceptedFiles.split(",");var fileName=file.name||"";var mimeType=(file.type||"").toLowerCase();var baseMimeType=mimeType.replace(/\/.*$/,"");return acceptedFilesArray.some(function(type){var validType=type.trim().toLowerCase();if(validType.charAt(0)==="."){return fileName.toLowerCase().endsWith(validType)}else if(validType.endsWith("/*")){return baseMimeType===validType.replace(/\/.*$/,"")}return mimeType===validType})}return true};function _toConsumableArray$1(arr){return _arrayWithoutHoles$1(arr)||_iterableToArray$1(arr)||_unsupportedIterableToArray$1(arr)||_nonIterableSpread$1()}function _nonIterableSpread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray$1(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles$1(arr){if(Array.isArray(arr))return _arrayLikeToArray$1(arr)}function ownKeys$1(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread$1(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys$1(Object(source),!0).forEach(function(key){_defineProperty$1(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys$1(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty$1(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _slicedToArray$1(arr,i){return _arrayWithHoles$1(arr)||_iterableToArrayLimit$1(arr,i)||_unsupportedIterableToArray$1(arr,i)||_nonIterableRest$1()}function _nonIterableRest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$1(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray$1(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray$1(o,minLen)}function _arrayLikeToArray$1(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit$1(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles$1(arr){if(Array.isArray(arr))return arr}var FILE_INVALID_TYPE="file-invalid-type";var FILE_TOO_LARGE="file-too-large";var FILE_TOO_SMALL="file-too-small";var TOO_MANY_FILES="too-many-files";var getInvalidTypeRejectionErr=function getInvalidTypeRejectionErr(accept){accept=Array.isArray(accept)&&accept.length===1?accept[0]:accept;var messageSuffix=Array.isArray(accept)?"one of ".concat(accept.join(", ")):accept;return{code:FILE_INVALID_TYPE,message:"File type must be ".concat(messageSuffix)}};var getTooLargeRejectionErr=function getTooLargeRejectionErr(maxSize){return{code:FILE_TOO_LARGE,message:"File is larger than ".concat(maxSize," ").concat(maxSize===1?"byte":"bytes")}};var getTooSmallRejectionErr=function getTooSmallRejectionErr(minSize){return{code:FILE_TOO_SMALL,message:"File is smaller than ".concat(minSize," ").concat(minSize===1?"byte":"bytes")}};var TOO_MANY_FILES_REJECTION={code:TOO_MANY_FILES,message:"Too many files"};function fileAccepted(file,accept){var isAcceptable=file.type==="application/x-moz-file"||_default(file,accept);return[isAcceptable,isAcceptable?null:getInvalidTypeRejectionErr(accept)]}function fileMatchSize(file,minSize,maxSize){if(isDefined(file.size)){if(isDefined(minSize)&&isDefined(maxSize)){if(file.size>maxSize)return[false,getTooLargeRejectionErr(maxSize)];if(file.size<minSize)return[false,getTooSmallRejectionErr(minSize)]}else if(isDefined(minSize)&&file.size<minSize)return[false,getTooSmallRejectionErr(minSize)];else if(isDefined(maxSize)&&file.size>maxSize)return[false,getTooLargeRejectionErr(maxSize)]}return[true,null]}function isDefined(value){return value!==undefined&&value!==null}function allFilesAccepted(_ref){var files=_ref.files,accept=_ref.accept,minSize=_ref.minSize,maxSize=_ref.maxSize,multiple=_ref.multiple,maxFiles=_ref.maxFiles,validator=_ref.validator;if(!multiple&&files.length>1||multiple&&maxFiles>=1&&files.length>maxFiles){return false}return files.every(function(file){var _fileAccepted=fileAccepted(file,accept),_fileAccepted2=_slicedToArray$1(_fileAccepted,1),accepted=_fileAccepted2[0];var _fileMatchSize=fileMatchSize(file,minSize,maxSize),_fileMatchSize2=_slicedToArray$1(_fileMatchSize,1),sizeMatch=_fileMatchSize2[0];var customErrors=validator?validator(file):null;return accepted&&sizeMatch&&!customErrors})}function isPropagationStopped(event){if(typeof event.isPropagationStopped==="function"){return event.isPropagationStopped()}else if(typeof event.cancelBubble!=="undefined"){return event.cancelBubble}return false}function isEvtWithFiles(event){if(!event.dataTransfer){return!!event.target&&!!event.target.files}return Array.prototype.some.call(event.dataTransfer.types,function(type){return type==="Files"||type==="application/x-moz-file"})}function onDocumentDragOver(event){event.preventDefault()}function isIe(userAgent){return userAgent.indexOf("MSIE")!==-1||userAgent.indexOf("Trident/")!==-1}function isEdge(userAgent){return userAgent.indexOf("Edge/")!==-1}function isIeOrEdge(){var userAgent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:window.navigator.userAgent;return isIe(userAgent)||isEdge(userAgent)}function composeEventHandlers(){for(var _len=arguments.length,fns=new Array(_len),_key=0;_key<_len;_key++){fns[_key]=arguments[_key]}return function(event){for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}return fns.some(function(fn){if(!isPropagationStopped(event)&&fn){fn.apply(void 0,[event].concat(args))}return isPropagationStopped(event)})}}function canUseFileSystemAccessAPI(){return"showOpenFilePicker"in window}function pickerOptionsFromAccept(accept){if(isDefined(accept)){var acceptForPicker=Object.entries(accept).filter(function(_ref2){var _ref3=_slicedToArray$1(_ref2,2),mimeType=_ref3[0],ext=_ref3[1];var ok=true;if(!isMIMEType(mimeType)){console.warn("Skipped \"".concat(mimeType,"\" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types."));ok=false}if(!Array.isArray(ext)||!ext.every(isExt)){console.warn("Skipped \"".concat(mimeType,"\" because an invalid file extension was provided."));ok=false}return ok}).reduce(function(agg,_ref4){var _ref5=_slicedToArray$1(_ref4,2),mimeType=_ref5[0],ext=_ref5[1];return _objectSpread$1(_objectSpread$1({},agg),{},_defineProperty$1({},mimeType,ext))},{});return[{description:"Files",accept:acceptForPicker}]}return accept}function acceptPropAsAcceptAttr(accept){if(isDefined(accept)){return Object.entries(accept).reduce(function(a,_ref6){var _ref7=_slicedToArray$1(_ref6,2),mimeType=_ref7[0],ext=_ref7[1];return[].concat(_toConsumableArray$1(a),[mimeType],_toConsumableArray$1(ext))},[]).filter(function(v){return isMIMEType(v)||isExt(v)}).join(",")}return undefined}function isAbort(v){return v instanceof DOMException&&(v.name==="AbortError"||v.code===v.ABORT_ERR)}function isSecurityError(v){return v instanceof DOMException&&(v.name==="SecurityError"||v.code===v.SECURITY_ERR)}function isMIMEType(v){return v==="audio/*"||v==="video/*"||v==="image/*"||v==="text/*"||/\w+\/[-+.\w]+/g.test(v)}function isExt(v){return /^.*\.[\w]+$/.test(v)}var _excluded=["children"],_excluded2=["open"],_excluded3=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],_excluded4=["refKey","onChange","onClick"];function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key]}return target}var Dropzone$1=React.forwardRef(function(_ref,ref){var children=_ref.children,params=_objectWithoutProperties(_ref,_excluded);var _useDropzone=useDropzone(params),open=_useDropzone.open,props=_objectWithoutProperties(_useDropzone,_excluded2);React.useImperativeHandle(ref,function(){return{open:open}},[open]);return React.createElement(React.Fragment,null,children(_objectSpread(_objectSpread({},props),{},{open:open})))});Dropzone$1.displayName="Dropzone";var defaultProps={disabled:false,getFilesFromEvent:fromEvent,maxSize:Infinity,minSize:0,multiple:true,maxFiles:0,preventDropOnDocument:true,noClick:false,noKeyboard:false,noDrag:false,noDragEventsBubbling:false,validator:null,useFsAccessApi:true,autoFocus:false};Dropzone$1.defaultProps=defaultProps;Dropzone$1.propTypes={children:PropTypes.func,accept:PropTypes.objectOf(PropTypes.arrayOf(PropTypes.string)),multiple:PropTypes.bool,preventDropOnDocument:PropTypes.bool,noClick:PropTypes.bool,noKeyboard:PropTypes.bool,noDrag:PropTypes.bool,noDragEventsBubbling:PropTypes.bool,minSize:PropTypes.number,maxSize:PropTypes.number,maxFiles:PropTypes.number,disabled:PropTypes.bool,getFilesFromEvent:PropTypes.func,onFileDialogCancel:PropTypes.func,onFileDialogOpen:PropTypes.func,useFsAccessApi:PropTypes.bool,autoFocus:PropTypes.bool,onDragEnter:PropTypes.func,onDragLeave:PropTypes.func,onDragOver:PropTypes.func,onDrop:PropTypes.func,onDropAccepted:PropTypes.func,onDropRejected:PropTypes.func,onError:PropTypes.func,validator:PropTypes.func};var initialState={isFocused:false,isFileDialogActive:false,isDragActive:false,isDragAccept:false,isDragReject:false,acceptedFiles:[],fileRejections:[]};function useDropzone(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _defaultProps$props=_objectSpread(_objectSpread({},defaultProps),props),accept=_defaultProps$props.accept,disabled=_defaultProps$props.disabled,getFilesFromEvent=_defaultProps$props.getFilesFromEvent,maxSize=_defaultProps$props.maxSize,minSize=_defaultProps$props.minSize,multiple=_defaultProps$props.multiple,maxFiles=_defaultProps$props.maxFiles,onDragEnter=_defaultProps$props.onDragEnter,onDragLeave=_defaultProps$props.onDragLeave,onDragOver=_defaultProps$props.onDragOver,onDrop=_defaultProps$props.onDrop,onDropAccepted=_defaultProps$props.onDropAccepted,onDropRejected=_defaultProps$props.onDropRejected,onFileDialogCancel=_defaultProps$props.onFileDialogCancel,onFileDialogOpen=_defaultProps$props.onFileDialogOpen,useFsAccessApi=_defaultProps$props.useFsAccessApi,autoFocus=_defaultProps$props.autoFocus,preventDropOnDocument=_defaultProps$props.preventDropOnDocument,noClick=_defaultProps$props.noClick,noKeyboard=_defaultProps$props.noKeyboard,noDrag=_defaultProps$props.noDrag,noDragEventsBubbling=_defaultProps$props.noDragEventsBubbling,onError=_defaultProps$props.onError,validator=_defaultProps$props.validator;var acceptAttr=React.useMemo(function(){return acceptPropAsAcceptAttr(accept)},[accept]);var pickerTypes=React.useMemo(function(){return pickerOptionsFromAccept(accept)},[accept]);var onFileDialogOpenCb=React.useMemo(function(){return typeof onFileDialogOpen==="function"?onFileDialogOpen:noop},[onFileDialogOpen]);var onFileDialogCancelCb=React.useMemo(function(){return typeof onFileDialogCancel==="function"?onFileDialogCancel:noop},[onFileDialogCancel]);var rootRef=React.useRef(null);var inputRef=React.useRef(null);var _useReducer=React.useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var isFocused=state.isFocused,isFileDialogActive=state.isFileDialogActive;var fsAccessApiWorksRef=React.useRef(typeof window!=="undefined"&&window.isSecureContext&&useFsAccessApi&&canUseFileSystemAccessAPI());var onWindowFocus=function onWindowFocus(){if(!fsAccessApiWorksRef.current&&isFileDialogActive){setTimeout(function(){if(inputRef.current){var files=inputRef.current.files;if(!files.length){dispatch({type:"closeDialog"});onFileDialogCancelCb()}}},300)}};React.useEffect(function(){window.addEventListener("focus",onWindowFocus,false);return function(){window.removeEventListener("focus",onWindowFocus,false)}},[inputRef,isFileDialogActive,onFileDialogCancelCb,fsAccessApiWorksRef]);var dragTargetsRef=React.useRef([]);var onDocumentDrop=function onDocumentDrop(event){if(rootRef.current&&rootRef.current.contains(event.target)){return}event.preventDefault();dragTargetsRef.current=[]};React.useEffect(function(){if(preventDropOnDocument){document.addEventListener("dragover",onDocumentDragOver,false);document.addEventListener("drop",onDocumentDrop,false)}return function(){if(preventDropOnDocument){document.removeEventListener("dragover",onDocumentDragOver);document.removeEventListener("drop",onDocumentDrop)}}},[rootRef,preventDropOnDocument]);React.useEffect(function(){if(!disabled&&autoFocus&&rootRef.current){rootRef.current.focus()}return function(){}},[rootRef,autoFocus,disabled]);var onErrCb=React.useCallback(function(e){if(onError){onError(e)}else{console.error(e)}},[onError]);var onDragEnterCb=React.useCallback(function(event){event.preventDefault();event.persist();stopPropagation(event);dragTargetsRef.current=[].concat(_toConsumableArray(dragTargetsRef.current),[event.target]);if(isEvtWithFiles(event)){Promise.resolve(getFilesFromEvent(event)).then(function(files){if(isPropagationStopped(event)&&!noDragEventsBubbling){return}var fileCount=files.length;var isDragAccept=fileCount>0&&allFilesAccepted({files:files,accept:acceptAttr,minSize:minSize,maxSize:maxSize,multiple:multiple,maxFiles:maxFiles,validator:validator});var isDragReject=fileCount>0&&!isDragAccept;dispatch({isDragAccept:isDragAccept,isDragReject:isDragReject,isDragActive:true,type:"setDraggedFiles"});if(onDragEnter){onDragEnter(event)}})["catch"](function(e){return onErrCb(e)})}},[getFilesFromEvent,onDragEnter,onErrCb,noDragEventsBubbling,acceptAttr,minSize,maxSize,multiple,maxFiles,validator]);var onDragOverCb=React.useCallback(function(event){event.preventDefault();event.persist();stopPropagation(event);var hasFiles=isEvtWithFiles(event);if(hasFiles&&event.dataTransfer){try{event.dataTransfer.dropEffect="copy"}catch(_unused){}}if(hasFiles&&onDragOver){onDragOver(event)}return false},[onDragOver,noDragEventsBubbling]);var onDragLeaveCb=React.useCallback(function(event){event.preventDefault();event.persist();stopPropagation(event);var targets=dragTargetsRef.current.filter(function(target){return rootRef.current&&rootRef.current.contains(target)});var targetIdx=targets.indexOf(event.target);if(targetIdx!==-1){targets.splice(targetIdx,1)}dragTargetsRef.current=targets;if(targets.length>0){return}dispatch({type:"setDraggedFiles",isDragActive:false,isDragAccept:false,isDragReject:false});if(isEvtWithFiles(event)&&onDragLeave){onDragLeave(event)}},[rootRef,onDragLeave,noDragEventsBubbling]);var setFiles=React.useCallback(function(files,event){var acceptedFiles=[];var fileRejections=[];files.forEach(function(file){var _fileAccepted=fileAccepted(file,acceptAttr),_fileAccepted2=_slicedToArray(_fileAccepted,2),accepted=_fileAccepted2[0],acceptError=_fileAccepted2[1];var _fileMatchSize=fileMatchSize(file,minSize,maxSize),_fileMatchSize2=_slicedToArray(_fileMatchSize,2),sizeMatch=_fileMatchSize2[0],sizeError=_fileMatchSize2[1];var customErrors=validator?validator(file):null;if(accepted&&sizeMatch&&!customErrors){acceptedFiles.push(file)}else{var errors=[acceptError,sizeError];if(customErrors){errors=errors.concat(customErrors)}fileRejections.push({file:file,errors:errors.filter(function(e){return e})})}});if(!multiple&&acceptedFiles.length>1||multiple&&maxFiles>=1&&acceptedFiles.length>maxFiles){acceptedFiles.forEach(function(file){fileRejections.push({file:file,errors:[TOO_MANY_FILES_REJECTION]})});acceptedFiles.splice(0)}dispatch({acceptedFiles:acceptedFiles,fileRejections:fileRejections,type:"setFiles"});if(onDrop){onDrop(acceptedFiles,fileRejections,event)}if(fileRejections.length>0&&onDropRejected){onDropRejected(fileRejections,event)}if(acceptedFiles.length>0&&onDropAccepted){onDropAccepted(acceptedFiles,event)}},[dispatch,multiple,acceptAttr,minSize,maxSize,maxFiles,onDrop,onDropAccepted,onDropRejected,validator]);var onDropCb=React.useCallback(function(event){event.preventDefault();event.persist();stopPropagation(event);dragTargetsRef.current=[];if(isEvtWithFiles(event)){Promise.resolve(getFilesFromEvent(event)).then(function(files){if(isPropagationStopped(event)&&!noDragEventsBubbling){return}setFiles(files,event)})["catch"](function(e){return onErrCb(e)})}dispatch({type:"reset"})},[getFilesFromEvent,setFiles,onErrCb,noDragEventsBubbling]);var openFileDialog=React.useCallback(function(){if(fsAccessApiWorksRef.current){dispatch({type:"openDialog"});onFileDialogOpenCb();var opts={multiple:multiple,types:pickerTypes};window.showOpenFilePicker(opts).then(function(handles){return getFilesFromEvent(handles)}).then(function(files){setFiles(files,null);dispatch({type:"closeDialog"})})["catch"](function(e){if(isAbort(e)){onFileDialogCancelCb(e);dispatch({type:"closeDialog"})}else if(isSecurityError(e)){fsAccessApiWorksRef.current=false;if(inputRef.current){inputRef.current.value=null;inputRef.current.click()}else{onErrCb(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))}}else{onErrCb(e)}});return}if(inputRef.current){dispatch({type:"openDialog"});onFileDialogOpenCb();inputRef.current.value=null;inputRef.current.click()}},[dispatch,onFileDialogOpenCb,onFileDialogCancelCb,useFsAccessApi,setFiles,onErrCb,pickerTypes,multiple]);var onKeyDownCb=React.useCallback(function(event){if(!rootRef.current||!rootRef.current.isEqualNode(event.target)){return}if(event.key===" "||event.key==="Enter"||event.keyCode===32||event.keyCode===13){event.preventDefault();openFileDialog()}},[rootRef,openFileDialog]);var onFocusCb=React.useCallback(function(){dispatch({type:"focus"})},[]);var onBlurCb=React.useCallback(function(){dispatch({type:"blur"})},[]);var onClickCb=React.useCallback(function(){if(noClick){return}if(isIeOrEdge()){setTimeout(openFileDialog,0)}else{openFileDialog()}},[noClick,openFileDialog]);var composeHandler=function composeHandler(fn){return disabled?null:fn};var composeKeyboardHandler=function composeKeyboardHandler(fn){return noKeyboard?null:composeHandler(fn)};var composeDragHandler=function composeDragHandler(fn){return noDrag?null:composeHandler(fn)};var stopPropagation=function stopPropagation(event){if(noDragEventsBubbling){event.stopPropagation()}};var getRootProps=React.useMemo(function(){return function(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$refKey=_ref2.refKey,refKey=_ref2$refKey===void 0?"ref":_ref2$refKey,role=_ref2.role,onKeyDown=_ref2.onKeyDown,onFocus=_ref2.onFocus,onBlur=_ref2.onBlur,onClick=_ref2.onClick,onDragEnter=_ref2.onDragEnter,onDragOver=_ref2.onDragOver,onDragLeave=_ref2.onDragLeave,onDrop=_ref2.onDrop,rest=_objectWithoutProperties(_ref2,_excluded3);return _objectSpread(_objectSpread(_defineProperty({onKeyDown:composeKeyboardHandler(composeEventHandlers(onKeyDown,onKeyDownCb)),onFocus:composeKeyboardHandler(composeEventHandlers(onFocus,onFocusCb)),onBlur:composeKeyboardHandler(composeEventHandlers(onBlur,onBlurCb)),onClick:composeHandler(composeEventHandlers(onClick,onClickCb)),onDragEnter:composeDragHandler(composeEventHandlers(onDragEnter,onDragEnterCb)),onDragOver:composeDragHandler(composeEventHandlers(onDragOver,onDragOverCb)),onDragLeave:composeDragHandler(composeEventHandlers(onDragLeave,onDragLeaveCb)),onDrop:composeDragHandler(composeEventHandlers(onDrop,onDropCb)),role:typeof role==="string"&&role!==""?role:"presentation"},refKey,rootRef),!disabled&&!noKeyboard?{tabIndex:0}:{}),rest)}},[rootRef,onKeyDownCb,onFocusCb,onBlurCb,onClickCb,onDragEnterCb,onDragOverCb,onDragLeaveCb,onDropCb,noKeyboard,noDrag,disabled]);var onInputElementClick=React.useCallback(function(event){event.stopPropagation()},[]);var getInputProps=React.useMemo(function(){return function(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$refKey=_ref3.refKey,refKey=_ref3$refKey===void 0?"ref":_ref3$refKey,onChange=_ref3.onChange,onClick=_ref3.onClick,rest=_objectWithoutProperties(_ref3,_excluded4);var inputProps=_defineProperty({accept:acceptAttr,multiple:multiple,type:"file",style:{display:"none"},onChange:composeHandler(composeEventHandlers(onChange,onDropCb)),onClick:composeHandler(composeEventHandlers(onClick,onInputElementClick)),tabIndex:-1},refKey,inputRef);return _objectSpread(_objectSpread({},inputProps),rest)}},[inputRef,accept,multiple,onDropCb,disabled]);return _objectSpread(_objectSpread({},state),{},{isFocused:isFocused&&!disabled,getRootProps:getRootProps,getInputProps:getInputProps,rootRef:rootRef,inputRef:inputRef,open:composeHandler(openFileDialog)})}function reducer(state,action){switch(action.type){case"focus":return _objectSpread(_objectSpread({},state),{},{isFocused:true});case"blur":return _objectSpread(_objectSpread({},state),{},{isFocused:false});case"openDialog":return _objectSpread(_objectSpread({},initialState),{},{isFileDialogActive:true});case"closeDialog":return _objectSpread(_objectSpread({},state),{},{isFileDialogActive:false});case"setDraggedFiles":return _objectSpread(_objectSpread({},state),{},{isDragActive:action.isDragActive,isDragAccept:action.isDragAccept,isDragReject:action.isDragReject});case"setFiles":return _objectSpread(_objectSpread({},state),{},{acceptedFiles:action.acceptedFiles,fileRejections:action.fileRejections});case"reset":return _objectSpread({},initialState);default:return state}}function noop(){}var Dropzone=function Dropzone(_ref299){var onDrop=_ref299.onDrop,accept=_ref299.accept,dragClass=_ref299.dragClass,children=_ref299.children;var _useDropzone2=useDropzone({onDrop:onDrop,accept:accept,noClick:true,noKeyboard:true}),getRootProps=_useDropzone2.getRootProps,isDragActive=_useDropzone2.isDragActive;return React.createElement("div",Object.assign({className:isDragActive?dragClass:""},getRootProps()),children)};var typed=null;var Editor=function Editor(_ref300){var id=_ref300.id,appId=_ref300.appId,parentId=_ref300.parentId,placeholder=_ref300.placeholder,text=_ref300.text,buttonText=_ref300.buttonText,embed=_ref300.embed,initialAttachments=_ref300.attachments,initialOptions=_ref300.options,initialMeeting=_ref300.meeting,_ref300$showAttachmen=_ref300.showAttachments,showAttachments=_ref300$showAttachmen===void 0?false:_ref300$showAttachmen,_ref300$showCloudFile=_ref300.showCloudFiles,showCloudFiles=_ref300$showCloudFile===void 0?false:_ref300$showCloudFile,_ref300$showEmbeds=_ref300.showEmbeds,showEmbeds=_ref300$showEmbeds===void 0?false:_ref300$showEmbeds,_ref300$showPolls=_ref300.showPolls,showPolls=_ref300$showPolls===void 0?false:_ref300$showPolls,_ref300$showMeetings=_ref300.showMeetings,showMeetings=_ref300$showMeetings===void 0?false:_ref300$showMeetings,_ref300$showTyping=_ref300.showTyping,showTyping=_ref300$showTyping===void 0?false:_ref300$showTyping,_ref300$useDraft=_ref300.useDraft,useDraft=_ref300$useDraft===void 0?false:_ref300$useDraft,_ref300$showMention=_ref300.showMention,showMention=_ref300$showMention===void 0?false:_ref300$showMention,onSubmit=_ref300.onSubmit,editorType=_ref300.editorType,editorLocation=_ref300.editorLocation;var _React$useContext36=React.useContext(WeavyContext),client=_React$useContext36.client,options=_React$useContext36.options;var _React$useState113=React.useState(""),_React$useState114=_slicedToArray2(_React$useState113,2),files=_React$useState114[0],setFiles=_React$useState114[1];var _React$useState115=React.useState(false),_React$useState116=_slicedToArray2(_React$useState115,2),editorError=_React$useState116[0],setEditorError=_React$useState116[1];var _React$useState117=React.useState([]),_React$useState118=_slicedToArray2(_React$useState117,2),blobs=_React$useState118[0],setBlobs=_React$useState118[1];var _React$useState119=React.useState([]),_React$useState120=_slicedToArray2(_React$useState119,2),attachments=_React$useState120[0],setAttachments=_React$useState120[1];var _React$useState121=React.useState(null),_React$useState122=_slicedToArray2(_React$useState121,2),meeting=_React$useState122[0],setMeeting=_React$useState122[1];var _React$useState123=React.useState([]),_React$useState124=_slicedToArray2(_React$useState123,2),pollOptions=_React$useState124[0],setPollOptions=_React$useState124[1];var _React$useState125=React.useState(false),_React$useState126=_slicedToArray2(_React$useState125,2),pollVisible=_React$useState126[0],setPollVisible=_React$useState126[1];var _React$useState127=React.useState([]),_React$useState128=_slicedToArray2(_React$useState127,2),embeds=_React$useState128[0],setEmbeds=_React$useState128[1];var _React$useState129=React.useState(false),_React$useState130=_slicedToArray2(_React$useState129,2),disabled=_React$useState130[0],setDisabled=_React$useState130[1];var _React$useState131=React.useState(""),_React$useState132=_slicedToArray2(_React$useState131,2),value=_React$useState132[0],setValue=_React$useState132[1];var _useCloudFiles=useCloudFiles(handleExternalFileAdded),openCloudFiles=_useCloudFiles.openCloudFiles;var editorRef=React.useRef(null);var fileInput;var sendTyping=useMutateTyping();var cacheKey=["".concat(editorLocation,"-").concat(editorType,"-uploads"),appId,id];var uploadFileMutation=useMutateFileUpload(cacheKey);var _useMutatingFileUploa=useMutatingFileUploads(cacheKey),fileList=_useMutatingFileUploa.mutations,progress=_useMutatingFileUploa.progress,status=_useMutatingFileUploa.status;var removeMutatingFileUpload=useRemoveMutatingFileUpload(cacheKey);var clearMutatingFileUpload=useClearMutatingFileUpload(cacheKey);var throttledTyping=React.useCallback(throttle$1(function(){sendTyping.mutate({id:appId,type:editorType,location:editorLocation})},2000,{trailing:false}),[appId]);var throttledDrafting=React.useCallback(throttle$1(function(){saveDraft()},500),[appId,blobs,meeting,value,pollOptions]);var extensions=[keymap.of([{key:editorType=="messages"?"Enter":"Ctrl-Enter",preventDefault:true,run:function run(){handleCreate();return true}}]),markdown({base:markdownLanguage}),mentions,autocompletion({override:showMention?[autocomplete]:null,closeOnBlur:false,icons:false,addToOptions:[{render:function render(completion,state){var _a,_b,_c,_d;var div=document.createElement("div");div.classList.add("wy-item");div.classList.add("wy-item-hover");if(!((_a=completion.item)===null||_a===void 0?void 0:_a.is_member)){div.classList.add("wy-disabled")}var avatarDiv=document.createElement("div");avatarDiv.classList.add("wy-avatar");avatarDiv.classList.add("wy-avatar-initials");avatarDiv.title=((_b=completion.item)===null||_b===void 0?void 0:_b.display_name)||"";var avatarSpan=document.createElement("span");avatarSpan.innerHTML=getInitials(((_c=completion.item)===null||_c===void 0?void 0:_c.display_name)||"")||"";avatarDiv.appendChild(avatarSpan);var name=document.createElement("div");name.classList.add("wy-item-body");name.innerText=((_d=completion.item)===null||_d===void 0?void 0:_d.display_name)||"";div.appendChild(avatarDiv);div.appendChild(name);return div},position:10}]}),syntaxHighlighting(defaultHighlightStyle,{fallback:true}),EditorView.lineWrapping,EditorView.domEventHandlers({paste:function paste(evt,view){var _a;var files=[];var items=((_a=evt.clipboardData)===null||_a===void 0?void 0:_a.items)||[];for(var index in items){var item=items[index];if(item.kind==="file"){files=[].concat(_toConsumableArray2(files),[item.getAsFile()])}}if(files.length>0&&showAttachments){for(var i=0;i<files.length;i++){var file=files[i];var fileProps={file:file};uploadFileMutation.mutateAsync(fileProps,{})}return true}}})];function autocomplete(_x122){return _autocomplete.apply(this,arguments)}function _autocomplete(){_autocomplete=_asyncToGenerator(_regeneratorRuntime().mark(function _callee148(context){var before,response,result,completions;return _regeneratorRuntime().wrap(function _callee148$(_context151){while(1)switch(_context151.prev=_context151.next){case 0:before=context.matchBefore(/(?!\]\(@)(^[^@]{0,1}|[^@]{2})@([^@]+)/);if(!(!context.explicit&&!before)){_context151.next=3;break}return _context151.abrupt("return",null);case 3:before=context.matchBefore(/@[^@]+/);typed=before===null||before===void 0?void 0:before.text.substring(1);_context151.next=7;return client===null||client===void 0?void 0:client.get("/api/users/autocomplete?id="+appId+"&q="+typed);case 7:response=_context151.sent;_context151.next=10;return response===null||response===void 0?void 0:response.json();case 10:result=_context151.sent;completions=[];if(result.data){completions=result.data.filter(function(item){return typeof item.display_name!=="undefined"}).map(function(item){return{item:item,label:item.display_name,apply:function apply(view,completion,from,to){var toInsert="["+item.display_name+"](@u"+item.id.toString()+")";var transaction=view.state.update({changes:{from:from-1,to:from}});view.dispatch(transaction);transaction=view.state.update({changes:{from:from-1,to:to-1,insert:toInsert}});view.dispatch(transaction)}}})}return _context151.abrupt("return",{from:before?before.from+1:context.pos,options:completions,filter:false});case 14:case"end":return _context151.stop()}},_callee148)}));return _autocomplete.apply(this,arguments)}React.useEffect(function(){if(text!=null){setValue(text)}if(embed!=null){setEmbeds([embed]);initEmbeds([embed.original_url])}if(initialAttachments!=null){setAttachments(initialAttachments)}if(initialOptions!=null){setPollOptions([].concat(_toConsumableArray2(initialOptions),[{id:null,text:""}]));setPollVisible(true)}if(initialMeeting!=null){setMeeting(initialMeeting)}},[appId,text,embed,initialAttachments,initialOptions,initialMeeting]);React.useEffect(function(){var _a;if(useDraft){var key="draft-".concat(editorType,"-").concat(parentId||appId);var draft=localStorage.getItem(key);if(draft){var _values=JSON.parse(draft);setValue(_values.text);setBlobs(_values.blobs);setEmbeds(_values.embeds);setMeeting(_values.meeting);if(((_a=_values.pollOptions)===null||_a===void 0?void 0:_a.length)>0){setPollVisible(true);setPollOptions(_values.pollOptions)}}}return function(){clearMutatingFileUpload()}},[]);useUpdateEffect(function(){if(useDraft){saveDraft()}},[editorRef,fileList,blobs,meeting,embeds,value,pollOptions]);function saveDraft(){var _a,_b;var key="draft-".concat(editorType,"-").concat(parentId||appId);var text=(_b=(_a=editorRef.current)===null||_a===void 0?void 0:_a.view)===null||_b===void 0?void 0:_b.state.doc.toString();if(text===undefined){text=value}var blobFiles=fileList.filter(function(m){var _a,_b;return((_b=(_a=m===null||m===void 0?void 0:m.state)===null||_a===void 0?void 0:_a.context)===null||_b===void 0?void 0:_b.blob)!=null}).map(function(f){return f.state.context.blob});var allBlobs=[].concat(_toConsumableArray2(blobFiles),_toConsumableArray2(blobs));if(!allBlobs.length&&!meeting&&!embeds.length&&!pollOptions.length&&text===""){localStorage.removeItem(key)}else{localStorage.setItem(key,JSON.stringify({blobs:allBlobs,meeting:meeting,text:text,pollOptions:pollOptions,embeds:embeds}))}}var handleEmbeds=function(){var _ref301=_asyncToGenerator(_regeneratorRuntime().mark(function _callee145(content){return _regeneratorRuntime().wrap(function _callee145$(_context148){while(1)switch(_context148.prev=_context148.next){case 0:_context148.next=2;return getEmbeds(content);case 2:case"end":return _context148.stop()}},_callee145)}));return function handleEmbeds(_x123){return _ref301.apply(this,arguments)}}();var handleAddEmbed=function handleAddEmbed(data){setEmbeds(function(previous){return[data].concat(_toConsumableArray2(previous))})};var _useEmbeds=useEmbeds(handleAddEmbed),getEmbeds=_useEmbeds.getEmbeds,initEmbeds=_useEmbeds.initEmbeds,clearEmbeds=_useEmbeds.clearEmbeds;var handleEmbedRemove=function handleEmbedRemove(embedId){setEmbeds(function(previous){return previous.filter(function(e){return e.id!==embedId})})};var handleEmbedSwap=function handleEmbedSwap(){setEmbeds(function(previous){var first=previous.shift();if(first){return[].concat(_toConsumableArray2(previous),[first])}return previous})};var onChange=function onChange(value,viewUpdate){if(showEmbeds){handleEmbeds(value)}if(showTyping&&viewUpdate.state.doc.toString()!==""){throttledTyping()}if(useDraft){throttledDrafting()}};var handleFileUpload=function(){var _ref302=_asyncToGenerator(_regeneratorRuntime().mark(function _callee146(e){var i,file,fileProps;return _regeneratorRuntime().wrap(function _callee146$(_context149){while(1)switch(_context149.prev=_context149.next){case 0:if(e.target.files){for(i=0;i<e.target.files.length;i++){file=e.target.files[i];fileProps={file:file};uploadFileMutation.mutateAsync(fileProps,{})}}case 1:case"end":return _context149.stop()}},_callee146)}));return function handleFileUpload(_x124){return _ref302.apply(this,arguments)}}();var openFileInput=function openFileInput(e){fileInput===null||fileInput===void 0?void 0:fileInput.click()};var handleRemoveFile=function handleRemoveFile(mutation,id,e){setFiles("");removeMutatingFileUpload(mutation)};var handleRemoveBlob=function handleRemoveBlob(id,e){setFiles("");setBlobs(blobs.filter(function(b){return b.id!==id}))};var handleRemoveAttachment=function handleRemoveAttachment(id,e){setAttachments(attachments.filter(function(a){return a.id!==id}))};function handleExternalFileAdded(externalFiles){setBlobs([].concat(_toConsumableArray2(blobs),_toConsumableArray2(externalFiles)))}var onDrop=React.useCallback(function(acceptedFiles){if(acceptedFiles.length>0&&showAttachments){for(var i=0;i<acceptedFiles.length;i++){var file=acceptedFiles[i];var fileProps={file:file};uploadFileMutation.mutateAsync(fileProps,{})}return true}},[]);var handlePoll=function handlePoll(){if(!pollVisible){if(pollOptions.length===0){var option={id:null,text:""};setPollOptions(function(prev){return[].concat(_toConsumableArray2(prev),[option])})}setPollVisible(true)}else{setPollVisible(false)}};var handlePollOptionAdd=function handlePollOptionAdd(e,key){if(key===pollOptions.length-1){var option={id:null,text:""};setPollOptions(function(prev){return[].concat(_toConsumableArray2(prev),[option])})}};var handlePollOptionChange=function handlePollOptionChange(i,e){var newValues=_toConsumableArray2(pollOptions);newValues[i].text=e.target.value;setPollOptions(newValues)};var handleMeetingAdd=function handleMeetingAdd(m){setMeeting(m)};var handleMeetingDelete=function handleMeetingDelete(){setMeeting(null)};var handleCreate=function(){var _ref303=_asyncToGenerator(_regeneratorRuntime().mark(function _callee147(){var _a,_b,text,blobFiles,allBlobs;return _regeneratorRuntime().wrap(function _callee147$(_context150){while(1)switch(_context150.prev=_context150.next){case 0:text=((_b=(_a=editorRef.current)===null||_a===void 0?void 0:_a.view)===null||_b===void 0?void 0:_b.state.doc.toString())||"";blobFiles=fileList.filter(function(m){var _a,_b;return((_b=(_a=m===null||m===void 0?void 0:m.state)===null||_a===void 0?void 0:_a.context)===null||_b===void 0?void 0:_b.blob)!=null}).map(function(f){return f.state.context.blob});allBlobs=[].concat(_toConsumableArray2(blobFiles),_toConsumableArray2(blobs));if(!(text===""&&allBlobs.length===0&&attachments.length===0&&embeds.length===0&&meeting===null&&pollOptions.filter(function(p){return p.text.trim()!==""}).length===0)){_context150.next=6;break}setEditorError(true);return _context150.abrupt("return");case 6:setDisabled(true);queueMicrotask(function(){var _a,_b,_c,_d;setValue("");setFiles("");setBlobs([]);setAttachments([]);setEmbeds([]);setPollOptions([]);setPollVisible(false);clearEmbeds();setMeeting(null);(_b=(_a=editorRef.current)===null||_a===void 0?void 0:_a.view)===null||_b===void 0?void 0:_b.dispatch({changes:{from:0,to:(_d=(_c=editorRef.current)===null||_c===void 0?void 0:_c.view)===null||_d===void 0?void 0:_d.state.doc.length,insert:""}});setEditorError(false);clearMutatingFileUpload()});_context150.next=10;return onSubmit(text,allBlobs,attachments,(meeting===null||meeting===void 0?void 0:meeting.id)||null,embeds.length>0?embeds[0].id:null,pollOptions);case 10:setDisabled(false);case 11:case"end":return _context150.stop()}},_callee147)}));return function handleCreate(){return _ref303.apply(this,arguments)}}();var editorInputs=React.createElement(React.Fragment,null,editorType==="messages"&&React.createElement("div",{className:"wy-message-editor-inputs"},(showAttachments||showCloudFiles)&&React.createElement(UIDropdown.UI,{directionY:"up",icon:"plus"},showAttachments&&React.createElement(React.Fragment,null,React.createElement(UIDropdown.Item,{onClick:openFileInput},React.createElement(UIIcon.UI,{name:"attachment"})," File from device"),React.createElement("input",{type:"file",ref:function ref(input){return fileInput=input},value:files,onChange:handleFileUpload,multiple:true,hidden:true,tabIndex:-1})),showCloudFiles&&React.createElement(UIDropdown.Item,{onClick:openCloudFiles},React.createElement(UIIcon.UI,{name:"cloud"})," File from cloud"),showMeetings&&React.createElement(Meetings,{onMeetingAdded:handleMeetingAdd,dropdown:true})),React.createElement("div",{className:classNames("wy-message-editor-text",{"wy-is-invalid":editorError})},React.createElement(ReactCodeMirror,{ref:editorRef,value:value,placeholder:placeholder,extensions:extensions,onChange:onChange,indentWithTab:false,basicSetup:{defaultKeymap:false,lineNumbers:false,dropCursor:true,highlightActiveLine:false,history:true,foldGutter:false,autocompletion:true,drawSelection:false,highlightSpecialChars:false,syntaxHighlighting:false,highlightSelectionMatches:false}})),React.createElement(UIButton.UI,{title:buttonText,disabled:disabled,onClick:handleCreate},React.createElement(UIIcon.UI,{name:"send",color:"primary"}))),editorType==="comments"&&React.createElement(React.Fragment,null,React.createElement("div",{className:"wy-comment-editor-inputs"},(showAttachments||showCloudFiles)&&React.createElement(UIDropdown.UI,{directionY:"up",icon:"plus"},showAttachments&&React.createElement(React.Fragment,null,React.createElement(UIDropdown.Item,{onClick:openFileInput},React.createElement(UIIcon.UI,{name:"attachment"})," File from device"),React.createElement("input",{type:"file",ref:function ref(input){return fileInput=input},value:files,onChange:handleFileUpload,multiple:true,hidden:true,tabIndex:-1})),showCloudFiles&&React.createElement(UIDropdown.Item,{onClick:openCloudFiles},React.createElement(UIIcon.UI,{name:"cloud"})," File from cloud")),React.createElement("div",{className:classNames("wy-comment-editor-text",{"wy-is-invalid":editorError})},React.createElement(ReactCodeMirror,{ref:editorRef,value:value,placeholder:placeholder,extensions:extensions,onChange:onChange,indentWithTab:false,basicSetup:{defaultKeymap:false,lineNumbers:false,dropCursor:true,highlightActiveLine:false,history:true,foldGutter:false,autocompletion:true,drawSelection:false,highlightSpecialChars:false,syntaxHighlighting:false,highlightSelectionMatches:false}})),React.createElement(UIButton.UI,{title:buttonText,disabled:disabled,onClick:handleCreate},React.createElement(UIIcon.UI,{name:"send",color:"primary"})))),editorType==="posts"&&React.createElement(React.Fragment,null,React.createElement("div",{className:classNames("wy-post-editor-text",{"wy-is-invalid":editorError})},React.createElement(ReactCodeMirror,{ref:editorRef,value:value,placeholder:placeholder,extensions:extensions,onChange:onChange,indentWithTab:false,basicSetup:{defaultKeymap:false,lineNumbers:false,dropCursor:true,highlightActiveLine:false,history:true,foldGutter:false,autocompletion:true,drawSelection:false,highlightSpecialChars:false,syntaxHighlighting:false,highlightSelectionMatches:false}})),React.createElement("div",{className:"wy-post-editor-inputs"},showAttachments&&React.createElement("div",null,React.createElement(UIButton.UI,{title:"Add file from device",onClick:openFileInput},React.createElement(UIIcon.UI,{name:"attachment"})),React.createElement("input",{type:"file",ref:function ref(input){return fileInput=input},value:files,onChange:handleFileUpload,multiple:true,hidden:true,tabIndex:-1})),showCloudFiles&&React.createElement(UIButton.UI,{title:"Add file from cloud",onClick:openCloudFiles},React.createElement(UIIcon.UI,{name:"cloud"})),showMeetings&&React.createElement(Meetings,{onMeetingAdded:handleMeetingAdd}),showPolls&&React.createElement(UIButton.UI,{title:"Add poll",onClick:handlePoll},React.createElement(UIIcon.UI,{name:"poll"})),React.createElement(UIButton.UI,{className:"wy-button-primary",title:buttonText,disabled:disabled,onClick:handleCreate},buttonText))));var editorLists=React.createElement(React.Fragment,null,showPolls&&pollVisible&&pollOptions.length>0&&React.createElement("div",{className:"wy-poll-form"},pollOptions.map(function(p,index){return React.createElement("input",{key:"option_"+index,value:p.text,onChange:function onChange(e){return handlePollOptionChange(index,e)},className:"wy-input",type:"text",placeholder:"+ add an option",onFocus:function onFocus(e){return handlePollOptionAdd(e,index)}})})),(showAttachments||showCloudFiles)&&React.createElement("div",null,attachments.map(function(a){return React.createElement(Blob$1,{key:a.id,id:a.id,name:a.name,className:"wy-item-body"},React.createElement(UIButton.UI,{onClick:handleRemoveAttachment.bind(Editor,a.id)},React.createElement(UIIcon.UI,{name:"close-circle"})))}),fileList&&fileList.map(function(m,index){var _a;var f=(_a=m.state.context)===null||_a===void 0?void 0:_a.file;return React.createElement(React.Fragment,{key:"f"+index},f&&React.createElement(FileItem$1.Item,{file:f,features:[],appFeatures:undefined},React.createElement(UIButton.UI,{onClick:handleRemoveFile.bind(Editor,m,f.id)},React.createElement(UIIcon.UI,{name:"close-circle"}))))}),blobs.map(function(a){return React.createElement(Blob$1,{key:a.id,id:a.id,name:a.name,className:"wy-item-body"},React.createElement(UIButton.UI,{onClick:handleRemoveBlob.bind(Editor,a.id)},React.createElement(UIIcon.UI,{name:"close-circle"})))})),showMeetings&&meeting&&React.createElement("div",{className:"wy-item"},React.createElement(Meeting,{id:meeting.id,title:meeting.provider,className:"wy-item-body"}),React.createElement(UIButton.UI,{onClick:handleMeetingDelete},React.createElement(UIIcon.UI,{name:"close-circle"}))),showEmbeds&&React.createElement("div",{className:"wy-embed-preview"},React.createElement(React.Fragment,null,embeds.map(function(embed,index){return React.createElement(Embed,{key:"embed"+index,embed:embed,onRemove:handleEmbedRemove,onSwap:embeds.length>1?handleEmbedSwap:null})}))));return React.createElement("div",{className:classNames({"wy-post-editor":editorType==="posts"},{"wy-comment-editor":editorType==="comments"},{"wy-message-editor":editorType==="messages"})},React.createElement(Dropzone,{onDrop:onDrop,dragClass:classNames({"wy-post-editor-dragging":editorType==="posts"},{"wy-comment-editor-dragging":editorType==="comments"},{"wy-message-editor-dragging":editorType==="messages"})},editorType==="messages"&&React.createElement(React.Fragment,null,editorLists),editorInputs,(editorType==="posts"||editorType==="comments")&&React.createElement(React.Fragment,null,editorLists)))};var Messages=function Messages(_ref304){var id=_ref304.id,members=_ref304.members,displayName=_ref304.displayName,avatarUrl=_ref304.avatarUrl,lastMessageId=_ref304.lastMessageId,chatRoom=_ref304.chatRoom,_ref304$contextual=_ref304.contextual,contextual=_ref304$contextual===void 0?false:_ref304$contextual,features=_ref304.features,appFeatures=_ref304.appFeatures;var _React$useState133=React.useState(),_React$useState134=_slicedToArray2(_React$useState133,2),onNextRender=_React$useState134[1];var _React$useContext37=React.useContext(UserContext),user=_React$useContext37.user;var queryClient=useQueryClient();var _React$useContext38=React.useContext(WeavyContext),client=_React$useContext38.client;var messagesEndRef=React.useRef();var _useEvents3=useEvents(),dispatch=_useEvents3.dispatch,on=_useEvents3.on,events=_useEvents3.events;var infiniteMessages=useMessages(id,{});var isLoading=infiniteMessages.isLoading,isError=infiniteMessages.isError,data=infiniteMessages.data,error=infiniteMessages.error,fetchNextPage=infiniteMessages.fetchNextPage,hasNextPage=infiniteMessages.hasNextPage,isFetching=infiniteMessages.isFetching,isFetchingNextPage=infiniteMessages.isFetchingNextPage;var readMessageMutation=useMutateRead();var addMessageMutation=useMutateMessage();React.useLayoutEffect(function(){if(id&&!isLoading){scrollParentToBottom(messagesEndRef.current);onNextRender(function(){return requestAnimationFrame(function(){return scrollParentToBottom(messagesEndRef.current)})})}},[id,isLoading]);var readMoreRef=useReverseInfiniteScroll(infiniteMessages,[id]);React.useEffect(function(){if(id&&lastMessageId){readMessageMutation.mutate({id:id,read:true,messageId:lastMessageId})}},[id,lastMessageId]);React.useEffect(function(){if(id){client===null||client===void 0?void 0:client.subscribe("a".concat(id),"message_created",handleRealtimeMessage);client===null||client===void 0?void 0:client.subscribe("a".concat(id),"reaction_added",handleRealtimeReactionInserted);client===null||client===void 0?void 0:client.subscribe("a".concat(id),"reaction_removed",handleRealtimeReactionDeleted);if(!contextual){client===null||client===void 0?void 0:client.subscribe("a".concat(id),"conversation_marked",handleRealtimeSeenBy)}}return function(){if(id){var qd=queryClient.getQueryData(["messages",id]);if(qd){queryClient.setQueryData(["messages",id],function(data){return{pages:data===null||data===void 0?void 0:data.pages.slice(0,1),pageParams:[undefined]}})}client===null||client===void 0?void 0:client.unsubscribe("a".concat(id),"message_created",handleRealtimeMessage);client===null||client===void 0?void 0:client.unsubscribe("a".concat(id),"reaction_added",handleRealtimeReactionInserted);client===null||client===void 0?void 0:client.unsubscribe("a".concat(id),"reaction_removed",handleRealtimeReactionDeleted);if(!contextual){client===null||client===void 0?void 0:client.unsubscribe("a".concat(id),"conversation_marked",handleRealtimeSeenBy)}}}},[id]);var handleRealtimeReactionInserted=React.useCallback(function(realtimeEvent){dispatch("reaction_added_"+realtimeEvent.entity.id,realtimeEvent)},[id]);var handleRealtimeReactionDeleted=React.useCallback(function(realtimeEvent){dispatch("reaction_deleted_"+realtimeEvent.entity.id,realtimeEvent)},[id]);var scrollCallback=function scrollCallback(){onNextRender(function(){return requestAnimationFrame(function(){return scrollParentToBottom(readMoreRef.current,true)})})};var handleCreate=function(){var _ref305=_asyncToGenerator(_regeneratorRuntime().mark(function _callee149(text,blobs,attachments,meeting,embed,options){return _regeneratorRuntime().wrap(function _callee149$(_context152){while(1)switch(_context152.prev=_context152.next){case 0:if(!id){_context152.next=3;break}_context152.next=3;return addMessageMutation.mutateAsync({id:id,text:text,blobs:blobs,meeting:meeting,userId:user.id,callback:scrollCallback},{onSuccess:function onSuccess(data){onNextRender(function(){return requestAnimationFrame(function(){return scrollParentToBottom(readMoreRef.current,true)})});readMessageMutation.mutate({id:id,read:true,messageId:data.id},{onSettled:function onSettled(){return onNextRender(function(){return requestAnimationFrame(function(){return requestAnimationFrame(function(){return scrollParentToBottom(messagesEndRef.current,true)})})})}})}});case 3:case"end":return _context152.stop()}},_callee149)}));return function handleCreate(_x125,_x126,_x127,_x128,_x129,_x130){return _ref305.apply(this,arguments)}}();var handleRealtimeSeenBy=function(){var _ref306=_asyncToGenerator(_regeneratorRuntime().mark(function _callee150(data){var isAtBottom;return _regeneratorRuntime().wrap(function _callee150$(_context153){while(1)switch(_context153.prev=_context153.next){case 0:isAtBottom=isParentAtBottom(readMoreRef.current);queryClient.invalidateQueries(["members",id]);if(isAtBottom){onNextRender(function(){return requestAnimationFrame(function(){return scrollParentToBottom(readMoreRef.current,true)})})}case 3:case"end":return _context153.stop()}},_callee150)}));return function handleRealtimeSeenBy(_x131){return _ref306.apply(this,arguments)}}();var handleRealtimeMessage=React.useCallback(function(realtimeEvent){var _a;if(realtimeEvent.message.app_id!==id||realtimeEvent.message.created_by_id===user.id)return;realtimeEvent.message.created_by=realtimeEvent.actor;readMessageMutation.mutate({id:id,read:true,messageId:realtimeEvent.message.id});var previousData=queryClient.getQueryData(["messages",id]);if(previousData&&previousData.pages){var isAtBottom=isParentAtBottom(readMoreRef.current);var newPagesArray=(_a=previousData.pages.map(function(page,i){if(i===0){page.data=[].concat(_toConsumableArray2(page.data),[realtimeEvent.message])}return page}))!==null&&_a!==void 0?_a:[];queryClient.setQueryData(["messages",id],function(data){return{pages:newPagesArray,pageParams:data.pageParams}});if(isAtBottom){onNextRender(function(){return requestAnimationFrame(function(){return scrollParentToBottom(readMoreRef.current,true)})})}}},[id]);var messageHeader=React.createElement("div",{className:"wy-avatar-header"},chatRoom&&!avatarUrl?React.createElement(AvatarGroup,{members:members,user:user,name:displayName,size:128}):!contextual&&(displayName||avatarUrl)?React.createElement(Avatar,{src:avatarUrl,name:displayName,size:128,id:id}):undefined,!contextual&&displayName&&React.createElement("h3",{className:"wy-headline"},displayName));var loadMoreButton=React.createElement(UIButton.UI,{onClick:function onClick(){return fetchNextPage()},disabled:!hasNextPage||isFetchingNextPage,className:"wy-message-readmore"},"Load more");var messages=React.createElement(React.Fragment,null,React.createElement("div",{className:"wy-pager",ref:readMoreRef},isFetchingNextPage?"Loading more...":hasNextPage?loadMoreButton:messageHeader),data&&members&&data.pages&&data.pages.map(function(group,i){var _a;var lastDate;return React.createElement(React.Fragment,{key:data.pages.length-i},(_a=group.data)===null||_a===void 0?void 0:_a.map(function(item){var date=dayjs.utc(item.created_at).tz(dayjs.tz.guess());var dateContent=React.createElement(React.Fragment,null);if((lastDate===null||lastDate===void 0?void 0:lastDate.format("YYMMDD"))!==date.format("YYMMDD")){lastDate=date;dateContent=React.createElement("div",{className:"wy-date-separator"},React.createElement("time",null,date.format("L")))}var message=React.createElement(Message,{key:item.id,id:item.id,html:item.html,temp:item.temp,me:item.created_by.id===user.id,avatar:item.created_by.avatar_url,name:item.created_by.display_name,created_at:item.created_at,created_by:item.created_by.display_name,attachments:item.attachments,meeting:item.meeting,options:item.options,appId:id,reactions:item.reactions,chatRoom:chatRoom,features:features,appFeatures:appFeatures,seenBy:!contextual&&members.data&&members.data.length>0?members.data.filter(function(member){return member.marked_id===item.id&&member.id!==user.id}):[]});return React.createElement(React.Fragment,{key:item.id},dateContent,message)}))}),React.createElement("div",{ref:messagesEndRef}));if(isLoading){messages=React.createElement(UISpinner.UI,{overlay:true})}return React.createElement(React.Fragment,null,React.createElement("div",{id:"container",className:"wy-messages"},messages),React.createElement("div",{className:"wy-footerbar wy-footerbar-sticky"},React.createElement(Editor,{key:id,appId:id,placeholder:"Type a message",buttonText:"",editorType:"messages",editorLocation:"apps",onSubmit:handleCreate,showMention:hasFeature(features,Feature.Mentions,appFeatures===null||appFeatures===void 0?void 0:appFeatures.mentions),showAttachments:hasFeature(features,Feature.Attachments,appFeatures===null||appFeatures===void 0?void 0:appFeatures.attachments),showCloudFiles:hasFeature(features,Feature.CloudFiles,appFeatures===null||appFeatures===void 0?void 0:appFeatures.cloudFiles),showMeetings:hasFeature(features,Feature.Meetings,appFeatures===null||appFeatures===void 0?void 0:appFeatures.meetings),showTyping:hasFeature(features,Feature.Typing,appFeatures===null||appFeatures===void 0?void 0:appFeatures.typing),useDraft:true})))};function useMutateLeaveConversation(){var _React$useContext39=React.useContext(WeavyContext),client=_React$useContext39.client;var _React$useContext40=React.useContext(MessengerContext),setSelectedConversationId=_React$useContext40.setSelectedConversationId;var queryClient=useQueryClient();if(!client){throw new Error("useMutateLeaveConversation must be used within an WeavyProvider")}var mutateLeave=function(){var _ref308=_asyncToGenerator(_regeneratorRuntime().mark(function _callee151(_ref307){var id,members,response;return _regeneratorRuntime().wrap(function _callee151$(_context154){while(1)switch(_context154.prev=_context154.next){case 0:id=_ref307.id,members=_ref307.members;_context154.next=3;return client.post("/api/apps/"+id+"/members/"+members.join(","),"DELETE",JSON.stringify(members));case 3:response=_context154.sent;return _context154.abrupt("return",response);case 5:case"end":return _context154.stop()}},_callee151)}));return function mutateLeave(_x132){return _ref308.apply(this,arguments)}}();return useMutation(mutateLeave,{onSuccess:function onSuccess(){queryClient.invalidateQueries("conversations");setSelectedConversationId(null)}})}function useBadge(){var _React$useContext41=React.useContext(WeavyContext),client=_React$useContext41.client;if(!client){throw new Error("useBadge must be used within an WeavyProvider")}var getBadge=function(){var _ref309=_asyncToGenerator(_regeneratorRuntime().mark(function _callee152(){var response,_data12;return _regeneratorRuntime().wrap(function _callee152$(_context155){while(1)switch(_context155.prev=_context155.next){case 0:_context155.next=2;return client.get("/api/conversations/badge");case 2:response=_context155.sent;if(!response.ok){_context155.next=8;break}_context155.next=6;return response.json();case 6:_data12=_context155.sent;return _context155.abrupt("return",_data12);case 8:return _context155.abrupt("return",null);case 9:case"end":return _context155.stop()}},_callee152)}));return function getBadge(){return _ref309.apply(this,arguments)}}();return useQuery("badge",getBadge)}var ConversationBadge=function ConversationBadge(){var _React$useContext42=React.useContext(WeavyContext),client=_React$useContext42.client;var _React$useState135=React.useState(0),_React$useState136=_slicedToArray2(_React$useState135,2),badge=_React$useState136[0],setBadge=_React$useState136[1];if(!client){throw new Error("Weavy Badge component must be used within an WeavyProvider")}var _useBadge=useBadge(),isLoading=_useBadge.isLoading,data=_useBadge.data,refetch=_useBadge.refetch;var handleBadge=function handleBadge(data){refetch()};React.useEffect(function(){if(data){setBadge(data["private"]+data.rooms)}},[data]);React.useEffect(function(){client.subscribe(null,"message_created",handleBadge);client.subscribe(null,"conversation_marked",handleBadge);return function(){client.unsubscribe(null,"message_created",handleBadge);client.unsubscribe(null,"conversation_marked",handleBadge)}},[]);return React.createElement(React.Fragment,null,!isLoading&&badge>0&&React.createElement("span",{className:"wy-badge wy-badge-danger"},badge))};function useFeatures(type,options){var _React$useContext43=React.useContext(WeavyContext),client=_React$useContext43.client;if(!client){throw new Error("useFeatures must be used within an WeavyProvider")}var getFeatures=function(){var _ref310=_asyncToGenerator(_regeneratorRuntime().mark(function _callee153(){var response,data;return _regeneratorRuntime().wrap(function _callee153$(_context156){while(1)switch(_context156.prev=_context156.next){case 0:_context156.next=2;return client.get("/api/features/"+type);case 2:response=_context156.sent;_context156.next=5;return response.json();case 5:data=_context156.sent;return _context156.abrupt("return",data);case 7:case"end":return _context156.stop()}},_callee153)}));return function getFeatures(){return _ref310.apply(this,arguments)}}();return useQuery(["features",type],getFeatures,options)}var Conversation=function Conversation(_ref311){var id=_ref311.id,showBackButton=_ref311.showBackButton,features=_ref311.features;var _a;var queryClient=useQueryClient();var _React$useContext44=React.useContext(WeavyContext),client=_React$useContext44.client;var _React$useContext45=React.useContext(MessengerContext),selectedConversationId=_React$useContext45.selectedConversationId,setSelectedConversationId=_React$useContext45.setSelectedConversationId;var _React$useContext46=React.useContext(UserContext),user=_React$useContext46.user;var _React$useState137=React.useState(false),_React$useState138=_slicedToArray2(_React$useState137,2),modalAddOpen=_React$useState138[0],setModalAddOpen=_React$useState138[1];var _React$useState139=React.useState(false),_React$useState140=_slicedToArray2(_React$useState139,2),modalDetailsOpen=_React$useState140[0],setModalDetailsOpen=_React$useState140[1];var _React$useState141=React.useState(""),_React$useState142=_slicedToArray2(_React$useState141,2),title=_React$useState142[0],setTitle=_React$useState142[1];var _React$useState143=React.useState(false),_React$useState144=_slicedToArray2(_React$useState143,2),isRoomOrChat=_React$useState144[0],setIsRoomOrChat=_React$useState144[1];var ChatRoom="edb400ac-839b-45a7-b2a8-6a01820d1c44";var Chat="d65dd4bc-418e-403c-9f56-f9cf4da931ed";if(!client){throw new Error("Weavy Conversation component must be used within an WeavyProvider")}var _useConversation=useConversation(selectedConversationId,{enabled:selectedConversationId!=null}),isLoadingConversation=_useConversation.isLoading,dataConversation=_useConversation.data;var _useMembers=useMembers(selectedConversationId,{enabled:selectedConversationId!=null}),isLoadingMembers=_useMembers.isLoading,dataMembers=_useMembers.data,refetchMembers=_useMembers.refetch;var _useFeatures=useFeatures("chat",{enabled:selectedConversationId!=null}),isLoadingFeatures=_useFeatures.isLoading,dataFeatures=_useFeatures.data;var addMembersMutation=useMutateMembers();var updateNameMutation=useMutateConversationName();var removeMembers=useMutateRemoveMembers();var leaveConversation=useMutateLeaveConversation();var handleRealtimeAppUpdated=React.useCallback(function(realtimeEvent){if(realtimeEvent.app.id!==selectedConversationId)return;queryClient.invalidateQueries(["conversation",selectedConversationId])},[selectedConversationId]);var handleAdd=function(){var _ref312=_asyncToGenerator(_regeneratorRuntime().mark(function _callee154(selected){var membersList;return _regeneratorRuntime().wrap(function _callee154$(_context157){while(1)switch(_context157.prev=_context157.next){case 0:membersList=selected.map(function(m){return m.id});_context157.next=3;return addMembersMutation.mutateAsync({id:selectedConversationId,members:membersList});case 3:setModalAddOpen(false);case 4:case"end":return _context157.stop()}},_callee154)}));return function handleAdd(_x133){return _ref312.apply(this,arguments)}}();var toggleAddModal=function toggleAddModal(open){setModalAddOpen(open)};var toggleDetailsModal=function toggleDetailsModal(open){setModalDetailsOpen(open)};var handleUpdateTitle=function handleUpdateTitle(e){setTitle(e.target.value)};var handleSaveTitle=function handleSaveTitle(){updateNameMutation.mutate({id:selectedConversationId,name:title||null})};var handleLeaveConversation=function handleLeaveConversation(){leaveConversation.mutate({id:selectedConversationId,members:[user.id]});setModalDetailsOpen(false);setModalAddOpen(false)};var handleAddMembers=function handleAddMembers(){setModalDetailsOpen(false);setModalAddOpen(true)};var handleRemoveMember=function handleRemoveMember(id){removeMembers.mutate({id:selectedConversationId,members:[id]},{onSuccess:function onSuccess(){refetchMembers()}})};var handleBack=function handleBack(){setSelectedConversationId(null)};React.useEffect(function(){if(id){setSelectedConversationId(id)}},[id]);React.useEffect(function(){if(selectedConversationId){client.subscribe("a".concat(selectedConversationId),"app_updated",handleRealtimeAppUpdated)}return function(){if(selectedConversationId){client.unsubscribe("a".concat(selectedConversationId),"app_updated",handleRealtimeAppUpdated)}}},[selectedConversationId]);React.useEffect(function(){if(dataConversation&&dataConversation.type===ChatRoom){setTitle(dataConversation===null||dataConversation===void 0?void 0:dataConversation.display_name)}if(dataConversation&&(dataConversation.type===ChatRoom||dataConversation.type===Chat)){setIsRoomOrChat(true)}},[dataConversation]);return React.createElement(React.Fragment,null,React.createElement("header",{className:"wy-appbars","data-adjust-scrollbar-top":true},React.createElement("nav",{className:"wy-appbar"},React.createElement("div",null,showBackButton&&React.createElement(React.Fragment,null,React.createElement(UIButton.UI,{onClick:handleBack},React.createElement(UIIcon.UI,{name:"back"})),React.createElement(ConversationBadge,null))),selectedConversationId&&dataConversation&&React.createElement(React.Fragment,null,React.createElement("div",{className:"wy-appbar-text"},React.createElement(Typing$1,{id:selectedConversationId,context:"conversation"},React.createElement("div",{className:"wy-appbar-text wy-typing-hide"},!isRoomOrChat&&dataConversation.user_id&&React.createElement(Presence,{id:dataConversation.user_id,status:"away"}),dataConversation.display_name))),React.createElement(UIDropdown.UI,{directionX:"left"},React.createElement(UIDropdown.Item,{onClick:function onClick(){return toggleDetailsModal(true)}},React.createElement(UIIcon.UI,{name:"information"}),"Details"),dataConversation.type===ChatRoom&&React.createElement(React.Fragment,null,React.createElement(UIDropdown.Item,{onClick:function onClick(){return toggleAddModal(true)}},React.createElement(UIIcon.UI,{name:"account-plus"}),"Add members"),React.createElement(UIDropdown.Item,{onClick:handleLeaveConversation},React.createElement(UIIcon.UI,{name:"account-minus"}),"Leave conversation")))))),!selectedConversationId&&React.createElement("div",{className:"wy-avatar-header"},React.createElement(Avatar,{src:user.avatar_url,name:user.display_name,presence:user.presence,id:user.id,size:256}),React.createElement("h2",{className:"wy-title"},"Welcome ",user.name,"!"),"Create or select a conversation to get started"),selectedConversationId&&dataMembers&&dataConversation&&dataFeatures&&React.createElement("div",{className:"wy-pane-body"},React.createElement(Messages,{id:selectedConversationId,chatRoom:isRoomOrChat,members:dataMembers,displayName:dataConversation===null||dataConversation===void 0?void 0:dataConversation.display_name,avatarUrl:dataConversation===null||dataConversation===void 0?void 0:dataConversation.avatar_url,lastMessageId:(_a=dataConversation===null||dataConversation===void 0?void 0:dataConversation.last_message)===null||_a===void 0?void 0:_a.id,features:dataFeatures,appFeatures:features})),React.createElement(UIOverlay.UI,{isOpen:modalAddOpen,className:"wy-modal"},React.createElement("header",{className:"wy-appbars","data-adjust-scrollbar-top":true},React.createElement("nav",{className:"wy-appbar"},React.createElement(UIButton.UI,{onClick:function onClick(){return toggleAddModal(false)}},React.createElement(UIIcon.UI,{name:"close"})),React.createElement("div",{className:"wy-appbar-text"},"Add members"))),dataMembers&&React.createElement(SearchUsers,{existingMembers:dataMembers.data,handleSubmit:handleAdd,buttonTitle:"Save"})),React.createElement(UIOverlay.UI,{isOpen:modalDetailsOpen,className:"wy-modal"},React.createElement("header",{className:"wy-appbars"},React.createElement("nav",{className:"wy-appbar"},React.createElement(UIButton.UI,{onClick:function onClick(){return toggleDetailsModal(false)}},React.createElement(UIIcon.UI,{name:"close"})),React.createElement("div",{className:"wy-appbar-text"},"Details"))),React.createElement("div",{className:"wy-scroll-y"},dataConversation&&React.createElement("div",{className:"wy-avatar-header"},(dataConversation===null||dataConversation===void 0?void 0:dataConversation.type)===ChatRoom&&user?React.createElement(AvatarGroup,{size:128,members:dataMembers,user:user,name:title}):React.createElement(Avatar,{src:dataConversation===null||dataConversation===void 0?void 0:dataConversation.avatar_url,name:dataConversation===null||dataConversation===void 0?void 0:dataConversation.display_name,size:128}),(dataConversation===null||dataConversation===void 0?void 0:dataConversation.type)!==ChatRoom&&React.createElement("h3",{className:"wy-headline"},dataConversation===null||dataConversation===void 0?void 0:dataConversation.display_name)),(dataConversation===null||dataConversation===void 0?void 0:dataConversation.type)===ChatRoom&&React.createElement(React.Fragment,null,React.createElement("div",{className:"wy-pane-group"},React.createElement("label",{className:"wy-input-label"},"Conversation name"),React.createElement("div",{className:"wy-input-group"},React.createElement("input",{className:"wy-input",value:title,onChange:function onChange(e){return handleUpdateTitle(e)}}),React.createElement(UIButton.UI,{onClick:handleSaveTitle,className:"wy-button-icon"},React.createElement(UIIcon.UI,{name:"content-save"}))),React.createElement("div",{className:"wy-description"},"Changing the name of a group chat changes it for everyone.")),React.createElement("div",{className:"wy-pane-group"},React.createElement("label",{className:"wy-input-label"},"Members"),dataConversation&&dataMembers&&dataMembers.data&&dataMembers.data.map(function(m){return React.createElement("div",{className:"wy-item",key:m.id},React.createElement(Avatar,{src:m.avatar_url,name:m.display_name,id:m.id,size:32,presence:m.presence}),React.createElement("div",{className:"wy-item-body"},m.display_name),dataConversation.created_by_id===user.id&&m.id!==user.id&&React.createElement(UIButton.UI,{onClick:function onClick(){return handleRemoveMember(m.id)},className:"wy-button-icon",title:"Remove member"},React.createElement(UIIcon.UI,{name:"account-minus"})),m.id===user.id&&React.createElement(UIButton.UI,{onClick:function onClick(){return handleLeaveConversation()},className:"wy-button-icon",title:"Leave conversation"},React.createElement(UIIcon.UI,{name:"account-minus"})))}),React.createElement(UIButton.UI,{onClick:handleAddMembers,title:"Add members"},React.createElement(UIIcon.UI,{name:"account-plus"}),React.createElement("div",{className:"wy-item-body"},"Add members")))))))};var Conversation$1=React.memo(Conversation);function useConversations(options){var _React$useContext47=React.useContext(WeavyContext),client=_React$useContext47.client;var PAGE_SIZE=25;if(!client){throw new Error("useConversations must be used within an WeavyProvider")}var getConversations=function(){var _ref313=_asyncToGenerator(_regeneratorRuntime().mark(function _callee155(opt){var skip,response,data;return _regeneratorRuntime().wrap(function _callee155$(_context158){while(1)switch(_context158.prev=_context158.next){case 0:skip=opt.pageParam||0;_context158.next=3;return client.get("/api/conversations?contextual=false&skip="+skip+"&top="+PAGE_SIZE);case 3:response=_context158.sent;_context158.next=6;return response.json();case 6:data=_context158.sent;return _context158.abrupt("return",data);case 8:case"end":return _context158.stop()}},_callee155)}));return function getConversations(_x134){return _ref313.apply(this,arguments)}}();var opts=Object.assign(Object.assign({},options),{getNextPageParam:function getNextPageParam(lastPage,pages){if((lastPage===null||lastPage===void 0?void 0:lastPage.end)<(lastPage===null||lastPage===void 0?void 0:lastPage.count)){return pages.length*PAGE_SIZE}}});return useInfiniteQuery("conversations",getConversations,opts)}function useMutatePinned(){var _React$useContext48=React.useContext(WeavyContext),client=_React$useContext48.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutatePinned must be used within an WeavyProvider")}var mutatePinned=function(){var _ref315=_asyncToGenerator(_regeneratorRuntime().mark(function _callee156(_ref314){var id,pin,response;return _regeneratorRuntime().wrap(function _callee156$(_context159){while(1)switch(_context159.prev=_context159.next){case 0:id=_ref314.id,pin=_ref314.pin;_context159.next=3;return client.post("/api/conversations/"+id+"/pin",!pin?"DELETE":"PUT","");case 3:response=_context159.sent;return _context159.abrupt("return",response.json());case 5:case"end":return _context159.stop()}},_callee156)}));return function mutatePinned(_x135){return _ref315.apply(this,arguments)}}();return useMutation(mutatePinned,{onSuccess:function onSuccess(){queryClient.invalidateQueries("conversations")}})}function useMutateStarred(){var _React$useContext49=React.useContext(WeavyContext),client=_React$useContext49.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateStarred must be used within an WeavyProvider")}var mutateStarred=function(){var _ref317=_asyncToGenerator(_regeneratorRuntime().mark(function _callee157(_ref316){var id,star,response;return _regeneratorRuntime().wrap(function _callee157$(_context160){while(1)switch(_context160.prev=_context160.next){case 0:id=_ref316.id,star=_ref316.star;_context160.next=3;return client.post("/api/apps/"+id+"/stars",!star?"DELETE":"POST","");case 3:response=_context160.sent;return _context160.abrupt("return",response);case 5:case"end":return _context160.stop()}},_callee157)}));return function mutateStarred(_x136){return _ref317.apply(this,arguments)}}();return useMutation(mutateStarred,{onSuccess:function onSuccess(){queryClient.invalidateQueries("conversations")}})}var ConversationListItem=function ConversationListItem(_ref318){var item=_ref318.item,userId=_ref318.userId,members=_ref318.members,refetchConversations=_ref318.refetchConversations;var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k;var _React$useContext50=React.useContext(WeavyContext),client=_React$useContext50.client;var _React$useContext51=React.useContext(MessengerContext),setSelectedConversationId=_React$useContext51.setSelectedConversationId,selectedConversationId=_React$useContext51.selectedConversationId;var _React$useContext52=React.useContext(UserContext),user=_React$useContext52.user;var readMutation=useMutateRead();var pinMutation=useMutatePinned();var starMutation=useMutateStarred();var leaveConversation=useMutateLeaveConversation();var date=dayjs.utc((_a=item.last_message)===null||_a===void 0?void 0:_a.created_at).tz(dayjs.tz.guess());var ChatRoom="edb400ac-839b-45a7-b2a8-6a01820d1c44";var handleClick=function handleClick(e,id){if(!e.defaultPrevented){e.preventDefault();setSelectedConversationId(id)}};var handleAppUpdated=React.useCallback(function(realtimeEvent){if(realtimeEvent.app.id!==item.id)return;refetchConversations()},[item.id]);var handleMessageCreated=React.useCallback(function(realtimeEvent){if(realtimeEvent.message.app_id!==item.id)return;refetchConversations()},[item.id]);var handleMemberAdded=React.useCallback(function(realtimeEvent){if(realtimeEvent.app.id!==item.id)return;refetchConversations()},[item.id]);React.useEffect(function(){client===null||client===void 0?void 0:client.subscribe("a".concat(item.id),"app_updated",handleAppUpdated);client===null||client===void 0?void 0:client.subscribe("a".concat(item.id),"message_created",handleMessageCreated);client===null||client===void 0?void 0:client.subscribe("a".concat(item.id),"member_added",handleMemberAdded);return function(){client===null||client===void 0?void 0:client.unsubscribe("a".concat(item.id),"app_updated",handleAppUpdated);client===null||client===void 0?void 0:client.unsubscribe("a".concat(item.id),"message_created",handleMessageCreated);client===null||client===void 0?void 0:client.unsubscribe("a".concat(item.id),"member_added",handleMemberAdded)}},[item.id]);var handleUnread=function handleUnread(e){e.preventDefault();readMutation.mutate({id:item.id,read:false,messageId:null})};var handleRead=function handleRead(e){e.preventDefault();readMutation.mutate({id:item.id,read:true,messageId:item.last_message.id})};var handlePin=function handlePin(e){e.preventDefault();pinMutation.mutate({id:item.id,pin:true})};var handleUnpin=function handleUnpin(e){e.preventDefault();pinMutation.mutate({id:item.id,pin:false})};var handleLeaveConversation=function handleLeaveConversation(){leaveConversation.mutate({id:item.id,members:[user.id]})};var handleStar=function handleStar(e){e.preventDefault();starMutation.mutate({id:item.id,star:true})};var handleUnstar=function handleUnstar(e){e.preventDefault();starMutation.mutate({id:item.id,star:false})};var otherMember=item.type!==ChatRoom?(_b=((members===null||members===void 0?void 0:members.data)||[]).filter(function(member){return member.id!==user.id}))===null||_b===void 0?void 0:_b[0]:null;return React.createElement("div",{className:classNames("wy-item wy-item-lg wy-item-hover wy-conversation",{"wy-unread":item.is_unread,"wy-active":selectedConversationId===item.id}),key:item.id,onClick:function onClick(e){return handleClick(e,item.id)}},item.type===ChatRoom&&user?React.createElement(AvatarGroup,{members:members,user:user,name:item.display_name}):React.createElement(Avatar,{src:otherMember===null||otherMember===void 0?void 0:otherMember.avatar_url,id:(otherMember===null||otherMember===void 0?void 0:otherMember.id)||-1,presence:(otherMember===null||otherMember===void 0?void 0:otherMember.presence)||"away",name:item.display_name}),React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-row"},React.createElement("div",{className:"wy-item-title"},item.display_name),item.last_message&&React.createElement("time",{className:"wy-meta",dateTime:item.last_message.created_at.toString(),title:date.format("LLLL")},date.fromNow())),React.createElement("div",{className:"wy-item-row"},React.createElement("div",{className:"wy-item-text"},React.createElement(Typing$1,{id:item.id,context:"listitem"},React.createElement("span",{className:"wy-typing-hide"},item.last_message&&React.createElement(React.Fragment,null,userId===((_c=item.last_message)===null||_c===void 0?void 0:_c.created_by.id)&&React.createElement(React.Fragment,null,"You: "),(item.members.count||0)>2&&userId!==((_d=item.last_message)===null||_d===void 0?void 0:_d.created_by.id)&&React.createElement(React.Fragment,null,(_e=item.last_message)===null||_e===void 0?void 0:_e.created_by.display_name,": ")),((_f=item.last_message)===null||_f===void 0?void 0:_f.text)&&React.createElement("span",null,item.last_message.plain),!((_g=item.last_message)===null||_g===void 0?void 0:_g.text)&&(((_h=item.last_message)===null||_h===void 0?void 0:_h.attachment_count)||0)>0&&React.createElement(UIIcon.UI,{name:"attachment"}),!((_j=item.last_message)===null||_j===void 0?void 0:_j.text)&&((_k=item.last_message)===null||_k===void 0?void 0:_k.meeting_id)&&React.createElement(UIIcon.UI,{name:"zoom"}),!item.last_message&&React.createElement(React.Fragment,null,"\xA0")))))),React.createElement("div",{className:"wy-item-actions wy-item-actions-bottom"},item.is_starred&&React.createElement(UIButton.UI,{onClick:handleUnstar},React.createElement(UIIcon.UI,{name:"star",size:24,className:"wy-icon-yellow"})),React.createElement(UIDropdown.UI,{directionX:"left",icon:item.is_pinned?"pin":undefined},React.createElement(React.Fragment,null,item.is_unread&&React.createElement(UIDropdown.Item,{onClick:handleRead},React.createElement(UIIcon.UI,{name:"unread"}),"Mark as read"),!item.is_unread&&React.createElement(UIDropdown.Item,{onClick:handleUnread},React.createElement(UIIcon.UI,{name:"read"}),"Mark as unread")),React.createElement(React.Fragment,null,item.is_pinned&&React.createElement(UIDropdown.Item,{onClick:handleUnpin},React.createElement(UIIcon.UI,{name:"unpin"}),"Unpin"),!item.is_pinned&&React.createElement(UIDropdown.Item,{onClick:handlePin},React.createElement(UIIcon.UI,{name:"pin"}),"Pin")),React.createElement(React.Fragment,null,item.is_starred&&React.createElement(UIDropdown.Item,{onClick:handleUnstar},React.createElement(UIIcon.UI,{name:"unstar"}),"Unstar"),!item.is_starred&&React.createElement(UIDropdown.Item,{onClick:handleStar},React.createElement(UIIcon.UI,{name:"star"}),"Star")),item.type===ChatRoom&&React.createElement(UIDropdown.Item,{onClick:handleLeaveConversation},React.createElement(UIIcon.UI,{name:"account-minus"}),"Leave conversation"))))};function useMutateConversation(){var _React$useContext53=React.useContext(WeavyContext),client=_React$useContext53.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateConversation must be used within an WeavyProvider")}var mutateConversation=function(){var _ref320=_asyncToGenerator(_regeneratorRuntime().mark(function _callee158(_ref319){var members,response;return _regeneratorRuntime().wrap(function _callee158$(_context161){while(1)switch(_context161.prev=_context161.next){case 0:members=_ref319.members;_context161.next=3;return client.post("/api/conversations/","POST",JSON.stringify({members:members}));case 3:response=_context161.sent;return _context161.abrupt("return",response.json());case 5:case"end":return _context161.stop()}},_callee158)}));return function mutateConversation(_x137){return _ref320.apply(this,arguments)}}();return useMutation(mutateConversation,{onSuccess:function onSuccess(){queryClient.invalidateQueries("conversations")}})}var NewConversation=function NewConversation(){var _React$useState145=React.useState(false),_React$useState146=_slicedToArray2(_React$useState145,2),modalOpen=_React$useState146[0],setModalOpen=_React$useState146[1];var addConversationMutation=useMutateConversation();var _React$useContext54=React.useContext(MessengerContext),setSelectedConversationId=_React$useContext54.setSelectedConversationId;var handleCreate=function(){var _ref321=_asyncToGenerator(_regeneratorRuntime().mark(function _callee159(selected){var membersList,conversation;return _regeneratorRuntime().wrap(function _callee159$(_context162){while(1)switch(_context162.prev=_context162.next){case 0:membersList=selected.map(function(m){return m.id});_context162.next=3;return addConversationMutation.mutateAsync({members:membersList});case 3:conversation=_context162.sent;setSelectedConversationId(conversation.id);setModalOpen(false);case 6:case"end":return _context162.stop()}},_callee159)}));return function handleCreate(_x138){return _ref321.apply(this,arguments)}}();var handleOpen=function handleOpen(){setModalOpen(true)};var handleClose=function handleClose(){setModalOpen(false)};return React.createElement(React.Fragment,null,React.createElement(UIButton.UI,{onClick:handleOpen},React.createElement(UIIcon.UI,{name:"plus"})),React.createElement(UIOverlay.UI,{isOpen:modalOpen,className:"wy-modal"},React.createElement("header",{className:"wy-appbars","data-adjust-scrollbar-top":true},React.createElement("nav",{className:"wy-appbar"},React.createElement(UIButton.UI,{onClick:handleClose},React.createElement(UIIcon.UI,{name:"close"})),React.createElement("div",{className:"wy-appbar-text"},"New message"))),React.createElement(SearchUsers,{handleSubmit:handleCreate,buttonTitle:"Next"})))};var NewConversation$1=React.memo(NewConversation);var ConversationList=function ConversationList(){var _React$useContext55=React.useContext(WeavyContext),client=_React$useContext55.client;var _React$useContext56=React.useContext(UserContext),user=_React$useContext56.user;if(!client){throw new Error("Weavy ConversationList component must be used within an WeavyProvider")}var infinteConversations=useConversations({});var data=infinteConversations.data,isLoading=infinteConversations.isLoading,refetch=infinteConversations.refetch,fetchNextPage=infinteConversations.fetchNextPage,hasNextPage=infinteConversations.hasNextPage,isFetchingNextPage=infinteConversations.isFetchingNextPage;var loadMoreRef=useInfinteScroll(infinteConversations);React.useEffect(function(){client.subscribe(null,"app_created",handleAppInserted);client.subscribe(null,"member_added",handleAppInserted);return function(){client.unsubscribe(null,"app_created",handleAppInserted);client.unsubscribe(null,"member_added",handleAppInserted)}},[]);var handleAppInserted=function handleAppInserted(data){refetch()};var loadMoreButton=React.createElement(UIButton.UI,{onClick:function onClick(){return fetchNextPage()},disabled:!hasNextPage||isFetchingNextPage,className:"wy-message-readmore"},"Load more");return React.createElement(React.Fragment,null,React.createElement("header",{className:"wy-appbars","data-adjust-scrollbar-top":true},React.createElement("nav",{className:"wy-appbar"},React.createElement(Avatar,{src:user.avatar_url,name:user.display_name,presence:user.presence,id:user.id,size:24}),React.createElement("div",null,"Messenger"),React.createElement(NewConversation$1,null))),React.createElement("div",{className:"wy-conversations"},isLoading&&React.createElement(UISpinner.UI,{overlay:true}),data&&data.pages&&data.pages.map(function(group,i){var _a;return(_a=group.data)===null||_a===void 0?void 0:_a.map(function(item){return React.createElement(ConversationListItem,{key:item.id,members:item.members,refetchConversations:refetch,item:item,userId:user.id})})}),React.createElement("div",{className:"wy-pager",ref:loadMoreRef},isFetchingNextPage?"Loading more...":hasNextPage?loadMoreButton:"")))};var Messenger=function Messenger(_ref322){var className=_ref322.className;var _React$useContext57=React.useContext(WeavyContext),client=_React$useContext57.client;if(!client){throw new Error("Weavy Messenger component must be used within an WeavyProvider")}return React.createElement(MessengerProvider,null,React.createElement("div",{className:classNames("wy-messenger-provider",className)},React.createElement("div",{className:"wy-messenger-sidebar wy-scroll-y"},React.createElement(ConversationList,null)),React.createElement("div",{className:"wy-messenger-conversation wy-scroll-y"},React.createElement(Conversation$1,{id:null}))))};function useChat(id,options){var _React$useContext58=React.useContext(WeavyContext),client=_React$useContext58.client;if(!client){throw new Error("useChat must be used within an WeavyProvider")}var getConversation=function(){var _ref323=_asyncToGenerator(_regeneratorRuntime().mark(function _callee160(){var response,data;return _regeneratorRuntime().wrap(function _callee160$(_context163){while(1)switch(_context163.prev=_context163.next){case 0:_context163.next=2;return client.get("/api/apps/"+id);case 2:response=_context163.sent;_context163.next=5;return response.json();case 5:data=_context163.sent;return _context163.abrupt("return",data);case 7:case"end":return _context163.stop()}},_callee160)}));return function getConversation(){return _ref323.apply(this,arguments)}}();return useQuery(["chat",id],getConversation,options)}var Chat=function Chat(_ref324){var uid=_ref324.uid,className=_ref324.className,features=_ref324.features;var _a;var _React$useContext59=React.useContext(WeavyContext),client=_React$useContext59.client;var _React$useState147=React.useState(null),_React$useState148=_slicedToArray2(_React$useState147,2),selectedId=_React$useState148[0],setSelectedId=_React$useState148[1];if(!client){throw new Error("Weavy Chat component must be used within an WeavyProvider")}var _useChat=useChat(uid,{}),isLoadingChat=_useChat.isLoading,dataChat=_useChat.data;var _useMembers2=useMembers(selectedId,{enabled:selectedId!=null}),isLoadingMembers=_useMembers2.isLoading,dataMembers=_useMembers2.data;var _useConversation2=useConversation(selectedId,{enabled:selectedId!=null}),isLoadingConversation=_useConversation2.isLoading,dataConversation=_useConversation2.data;var _useFeatures2=useFeatures("chat",{enabled:selectedId!=null}),isLoadingFeatures=_useFeatures2.isLoading,dataFeatures=_useFeatures2.data;React.useEffect(function(){if(dataChat){setSelectedId(dataChat.id)}else{setSelectedId(null)}},[dataChat]);return React.createElement("div",{className:classNames("wy-messenger-conversation wy-scroll-y",className)},!isLoadingChat&&!dataChat&&React.createElement("div",null,"No chat with the contextual id ",React.createElement("strong",null,uid)),selectedId&&dataMembers&&dataChat&&dataConversation&&dataFeatures&&React.createElement(Messages,{id:selectedId,contextual:true,chatRoom:true,members:dataMembers,lastMessageId:(_a=dataConversation.last_message)===null||_a===void 0?void 0:_a.id,features:dataFeatures,appFeatures:features}))};function usePosts(id,options){var _React$useContext60=React.useContext(WeavyContext),client=_React$useContext60.client;if(!client){throw new Error("usePosts must be used within an WeavyProvider")}var getPosts=function(){var _ref325=_asyncToGenerator(_regeneratorRuntime().mark(function _callee161(){var response,data;return _regeneratorRuntime().wrap(function _callee161$(_context164){while(1)switch(_context164.prev=_context164.next){case 0:_context164.next=2;return client.get("/api/apps/"+id);case 2:response=_context164.sent;_context164.next=5;return response.json();case 5:data=_context164.sent;return _context164.abrupt("return",data);case 7:case"end":return _context164.stop()}},_callee161)}));return function getPosts(){return _ref325.apply(this,arguments)}}();return useQuery(["posts",id],getPosts,options)}function usePostsList(id,options){var PAGE_SIZE=10;var _React$useContext61=React.useContext(WeavyContext),client=_React$useContext61.client;if(!client){throw new Error("usePostsList must be used within an WeavyProvider")}var getPosts=function(){var _ref326=_asyncToGenerator(_regeneratorRuntime().mark(function _callee162(opt){var skip,response,data;return _regeneratorRuntime().wrap(function _callee162$(_context165){while(1)switch(_context165.prev=_context165.next){case 0:skip=opt.pageParam||0;_context165.next=3;return client.get("/api/apps/"+id+"/posts?orderby=createdat+desc&skip="+skip+"&top="+PAGE_SIZE);case 3:response=_context165.sent;_context165.next=6;return response.json();case 6:data=_context165.sent;return _context165.abrupt("return",data);case 8:case"end":return _context165.stop()}},_callee162)}));return function getPosts(_x139){return _ref326.apply(this,arguments)}}();var opts=Object.assign(Object.assign({},options),{getNextPageParam:function getNextPageParam(lastPage,pages){if((lastPage===null||lastPage===void 0?void 0:lastPage.end)<(lastPage===null||lastPage===void 0?void 0:lastPage.count)){return pages.length*PAGE_SIZE}}});return useInfiniteQuery(["posts",id],getPosts,opts)}function useCommentList(parentId,type,options){var PAGE_SIZE=10;var _React$useContext62=React.useContext(WeavyContext),client=_React$useContext62.client;if(!client){throw new Error("useCommentList must be used within an WeavyProvider")}var getPosts=function(){var _ref327=_asyncToGenerator(_regeneratorRuntime().mark(function _callee163(opt){var skip,response;return _regeneratorRuntime().wrap(function _callee163$(_context166){while(1)switch(_context166.prev=_context166.next){case 0:skip=opt.pageParam||0;_context166.next=3;return client.get("/api/".concat(type,"/").concat(parentId,"/comments?orderby=createdat+asc&skip=").concat(skip,"&top=").concat(PAGE_SIZE));case 3:response=_context166.sent;_context166.next=6;return response.json();case 6:return _context166.abrupt("return",_context166.sent);case 7:case"end":return _context166.stop()}},_callee163)}));return function getPosts(_x140){return _ref327.apply(this,arguments)}}();var opts=Object.assign(Object.assign({},options),{getNextPageParam:function getNextPageParam(lastPage,pages){if((lastPage===null||lastPage===void 0?void 0:lastPage.end)<(lastPage===null||lastPage===void 0?void 0:lastPage.count)){return pages.length*PAGE_SIZE}}});return useInfiniteQuery(["comments",parentId],getPosts,opts)}function useMutateComment(){var _React$useContext63=React.useContext(WeavyContext),client=_React$useContext63.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateComment must be used within an WeavyProvider")}var mutateComment=function(){var _ref329=_asyncToGenerator(_regeneratorRuntime().mark(function _callee164(_ref328){var parentId,type,text,blobs,meeting,embed,response;return _regeneratorRuntime().wrap(function _callee164$(_context167){while(1)switch(_context167.prev=_context167.next){case 0:parentId=_ref328.parentId,type=_ref328.type,text=_ref328.text,blobs=_ref328.blobs,meeting=_ref328.meeting,embed=_ref328.embed;_context167.next=3;return client.post("/api/".concat(type,"/").concat(parentId,"/comments"),"POST",JSON.stringify({text:text,blobs:blobs.map(function(b){return b.id}),meeting_id:meeting,embed_id:embed}));case 3:response=_context167.sent;return _context167.abrupt("return",response.json());case 5:case"end":return _context167.stop()}},_callee164)}));return function mutateComment(_x141){return _ref329.apply(this,arguments)}}();return useMutation(mutateComment,{onSuccess:function onSuccess(data,variables,context){addCacheItem(queryClient,["comments",variables.parentId],data,context.tempId)},onMutate:function(){var _onMutate9=_asyncToGenerator(_regeneratorRuntime().mark(function _callee165(variables){var tempId,tempData;return _regeneratorRuntime().wrap(function _callee165$(_context168){while(1)switch(_context168.prev=_context168.next){case 0:_context168.next=2;return queryClient.cancelQueries(["comments",variables.parentId]);case 2:tempId=Math.random();tempData={id:tempId,text:variables.text,temp:true,created_by:{display_name:variables.userName},created_at:new Date().toUTCString()};addCacheItem(queryClient,["comments",variables.parentId],tempData);return _context168.abrupt("return",{tempId:tempId});case 6:case"end":return _context168.stop()}},_callee165)}));function onMutate(_x142){return _onMutate9.apply(this,arguments)}return onMutate}()})}function useMutateEditPost$1(){var _React$useContext64=React.useContext(WeavyContext),client=_React$useContext64.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateEditComment must be used within an WeavyProvider")}var mutatePost=function(){var _ref331=_asyncToGenerator(_regeneratorRuntime().mark(function _callee166(_ref330){var id,text,blobs,attachments,meeting,embed,response;return _regeneratorRuntime().wrap(function _callee166$(_context169){while(1)switch(_context169.prev=_context169.next){case 0:id=_ref330.id,text=_ref330.text,blobs=_ref330.blobs,attachments=_ref330.attachments,meeting=_ref330.meeting,embed=_ref330.embed;_context169.next=3;return client.post("/api/comments/"+id,"PATCH",JSON.stringify({text:text,blobs:blobs.map(function(b){return b.id}),attachments:attachments.map(function(a){return a.id}),meeting_id:meeting,embed_id:embed}));case 3:response=_context169.sent;return _context169.abrupt("return",response.json());case 5:case"end":return _context169.stop()}},_callee166)}));return function mutatePost(_x143){return _ref331.apply(this,arguments)}}();return useMutation(mutatePost,{onSuccess:function onSuccess(data,variables,context){var _a;var previousData=queryClient.getQueryData(["comments",variables.parentId]);if(previousData&&previousData.pages){var newPagesArray=(_a=previousData.pages.map(function(page,i){page.data=_toConsumableArray2(page.data.map(function(message){return message.id===variables.id?data:message}));return page}))!==null&&_a!==void 0?_a:[];queryClient.setQueryData(["comments",variables.parentId],function(data){return{pages:newPagesArray,pageParams:data.pageParams}})}},onMutate:function(){var _onMutate10=_asyncToGenerator(_regeneratorRuntime().mark(function _callee167(variables){return _regeneratorRuntime().wrap(function _callee167$(_context170){while(1)switch(_context170.prev=_context170.next){case 0:case"end":return _context170.stop()}},_callee167)}));function onMutate(_x144){return _onMutate10.apply(this,arguments)}return onMutate}()})}var CommentEdit=function CommentEdit(_ref332){var appId=_ref332.appId,parentId=_ref332.parentId,id=_ref332.id,text=_ref332.text,embed=_ref332.embed,attachments=_ref332.attachments,onClose=_ref332.onClose;var editCommentMutation=useMutateEditPost$1();var handleUpdate=function(){var _ref333=_asyncToGenerator(_regeneratorRuntime().mark(function _callee168(text,blobs,attachments,meeting,embed,options){return _regeneratorRuntime().wrap(function _callee168$(_context171){while(1)switch(_context171.prev=_context171.next){case 0:_context171.next=2;return editCommentMutation.mutateAsync({id:id,appId:appId,parentId:parentId,text:text,blobs:blobs,attachments:attachments,meeting:meeting,embed:embed});case 2:onClose();case 3:case"end":return _context171.stop()}},_callee168)}));return function handleUpdate(_x145,_x146,_x147,_x148,_x149,_x150){return _ref333.apply(this,arguments)}}();return React.createElement(React.Fragment,null,React.createElement("nav",{className:"wy-item"},React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},"Edit comment")),React.createElement("a",{className:"wy-button wy-button-icon"},React.createElement(UIButton.UI,{onClick:onClose},React.createElement(UIIcon.UI,{name:"close"})))),React.createElement(Editor,{editorType:"posts",editorLocation:"posts",id:id,appId:appId,placeholder:"Update the comment",text:text,embed:embed,attachments:attachments,buttonText:"Update",onSubmit:handleUpdate,showAttachments:true,showCloudFiles:true,showEmbeds:false,showPolls:false}))};function useMutateRestoreComment(){var _React$useContext65=React.useContext(WeavyContext),client=_React$useContext65.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateRestoreComment must be used within an WeavyProvider")}var restoreComment=function(){var _ref335=_asyncToGenerator(_regeneratorRuntime().mark(function _callee169(_ref334){var id,response;return _regeneratorRuntime().wrap(function _callee169$(_context172){while(1)switch(_context172.prev=_context172.next){case 0:id=_ref334.id;_context172.next=3;return client.post("/api/comments/".concat(id,"/restore"),"POST","");case 3:response=_context172.sent;return _context172.abrupt("return",response.json());case 5:case"end":return _context172.stop()}},_callee169)}));return function restoreComment(_x151){return _ref335.apply(this,arguments)}}();return useMutation(restoreComment,{onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,["comments",variables.parentId],variables.id,function(item){item.is_trashed=data.is_trashed})},onMutate:function(){var _onMutate11=_asyncToGenerator(_regeneratorRuntime().mark(function _callee170(variables){return _regeneratorRuntime().wrap(function _callee170$(_context173){while(1)switch(_context173.prev=_context173.next){case 0:case"end":return _context173.stop()}},_callee170)}));function onMutate(_x152){return _onMutate11.apply(this,arguments)}return onMutate}()})}var CommentTrashed=function CommentTrashed(_ref336){var id=_ref336.id,appId=_ref336.appId,parentId=_ref336.parentId;var restoreComment=useMutateRestoreComment();var queryClient=useQueryClient();var handleUndo=function handleUndo(){restoreComment.mutate({id:id,appId:appId,parentId:parentId},{onSuccess:function onSuccess(){updateCacheItem(queryClient,["posts",appId],parentId,function(item){item.comment_count=(item.comment_count||0)+1})}})};return React.createElement("div",{className:"wy-item wy-item-lg"},React.createElement("div",{className:"wy-item-body"},"Comment was trashed."),React.createElement(UIButton.UI,{onClick:handleUndo,className:"wy-button-variant"},"Undo"))};function useMutateTrashComment(){var _React$useContext66=React.useContext(WeavyContext),client=_React$useContext66.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateTrashComment must be used within an WeavyProvider")}var trashPost=function(){var _ref338=_asyncToGenerator(_regeneratorRuntime().mark(function _callee171(_ref337){var id,response;return _regeneratorRuntime().wrap(function _callee171$(_context174){while(1)switch(_context174.prev=_context174.next){case 0:id=_ref337.id;_context174.next=3;return client.post("/api/comments/".concat(id,"/trash"),"POST","");case 3:response=_context174.sent;return _context174.abrupt("return",response.json());case 5:case"end":return _context174.stop()}},_callee171)}));return function trashPost(_x153){return _ref338.apply(this,arguments)}}();return useMutation(trashPost,{onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,["comments",variables.parentId],variables.id,function(item){item.is_trashed=data.is_trashed})},onMutate:function(){var _onMutate12=_asyncToGenerator(_regeneratorRuntime().mark(function _callee172(variables){return _regeneratorRuntime().wrap(function _callee172$(_context175){while(1)switch(_context175.prev=_context175.next){case 0:case"end":return _context175.stop()}},_callee172)}));function onMutate(_x154){return _onMutate12.apply(this,arguments)}return onMutate}()})}var CommentView=function CommentView(_ref339){var appId=_ref339.appId,id=_ref339.id,parentId=_ref339.parentId,html=_ref339.html,created_at=_ref339.created_at,modified_at=_ref339.modified_at,created_by=_ref339.created_by,attachments=_ref339.attachments,reactions=_ref339.reactions,embed=_ref339.embed,features=_ref339.features,appFeatures=_ref339.appFeatures,onEdit=_ref339.onEdit;var _React$useContext67=React.useContext(UserContext),user=_React$useContext67.user;var queryClient=useQueryClient();var _React$useContext68=React.useContext(PreviewContext),openPreview=_React$useContext68.openPreview,setPreviewFiles=_React$useContext68.setPreviewFiles;var date=dayjs.utc(created_at).tz(dayjs.tz.guess());var trashComment=useMutateTrashComment();var images=attachments===null||attachments===void 0?void 0:attachments.filter(function(a){return a.kind==="image"&&a.thumbnail_url});var files=attachments===null||attachments===void 0?void 0:attachments.filter(function(a){return a.kind!=="image"||!a.thumbnail_url});var handlePreviewClick=function handlePreviewClick(e,attachmentId){e.preventDefault();setPreviewFiles(attachments);openPreview(attachmentId)};var handleDelete=function handleDelete(){trashComment.mutate({id:id,appId:appId,parentId:parentId},{onSuccess:function onSuccess(){updateCacheItem(queryClient,["posts",appId],parentId,function(item){item.comment_count=(item.comment_count||1)-1})}})};return React.createElement(React.Fragment,null,React.createElement("div",{className:"wy-item wy-item-sm wy-comment-header"},React.createElement(Avatar,{src:created_by.avatar_url,size:32,name:created_by.display_name}),React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},created_by.display_name),React.createElement("div",{className:"wy-item-text"},React.createElement("time",{dateTime:created_at,title:date.format("LLLL")},date.fromNow()),modified_at&&React.createElement("time",{dateTime:modified_at}," \xB7 edited"))),React.createElement("div",{className:"wy-item-actions wy-item-actions-top"},React.createElement(UIDropdown.UI,{directionX:"left"},user.id===created_by.id&&React.createElement(UIDropdown.Item,{onClick:onEdit},React.createElement(UIIcon.UI,{name:"pencil"})," Edit"),user.id===created_by.id&&React.createElement(UIDropdown.Item,{onClick:handleDelete},React.createElement(UIIcon.UI,{name:"trashcan"})," Trash")))),React.createElement("div",{className:"wy-comment-body"},React.createElement("div",{className:"wy-comment-content"},images&&!!images.length&&React.createElement(ImageGrid,null,images.map(function(a){return React.createElement(React.Fragment,{key:a.id},a.download_url&&React.createElement(Image$1,{onClick:function onClick(e){return handlePreviewClick(e,a.id)},key:a.id,src:a.download_url,previewSrc:a.preview_url,width:a.width,height:a.height}))})),embed&&React.createElement(Embed,{embed:embed}),React.createElement("div",{className:"wy-content",dangerouslySetInnerHTML:{__html:html}}),files&&!!files.length&&React.createElement("div",{className:"wy-list wy-list-bordered"},files.map(function(a){return React.createElement(Attachment,{key:a.id,onClick:function onClick(e){return handlePreviewClick(e,a.id)},name:a.name,previewFormat:a.kind,provider:a.provider,url:a.download_url,previewUrl:a.provider?a.external_url:a.preview_url,mediaType:a.media_type,kind:a.kind,size:a.size})})))),React.createElement("div",{className:"wy-reactions-line"},hasFeature(features,Feature.Reactions,appFeatures===null||appFeatures===void 0?void 0:appFeatures.reactions)?React.createElement(React.Fragment,null,React.createElement(ReactionsList,{id:id,type:"comments",parentId:parentId,reactions:reactions}),React.createElement(ReactionsMenu,{id:id,type:"comments",parentId:parentId,reactions:reactions,placement:"top-end"})):React.createElement(React.Fragment,null,React.createElement(ReactionsLike,{id:id,type:"comments",parentId:parentId,reactions:reactions}),React.createElement(ReactionsList,{id:id,type:"comments",parentId:parentId,reactions:reactions,featureEnabled:false}))))};var Comment=function Comment(_a){var props=__rest(_a,[]);var _React$useState149=React.useState(false),_React$useState150=_slicedToArray2(_React$useState149,2),edit=_React$useState150[0],setEdit=_React$useState150[1];return React.createElement("div",{className:"wy-comment"},props.is_trashed&&React.createElement(CommentTrashed,Object.assign({},props)),!props.is_trashed&&edit&&React.createElement(CommentEdit,Object.assign({},props,{onClose:function onClose(){return setEdit(function(prev){return!prev})}})),!props.is_trashed&&!edit&&React.createElement(CommentView,Object.assign({},props,{onEdit:function onEdit(){return setEdit(function(prev){return!prev})}})))};var CommentPlaceholder=function CommentPlaceholder(_a){var props=__rest(_a,[]);return React.createElement("div",{className:"wy-comment"},React.createElement("div",{className:"wy-item wy-comment-header"},React.createElement("img",{alt:"",className:"wy-avatar wy-placeholder",height:32,width:32,src:props.created_by.avatar_url}),React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},React.createElement("span",{className:"wy-placeholder"},"Placeholder name")),React.createElement("div",{className:"wy-item-text"},React.createElement("time",{className:"wy-placeholder",dateTime:"2022-12-31 00:00:00"},"2022-12-31 00:00:00")))),React.createElement("div",{className:"wy-comment-body"},React.createElement("div",{className:"wy-comment-content"},React.createElement("div",{className:"wy-content"},React.createElement("span",{className:"wy-placeholder"},"Lorem")," ",React.createElement("span",{className:"wy-placeholder"},"ipsum")," ",React.createElement("span",{className:"wy-placeholder"},"dolor")," ",React.createElement("span",{className:"wy-placeholder"},"sit")," ",React.createElement("span",{className:"wy-placeholder"},"amet.")))))};var Comments=function Comments(_ref340){var appId=_ref340.appId,parentId=_ref340.parentId,type=_ref340.type,features=_ref340.features,appFeatures=_ref340.appFeatures;var queryClient=useQueryClient();var addCommentMutation=useMutateComment();var _useCommentList=useCommentList(parentId,type,{}),isLoading=_useCommentList.isLoading,isError=_useCommentList.isError,data=_useCommentList.data,error=_useCommentList.error,fetchNextPage=_useCommentList.fetchNextPage,hasNextPage=_useCommentList.hasNextPage,isFetching=_useCommentList.isFetching,isFetchingNextPage=_useCommentList.isFetchingNextPage;var handleCreate=function(){var _ref341=_asyncToGenerator(_regeneratorRuntime().mark(function _callee173(text,blobs,attachments,meeting,embed,options){return _regeneratorRuntime().wrap(function _callee173$(_context176){while(1)switch(_context176.prev=_context176.next){case 0:_context176.next=2;return addCommentMutation.mutateAsync({parentId:parentId,type:type,text:text,blobs:blobs,meeting:null,embed:embed},{onSuccess:function onSuccess(data){updateCacheItem(queryClient,[type,appId],parentId,function(item){item.comment_count=(item.comment_count||0)+1})}});case 2:case"end":return _context176.stop()}},_callee173)}));return function handleCreate(_x155,_x156,_x157,_x158,_x159,_x160){return _ref341.apply(this,arguments)}}();if(isLoading){return React.createElement("div",{className:"wy-buttons"},React.createElement(UISpinner.UI,null))}return React.createElement("div",null,React.createElement("div",{className:"wy-comments"},!isLoading&&data&&data.pages&&data.pages.map(function(group,i){var _a;return React.createElement(React.Fragment,{key:data.pages.length-i},(_a=group.data)===null||_a===void 0?void 0:_a.map(function(comment){return comment.temp?React.createElement(CommentPlaceholder,{key:"comment"+comment.id,text:comment.text,created_at:comment.created_at,created_by:comment.created_by}):React.createElement(Comment,{key:"comment"+comment.id,appId:appId,parentId:parentId,id:comment.id,text:comment.text,html:comment.html,created_at:comment.created_at,modified_at:comment.modified_at,created_by:comment.created_by,trashed_at:comment.trashed_at,attachments:comment.attachments,reactions:comment.reactions,embed:comment.embed,is_trashed:comment.is_trashed,features:features,appFeatures:appFeatures})}))})),type==="files"?React.createElement("div",{className:"wy-comment-editor-bottom"},React.createElement(Editor,{editorType:"comments",editorLocation:type,appId:appId,parentId:parentId,placeholder:"Create a comment",buttonText:"Comment",onSubmit:handleCreate,showMention:hasFeature(features,Feature.Mentions,appFeatures===null||appFeatures===void 0?void 0:appFeatures.mentions),showAttachments:hasFeature(features,Feature.Attachments,appFeatures===null||appFeatures===void 0?void 0:appFeatures.attachments),showCloudFiles:hasFeature(features,Feature.CloudFiles,appFeatures===null||appFeatures===void 0?void 0:appFeatures.cloudFiles),showEmbeds:false,showPolls:false,useDraft:true})):React.createElement(Editor,{editorType:"comments",editorLocation:type,appId:appId,parentId:parentId,placeholder:"Create a comment",buttonText:"Comment",onSubmit:handleCreate,showMention:hasFeature(features,Feature.Mentions,appFeatures===null||appFeatures===void 0?void 0:appFeatures.mentions),showAttachments:hasFeature(features,Feature.Attachments,appFeatures===null||appFeatures===void 0?void 0:appFeatures.attachments),showCloudFiles:hasFeature(features,Feature.CloudFiles,appFeatures===null||appFeatures===void 0?void 0:appFeatures.cloudFiles),showEmbeds:false,showPolls:false,useDraft:true}))};function useMutateTrashPost(){var _React$useContext69=React.useContext(WeavyContext),client=_React$useContext69.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateTrashPost must be used within an WeavyProvider")}var trashPost=function(){var _ref343=_asyncToGenerator(_regeneratorRuntime().mark(function _callee174(_ref342){var id,response;return _regeneratorRuntime().wrap(function _callee174$(_context177){while(1)switch(_context177.prev=_context177.next){case 0:id=_ref342.id;_context177.next=3;return client.post("/api/posts/".concat(id,"/trash"),"POST","");case 3:response=_context177.sent;return _context177.abrupt("return",response.json());case 5:case"end":return _context177.stop()}},_callee174)}));return function trashPost(_x161){return _ref343.apply(this,arguments)}}();return useMutation(trashPost,{onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,["posts",variables.appId],variables.id,function(item){item.is_trashed=data.is_trashed})},onMutate:function(){var _onMutate13=_asyncToGenerator(_regeneratorRuntime().mark(function _callee175(variables){return _regeneratorRuntime().wrap(function _callee175$(_context178){while(1)switch(_context178.prev=_context178.next){case 0:case"end":return _context178.stop()}},_callee175)}));function onMutate(_x162){return _onMutate13.apply(this,arguments)}return onMutate}()})}var CommentCount=function CommentCount(_ref344){var id=_ref344.id,count=_ref344.count;return React.createElement(React.Fragment,null,count," ","comment"+(count!==1?"s":""))};function useMutateSubscribe(){var _React$useContext70=React.useContext(WeavyContext),client=_React$useContext70.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateSubscribe must be used within an WeavyProvider")}var subscribe=function(){var _ref346=_asyncToGenerator(_regeneratorRuntime().mark(function _callee176(_ref345){var id,response;return _regeneratorRuntime().wrap(function _callee176$(_context179){while(1)switch(_context179.prev=_context179.next){case 0:id=_ref345.id;_context179.next=3;return client.post("/api/posts/".concat(id,"/subscribe"),"POST","");case 3:response=_context179.sent;return _context179.abrupt("return",response.json());case 5:case"end":return _context179.stop()}},_callee176)}));return function subscribe(_x163){return _ref346.apply(this,arguments)}}();return useMutation(subscribe,{onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,["posts",variables.appId],variables.id,function(item){item.is_subscribed=data.is_subscribed})},onMutate:function(){var _onMutate14=_asyncToGenerator(_regeneratorRuntime().mark(function _callee177(variables){return _regeneratorRuntime().wrap(function _callee177$(_context180){while(1)switch(_context180.prev=_context180.next){case 0:case"end":return _context180.stop()}},_callee177)}));function onMutate(_x164){return _onMutate14.apply(this,arguments)}return onMutate}()})}function useMutateUnsubscribe(){var _React$useContext71=React.useContext(WeavyContext),client=_React$useContext71.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateUnsubscribe must be used within an WeavyProvider")}var unsubscribe=function(){var _ref348=_asyncToGenerator(_regeneratorRuntime().mark(function _callee178(_ref347){var id,response;return _regeneratorRuntime().wrap(function _callee178$(_context181){while(1)switch(_context181.prev=_context181.next){case 0:id=_ref347.id;_context181.next=3;return client.post("/api/posts/".concat(id,"/unsubscribe"),"POST","");case 3:response=_context181.sent;return _context181.abrupt("return",response.json());case 5:case"end":return _context181.stop()}},_callee178)}));return function unsubscribe(_x165){return _ref348.apply(this,arguments)}}();return useMutation(unsubscribe,{onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,["posts",variables.appId],variables.id,function(item){item.is_subscribed=data.is_subscribed})},onMutate:function(){var _onMutate15=_asyncToGenerator(_regeneratorRuntime().mark(function _callee179(variables){return _regeneratorRuntime().wrap(function _callee179$(_context182){while(1)switch(_context182.prev=_context182.next){case 0:case"end":return _context182.stop()}},_callee179)}));function onMutate(_x166){return _onMutate15.apply(this,arguments)}return onMutate}()})}var PostView=function PostView(_ref349){var appId=_ref349.appId,id=_ref349.id,html=_ref349.html,created_at=_ref349.created_at,modified_at=_ref349.modified_at,created_by=_ref349.created_by,attachments=_ref349.attachments,reactions=_ref349.reactions,embed=_ref349.embed,comment_count=_ref349.comment_count,is_subscribed=_ref349.is_subscribed,options=_ref349.options,meeting=_ref349.meeting,features=_ref349.features,appFeatures=_ref349.appFeatures,onEdit=_ref349.onEdit;var _a;var _React$useContext72=React.useContext(UserContext),user=_React$useContext72.user;var _React$useState151=React.useState(false),_React$useState152=_slicedToArray2(_React$useState151,2),loadComments=_React$useState152[0],setLoadComments=_React$useState152[1];var _React$useState153=React.useState(false),_React$useState154=_slicedToArray2(_React$useState153,2),showComments=_React$useState154[0],setShowComments=_React$useState154[1];var _React$useContext73=React.useContext(PreviewContext),openPreview=_React$useContext73.openPreview,setPreviewFiles=_React$useContext73.setPreviewFiles;var date=dayjs.utc(created_at).tz(dayjs.tz.guess());var trashPost=useMutateTrashPost();var subscribe=useMutateSubscribe();var unsubscribe=useMutateUnsubscribe();var images=attachments===null||attachments===void 0?void 0:attachments.filter(function(a){return a.kind==="image"&&a.thumbnail_url});var files=attachments===null||attachments===void 0?void 0:attachments.filter(function(a){return a.kind!=="image"||!a.thumbnail_url});var handleCommentsClick=function handleCommentsClick(e){e.preventDefault();setShowComments(function(previous){return!previous});setLoadComments(true)};var handlePreviewClick=function handlePreviewClick(e,attachmentId){e.preventDefault();setPreviewFiles(attachments);openPreview(attachmentId)};var handleTrash=function handleTrash(){trashPost.mutate({id:id,appId:appId})};var handleSubscription=function handleSubscription(){if(is_subscribed){unsubscribe.mutate({id:id,appId:appId})}else{subscribe.mutate({id:id,appId:appId})}};return React.createElement("div",null,React.createElement("div",{className:"wy-item wy-item-lg"},React.createElement(Avatar,{src:created_by.avatar_url,size:48,name:created_by.display_name}),React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-row"},React.createElement("div",{className:"wy-item-title"},created_by.display_name)),React.createElement("div",{className:"wy-item-row"},React.createElement("div",{className:"wy-item-text"},React.createElement("time",{dateTime:created_at,title:date.format("LLLL")},date.fromNow()),modified_at&&React.createElement("time",{dateTime:modified_at}," \xB7 edited")))),React.createElement("div",{className:"wy-item-actions wy-item-actions-top"},React.createElement(UIDropdown.UI,{directionX:"left"},React.createElement(UIDropdown.Item,{onClick:handleSubscription},is_subscribed&&React.createElement(React.Fragment,null,React.createElement(UIIcon.UI,{name:"bell-off"})," Unsubscribe"),!is_subscribed&&React.createElement(React.Fragment,null,React.createElement(UIIcon.UI,{name:"bell"})," Subscribe")),user.id===created_by.id&&React.createElement(UIDropdown.Item,{onClick:onEdit},React.createElement(UIIcon.UI,{name:"pencil"})," Edit"),user.id===created_by.id&&React.createElement(UIDropdown.Item,{onClick:handleTrash},React.createElement(UIIcon.UI,{name:"trashcan"})," Trash")))),images&&!!images.length&&React.createElement(ImageGrid,null,images.map(function(a){return React.createElement(React.Fragment,{key:a.id},a.download_url&&React.createElement(Image$1,{onClick:function onClick(e){return handlePreviewClick(e,a.id)},src:a.download_url,previewSrc:a.preview_url,width:a.width,height:a.height}))})),embed&&React.createElement(Embed,{embed:embed}),React.createElement("div",{className:"wy-post-body"},React.createElement("div",{className:"wy-content",dangerouslySetInnerHTML:{__html:html}}),options&&options.length>0&&React.createElement(Poll,{appId:appId,parentId:id,parentType:"posts",options:options}),files&&!!files.length&&React.createElement("div",{className:"wy-list wy-list-bordered"},files.map(function(a){return React.createElement(Attachment,{key:a.id,onClick:function onClick(e){return handlePreviewClick(e,a.id)},name:a.name,previewFormat:a.kind,provider:a.provider,url:a.download_url,previewUrl:a.provider?a.external_url:a.preview_url,mediaType:a.media_type,kind:a.kind,size:a.size})})),meeting&&React.createElement(MeetingCard,{meeting:meeting})),React.createElement("div",{className:"wy-post-footer"},React.createElement("div",{className:"wy-reactions-line"},hasFeature(features,Feature.Reactions,appFeatures===null||appFeatures===void 0?void 0:appFeatures.reactions)?React.createElement(React.Fragment,null,React.createElement(ReactionsList,{id:id,type:"posts",parentId:appId,reactions:reactions}),React.createElement(ReactionsMenu,{id:id,type:"posts",parentId:appId,reactions:reactions})):React.createElement(React.Fragment,null,React.createElement(ReactionsLike,{id:id,type:"posts",parentId:appId,reactions:reactions}),React.createElement(ReactionsList,{id:id,type:"posts",parentId:appId,reactions:reactions,featureEnabled:false}))),((_a=appFeatures===null||appFeatures===void 0?void 0:appFeatures.comments)!==null&&_a!==void 0?_a:true)&&React.createElement("a",{href:"#",className:"wy-meta",onClick:function onClick(e){return handleCommentsClick(e)}},React.createElement(CommentCount,{id:id,count:comment_count||0}))),loadComments&&React.createElement("div",Object.assign({},showComments?{}:{"hidden":true}),React.createElement(Comments,{appId:appId,parentId:id,type:"posts",features:features,appFeatures:appFeatures})))};function useMutateEditPost(){var _React$useContext74=React.useContext(WeavyContext),client=_React$useContext74.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateEditPost must be used within an WeavyProvider")}var mutatePost=function(){var _ref351=_asyncToGenerator(_regeneratorRuntime().mark(function _callee180(_ref350){var id,text,blobs,attachments,meeting,embed,options,response;return _regeneratorRuntime().wrap(function _callee180$(_context183){while(1)switch(_context183.prev=_context183.next){case 0:id=_ref350.id,text=_ref350.text,blobs=_ref350.blobs,attachments=_ref350.attachments,meeting=_ref350.meeting,embed=_ref350.embed,options=_ref350.options;_context183.next=3;return client.post("/api/posts/"+id,"PATCH",JSON.stringify({text:text,blobs:blobs.map(function(b){return b.id}),attachments:attachments.map(function(a){return a.id}),meeting_id:meeting,embed_id:embed,options:options.filter(function(o){return o.text.trim()!==""}).map(function(o){return{id:o.id,text:o.text}})}));case 3:response=_context183.sent;return _context183.abrupt("return",response.json());case 5:case"end":return _context183.stop()}},_callee180)}));return function mutatePost(_x167){return _ref351.apply(this,arguments)}}();return useMutation(mutatePost,{onSuccess:function onSuccess(data,variables,context){var _a;var previousData=queryClient.getQueryData(["posts",variables.appId]);if(previousData&&previousData.pages){var newPagesArray=(_a=previousData.pages.map(function(page,i){page.data=_toConsumableArray2(page.data.map(function(message){return message.id===variables.id?data:message}));return page}))!==null&&_a!==void 0?_a:[];queryClient.setQueryData(["posts",variables.appId],function(data){return{pages:newPagesArray,pageParams:data.pageParams}})}},onMutate:function(){var _onMutate16=_asyncToGenerator(_regeneratorRuntime().mark(function _callee181(variables){return _regeneratorRuntime().wrap(function _callee181$(_context184){while(1)switch(_context184.prev=_context184.next){case 0:case"end":return _context184.stop()}},_callee181)}));function onMutate(_x168){return _onMutate16.apply(this,arguments)}return onMutate}()})}var PostEdit=function PostEdit(_ref352){var appId=_ref352.appId,id=_ref352.id,text=_ref352.text,embed=_ref352.embed,attachments=_ref352.attachments,options=_ref352.options,meeting=_ref352.meeting,onClose=_ref352.onClose;var editPostMutation=useMutateEditPost();var handleUpdate=function(){var _ref353=_asyncToGenerator(_regeneratorRuntime().mark(function _callee182(text,blobs,attachments,meeting,embed,options){return _regeneratorRuntime().wrap(function _callee182$(_context185){while(1)switch(_context185.prev=_context185.next){case 0:_context185.next=2;return editPostMutation.mutateAsync({id:id,appId:appId,text:text,blobs:blobs,attachments:attachments,meeting:meeting,embed:embed,options:options});case 2:onClose();case 3:case"end":return _context185.stop()}},_callee182)}));return function handleUpdate(_x169,_x170,_x171,_x172,_x173,_x174){return _ref353.apply(this,arguments)}}();return React.createElement(React.Fragment,null,React.createElement("nav",{className:"wy-item"},React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},"Edit post")),React.createElement("a",{className:"wy-button wy-button-icon"},React.createElement(UIButton.UI,{onClick:onClose},React.createElement(UIIcon.UI,{name:"close"})))),React.createElement(Editor,{editorType:"posts",editorLocation:"apps",id:id,appId:appId,placeholder:"Update the post",text:text,embed:embed,meeting:meeting,attachments:attachments,options:options,buttonText:"Update",onSubmit:handleUpdate,showAttachments:true,showCloudFiles:true,showEmbeds:true,showPolls:true}))};function useMutateRestorePost(){var _React$useContext75=React.useContext(WeavyContext),client=_React$useContext75.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateRestorePost must be used within an WeavyProvider")}var restorePost=function(){var _ref355=_asyncToGenerator(_regeneratorRuntime().mark(function _callee183(_ref354){var id,response;return _regeneratorRuntime().wrap(function _callee183$(_context186){while(1)switch(_context186.prev=_context186.next){case 0:id=_ref354.id;_context186.next=3;return client.post("/api/posts/".concat(id,"/restore"),"POST","");case 3:response=_context186.sent;return _context186.abrupt("return",response.json());case 5:case"end":return _context186.stop()}},_callee183)}));return function restorePost(_x175){return _ref355.apply(this,arguments)}}();return useMutation(restorePost,{onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,["posts",variables.appId],variables.id,function(item){item.is_trashed=data.is_trashed})},onMutate:function(){var _onMutate17=_asyncToGenerator(_regeneratorRuntime().mark(function _callee184(variables){return _regeneratorRuntime().wrap(function _callee184$(_context187){while(1)switch(_context187.prev=_context187.next){case 0:case"end":return _context187.stop()}},_callee184)}));function onMutate(_x176){return _onMutate17.apply(this,arguments)}return onMutate}()})}var PostTrashed=function PostTrashed(_ref356){var id=_ref356.id,appId=_ref356.appId;var restorePost=useMutateRestorePost();var handleRestore=function handleRestore(){restorePost.mutate({id:id,appId:appId})};return React.createElement("div",{className:"wy-item wy-item-lg"},React.createElement("div",{className:"wy-item-body"},"Post was trashed."),React.createElement(UIButton.UI,{onClick:handleRestore,className:"wy-button-variant"},"Undo"))};var Post=function Post(_a){var props=__rest(_a,[]);var _React$useState155=React.useState(false),_React$useState156=_slicedToArray2(_React$useState155,2),edit=_React$useState156[0],setEdit=_React$useState156[1];return React.createElement("div",{className:"wy-post"},props.is_trashed&&React.createElement(PostTrashed,Object.assign({},props)),!props.is_trashed&&edit&&React.createElement(PostEdit,Object.assign({},props,{onClose:function onClose(){return setEdit(function(prev){return!prev})}})),!props.is_trashed&&!edit&&React.createElement(PostView,Object.assign({},props,{onEdit:function onEdit(){return setEdit(function(prev){return!prev})}})))};var PostPlaceHolder=function PostPlaceHolder(_a){var props=__rest(_a,[]);return React.createElement("div",{className:"wy-post"},React.createElement("div",{className:"wy-item wy-item-lg"},React.createElement("img",{alt:"",className:"wy-avatar wy-placeholder",height:48,width:48,src:props.created_by.avatar_url}),React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},React.createElement("span",{className:"wy-placeholder"},"Placeholder name")),React.createElement("div",{className:"wy-item-text"},React.createElement("time",{className:"wy-placeholder",dateTime:"2022-12-31 00:00:00"},"2022-12-31 00:00:00")))),React.createElement("div",{className:"wy-post-body"},React.createElement("div",{className:"wy-content"},React.createElement("span",{className:"wy-placeholder"},"Lorem")," ",React.createElement("span",{className:"wy-placeholder"},"ipsum")," ",React.createElement("span",{className:"wy-placeholder"},"dolor")," ",React.createElement("span",{className:"wy-placeholder"},"sit")," ",React.createElement("span",{className:"wy-placeholder"},"amet."))))};var PostList=function PostList(_ref357){var appId=_ref357.appId,features=_ref357.features,appFeatures=_ref357.appFeatures;var _React$useContext76=React.useContext(WeavyContext),client=_React$useContext76.client;var _useEvents4=useEvents(),dispatch=_useEvents4.dispatch;var infintePostsList=usePostsList(appId,{});var isLoading=infintePostsList.isLoading,data=infintePostsList.data,fetchNextPage=infintePostsList.fetchNextPage,hasNextPage=infintePostsList.hasNextPage,isFetchingNextPage=infintePostsList.isFetchingNextPage,dataUpdatedAt=infintePostsList.dataUpdatedAt;var loadMoreRef=useInfinteScroll(infintePostsList);React.useEffect(function(){if(appId){client===null||client===void 0?void 0:client.subscribe("a".concat(appId),"reaction_added",handleRealtimeReactionInserted);client===null||client===void 0?void 0:client.subscribe("a".concat(appId),"reaction_removed",handleRealtimeReactionDeleted)}},[appId]);var handleRealtimeReactionInserted=React.useCallback(function(realtimeEvent){dispatch("reaction_added_"+realtimeEvent.entity.id,realtimeEvent)},[appId]);var handleRealtimeReactionDeleted=React.useCallback(function(realtimeEvent){dispatch("reaction_deleted_"+realtimeEvent.entity.id,realtimeEvent)},[appId]);var loadMoreButton=React.createElement(UIButton.UI,{onClick:function onClick(){return fetchNextPage()},disabled:!hasNextPage||isFetchingNextPage,className:"wy-message-readmore"},dataUpdatedAt," Load more");if(isLoading){return React.createElement("div",{className:"wy-buttons"},React.createElement(UISpinner.UI,null))}return React.createElement("div",null,data&&data.pages&&data.pages.map(function(group,i){var _a;return React.createElement(React.Fragment,{key:data.pages.length-i},(_a=group.data)===null||_a===void 0?void 0:_a.map(function(post){return post.temp?React.createElement(PostPlaceHolder,{key:"post"+post.id,text:post.text,created_at:post.created_at,created_by:post.created_by}):React.createElement(Post,{key:"post"+post.id,appId:appId,id:post.id,text:post.text,html:post.html,created_at:post.created_at,modified_at:post.modified_at,created_by:post.created_by,trashed_at:post.trashed_at,attachments:post.attachments,reactions:post.reactions,embed:post.embed,comment_count:post.comment_count,is_subscribed:post.is_subscribed,is_trashed:post.is_trashed,options:post.options,meeting:post.meeting,features:features,appFeatures:appFeatures})}))}),React.createElement("div",{className:"wy-message-readmore",ref:loadMoreRef},isFetchingNextPage?"Loading more...":hasNextPage?loadMoreButton:""))};function useMutatePost(){var _React$useContext77=React.useContext(WeavyContext),client=_React$useContext77.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutatePost must be used within an WeavyProvider")}var mutatePost=function(){var _ref359=_asyncToGenerator(_regeneratorRuntime().mark(function _callee185(_ref358){var appId,text,blobs,meeting,embed,options,response;return _regeneratorRuntime().wrap(function _callee185$(_context188){while(1)switch(_context188.prev=_context188.next){case 0:appId=_ref358.appId,text=_ref358.text,blobs=_ref358.blobs,meeting=_ref358.meeting,embed=_ref358.embed,options=_ref358.options;_context188.next=3;return client.post("/api/apps/"+appId+"/posts","POST",JSON.stringify({text:text,blobs:blobs.map(function(b){return b.id}),meeting_id:meeting,embed_id:embed,options:options.filter(function(o){return o.text.trim()!==""}).map(function(o){return{text:o.text}})}));case 3:response=_context188.sent;return _context188.abrupt("return",response.json());case 5:case"end":return _context188.stop()}},_callee185)}));return function mutatePost(_x177){return _ref359.apply(this,arguments)}}();return useMutation(mutatePost,{onSuccess:function onSuccess(data,variables,context){addCacheItem(queryClient,["posts",variables.appId],data,context.tempId,{descending:true})},onMutate:function(){var _onMutate18=_asyncToGenerator(_regeneratorRuntime().mark(function _callee186(variables){var tempId,tempData;return _regeneratorRuntime().wrap(function _callee186$(_context189){while(1)switch(_context189.prev=_context189.next){case 0:_context189.next=2;return queryClient.cancelQueries(["posts",variables.appId]);case 2:tempId=Math.random();tempData={id:tempId,text:variables.text,temp:true,created_by:{display_name:variables.userName},created_at:new Date().toUTCString()};addCacheItem(queryClient,["posts",variables.appId],tempData,undefined,{descending:true});return _context189.abrupt("return",{tempId:tempId});case 6:case"end":return _context189.stop()}},_callee186)}));function onMutate(_x178){return _onMutate18.apply(this,arguments)}return onMutate}()})}var Posts=function Posts(_ref360){var uid=_ref360.uid,className=_ref360.className,features=_ref360.features;var _React$useContext78=React.useContext(WeavyContext),client=_React$useContext78.client;var _React$useState157=React.useState(null),_React$useState158=_slicedToArray2(_React$useState157,2),appId=_React$useState158[0],setAppId=_React$useState158[1];var addPostMutation=useMutatePost();if(!client){throw new Error("Weavy Posts component must be used within an WeavyProvider")}var _usePosts=usePosts(uid,{}),isLoading=_usePosts.isLoading,data=_usePosts.data;var _useFeatures3=useFeatures("feeds",{}),isLoadingFeatures=_useFeatures3.isLoading,dataFeatures=_useFeatures3.data;React.useEffect(function(){if(data){setAppId(data.id)}else{setAppId(null)}},[data]);var handleCreate=function(){var _ref361=_asyncToGenerator(_regeneratorRuntime().mark(function _callee187(text,blobs,attachments,meetingId,embed,options){return _regeneratorRuntime().wrap(function _callee187$(_context190){while(1)switch(_context190.prev=_context190.next){case 0:_context190.next=2;return addPostMutation.mutateAsync({appId:appId,text:text,blobs:blobs,meeting:meetingId,embed:embed,options:options},{onSuccess:function onSuccess(data){}});case 2:case"end":return _context190.stop()}},_callee187)}));return function handleCreate(_x179,_x180,_x181,_x182,_x183,_x184){return _ref361.apply(this,arguments)}}();return React.createElement("div",{className:classNames("wy-posts",className)},!isLoading&&!data&&React.createElement("div",null,"No posts app with the contextual id ",React.createElement("strong",null,uid)," was found."),appId&&data&&dataFeatures&&React.createElement("div",{className:"wy-post"},React.createElement(Editor,{editorType:"posts",editorLocation:"apps",appId:appId,placeholder:"Create a post",buttonText:"Post",onSubmit:handleCreate,showMention:hasFeature(dataFeatures,Feature.Mentions,features===null||features===void 0?void 0:features.mentions),showAttachments:hasFeature(dataFeatures,Feature.Attachments,features===null||features===void 0?void 0:features.attachments),showCloudFiles:hasFeature(dataFeatures,Feature.CloudFiles,features===null||features===void 0?void 0:features.cloudFiles),showEmbeds:hasFeature(dataFeatures,Feature.Embeds,features===null||features===void 0?void 0:features.embeds),showPolls:hasFeature(dataFeatures,Feature.Polls,features===null||features===void 0?void 0:features.polls),useDraft:true})),appId&&dataFeatures&&React.createElement(PostList,{appId:appId,features:dataFeatures,appFeatures:features}))};function useApp(uid,options){var _React$useContext79=React.useContext(WeavyContext),client=_React$useContext79.client;if(!client){throw new Error("useApp must be used within an WeavyProvider")}var getApp=function(){var _ref362=_asyncToGenerator(_regeneratorRuntime().mark(function _callee188(){var response,data;return _regeneratorRuntime().wrap(function _callee188$(_context191){while(1)switch(_context191.prev=_context191.next){case 0:_context191.next=2;return client.get("/api/apps/"+uid);case 2:response=_context191.sent;_context191.next=5;return response.json();case 5:data=_context191.sent;return _context191.abrupt("return",data);case 7:case"end":return _context191.stop()}},_callee188)}));return function getApp(){return _ref362.apply(this,arguments)}}();return useQuery(["apps",uid],getApp,options)}function useFileList(appId){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var PAGE_SIZE=25;var _React$useContext80=React.useContext(WeavyContext),client=_React$useContext80.client;if(!client){throw new Error("useFileList must be used within an WeavyProvider")}var queryClient=useQueryClient();var filesKey=["files",appId];React.useEffect(function(){queryClient.removeQueries({queryKey:filesKey,exact:true,predicate:function predicate(query){var mismatch=JSON.stringify(query.meta)!==JSON.stringify(options.meta);return mismatch}})},[options]);var updateDataWithMutations=function updateDataWithMutations(data){var _a;var mutatingFiles=queryClient.getMutationCache().findAll({mutationKey:filesKey,predicate:function predicate(mutation){var _a;return!!((_a=mutation.state.context)===null||_a===void 0?void 0:_a.file)}}).map(function(mutation){return mutation.state.context.file});var meta=(_a=queryClient.getQueryCache().find(filesKey))===null||_a===void 0?void 0:_a.meta;var order=meta===null||meta===void 0?void 0:meta.order;mutatingFiles.forEach(function(file){if(file.id<1&&file.status!=="ok"&&file.status!=="error"){var existingFile=findAnyExistingItem(data,"name",file.name,true);if(existingFile){file.id=existingFile.id}data=addToQueryData(data,file,order)}else{data=updateQueryData(data,file.id,function(cacheFile){Object.assign(cacheFile,file)})}});return data};var getFiles=function(){var _ref363=_asyncToGenerator(_regeneratorRuntime().mark(function _callee189(opt){var _a,skip,order,trashed,orderParam,url,response;return _regeneratorRuntime().wrap(function _callee189$(_context192){while(1)switch(_context192.prev=_context192.next){case 0:skip=opt.pageParam||0;order=opt.meta&&opt.meta.order;trashed=!!((_a=opt.meta)===null||_a===void 0?void 0:_a.trashed);orderParam=order?order.by+(order.descending?"+desc":""):"";url="/api/apps/"+appId+"/files?skip="+skip+"&top="+PAGE_SIZE+"&orderby="+orderParam;if(trashed){url+="&trashed=null"}_context192.next=8;return client.get(url);case 8:response=_context192.sent;_context192.next=11;return response.json();case 11:return _context192.abrupt("return",_context192.sent);case 12:case"end":return _context192.stop()}},_callee189)}));return function getFiles(_x185){return _ref363.apply(this,arguments)}}();var opts=Object.assign(Object.assign({},options),{getNextPageParam:function getNextPageParam(lastPage,pages){if((lastPage===null||lastPage===void 0?void 0:lastPage.end)<(lastPage===null||lastPage===void 0?void 0:lastPage.count)){return pages.length*PAGE_SIZE}},select:updateDataWithMutations});return useInfiniteQuery(["files",appId],getFiles,opts)}function useMutateFileRename(filesKey){var _React$useContext81=React.useContext(WeavyContext),client=_React$useContext81.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateFileRename must be used within an WeavyProvider")}var mutateRename=function(){var _ref365=_asyncToGenerator(_regeneratorRuntime().mark(function _callee190(_ref364){var file,name,response;return _regeneratorRuntime().wrap(function _callee190$(_context193){while(1)switch(_context193.prev=_context193.next){case 0:file=_ref364.file,name=_ref364.name;if(!(file.id>=1)){_context193.next=12;break}_context193.next=4;return client.post("/api/files/"+file.id,"PATCH",JSON.stringify({name:name}));case 4:response=_context193.sent;if(response.ok){_context193.next=9;break}_context193.next=8;return response.json();case 8:throw _context193.sent;case 9:return _context193.abrupt("return",response.json());case 12:throw new Error("Could not rename ".concat(file.name));case 13:case"end":return _context193.stop()}},_callee190)}));return function mutateRename(_x186){return _ref365.apply(this,arguments)}}();return useMutation(mutateRename,{onMutate:function(){var _onMutate19=_asyncToGenerator(_regeneratorRuntime().mark(function _callee191(variables){return _regeneratorRuntime().wrap(function _callee191$(_context194){while(1)switch(_context194.prev=_context194.next){case 0:updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{name:variables.name})});case 1:case"end":return _context194.stop()}},_callee191)}));function onMutate(_x187){return _onMutate19.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,data,{status:"ok"})})},onError:function onError(error,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{name:variables.file.name})})}})}function useMutateFileTrash(filesKey){var _React$useContext82=React.useContext(WeavyContext),client=_React$useContext82.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateFileTrash must be used within an WeavyProvider")}var trashMutation=useMutation(function(){var _ref367=_asyncToGenerator(_regeneratorRuntime().mark(function _callee192(_ref366){var file,response;return _regeneratorRuntime().wrap(function _callee192$(_context195){while(1)switch(_context195.prev=_context195.next){case 0:file=_ref366.file;if(!(file.id>=1)){_context195.next=8;break}_context195.next=4;return client.post("/api/files/"+file.id+"/trash","POST","");case 4:response=_context195.sent;return _context195.abrupt("return",response.json());case 8:throw new Error("Could not trash ".concat(file.name,"."));case 9:case"end":return _context195.stop()}},_callee192)}));return function(_x188){return _ref367.apply(this,arguments)}}(),{onMutate:function(){var _onMutate20=_asyncToGenerator(_regeneratorRuntime().mark(function _callee193(variables){return _regeneratorRuntime().wrap(function _callee193$(_context196){while(1)switch(_context196.prev=_context196.next){case 0:updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{is_trashed:true,status:"pending"})});case 1:case"end":return _context196.stop()}},_callee193)}));function onMutate(_x189){return _onMutate20.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,data,{status:"ok"})})},onError:function onError(error,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{is_trashed:false,status:"error"})})}});return trashMutation}function useMutateFileRestore(filesKey){var _React$useContext83=React.useContext(WeavyContext),client=_React$useContext83.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateFileRestore must be used within an WeavyProvider")}var restoreMutation=useMutation(function(){var _ref369=_asyncToGenerator(_regeneratorRuntime().mark(function _callee194(_ref368){var file,response;return _regeneratorRuntime().wrap(function _callee194$(_context197){while(1)switch(_context197.prev=_context197.next){case 0:file=_ref368.file;if(!(file.id>=1)){_context197.next=12;break}_context197.next=4;return client.post("/api/files/"+file.id+"/restore","POST","");case 4:response=_context197.sent;if(response.ok){_context197.next=9;break}_context197.next=8;return response.json();case 8:throw _context197.sent;case 9:return _context197.abrupt("return",response.json());case 12:throw{status:400,title:"Could not restore ".concat(file.name,".")};case 13:case"end":return _context197.stop()}},_callee194)}));return function(_x190){return _ref369.apply(this,arguments)}}(),{onMutate:function(){var _onMutate21=_asyncToGenerator(_regeneratorRuntime().mark(function _callee195(variables){return _regeneratorRuntime().wrap(function _callee195$(_context198){while(1)switch(_context198.prev=_context198.next){case 0:updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{is_trashed:false})});case 1:case"end":return _context198.stop()}},_callee195)}));function onMutate(_x191){return _onMutate21.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,data,{status:"ok"})})},onError:function onError(error,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{is_trashed:true})})}});return restoreMutation}function useMutateFileDeleteForever(filesKey){var _React$useContext84=React.useContext(WeavyContext),client=_React$useContext84.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateFileDeleteForever must be used within an WeavyProvider")}var deleteForeverMutation=useMutation(function(){var _ref371=_asyncToGenerator(_regeneratorRuntime().mark(function _callee196(_ref370){var file,response;return _regeneratorRuntime().wrap(function _callee196$(_context199){while(1)switch(_context199.prev=_context199.next){case 0:file=_ref370.file;if(!(file.id>=1&&file.is_trashed)){_context199.next=11;break}_context199.next=4;return client.post("/api/files/"+file.id,"DELETE","");case 4:response=_context199.sent;if(response.ok){_context199.next=9;break}_context199.next=8;return response.json();case 8:throw _context199.sent;case 9:_context199.next=12;break;case 11:throw{status:400,title:"Could not delete ".concat(file.name," forever.")};case 12:case"end":return _context199.stop()}},_callee196)}));return function(_x192){return _ref371.apply(this,arguments)}}(),{onMutate:function(){var _onMutate22=_asyncToGenerator(_regeneratorRuntime().mark(function _callee197(variables){return _regeneratorRuntime().wrap(function _callee197$(_context200){while(1)switch(_context200.prev=_context200.next){case 0:updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{status:"pending"})});case 1:case"end":return _context200.stop()}},_callee197)}));function onMutate(_x193){return _onMutate22.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){removeCacheItem(queryClient,filesKey,variables.file.id)},onError:function onError(error,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{status:undefined})})}});return deleteForeverMutation}function useMutateFileSubscribe(filesKey){var _React$useContext85=React.useContext(WeavyContext),client=_React$useContext85.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateFileSubscribe must be used within an WeavyProvider")}var subscribeMutation=useMutation(function(){var _ref373=_asyncToGenerator(_regeneratorRuntime().mark(function _callee198(_ref372){var file,response;return _regeneratorRuntime().wrap(function _callee198$(_context201){while(1)switch(_context201.prev=_context201.next){case 0:file=_ref372.file;if(!(file.id>=1)){_context201.next=12;break}_context201.next=4;return client.post("/api/files/"+file.id+"/subscribe","POST","");case 4:response=_context201.sent;if(response.ok){_context201.next=9;break}_context201.next=8;return response.json();case 8:throw _context201.sent;case 9:return _context201.abrupt("return",response.json());case 12:throw new Error("Could not subscribe to ".concat(file.name,"."));case 13:case"end":return _context201.stop()}},_callee198)}));return function(_x194){return _ref373.apply(this,arguments)}}(),{onMutate:function(){var _onMutate23=_asyncToGenerator(_regeneratorRuntime().mark(function _callee199(variables){return _regeneratorRuntime().wrap(function _callee199$(_context202){while(1)switch(_context202.prev=_context202.next){case 0:updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{is_subscribed:true,status:"pending"})});case 1:case"end":return _context202.stop()}},_callee199)}));function onMutate(_x195){return _onMutate23.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,data,{status:"ok"})})},onError:function onError(error,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{is_subscribed:variables.file.is_subscribed,status:"error"})})}});return subscribeMutation}function useMutateFileUnsubscribe(filesKey){var _React$useContext86=React.useContext(WeavyContext),client=_React$useContext86.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateFileUnsubscribe must be used within an WeavyProvider")}var unsubscribeMutation=useMutation(function(){var _ref375=_asyncToGenerator(_regeneratorRuntime().mark(function _callee200(_ref374){var file,response;return _regeneratorRuntime().wrap(function _callee200$(_context203){while(1)switch(_context203.prev=_context203.next){case 0:file=_ref374.file;if(!(file.id>=1)){_context203.next=12;break}_context203.next=4;return client.post("/api/files/"+file.id+"/unsubscribe","POST","");case 4:response=_context203.sent;if(response.ok){_context203.next=9;break}_context203.next=8;return response.json();case 8:throw _context203.sent;case 9:return _context203.abrupt("return",response.json());case 12:throw new Error("Could not unsubscribe to ".concat(file.name,"."));case 13:case"end":return _context203.stop()}},_callee200)}));return function(_x196){return _ref375.apply(this,arguments)}}(),{onMutate:function(){var _onMutate24=_asyncToGenerator(_regeneratorRuntime().mark(function _callee201(variables){return _regeneratorRuntime().wrap(function _callee201$(_context204){while(1)switch(_context204.prev=_context204.next){case 0:updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{is_subscribed:false})});case 1:case"end":return _context204.stop()}},_callee201)}));function onMutate(_x197){return _onMutate24.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,data,{status:"ok"})})},onError:function onError(error,variables,context){updateCacheItem(queryClient,filesKey,variables.file.id,function(existingFile){return Object.assign(existingFile,{is_subscribed:variables.file.is_subscribed})})}});return unsubscribeMutation}function useFileVersions(filesKey,fileId,options){var _React$useContext87=React.useContext(WeavyContext),client=_React$useContext87.client;if(!client){throw new Error("useReactionList must be used within an WeavyProvider")}var getVersions=function(){var _ref376=_asyncToGenerator(_regeneratorRuntime().mark(function _callee202(){var response,data;return _regeneratorRuntime().wrap(function _callee202$(_context205){while(1)switch(_context205.prev=_context205.next){case 0:_context205.next=2;return client.get("/api/files/".concat(fileId,"/versions"));case 2:response=_context205.sent;_context205.next=5;return response.json();case 5:data=_context205.sent;return _context205.abrupt("return",data);case 7:case"end":return _context205.stop()}},_callee202)}));return function getVersions(){return _ref376.apply(this,arguments)}}();return useQuery([].concat(_toConsumableArray2(filesKey),[fileId,"versions"]),getVersions,options)}function useMutateFileVersionRestore(filesKey){var _React$useContext88=React.useContext(WeavyContext),client=_React$useContext88.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateFileVersion must be used within an WeavyProvider")}var restoreMutation=useMutation(function(){var _ref378=_asyncToGenerator(_regeneratorRuntime().mark(function _callee203(_ref377){var versionFile,response;return _regeneratorRuntime().wrap(function _callee203$(_context206){while(1)switch(_context206.prev=_context206.next){case 0:versionFile=_ref377.versionFile;if(!(versionFile.id>=1&&versionFile.version)){_context206.next=8;break}_context206.next=4;return client.post("/api/files/".concat(versionFile.id,"/versions/").concat(versionFile.version,"/restore"),"POST","");case 4:response=_context206.sent;return _context206.abrupt("return",response.json());case 8:throw new Error("Could not restore ".concat(versionFile.name," to version ").concat(versionFile.version,"."));case 9:case"end":return _context206.stop()}},_callee203)}));return function(_x198){return _ref378.apply(this,arguments)}}(),{onMutate:function(){var _onMutate25=_asyncToGenerator(_regeneratorRuntime().mark(function _callee204(variables){var previousFile;return _regeneratorRuntime().wrap(function _callee204$(_context207){while(1)switch(_context207.prev=_context207.next){case 0:updateCacheItem(queryClient,filesKey,variables.versionFile.id,function(existingFile){previousFile=existingFile;return Object.assign(existingFile,variables.versionFile,{status:"pending"})});updateCacheItem(queryClient,[].concat(_toConsumableArray2(filesKey),[variables.versionFile.id,"versions"]),variables.versionFile.id,function(existingFile){previousFile=existingFile;return Object.assign(existingFile,{status:"pending"})});return _context207.abrupt("return",{versionFile:variables.versionFile,previousFile:previousFile});case 3:case"end":return _context207.stop()}},_callee204)}));function onMutate(_x199){return _onMutate25.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){updateCacheItem(queryClient,filesKey,variables.versionFile.id,function(existingFile){return Object.assign(existingFile,data,{status:"ok"})});queryClient.removeQueries([].concat(_toConsumableArray2(filesKey),[variables.versionFile.id,"versions"]))},onError:function onError(error,variables,context){updateCacheItem(queryClient,filesKey,variables.versionFile.id,function(existingFile){return Object.assign(existingFile,context.previousFile,{status:"error"})});updateCacheItem(queryClient,[].concat(_toConsumableArray2(filesKey),[variables.versionFile.id,"versions"]),variables.versionFile.id,function(existingFile){return Object.assign(existingFile,{status:"error"})})}});return restoreMutation}function useMutateFileVersionDelete(filesKey){var _React$useContext89=React.useContext(WeavyContext),client=_React$useContext89.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateFileVersionRemove must be used within an WeavyProvider")}var deleteMutation=useMutation(function(){var _ref380=_asyncToGenerator(_regeneratorRuntime().mark(function _callee205(_ref379){var versionFile,response;return _regeneratorRuntime().wrap(function _callee205$(_context208){while(1)switch(_context208.prev=_context208.next){case 0:versionFile=_ref379.versionFile;if(!(versionFile.id>=1&&versionFile.version)){_context208.next=11;break}_context208.next=4;return client.post("/api/files/".concat(versionFile.id,"/versions/").concat(versionFile.version),"DELETE","");case 4:response=_context208.sent;if(response.ok){_context208.next=9;break}_context208.next=8;return response.json();case 8:throw _context208.sent;case 9:_context208.next=12;break;case 11:throw{status:400,title:"Could not remove ".concat(versionFile.name," version ").concat(versionFile.version,".")};case 12:case"end":return _context208.stop()}},_callee205)}));return function(_x200){return _ref380.apply(this,arguments)}}(),{onMutate:function(){var _onMutate26=_asyncToGenerator(_regeneratorRuntime().mark(function _callee206(variables){var versionPredicate;return _regeneratorRuntime().wrap(function _callee206$(_context209){while(1)switch(_context209.prev=_context209.next){case 0:versionPredicate=function versionPredicate(item){return item.id===variables.versionFile.id&&item.version===variables.versionFile.version};updateCacheItem(queryClient,[].concat(_toConsumableArray2(filesKey),[variables.versionFile.id,"versions"]),versionPredicate,function(existingFile){return Object.assign(existingFile,{status:"pending"})});case 2:case"end":return _context209.stop()}},_callee206)}));function onMutate(_x201){return _onMutate26.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){var versionPredicate=function versionPredicate(item){return item.id===variables.versionFile.id&&item.version===variables.versionFile.version};removeCacheItem(queryClient,[].concat(_toConsumableArray2(filesKey),[variables.versionFile.id,"versions"]),versionPredicate)},onError:function onError(error,variables,context){var versionPredicate=function versionPredicate(item){return item.id===variables.versionFile.id&&item.version===variables.versionFile.version};updateCacheItem(queryClient,[].concat(_toConsumableArray2(filesKey),[variables.versionFile.id,"versions"]),versionPredicate,function(existingFile){return Object.assign(existingFile,{status:undefined})})}});return deleteMutation}var FileVersions=function FileVersions(_ref381){var filesKey=_ref381.filesKey,file=_ref381.file,onVersionSelect=_ref381.onVersionSelect;var fileVersionList=useFileVersions(filesKey,file.id,{});var isLoading=fileVersionList.isLoading,isError=fileVersionList.isError,data=fileVersionList.data,error=fileVersionList.error,isFetching=fileVersionList.isFetching;var mutateFileVersionRestore=useMutateFileVersionRestore(filesKey);var mutateFileVersionDelete=useMutateFileVersionDelete(filesKey);var _React$useState159=React.useState(),_React$useState160=_slicedToArray2(_React$useState159,2),activeVersion=_React$useState160[0],setActiveVersion=_React$useState160[1];React.useEffect(function(){setActiveVersion(file)},[file,file.version]);var handleSelect=function handleSelect(versionFile){setActiveVersion(versionFile);onVersionSelect&&onVersionSelect(versionFile)};var handleSelectWrapper=function handleSelectWrapper(versionFile,e){if(!e.defaultPrevented){handleSelect(versionFile)}};var handleRevert=function handleRevert(versionFile){console.debug("reverting file version",versionFile.version);mutateFileVersionRestore.mutate({versionFile:versionFile});handleSelect(versionFile)};var handleRemove=function handleRemove(versionFile){console.debug("removing file version",versionFile.version);mutateFileVersionDelete.mutate({versionFile:versionFile});if(activeVersion===versionFile){setActiveVersion(file)}};if(isLoading){return React.createElement(UISpinner.UI,{spin:true,overlay:true})}return React.createElement("div",{className:"wy-list wy-versions",key:"file-versions"+file.id},data&&data.map(function(versionFile,index){var _a;var versionIcon=getIcon(versionFile.name||"").icon;var num=data.length-index;var ext=getExtension(versionFile.name);var modifiedAt=dayjs.utc(versionFile.modified_at||versionFile.created_at).tz(dayjs.tz.guess());return React.createElement("div",{key:"file-version"+versionFile.version,className:classNames("wy-item wy-item-hover wy-item-lg",{"wy-active":versionFile.version==(activeVersion===null||activeVersion===void 0?void 0:activeVersion.version)}),onClick:handleSelectWrapper.bind(FileVersions,versionFile)},file.status==="error"?React.createElement(UIIcon.UI,{name:"alert-octagon",color:"error",size:48}):file.status==="conflict"?React.createElement(UIIcon.UI,{name:"alert",color:"yellow",size:48}):file.status==="pending"?React.createElement(UISpinner.UI,{spin:!versionFile.progress,progress:versionFile.progress,size:48}):React.createElement(UIIcon.UI,{name:versionIcon,size:48,className:classNames("wy-kind-"+toKebabCase(versionFile.kind),"wy-ext-"+ext.substring(1))}),React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},num,". ",versionFile.name),React.createElement("div",{className:"wy-item-text"},React.createElement("time",{dateTime:versionFile.modified_at||versionFile.created_at,title:modifiedAt.format("LLLL")},modifiedAt.fromNow())," \xB7 ",(_a=versionFile.modified_by)===null||_a===void 0?void 0:_a.display_name)),React.createElement(UIDropdown.UI,{directionX:"left"},React.createElement(UIDropdown.Item,{onClick:function onClick(){return triggerDownload(versionFile)}},React.createElement(UIIcon.UI,{name:"download"})," Download"),versionFile.version!==file.version&&React.createElement(React.Fragment,null,React.createElement(UIDropdown.Divider,null),React.createElement(UIDropdown.Item,{onClick:function onClick(){return handleRevert(versionFile)}},React.createElement(UIIcon.UI,{name:"restore"})," Revert"),React.createElement(UIDropdown.Item,{onClick:function onClick(){return handleRemove(versionFile)}},React.createElement(UIIcon.UI,{name:"delete"})," Remove"))))}))};function allowedKeyTarget(e){var notInputField=!e.target.matches("input, textarea, select")&&!e.target.closest("[contenteditable=\"true\"]");return notInputField}var PreviewFiles=function PreviewFiles(_ref382){var appId=_ref382.appId,infiniteFiles=_ref382.infiniteFiles,previewId=_ref382.previewId,features=_ref382.features,appFeatures=_ref382.appFeatures,onClose=_ref382.onClose;var _React$useContext90=React.useContext(WeavyContext),client=_React$useContext90.client;var _React$useState161=React.useState(false),_React$useState162=_slicedToArray2(_React$useState161,2),modalPreviewOpen=_React$useState162[0],setModalPreviewOpen=_React$useState162[1];var _React$useState163=React.useState(false),_React$useState164=_slicedToArray2(_React$useState163,2),commentsOpen=_React$useState164[0],setCommentsOpen=_React$useState164[1];var _React$useState165=React.useState(false),_React$useState166=_slicedToArray2(_React$useState165,2),versionsOpen=_React$useState166[0],setVersionsOpen=_React$useState166[1];var _React$useState167=React.useState(false),_React$useState168=_slicedToArray2(_React$useState167,2),sidebarMaximized=_React$useState168[0],setSidebarMaximized=_React$useState168[1];var _React$useState169=React.useState(),_React$useState170=_slicedToArray2(_React$useState169,2),activeFile=_React$useState170[0],setActiveFile=_React$useState170[1];var _React$useState171=React.useState(),_React$useState172=_slicedToArray2(_React$useState171,2),versionFile=_React$useState172[0],setVersionFile=_React$useState172[1];var _React$useState173=React.useState(),_React$useState174=_slicedToArray2(_React$useState173,2),currentFileId=_React$useState174[0],setCurrentFileId=_React$useState174[1];var _React$useState175=React.useState(),_React$useState176=_slicedToArray2(_React$useState175,2),nextFileId=_React$useState176[0],setNextFileId=_React$useState176[1];var _React$useState177=React.useState(),_React$useState178=_slicedToArray2(_React$useState177,2),previousFileId=_React$useState178[0],setPreviousFileId=_React$useState178[1];var isLoading=infiniteFiles.isLoading,filesData=infiniteFiles.data,dataUpdatedAt=infiniteFiles.dataUpdatedAt,fetchNextPage=infiniteFiles.fetchNextPage,hasNextPage=infiniteFiles.hasNextPage,isFetchingNextPage=infiniteFiles.isFetchingNextPage;React.useEffect(function(){if(!versionsOpen&&!commentsOpen){setSidebarMaximized(false)}if(!versionsOpen){setVersionFile(undefined)}},[versionsOpen,commentsOpen]);React.useEffect(function(){setVersionFile(undefined)},[activeFile]);var toggleSidebarTab=function toggleSidebarTab(tab,state){if(tab==="comments"){setVersionsOpen(false);setCommentsOpen(state!==undefined?state:!commentsOpen)}else if(tab==="versions"){setCommentsOpen(false);setVersionsOpen(state!==undefined?state:!versionsOpen)}else{setCommentsOpen(false);setVersionsOpen(false)}};React.useEffect(function(){if(currentFileId){if(!isLoading){_asyncToGenerator(_regeneratorRuntime().mark(function _callee208(){var _a,_b,getIndexFromId,getFileFromIndex,itemIndex,getFileFromId;return _regeneratorRuntime().wrap(function _callee208$(_context211){while(1)switch(_context211.prev=_context211.next){case 0:if(!(filesData&&filesData.pages.length>0)){_context211.next=43;break}if(!(currentFileId>=1)){_context211.next=40;break}getIndexFromId=function getIndexFromId(id){var foundIndex=-1;filesData.pages.some(function(page){var currentFoundIndex=page.data.findIndex(function(file){return file.id===id});if(currentFoundIndex!==-1){foundIndex=currentFoundIndex+page.start}return currentFoundIndex!==-1});return foundIndex};getFileFromIndex=function(){var _ref384=_asyncToGenerator(_regeneratorRuntime().mark(function _callee207(index){var infiniteFilesData,fetchedInfiniteFiles,foundFile;return _regeneratorRuntime().wrap(function _callee207$(_context210){while(1)switch(_context210.prev=_context210.next){case 0:if(!(index>0||index<=filesData.pages[0].count)){_context210.next=10;break}infiniteFilesData=filesData;if(!(index>filesData.pages[filesData.pages.length-1].end&&(hasNextPage||isFetchingNextPage))){_context210.next=8;break}_context210.next=5;return fetchNextPage({cancelRefetch:false});case 5:fetchedInfiniteFiles=_context210.sent;infiniteFilesData=fetchedInfiniteFiles.data;console.debug("preview nextpage was fetched");case 8:infiniteFilesData===null||infiniteFilesData===void 0?void 0:infiniteFilesData.pages.find(function(page){if(index>=page.start&&index<=page.end){return foundFile=page.data[index-page.start]}});return _context210.abrupt("return",foundFile);case 10:case"end":return _context210.stop()}},_callee207)}));return function getFileFromIndex(_x202){return _ref384.apply(this,arguments)}}();itemIndex=getIndexFromId(currentFileId);_context211.t0=setPreviousFileId;_context211.next=8;return getFileFromIndex(itemIndex-1);case 8:_context211.t2=_a=_context211.sent;_context211.t1=_context211.t2===null;if(_context211.t1){_context211.next=12;break}_context211.t1=_a===void 0;case 12:if(!_context211.t1){_context211.next=16;break}_context211.t3=void 0;_context211.next=17;break;case 16:_context211.t3=_a.id;case 17:_context211.t4=_context211.t3;(0,_context211.t0)(_context211.t4);_context211.t5=setNextFileId;_context211.next=22;return getFileFromIndex(itemIndex+1);case 22:_context211.t7=_b=_context211.sent;_context211.t6=_context211.t7===null;if(_context211.t6){_context211.next=26;break}_context211.t6=_b===void 0;case 26:if(!_context211.t6){_context211.next=30;break}_context211.t8=void 0;_context211.next=31;break;case 30:_context211.t8=_b.id;case 31:_context211.t9=_context211.t8;(0,_context211.t5)(_context211.t9);_context211.t10=setActiveFile;_context211.next=36;return getFileFromIndex(itemIndex);case 36:_context211.t11=_context211.sent;(0,_context211.t10)(_context211.t11);_context211.next=41;break;case 40:if(currentFileId>=0&&currentFileId<1){getFileFromId=function getFileFromId(id){var foundFile;filesData.pages.some(function(page){return foundFile=page.data.find(function(file){return file.id===id})});if(!foundFile&&activeFile){filesData.pages.some(function(page){return foundFile=page.data.find(function(file){if(file.name===activeFile.name){if(file.id!==currentFileId){setCurrentFileId(file.id)}return true}})})}return foundFile};setPreviousFileId(undefined);setNextFileId(undefined);setActiveFile(getFileFromId(currentFileId))}case 41:_context211.next=46;break;case 43:setPreviousFileId(undefined);setNextFileId(undefined);setActiveFile(undefined);case 46:case"end":return _context211.stop()}},_callee208)}))()}}},[isLoading,filesData,dataUpdatedAt,currentFileId]);var openPreview=function openPreview(id){setCurrentFileId(id);setModalPreviewOpen(true)};var closePreview=function closePreview(){setModalPreviewOpen(false);if(onClose){onClose()}};React.useEffect(function(){if(previewId){openPreview(previewId)}},[previewId]);var handlePrevious=function handlePrevious(){setCurrentFileId(previousFileId)};var handleNext=function handleNext(){setCurrentFileId(nextFileId)};var handleVersionFile=function handleVersionFile(file){if((activeFile===null||activeFile===void 0?void 0:activeFile.version)!==file.version){setVersionFile(file)}else{setVersionFile(undefined)}};var previewFile=versionFile||activeFile;React.useEffect(function(){if(activeFile){var handleKey=function handleKey(e){if(modalPreviewOpen){if(e.which===27){e.stopImmediatePropagation();closePreview()}else if(e.which===37){if(allowedKeyTarget(e)){e.stopPropagation();setCurrentFileId(previousFileId)}}else if(e.which===39){if(allowedKeyTarget(e)){e.stopPropagation();setCurrentFileId(nextFileId)}}}};document.addEventListener("keyup",handleKey);return function(){document.removeEventListener("keyup",handleKey)}}},[activeFile,modalPreviewOpen]);var previewExt=getExtension((previewFile===null||previewFile===void 0?void 0:previewFile.name)||"");var previewIcon=getIcon((previewFile===null||previewFile===void 0?void 0:previewFile.name)||"").icon;var previewSrc=(previewFile===null||previewFile===void 0?void 0:previewFile.preview_url)||(previewFile===null||previewFile===void 0?void 0:previewFile.download_url)||"";var animatedImage=(previewFile===null||previewFile===void 0?void 0:previewFile.preview_format)==="image"&&(previewExt===".gif"||previewExt===".svg");if(animatedImage){previewSrc=(previewFile===null||previewFile===void 0?void 0:previewFile.download_url)||""}return React.createElement(React.Fragment,null,filesData&&React.createElement(UIOverlay.UI,{isOpen:modalPreviewOpen,className:"wy-dark",closeOnEsc:false,onClose:function onClose(){return setModalPreviewOpen(false)},style:{overlay:{zIndex:10000}}},React.createElement("header",{className:"wy-appbars"},React.createElement("nav",{className:"wy-appbar"},React.createElement(UIButton.UI,{onClick:closePreview},React.createElement(UIIcon.UI,{name:"close"})),React.createElement("div",{className:classNames("wy-appbar-text",{"wy-appbar-text-trashed":activeFile===null||activeFile===void 0?void 0:activeFile.is_trashed})},activeFile&&React.createElement("span",null,activeFile.name)),React.createElement("div",{className:"wy-appbar-buttons"},activeFile&&React.createElement(React.Fragment,null,activeFile.id>=1&&hasFeature(features,Feature.Comments,appFeatures===null||appFeatures===void 0?void 0:appFeatures.comments)&&React.createElement(UIButton.UI,{active:commentsOpen,onClick:function onClick(){return toggleSidebarTab("comments")},title:"Comments"},React.createElement(UIIcon.ActiveStack,null,React.createElement(UIIcon.UI,{name:"comment-outline"}),React.createElement(UIIcon.UI,{name:"comment"}))),React.createElement(FileMenu,{file:activeFile,features:features,appFeatures:appFeatures},activeFile.id>=1&&hasFeature(features,Feature.Versions,appFeatures===null||appFeatures===void 0?void 0:appFeatures.versions)&&React.createElement(UIDropdown.Item,{active:versionsOpen,onClick:function onClick(){return toggleSidebarTab("versions")}},React.createElement(UIIcon.UI,{name:"backup-restore"})," Versions")))))),React.createElement("div",{className:"wy-main"},React.createElement(React.Fragment,null,React.createElement("aside",{id:"tab-comments",className:classNames("wy-sidebar",{"wy-active":commentsOpen,"wy-maximized":sidebarMaximized}),hidden:!commentsOpen},React.createElement("nav",{className:"wy-item"},React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},"Comments")),React.createElement(UIButton.UI,{onClick:function onClick(){return toggleSidebarTab("comments",false)}},React.createElement(UIIcon.UI,{name:"close"})),React.createElement("button",{onClick:function onClick(){return setSidebarMaximized(!sidebarMaximized)},className:"wy-sidebar-handle"})),React.createElement("div",{className:"wy-pane wy-scroll-y"},commentsOpen&&activeFile&&activeFile.id>=1&&appId&&React.createElement(Comments,{appId:appId,parentId:activeFile.id,type:"files",features:features,appFeatures:appFeatures}))),React.createElement("aside",{id:"tab-versions",className:classNames("wy-sidebar",{"wy-active":versionsOpen,"wy-maximized":sidebarMaximized}),hidden:!versionsOpen},React.createElement("nav",{className:"wy-item"},React.createElement("div",{className:"wy-item-body"},React.createElement("div",{className:"wy-item-title"},"Versions")),React.createElement(UIButton.UI,{onClick:function onClick(){return toggleSidebarTab("versions",false)}},React.createElement(UIIcon.UI,{name:"close"})),React.createElement("button",{onClick:function onClick(){return setSidebarMaximized(!sidebarMaximized)},className:"wy-sidebar-handle"})),React.createElement("div",{className:"wy-pane wy-scroll-y"},React.createElement("div",{className:"wy-pane-body"},versionsOpen&&activeFile&&React.createElement(FileVersions,{key:"files-versions"+appId+activeFile.id,filesKey:["files",appId],file:activeFile,onVersionSelect:handleVersionFile}))))),React.createElement("div",{className:"wy-preview"},previewFile&&React.createElement(React.Fragment,null,previousFileId&&React.createElement("nav",{className:"wy-nav-prev"},React.createElement(UIButton.UI,{onClick:handlePrevious},React.createElement(UIIcon.UI,{name:"previous"}))),nextFileId&&React.createElement("nav",{className:"wy-nav-next"},React.createElement(UIButton.UI,{onClick:handleNext},React.createElement(UIIcon.UI,{name:"next"}))),React.createElement("div",{className:"wy-preview-area wy-scroll-y wy-scroll-x"},React.createElement(Preview,{client:client,src:previewSrc,link:previewFile.external_url,format:previewFile.is_trashed?"none":previewFile.preview_format,name:previewFile.name,icon:previewIcon,width:previewFile.width,height:previewFile.height,mediaType:previewFile.media_type,provider:previewFile.provider})))))))};var FileList=function FileList(_ref385){var appId=_ref385.appId,_ref385$view=_ref385.view,view=_ref385$view===void 0?"list":_ref385$view,order=_ref385.order,_ref385$trashed=_ref385.trashed,trashed=_ref385$trashed===void 0?false:_ref385$trashed,features=_ref385.features,appFeatures=_ref385.appFeatures,onSorting=_ref385.onSorting,onHandleError=_ref385.onHandleError;var infiniteFiles=useFileList(appId,{meta:{order:order,trashed:trashed}});var isLoading=infiniteFiles.isLoading,data=infiniteFiles.data,fetchNextPage=infiniteFiles.fetchNextPage,hasNextPage=infiniteFiles.hasNextPage,isFetchingNextPage=infiniteFiles.isFetchingNextPage,resetInfiniteFiles=infiniteFiles.remove;var _React$useState179=React.useState(),_React$useState180=_slicedToArray2(_React$useState179,2),currentPreview=_React$useState180[0],setCurrentPreview=_React$useState180[1];var openPreview=function openPreview(previewId){setCurrentPreview(previewId)};var onClosePreview=function onClosePreview(){setCurrentPreview(undefined)};React.useEffect(function(){return function(){return resetInfiniteFiles()}},[]);var loadMoreRef=useInfinteScroll(infiniteFiles,[view]);var mutateFileRename=useMutateFileRename(["files",appId]);var mutateFileTrash=useMutateFileTrash(["files",appId]);var mutateFileDeleteForever=useMutateFileDeleteForever(["files",appId]);var mutateFileRestore=useMutateFileRestore(["files",appId]);var mutateFileSubscribe=useMutateFileSubscribe(["files",appId]);var mutateFileUnsubscribe=useMutateFileUnsubscribe(["files",appId]);if(isLoading){return React.createElement(UISpinner.UI,{spin:true,overlay:true})}var loadMoreButton=React.createElement(UIButton.UI,{onClick:function onClick(){return fetchNextPage()},disabled:!hasNextPage||isFetchingNextPage,className:"wy-message-readmore"},"Load more");if(view=="grid"){return React.createElement(React.Fragment,null,React.createElement("div",{className:"wy-grid wy-pane-group"},data&&data.pages&&data.pages.map(function(group,i){var _a;return React.createElement(React.Fragment,{key:i},(_a=group.data)===null||_a===void 0?void 0:_a.map(function(file){return React.createElement(FileItem$1.Card,{key:"file-card"+file.id,file:file,onClick:function onClick(e){return!file.is_trashed&&openPreview(file.id)},onRename:function onRename(name){return mutateFileRename.mutateAsync({file:file,name:name})},onSubscribe:function onSubscribe(file){return mutateFileSubscribe.mutateAsync({file:file})},onUnsubscribe:function onUnsubscribe(file){return mutateFileUnsubscribe.mutateAsync({file:file})},onTrash:function onTrash(file){return mutateFileTrash.mutateAsync({file:file})},onRestore:function onRestore(file){return mutateFileRestore.mutateAsync({file:file})},onDeleteForever:function onDeleteForever(file){return mutateFileDeleteForever.mutateAsync({file:file})},onHandleError:onHandleError,features:features,appFeatures:appFeatures})}))}),React.createElement("div",{className:"wy-pager",ref:loadMoreRef},isFetchingNextPage?"Loading more...":hasNextPage?loadMoreButton:"")),React.createElement(PreviewFiles,{appId:appId,infiniteFiles:infiniteFiles,previewId:currentPreview,onClose:onClosePreview,features:features,appFeatures:appFeatures}))}var headers=[{by:"name",title:"Name"},{by:"modified_at",title:"Modified"},{by:undefined,title:"Kind"},{by:"size",title:"Size"}];return React.createElement(React.Fragment,null,React.createElement("table",{className:"wy-table wy-table-hover wy-table-files"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"wy-table-cell-icon"}),headers.map(function(header){var active=header.by===(order===null||order===void 0?void 0:order.by);var onHeaderClick=function onHeaderClick(e){e.preventDefault();header.by&&onSorting&&onSorting({by:header.by,descending:active&&!(order===null||order===void 0?void 0:order.descending)})};return React.createElement("th",{key:"files-header"+header.title},header.by?React.createElement("div",{className:"wy-table-sort-link",onClick:onHeaderClick},header.title," ",active&&React.createElement(UIIcon.UI,{name:(order===null||order===void 0?void 0:order.descending)?"menu-down":"menu-up"})):React.createElement(React.Fragment,null,header.title))}),React.createElement("th",{className:"wy-table-cell-icon"}))),React.createElement("tbody",null,data&&data.pages&&data.pages.map(function(group,i){var _a;return React.createElement(React.Fragment,{key:i},(_a=group.data)===null||_a===void 0?void 0:_a.map(function(file){return React.createElement(FileItem$1.Row,{key:"file-row"+file.id,file:file,onClick:function onClick(e){return!file.is_trashed&&openPreview(file.id)},onRename:function onRename(name){return mutateFileRename.mutateAsync({file:file,name:name})},onSubscribe:function onSubscribe(file){return mutateFileSubscribe.mutateAsync({file:file})},onUnsubscribe:function onUnsubscribe(file){return mutateFileUnsubscribe.mutateAsync({file:file})},onTrash:function onTrash(file){return mutateFileTrash.mutateAsync({file:file})},onRestore:function onRestore(file){return mutateFileRestore.mutateAsync({file:file})},onDeleteForever:function onDeleteForever(file){return mutateFileDeleteForever.mutateAsync({file:file})},onHandleError:onHandleError,features:features,appFeatures:appFeatures})}))}),React.createElement("tr",{className:"wy-pager",ref:loadMoreRef},React.createElement("td",{colSpan:6},isFetchingNextPage?"Loading more...":hasNextPage?loadMoreButton:"")))),React.createElement(PreviewFiles,{appId:appId,infiniteFiles:infiniteFiles,previewId:currentPreview,onClose:onClosePreview,features:features,appFeatures:appFeatures}))};var useMutateFilesCreate=function useMutateFilesCreate(appId){var _React$useContext91=React.useContext(WeavyContext),client=_React$useContext91.client;if(!client){throw new Error("useMutateFile must be used within an WeavyProvider")}return function(){var _ref387=_asyncToGenerator(_regeneratorRuntime().mark(function _callee209(_ref386){var blob,_ref386$replace,replace,response;return _regeneratorRuntime().wrap(function _callee209$(_context212){while(1)switch(_context212.prev=_context212.next){case 0:blob=_ref386.blob,_ref386$replace=_ref386.replace,replace=_ref386$replace===void 0?false:_ref386$replace;_context212.next=3;return client.post("/api/apps/"+appId+"/files","POST",JSON.stringify({blob_id:blob.id,replace:replace}));case 3:response=_context212.sent;if(response.ok){_context212.next=8;break}_context212.next=7;return response.json();case 7:throw _context212.sent;case 8:_context212.next=10;return response.json();case 10:return _context212.abrupt("return",_context212.sent);case 11:case"end":return _context212.stop()}},_callee209)}));return function(_x203){return _ref387.apply(this,arguments)}}()};var prefix="wy-";function getSessionStorageOrDefault(key,defaultValue){var stored=sessionStorage.getItem(prefix+key);if(!stored){return defaultValue}return JSON.parse(stored)}function useSessionState(key,defaultValue){var _React$useState181=React.useState(getSessionStorageOrDefault(key,defaultValue)),_React$useState182=_slicedToArray2(_React$useState181,2),value=_React$useState182[0],setValue=_React$useState182[1];React.useEffect(function(){sessionStorage.setItem(prefix+key,JSON.stringify(value))},[key,value]);return[value,setValue]}function useMutateAppsSubscribe(appKey){var _React$useContext92=React.useContext(WeavyContext),client=_React$useContext92.client;var queryClient=useQueryClient();if(!client){throw new Error("useMutateAppsSubscribe must be used within an WeavyProvider")}var subscribeMutation=useMutation(function(){var _ref389=_asyncToGenerator(_regeneratorRuntime().mark(function _callee210(_ref388){var appId,subscribe,response;return _regeneratorRuntime().wrap(function _callee210$(_context213){while(1)switch(_context213.prev=_context213.next){case 0:appId=_ref388.appId,subscribe=_ref388.subscribe;if(!(appId>=1)){_context213.next=12;break}_context213.next=4;return client.post("/api/apps/".concat(appId,"/").concat(subscribe?"subscribe":"unsubscribe"),"POST","");case 4:response=_context213.sent;if(response.ok){_context213.next=9;break}_context213.next=8;return response.json();case 8:throw _context213.sent;case 9:return _context213.abrupt("return",response.json());case 12:throw new Error("Could not subscribe to app ".concat(appId,"."));case 13:case"end":return _context213.stop()}},_callee210)}));return function(_x204){return _ref389.apply(this,arguments)}}(),{onMutate:function(){var _onMutate27=_asyncToGenerator(_regeneratorRuntime().mark(function _callee211(variables){var previousSubscribe;return _regeneratorRuntime().wrap(function _callee211$(_context214){while(1)switch(_context214.prev=_context214.next){case 0:queryClient.setQueryData(appKey,function(filesApp){previousSubscribe=filesApp.is_subscribed;return Object.assign(filesApp,{is_subscribed:variables.subscribe})});return _context214.abrupt("return",{previousSubscribe:previousSubscribe,subscribe:variables.subscribe});case 2:case"end":return _context214.stop()}},_callee211)}));function onMutate(_x205){return _onMutate27.apply(this,arguments)}return onMutate}(),onSuccess:function onSuccess(data,variables,context){queryClient.setQueryData(appKey,function(app){return Object.assign(app,data)},{updatedAt:Date.now()});queryClient.invalidateQueries({queryKey:appKey,exact:true})},onError:function onError(error,variables,context){queryClient.setQueryData(appKey,function(app){return Object.assign(app,{is_subscribed:context.previousSubscribe})})}});return subscribeMutation}var Files=function Files(_ref390){var uid=_ref390.uid,className=_ref390.className,_ref390$view=_ref390.view,initView=_ref390$view===void 0?"list":_ref390$view,_ref390$order=_ref390.order,initOrder=_ref390$order===void 0?{by:"name",descending:false}:_ref390$order,_ref390$trashed=_ref390.trashed,initTrashed=_ref390$trashed===void 0?false:_ref390$trashed,features=_ref390.features;var _React$useContext93=React.useContext(WeavyContext),client=_React$useContext93.client;var _React$useState183=React.useState(),_React$useState184=_slicedToArray2(_React$useState183,2),appId=_React$useState184[0],setAppId=_React$useState184[1];var _React$useState185=React.useState(""),_React$useState186=_slicedToArray2(_React$useState185,2),selectedFiles=_React$useState186[0],setSelectedFiles=_React$useState186[1];if(!client){throw new Error("Weavy Files component must be used within an WeavyProvider")}var _useApp=useApp(uid,{}),isLoading=_useApp.isLoading,data=_useApp.data;var _useFeatures4=useFeatures("files",{}),isLoadingFeatures=_useFeatures4.isLoading,dataFeatures=_useFeatures4.data;var mutateFilesSubscribe=useMutateAppsSubscribe(["apps",uid]);var _React$useState187=React.useState(false),_React$useState188=_slicedToArray2(_React$useState187,2),showUploadDetails=_React$useState188[0],setShowUploadDetails=_React$useState188[1];var createFile=useMutateFilesCreate(appId);var uploadFileMutation=useMutateFileUpload(["files",appId],createFile);var createFileMutation=useMutateFileCreate(["files",appId],createFile);var _useMutatingFileUploa2=useMutatingFileUploads(["files",appId]),mutations=_useMutatingFileUploa2.mutations,status=_useMutatingFileUploa2.status,progress=_useMutatingFileUploa2.progress;var removeMutatingFileUpload=useRemoveMutatingFileUpload(["files",appId]);var fileInput;var _useSessionState=useSessionState("files-view-".concat(uid),initView),_useSessionState2=_slicedToArray2(_useSessionState,2),view=_useSessionState2[0],setView=_useSessionState2[1];var _useSessionState3=useSessionState("files-order-".concat(uid),initOrder),_useSessionState4=_slicedToArray2(_useSessionState3,2),order=_useSessionState4[0],setOrder=_useSessionState4[1];var _useSessionState5=useSessionState("files-trashed-".concat(uid),initTrashed),_useSessionState6=_slicedToArray2(_useSessionState5,2),showTrashed=_useSessionState6[0],setShowTrashed=_useSessionState6[1];React.useEffect(function(){if(data){setAppId(data.id)}else{setAppId(undefined)}},[data]);React.useEffect(function(){if(status==="error"||status==="conflict"){setShowUploadDetails(true)}if(mutations.length===0){setShowUploadDetails(false)}},[status,mutations.length]);var handleExternalFileAdded=function handleExternalFileAdded(addedBlobs){addedBlobs.forEach(function(blob){return handleCreateFile(blob)})};var _useCloudFiles2=useCloudFiles(handleExternalFileAdded),openCloudFiles=_useCloudFiles2.openCloudFiles;var handleSubscribe=function handleSubscribe(subscribe){if(appId){mutateFilesSubscribe.mutateAsync({appId:appId,subscribe:subscribe})}};var handleCreateFile=function(){var _ref391=_asyncToGenerator(_regeneratorRuntime().mark(function _callee212(blob,file,replace){var fileProps;return _regeneratorRuntime().wrap(function _callee212$(_context215){while(1)switch(_context215.prev=_context215.next){case 0:fileProps={blob:blob,file:file,replace:replace};_context215.next=3;return createFileMutation.mutateAsync(fileProps,{onSuccess:function onSuccess(data){}});case 3:case"end":return _context215.stop()}},_callee212)}));return function handleCreateFile(_x206,_x207,_x208){return _ref391.apply(this,arguments)}}();var handleFileUpload=function(){var _ref392=_asyncToGenerator(_regeneratorRuntime().mark(function _callee213(e){var i,file,fileProps;return _regeneratorRuntime().wrap(function _callee213$(_context216){while(1)switch(_context216.prev=_context216.next){case 0:if(e.target.files){for(i=0;i<e.target.files.length;i++){file=e.target.files[i];fileProps={file:file};uploadFileMutation.mutateAsync(fileProps,{onSuccess:function onSuccess(data){}})}setSelectedFiles("")}case 1:case"end":return _context216.stop()}},_callee213)}));return function handleFileUpload(_x209){return _ref392.apply(this,arguments)}}();var openFileInput=function openFileInput(e){fileInput===null||fileInput===void 0?void 0:fileInput.click()};var handleRemoveUpload=function handleRemoveUpload(mutation){removeMutatingFileUpload(mutation)};var handleOverwriteUpload=function handleOverwriteUpload(mutation){var _a,_b;removeMutatingFileUpload(mutation);var fileBlob=(_a=mutation.state.context)===null||_a===void 0?void 0:_a.blob;if(fileBlob){handleCreateFile(fileBlob,(_b=mutation.state.context)===null||_b===void 0?void 0:_b.file,true)}};var onDrop=React.useCallback(function(acceptedFiles){if(acceptedFiles.length>0){for(var i=0;i<acceptedFiles.length;i++){var file=acceptedFiles[i];var fileProps={file:file};uploadFileMutation.mutateAsync(fileProps,{})}return true}},[]);var _useDropzone3=useDropzone({onDrop:onDrop,noClick:true,noKeyboard:true,disabled:!appId}),getRootProps=_useDropzone3.getRootProps,pasteRef=_useDropzone3.rootRef,isDragActive=_useDropzone3.isDragActive;var handlePaste=function handlePaste(evt){console.debug("File(s) pasted");var files=[];var items=(evt.clipboardData||evt.originalEvent.clipboardData).items;for(var index in items){var item=items[index];if(item.kind==="file"){files=[].concat(_toConsumableArray2(files),[item.getAsFile()])}}if(files.length){for(var i=0;i<files.length;i++){var file=files[i];var fileProps={file:file};uploadFileMutation.mutateAsync(fileProps,{onSuccess:function onSuccess(data){}})}}};var delegateHandlePaste=function delegateHandlePaste(evt){if(pasteRef.current){var targ=evt.target;do{if(pasteRef.current===targ){handlePaste(evt)}}while((targ=targ.parentNode)&&targ!==evt.currentTarget)}};React.useEffect(function(){if(appId){document.addEventListener("paste",delegateHandlePaste);return function(){document.removeEventListener("paste",delegateHandlePaste)}}},[appId]);if(!isLoading&&!data){return React.createElement("div",null,"No files app with the contextual id ",React.createElement("strong",null,uid)," was found.")}return React.createElement(React.Fragment,null,appId&&dataFeatures&&React.createElement("div",Object.assign({className:classNames("wy-files",className,{"wy-files-dragging":isDragActive})},getRootProps()),React.createElement("header",{className:"wy-appbars"},React.createElement("nav",{className:"wy-toolbar"},React.createElement("div",{className:"wy-toolbar-buttons"},React.createElement(UIDropdown.UI,{title:"Add files",disabled:!appId,buttonContent:React.createElement(React.Fragment,null,React.createElement("span",null,"Add files"),React.createElement(UIIcon.UI,{name:"plus"}))},React.createElement(UIDropdown.Item,{onClick:openFileInput},React.createElement(UIIcon.UI,{name:"attachment"})," From device"),React.createElement("input",{type:"file",value:selectedFiles,ref:function ref(input){return fileInput=input},onChange:handleFileUpload,multiple:true,hidden:true,tabIndex:-1}),hasFeature(dataFeatures,Feature.CloudFiles,features===null||features===void 0?void 0:features.cloudFiles)&&React.createElement(UIDropdown.Item,{onClick:openCloudFiles},React.createElement(UIIcon.UI,{name:"cloud"})," From cloud"))),React.createElement("div",{className:"wy-toolbar-buttons wy-toolbar-buttons-last"},mutations.length>0&&React.createElement(UIButton.UI,{onClick:function onClick(){return setShowUploadDetails(!showUploadDetails)}},status==="conflict"?React.createElement(UIIcon.UI,{name:"alert",color:"yellow",title:"File conflict"}):status==="error"?React.createElement(UIIcon.UI,{name:"alert-octagon",color:"error",title:"Upload error"}):status==="pending"?React.createElement(UISpinner.UI,{spin:progress===undefined,progress:progress}):React.createElement(UIIcon.UI,{name:"check",title:"All uploads finished"})),React.createElement(UISheet.UI,{title:"Uploads",isOpen:showUploadDetails,onClose:function onClose(){return setShowUploadDetails(false)}},mutations.map(function(mutation){var _a;var file=(_a=mutation.state.context)===null||_a===void 0?void 0:_a.file;if(file){return React.createElement(FileItem$1.Item,{key:"file-mutation"+mutation.mutationId,features:dataFeatures,appFeatures:features,file:file,statusText:file.status==="conflict"?"Replace existing file?":"",title:file.name+(file.statusText?": ".concat(file.statusText):"")},React.createElement("div",{className:"wy-item-actions"},file.status==="conflict"&&React.createElement(React.Fragment,null,React.createElement(UIButton.UI,{onClick:handleOverwriteUpload.bind(Files,mutation),title:"Replace"},React.createElement(UIIcon.UI,{name:"check"}))),React.createElement(UIButton.UI,{onClick:handleRemoveUpload.bind(Files,mutation),title:"Discard"},React.createElement(UIIcon.UI,{name:"close"}))))}return undefined})),React.createElement(UIDropdown.UI,{icon:"sort",title:"Sort items by",directionX:"left"},React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":order.by==="name"}),onClick:function onClick(e){return setOrder(Object.assign(Object.assign({},order),{by:"name"}))}},React.createElement(UIIcon.UI,{name:"check"})," Name"),React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":order.by==="modified_at"}),onClick:function onClick(e){return setOrder(Object.assign(Object.assign({},order),{by:"modified_at"}))}},React.createElement(UIIcon.UI,{name:"check"})," Modified"),React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":order.by==="size"}),onClick:function onClick(e){return setOrder(Object.assign(Object.assign({},order),{by:"size"}))}},React.createElement(UIIcon.UI,{name:"check"})," Size"),React.createElement(UIDropdown.Divider,null),React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":!order.descending}),onClick:function onClick(e){return setOrder(Object.assign(Object.assign({},order),{descending:false}))}},React.createElement(UIIcon.UI,{name:"check"})," Ascending"),React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":order.descending}),onClick:function onClick(e){return setOrder(Object.assign(Object.assign({},order),{descending:true}))}},React.createElement(UIIcon.UI,{name:"check"})," Descending")),React.createElement(UIDropdown.UI,{icon:view==="grid"?"view-module-outline":"view-list-outline",title:"View options",directionX:"left"},React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":view==="list"}),onClick:function onClick(e){return setView("list")}},React.createElement(UIIcon.UI,{name:"check"})," List view"),React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":view==="grid"}),onClick:function onClick(e){return setView("grid")}},React.createElement(UIIcon.UI,{name:"check"})," Grid view"),React.createElement(UIDropdown.Divider,null),React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":!showTrashed}),onClick:function onClick(e){return setShowTrashed(false)}},React.createElement(UIIcon.UI,{name:"check"})," Hide trashed"),React.createElement(UIDropdown.Item,{className:classNames("wy-option",{"wy-selected":showTrashed}),onClick:function onClick(e){return setShowTrashed(true)}},React.createElement(UIIcon.UI,{name:"check"})," Show trashed")),React.createElement(UIDropdown.UI,{directionX:"left",disabled:isLoading||!data},data&&React.createElement(React.Fragment,null,data.is_subscribed?React.createElement(UIDropdown.Item,{onClick:function onClick(){return handleSubscribe(false)}},React.createElement(UIIcon.UI,{name:"bell-off"})," Unsubscribe"):React.createElement(UIDropdown.Item,{onClick:function onClick(){return handleSubscribe(true)}},React.createElement(UIIcon.UI,{name:"bell"})," Subscribe"),data.archive_url&&React.createElement(UIDropdown.Item,{onClick:function onClick(){return openUrl(data.archive_url,"_top","".concat(uid,".zip"),true)}},React.createElement(UIIcon.UI,{name:"download"})," Download files")))))),React.createElement(FileList,{appId:appId,view:view,order:order,trashed:showTrashed,onSorting:function onSorting(sortOrder){return setOrder(sortOrder)},onHandleError:function onHandleError(errorFile){return setShowUploadDetails(true)},features:dataFeatures,appFeatures:features})))};exports.Button=UIButton;exports.Chat=Chat;exports.Conversation=Conversation$1;exports.ConversationBadge=ConversationBadge;exports.ConversationList=ConversationList;exports.Dropdown=UIDropdown;exports.Files=Files;exports.Icon=UIIcon;exports.Messenger=Messenger;exports.MessengerContext=MessengerContext;exports.MessengerProvider=MessengerProvider;exports.Overlay=UIOverlay;exports.Posts=Posts;exports.WeavyClient=WeavyClient;exports.WeavyContext=WeavyContext;exports.WeavyProvider=WeavyProvider;
//# sourceMappingURL=index.es5.js.map
